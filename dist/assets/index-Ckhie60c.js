import{r as e,a as t,R as n,g,b as r,c as i,d as o}from"./vendor-BM8aJrq5.js";function s(e,t){for(var n=0;n<t.length;n++){const g=t[n];if("string"!=typeof g&&!Array.isArray(g))for(const t in g)if("default"!==t&&!(t in e)){const n=Object.getOwnPropertyDescriptor(g,t);n&&Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:()=>g[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var a={exports:{}},I={},l=e,C=Symbol.for("react.element"),c=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,u=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,A={key:!0,ref:!0,__self:!0,__source:!0};function h(e,t,n){var g,r={},i=null,o=null;for(g in void 0!==n&&(i=""+n),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(o=t.ref),t)d.call(t,g)&&!A.hasOwnProperty(g)&&(r[g]=t[g]);if(e&&e.defaultProps)for(g in t=e.defaultProps)void 0===r[g]&&(r[g]=t[g]);return{$$typeof:C,type:e,key:i,ref:o,props:r,_owner:u.current}}I.Fragment=c,I.jsx=h,I.jsxs=h,a.exports=I;var m,b,p=a.exports,y={},Z=t;
/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var g in n)Object.prototype.hasOwnProperty.call(n,g)&&(e[g]=n[g])}return e},f.apply(this,arguments)}y.createRoot=Z.createRoot,y.hydrateRoot=Z.hydrateRoot,(b=m||(m={})).Pop="POP",b.Push="PUSH",b.Replace="REPLACE";const G="popstate";function B(e){return void 0===e&&(e={}),function(e,t,n,g){void 0===g&&(g={});let{window:r=document.defaultView,v5Compat:i=!1}=g,o=r.history,s=m.Pop,a=null,I=l();null==I&&(I=0,o.replaceState(f({},o.state,{idx:I}),""));function l(){return(o.state||{idx:null}).idx}function C(){s=m.Pop;let e=l(),t=null==e?null:e-I;I=e,a&&a({action:s,location:A.location,delta:t})}function c(e,t){s=m.Push;let n=V(A.location,e,t);I=l()+1;let g=v(n,I),C=A.createHref(n);try{o.pushState(g,"",C)}catch(c){if(c instanceof DOMException&&"DataCloneError"===c.name)throw c;r.location.assign(C)}i&&a&&a({action:s,location:A.location,delta:1})}function d(e,t){s=m.Replace;let n=V(A.location,e,t);I=l();let g=v(n,I),r=A.createHref(n);o.replaceState(g,"",r),i&&a&&a({action:s,location:A.location,delta:0})}function u(e){let t="null"!==r.location.origin?r.location.origin:r.location.href,n="string"==typeof e?e:w(e);return n=n.replace(/ $/,"%20"),S(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}let A={get action(){return s},get location(){return e(r,o)},listen(e){if(a)throw new Error("A history only accepts one active listener");return r.addEventListener(G,C),a=e,()=>{r.removeEventListener(G,C),a=null}},createHref:e=>t(r,e),createURL:u,encodeLocation(e){let t=u(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:c,replace:d,go:e=>o.go(e)};return A}((function(e,t){let{pathname:n,search:g,hash:r}=e.location;return V("",{pathname:n,search:g,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"==typeof t?t:w(t)}),0,e)}function S(e,t){if(!1===e||null==e)throw new Error(t)}function R(e,t){if(!e)try{throw new Error(t)}catch(fp){}}function v(e,t){return{usr:e.state,key:e.key,idx:t}}function V(e,t,n,g){return void 0===n&&(n=null),f({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof t?W(t):t,{state:n,key:t&&t.key||g||Math.random().toString(36).substr(2,8)})}function w(e){let{pathname:t="/",search:n="",hash:g=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),g&&"#"!==g&&(t+="#"===g.charAt(0)?g:"#"+g),t}function W(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let g=e.indexOf("?");g>=0&&(t.search=e.substr(g),e=e.substr(0,g)),e&&(t.pathname=e)}return t}var k,X;function N(e,t,n){return void 0===n&&(n="/"),function(e,t,n){let g="string"==typeof t?W(t):t,r=Q(g.pathname||"/",n);if(null==r)return null;let i=J(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(i);let o=null;for(let s=0;null==o&&s<i.length;++s){let e=z(r);o=L(i[s],e)}return o}(e,t,n)}function J(e,t,n,g){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===g&&(g="");let r=(e,r,i)=>{let o={relativePath:void 0===i?e.path||"":i,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};o.relativePath.startsWith("/")&&(S(o.relativePath.startsWith(g),'Absolute route path "'+o.relativePath+'" nested under path "'+g+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(g.length));let s=_([g,o.relativePath]),a=n.concat(o);e.children&&e.children.length>0&&(S(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),J(e.children,t,a,s)),(null!=e.path||e.index)&&t.push({path:s,score:D(s,e.index),routesMeta:a})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let g of Y(e.path))r(e,t,g);else r(e,t)})),t}function Y(e){let t=e.split("/");if(0===t.length)return[];let[n,...g]=t,r=n.endsWith("?"),i=n.replace(/\?$/,"");if(0===g.length)return r?[i,""]:[i];let o=Y(g.join("/")),s=[];return s.push(...o.map((e=>""===e?i:[i,e].join("/")))),r&&s.push(...o),s.map((t=>e.startsWith("/")&&""===t?"/":t))}(X=k||(k={})).data="data",X.deferred="deferred",X.redirect="redirect",X.error="error";const E=/^:[\w-]+$/,H=3,F=2,x=1,T=10,K=-2,M=e=>"*"===e;function D(e,t){let n=e.split("/"),g=n.length;return n.some(M)&&(g+=K),t&&(g+=F),n.filter((e=>!M(e))).reduce(((e,t)=>e+(E.test(t)?H:""===t?x:T)),g)}function L(e,t,n){let{routesMeta:g}=e,r={},i="/",o=[];for(let s=0;s<g.length;++s){let e=g[s],n=s===g.length-1,a="/"===i?t:t.slice(i.length)||"/",I=U({path:e.relativePath,caseSensitive:e.caseSensitive,end:n},a),l=e.route;if(!I)return null;Object.assign(r,I.params),o.push({params:r,pathname:_([i,I.pathname]),pathnameBase:q(_([i,I.pathnameBase])),route:l}),"/"!==I.pathnameBase&&(i=_([i,I.pathnameBase]))}return o}function U(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,g]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);R("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let g=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(g.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(g.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let i=new RegExp(r,t?void 0:"i");return[i,g]}(e.path,e.caseSensitive,e.end),r=t.match(n);if(!r)return null;let i=r[0],o=i.replace(/(.)\/+$/,"$1"),s=r.slice(1),a=g.reduce(((e,t,n)=>{let{paramName:g,isOptional:r}=t;if("*"===g){let e=s[n]||"";o=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const a=s[n];return e[g]=r&&!a?void 0:(a||"").replace(/%2F/g,"/"),e}),{});return{params:a,pathname:i,pathnameBase:o,pattern:e}}function z(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return R(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function Q(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,g=e.charAt(n);return g&&"/"!==g?null:e.slice(n)||"/"}function O(e,t,n,g){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(g)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function j(e,t){let n=function(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}(e);return t?n.map(((e,t)=>t===n.length-1?e.pathname:e.pathnameBase)):n.map((e=>e.pathnameBase))}function P(e,t,n,g){let r;void 0===g&&(g=!1),"string"==typeof e?r=W(e):(r=f({},e),S(!r.pathname||!r.pathname.includes("?"),O("?","pathname","search",r)),S(!r.pathname||!r.pathname.includes("#"),O("#","pathname","hash",r)),S(!r.search||!r.search.includes("#"),O("#","search","hash",r)));let i,o=""===e||""===r.pathname,s=o?"/":r.pathname;if(null==s)i=n;else{let e=t.length-1;if(!g&&s.startsWith("..")){let t=s.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}i=e>=0?t[e]:"/"}let a=function(e,t){void 0===t&&(t="/");let{pathname:n,search:g="",hash:r=""}="string"==typeof e?W(e):e,i=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:i,search:$(g),hash:ee(r)}}(r,i),I=s&&"/"!==s&&s.endsWith("/"),l=(o||"."===s)&&n.endsWith("/");return a.pathname.endsWith("/")||!I&&!l||(a.pathname+="/"),a}const _=e=>e.join("/").replace(/\/\/+/g,"/"),q=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),$=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",ee=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";const te=["post","put","patch","delete"];new Set(te);const ne=["get",...te];
/**
 * React Router v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function ge(){return ge=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var g in n)Object.prototype.hasOwnProperty.call(n,g)&&(e[g]=n[g])}return e},ge.apply(this,arguments)}new Set(ne);const re=e.createContext(null),ie=e.createContext(null),oe=e.createContext(null),se=e.createContext(null),ae=e.createContext({outlet:null,matches:[],isDataRoute:!1}),Ie=e.createContext(null);function le(){return null!=e.useContext(se)}function Ce(){return le()||S(!1),e.useContext(se).location}function ce(t){e.useContext(oe).static||e.useLayoutEffect(t)}function de(){let{isDataRoute:t}=e.useContext(ae);return t?function(){let{router:t}=function(){let t=e.useContext(re);return t||S(!1),t}(ye.UseNavigateStable),n=fe(Ze.UseNavigateStable),g=e.useRef(!1);return ce((()=>{g.current=!0})),e.useCallback((function(e,r){void 0===r&&(r={}),g.current&&("number"==typeof e?t.navigate(e):t.navigate(e,ge({fromRouteId:n},r)))}),[t,n])}():function(){le()||S(!1);let t=e.useContext(re),{basename:n,future:g,navigator:r}=e.useContext(oe),{matches:i}=e.useContext(ae),{pathname:o}=Ce(),s=JSON.stringify(j(i,g.v7_relativeSplatPath)),a=e.useRef(!1);return ce((()=>{a.current=!0})),e.useCallback((function(e,g){if(void 0===g&&(g={}),!a.current)return;if("number"==typeof e)return void r.go(e);let i=P(e,JSON.parse(s),o,"path"===g.relative);null==t&&"/"!==n&&(i.pathname="/"===i.pathname?n:_([n,i.pathname])),(g.replace?r.replace:r.push)(i,g.state,g)}),[n,r,s,o,t])}()}function ue(t,n){let{relative:g}=void 0===n?{}:n,{future:r}=e.useContext(oe),{matches:i}=e.useContext(ae),{pathname:o}=Ce(),s=JSON.stringify(j(i,r.v7_relativeSplatPath));return e.useMemo((()=>P(t,JSON.parse(s),o,"path"===g)),[t,s,o,g])}function Ae(t,n){return function(t,n,g,r){le()||S(!1);let{navigator:i,static:o}=e.useContext(oe),{matches:s}=e.useContext(ae),a=s[s.length-1],I=a?a.params:{};!a||a.pathname;let l=a?a.pathnameBase:"/";a&&a.route;let C,c=Ce();if(n){var d;let e="string"==typeof n?W(n):n;"/"===l||(null==(d=e.pathname)?void 0:d.startsWith(l))||S(!1),C=e}else C=c;let u=C.pathname||"/",A=u;if("/"!==l){let e=l.replace(/^\//,"").split("/");A="/"+u.replace(/^\//,"").split("/").slice(e.length).join("/")}let h=N(t,{pathname:A}),b=function(t,n,g,r){var i;void 0===n&&(n=[]);void 0===g&&(g=null);void 0===r&&(r=null);if(null==t){var o;if(!g)return null;if(g.errors)t=g.matches;else{if(!(null!=(o=r)&&o.v7_partialHydration&&0===n.length&&!g.initialized&&g.matches.length>0))return null;t=g.matches}}let s=t,a=null==(i=g)?void 0:i.errors;if(null!=a){let e=s.findIndex((e=>e.route.id&&void 0!==(null==a?void 0:a[e.route.id])));e>=0||S(!1),s=s.slice(0,Math.min(s.length,e+1))}let I=!1,l=-1;if(g&&r&&r.v7_partialHydration)for(let e=0;e<s.length;e++){let t=s[e];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(l=e),t.route.id){let{loaderData:e,errors:n}=g,r=t.route.loader&&void 0===e[t.route.id]&&(!n||void 0===n[t.route.id]);if(t.route.lazy||r){I=!0,s=l>=0?s.slice(0,l+1):[s[0]];break}}}return s.reduceRight(((t,r,i)=>{let o,C=!1,c=null,d=null;g&&(o=a&&r.route.id?a[r.route.id]:void 0,c=r.route.errorElement||me,I&&(l<0&&0===i?(!function(e){Ge[e]||(Ge[e]=!0)}("route-fallback"),C=!0,d=null):l===i&&(C=!0,d=r.route.hydrateFallbackElement||null)));let u=n.concat(s.slice(0,i+1)),A=()=>{let n;return n=o?c:C?d:r.route.Component?e.createElement(r.route.Component,null):r.route.element?r.route.element:t,e.createElement(pe,{match:r,routeContext:{outlet:t,matches:u,isDataRoute:null!=g},children:n})};return g&&(r.route.ErrorBoundary||r.route.errorElement||0===i)?e.createElement(be,{location:g.location,revalidation:g.revalidation,component:c,error:o,children:A(),routeContext:{outlet:null,matches:u,isDataRoute:!0}}):A()}),null)}(h&&h.map((e=>Object.assign({},e,{params:Object.assign({},I,e.params),pathname:_([l,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?l:_([l,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),s,g,r);if(n&&b)return e.createElement(se.Provider,{value:{location:ge({pathname:"/",search:"",hash:"",state:null,key:"default"},C),navigationType:m.Pop}},b);return b}(t,n)}function he(){let t=function(){var t;let n=e.useContext(Ie),g=function(){let t=e.useContext(ie);return t||S(!1),t}(),r=fe();if(void 0!==n)return n;return null==(t=g.errors)?void 0:t[r]}(),n=function(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),g=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return e.createElement(e.Fragment,null,e.createElement("h2",null,"Unexpected Application Error!"),e.createElement("h3",{style:{fontStyle:"italic"}},n),g?e.createElement("pre",{style:r},g):null,null)}const me=e.createElement(he,null);class be extends e.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){}render(){return void 0!==this.state.error?e.createElement(ae.Provider,{value:this.props.routeContext},e.createElement(Ie.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function pe(t){let{routeContext:n,match:g,children:r}=t,i=e.useContext(re);return i&&i.static&&i.staticContext&&(g.route.errorElement||g.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=g.route.id),e.createElement(ae.Provider,{value:n},r)}var ye=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ye||{}),Ze=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Ze||{});function fe(t){let n=function(){let t=e.useContext(ae);return t||S(!1),t}(),g=n.matches[n.matches.length-1];return g.route.id||S(!1),g.route.id}const Ge={};function Be(t){let{to:n,replace:g,state:r,relative:i}=t;le()||S(!1);let{future:o,static:s}=e.useContext(oe),{matches:a}=e.useContext(ae),{pathname:I}=Ce(),l=de(),C=P(n,j(a,o.v7_relativeSplatPath),I,"path"===i),c=JSON.stringify(C);return e.useEffect((()=>l(JSON.parse(c),{replace:g,state:r,relative:i})),[l,c,i,g,r]),null}function Se(e){S(!1)}function Re(t){let{basename:n="/",children:g=null,location:r,navigationType:i=m.Pop,navigator:o,static:s=!1,future:a}=t;le()&&S(!1);let I=n.replace(/^\/*/,"/"),l=e.useMemo((()=>({basename:I,navigator:o,static:s,future:ge({v7_relativeSplatPath:!1},a)})),[I,a,o,s]);"string"==typeof r&&(r=W(r));let{pathname:C="/",search:c="",hash:d="",state:u=null,key:A="default"}=r,h=e.useMemo((()=>{let e=Q(C,I);return null==e?null:{location:{pathname:e,search:c,hash:d,state:u,key:A},navigationType:i}}),[I,C,c,d,u,A,i]);return null==h?null:e.createElement(oe.Provider,{value:l},e.createElement(se.Provider,{children:g,value:h}))}function ve(e){let{children:t,location:n}=e;return Ae(Ve(t),n)}function Ve(t,n){void 0===n&&(n=[]);let g=[];return e.Children.forEach(t,((t,r)=>{if(!e.isValidElement(t))return;let i=[...n,r];if(t.type===e.Fragment)return void g.push.apply(g,Ve(t.props.children,i));t.type!==Se&&S(!1),t.props.index&&t.props.children&&S(!1);let o={id:t.props.id||i.join("-"),caseSensitive:t.props.caseSensitive,element:t.props.element,Component:t.props.Component,index:t.props.index,path:t.props.path,loader:t.props.loader,action:t.props.action,errorElement:t.props.errorElement,ErrorBoundary:t.props.ErrorBoundary,hasErrorBoundary:null!=t.props.ErrorBoundary||null!=t.props.errorElement,shouldRevalidate:t.props.shouldRevalidate,handle:t.props.handle,lazy:t.props.lazy};t.props.children&&(o.children=Ve(t.props.children,i)),g.push(o)})),g}
/**
 * React Router DOM v6.30.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function we(){return we=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var g in n)Object.prototype.hasOwnProperty.call(n,g)&&(e[g]=n[g])}return e},we.apply(this,arguments)}new Promise((()=>{}));const We=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(fp){}const ke=n.startTransition;function Xe(t){let{basename:n,children:g,future:r,window:i}=t,o=e.useRef();null==o.current&&(o.current=B({window:i,v5Compat:!0}));let s=o.current,[a,I]=e.useState({action:s.action,location:s.location}),{v7_startTransition:l}=r||{},C=e.useCallback((e=>{l&&ke?ke((()=>I(e))):I(e)}),[I,l]);return e.useLayoutEffect((()=>s.listen(C)),[s,C]),e.useEffect((()=>{return null==(e=r)||e.v7_startTransition,void(null==e||e.v7_relativeSplatPath);var e}),[r]),e.createElement(Re,{basename:n,children:g,location:a.location,navigationType:a.action,navigator:s,future:r})}const Ne="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,Je=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ye=e.forwardRef((function(t,n){let g,{onClick:r,relative:i,reloadDocument:o,replace:s,state:a,target:I,to:l,preventScrollReset:C,viewTransition:c}=t,d=function(e,t){if(null==e)return{};var n,g,r={},i=Object.keys(e);for(g=0;g<i.length;g++)n=i[g],t.indexOf(n)>=0||(r[n]=e[n]);return r}(t,We),{basename:u}=e.useContext(oe),A=!1;if("string"==typeof l&&Je.test(l)&&(g=l,Ne))try{let e=new URL(window.location.href),t=l.startsWith("//")?new URL(e.protocol+l):new URL(l),n=Q(t.pathname,u);t.origin===e.origin&&null!=n?l=n+t.search+t.hash:A=!0}catch(fp){}let h=function(t,n){let{relative:g}=void 0===n?{}:n;le()||S(!1);let{basename:r,navigator:i}=e.useContext(oe),{hash:o,pathname:s,search:a}=ue(t,{relative:g}),I=s;return"/"!==r&&(I="/"===s?r:_([r,s])),i.createHref({pathname:I,search:a,hash:o})}(l,{relative:i}),m=function(t,n){let{target:g,replace:r,state:i,preventScrollReset:o,relative:s,viewTransition:a}=void 0===n?{}:n,I=de(),l=Ce(),C=ue(t,{relative:s});return e.useCallback((e=>{if(function(e,t){return!(0!==e.button||t&&"_self"!==t||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(e,g)){e.preventDefault();let n=void 0!==r?r:w(l)===w(C);I(t,{replace:n,state:i,preventScrollReset:o,relative:s,viewTransition:a})}}),[l,I,C,r,i,g,t,o,s,a])}(l,{replace:s,state:a,target:I,preventScrollReset:C,relative:i,viewTransition:c});return e.createElement("a",we({},d,{href:g||h,onClick:A||o?r:function(e){r&&r(e),e.defaultPrevented||m(e)},ref:n,target:I}))}));var Ee,He,Fe,xe;(He=Ee||(Ee={})).UseScrollRestoration="useScrollRestoration",He.UseSubmit="useSubmit",He.UseSubmitFetcher="useSubmitFetcher",He.UseFetcher="useFetcher",He.useViewTransitionState="useViewTransitionState",(xe=Fe||(Fe={})).UseFetcher="useFetcher",xe.UseFetchers="useFetchers",xe.UseScrollRestoration="useScrollRestoration";const Te={Shukrani:[{name:"institut kilanga",count:7,message:"Chers amis de l’Institut Kilanga, votre présence enrichira notre célébration ! Bienvenue au mariage de Fiston Zaka et Vino Banza."},{name:"couple FAKI",count:2,message:"Famille Faki, c’est un honneur de vous compter parmi nous pour le grand jour ! Fiston Zaka et Vino Banza vous saluent chaleureusement."},{name:"EP SHINDANO",count:3,message:"Chers membres de l’EP Shindano, votre joie et votre bonne humeur sont essentielles ! À très vite pour célébrer Fiston Zaka et Vino Banza."}],Yvmie:[{name:"INSTITUT WILLIAM",count:5,message:"Institut William, préparez-vous à partager un moment inoubliable ! Fiston Zaka et Vino Banza vous attendent."},{name:"COUPLE MAKAMBU",count:2,message:"Couple Makambu, votre complicité sera notre plus beau cadeau ! Merci de célébrer ce jour spécial avec Fiston Zaka et Vino Banza."},{name:"COUPLE KIKWESE",count:2,message:"Famille Kikwese, votre présence illuminera la fête ! Fiston Zaka et Vino Banza vous accueillent à bras ouverts."},{name:"Vudwawu",count:1,message:"Cher Vudwawu, toute l’équipe de Fiston Zaka et Vino Banza est ravie de vous recevoir pour cette belle journée."}],Yvanna:[{name:"ÉCOLE CROUCROU",count:5,message:"École Croucrou, vos sourires et votre enthousiasme sont attendus ! Merci de venir fêter Fiston Zaka et Vino Banza."},{name:"COUPLE LUCIEN",count:2,message:"Couple Lucien, nous sommes impatients de partager ce moment magique avec vous ! À bientôt pour le mariage de Fiston Zaka et Vino Banza."},{name:"COUPLE MASIALA",count:2,message:"Famille Masiala, votre élégance animera notre journée ! Fiston Zaka et Vino Banza se réjouissent de vous voir."}],Aurore:[{name:"COUPLE FWAMBA EMMANUEL",count:2,message:"Couple Fwamba Emmanuel, préparez-vous à une fête mémorable ! Fiston Zaka et Vino Banza vous remercient de votre présence."},{name:"COUPLE MBUYU CLAUDE",count:2,message:"Famille Mbuyu Claude, votre joie de vivre sera le plus beau des cadeaux ! Merci d’être là pour Fiston Zaka et Vino Banza."},{name:"COUPLE KUMWIMBA PEGGY",count:2,message:"Couple Kumwimba Peggy, votre présence apportera chaleur et sourire ! Fiston Zaka et Vino Banza sont impatients de vous accueillir."},{name:"COUPLE MBUMBA FREDY",count:2,message:"Famille Mbumba Fredy, merci de participer à cette grande aventure ! Fiston Zaka et Vino Banza vous saluent avec gratitude."},{name:"ANGEL KYUNGU",count:1,message:"Cher Angel Kyungu, votre soutien est précieux ! Bienvenue au mariage de Fiston Zaka et Vino Banza."},{name:"Mukalay Jean",count:1,message:"Cher Mukalay Jean, merci de joindre vos vœux à notre célébration ! À très vite pour fêter Fiston Zaka et Vino Banza."}],Beneth:[{name:"couple fwamba George",count:2,message:"Couple Fwamba George, votre présence embellira le jour J ! Fiston Zaka et Vino Banza vous attendent."},{name:"couple KYUNGU benjamin",count:2,message:"Famille Kyungu Benjamin, merci d’être à nos côtés pour ce moment unique ! À bientôt pour le mariage de Fiston Zaka et Vino Banza."},{name:"couple fwamba Franc",count:2,message:"Couple Fwamba Franc, votre complicité rendra la fête encore plus belle ! Fiston Zaka et Vino Banza vous accueillent."},{name:"Maman Nénette",count:1,message:"Chère Maman Nénette, votre présence maternelle sera notre plus grand réconfort ! Bienvenue au mariage de Fiston Zaka et Vino Banza."},{name:"Maman KYUNGU",count:1,message:"Chère Maman Kyungu, merci de partager ce moment sacré avec nous ! Fiston Zaka et Vino Banza vous saluent chaleureusement."},{name:"Maman Costa",count:1,message:"Chère Maman Costa, votre bienveillance illuminera notre journée ! À très bientôt pour célébrer Fiston Zaka et Vino Banza."}],Amani:[{name:"couple kalumba Yvon",count:2,message:"Couple Kalumba Yvon, votre présence est un honneur ! Fiston Zaka et Vino Banza se réjouissent de vous voir."},{name:"couple kongolo Cédric",count:2,message:"Famille Kongolo Cédric, préparez-vous à une célébration mémorable ! Merci d’être avec Fiston Zaka et Vino Banza."},{name:"couple Binene Paulin",count:2,message:"Couple Binene Paulin, votre énergie positive rendra tout plus beau ! Fiston Zaka et Vino Banza vous attendent."},{name:"couple jibikilayi patient",count:2,message:"Famille Jibikilayi Patient, votre amitié nous touche au cœur ! Bienvenue au mariage de Fiston Zaka et Vino Banza."},{name:"Jeanine nzolana",count:1,message:"Chère Jeanine Nzolana, merci de partager ce jour exceptionnel ! Fiston Zaka et Vino Banza sont ravis de vous compter parmi nous."},{name:"Nancy",count:1,message:"Chère Nancy, votre présence ajoutera une touche de bonheur ! À très bientôt pour célébrer Fiston Zaka et Vino Banza."}],Cheyenne:[{name:"pungwe falonne",count:1,message:"Cher Pungwe Falonne, votre sourire illuminera notre fête ! Bienvenue au mariage de Fiston Zaka et Vino Banza."},{name:"Ngoy Marina",count:1,message:"Chère Ngoy Marina, votre présence rendra ce jour encore plus spécial ! Fiston Zaka et Vino Banza vous remercient."},{name:"Mukalay Christian",count:1,message:"Cher Mukalay Christian, préparez-vous à vivre un moment inoubliable ! Merci de célébrer Fiston Zaka et Vino Banza."},{name:"fwamba Gorcelain",count:1,message:"Cher Fwamba Gorcelain, votre joie nous est précieuse ! Fiston Zaka et Vino Banza se réjouissent de vous voir."},{name:"badibanga James",count:1,message:"Cher Badibanga James, votre présence est un bonheur ! À très vite pour le mariage de Fiston Zaka et Vino Banza."},{name:"Mukalay Michael",count:1,message:"Cher Mukalay Michael, votre soutien réchauffe nos cœurs ! Bienvenue à la célébration de Fiston Zaka et Vino Banza."},{name:"Gisèle et Lidia",count:2,message:"Chères Gisèle et Lidia, merci d’apporter votre douceur à notre cérémonie ! Fiston Zaka et Vino Banza vous saluent."},{name:"Arlette fwamba",count:1,message:"Chère Arlette Fwamba, votre présence embellira la journée ! Merci de célébrer Fiston Zaka et Vino Banza."},{name:"juve",count:1,message:"Cher Juve, votre bonne humeur est essentielle ! Fiston Zaka et Vino Banza sont heureux de vous accueillir."},{name:"Maris ntambwe",count:1,message:"Chère Maris Ntambwe, votre présence sera un vrai cadeau ! À très bientôt pour célébrer Fiston Zaka et Vino Banza."}],Christina:[{name:"couple Olivier",count:2,message:"Couple Olivier, votre élégance rendra notre journée inoubliable ! Fiston Zaka et Vino Banza vous attendent."},{name:"couple Didier",count:2,message:"Famille Didier, merci d’apporter votre joie à notre fête ! Bienvenue au mariage de Fiston Zaka et Vino Banza."},{name:"couple Bob",count:2,message:"Couple Bob, votre complicité est notre plus beau cadeau ! Fiston Zaka et Vino Banza se réjouissent de vous recevoir."},{name:"couple COUPLE JIMMY",count:2,message:"Couple Jimmy, votre présence illuminera la cérémonie ! Merci d’être avec Fiston Zaka et Vino Banza."},{name:"MAMAN CHRISTINE ET PERFODIE",count:2,message:"Chères Mamans Christine et Perfodie, votre tendresse nous touche profondément ! Fiston Zaka et Vino Banza vous saluent chaleureusement."}],Claudeney:[{name:"Espérance",count:1,message:"Chère Espérance, votre optimisme est un rayon de soleil ! Bienvenue au mariage de Fiston Zaka et Vino Banza."},{name:"Claude junior",count:1,message:"Cher Claude Junior, merci de partager notre bonheur ! Fiston Zaka et Vino Banza sont ravis de vous accueillir."},{name:"djodjo",count:1,message:"Cher Djodjo, votre bonne humeur est essentielle ! À très vite pour célébrer Fiston Zaka et Vino Banza."},{name:"Exaucé",count:1,message:"Cher Exaucé, votre soutien nous touche profondément ! Bienvenue à notre grande fête."},{name:"MELINA",count:1,message:"Chère Melina, votre élégance rendra la journée encore plus belle ! Fiston Zaka et Vino Banza vous attendent."},{name:"HÉLÈNE",count:1,message:"Chère Hélène, votre présence est un cadeau précieux ! Merci de célébrer avec Fiston Zaka et Vino Banza."}],Stone:[{name:"Destiné",count:1,message:"Chère Destiné, votre présence promet d’être magique ! Bienvenue au mariage de Fiston Zaka et Vino Banza."},{name:"couple merveille",count:2,message:"Couple Merveille, votre amour nous inspire ! Fiston Zaka et Vino Banza se réjouissent de vous accueillir."},{name:"Jemima et Paola",count:2,message:"Chères Jemima et Paola, merci d’apporter votre complicité ! À très bientôt pour célébrer notre union."},{name:"couple shadrac",count:2,message:"Famille Shadrac, votre joie sera notre plus beau cadeau ! Fiston Zaka et Vino Banza vous saluent."},{name:"MA MARIE",count:1,message:"Chère Ma Marie, votre présence sera gravée dans nos cœurs ! Bienvenue au mariage de Fiston Zaka et Vino Banza."}],"Fréd":[{name:"Arlette dimonekene",count:1,message:"Chère Arlette Dimonekene, votre bienveillance illumine nos vies ! Fiston Zaka et Vino Banza vous remercient."},{name:"Couple Merveille",count:2,message:"Couple Merveille, votre complicité sera notre plus beau souvenir ! Bienvenue à notre fête."},{name:"Papy masini",count:1,message:"Cher Papy Masini, votre sagesse rendra ce jour unique ! Fiston Zaka et Vino Banza sont honorés de vous avoir."},{name:"Marie bikela",count:1,message:"Chère Marie Bikela, votre présence est un trésor ! Merci de célébrer avec nous."},{name:"Maman bijoux",count:1,message:"Chère Maman Bijoux, votre tendresse est précieuse ! Fiston Zaka et Vino Banza vous saluent."}],"Frémi":[{name:"Couple Papa bona",count:2,message:"Couple Papa Bona, votre amour est contagieux ! Bienvenue au mariage de Fiston Zaka et Vino Banza."},{name:"couple KELLY",count:2,message:"Famille Kelly, votre présence nous touche au cœur ! Fiston Zaka et Vino Banza sont impatients de vous recevoir."},{name:"COUPLE CHRISTINE",count:2,message:"Couple Christine, votre complicité embellira la journée ! Merci de célébrer avec nous."},{name:"COUPLE LE KING- DOLA",count:2,message:"Famille Le King-Dola, votre présence royale sera inoubliable ! Fiston Zaka et Vino Banza vous attendent."},{name:"COUPLE NATACHA",count:2,message:"Couple Natacha, votre élégance nous inspire ! Bienvenue à notre célébration."}],Justine:[{name:"Alfred",count:1,message:"Cher Alfred, votre présence personnelle est un cadeau ! Fiston Zaka et Vino Banza vous remercient."},{name:"Fariam",count:1,message:"Cher Fariam, votre sourire rendra notre fête lumineuse ! Bienvenue au mariage."},{name:"COUPLE MAMAN ANNI",count:2,message:"Chers Couple Maman Anni, votre tendresse est essentielle ! Fiston Zaka et Vino Banza se réjouissent de vous avoir."},{name:"COUPLE ALAIN",count:2,message:"Famille Alain, préparez-vous à une journée inoubliable ! Merci d’être présents."},{name:"COUPLE TOTO",count:2,message:"Couple Toto, votre bonne humeur est contagieuse ! Bienvenue au mariage de Fiston Zaka et Vino Banza."},{name:"COUPLE MPEMA",count:2,message:"Famille Mpema, votre joie et vos rires seront nos meilleurs souvenirs ! À très vite."},{name:"COUPLE RICHARD",count:2,message:"Couple Richard, votre élégance embellira notre union ! Fiston Zaka et Vino Banza vous saluent."}],GABBY:[{name:"COUPLE LAURENT",count:2,message:"Famille Laurent, votre présence est un honneur ! Bienvenue à notre mariage."},{name:"COUPLE ÉRIC",count:2,message:"Couple Éric, votre complicité sera notre plus beau cadeau ! Fiston Zaka et Vino Banza vous attendent."},{name:"COUPLE BELLONE",count:2,message:"Famille Bellone, votre chaleur humaine nous émeut ! Merci d’être là."},{name:"COUPLE TSHAMALA",count:2,message:"Couple Tshamala, votre présence illuminera la fête ! Bienvenue au mariage."},{name:"COUPLE GABRIEL",count:2,message:"Famille Gabriel, votre soutien est précieux ! Fiston Zaka et Vino Banza se réjouissent de vous recevoir."}],"GAËTAN":[{name:"JOCELYNE",count:1,message:"Chère Jocelyne, votre joie de vivre est un rayon de soleil ! Bienvenue à notre grande fête."},{name:"Florence",count:1,message:"Chère Florence, votre élégance rendra ce jour mémorable ! Fiston Zaka et Vino Banza vous saluent."},{name:"Roger",count:1,message:"Cher Roger, votre présence est un vrai honneur ! Merci de célébrer avec nous."},{name:"SACRE",count:1,message:"Chère Sacre, votre soutien est inestimable ! Fiston Zaka et Vino Banza vous remercient."},{name:"COUPLE KELLY",count:2,message:"Famille Kelly, votre complicité rendra tout plus beau ! Bienvenue au mariage."},{name:"COUPLE MA MBELO",count:2,message:"Famille Ma Mbelo, c’est un plaisir de vous avoir parmi nous ! À très vite pour la cérémonie."},{name:"COUPLE LÉON",count:2,message:"Famille Léon, votre présence est un cadeau précieux ! Fiston Zaka et Vino Banza vous attendent."}],"Gaël":[{name:"COUPLE LOVE",count:2,message:"Couple Love, votre amour illumine notre journée ! Bienvenue au mariage."},{name:"FRÈRE DANNY",count:1,message:"Cher Frère Danny, votre soutien fraternel est essentiel ! Merci d’être là."},{name:"COUPLE CHRISTIAN",count:2,message:"Famille Christian, votre joie nous est précieuse ! Fiston Zaka et Vino Banza se réjouissent de vous recevoir."},{name:"COUPLE FREDDYNA",count:2,message:"Famille Freddy­na, votre complicité embellira la fête ! Bienvenue à notre union."},{name:"TA MWASI",count:1,message:"Chère Ta Mwasi, votre présence est un honneur ! Merci de célébrer avec nous."},{name:"COUPLE TATU",count:2,message:"Couple Tatu, votre bonne humeur est contagieuse ! Fiston Zaka et Vino Banza vous attendent."}],"GAËLLE":[{name:"PATRICK MUANDA",count:1,message:"Cher Patrick Muanda, votre présence illumine notre journée ! Bienvenue au mariage."},{name:"HUBERT NHEMA",count:1,message:"Cher Hubert Nhema, votre élégance rendra ce jour mémorable ! Fiston Zaka et Vino Banza vous saluent."},{name:"ANICET TUNDA",count:1,message:"Cher Anicet Tunda, votre présence est un honneur ! Merci de célébrer avec nous."}]},Ke={couple:{groom:"Fiston Zaka",bride:"Vino Banza"},event:{date:"31 Mai 2025",time:"19h00",venue:"Salle de fête Néema",address:"Avenue INGA, N° 1",location:"Commune de Bandalungwa, Quartier Adoula",city:"Kinshasa",reference:"Banque du sang"},families:{groomFamily:"Famille Lisongo",brideFamily:"Famille Fwamba"},welcomeMessage:"Nous avons l'immense joie de vous convier à notre union. Votre présence serait pour nous un honneur et rendrait ce jour encore plus mémorable.",schedule:[{time:"19h00",title:"Accueil des invités",description:"Arrivée et installation des invités"},{time:"19h30",title:"Cérémonie",description:"Célébration de notre union"},{time:"20h30",title:"Cocktail",description:"Photos et rafraîchissements"},{time:"21h30",title:"Dîner",description:"Repas et festivités"},{time:"23h00",title:"Soirée dansante",description:"Célébration jusqu'au bout de la nuit"}],dressCode:"Tenue élégante",tables:[{name:"Shukrani",count:12,color:"#7209B7",invites:[{name:"Institut Kilanga",count:7},{name:"Couple FAKI",count:2},{name:"EP SHINDANO",count:3}]},{name:"Yvmie",count:10,color:"#0077B6",invites:[{name:"INSTITUT WILLIAM",count:5},{name:"COUPLE MAKAMBU",count:2},{name:"COUPLE KIKWESE",count:2},{name:"Vudwawu",count:1}]},{name:"Yvanna",count:9,color:"#00B4D8",invites:[{name:"ÉCOLE CROUCROU",count:5},{name:"COUPLE LUCIEN",count:2},{name:"COUPLE MASIALA",count:2}]},{name:"Aurore",count:10,color:"#FF5400",invites:[{name:"COUPLE FWAMBA EMMANUEL",count:2},{name:"COUPLE MBUYU CLAUDE",count:2},{name:"COUPLE KUMWIMBA PEGGY",count:2},{name:"COUPLE MBUMBA FREDY",count:2},{name:"ANGEL KYUNGU",count:1},{name:"Mukalay Jean",count:1}]},{name:"Beneth",count:9,color:"#D90429",invites:[{name:"Couple Fwamba George",count:2},{name:"Couple KYUNGU Benjamin",count:2},{name:"Couple Fwamba Franc",count:2},{name:"Maman Nénette",count:1},{name:"Maman KYUNGU",count:1},{name:"Maman Costa",count:1}]},{name:"Amani",count:10,color:"#38B000",invites:[{name:"Couple Kalumba Yvon",count:2},{name:"Couple Kongolo Cédric",count:2},{name:"Couple Binene Paulin",count:2},{name:"Couple Jibikilayi Patient",count:2},{name:"Jeanine Nzolana",count:1},{name:"Nancy",count:1}]},{name:"Cheyenne",count:12,color:"#9D4EDD",invites:[{name:"Pungwe Falonne",count:1},{name:"Ngoy Marina",count:1},{name:"Mukalay Christian",count:1},{name:"Fwamba Gorcelain",count:1},{name:"Badibanga James",count:1},{name:"Mukalay Michael",count:1},{name:"Gisèle et Lidia",count:2},{name:"Arlette Fwamba",count:1},{name:"Juve",count:1},{name:"Maris Ntambwe",count:1}]},{name:"Christina",count:10,color:"#FB8500",invites:[{name:"Couple Olivier",count:2},{name:"Couple Didier",count:2},{name:"Couple Bob",count:2},{name:"Couple JIMMY",count:2},{name:"MAMAN CHRISTINE ET PERFODIE",count:2}]},{name:"Claudeney",count:6,color:"#4895EF",invites:[{name:"Espérance",count:1},{name:"Claude Junior",count:1},{name:"Djodjo",count:1},{name:"Exaucé",count:1},{name:"MELINA",count:1},{name:"HÉLÈNE",count:1}]},{name:"Stone",count:8,color:"#F72585",invites:[{name:"Destiné",count:1},{name:"Couple Merveille",count:2},{name:"Jemima et Paola",count:2},{name:"Couple Shadrac",count:2},{name:"MA MARIE",count:1}]},{name:"Fréd",count:6,color:"#6A00F4",invites:[{name:"Arlette Dimonekene",count:1},{name:"Couple Merveille",count:2},{name:"Papy Masini",count:1},{name:"Marie Bikela",count:1},{name:"Maman Bijoux",count:1}]},{name:"Frémi",count:10,color:"#FFBE0B",invites:[{name:"Couple Papa Bona",count:2},{name:"Couple KELLY",count:2},{name:"COUPLE CHRISTINE",count:2},{name:"COUPLE LE KING-DOLA",count:2},{name:"COUPLE NATACHA",count:2}]},{name:"Justine",count:12,color:"#3A86FF",invites:[{name:"Alfred",count:1},{name:"Fariam",count:1},{name:"COUPLE MAMAN ANNI",count:2},{name:"COUPLE ALAIN",count:2},{name:"COUPLE TOTO",count:2},{name:"COUPLE MPEMA",count:2},{name:"COUPLE RICHARD",count:2}]},{name:"GABBY",count:10,color:"#FF006E",invites:[{name:"COUPLE LAURENT",count:2},{name:"COUPLE ÉRIC",count:2},{name:"COUPLE BELLONE",count:2},{name:"COUPLE TSHAMALA",count:2},{name:"COUPLE GABRIEL",count:2}]},{name:"GAËTAN",count:10,color:"#80B918",invites:[{name:"JOCELYNE",count:1},{name:"Florence",count:1},{name:"Roger",count:1},{name:"SACRE",count:1},{name:"COUPLE KELLY",count:2},{name:"COUPLE MA MBELO",count:2},{name:"COUPLE LÉON",count:2}]},{name:"Gaël",count:10,color:"#FF9E00",invites:[{name:"COUPLE LOVE",count:2},{name:"FRÈRE DANNY",count:1},{name:"COUPLE CHRISTIAN",count:2},{name:"COUPLE FREDDYNA",count:2},{name:"TA MWASI",count:1},{name:"COUPLE TATU",count:2}]},{name:"GAËLLE",count:3,color:"#C77DFF",invites:[{name:"PATRICK MUANDA",count:1},{name:"HUBERT NHEMA",count:1},{name:"ANICET TUNDA",count:1}]}]};var Me={exports:{}};function De(){}function Le(){}Le.resetWarningCache=De;Me.exports=function(){function e(e,t,n,g,r,i){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==i){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Le,resetWarningCache:De};return n.PropTypes=n,n}();const Ue=g(Me.exports),ze=({threshold:t=.1,rootMargin:n="0px",triggerOnce:g=!0}={})=>{const[r,i]=e.useState(!1),o=e.useRef(null),s=e.useRef(null);return e.useEffect((()=>(o.current&&!s.current&&(s.current=new IntersectionObserver((([e])=>{const t=e.isIntersecting;i(t),t&&g&&s.current&&s.current.disconnect()}),{threshold:t,rootMargin:n}),s.current.observe(o.current)),()=>{s.current&&(s.current.disconnect(),s.current=null)})),[t,n,g]),[o,r]},Qe=({guestInfo:t=null,className:n="",animated:g=!0})=>{const[r,i]=e.useState(0),[o,s]=e.useState(1),[a,I]=ze({threshold:.3,triggerOnce:!0}),[l,C]=e.useState(null);e.useEffect((()=>{if(t&&t.group&&Ke.tables){const e=Ke.tables.find((e=>e.name.toLowerCase()===t.group.toLowerCase()));e&&C(e)}}),[t]),e.useEffect((()=>{if(!g)return;const e=()=>{const e=window.scrollY,t=Math.min(.2*e,150);i(t);const n=.6*window.innerHeight,g=1-Math.min(e/n,.6);s(g)};return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)}),[g]);const c=e=>({animationDelay:100*e+"ms"});return p.jsxs(p.Fragment,{children:[p.jsxs("header",{className:`relative overflow-hidden min-h-[90vh] flex flex-col justify-center ${n}`,children:[p.jsx("div",{className:"absolute inset-0 bg-primary/5 bg-floral-pattern opacity-15 z-0 hardware-accelerated",style:{backgroundSize:"cover",transform:`scale(1.1) translateY(${r}px)`,backgroundPosition:"center",transition:"transform 0.05s linear"}}),p.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[p.jsx("div",{className:"absolute top-1/4 left-1/2 -translate-x-1/2 w-96 h-96 rounded-full bg-gradient-radial from-accent/20 to-transparent blur-3xl animate-pulse-slow"}),p.jsx("div",{className:"absolute bottom-1/3 right-1/4 w-80 h-80 rounded-full bg-gradient-radial from-primary/10 to-transparent blur-3xl animate-pulse-slow",style:{animationDelay:"1.5s"}})]}),p.jsx("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[...Array(15)].map(((e,t)=>p.jsx("div",{className:"absolute rounded-full "+(t%3==0?"bg-primary/5":t%3==1?"bg-accent/5":"bg-secondary/5"),style:{width:12*Math.random()+3+"px",height:12*Math.random()+3+"px",top:5+90*Math.random()+"%",left:100*Math.random()+"%",opacity:.4+.6*Math.random(),animation:`float-particle ${5+15*Math.random()}s infinite ease-in-out`,animationDelay:5*Math.random()+"s"}},t)))}),p.jsxs("div",{className:"relative z-10 px-6 py-14 sm:py-20 text-center",style:{opacity:o},children:[p.jsx("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-40 opacity-20 animate-float-slow",children:p.jsx("svg",{viewBox:"0 0 100 30",fill:"currentColor",className:"text-primary",children:p.jsx("path",{d:"M50 0C45 10 35 15 25 15C35 15 45 20 50 30C55 20 65 15 75 15C65 15 55 10 50 0Z"})})}),p.jsxs("div",{className:"mb-10",children:[p.jsxs("p",{className:"text-muted font-elegant text-sm sm:text-base tracking-wide reveal-on-scroll "+(g?"is-revealed":""),style:c(0),children:[Ke.families.groomFamily," &"," ",Ke.families.brideFamily]}),p.jsx("p",{className:"text-primary font-sans text-sm sm:text-base tracking-widest uppercase mt-2 reveal-on-scroll "+(g?"is-revealed":""),style:c(1),children:"VOUS INVITENT AU MARIAGE DE"})]}),p.jsxs("div",{className:"mb-12 relative backdrop-blur-sm bg-white/5 py-8 px-6 rounded-xl shadow-elegant transform transition-all duration-500 hover:shadow-xl",children:[p.jsx("div",{className:"absolute inset-0 overflow-hidden rounded-xl",children:p.jsx("div",{className:"absolute -inset-x-1/4 -top-1/4 w-150 h-150 bg-gradient-conic from-primary/10 via-accent/5 to-primary/10 opacity-70 animate-slow-spin blur-3xl"})}),p.jsx("h1",{className:"font-cursive text-4xl sm:text-5xl md:text-6xl mb-4 select-none reveal-on-scroll "+(g?"is-revealed":""),style:c(2),children:p.jsxs("span",{className:"py-2 px-1 text-primary-dark relative",children:[Ke.couple.groom,p.jsx("span",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-primary/50 to-transparent transform"})]})}),p.jsxs("div",{className:"flex items-center justify-center my-4 reveal-on-scroll "+(g?"is-revealed":""),style:c(3),children:[p.jsx("div",{className:"h-px w-16 bg-accent/50"}),p.jsxs("div",{className:"mx-4 text-accent relative",children:[p.jsx("svg",{className:"w-8 h-8 animate-pulse-slow transform hover:scale-110 transition-transform",viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),p.jsx("div",{className:"absolute -inset-2 bg-accent/5 rounded-full blur-md animate-pulse-slow"})]}),p.jsx("div",{className:"h-px w-16 bg-accent/50"})]}),p.jsx("h1",{className:"font-cursive text-4xl sm:text-5xl md:text-6xl select-none reveal-on-scroll "+(g?"is-revealed":""),style:c(4),children:p.jsxs("span",{className:"py-2 px-1 text-primary-dark relative",children:[Ke.couple.bride,p.jsx("span",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-primary/50 to-transparent transform"})]})})]}),p.jsxs("div",{className:"mb-8 py-5 px-6 mx-auto max-w-sm rounded-lg reveal-on-scroll backdrop-blur-sm bg-gradient-to-r from-white/10 via-white/20 to-white/10 shadow-elegant "+(g?"is-revealed":""),style:c(5),children:[p.jsxs("p",{className:"font-elegant text-xl sm:text-2xl text-primary-dark mb-1",children:["Le ",Ke.event.date]}),p.jsxs("p",{className:"text-muted",children:["à ",Ke.event.venue]})]}),t&&p.jsx("div",{ref:a,className:"mt-10 p-6 rounded-xl mx-auto max-w-md reveal-on-scroll backdrop-blur-md bg-gradient-to-br from-white/20 to-white/10 shadow-elegant border border-white/10 transform transition-all duration-500 hover:-translate-y-1 hover:shadow-xl "+(I?"is-revealed":""),style:c(6),children:p.jsxs("p",{className:"font-elegant text-sm sm:text-base text-primary-dark italic relative",children:[p.jsx("span",{className:"absolute -top-4 -left-2 text-accent opacity-30 text-3xl",children:"“"}),t.message,p.jsx("span",{className:"absolute -bottom-4 -right-2 text-accent opacity-30 text-3xl",children:"”"})]})}),p.jsx("div",{className:`absolute ${t?"bottom-4 sm:bottom-8":"bottom-8"} left-1/2 transform -translate-x-1/2 mt-12 z-10`,children:p.jsxs("button",{className:"group flex flex-col items-center justify-center text-primary opacity-70 hover:opacity-100 transition-all bg-white/30 backdrop-blur-sm p-2 rounded-full shadow-sm",onClick:()=>document.getElementById("details").scrollIntoView({behavior:"smooth"}),"aria-label":"Défiler vers le bas",children:[p.jsx("span",{className:"text-xs uppercase tracking-widest mb-1 group-hover:transform group-hover:translate-y-1 transition-transform hidden sm:block",children:"Découvrir"}),p.jsxs("div",{className:"relative",children:[p.jsx("svg",{className:"w-7 h-7 sm:w-10 sm:h-10 animate-bounce-slow",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M19 14l-7 7m0 0l-7-7m7 7V3"})}),p.jsx("div",{className:"absolute inset-0 bg-primary/10 rounded-full blur-md opacity-0 group-hover:opacity-100 transition-opacity"})]})]})})]}),p.jsx("style",{children:"\n          .shadow-elegant {\n            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.05);\n          }\n          \n          .hardware-accelerated {\n            transform: translateZ(0);\n            will-change: transform;\n          }\n          \n          @keyframes float-particle {\n            0%, 100% {\n              transform: translateY(0) translateX(0);\n            }\n            50% {\n              transform: translateY(-20px) translateX(10px);\n            }\n          }\n          \n          .animate-float-slow {\n            animation: float 8s ease-in-out infinite;\n          }\n          \n          @keyframes float {\n            0%, 100% {\n              transform: translateY(0) translateX(-50%);\n            }\n            50% {\n              transform: translateY(-10px) translateX(-50%);\n            }\n          }\n          \n          .animate-pulse-slow {\n            animation: pulse 3s ease-in-out infinite;\n          }\n          \n          .animate-bounce-slow {\n            animation: bounce 2s ease-in-out infinite;\n          }\n          \n          .animate-slow-spin {\n            animation: spin 20s linear infinite;\n          }\n          \n          @keyframes pulse {\n            0%, 100% {\n              transform: scale(1);\n            }\n            50% {\n              transform: scale(1.1);\n            }\n          }\n          \n          @keyframes bounce {\n            0%, 100% {\n              transform: translateY(0);\n            }\n            50% {\n              transform: translateY(-10px);\n            }\n          }\n          \n          @keyframes spin {\n            from {\n              transform: rotate(0deg);\n            }\n            to {\n              transform: rotate(360deg);\n            }\n          }\n          \n          .reveal-on-scroll {\n            opacity: 0;\n            transform: translateY(20px);\n            transition: opacity 0.6s ease-out, transform 0.6s ease-out;\n          }\n          \n          .reveal-on-scroll.is-revealed {\n            opacity: 1;\n            transform: translateY(0);\n          }\n        "})]}),l&&p.jsx("div",{className:"py-6 px-4",children:p.jsx("div",{className:"max-w-3xl mx-auto",children:p.jsxs("div",{className:"rounded-2xl shadow-elegant p-6 backdrop-blur-sm border border-white/30 transform transition-all duration-500 hover:shadow-lg",style:{background:`linear-gradient(135deg, ${l.color}15, ${l.color}30)`,borderLeft:`4px solid ${l.color}`},children:[p.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-4",children:[p.jsxs("h3",{className:"font-elegant text-xl text-primary-dark mb-2 sm:mb-0 relative inline-block",children:[p.jsxs("span",{className:"flex items-center",children:[p.jsx("svg",{className:"w-6 h-6 mr-2",fill:"none",stroke:l.color,viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),p.jsxs("span",{style:{color:l.color},children:["Table ",l.name]})]}),p.jsx("span",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-primary/50 to-transparent transform scale-0 group-hover:scale-100 transition-transform duration-500"})]}),p.jsxs("span",{className:"text-sm font-medium px-3 py-1 rounded-full",style:{backgroundColor:`${l.color}20`,color:l.color},children:[l.count," invités"]})]}),p.jsxs("div",{className:"divide-y divide-primary/10",children:[t&&l.invites.map(((e,n)=>e.name.toLowerCase()===t.name.toLowerCase()?p.jsxs("div",{className:"py-3 flex justify-between items-center -mx-3 px-3 rounded-lg",style:{backgroundColor:`${l.color}15`},children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx("span",{className:"w-2 h-2 rounded-full mr-3",style:{backgroundColor:l.color}}),p.jsx("span",{className:"text-primary-dark",children:e.name})]}),p.jsxs("span",{className:"text-sm px-2 py-1 rounded-full text-muted",style:{backgroundColor:`${l.color}15`},children:[e.count," ",e.count>1?"personnes":"personne"]})]},n):null)),p.jsx("div",{className:"py-4 text-center mt-3",children:p.jsx("p",{className:"text-muted text-sm italic",children:t?`Vous partagerez cette table avec ${l.count-(t.count||1)} autres invités`:"Informations des invités masquées pour préserver leur confidentialité"})})]})]})})})]})};Qe.propTypes={guestInfo:Ue.shape({name:Ue.string.isRequired,count:Ue.number.isRequired,message:Ue.string.isRequired,group:Ue.string}),className:Ue.string,animated:Ue.bool};const Oe=({className:t=""})=>{const[n,g]=e.useState("date");return p.jsxs("section",{id:"details",className:`py-16 px-4 ${t} relative overflow-hidden`,children:[p.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full bg-gradient-radial from-primary/10 to-transparent z-0 blur-3xl"}),p.jsx("div",{className:"absolute bottom-20 -left-20 w-80 h-80 rounded-full bg-gradient-radial from-accent/10 to-transparent z-0 blur-3xl"}),p.jsx("div",{className:"absolute top-1/2 left-1/3 w-60 h-60 rounded-full bg-gradient-radial from-secondary/5 to-transparent z-0 blur-3xl opacity-60"}),p.jsxs("div",{className:"max-w-4xl mx-auto relative z-10",children:[p.jsxs("div",{className:"text-center mb-16 relative",children:[p.jsxs("h2",{className:"font-elegant text-3xl sm:text-4xl text-primary mb-4 relative inline-block",children:["Détails",p.jsx("div",{className:"absolute bottom-0 left-1/2 w-3/4 transform -translate-x-1/2 h-0.5 bg-gradient-to-r from-transparent via-accent to-transparent"})]}),p.jsx("p",{className:"text-muted text-sm max-w-md mx-auto leading-relaxed",children:"Nous serions honorés de votre présence lors de notre célébration"}),p.jsx("div",{className:"flex justify-center mt-8 md:hidden",children:p.jsxs("div",{className:"bg-white rounded-full shadow-elegant p-1.5 inline-flex transform hover:translate-y-px transition-transform",children:[p.jsx("button",{className:"py-2 px-6 rounded-full text-sm font-medium transition-all duration-300 "+("date"===n?"bg-gradient-to-r from-primary to-primary-dark text-white shadow-md":"text-primary-dark/70 hover:bg-primary/5"),onClick:()=>g("date"),children:"Date"}),p.jsx("button",{className:"py-2 px-6 rounded-full text-sm font-medium transition-all duration-300 "+("lieu"===n?"bg-gradient-to-r from-primary to-primary-dark text-white shadow-md":"text-primary-dark/70 hover:bg-primary/5"),onClick:()=>g("lieu"),children:"Lieu"})]})})]}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-10",children:[p.jsx("div",{className:"group transform transition-all duration-500 hover:-translate-y-2 "+("lieu"===n?"hidden md:block":""),children:p.jsxs("div",{className:"relative p-6 rounded-2xl bg-gradient-to-b from-white/95 to-white/80 shadow-elegant backdrop-blur-sm border border-white/30 overflow-hidden",children:[p.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 overflow-hidden",children:p.jsx("div",{className:"bg-primary/10 rotate-45 transform origin-bottom-left w-32 h-32 -translate-y-12 translate-x-6"})}),p.jsx("div",{className:"absolute -bottom-16 -left-16 w-32 h-32 rounded-full bg-gradient-radial from-primary/5 to-transparent blur-xl group-hover:opacity-80 transition-opacity"}),p.jsxs("div",{className:"text-center relative z-10",children:[p.jsx("div",{className:"inline-flex items-center justify-center w-18 h-18 rounded-full bg-gradient-to-br from-primary/20 to-primary/30 mb-5 shadow-inner group-hover:scale-110 transition-transform duration-500",children:p.jsx("svg",{className:"w-8 h-8 text-primary transform group-hover:rotate-12 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),p.jsxs("h3",{className:"font-elegant text-2xl text-primary-dark mb-4 relative inline-block",children:["Date & Heure",p.jsx("span",{className:"absolute bottom-0 left-0 w-full h-0.5 scale-0 group-hover:scale-100 bg-gradient-to-r from-transparent via-primary/50 to-transparent transition-transform duration-500"})]}),p.jsx("p",{className:"text-primary-dark font-semibold text-xl mb-2 bg-clip-text text-transparent bg-gradient-to-r from-primary to-accent inline-block",children:Ke.event.date}),p.jsxs("p",{className:"text-muted",children:["à ",Ke.event.time]}),p.jsxs("div",{className:"mt-8 space-y-4",children:[p.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[p.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/15 flex items-center justify-center",children:p.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),p.jsxs("div",{className:"flex flex-col items-start",children:[p.jsx("span",{className:"font-medium text-primary-dark",children:"19h00"}),p.jsx("span",{className:"text-xs text-muted",children:"Accueil des invités"})]})]}),p.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[p.jsx("div",{className:"w-10 h-10 rounded-full bg-accent/15 flex items-center justify-center",children:p.jsx("svg",{className:"w-5 h-5 text-accent",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 15.546c-.523 0-1.046.151-1.5.454a2.704 2.704 0 01-3 0 2.704 2.704 0 00-3 0 2.704 2.704 0 01-3 0 2.701 2.701 0 00-1.5-.454M9 6v2m3-2v2m3-2v2M9 3h.01M12 3h.01M15 3h.01M21 21v-7a2 2 0 00-2-2H5a2 2 0 00-2 2v7h18zm-3-9v-2a2 2 0 00-2-2H8a2 2 0 00-2 2v2h12z"})})}),p.jsxs("div",{className:"flex flex-col items-start",children:[p.jsx("span",{className:"font-medium text-primary-dark",children:"19h30"}),p.jsx("span",{className:"text-xs text-muted",children:"Début de la cérémonie"})]})]})]}),p.jsx("div",{className:"mt-8 bg-primary/5 rounded-xl p-5 border-l-2 border-primary/40 text-left",children:p.jsxs("div",{className:"flex",children:[p.jsx("svg",{className:"w-5 h-5 text-primary/70 mr-2 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),p.jsxs("div",{children:[p.jsx("p",{className:"text-sm text-primary-dark font-medium",children:"Arrivée recommandée à partir de 19h"}),p.jsx("p",{className:"text-xs text-muted mt-1",children:"Merci d'arriver à l'avance pour faciliter l'organisation"})]})]})})]})]})}),p.jsx("div",{className:"group transform transition-all duration-500 hover:-translate-y-2 "+("date"===n?"hidden md:block":""),children:p.jsxs("div",{className:"relative p-6 rounded-2xl bg-gradient-to-b from-white/95 to-white/80 shadow-elegant backdrop-blur-sm border border-white/30 overflow-hidden",children:[p.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 overflow-hidden",children:p.jsx("div",{className:"bg-primary/10 rotate-45 transform origin-bottom-left w-32 h-32 -translate-y-12 translate-x-6"})}),p.jsx("div",{className:"absolute -bottom-16 -left-16 w-32 h-32 rounded-full bg-gradient-radial from-accent/5 to-transparent blur-xl group-hover:opacity-80 transition-opacity"}),p.jsxs("div",{className:"text-center relative z-10",children:[p.jsx("div",{className:"inline-flex items-center justify-center w-18 h-18 rounded-full bg-gradient-to-br from-primary/20 to-primary/30 mb-5 shadow-inner group-hover:scale-110 transition-transform duration-500",children:p.jsxs("svg",{className:"w-8 h-8 text-primary transform group-hover:rotate-12 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),p.jsxs("h3",{className:"font-elegant text-2xl text-primary-dark mb-4 relative inline-block",children:["Lieu",p.jsx("span",{className:"absolute bottom-0 left-0 w-full h-0.5 scale-0 group-hover:scale-100 bg-gradient-to-r from-transparent via-primary/50 to-transparent transition-transform duration-500"})]}),p.jsx("p",{className:"text-primary-dark font-semibold text-xl mb-2 bg-clip-text text-transparent bg-gradient-to-r from-primary to-accent inline-block",children:Ke.event.venue}),p.jsx("p",{className:"text-muted mb-1",children:Ke.event.address}),p.jsxs("p",{className:"text-sm text-muted",children:[Ke.event.location,", ",Ke.event.city]}),p.jsxs("div",{className:"flex justify-center gap-4 mt-5",children:[p.jsx("button",{className:"flex items-center justify-center w-11 h-11 rounded-full bg-primary/10 text-primary hover:bg-primary/20 transition-colors transform hover:scale-110 transition-transform","aria-label":"Voir sur la carte",children:p.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})})}),p.jsx("button",{className:"flex items-center justify-center w-11 h-11 rounded-full bg-primary/10 text-primary hover:bg-primary/20 transition-colors transform hover:scale-110 transition-transform","aria-label":"Itinéraire Google Maps",children:p.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})})}),p.jsx("button",{className:"flex items-center justify-center w-11 h-11 rounded-full bg-primary/10 text-primary hover:bg-primary/20 transition-colors transform hover:scale-110 transition-transform","aria-label":"Partager le lieu",children:p.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})})]}),p.jsx("div",{className:"mt-8 bg-primary/5 rounded-xl p-5 border-l-2 border-primary/40",children:p.jsxs("div",{className:"flex items-start",children:[p.jsx("svg",{className:"w-5 h-5 text-primary/70 mr-2 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),p.jsxs("div",{className:"text-left",children:[p.jsxs("p",{className:"text-sm text-primary-dark",children:[p.jsx("span",{className:"font-medium",children:"Référence :"})," ",Ke.event.reference]}),p.jsx("p",{className:"text-xs text-muted mt-1",children:"Parking disponible sur place"})]})]})})]})]})})]}),p.jsxs("div",{className:"text-center mt-16 max-w-2xl mx-auto",children:[p.jsxs("div",{className:"p-8 rounded-2xl bg-gradient-to-br from-white/95 to-white/80 shadow-elegant backdrop-blur-sm border border-white/30 transform transition-all duration-500 hover:shadow-lg relative overflow-hidden",children:[p.jsx("div",{className:"absolute -inset-px bg-grid-pattern opacity-5"}),p.jsx("div",{className:"absolute top-0 right-0 -mt-8 -mr-8 w-32 h-32 rounded-full bg-gradient-radial from-primary/5 to-transparent blur-xl"}),p.jsx("div",{className:"absolute bottom-0 left-0 -mb-8 -ml-8 w-32 h-32 rounded-full bg-gradient-radial from-accent/5 to-transparent blur-xl"}),p.jsxs("div",{className:"relative",children:[p.jsx("svg",{className:"w-8 h-8 text-primary/40 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20",children:p.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),p.jsx("p",{className:"text-primary-dark font-elegant text-xl italic leading-relaxed",children:Ke.welcomeMessage})]})]}),p.jsx("div",{className:"mt-14 relative",children:p.jsxs("div",{className:"inline-block bg-gradient-to-b from-white/95 to-white/80 px-10 py-6 rounded-2xl shadow-elegant border border-white/30 transform transition-all duration-500 hover:shadow-lg backdrop-blur-sm",children:[p.jsx("div",{className:"absolute top-0 -mt-4 left-1/2 transform -translate-x-1/2 bg-primary/80 text-white text-xs uppercase tracking-widest py-1 px-4 rounded-full shadow-md",children:"Dress Code"}),p.jsx("p",{className:"text-primary-dark text-lg font-medium mt-3",children:Ke.dressCode}),p.jsxs("div",{className:"flex justify-center gap-4 mt-5",children:[p.jsx("span",{className:"w-5 h-5 rounded-full bg-primary/40 transition-all duration-300 hover:scale-125 hover:bg-primary/60"}),p.jsx("span",{className:"w-5 h-5 rounded-full bg-accent/40 transition-all duration-300 hover:scale-125 hover:bg-accent/60"}),p.jsx("span",{className:"w-5 h-5 rounded-full bg-secondary/40 transition-all duration-300 hover:scale-125 hover:bg-secondary/60"})]})]})})]})]}),p.jsx("style",{children:"\n        .shadow-elegant {\n          box-shadow: 0 10px 40px -5px rgba(0, 0, 0, 0.08);\n        }\n        \n        .shadow-inner {\n          box-shadow: inset 0 2px 6px 0 rgba(0, 0, 0, 0.05);\n        }\n        \n        .bg-grid-pattern {\n          background-image: linear-gradient(to right, rgba(0,0,0,0.05) 1px, transparent 1px),\n                            linear-gradient(to bottom, rgba(0,0,0,0.05) 1px, transparent 1px);\n          background-size: 20px 20px;\n        }\n      "})]})};Oe.propTypes={className:Ue.string};const je=({className:t=""})=>{const[n,g]=e.useState(null),[r,i]=e.useState(!1),o=e.useRef(null);return e.useEffect((()=>{Ke&&Ke.schedule&&Ke.schedule.forEach(((e,t)=>{0===t&&g(e.time)}))}),[]),e.useEffect((()=>{const e=new IntersectionObserver((([e])=>{i(e.isIntersecting)}),{threshold:.2});return o.current&&e.observe(o.current),()=>{o.current&&e.unobserve(o.current)}}),[]),p.jsxs("section",{id:"programme",ref:o,className:`py-16 px-4 ${t} relative overflow-hidden`,children:[p.jsx("div",{className:"absolute inset-0 z-0 bg-gradient-to-br from-white/90 to-white/95"}),p.jsx("div",{className:"absolute -top-40 -right-40 w-96 h-96 rounded-full bg-gradient-radial from-primary/10 to-transparent z-0 blur-3xl"}),p.jsx("div",{className:"absolute -bottom-40 -left-40 w-96 h-96 rounded-full bg-gradient-radial from-accent/10 to-transparent z-0 blur-3xl"}),p.jsx("div",{className:"absolute top-1/3 right-1/4 w-64 h-64 rounded-full bg-gradient-radial from-secondary/5 to-transparent z-0 blur-3xl opacity-60"}),p.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-[0.03] z-0"}),p.jsxs("div",{className:"max-w-4xl mx-auto relative z-10",children:[p.jsxs("div",{className:"text-center mb-16 transition-all duration-1000 "+(r?"opacity-100 transform translate-y-0":"opacity-0 transform translate-y-10"),children:[p.jsxs("h2",{className:"font-elegant text-3xl sm:text-4xl text-primary mb-4 relative inline-block",children:["Programme",p.jsx("div",{className:"absolute bottom-0 left-1/2 w-3/4 transform -translate-x-1/2 h-0.5 bg-gradient-to-r from-transparent via-accent to-transparent"})]}),p.jsx("p",{className:"text-muted text-sm max-w-md mx-auto leading-relaxed",children:"Découvrez les moments clés de notre célébration"})]}),p.jsxs("div",{className:"flex flex-col items-center",children:[p.jsx("div",{className:"block md:hidden w-full",children:p.jsxs("div",{className:"relative py-5 transition-all duration-1000 "+(r?"opacity-100":"opacity-0"),children:[p.jsx("div",{className:"absolute left-4 top-0 bottom-0 w-1 bg-gradient-to-b from-primary/30 via-accent/40 to-primary/30 rounded-full"}),Ke.schedule.map(((e,t)=>p.jsxs("div",{className:"relative mb-12 last:mb-0 transition-all duration-500 "+(n===e.time?"scale-100 opacity-100":"scale-95 opacity-70"),children:[p.jsxs("div",{className:"absolute left-4 w-8 h-8 transform -translate-x-1/2 -translate-y-1/2 flex items-center justify-center cursor-pointer z-20",onClick:()=>g(e.time),children:[p.jsx("span",{className:"w-3 h-3 rounded-full "+(n===e.time?"bg-accent animate-pulse-ring":"bg-primary/40")}),p.jsx("span",{className:"absolute w-8 h-8 rounded-full "+(n===e.time?"border-2 border-accent/40":"border border-primary/20")})]}),p.jsxs("div",{className:"ml-12 p-5 rounded-xl backdrop-blur-sm border border-white/50 shadow-elegant transition-all duration-500 transform hover:-translate-y-1 hover:shadow-xl "+(n===e.time?"bg-gradient-to-br from-white/90 to-white/80 border-accent/20":"bg-white/70"),onClick:()=>g(e.time),children:[p.jsxs("div",{className:"flex items-center justify-between mb-2",children:[p.jsx("span",{className:"font-elegant text-xl text-primary-dark",children:e.time}),p.jsx("span",{className:"text-xs rounded-full px-3 py-1 "+(n===e.time?"bg-accent/10 text-accent":"bg-primary/5 text-primary/70"),children:0===t?"Début":t===Ke.schedule.length-1?"Fin":`Étape ${t+1}`})]}),p.jsx("h3",{className:"font-medium text-lg text-primary-dark mb-2",children:e.title}),p.jsx("p",{className:"text-muted text-sm",children:e.description})]})]},e.time)))]})}),p.jsx("div",{className:"hidden md:block w-full",children:p.jsxs("div",{className:"relative transition-all duration-1000 "+(r?"opacity-100":"opacity-0"),children:[p.jsx("div",{className:"absolute top-12 left-0 right-0 h-1 bg-gradient-to-r from-primary/30 via-accent/40 to-primary/30 rounded-full"}),p.jsx("div",{className:"flex justify-between relative",children:Ke.schedule.map(((e,t)=>p.jsxs("div",{className:`w-1/${Ke.schedule.length} px-2 transition-all duration-500 ${n===e.time?"opacity-100":"opacity-70"}`,children:[p.jsxs("div",{className:"relative mx-auto w-8 h-8 flex items-center justify-center cursor-pointer z-20",onClick:()=>g(e.time),children:[p.jsx("span",{className:"w-3 h-3 rounded-full "+(n===e.time?"bg-accent animate-pulse-ring":"bg-primary/40")}),p.jsx("span",{className:"absolute w-8 h-8 rounded-full "+(n===e.time?"border-2 border-accent/40":"border border-primary/20")})]}),p.jsx("div",{className:"text-center mb-8 mt-2",onClick:()=>g(e.time),children:p.jsx("span",{className:"font-medium "+(n===e.time?"text-accent":"text-primary/70"),children:e.time})}),p.jsxs("div",{className:"p-5 rounded-xl backdrop-blur-sm transition-all duration-500 transform hover:-translate-y-1 hover:shadow-xl cursor-pointer border border-white/50 shadow-elegant "+(n===e.time?"bg-gradient-to-br from-white/90 to-white/80 border-accent/20":"bg-white/70"),onClick:()=>g(e.time),children:[p.jsx("span",{className:"text-xs rounded-full px-3 py-1 mb-3 inline-block "+(n===e.time?"bg-accent/10 text-accent":"bg-primary/5 text-primary/70"),children:0===t?"Début":t===Ke.schedule.length-1?"Fin":`Étape ${t+1}`}),p.jsx("h3",{className:"font-medium text-lg text-primary-dark mb-2",children:e.title}),p.jsx("p",{className:"text-muted text-sm",children:e.description})]})]},e.time)))})]})}),p.jsx("div",{className:"mt-16 max-w-2xl mx-auto text-center transition-all duration-1000 delay-300 "+(r?"opacity-100 transform translate-y-0":"opacity-0 transform translate-y-10"),children:p.jsxs("div",{className:"p-6 rounded-2xl bg-gradient-to-br from-white/95 to-white/80 shadow-elegant backdrop-blur-sm border border-white/30 transform transition-all duration-500 hover:shadow-lg relative overflow-hidden",children:[p.jsx("div",{className:"absolute -inset-px bg-grid-pattern opacity-5"}),p.jsx("div",{className:"absolute top-0 right-0 -mt-8 -mr-8 w-32 h-32 rounded-full bg-gradient-radial from-primary/5 to-transparent blur-xl"}),p.jsx("div",{className:"absolute bottom-0 left-0 -mb-8 -ml-8 w-32 h-32 rounded-full bg-gradient-radial from-accent/5 to-transparent blur-xl"}),p.jsxs("div",{className:"relative",children:[p.jsx("svg",{className:"w-8 h-8 text-primary/40 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),p.jsx("p",{className:"text-primary-dark font-elegant text-xl italic leading-relaxed",children:"Nous vous invitons à respecter les horaires pour que cette journée soit aussi parfaite pour vous que pour nous."}),p.jsx("div",{className:"mt-6 flex justify-center",children:p.jsxs("a",{href:"#details",className:"inline-flex items-center px-5 py-2 rounded-full bg-primary/10 text-primary hover:bg-primary/20 transition-colors group",children:[p.jsx("svg",{className:"w-4 h-4 mr-2 group-hover:animate-bounce",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Voir plus de détails"]})})]})]})})]})]}),p.jsx("style",{jsx:!0,children:"\n        .shadow-elegant {\n          box-shadow: 0 10px 40px -5px rgba(0, 0, 0, 0.08);\n        }\n\n        .bg-grid-pattern {\n          background-image: linear-gradient(\n              to right,\n              rgba(0, 0, 0, 0.05) 1px,\n              transparent 1px\n            ),\n            linear-gradient(to bottom, rgba(0, 0, 0, 0.05) 1px, transparent 1px);\n          background-size: 20px 20px;\n        }\n\n        @keyframes pulse-ring {\n          0% {\n            box-shadow: 0 0 0 0 rgba(var(--color-accent-rgb), 0.7);\n          }\n          70% {\n            box-shadow: 0 0 0 6px rgba(var(--color-accent-rgb), 0);\n          }\n          100% {\n            box-shadow: 0 0 0 0 rgba(var(--color-accent-rgb), 0);\n          }\n        }\n\n        .animate-pulse-ring {\n          animation: pulse-ring 2s infinite;\n        }\n      "})]})};je.propTypes={className:Ue.string};const Pe=({children:e,variant:t="primary",size:n="md",className:g="",onClick:r,disabled:i=!1,fullWidth:o=!1,type:s="button",icon:a=null,iconPosition:I="left"})=>{const l={primary:"bg-primary text-white hover:bg-primary-dark focus:ring-primary-light",secondary:"bg-secondary text-primary hover:bg-gray-100 focus:ring-secondary",outline:"border border-primary text-primary hover:bg-primary hover:bg-opacity-10 focus:ring-primary",text:"text-primary hover:bg-gray-100 hover:bg-opacity-20 focus:ring-primary",accent:"bg-accent text-white hover:bg-accent/90 focus:ring-accent/50",danger:"bg-danger text-white hover:bg-danger/90 focus:ring-danger/50",success:"bg-success text-white hover:bg-success/90 focus:ring-success/50"},C={sm:"text-xs py-2 px-3",md:"text-sm py-2.5 px-4",lg:"text-base py-3 px-5"},c=`\n    inline-flex items-center justify-center rounded-lg font-medium transition-all duration-300 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2\n    ${l[t]||l.primary}\n    ${C[n]||C.md}\n    ${i?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n    ${o?"w-full":""}\n    ${g}\n  `.trim();return p.jsxs("button",{type:s,className:c,onClick:r,disabled:i,children:[a&&"left"===I&&p.jsx("span",{className:"mr-2",children:a}),e,a&&"right"===I&&p.jsx("span",{className:"ml-2",children:a})]})};Pe.propTypes={children:Ue.node.isRequired,variant:Ue.oneOf(["primary","secondary","outline","text","accent","danger","success"]),size:Ue.oneOf(["sm","md","lg"]),className:Ue.string,onClick:Ue.func,disabled:Ue.bool,fullWidth:Ue.bool,type:Ue.oneOf(["button","submit","reset"]),icon:Ue.node,iconPosition:Ue.oneOf(["left","right"])};const _e=({children:e,animation:t="fade-up",threshold:n=.1,rootMargin:g="0px",once:r=!0,delay:i=0,className:o=""})=>{const[s,a]=ze({threshold:n,rootMargin:g,triggerOnce:r});return p.jsx("div",{ref:s,className:`transition-all duration-700 ease-out ${o} ${(()=>{switch(t){case"fade-up":return"opacity-0 translate-y-6";case"fade-down":return"opacity-0 -translate-y-6";case"fade-left":return"opacity-0 translate-x-6";case"fade-right":return"opacity-0 -translate-x-6";case"zoom-in":return"opacity-0 scale-95";case"zoom-out":return"opacity-0 scale-105";default:return"opacity-0"}})()}`,style:{transform:a?"translate(0, 0) scale(1)":void 0,opacity:a?1:0,transitionDelay:`${i}ms`},children:e})};_e.propTypes={children:Ue.node.isRequired,animation:Ue.oneOf(["fade-up","fade-down","fade-left","fade-right","zoom-in","zoom-out","fade"]),threshold:Ue.number,rootMargin:Ue.string,once:Ue.bool,delay:Ue.number,className:Ue.string};const qe=({src:t,title:n="Google Maps",className:g="",iframeClassName:r="",lazyLoad:i=!0,onLoad:o,onError:s})=>{const[a,I]=e.useState(!0),[l,C]=e.useState(!1),[c,d]=e.useState(!i),[u,A]=e.useState(0),h=e.useRef(null),m=`map-container-${n.replace(/\s+/g,"-").toLowerCase()}`;e.useEffect((()=>{if(!i)return;const e=new IntersectionObserver((t=>{t[0].isIntersecting&&(d(!0),e.disconnect())}),{threshold:.1,rootMargin:"300px"}),t=document.getElementById(m);return t&&e.observe(t),()=>{t&&e.disconnect()}}),[i,m]);return p.jsxs("div",{id:m,className:`relative ${g}`,ref:h,children:[c&&p.jsx("iframe",{src:t,title:n,className:`border-0 ${r}`,allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",onLoad:()=>{I(!1),o&&o()},onError:()=>{C(!0),I(!1),s&&s(),u<3&&(A((e=>e+1)),setTimeout((()=>{d(!0),I(!0),C(!1)}),2e3*(u+1)))}}),a&&p.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:p.jsxs("div",{className:"flex flex-col items-center",children:[p.jsx("div",{className:"w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin mb-3"}),p.jsx("p",{className:"text-sm text-primary-dark animate-pulse",children:"Chargement de la carte..."})]})}),l&&u>=3&&p.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:p.jsxs("div",{className:"text-center p-4",children:[p.jsx("p",{className:"text-red-500 mb-2",children:"Impossible de charger la carte"}),p.jsx("button",{onClick:()=>{A(0),d(!0),I(!0),C(!1)},className:"text-primary hover:text-primary-dark underline",children:"Réessayer"})]})})]})};qe.propTypes={src:Ue.string.isRequired,title:Ue.string,className:Ue.string,iframeClassName:Ue.string,lazyLoad:Ue.bool,onLoad:Ue.func,onError:Ue.func};const $e={lat:"-4.349492299999992",lng:"15.284177500000002",name:"Inga",city:"Kinshasa",country:"RD Congo"},et="https://www.google.com/maps/embed/v1/place?key=AIzaSyBFw0Qbyq9zTFTd-tUY6dZWTgaQzuU17R8&q=Inga,Kinshasa&zoom=13&maptype=roadmap",tt=e=>{const t=encodeURIComponent(`${e.name} - ${e.address}`),{lat:n,lng:g}=$e;return{googleMaps:`https://www.google.com/maps/dir/?api=1&destination=${n},${g}&travelmode=driving&dir_action=navigate`,yango:`https://yango.go.link/route?end-lat=${n}&end-lon=${g}&ref=weddingapp&adj_t=vokme8e_nd9s9z9&lang=fr&adj_deeplink_js=1&adj_fallback=https%3A%2F%2Fyango.com%2Ffr_int%2Forder%2F%3Fgto%3D${g}%2C${n}%26ref%3Dweddingapp`,appleMaps:`https://maps.apple.com/?daddr=${n},${g}&dirflg=d&t=m`,uber:`https://m.uber.com/ul/?action=setPickup&pickup=my_location&dropoff[latitude]=${n}&dropoff[longitude]=${g}&dropoff[nickname]=${t}`}},nt=({className:t=""})=>{const[n,g]=e.useState(!1),r=tt(Ke.event);return p.jsx("div",{className:`mt-6 ${t}`,children:p.jsxs(_e,{animation:"fade-up",delay:100,children:[p.jsxs("div",{className:"flex justify-between items-center mb-3",children:[p.jsx("h4",{className:"font-elegant text-xl text-primary-dark",children:"Options de navigation"}),p.jsx("button",{className:"text-primary text-sm underline",onClick:()=>g(!n),children:n?"Masquer les détails":"Plus d&apos;options"})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[p.jsxs("a",{href:r.googleMaps,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 bg-white p-3 rounded-lg shadow-soft text-primary-dark hover:bg-highlight transition-colors",children:[p.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/b/bd/Google_Maps_Logo_2020.svg/512px-Google_Maps_Logo_2020.svg.png",alt:"Google Maps",className:"h-5"}),p.jsx("span",{className:"font-medium text-sm",children:"Google Maps"})]}),p.jsxs("a",{href:r.yango,target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-2 bg-white p-3 rounded-lg shadow-soft text-primary-dark hover:bg-highlight transition-colors",children:[p.jsxs("svg",{className:"w-5 h-5 text-[#FF0033]",viewBox:"0 0 24 24",fill:"currentColor",children:[p.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),p.jsx("path",{d:"M11 7h2v7h-2zm-1 8h4v2h-4z"})]}),p.jsx("span",{className:"font-medium text-sm",children:"Yango"})]})]}),n&&p.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-soft space-y-4 animate-fade-in",children:[p.jsxs("div",{children:[p.jsx("h5",{className:"text-primary-dark font-medium text-sm mb-2",children:"Autres services"}),p.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[p.jsxs("a",{href:r.appleMaps,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 rounded border border-primary/10 hover:bg-primary/5",children:[p.jsx("svg",{className:"w-4 h-4 text-primary",viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M12.2 0c.59 0 1.49.16 2.4.46 1.35.45 2.53 1.33 3.34 2.44.52.71.92 1.55 1.16 2.43 0 0-2.41.84-2.39 3.05 0 2.44 2.14 3.27 2.14 3.27-.14.46-.35.98-.63 1.5-.42.77-.96 1.57-1.67 1.57-.7 0-.94-.44-1.74-.44-.8 0-1.06.44-1.74.44-.7 0-1.24-.8-1.67-1.56-.73-1.33-1.27-3.32-1.27-5.27 0-3.07 2-4.67 3.83-4.67.95 0 1.69.44 2.24.44.55 0 1.32-.44 2.24-.44.35 0 .94.09 1.57.29-1.33.7-2.24 2.09-2.24 3.67 0 1.77.99 3.18 2.43 3.87-.43 1.27-1.09 2.5-1.9 3.39M8.37 24c1.2 0 1.71-1.88 3.11-1.88 1.4 0 2.8 1.88 3.05 1.88.1 0 .21-.02.21-.12 0-.11-.24-.67-.37-.9-.12-.23-.23-.37-.32-.62-.96-2.58-.56-3.12-.1-4.95.45-1.73 2.2-3.01 2.2-3.01 0-.02-.06-.04-.06-.04-.37.05-.76.14-1.08.27-.33.13-.7.3-1 .3-.33 0-.71-.17-1.13-.25-.42-.08-.86-.15-1.18-.15-2.69 0-4.5 2.88-4.5 5.83 0 1.17.22 2.13.49 2.79.26.67.67.85.68.85"})}),p.jsx("span",{className:"text-xs",children:"Apple Plans"})]}),p.jsxs("a",{href:r.uber,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-2 rounded border border-primary/10 hover:bg-primary/5",children:[p.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M12 0C5.37 0 0 5.37 0 12s5.37 12 12 12 12-5.37 12-12S18.63 0 12 0zm0 22c-5.52 0-10-4.48-10-10S6.48 2 12 2s10 4.48 10 10-4.48 10-10 10zm4.59-16H7.42c-.32 0-.59.26-.59.58v8.84c0 .32.26.58.58.58h9.17c.33 0 .59-.26.59-.58V6.58c0-.32-.26-.58-.58-.58zM11 14.8v-3.38c0-.28.24-.42.5-.28l2.92 1.7c.26.14.26.44.02.59l-2.92 1.7c-.28.14-.52-.02-.52-.33z"})}),p.jsx("span",{className:"text-xs",children:"Uber"})]})]})]}),p.jsxs("div",{children:[p.jsx("h5",{className:"text-primary-dark font-medium text-sm mb-2",children:"Transport public"}),p.jsx("p",{className:"text-muted text-xs",children:'Plusieurs lignes de bus desservent la zone. Descendez à l\'arrêt "Terrain Municipal" et marchez environ 5 minutes.'})]}),p.jsxs("div",{children:[p.jsx("h5",{className:"text-primary-dark font-medium text-sm mb-2",children:"Parking"}),p.jsx("p",{className:"text-muted text-xs",children:"Un parking gratuit est disponible sur place avec environ 50 places. Des parkings payants se trouvent également à proximité (environ 2000 FC pour la journée)."})]}),p.jsxs("div",{children:[p.jsx("h5",{className:"text-primary-dark font-medium text-sm mb-2",children:"Contact venue"}),p.jsx("a",{href:"tel:+243123456789",className:"text-primary text-xs underline",children:"+243 12 345 6789"})]}),p.jsx(Pe,{variant:"outline",size:"sm",onClick:()=>g(!1),className:"w-full mt-2",children:"Masquer les détails"})]})]})})};nt.propTypes={className:Ue.string};const gt=({className:t=""})=>{const n=tt(Ke.event),g=((e,t)=>{const{lat:n,lng:g,name:r,city:i,country:o}=$e;return`https://wa.me/?text=${encodeURIComponent(`📍 Lieu du mariage de ${t.groom} et ${t.bride}:\n\n${r}, ${e.address}\n${i}, ${o}\n\n🗺️ Itinéraire: https://www.google.com/maps/dir/?api=1&destination=${n},${g}&travelmode=driving`)}`})(Ke.event,Ke.couple),r=e.useRef(null),[i,o]=e.useState(0),[s,a]=e.useState(!1),[I,l]=e.useState(null),[C,c]=e.useState(!1);e.useEffect((()=>{const e=()=>{if(!r.current)return;const{top:e}=r.current.getBoundingClientRect(),t=window.innerHeight,n=(t-e)/t;n>0&&n<1.5&&o(40*n)};return window.addEventListener("scroll",e,{passive:!0}),e(),()=>{window.removeEventListener("scroll",e)}}),[]);return p.jsxs("section",{id:"lieu",ref:r,className:`py-16 px-4 ${t} relative overflow-hidden`,children:[p.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/80 to-white/95 z-0"}),p.jsx("div",{className:"absolute -top-20 -right-20 w-80 h-80 rounded-full bg-gradient-radial from-primary/10 to-transparent blur-3xl z-0",style:{transform:`translate3d(${.8*i}px, ${-.5*i}px, 0)`,transition:"transform 0.2s ease-out",opacity:.7}}),p.jsx("div",{className:"absolute -bottom-40 -left-20 w-96 h-96 rounded-full bg-gradient-radial from-accent/10 to-transparent blur-3xl z-0",style:{transform:`translate3d(${-.6*i}px, ${.4*i}px, 0)`,transition:"transform 0.2s ease-out",opacity:.6}}),p.jsx("div",{className:"absolute top-1/3 left-1/4 w-32 h-32 rounded-full bg-gradient-radial from-secondary/10 to-transparent blur-2xl z-0",style:{transform:`translate3d(${1.2*i}px, ${.7*i}px, 0)`,transition:"transform 0.15s ease-out",opacity:.4}}),p.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-[0.03] z-0"}),p.jsxs("div",{className:"max-w-4xl mx-auto relative z-10",children:[p.jsx(_e,{animation:"fade-up",children:p.jsxs("div",{className:"text-center mb-14",children:[p.jsxs("h2",{className:"font-elegant text-3xl sm:text-4xl text-primary mb-4 relative inline-block",children:["Localisation",p.jsx("div",{className:"absolute bottom-0 left-1/2 w-3/4 transform -translate-x-1/2 h-0.5 bg-gradient-to-r from-transparent via-accent to-transparent"})]}),p.jsx("p",{className:"text-muted text-sm max-w-md mx-auto",children:"Retrouvez-nous facilement grâce à la carte interactive"})]})}),p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-8",children:[p.jsxs(_e,{animation:"fade-right",className:"md:col-span-3 "+(C?"md:col-span-5":""),children:[p.jsxs("div",{className:`relative rounded-2xl overflow-hidden shadow-elegant transition-all duration-700 ${C?"h-[500px] z-50":"h-[300px] sm:h-[350px] md:h-[400px]"} ${s?"opacity-100":"opacity-80"}`,children:[p.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-primary/5 to-transparent pointer-events-none z-10"}),p.jsx("div",{className:"absolute top-0 left-0 right-0 h-8 bg-gradient-to-b from-white/20 to-transparent pointer-events-none z-10"}),!s&&p.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/60 backdrop-blur-sm z-20",children:[p.jsxs("div",{className:"w-16 h-16 mb-4 relative",children:[p.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-primary/20"}),p.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-transparent border-t-primary animate-spin"})]}),p.jsx("p",{className:"text-sm text-primary-dark animate-pulse",children:"Chargement de la carte..."})]}),p.jsx(qe,{src:et,title:"Carte du lieu de mariage",className:"w-full h-full",onLoad:()=>a(!0),onError:()=>{a(!0)},iframeClassName:"w-full h-full",lazyLoad:!0}),p.jsxs("button",{className:"absolute bottom-4 right-4 bg-white/90 hover:bg-white px-3 py-2 rounded-lg shadow-md text-primary-dark text-sm flex items-center transform transition-all duration-300 hover:scale-105 hover:shadow-lg backdrop-blur-sm z-20 group",onClick:()=>{c(!C)},children:[p.jsx("svg",{className:"w-4 h-4 mr-2 transition-transform duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{transform:C?"rotate(180deg)":"rotate(0deg)"},children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"})}),C?"Réduire":"Agrandir",p.jsx("span",{className:"absolute inset-0 rounded-lg bg-primary/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]}),p.jsx("div",{className:"mt-5 block md:hidden "+(C?"hidden":""),children:p.jsx(nt,{className:"rounded-xl bg-white/80 backdrop-blur-sm shadow-elegant p-4 border border-white/30"})})]}),p.jsx(_e,{animation:"fade-left",className:"md:col-span-2 "+(C?"hidden":""),children:p.jsxs("div",{className:"flex flex-col justify-between h-full bg-gradient-to-b from-white/95 to-white/80 p-6 rounded-2xl shadow-elegant backdrop-blur-sm border border-white/30",children:[p.jsxs("div",{children:[p.jsxs("h3",{className:"font-elegant text-2xl text-primary-dark mb-4 relative inline-block",children:[Ke.event.venue,p.jsx("span",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-transparent via-primary/50 to-transparent"})]}),p.jsx("p",{className:"text-primary-dark font-medium mb-2",children:Ke.event.address}),p.jsxs("p",{className:"text-muted text-sm mb-6",children:[Ke.event.location,", ",Ke.event.city]}),p.jsxs("div",{className:"bg-primary/5 p-5 rounded-xl mb-6 border-l-2 border-primary/30",children:[p.jsxs("h4",{className:"font-medium text-primary-dark mb-4 flex items-center",children:[p.jsx("svg",{className:"w-5 h-5 mr-2 text-primary/70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Informations pratiques"]}),p.jsxs("ul",{className:"text-muted text-sm space-y-3",children:[p.jsxs("li",{className:"flex items-start group cursor-default",children:[p.jsx("div",{className:"w-7 h-7 rounded-full bg-primary/10 flex items-center justify-center mr-3 flex-shrink-0 transform transition-all duration-300 group-hover:scale-110 group-hover:bg-primary/20",children:p.jsx("svg",{className:"w-4 h-4 text-primary transform transition-all duration-300 group-hover:rotate-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),p.jsx("span",{className:"transform transition-all duration-300 group-hover:translate-x-1",children:"Parking disponible à proximité"})]}),p.jsxs("li",{className:"flex items-start group cursor-default",children:[p.jsx("div",{className:"w-7 h-7 rounded-full bg-primary/10 flex items-center justify-center mr-3 flex-shrink-0 transform transition-all duration-300 group-hover:scale-110 group-hover:bg-primary/20",children:p.jsx("svg",{className:"w-4 h-4 text-primary transform transition-all duration-300 group-hover:rotate-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),p.jsxs("span",{className:"transform transition-all duration-300 group-hover:translate-x-1",children:["Référence: ",Ke.event.reference]})]}),p.jsxs("li",{className:"flex items-start group cursor-default",children:[p.jsx("div",{className:"w-7 h-7 rounded-full bg-primary/10 flex items-center justify-center mr-3 flex-shrink-0 transform transition-all duration-300 group-hover:scale-110 group-hover:bg-primary/20",children:p.jsx("svg",{className:"w-4 h-4 text-primary transform transition-all duration-300 group-hover:rotate-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),p.jsx("span",{className:"transform transition-all duration-300 group-hover:translate-x-1",children:"Accessible aux personnes à mobilité réduite"})]})]})]}),p.jsx("div",{className:"hidden md:block",children:p.jsx(nt,{className:"rounded-xl bg-gradient-to-r from-white/40 to-white/60 backdrop-blur-sm shadow-sm p-4"})})]}),p.jsxs("div",{className:"space-y-3 mt-6",children:[p.jsx(Pe,{variant:"primary",fullWidth:!0,icon:p.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),onClick:()=>{l("navigate"),window.open(n.googleMaps,"_blank"),setTimeout((()=>l(null)),2e3)},className:"transform transition-all duration-500 hover:-translate-y-1 hover:shadow-lg "+("navigate"===I?"pulse-once bg-primary-dark":""),children:"Obtenir l'itinéraire"}),p.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[p.jsx(Pe,{variant:"outline",icon:p.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M17.498 14.382c-.301-.15-1.767-.867-2.04-.966-.273-.101-.473-.151-.673.15-.197.295-.771.964-.944 1.162-.175.195-.349.21-.646.075-.3-.15-1.263-.465-2.403-1.485-.888-.795-1.484-1.77-1.66-2.07-.174-.3-.019-.465.13-.615.136-.135.301-.345.451-.523.146-.181.194-.301.297-.496.1-.21.049-.375-.025-.524-.075-.15-.672-1.62-.922-2.206-.24-.584-.487-.51-.672-.51-.172-.015-.371-.015-.571-.015-.2 0-.523.074-.797.359-.273.3-1.045 1.02-1.045 2.475s1.07 2.865 1.219 3.075c.149.195 2.105 3.195 5.1 4.485.714.3 1.27.48 1.704.629.714.227 1.365.195 1.88.121.574-.091 1.767-.721 2.016-1.426.255-.705.255-1.29.18-1.425-.074-.135-.27-.21-.57-.345M12 21.594c-1.349 0-2.68-.213-3.934-.638l-.285-.135-2.91.776.791-2.891-.149-.294a10.856 10.856 0 01-.69-3.996c0-6.01 4.935-10.897 10.989-10.897 2.94 0 5.7 1.15 7.769 3.223a10.816 10.816 0 013.234 7.75c0 6.011-4.935 10.904-10.989 10.904M20.415 3.549a12.987 12.987 0 00-9.245-3.829C4.91-.27-.085 8.816-.085 19.201c0 2.146.42 4.246 1.235 6.204l-1.485 5.406 5.55-1.441c1.875.713 3.906 1.095 5.97 1.095 6.259 0 11.255-9.086 11.255-19.472 0-3.465-1.35-6.769-3.786-9.241"})}),onClick:()=>{l("share"),window.open(g,"_blank"),setTimeout((()=>l(null)),2e3)},className:"transform transition-all duration-500 hover:-translate-y-1 hover:shadow-lg "+("share"===I?"pulse-once text-green-600 border-green-300 bg-green-50":""),children:"Partager"}),p.jsx(Pe,{variant:"outline",icon:"copy"===I?p.jsx("svg",{className:"w-5 h-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}):p.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"})}),onClick:()=>{l("copy");const e=`${Ke.event.venue}, ${Ke.event.address}, ${Ke.event.city}`;navigator.clipboard.writeText(e).then((()=>{setTimeout((()=>l(null)),2e3)})).catch((e=>{setTimeout((()=>l(null)),2e3)}))},className:"transform transition-all duration-500 hover:-translate-y-1 hover:shadow-lg "+("copy"===I?"text-green-600 border-green-300 bg-green-50":""),children:"copy"===I?"Copié !":"Copier"})]})]})]})})]})]}),p.jsx("style",{children:"\n        .shadow-elegant {\n          box-shadow: 0 10px 40px -5px rgba(0, 0, 0, 0.08);\n        }\n        \n        .bg-grid-pattern {\n          background-image: linear-gradient(to right, rgba(0,0,0,0.05) 1px, transparent 1px),\n                            linear-gradient(to bottom, rgba(0,0,0,0.05) 1px, transparent 1px);\n          background-size: 20px 20px;\n        }\n        \n        @keyframes pulse-animation {\n          0% {\n            box-shadow: 0 0 0 0 rgba(var(--color-primary-rgb), 0.7);\n          }\n          70% {\n            box-shadow: 0 0 0 10px rgba(var(--color-primary-rgb), 0);\n          }\n          100% {\n            box-shadow: 0 0 0 0 rgba(var(--color-primary-rgb), 0);\n          }\n        }\n        \n        .pulse-once {\n          animation: pulse-animation 1s;\n        }\n      "})]})};gt.propTypes={className:Ue.string};const rt=()=>{const{guestId:t}=function(){let{matches:t}=e.useContext(ae),n=t[t.length-1];return n?n.params:{}}(),n=de(),[g,r]=e.useState(null),[i,o]=e.useState(!0),[s,a]=e.useState(!1),[I,l]=e.useState("accueil"),[C,c]=e.useState(0);e.useEffect((()=>{const e=()=>{try{if(!t)return a(!0),void o(!1);const e=(e=>{const[t,...n]=e.split("_"),g=n.join("_");for(const r in Te)if(r.replace(/\s+/g,"-").toLowerCase()===t){const e=Te[r].find((e=>e.name.replace(/\s+/g,"-").toLowerCase()===g));if(e)return{...e,group:r}}return null})(t);if(!e)return a(!0),void o(!1);r(e),o(!1)}catch(e){a(!0),o(!1)}},n=setTimeout((()=>{e()}),1e3);return()=>clearTimeout(n)}),[t]),e.useEffect((()=>{const e=()=>{const e=window.scrollY,t=document.documentElement.scrollHeight-window.innerHeight;c(e/t);const n=["accueil","details","programme","lieu"];let g=I;for(const r of n){const e=document.getElementById(r);if(e){const t=e.getBoundingClientRect();if(t.top<=100&&t.bottom>=100){g=r;break}}}g!==I&&l(g)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[I]);if(i)return p.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-primary/5 to-secondary/10",children:[p.jsxs("div",{className:"relative w-24 h-24 flex items-center justify-center mb-6",children:[p.jsx("svg",{className:"absolute w-24 h-24 text-primary/20",viewBox:"0 0 100 100",fill:"none",stroke:"currentColor",strokeWidth:"4",children:p.jsx("circle",{cx:"50",cy:"50",r:"44"})}),p.jsx("svg",{className:"absolute w-24 h-24 text-primary animate-spin",viewBox:"0 0 100 100",fill:"none",stroke:"currentColor",strokeWidth:"4",strokeDasharray:"69 200",children:p.jsx("circle",{cx:"50",cy:"50",r:"44"})}),p.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:p.jsx("svg",{className:"w-10 h-10 text-primary/70",viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})})]}),p.jsx("p",{className:"text-primary-dark font-elegant text-2xl animate-pulse mb-2",children:"Un instant..."}),p.jsx("p",{className:"text-muted text-center max-w-md px-4",children:"Nous préparons votre invitation personnalisée"})]});if(s)return p.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-primary/5 to-secondary/10 px-4",children:[p.jsx("div",{className:"w-20 h-20 flex items-center justify-center mb-6 text-danger bg-danger/10 rounded-full",children:p.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),p.jsx("h1",{className:"text-primary-dark font-elegant text-3xl text-center mb-4",children:"Invitation non trouvée"}),p.jsx("p",{className:"text-muted text-center max-w-md mb-8",children:"Désolé, nous n'avons pas pu trouver votre invitation personnalisée. Veuillez vérifier l'URL ou contacter les mariés."}),p.jsx(Pe,{variant:"primary",onClick:()=>n("/"),className:"shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300",children:"Retour à l'accueil"})]});const d={accueil:p.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),details:p.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),programme:p.jsx("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),lieu:p.jsxs("svg",{className:"w-5 h-5 mb-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})};return p.jsxs("div",{className:"bg-gradient-to-br from-secondary/5 to-secondary/20 min-h-screen relative",children:[p.jsx("div",{className:"fixed top-0 left-0 right-0 h-1 z-50",children:p.jsx("div",{className:"h-full bg-primary transition-all duration-300 ease-out",style:{width:100*C+"%"}})}),p.jsx("nav",{className:"fixed bottom-0 left-0 right-0 bg-white shadow-lg pb-safe-area-inset-bottom z-40 sm:top-0 sm:bottom-auto transition-transform duration-300",children:p.jsx("div",{className:"max-w-3xl mx-auto",children:p.jsx("div",{className:"flex items-center justify-between px-2 py-3",children:["accueil","details","programme","lieu"].map((e=>p.jsxs("button",{className:"flex flex-col items-center px-3 py-1.5 rounded-lg transition-all duration-300 "+(I===e?"text-primary bg-primary/10 transform scale-105":"text-muted hover:text-primary/70 hover:bg-primary/5"),onClick:()=>(e=>{l(e);const t=document.getElementById(e);t&&window.scrollTo({top:t.offsetTop-60,behavior:"smooth"})})(e),"aria-label":`Aller à la section ${e}`,"aria-current":I===e?"page":void 0,children:[d[e],p.jsx("span",{className:"text-xs font-medium capitalize",children:e})]},e)))})})}),p.jsxs("div",{className:"pt-0 pb-20 sm:pb-0 sm:pt-16 overflow-hidden",children:[p.jsx("div",{id:"accueil",className:"min-h-[90vh] flex items-center transition-opacity duration-700",style:{opacity:"accueil"===I?1:.8},children:p.jsx("div",{className:"w-full",children:p.jsx(Qe,{guestInfo:g})})}),p.jsx("div",{id:"details",className:"scroll-mt-16 transition-opacity duration-700",style:{opacity:"details"===I?1:.8},children:p.jsx(Oe,{})}),p.jsx("div",{id:"programme",className:"scroll-mt-16 transition-opacity duration-700",style:{opacity:"programme"===I?1:.8},children:p.jsx(je,{})}),p.jsx("div",{id:"lieu",className:"scroll-mt-16 transition-opacity duration-700",style:{opacity:"lieu"===I?1:.8},children:p.jsx(gt,{})})]}),p.jsxs("footer",{className:"bg-primary text-white py-10 px-4 text-center relative overflow-hidden",children:[p.jsx("div",{className:"absolute inset-0 opacity-10",children:p.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[p.jsx("path",{d:"M0,0 L100,0 L100,100 L0,100 Z",fill:"none",stroke:"currentColor",strokeWidth:"2"}),p.jsx("path",{d:"M0,50 L100,50",stroke:"currentColor",strokeWidth:"1"}),p.jsx("path",{d:"M50,0 L50,100",stroke:"currentColor",strokeWidth:"1"})]})}),p.jsxs("div",{className:"relative z-10",children:[p.jsxs("p",{className:"font-elegant text-2xl mb-3",children:[Ke.couple.groom," & ",Ke.couple.bride]}),p.jsx("div",{className:"w-16 h-1 bg-white/30 mx-auto mb-4"}),p.jsx("p",{className:"text-sm text-white/80 max-w-md mx-auto leading-relaxed",children:"Nous nous réjouissons de célébrer ce jour spécial avec vous"}),p.jsx("div",{className:"flex justify-center gap-4 mt-6 mb-6",children:p.jsx("a",{href:"https://wa.me/243899895733",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-all duration-300","aria-label":"Contacter les mariés via WhatsApp",children:p.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{d:"M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"})})})}),p.jsxs("div",{className:"text-xs text-white/50",children:[p.jsxs("p",{children:["© ",(new Date).getFullYear()," - Tous droits réservés"]}),p.jsxs("p",{className:"mt-1",children:["Développé par Criho James,"," ",p.jsx("a",{href:"https://www.criho.tech",target:"_blank",rel:"noopener noreferrer",className:"hover:text-white transition-colors duration-300",children:"@https://www.criho.tech"})]})]})]})]}),C>.3&&p.jsx("button",{className:"fixed bottom-20 right-4 sm:bottom-4 z-30 bg-primary/80 text-white w-10 h-10 rounded-full shadow-lg flex items-center justify-center transform hover:scale-110 transition-all duration-300 backdrop-blur-sm",onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),"aria-label":"Retour en haut",children:p.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 10l7-7m0 0l7 7m-7-7v18"})})})]})};var it,ot,st=Object.defineProperty,at=Object.getOwnPropertySymbols,It=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable,Ct=(e,t,n)=>t in e?st(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ct=(e,t)=>{for(var n in t||(t={}))It.call(t,n)&&Ct(e,n,t[n]);if(at)for(var n of at(t))lt.call(t,n)&&Ct(e,n,t[n]);return e},dt=(e,t)=>{var n={};for(var g in e)It.call(e,g)&&t.indexOf(g)<0&&(n[g]=e[g]);if(null!=e&&at)for(var g of at(e))t.indexOf(g)<0&&lt.call(e,g)&&(n[g]=e[g]);return n};(e=>{const t=class{constructor(e,n,g,r){if(this.version=e,this.errorCorrectionLevel=n,this.modules=[],this.isFunction=[],e<t.MIN_VERSION||e>t.MAX_VERSION)throw new RangeError("Version value out of range");if(r<-1||r>7)throw new RangeError("Mask value out of range");this.size=4*e+17;let o=[];for(let t=0;t<this.size;t++)o.push(!1);for(let t=0;t<this.size;t++)this.modules.push(o.slice()),this.isFunction.push(o.slice());this.drawFunctionPatterns();const s=this.addEccAndInterleave(g);if(this.drawCodewords(s),-1==r){let e=1e9;for(let t=0;t<8;t++){this.applyMask(t),this.drawFormatBits(t);const n=this.getPenaltyScore();n<e&&(r=t,e=n),this.applyMask(t)}}i(0<=r&&r<=7),this.mask=r,this.applyMask(r),this.drawFormatBits(r),this.isFunction=[]}static encodeText(n,g){const r=e.QrSegment.makeSegments(n);return t.encodeSegments(r,g)}static encodeBinary(n,g){const r=e.QrSegment.makeBytes(n);return t.encodeSegments([r],g)}static encodeSegments(e,n,r=1,o=40,a=-1,I=!0){if(!(t.MIN_VERSION<=r&&r<=o&&o<=t.MAX_VERSION)||a<-1||a>7)throw new RangeError("Invalid value");let l,C;for(l=r;;l++){const g=8*t.getNumDataCodewords(l,n),r=s.getTotalBits(e,l);if(r<=g){C=r;break}if(l>=o)throw new RangeError("Data too long")}for(const g of[t.Ecc.MEDIUM,t.Ecc.QUARTILE,t.Ecc.HIGH])I&&C<=8*t.getNumDataCodewords(l,g)&&(n=g);let c=[];for(const t of e){g(t.mode.modeBits,4,c),g(t.numChars,t.mode.numCharCountBits(l),c);for(const e of t.getData())c.push(e)}i(c.length==C);const d=8*t.getNumDataCodewords(l,n);i(c.length<=d),g(0,Math.min(4,d-c.length),c),g(0,(8-c.length%8)%8,c),i(c.length%8==0);for(let t=236;c.length<d;t^=253)g(t,8,c);let u=[];for(;8*u.length<c.length;)u.push(0);return c.forEach(((e,t)=>u[t>>>3]|=e<<7-(7&t))),new t(l,n,u,a)}getModule(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]}getModules(){return this.modules}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2==0),this.setFunctionModule(n,6,n%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),t=e.length;for(let n=0;n<t;n++)for(let g=0;g<t;g++)0==n&&0==g||0==n&&g==t-1||n==t-1&&0==g||this.drawAlignmentPattern(e[n],e[g]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const t=this.errorCorrectionLevel.formatBits<<3|e;let n=t;for(let r=0;r<10;r++)n=n<<1^1335*(n>>>9);const g=21522^(t<<10|n);i(g>>>15==0);for(let i=0;i<=5;i++)this.setFunctionModule(8,i,r(g,i));this.setFunctionModule(8,7,r(g,6)),this.setFunctionModule(8,8,r(g,7)),this.setFunctionModule(7,8,r(g,8));for(let i=9;i<15;i++)this.setFunctionModule(14-i,8,r(g,i));for(let i=0;i<8;i++)this.setFunctionModule(this.size-1-i,8,r(g,i));for(let i=8;i<15;i++)this.setFunctionModule(8,this.size-15+i,r(g,i));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let n=0;n<12;n++)e=e<<1^7973*(e>>>11);const t=this.version<<12|e;i(t>>>18==0);for(let n=0;n<18;n++){const e=r(t,n),g=this.size-11+n%3,i=Math.floor(n/3);this.setFunctionModule(g,i,e),this.setFunctionModule(i,g,e)}}drawFinderPattern(e,t){for(let n=-4;n<=4;n++)for(let g=-4;g<=4;g++){const r=Math.max(Math.abs(g),Math.abs(n)),i=e+g,o=t+n;0<=i&&i<this.size&&0<=o&&o<this.size&&this.setFunctionModule(i,o,2!=r&&4!=r)}}drawAlignmentPattern(e,t){for(let n=-2;n<=2;n++)for(let g=-2;g<=2;g++)this.setFunctionModule(e+g,t+n,1!=Math.max(Math.abs(g),Math.abs(n)))}setFunctionModule(e,t,n){this.modules[t][e]=n,this.isFunction[t][e]=!0}addEccAndInterleave(e){const n=this.version,g=this.errorCorrectionLevel;if(e.length!=t.getNumDataCodewords(n,g))throw new RangeError("Invalid argument");const r=t.NUM_ERROR_CORRECTION_BLOCKS[g.ordinal][n],o=t.ECC_CODEWORDS_PER_BLOCK[g.ordinal][n],s=Math.floor(t.getNumRawDataModules(n)/8),a=r-s%r,I=Math.floor(s/r);let l=[];const C=t.reedSolomonComputeDivisor(o);for(let i=0,d=0;i<r;i++){let n=e.slice(d,d+I-o+(i<a?0:1));d+=n.length;const g=t.reedSolomonComputeRemainder(n,C);i<a&&n.push(0),l.push(n.concat(g))}let c=[];for(let t=0;t<l[0].length;t++)l.forEach(((e,n)=>{(t!=I-o||n>=a)&&c.push(e[t])}));return i(c.length==s),c}drawCodewords(e){if(e.length!=Math.floor(t.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let n=0;for(let t=this.size-1;t>=1;t-=2){6==t&&(t=5);for(let g=0;g<this.size;g++)for(let i=0;i<2;i++){const o=t-i,s=!(t+1&2)?this.size-1-g:g;!this.isFunction[s][o]&&n<8*e.length&&(this.modules[s][o]=r(e[n>>>3],7-(7&n)),n++)}}i(n==8*e.length)}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let t=0;t<this.size;t++)for(let n=0;n<this.size;n++){let g;switch(e){case 0:g=(n+t)%2==0;break;case 1:g=t%2==0;break;case 2:g=n%3==0;break;case 3:g=(n+t)%3==0;break;case 4:g=(Math.floor(n/3)+Math.floor(t/2))%2==0;break;case 5:g=n*t%2+n*t%3==0;break;case 6:g=(n*t%2+n*t%3)%2==0;break;case 7:g=((n+t)%2+n*t%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[t][n]&&g&&(this.modules[t][n]=!this.modules[t][n])}}getPenaltyScore(){let e=0;for(let i=0;i<this.size;i++){let n=!1,g=0,r=[0,0,0,0,0,0,0];for(let o=0;o<this.size;o++)this.modules[i][o]==n?(g++,5==g?e+=t.PENALTY_N1:g>5&&e++):(this.finderPenaltyAddHistory(g,r),n||(e+=this.finderPenaltyCountPatterns(r)*t.PENALTY_N3),n=this.modules[i][o],g=1);e+=this.finderPenaltyTerminateAndCount(n,g,r)*t.PENALTY_N3}for(let i=0;i<this.size;i++){let n=!1,g=0,r=[0,0,0,0,0,0,0];for(let o=0;o<this.size;o++)this.modules[o][i]==n?(g++,5==g?e+=t.PENALTY_N1:g>5&&e++):(this.finderPenaltyAddHistory(g,r),n||(e+=this.finderPenaltyCountPatterns(r)*t.PENALTY_N3),n=this.modules[o][i],g=1);e+=this.finderPenaltyTerminateAndCount(n,g,r)*t.PENALTY_N3}for(let i=0;i<this.size-1;i++)for(let n=0;n<this.size-1;n++){const g=this.modules[i][n];g==this.modules[i][n+1]&&g==this.modules[i+1][n]&&g==this.modules[i+1][n+1]&&(e+=t.PENALTY_N2)}let n=0;for(const t of this.modules)n=t.reduce(((e,t)=>e+(t?1:0)),n);const g=this.size*this.size,r=Math.ceil(Math.abs(20*n-10*g)/g)-1;return i(0<=r&&r<=9),e+=r*t.PENALTY_N4,i(0<=e&&e<=2568888),e}getAlignmentPatternPositions(){if(1==this.version)return[];{const e=Math.floor(this.version/7)+2,t=32==this.version?26:2*Math.ceil((4*this.version+4)/(2*e-2));let n=[6];for(let g=this.size-7;n.length<e;g-=t)n.splice(1,0,g);return n}}static getNumRawDataModules(e){if(e<t.MIN_VERSION||e>t.MAX_VERSION)throw new RangeError("Version number out of range");let n=(16*e+128)*e+64;if(e>=2){const t=Math.floor(e/7)+2;n-=(25*t-10)*t-55,e>=7&&(n-=36)}return i(208<=n&&n<=29648),n}static getNumDataCodewords(e,n){return Math.floor(t.getNumRawDataModules(e)/8)-t.ECC_CODEWORDS_PER_BLOCK[n.ordinal][e]*t.NUM_ERROR_CORRECTION_BLOCKS[n.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw new RangeError("Degree out of range");let n=[];for(let t=0;t<e-1;t++)n.push(0);n.push(1);let g=1;for(let r=0;r<e;r++){for(let e=0;e<n.length;e++)n[e]=t.reedSolomonMultiply(n[e],g),e+1<n.length&&(n[e]^=n[e+1]);g=t.reedSolomonMultiply(g,2)}return n}static reedSolomonComputeRemainder(e,n){let g=n.map((e=>0));for(const r of e){const e=r^g.shift();g.push(0),n.forEach(((n,r)=>g[r]^=t.reedSolomonMultiply(n,e)))}return g}static reedSolomonMultiply(e,t){if(e>>>8!=0||t>>>8!=0)throw new RangeError("Byte out of range");let n=0;for(let g=7;g>=0;g--)n=n<<1^285*(n>>>7),n^=(t>>>g&1)*e;return i(n>>>8==0),n}finderPenaltyCountPatterns(e){const t=e[1];i(t<=3*this.size);const n=t>0&&e[2]==t&&e[3]==3*t&&e[4]==t&&e[5]==t;return(n&&e[0]>=4*t&&e[6]>=t?1:0)+(n&&e[6]>=4*t&&e[0]>=t?1:0)}finderPenaltyTerminateAndCount(e,t,n){return e&&(this.finderPenaltyAddHistory(t,n),t=0),t+=this.size,this.finderPenaltyAddHistory(t,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(e,t){0==t[0]&&(e+=this.size),t.pop(),t.unshift(e)}};let n=t;function g(e,t,n){if(t<0||t>31||e>>>t!=0)throw new RangeError("Value out of range");for(let g=t-1;g>=0;g--)n.push(e>>>g&1)}function r(e,t){return!!(e>>>t&1)}function i(e){if(!e)throw new Error("Assertion error")}n.MIN_VERSION=1,n.MAX_VERSION=40,n.PENALTY_N1=3,n.PENALTY_N2=3,n.PENALTY_N3=40,n.PENALTY_N4=10,n.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],n.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e.QrCode=n;const o=class{constructor(e,t,n){if(this.mode=e,this.numChars=t,this.bitData=n,t<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}static makeBytes(e){let t=[];for(const n of e)g(n,8,t);return new o(o.Mode.BYTE,e.length,t)}static makeNumeric(e){if(!o.isNumeric(e))throw new RangeError("String contains non-numeric characters");let t=[];for(let n=0;n<e.length;){const r=Math.min(e.length-n,3);g(parseInt(e.substr(n,r),10),3*r+1,t),n+=r}return new o(o.Mode.NUMERIC,e.length,t)}static makeAlphanumeric(e){if(!o.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");let t,n=[];for(t=0;t+2<=e.length;t+=2){let r=45*o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t));r+=o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t+1)),g(r,11,n)}return t<e.length&&g(o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t)),6,n),new o(o.Mode.ALPHANUMERIC,e.length,n)}static makeSegments(e){return""==e?[]:o.isNumeric(e)?[o.makeNumeric(e)]:o.isAlphanumeric(e)?[o.makeAlphanumeric(e)]:[o.makeBytes(o.toUtf8ByteArray(e))]}static makeEci(e){let t=[];if(e<0)throw new RangeError("ECI assignment value out of range");if(e<128)g(e,8,t);else if(e<16384)g(2,2,t),g(e,14,t);else{if(!(e<1e6))throw new RangeError("ECI assignment value out of range");g(6,3,t),g(e,21,t)}return new o(o.Mode.ECI,0,t)}static isNumeric(e){return o.NUMERIC_REGEX.test(e)}static isAlphanumeric(e){return o.ALPHANUMERIC_REGEX.test(e)}getData(){return this.bitData.slice()}static getTotalBits(e,t){let n=0;for(const g of e){const e=g.mode.numCharCountBits(t);if(g.numChars>=1<<e)return 1/0;n+=4+e+g.bitData.length}return n}static toUtf8ByteArray(e){e=encodeURI(e);let t=[];for(let n=0;n<e.length;n++)"%"!=e.charAt(n)?t.push(e.charCodeAt(n)):(t.push(parseInt(e.substr(n+1,2),16)),n+=2);return t}};let s=o;s.NUMERIC_REGEX=/^[0-9]*$/,s.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,s.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",e.QrSegment=s})(it||(it={})),(e=>{const t=class{constructor(e,t){this.ordinal=e,this.formatBits=t}};let n=t;n.LOW=new t(0,1),n.MEDIUM=new t(1,0),n.QUARTILE=new t(2,3),n.HIGH=new t(3,2),e.Ecc=n})((ot=it||(it={})).QrCode||(ot.QrCode={})),(e=>{(e=>{const t=class{constructor(e,t){this.modeBits=e,this.numBitsCharCount=t}numCharCountBits(e){return this.numBitsCharCount[Math.floor((e+7)/17)]}};let n=t;n.NUMERIC=new t(1,[10,12,14]),n.ALPHANUMERIC=new t(2,[9,11,13]),n.BYTE=new t(4,[8,16,16]),n.KANJI=new t(8,[8,10,12]),n.ECI=new t(7,[0,0,0]),e.Mode=n})(e.QrSegment||(e.QrSegment={}))})(it||(it={}));var ut=it,At={L:ut.QrCode.Ecc.LOW,M:ut.QrCode.Ecc.MEDIUM,Q:ut.QrCode.Ecc.QUARTILE,H:ut.QrCode.Ecc.HIGH},ht=128,mt="L",bt="#FFFFFF",pt="#000000",yt=!1;
/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */function Zt(e,t=0){const n=[];return e.forEach((function(e,g){let r=null;e.forEach((function(i,o){if(!i&&null!==r)return n.push(`M${r+t} ${g+t}h${o-r}v1H${r+t}z`),void(r=null);if(o!==e.length-1)i&&null===r&&(r=o);else{if(!i)return;null===r?n.push(`M${o+t},${g+t} h1v1H${o+t}z`):n.push(`M${r+t},${g+t} h${o+1-r}v1H${r+t}z`)}}))})),n.join("")}function ft(e,t){return e.slice().map(((e,n)=>n<t.y||n>=t.y+t.h?e:e.map(((e,n)=>(n<t.x||n>=t.x+t.w)&&e))))}function Gt(e,t,n,g){if(null==g)return null;const r=n?4:0,i=e.length+2*r,o=Math.floor(.1*t),s=i/t,a=(g.width||o)*s,I=(g.height||o)*s,l=null==g.x?e.length/2-a/2:g.x*s,C=null==g.y?e.length/2-I/2:g.y*s;let c=null;if(g.excavate){let e=Math.floor(l),t=Math.floor(C);c={x:e,y:t,w:Math.ceil(a+l-e),h:Math.ceil(I+C-t)}}return{x:l,y:C,h:I,w:a,excavation:c}}var Bt=function(){try{(new Path2D).addPath(new Path2D)}catch(fp){return!1}return!0}();function St(e){const t=e,{value:n,size:g=ht,level:i=mt,bgColor:o=bt,fgColor:s=pt,includeMargin:a=yt,style:I,imageSettings:l}=t,C=dt(t,["value","size","level","bgColor","fgColor","includeMargin","style","imageSettings"]),c=null==l?void 0:l.src,d=r.useRef(null),u=r.useRef(null),[A,h]=r.useState(!1);r.useEffect((()=>{if(null!=d.current){const e=d.current,t=e.getContext("2d");if(!t)return;let r=ut.QrCode.encodeText(n,At[i]).getModules();const I=a?4:0,C=r.length+2*I,c=Gt(r,g,a,l),A=u.current,h=null!=c&&null!==A&&A.complete&&0!==A.naturalHeight&&0!==A.naturalWidth;h&&null!=c.excavation&&(r=ft(r,c.excavation));const m=window.devicePixelRatio||1;e.height=e.width=g*m;const b=g/C*m;t.scale(b,b),t.fillStyle=o,t.fillRect(0,0,C,C),t.fillStyle=s,Bt?t.fill(new Path2D(Zt(r,I))):r.forEach((function(e,n){e.forEach((function(e,g){e&&t.fillRect(g+I,n+I,1,1)}))})),h&&t.drawImage(A,c.x+I,c.y+I,c.w,c.h)}})),r.useEffect((()=>{h(!1)}),[c]);const m=ct({height:g,width:g},I);let b=null;return null!=c&&(b=r.createElement("img",{src:c,key:c,style:{display:"none"},onLoad:()=>{h(!0)},ref:u})),r.createElement(r.Fragment,null,r.createElement("canvas",ct({style:m,height:g,width:g,ref:d},C)),b)}function Rt(e){const t=e,{value:n,size:g=ht,level:i=mt,bgColor:o=bt,fgColor:s=pt,includeMargin:a=yt,imageSettings:I}=t,l=dt(t,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let C=ut.QrCode.encodeText(n,At[i]).getModules();const c=a?4:0,d=C.length+2*c,u=Gt(C,g,a,I);let A=null;null!=I&&null!=u&&(null!=u.excavation&&(C=ft(C,u.excavation)),A=r.createElement("image",{xlinkHref:I.src,height:u.h,width:u.w,x:u.x+c,y:u.y+c,preserveAspectRatio:"none"}));const h=Zt(C,c);return r.createElement("svg",ct({height:g,width:g,viewBox:`0 0 ${d} ${d}`},l),r.createElement("path",{fill:o,d:`M0,0 h${d}v${d}H0z`,shapeRendering:"crispEdges"}),r.createElement("path",{fill:s,d:h,shapeRendering:"crispEdges"}),A)}var vt=e=>{const t=e,{renderAs:n}=t,g=dt(t,["renderAs"]);return"svg"===n?r.createElement(Rt,ct({},g)):r.createElement(St,ct({},g))};const Vt=({value:t,size:n=200,bgColor:g="#ffffff",fgColor:r="#8B5D33",level:i="H",includeMargin:o=!0,className:s="",logoSrc:a="",logoSize:I=50,title:l="",caption:C="",tableColor:c="",id:d=""})=>{const[u,A]=e.useState(null),h=e.useRef(null),m=c||r;return e.useEffect((()=>{if(u&&a){const e=u.getContext("2d"),t=new Image;t.src=a,t.onload=()=>{const r=n/2-I/2,i=n/2-I/2;e.beginPath(),e.arc(n/2,n/2,I/1.8,0,2*Math.PI),e.fillStyle=g,e.fill(),e.drawImage(t,r,i,I,I)}}}),[u,a,I,n,g]),p.jsxs("div",{className:`flex flex-col items-center ${s}`,ref:h,children:[l&&p.jsx("h3",{className:"text-center font-elegant font-semibold text-lg mb-3",style:{color:m},children:l}),p.jsx("div",{className:"bg-white p-3 rounded-xl shadow-elegant",style:{borderColor:m,borderWidth:"2px",borderStyle:"solid"},children:p.jsx(vt,{id:d,value:t,size:n,bgColor:g,fgColor:m,level:i,includeMargin:o,renderAs:"canvas",ref:e=>{e&&A(e.firstChild)}})}),p.jsxs("div",{className:"flex items-center mt-3 gap-2",children:[C&&p.jsx("p",{className:"text-center text-sm text-muted",children:C}),p.jsxs("button",{onClick:()=>{if(u)try{const e=3,t=document.createElement("canvas"),g=30*e,r=l?60*e:0;t.width=n*e+2*g,t.height=n*e+2*g+r;const i=t.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,t.width,t.height);const o=8*e;i.strokeStyle=m,i.lineWidth=o,i.strokeRect(o/2,o/2,t.width-o,t.height-o),l&&(i.fillStyle=m,i.font=`bold ${24*e}px Arial`,i.textAlign="center",i.fillText(l,t.width/2,35*e),i.font=14*e+"px Arial",i.fillText("Invitation au mariage de Fiston & Vino",t.width/2,52*e));const s=e;i.drawImage(u,g,r+g,n*s,n*s),i.fillStyle=`${m}50`;const a=t.width/2,I=t.height-20*e,C=12*e;for(let n=0;n<5;n++){const e=n/5*Math.PI*2,t=a+Math.cos(e)*C*3,g=I+Math.sin(e)*C*2;i.beginPath(),i.arc(t,g,C,0,2*Math.PI),i.fill()}const c=t.toDataURL("image/png",1),d=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(d){const e=window.open();e&&(e.document.write(`\n            <html>\n              <head>\n                <title>QR Code - ${l||"Invitation"}</title>\n                <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                <style>\n                  body { text-align: center; font-family: Arial; padding: 20px; }\n                  img { max-width: 100%; height: auto; margin-bottom: 20px; }\n                  p { color: #666; margin-bottom: 20px; }\n                </style>\n              </head>\n              <body>\n                <h2>QR Code - ${l||"Invitation"}</h2>\n                <img src="${c}" alt="QR Code">\n                <p>Appuyez longuement sur l'image et sélectionnez "Enregistrer l'image" pour télécharger</p>\n              </body>\n            </html>\n          `),e.document.close())}else{const e=document.createElement("a");e.href=c,e.download=`invitation-${l.replace(/\s+/g,"-")||"qrcode"}.png`,e.click()}const A=document.createElement("div");A.style.position="fixed",A.style.top="20px",A.style.left="50%",A.style.transform="translateX(-50%)",A.style.padding="10px 20px",A.style.background="#4CAF50",A.style.color="white",A.style.borderRadius="4px",A.style.zIndex="9999",A.style.opacity="0",A.style.transition="opacity 0.3s ease",A.textContent=d?"QR Code ouvert dans un nouvel onglet":"QR Code téléchargé",document.body.appendChild(A),setTimeout((()=>{A.style.opacity="1"}),100),setTimeout((()=>{A.style.opacity="0",setTimeout((()=>{document.body.removeChild(A)}),300)}),3e3)}catch(e){alert("Une erreur est survenue lors du téléchargement. Veuillez réessayer.")}},className:"text-xs flex items-center gap-1 px-2 py-1 rounded-md bg-primary/10 text-primary hover:bg-primary/20 transition-colors",style:{color:m,backgroundColor:`${m}15`},children:[p.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Télécharger"]})]})]})};Vt.propTypes={value:Ue.string.isRequired,size:Ue.number,bgColor:Ue.string,fgColor:Ue.string,level:Ue.oneOf(["L","M","Q","H"]),includeMargin:Ue.bool,className:Ue.string,logoSrc:Ue.string,logoSize:Ue.number,title:Ue.string,caption:Ue.string,tableColor:Ue.string,id:Ue.string};const wt=({children:e,className:t="",variant:n="default",hover:g=!1,onClick:r=null,fullWidth:i=!1})=>{const o={default:"bg-white shadow-card rounded-xl",elegant:"bg-white shadow-elegant rounded-2xl border border-primary/10",flat:"bg-secondary rounded-lg",outline:"border border-primary/20 rounded-xl"},s=null!==r,a=`\n    overflow-hidden transition-all duration-300\n    ${o[n]||o.default}\n    ${g?"hover:shadow-medium cursor-pointer transform hover:-translate-y-1":""}\n    ${i?"w-full":""}\n    ${s?"cursor-pointer":""}\n    ${t}\n  `.trim();return s?p.jsx("div",{className:a,onClick:r,role:"button",tabIndex:0,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||r(e)},children:e}):p.jsx("div",{className:a,children:e})};wt.Header=({children:e,className:t=""})=>p.jsx("div",{className:`p-4 border-b border-gray-100 ${t}`,children:e}),wt.Body=({children:e,className:t=""})=>p.jsx("div",{className:`p-4 ${t}`,children:e}),wt.Footer=({children:e,className:t=""})=>p.jsx("div",{className:`p-4 border-t border-gray-100 ${t}`,children:e}),wt.propTypes={children:Ue.node.isRequired,className:Ue.string,variant:Ue.oneOf(["default","elegant","flat","outline"]),hover:Ue.bool,onClick:Ue.func,fullWidth:Ue.bool},wt.Header.propTypes={children:Ue.node.isRequired,className:Ue.string},wt.Body.propTypes={children:Ue.node.isRequired,className:Ue.string},wt.Footer.propTypes={children:Ue.node.isRequired,className:Ue.string};const Wt=({guest:t,group:n,onShare:g=()=>{},onEdit:r=()=>{},onDelete:i=()=>{},baseUrl:o=window.location.origin})=>{const[s,a]=e.useState(!1),[I,l]=e.useState(!1),C=((e,t)=>`${e.replace(/\s+/g,"-").toLowerCase()}_${t.replace(/\s+/g,"-").toLowerCase()}`)(n,t.name),c=`${o}/invitation/${C}`,d=(()=>{if(!n)return"#8B5D33";const e=Ke.tables.find((e=>e.name.toLowerCase()===n.toLowerCase()));return e?e.color:"#8B5D33"})();return p.jsx(wt,{variant:"elegant",className:"overflow-visible",children:p.jsxs(wt.Body,{children:[p.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"font-elegant text-lg text-primary-dark",children:t.name}),p.jsxs("div",{className:"flex items-center mt-1",children:[p.jsxs("span",{className:"flex items-center text-muted text-sm",children:["Table:",p.jsx("span",{className:"ml-1 px-2 py-0.5 rounded-full text-white font-medium",style:{backgroundColor:d},children:n})]}),p.jsx("span",{className:"mx-2 text-primary/20",children:"•"}),p.jsx("span",{className:"text-muted text-sm",children:t.count>1?`${t.count} personnes`:"1 personne"}),t.scanned&&p.jsxs("div",{className:"mt-1.5 flex items-center",children:[p.jsxs("span",{className:"text-xs bg-success/20 text-success py-0.5 px-2 rounded-full flex items-center",children:[p.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"Scanné"," ",t.scanCount>1?`(${t.scanCount} fois)`:""]}),t.lastScan&&p.jsx("span",{className:"text-xs text-muted ml-2",children:new Date(t.lastScan.toDate()).toLocaleString()})]})]})]}),p.jsxs("div",{className:"flex items-center gap-2",children:[s?p.jsx(Pe,{variant:"outline",size:"sm",onClick:()=>a(!1),icon:p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),children:"Masquer"}):p.jsx(Pe,{variant:"outline",size:"sm",onClick:()=>{l(!0),setTimeout((()=>{l(!1),a(!0)}),800)},disabled:I,icon:I?p.jsxs("svg",{className:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24",children:[p.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),p.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),children:I?"Génération...":"Générer QR Code"}),p.jsx(Pe,{variant:"primary",size:"sm",onClick:()=>{window.open(`https://wa.me/?text=${encodeURIComponent(`Invitation pour *${t.name}* au mariage de Fiston Zaka et Vino Banza.\nVoici votre invitation personnalisée: ${c}`)}`,"_blank"),g(t,n)},icon:p.jsx("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M17.498 14.382c-.301-.15-1.767-.867-2.04-.966-.273-.101-.473-.151-.673.15-.197.295-.771.964-.944 1.162-.175.195-.349.21-.646.075-.3-.15-1.263-.465-2.403-1.485-.888-.795-1.484-1.77-1.66-2.07-.174-.3-.019-.465.13-.615.136-.135.301-.345.451-.523.146-.181.194-.301.297-.496.1-.21.049-.375-.025-.524-.075-.15-.672-1.62-.922-2.206-.24-.584-.487-.51-.672-.51-.172-.015-.371-.015-.571-.015-.2 0-.523.074-.797.359-.273.3-1.045 1.02-1.045 2.475s1.07 2.865 1.219 3.075c.149.195 2.105 3.195 5.1 4.485.714.3 1.27.48 1.704.629.714.227 1.365.195 1.88.121.574-.091 1.767-.721 2.016-1.426.255-.705.255-1.29.18-1.425-.074-.135-.27-.21-.57-.345"})}),children:"Partager"}),p.jsx(Pe,{variant:"outline",size:"sm",onClick:()=>r(t),icon:p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),children:"Modifier"}),p.jsx(Pe,{variant:"outline",size:"sm",className:"text-danger hover:bg-danger/10",onClick:()=>{window.confirm(`Voulez-vous vraiment supprimer l'invité "${t.name}" ?`)&&i(t)},icon:p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),children:"Supprimer"})]})]}),s&&p.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:p.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-6",children:[p.jsx("div",{className:"flex-shrink-0",children:p.jsx(Vt,{id:`qr-${C}`,value:c,size:160,logoSrc:"/src/assets/images/wedding-logo.png",logoSize:40,title:t.name,tableColor:d,caption:`Table ${n}`})}),p.jsxs("div",{className:"flex-grow space-y-4",children:[p.jsxs("div",{children:[p.jsx("h4",{className:"font-sans text-sm font-medium text-primary-dark",children:"Lien d'invitation"}),p.jsx("p",{className:"text-xs text-muted break-all mt-1",children:c})]}),p.jsxs("div",{className:"flex flex-wrap gap-2",children:[p.jsx(Pe,{variant:"outline",size:"sm",icon:p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),onClick:()=>{navigator.clipboard.writeText(c)},children:"Copier le lien"}),p.jsx(Pe,{variant:"outline",size:"sm",icon:p.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),onClick:()=>{const e=document.getElementById(`qr-${C}`);if(e){const n=document.createElement("a");n.download=`invitation-${t.name.replace(/\s+/g,"-")}.png`,n.href=e.toDataURL("image/png"),n.click()}},children:"Télécharger QR"})]})]})]})})]})})};Wt.propTypes={guest:Ue.shape({name:Ue.string.isRequired,count:Ue.number.isRequired,message:Ue.string.isRequired}).isRequired,group:Ue.string.isRequired,onShare:Ue.func,baseUrl:Ue.string};const kt=({guest:t,groups:n,onSubmit:g,onCancel:r})=>{const[i,o]=e.useState({name:"",group:n[0]||"",count:1,message:"",...t});e.useEffect((()=>{t&&o({name:t.name||"",group:t.group||n[0]||"",count:t.count||1,message:t.message||"",...t})}),[t,n]);const s=e=>{const{name:t,value:n}=e.target;o((e=>({...e,[t]:"count"===t?parseInt(n,10):n})))};return p.jsx(wt,{variant:"default",className:"overflow-hidden",children:p.jsxs("form",{onSubmit:e=>{e.preventDefault(),g(i)},children:[p.jsxs(wt.Body,{className:"p-6",children:[p.jsx("h3",{className:"text-xl font-elegant text-primary-dark mb-4",children:t?"Modifier l'invité":"Ajouter un invité"}),p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-primary-dark mb-1",children:"Nom de l'invité"}),p.jsx("input",{id:"name",name:"name",type:"text",required:!0,className:"block w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-primary focus:border-primary bg-white text-primary-dark",value:i.name,onChange:s,placeholder:"Nom de l'invité ou du groupe"})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"group",className:"block text-sm font-medium text-primary-dark mb-1",children:"Groupe"}),p.jsx("select",{id:"group",name:"group",required:!0,className:"block w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-primary focus:border-primary bg-white text-primary-dark",value:i.group,onChange:s,children:n.map((e=>p.jsx("option",{value:e,children:e},e)))})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"count",className:"block text-sm font-medium text-primary-dark mb-1",children:"Nombre de personnes"}),p.jsx("input",{id:"count",name:"count",type:"number",min:"1",required:!0,className:"block w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-primary focus:border-primary bg-white text-primary-dark",value:i.count,onChange:s})]}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"message",className:"block text-sm font-medium text-primary-dark mb-1",children:"Message personnalisé"}),p.jsx("textarea",{id:"message",name:"message",rows:"3",className:"block w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-primary focus:border-primary bg-white text-primary-dark",value:i.message,onChange:s,placeholder:"Message personnalisé pour cet invité"})]})]})]}),p.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-100 flex justify-end space-x-3",children:[p.jsx(Pe,{type:"button",variant:"outline",onClick:r,children:"Annuler"}),p.jsx(Pe,{type:"submit",variant:"primary",children:t?"Mettre à jour":"Ajouter"})]})]})})};var Xt={};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt=function(e){const t=[];let n=0;for(let g=0;g<e.length;g++){let r=e.charCodeAt(g);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&g+1<e.length&&56320==(64512&e.charCodeAt(g+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++g)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},Jt={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,g=[];for(let r=0;r<e.length;r+=3){const t=e[r],i=r+1<e.length,o=i?e[r+1]:0,s=r+2<e.length,a=s?e[r+2]:0,I=t>>2,l=(3&t)<<4|o>>4;let C=(15&o)<<2|a>>6,c=63&a;s||(c=64,i||(C=64)),g.push(n[I],n[l],n[C],n[c])}return g.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Nt(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,g=0;for(;n<e.length;){const r=e[n++];if(r<128)t[g++]=String.fromCharCode(r);else if(r>191&&r<224){const i=e[n++];t[g++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&r<365){const i=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[g++]=String.fromCharCode(55296+(i>>10)),t[g++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[g++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,g=[];for(let r=0;r<e.length;){const t=n[e.charAt(r++)],i=r<e.length?n[e.charAt(r)]:0;++r;const o=r<e.length?n[e.charAt(r)]:64;++r;const s=r<e.length?n[e.charAt(r)]:64;if(++r,null==t||null==i||null==o||null==s)throw new Yt;const a=t<<2|i>>4;if(g.push(a),64!==o){const e=i<<4&240|o>>2;if(g.push(e),64!==s){const e=o<<6&192|s;g.push(e)}}}return g},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Yt extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Et=function(e){return function(e){const t=Nt(e);return Jt.encodeByteArray(t,!0)}(e).replace(/\./g,"")},Ht=function(e){try{return Jt.decodeString(e,!0)}catch(fp){}return null};
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ft(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xt=()=>{try{return Ft().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const e=Xt.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(fp){return}const t=e&&Ht(e[1]);return t&&JSON.parse(t)})()}catch(fp){return}},Tt=()=>{var e;return null===(e=xt())||void 0===e?void 0:e.config},Kt=e=>{var t;return null===(t=xt())||void 0===t?void 0:t[`_${e}`]};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Mt{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dt(e){return e.endsWith(".cloudworkstations.dev")}async function Lt(e){return(await fetch(e,{credentials:"include"})).ok}const Ut={};let zt=!1;function Qt(e,t){if("undefined"==typeof window||"undefined"==typeof document||!Dt(window.location.host)||Ut[e]===t||Ut[e]||zt)return;function n(e){return`__firebase__banner__${e}`}Ut[e]=t;const g="__firebase__banner",r=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(Ut))Ut[t]?e.emulator.push(t):e.prod.push(t);return e}(),i=r.prod.length>0;function o(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{zt=!0,function(){const e=document.getElementById(g);e&&e.remove()}()},e}function s(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(g),t=n("text"),r=document.getElementById(t)||document.createElement("span"),s=n("learnmore"),a=document.getElementById(s)||document.createElement("a"),I=n("preprendIcon"),l=document.getElementById(I)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,s);const n=o();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(l,I),t.append(l,r,a,n),document.body.appendChild(t)}i?(r.innerText="Preview backend disconnected.",l.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(l.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',r.innerText="Preview backend running in this workspace."),r.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ot(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function jt(){var e;const t=null===(e=xt())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(fp){return!1}}function Pt(){return!jt()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _t(){return!jt()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function qt(){try{return"object"==typeof indexedDB}catch(fp){return!1}}class $t extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,$t.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,en.prototype.create)}}class en{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},g=`${this.service}/${e}`,r=this.errors[e],i=r?function(e,t){return e.replace(tn,((e,n)=>{const g=t[n];return null!=g?String(g):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${i} (${g}).`;return new $t(g,o,n)}}const tn=/\{\$([^}]+)}/g;function nn(e,t){if(e===t)return!0;const n=Object.keys(e),g=Object.keys(t);for(const r of n){if(!g.includes(r))return!1;const n=e[r],i=t[r];if(gn(n)&&gn(i)){if(!nn(n,i))return!1}else if(n!==i)return!1}for(const r of g)if(!n.includes(r))return!1;return!0}function gn(e){return null!==e&&"object"==typeof e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rn(e){const t=[];for(const[n,g]of Object.entries(e))Array.isArray(g)?g.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(g));return t.length?"&"+t.join("&"):""}class on{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let g;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");g=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===g.next&&(g.next=sn),void 0===g.error&&(g.error=sn),void 0===g.complete&&(g.complete=sn);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?g.error(this.finalError):g.complete()}catch(fp){}})),this.observers.push(g),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(fp){"undefined"!=typeof console&&console.error}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function sn(){}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function an(e){return e&&e._delegate?e._delegate:e}class In{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ln="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cn{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Mt;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(fp){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),g=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(g)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(fp){if(g)return null;throw fp}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService({instanceIdentifier:ln})}catch(fp){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(fp){}}}}clearInstance(e=ln){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=ln){return this.instances.has(e)}getOptions(e=ln){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const g=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[r,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(r)&&i.resolve(g)}return g}onInit(e,t){var n;const g=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(g))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(g,r);const i=this.instances.get(g);return i&&e(i,g),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(g){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(g=e,g===ln?void 0:g),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(r){}var g;return n||null}normalizeInstanceIdentifier(e=ln){return this.component?this.component.multipleInstances?e:ln:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class cn{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Cn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var dn,un;(un=dn||(dn={}))[un.DEBUG=0]="DEBUG",un[un.VERBOSE=1]="VERBOSE",un[un.INFO=2]="INFO",un[un.WARN=3]="WARN",un[un.ERROR=4]="ERROR",un[un.SILENT=5]="SILENT";const An={debug:dn.DEBUG,verbose:dn.VERBOSE,info:dn.INFO,warn:dn.WARN,error:dn.ERROR,silent:dn.SILENT},hn=dn.INFO,mn={[dn.DEBUG]:"log",[dn.VERBOSE]:"log",[dn.INFO]:"info",[dn.WARN]:"warn",[dn.ERROR]:"error"},bn=(e,t,...n)=>{if(t<e.logLevel)return;(new Date).toISOString();if(!mn[t])throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class pn{constructor(e){this.name=e,this._logLevel=hn,this._logHandler=bn,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in dn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?An[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,dn.DEBUG,...e),this._logHandler(this,dn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,dn.VERBOSE,...e),this._logHandler(this,dn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,dn.INFO,...e),this._logHandler(this,dn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,dn.WARN,...e),this._logHandler(this,dn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,dn.ERROR,...e),this._logHandler(this,dn.ERROR,...e)}}let yn,Zn;const fn=new WeakMap,Gn=new WeakMap,Bn=new WeakMap,Sn=new WeakMap,Rn=new WeakMap;let vn={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Gn.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Bn.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Wn(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Vn(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Zn||(Zn=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(kn(this),t),Wn(fn.get(this))}:function(...t){return Wn(e.apply(kn(this),t))}:function(t,...n){const g=e.call(kn(this),t,...n);return Bn.set(g,t.sort?t.sort():[t]),Wn(g)}}function wn(e){return"function"==typeof e?Vn(e):(e instanceof IDBTransaction&&function(e){if(Gn.has(e))return;const t=new Promise(((t,n)=>{const g=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),g()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),g()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));Gn.set(e,t)}(e),t=e,(yn||(yn=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,vn):e);var t}function Wn(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const g=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(Wn(e.result)),g()},i=()=>{n(e.error),g()};e.addEventListener("success",r),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&fn.set(t,e)})).catch((()=>{})),Rn.set(t,e),t}(e);if(Sn.has(e))return Sn.get(e);const t=wn(e);return t!==e&&(Sn.set(e,t),Rn.set(t,e)),t}const kn=e=>Rn.get(e);const Xn=["get","getKey","getAll","getAllKeys","count"],Nn=["put","add","delete","clear"],Jn=new Map;function Yn(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Jn.get(t))return Jn.get(t);const n=t.replace(/FromIndex$/,""),g=t!==n,r=Nn.includes(n);if(!(n in(g?IDBIndex:IDBObjectStore).prototype)||!r&&!Xn.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let o=i.store;return g&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&i.done]))[0]};return Jn.set(t,i),i}vn=(e=>({...e,get:(t,n,g)=>Yn(t,n)||e.get(t,n,g),has:(t,n)=>!!Yn(t,n)||e.has(t,n)}))(vn);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class En{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Hn="@firebase/app",Fn="0.13.0",xn=new pn("@firebase/app"),Tn="@firebase/app-compat",Kn="@firebase/analytics-compat",Mn="@firebase/analytics",Dn="@firebase/app-check-compat",Ln="@firebase/app-check",Un="@firebase/auth",zn="@firebase/auth-compat",Qn="@firebase/database",On="@firebase/data-connect",jn="@firebase/database-compat",Pn="@firebase/functions",_n="@firebase/functions-compat",qn="@firebase/installations",$n="@firebase/installations-compat",eg="@firebase/messaging",tg="@firebase/messaging-compat",ng="@firebase/performance",gg="@firebase/performance-compat",rg="@firebase/remote-config",ig="@firebase/remote-config-compat",og="@firebase/storage",sg="@firebase/storage-compat",ag="@firebase/firestore",Ig="@firebase/ai",lg="@firebase/firestore-compat",Cg="firebase",cg="[DEFAULT]",dg={[Hn]:"fire-core",[Tn]:"fire-core-compat",[Mn]:"fire-analytics",[Kn]:"fire-analytics-compat",[Ln]:"fire-app-check",[Dn]:"fire-app-check-compat",[Un]:"fire-auth",[zn]:"fire-auth-compat",[Qn]:"fire-rtdb",[On]:"fire-data-connect",[jn]:"fire-rtdb-compat",[Pn]:"fire-fn",[_n]:"fire-fn-compat",[qn]:"fire-iid",[$n]:"fire-iid-compat",[eg]:"fire-fcm",[tg]:"fire-fcm-compat",[ng]:"fire-perf",[gg]:"fire-perf-compat",[rg]:"fire-rc",[ig]:"fire-rc-compat",[og]:"fire-gcs",[sg]:"fire-gcs-compat",[ag]:"fire-fst",[lg]:"fire-fst-compat",[Ig]:"fire-vertex","fire-js":"fire-js",[Cg]:"fire-js-all"},ug=new Map,Ag=new Map,hg=new Map;function mg(e,t){try{e.container.addComponent(t)}catch(fp){xn.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,fp)}}function bg(e){const t=e.name;if(hg.has(t))return xn.debug(`There were multiple attempts to register component ${t}.`),!1;hg.set(t,e);for(const n of ug.values())mg(n,e);for(const n of Ag.values())mg(n,e);return!0}function pg(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function yg(e){return null!=e&&void 0!==e.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zg=new en("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class fg{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new In("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Zg.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gg="11.8.0";function Bg(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const g=Object.assign({name:cg,automaticDataCollectionEnabled:!0},t),r=g.name;if("string"!=typeof r||!r)throw Zg.create("bad-app-name",{appName:String(r)});if(n||(n=Tt()),!n)throw Zg.create("no-options");const i=ug.get(r);if(i){if(nn(n,i.options)&&nn(g,i.config))return i;throw Zg.create("duplicate-app",{appName:r})}const o=new cn(r);for(const a of hg.values())o.addComponent(a);const s=new fg(n,g,o);return ug.set(r,s),s}function Sg(e,t,n){var g;let r=null!==(g=dg[e])&&void 0!==g?g:e;n&&(r+=`-${n}`);const i=r.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const e=[`Unable to register library "${r}" with version "${t}":`];return i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void xn.warn(e.join(" "))}bg(new In(`${r}-version`,(()=>({library:r,version:t})),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rg="firebase-heartbeat-store";let vg=null;function Vg(){return vg||(vg=function(e,t,{blocked:n,upgrade:g,blocking:r,terminated:i}={}){const o=indexedDB.open(e,t),s=Wn(o);return g&&o.addEventListener("upgradeneeded",(e=>{g(Wn(o.result),e.oldVersion,e.newVersion,Wn(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),s.then((e=>{i&&e.addEventListener("close",(()=>i())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),s}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Rg)}catch(fp){}}}).catch((e=>{throw Zg.create("idb-open",{originalErrorMessage:e.message})}))),vg}async function wg(e,t){try{const n=(await Vg()).transaction(Rg,"readwrite"),g=n.objectStore(Rg);await g.put(t,Wg(e)),await n.done}catch(fp){if(fp instanceof $t)xn.warn(fp.message);else{const t=Zg.create("idb-set",{originalErrorMessage:null==fp?void 0:fp.message});xn.warn(t.message)}}}function Wg(e){return`${e.name}!${e.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kg{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ng(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),g=Xg();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===g||this._heartbeatsCache.heartbeats.some((e=>e.date===g)))return;if(this._heartbeatsCache.heartbeats.push({date:g,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let g=1;g<e.length;g++)e[g].date<n&&(n=e[g].date,t=g);return t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(fp){xn.warn(fp)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Xg(),{heartbeatsToSend:n,unsentEntries:g}=function(e,t=1024){const n=[];let g=e.slice();for(const r of e){const e=n.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),Jg(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Jg(n)>t){n.pop();break}g=g.slice(1)}return{heartbeatsToSend:n,unsentEntries:g}}(this._heartbeatsCache.heartbeats),r=Et(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,g.length>0?(this._heartbeatsCache.heartbeats=g,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(fp){return xn.warn(fp),""}}}function Xg(){return(new Date).toISOString().substring(0,10)}class Ng{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!qt()&&new Promise(((e,t)=>{try{let n=!0;const g="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(g);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(g),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Vg()).transaction(Rg),n=await t.objectStore(Rg).get(Wg(e));return await t.done,n}catch(fp){if(fp instanceof $t)xn.warn(fp.message);else{const t=Zg.create("idb-get",{originalErrorMessage:null==fp?void 0:fp.message});xn.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return wg(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return wg(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Jg(e){return Et(JSON.stringify({version:2,heartbeats:e})).length}var Yg;Yg="",bg(new In("platform-logger",(e=>new En(e)),"PRIVATE")),bg(new In("heartbeat",(e=>new kg(e)),"PRIVATE")),Sg(Hn,Fn,Yg),Sg(Hn,Fn,"esm2017"),Sg("fire-js","");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Sg("firebase","11.8.1","app");var Eg,Hg,Fg="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/(function(){var e;
/** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  */function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var g=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)g[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)g[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var i=e.g[3],o=t+(i^n&(r^i))+g[0]+3614090360&4294967295;o=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=(n=(r=(i=(t=n+(o<<7&4294967295|o>>>25))+((o=i+(r^t&(n^r))+g[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(t^n))+g[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(i^t))+g[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(r^i))+g[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^t&(n^r))+g[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(t^n))+g[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(i^t))+g[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(r^i))+g[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^t&(n^r))+g[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(t^n))+g[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(i^t))+g[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(r^i))+g[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(r^t&(n^r))+g[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^i&(t^n))+g[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^r&(i^t))+g[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^i&(n^r))+g[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(t^n))+g[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(i^t))+g[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(r^i))+g[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^i&(n^r))+g[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(t^n))+g[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(i^t))+g[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(r^i))+g[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^i&(n^r))+g[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(t^n))+g[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(i^t))+g[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(r^i))+g[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(r^i&(n^r))+g[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^r&(t^n))+g[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(t^n&(i^t))+g[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(r^i))+g[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^r^i)+g[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^r)+g[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^t^n)+g[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^t)+g[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^i)+g[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^r)+g[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^t^n)+g[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^t)+g[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^i)+g[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^r)+g[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^t^n)+g[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^t)+g[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^r^i)+g[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^r)+g[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(i^t^n)+g[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^i^t)+g[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(r^(n|~i))+g[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~r))+g[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(i|~n))+g[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(r|~t))+g[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(n|~i))+g[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~r))+g[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(i|~n))+g[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(r|~t))+g[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(r^(n|~i))+g[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~r))+g[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(t^(i|~n))+g[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(r|~t))+g[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(t=n+((o=t+(r^(n|~i))+g[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~r))+g[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=i+((o=r+(t^(i|~n))+g[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+g[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+i&4294967295}function g(e,t){this.h=t;for(var n=[],g=!0,r=e.length-1;0<=r;r--){var i=0|e[r];g&&i==t||(n[r]=i,g=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,g){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[n].apply(e,r)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var g=t-this.blockSize,r=this.B,i=this.h,o=0;o<t;){if(0==i)for(;o<=g;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(r[i++]=e.charCodeAt(o++),i==this.blockSize){n(this,r),i=0;break}}else for(;o<t;)if(r[i++]=e[o++],i==this.blockSize){n(this,r),i=0;break}}this.h=i,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var g=0;32>g;g+=8)e[n++]=this.g[t]>>>g&255;return e};var r={};function i(e){return-128<=e&&128>e?function(e,t){var n=r;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new g([0|e],0>e?-1:0)})):new g([0|e],0>e?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return s;if(0>e)return c(o(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new g(t,0)}var s=i(0),a=i(1),I=i(16777216);function l(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function C(e){return-1==e.h}function c(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new g(n,~e.h).add(a)}function d(e,t){return e.add(c(t))}function u(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function A(e,t){this.g=e,this.h=t}function h(e,t){if(l(t))throw Error("division by zero");if(l(e))return new A(s,s);if(C(e))return t=h(c(e),t),new A(c(t.g),c(t.h));if(C(t))return t=h(e,c(t)),new A(c(t.g),t.h);if(30<e.g.length){if(C(e)||C(t))throw Error("slowDivide_ only works with positive integers.");for(var n=a,g=t;0>=g.l(e);)n=m(n),g=m(g);var r=b(n,1),i=b(g,1);for(g=b(g,2),n=b(n,2);!l(g);){var I=i.add(g);0>=I.l(e)&&(r=r.add(n),i=I),g=b(g,1),n=b(n,1)}return t=d(e,r.j(t)),new A(r,t)}for(r=s;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),g=48>=(g=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,g-48),I=(i=o(n)).j(t);C(I)||0<I.l(e);)I=(i=o(n-=g)).j(t);l(i)&&(i=a),r=r.add(i),e=d(e,I)}return new A(r,e)}function m(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new g(n,e.h)}function b(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],o=0;o<r;o++)i[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new g(i,e.h)}(e=g.prototype).m=function(){if(C(this))return-c(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var g=this.i(n);e+=(0<=g?g:4294967296+g)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(l(this))return"0";if(C(this))return"-"+c(this).toString(e);for(var t=o(Math.pow(e,6)),n=this,g="";;){var r=h(n,t).g,i=((0<(n=d(n,r.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(l(n=r))return i+g;for(;6>i.length;)i="0"+i;g=i+g}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return C(e=d(this,e))?-1:l(e)?0:1},e.abs=function(){return C(this)?c(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var o=r+(65535&this.i(i))+(65535&e.i(i)),s=(o>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=s>>>16,o&=65535,s&=65535,n[i]=s<<16|o}return new g(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(l(this)||l(e))return s;if(C(this))return C(e)?c(this).j(c(e)):c(c(this).j(e));if(C(e))return c(this.j(c(e)));if(0>this.l(I)&&0>e.l(I))return o(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var a=this.i(r)>>>16,d=65535&this.i(r),A=e.i(i)>>>16,h=65535&e.i(i);n[2*r+2*i]+=d*h,u(n,2*r+2*i),n[2*r+2*i+1]+=a*h,u(n,2*r+2*i+1),n[2*r+2*i+1]+=d*A,u(n,2*r+2*i+1),n[2*r+2*i+2]+=a*A,u(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new g(n,0)},e.A=function(e){return h(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new g(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new g(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new g(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,Hg=t,g.prototype.add=g.prototype.add,g.prototype.multiply=g.prototype.j,g.prototype.modulo=g.prototype.A,g.prototype.compare=g.prototype.l,g.prototype.toNumber=g.prototype.m,g.prototype.toString=g.prototype.toString,g.prototype.getBits=g.prototype.i,g.fromNumber=o,g.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return c(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var g=o(Math.pow(n,8)),r=s,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),I=parseInt(t.substring(i,i+a),n);8>a?(a=o(Math.pow(n,a)),r=r.j(a).add(o(I))):r=(r=r.j(g)).add(o(I))}return r},Eg=g}).apply(void 0!==Fg?Fg:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var xg,Tg,Kg,Mg,Dg,Lg,Ug,zg,Qg="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Qg&&Qg];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,g){if(g)e:{var r=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var o=e[i];if(!(o in r))break e;r=r[o]}(g=g(i=r[e=e[e.length-1]]))!=i&&null!=g&&t(r,e,{configurable:!0,writable:!0,value:g})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,g=!1,r={next:function(){if(!g&&n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return g=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}(this,(function(e,t){return t}))}}));
/** @license
  
   Copyright The Closure Library Authors.
   SPDX-License-Identifier: Apache-2.0
  */
var g=g||{},r=this||self;function i(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function s(e,t,n){return e.call.apply(e.bind,arguments)}function a(e,t,n){if(!e)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,g),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function I(e,t,n){return(I=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?s:a).apply(null,arguments)}function l(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function C(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,g){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[n].apply(e,r)}}function c(e){const t=e.length;if(0<t){const n=Array(t);for(let g=0;g<t;g++)n[g]=e[g];return n}return[]}function d(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(i(t)){const n=e.length||0,g=t.length||0;e.length=n+g;for(let r=0;r<g;r++)e[n+r]=t[r]}else e.push(t)}}function u(e){return/^[\s\xa0]*$/.test(e)}function A(){var e=r.navigator;return e&&(e=e.userAgent)?e:""}function h(e){return h[" "](e),e}h[" "]=function(){};var m=!(-1==A().indexOf("Gecko")||-1!=A().toLowerCase().indexOf("webkit")&&-1==A().indexOf("Edge")||-1!=A().indexOf("Trident")||-1!=A().indexOf("MSIE")||-1!=A().indexOf("Edge"));function b(e,t,n){for(const g in e)t.call(n,e[g],g,e)}function p(e){const t={};for(const n in e)t[n]=e[n];return t}const y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Z(e,t){let n,g;for(let r=1;r<arguments.length;r++){for(n in g=arguments[r],g)e[n]=g[n];for(let t=0;t<y.length;t++)n=y[t],Object.prototype.hasOwnProperty.call(g,n)&&(e[n]=g[n])}}function f(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function G(e){r.setTimeout((()=>{throw e}),0)}function B(){var e=w;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var S=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new R),(e=>e.reset()));class R{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let v,V=!1,w=new class{constructor(){this.h=this.g=null}add(e,t){const n=S.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},W=()=>{const e=r.Promise.resolve(void 0);v=()=>{e.then(k)}};var k=()=>{for(var e;e=B();){try{e.h.call(e.g)}catch(n){G(n)}var t=S;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}V=!1};function X(){this.s=this.s,this.C=this.C}function N(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}X.prototype.s=!1,X.prototype.ma=function(){this.s||(this.s=!0,this.N())},X.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},N.prototype.h=function(){this.defaultPrevented=!0};var J=function(){if(!r.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};r.addEventListener("test",e,t),r.removeEventListener("test",e,t)}catch(n){}return e}();function Y(e,t){if(N.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,g=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(m){e:{try{h(t.nodeName);var r=!0;break e}catch(i){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,g?(this.clientX=void 0!==g.clientX?g.clientX:g.pageX,this.clientY=void 0!==g.clientY?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:E[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Y.aa.h.call(this)}}C(Y,N);var E={2:"touch",3:"pen",4:"mouse"};Y.prototype.h=function(){Y.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var H="closure_listenable_"+(1e6*Math.random()|0),F=0;function x(e,t,n,g,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!g,this.ha=r,this.key=++F,this.da=this.fa=!1}function T(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function K(e){this.src=e,this.g={},this.h=0}function M(e,t){var n=t.type;if(n in e.g){var g,r=e.g[n],i=Array.prototype.indexOf.call(r,t,void 0);(g=0<=i)&&Array.prototype.splice.call(r,i,1),g&&(T(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function D(e,t,n,g){for(var r=0;r<e.length;++r){var i=e[r];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==g)return r}return-1}K.prototype.add=function(e,t,n,g,r){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=D(e,t,g,r);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new x(t,this.src,i,!!g,r)).fa=n,e.push(t)),t};var L="closure_lm_"+(1e6*Math.random()|0),U={};function z(e,t,n,g,r){if(Array.isArray(t)){for(var i=0;i<t.length;i++)z(e,t[i],n,g,r);return null}return n=$(n),e&&e[H]?e.K(t,n,!!o(g)&&!!g.capture,r):function(e,t,n,g,r,i){if(!t)throw Error("Invalid event type");var s=o(r)?!!r.capture:!!r,a=_(e);if(a||(e[L]=a=new K(e)),n=a.add(t,n,g,s,i),n.proxy)return n;if(g=function(){function e(n){return t.call(e.src,e.listener,n)}const t=P;return e}(),n.proxy=g,g.src=e,g.listener=n,e.addEventListener)J||(r=s),void 0===r&&(r=!1),e.addEventListener(t.toString(),g,r);else if(e.attachEvent)e.attachEvent(j(t.toString()),g);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(g)}return n}(e,t,n,!1,g,r)}function Q(e,t,n,g,r){if(Array.isArray(t))for(var i=0;i<t.length;i++)Q(e,t[i],n,g,r);else g=o(g)?!!g.capture:!!g,n=$(n),e&&e[H]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=D(i=e.g[t],n,g,r))&&(T(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete e.g[t],e.h--)))):e&&(e=_(e))&&(t=e.g[t.toString()],e=-1,t&&(e=D(t,n,g,r)),(n=-1<e?t[e]:null)&&O(n))}function O(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[H])M(t.i,e);else{var n=e.type,g=e.proxy;t.removeEventListener?t.removeEventListener(n,g,e.capture):t.detachEvent?t.detachEvent(j(n),g):t.addListener&&t.removeListener&&t.removeListener(g),(n=_(t))?(M(n,e),0==n.h&&(n.src=null,t[L]=null)):T(e)}}}function j(e){return e in U?U[e]:U[e]="on"+e}function P(e,t){if(e.da)e=!0;else{t=new Y(t,this);var n=e.listener,g=e.ha||e.src;e.fa&&O(e),e=n.call(g,t)}return e}function _(e){return(e=e[L])instanceof K?e:null}var q="__closure_events_fn_"+(1e9*Math.random()>>>0);function $(e){return"function"==typeof e?e:(e[q]||(e[q]=function(t){return e.handleEvent(t)}),e[q])}function ee(){X.call(this),this.i=new K(this),this.M=this,this.F=null}function te(e,t){var n,g=e.F;if(g)for(n=[];g;g=g.F)n.push(g);if(e=e.M,g=t.type||t,"string"==typeof t)t=new N(t,e);else if(t instanceof N)t.target=t.target||e;else{var r=t;Z(t=new N(g,e),r)}if(r=!0,n)for(var i=n.length-1;0<=i;i--){var o=t.g=n[i];r=ne(o,g,!0,t)&&r}if(r=ne(o=t.g=e,g,!0,t)&&r,r=ne(o,g,!1,t)&&r,n)for(i=0;i<n.length;i++)r=ne(o=t.g=n[i],g,!1,t)&&r}function ne(e,t,n,g){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.da&&o.capture==n){var s=o.listener,a=o.ha||o.src;o.fa&&M(e.i,o),r=!1!==s.call(a,g)&&r}}return r&&!g.defaultPrevented}function ge(e,t,n){if("function"==typeof e)n&&(e=I(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=I(e.handleEvent,e)}return 2147483647<Number(t)?-1:r.setTimeout(e,t||0)}function re(e){e.g=ge((()=>{e.g=null,e.i&&(e.i=!1,re(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}C(ee,X),ee.prototype[H]=!0,ee.prototype.removeEventListener=function(e,t,n,g){Q(this,e,t,n,g)},ee.prototype.N=function(){if(ee.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],g=0;g<n.length;g++)T(n[g]);delete t.g[e],t.h--}}this.F=null},ee.prototype.K=function(e,t,n,g){return this.i.add(String(e),t,!1,n,g)},ee.prototype.L=function(e,t,n,g){return this.i.add(String(e),t,!0,n,g)};class ie extends X{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:re(this)}N(){super.N(),this.g&&(r.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function oe(e){X.call(this),this.h=e,this.g={}}C(oe,X);var se=[];function ae(e){b(e.g,(function(e,t){this.g.hasOwnProperty(t)&&O(e)}),e),e.g={}}oe.prototype.N=function(){oe.aa.N.call(this),ae(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ie=r.JSON.stringify,le=r.JSON.parse,Ce=class{stringify(e){return r.JSON.stringify(e,void 0)}parse(e){return r.JSON.parse(e,void 0)}};function ce(){}function de(e){return e.h||(e.h=e.i())}function ue(){}ce.prototype.h=null;var Ae={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function he(){N.call(this,"d")}function me(){N.call(this,"c")}C(he,N),C(me,N);var be={},pe=null;function ye(){return pe=pe||new ee}function Ze(e){N.call(this,be.La,e)}function fe(e){const t=ye();te(t,new Ze(t))}function Ge(e,t){N.call(this,be.STAT_EVENT,e),this.stat=t}function Be(e){const t=ye();te(t,new Ge(t,e))}function Se(e,t){N.call(this,be.Ma,e),this.size=t}function Re(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return r.setTimeout((function(){e()}),t)}function ve(){this.g=!0}function Ve(e,t,n,g){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var g=n[e];if(!(2>g.length)){var r=g[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<r.length;o++)r[o]=""}}}return Ie(n)}catch(s){return t}}(e,n)+(g?" "+g:"")}))}be.La="serverreachability",C(Ze,N),be.STAT_EVENT="statevent",C(Ge,N),be.Ma="timingevent",C(Se,N),ve.prototype.xa=function(){this.g=!1},ve.prototype.info=function(){};var we,We={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ke={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Xe(){}function Ne(e,t,n,g){this.j=e,this.i=t,this.l=n,this.R=g||1,this.U=new oe(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Je}function Je(){this.i=null,this.g="",this.h=!1}C(Xe,ce),Xe.prototype.g=function(){return new XMLHttpRequest},Xe.prototype.i=function(){return{}},we=new Xe;var Ye={},Ee={};function He(e,t,n){e.L=1,e.v=It(rt(t)),e.m=n,e.P=!0,Fe(e,null)}function Fe(e,t){e.F=Date.now(),Ke(e),e.A=rt(e.v);var n=e.A,g=e.R;Array.isArray(g)||(g=[String(g)]),ft(n.i,"t",g),e.C=0,n=e.j.J,e.h=new Je,e.g=ln(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ie(I(e.Y,e,e.g),e.O)),t=e.U,n=e.g,g=e.ca;var r="readystatechange";Array.isArray(r)||(r&&(se[0]=r.toString()),r=se);for(var i=0;i<r.length;i++){var o=z(n,r[i],g||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?p(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),fe(),function(e,t,n,g,r,i){e.info((function(){if(e.g)if(i)for(var o="",s=i.split("&"),a=0;a<s.length;a++){var I=s[a].split("=");if(1<I.length){var l=I[0];I=I[1];var C=l.split("_");o=2<=C.length&&"type"==C[1]?o+(l+"=")+I+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+g+") [attempt "+r+"]: "+t+"\n"+n+"\n"+o}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function xe(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Te(e,t){var n=e.C,g=t.indexOf("\n",n);return-1==g?Ee:(n=Number(t.substring(n,g)),isNaN(n)?Ye:(g+=1)+n>t.length?Ee:(t=t.slice(g,g+n),e.C=g+n,t))}function Ke(e){e.S=Date.now()+e.I,Me(e,e.I)}function Me(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Re(I(e.ba,e),t)}function De(e){e.B&&(r.clearTimeout(e.B),e.B=null)}function Le(e){0==e.j.G||e.J||rn(e.j,e)}function Ue(e){De(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ae(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function ze(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||_e(n.h,e)))if(!e.K&&_e(n.h,e)&&3==n.G){try{var g=n.Da.g.parse(t)}catch(l){g=null}if(Array.isArray(g)&&3==g.length){var r=g;if(0==r[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;gn(n),Qt(n)}en(n),Be(18)}}else n.za=r[1],0<n.za-n.T&&37500>r[2]&&n.F&&0==n.v&&!n.C&&(n.C=Re(I(n.Za,n),6e3));if(1>=Pe(n.h)&&n.ca){try{n.ca()}catch(l){}n.ca=void 0}}else sn(n,11)}else if((e.K||n.g==e)&&gn(n),!u(t))for(r=n.Da.g.parse(t),t=0;t<r.length;t++){let I=r[t];if(n.T=I[0],I=I[1],2==n.G)if("c"==I[0]){n.K=I[1],n.ia=I[2];const t=I[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const r=I[4];null!=r&&(n.Aa=r,n.j.info("SVER="+n.Aa));const l=I[5];null!=l&&"number"==typeof l&&0<l&&(g=1.5*l,n.L=g,n.j.info("backChannelRequestTimeoutMs_="+g)),g=n;const C=e.g;if(C){const e=C.g?C.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=g.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(qe(i,i.h),i.h=null))}if(g.D){const e=C.g?C.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(g.ya=e,at(g.I,g.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((g=n).qa=In(g,g.J?g.ia:null,g.W),o.K){$e(g.h,o);var s=o,a=g.L;a&&(s.I=a),s.B&&(De(s),Ke(s)),g.g=o}else $t(g);0<n.i.length&&jt(n)}else"stop"!=I[0]&&"close"!=I[0]||sn(n,7);else 3==n.G&&("stop"==I[0]||"close"==I[0]?"stop"==I[0]?sn(n,7):zt(n):"noop"!=I[0]&&n.l&&n.l.ta(I),n.v=0)}fe()}catch(l){}}Ne.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Mt(e)?t.j():this.Y(e)},Ne.prototype.Y=function(e){try{if(e==this.g)e:{const c=Mt(this.g);var t=this.g.Ba();this.g.Z();if(!(3>c)&&(3!=c||this.g&&(this.h.h||this.g.oa()||Dt(this.g)))){this.J||4!=c||7==t||fe(),De(this);var n=this.g.Z();this.X=n;t:if(xe(this)){var g=Dt(this.g);e="";var i=g.length,o=4==Mt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ue(this),Le(this);var s="";break t}this.h.i=new r.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(g[t],{stream:!(o&&t==i-1)});g.length=0,this.h.g+=e,this.C=0,s=this.h.g}else s=this.g.oa();if(this.o=200==n,function(e,t,n,g,r,i,o){e.info((function(){return"XMLHTTP RESP ("+g+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+i+" "+o}))}(this.i,this.u,this.A,this.l,this.R,c,n),this.o){if(this.T&&!this.K){t:{if(this.g){var a,I=this.g;if((a=I.g?I.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!u(a)){var l=a;break t}}l=null}if(!(n=l)){this.o=!1,this.s=3,Be(12),Ue(this),Le(this);break e}Ve(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ze(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<s.length;){if(e=Te(this,s),e==Ee){4==c&&(this.s=4,Be(14),n=!1),Ve(this.i,this.l,null,"[Incomplete Response]");break}if(e==Ye){this.s=4,Be(15),Ve(this.i,this.l,s,"[Invalid Chunk]"),n=!1;break}Ve(this.i,this.l,e,null),ze(this,e)}if(xe(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=s.length||this.h.h||(this.s=1,Be(16),n=!1),this.o=this.o&&n,n){if(0<s.length&&!this.W){this.W=!0;var C=this.j;C.g==this&&C.ba&&!C.M&&(C.j.info("Great, no buffering proxy detected. Bytes received: "+s.length),tn(C),C.M=!0,Be(11))}}else Ve(this.i,this.l,s,"[Invalid Chunked Response]"),Ue(this),Le(this)}else Ve(this.i,this.l,s,null),ze(this,s);4==c&&Ue(this),this.o&&!this.J&&(4==c?rn(this.j,this):(this.o=!1,Ke(this)))}else(function(e){const t={};e=(e.g&&2<=Mt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let g=0;g<e.length;g++){if(u(e[g]))continue;var n=f(e[g]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=t[r]||[];t[r]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<s.indexOf("Unknown SID")?(this.s=3,Be(12)):(this.s=0,Be(13)),Ue(this),Le(this)}}}catch(c){}},Ne.prototype.cancel=function(){this.J=!0,Ue(this)},Ne.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(fe(),Be(17)),Ue(this),this.s=2,Le(this)):Me(this,this.S-e)};var Qe=class{constructor(e,t){this.g=e,this.map=t}};function Oe(e){this.l=e||10,r.PerformanceNavigationTiming?e=0<(e=r.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(r.chrome&&r.chrome.loadTimes&&r.chrome.loadTimes()&&r.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function je(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Pe(e){return e.h?1:e.g?e.g.size:0}function _e(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function qe(e,t){e.g?e.g.add(t):e.h=t}function $e(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function et(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return c(e.i)}function tt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(i(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(i(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const g in e)t[n++]=g;return t}}}(e),g=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(i(e)){for(var t=[],n=e.length,g=0;g<n;g++)t.push(e[g]);return t}for(g in t=[],n=0,e)t[n++]=e[g];return t}(e),r=g.length,o=0;o<r;o++)t.call(void 0,g[o],n&&n[o],e)}Oe.prototype.cancel=function(){if(this.i=et(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var nt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof gt){this.h=e.h,it(this,e.j),this.o=e.o,this.g=e.g,ot(this,e.s),this.l=e.l;var t=e.i,n=new bt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),st(this,n),this.m=e.m}else e&&(t=String(e).match(nt))?(this.h=!1,it(this,t[1]||"",!0),this.o=lt(t[2]||""),this.g=lt(t[3]||"",!0),ot(this,t[4]),this.l=lt(t[5]||"",!0),st(this,t[6]||"",!0),this.m=lt(t[7]||"")):(this.h=!1,this.i=new bt(null,this.h))}function rt(e){return new gt(e)}function it(e,t,n){e.j=n?lt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ot(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function st(e,t,n){t instanceof bt?(e.i=t,function(e,t){t&&!e.j&&(pt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(yt(this,t),ft(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Ct(t,ht)),e.i=new bt(t,e.h))}function at(e,t,n){e.i.set(t,n)}function It(e){return at(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function lt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ct(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ct),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ct(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}gt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ct(t,dt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(Ct(t,dt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Ct(n,"/"==n.charAt(0)?At:ut,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",Ct(n,mt)),e.join("")};var dt=/[#\/\?@]/g,ut=/[#\?:]/g,At=/[#\?]/g,ht=/[#\?@]/g,mt=/#/g;function bt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function pt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var g=e[n].indexOf("="),r=null;if(0<=g){var i=e[n].substring(0,g);r=e[n].substring(g+1)}else i=e[n];t(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function yt(e,t){pt(e),t=Gt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Zt(e,t){return pt(e),t=Gt(e,t),e.g.has(t)}function ft(e,t,n){yt(e,t),0<n.length&&(e.i=null,e.g.set(Gt(e,t),c(n)),e.h+=n.length)}function Gt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Bt(e,t,n,g,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),g(n)}catch(i){}}function St(){this.g=new Ce}function Rt(e,t,n){const g=n||"";try{tt(e,(function(e,n){let r=e;o(e)&&(r=Ie(e)),t.push(g+n+"="+encodeURIComponent(r))}))}catch(fp){throw t.push(g+"type="+encodeURIComponent("_badmap")),fp}}function vt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Vt(e,t){ee.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function wt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Wt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,kt(e)}function kt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Xt(e){let t="";return b(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Nt(e,t,n){e:{for(g in n){var g=!1;break e}g=!0}g||(n=Xt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):at(e,t,n))}function Jt(e){ee.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=bt.prototype).add=function(e,t){pt(this),this.i=null,e=Gt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){pt(this),this.g.forEach((function(n,g){n.forEach((function(n){e.call(t,n,g,this)}),this)}),this)},e.na=function(){pt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let g=0;g<t.length;g++){const r=e[g];for(let e=0;e<r.length;e++)n.push(t[g])}return n},e.V=function(e){pt(this);let t=[];if("string"==typeof e)Zt(this,e)&&(t=t.concat(this.g.get(Gt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return pt(this),this.i=null,Zt(this,e=Gt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var g=t[n];const i=encodeURIComponent(String(g)),o=this.V(g);for(g=0;g<o.length;g++){var r=i;""!==o[g]&&(r+="="+encodeURIComponent(String(o[g]))),e.push(r)}}return this.i=e.join("&")},C(vt,ce),vt.prototype.g=function(){return new Vt(this.l,this.j)},vt.prototype.i=function(e){return function(){return e}}({}),C(Vt,ee),(e=Vt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,kt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||r).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Wt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,kt(this)),this.g&&(this.readyState=3,kt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==r.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;wt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Wt(this):kt(this),3==this.readyState&&wt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Wt(this))},e.Qa=function(e){this.g&&(this.response=e,Wt(this))},e.ga=function(){this.g&&Wt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Vt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),C(Jt,ee);var Yt=/^https?$/i,Et=["POST","PUT"];function Ht(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Ft(e),Tt(e)}function Ft(e){e.A||(e.A=!0,te(e,"complete"),te(e,"error"))}function xt(e){if(e.h&&void 0!==g&&(!e.v[1]||4!=Mt(e)||2!=e.Z()))if(e.u&&4==Mt(e))ge(e.Ea,0,e);else if(te(e,"readystatechange"),4==Mt(e)){e.h=!1;try{const g=e.Z();e:switch(g){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===g){var o=String(e.D).match(nt)[1]||null;!o&&r.self&&r.self.location&&(o=r.self.location.protocol.slice(0,-1)),i=!Yt.test(o?o.toLowerCase():"")}n=i}if(n)te(e,"complete"),te(e,"success");else{e.m=6;try{var s=2<Mt(e)?e.g.statusText:""}catch(a){s=""}e.l=s+" ["+e.Z()+"]",Ft(e)}}finally{Tt(e)}}}function Tt(e,t){if(e.g){Kt(e);const n=e.g,g=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||te(e,"ready");try{n.onreadystatechange=g}catch(fp){}}}function Kt(e){e.I&&(r.clearTimeout(e.I),e.I=null)}function Mt(e){return e.g?e.g.readyState:0}function Dt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Lt(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ut(e){this.Aa=0,this.i=[],this.j=new ve,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Lt("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Lt("baseRetryDelayMs",5e3,e),this.cb=Lt("retryDelaySeedMs",1e4,e),this.Wa=Lt("forwardChannelMaxRetries",2,e),this.wa=Lt("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Oe(e&&e.concurrentRequestLimit),this.Da=new St,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function zt(e){if(Ot(e),3==e.G){var t=e.U++,n=rt(e.I);if(at(n,"SID",e.K),at(n,"RID",t),at(n,"TYPE","terminate"),_t(e,n),(t=new Ne(e,e.j,t)).L=2,t.v=It(rt(n)),n=!1,r.navigator&&r.navigator.sendBeacon)try{n=r.navigator.sendBeacon(t.v.toString(),"")}catch(g){}!n&&r.Image&&((new Image).src=t.v,n=!0),n||(t.g=ln(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Ke(t)}an(e)}function Qt(e){e.g&&(tn(e),e.g.cancel(),e.g=null)}function Ot(e){Qt(e),e.u&&(r.clearTimeout(e.u),e.u=null),gn(e),e.h.cancel(),e.s&&("number"==typeof e.s&&r.clearTimeout(e.s),e.s=null)}function jt(e){if(!je(e.h)&&!e.s){e.s=!0;var t=e.Ga;v||W(),V||(v(),V=!0),w.add(t,e),e.B=0}}function Pt(e,t){var n;n=t?t.l:e.U++;const g=rt(e.I);at(g,"SID",e.K),at(g,"RID",n),at(g,"AID",e.T),_t(e,g),e.m&&e.o&&Nt(g,e.m,e.o),n=new Ne(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=qt(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),qe(e.h,n),He(n,g,t)}function _t(e,t){e.H&&b(e.H,(function(e,n){at(t,n,e)})),e.l&&tt({},(function(e,n){at(t,n,e)}))}function qt(e,t,n){n=Math.min(e.i.length,n);var g=e.l?I(e.l.Na,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let o=!0;for(let s=0;s<n;s++){let n=r[s].g;const a=r[s].map;if(n-=t,0>n)t=Math.max(0,r[s].g-100),o=!1;else try{Rt(a,e,"req"+n+"_")}catch(i){g&&g(a)}}if(o){g=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,g}function $t(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;v||W(),V||(v(),V=!0),w.add(t,e),e.v=0}}function en(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Re(I(e.Fa,e),on(e,e.v)),e.v++,!0)}function tn(e){null!=e.A&&(r.clearTimeout(e.A),e.A=null)}function nn(e){e.g=new Ne(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=rt(e.qa);at(t,"RID","rpc"),at(t,"SID",e.K),at(t,"AID",e.T),at(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&at(t,"TO",e.ja),at(t,"TYPE","xmlhttp"),_t(e,t),e.m&&e.o&&Nt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=It(rt(t)),n.m=null,n.P=!0,Fe(n,e)}function gn(e){null!=e.C&&(r.clearTimeout(e.C),e.C=null)}function rn(e,t){var n=null;if(e.g==t){gn(e),tn(e),e.g=null;var g=2}else{if(!_e(e.h,t))return;n=t.D,$e(e.h,t),g=1}if(0!=e.G)if(t.o)if(1==g){n=t.m?t.m.length:0,t=Date.now()-t.F;var r=e.B;te(g=ye(),new Se(g,n)),jt(e)}else $t(e);else if(3==(r=t.s)||0==r&&0<t.X||!(1==g&&function(e,t){return!(Pe(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Re(I(e.Ga,e,t),on(e,e.B)),e.B++,0)))}(e,t)||2==g&&en(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),r){case 1:sn(e,5);break;case 4:sn(e,10);break;case 3:sn(e,6);break;default:sn(e,2)}}function on(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function sn(e,t){if(e.j.info("Error code "+t),2==t){var n=I(e.fb,e),g=e.Xa;const t=!g;g=new gt(g||"//www.google.com/images/cleardot.gif"),r.location&&"http"==r.location.protocol||it(g,"https"),It(g),t?function(e,t){const n=new ve;if(r.Image){const g=new Image;g.onload=l(Bt,n,"TestLoadImage: loaded",!0,t,g),g.onerror=l(Bt,n,"TestLoadImage: error",!1,t,g),g.onabort=l(Bt,n,"TestLoadImage: abort",!1,t,g),g.ontimeout=l(Bt,n,"TestLoadImage: timeout",!1,t,g),r.setTimeout((function(){g.ontimeout&&g.ontimeout()}),1e4),g.src=e}else t(!1)}(g.toString(),n):function(e,t){new ve;const n=new AbortController,g=setTimeout((()=>{n.abort(),Bt(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(g),e.ok?Bt(0,0,!0,t):Bt(0,0,!1,t)})).catch((()=>{clearTimeout(g),Bt(0,0,!1,t)}))}(g.toString(),n)}else Be(2);e.G=0,e.l&&e.l.sa(t),an(e),Ot(e)}function an(e){if(e.G=0,e.ka=[],e.l){const t=et(e.h);0==t.length&&0==e.i.length||(d(e.ka,t),d(e.ka,e.i),e.h.i.length=0,c(e.i),e.i.length=0),e.l.ra()}}function In(e,t,n){var g=n instanceof gt?rt(n):new gt(n);if(""!=g.g)t&&(g.g=t+"."+g.g),ot(g,g.s);else{var i=r.location;g=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var o=new gt(null);g&&it(o,g),t&&(o.g=t),i&&ot(o,i),n&&(o.l=n),g=o}return n=e.D,t=e.ya,n&&t&&at(g,n,t),at(g,"VER",e.la),_t(e,g),g}function ln(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Jt(new vt({eb:n})):new Jt(e.pa)).Ha(e.J),t}function Cn(){}function cn(){}function dn(e,t){ee.call(this),this.g=new Ut(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!u(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!u(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new hn(this)}function un(e){he.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function An(){me.call(this),this.status=1}function hn(e){this.g=e}(e=Jt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():we.g(),this.v=this.o?de(this.o):de(we),this.g.onreadystatechange=I(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void Ht(this,o)}if(e=n||"",n=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var i in g)n.set(i,g[i]);else{if("function"!=typeof g.keys||"function"!=typeof g.get)throw Error("Unknown input type for opt_headers: "+String(g));for(const e of g.keys())n.set(e,g.get(e))}g=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),i=r.FormData&&e instanceof r.FormData,!(0<=Array.prototype.indexOf.call(Et,t,void 0))||g||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,s]of n)this.g.setRequestHeader(r,s);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Kt(this),this.u=!0,this.g.send(e),this.u=!1}catch(o){Ht(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,te(this,"complete"),te(this,"abort"),Tt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Tt(this,!0)),Jt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?xt(this):this.bb())},e.bb=function(){xt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Mt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),le(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Ut.prototype).la=8,e.G=1,e.connect=function(e,t,n,g){Be(0),this.W=e,this.H=t||{},n&&void 0!==g&&(this.H.OSID=n,this.H.OAID=g),this.F=this.X,this.I=In(this,null,this.W),jt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const r=new Ne(this,this.j,e);let i=this.o;if(this.S&&(i?(i=p(i),Z(i,this.S)):i=this.S),null!==this.m||this.O||(r.H=i,i=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var g=this.i[n];if(void 0===(g="__data__"in g.map&&"string"==typeof(g=g.map.__data__)?g.length:void 0))break;if(4096<(t+=g)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=qt(this,r,t),at(n=rt(this.I),"RID",e),at(n,"CVER",22),this.D&&at(n,"X-HTTP-Session-Id",this.D),_t(this,n),i&&(this.O?t="headers="+encodeURIComponent(String(Xt(i)))+"&"+t:this.m&&Nt(n,this.m,i)),qe(this.h,r),this.Ua&&at(n,"TYPE","init"),this.P?(at(n,"$req",t),at(n,"SID","null"),r.T=!0,He(r,n,null)):He(r,n,t),this.G=2}}else 3==this.G&&(e?Pt(this,e):0==this.i.length||je(this.h)||Pt(this))},e.Fa=function(){if(this.u=null,nn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Re(I(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Be(10),Qt(this),nn(this))},e.Za=function(){null!=this.C&&(this.C=null,Qt(this),en(this),Be(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Be(2)):(this.j.info("Failed to ping google.com"),Be(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=Cn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},cn.prototype.g=function(e,t){return new dn(e,t)},C(dn,ee),dn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},dn.prototype.close=function(){zt(this.g)},dn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=Ie(e),e=n);t.i.push(new Qe(t.Ya++,e)),3==t.G&&jt(t)},dn.prototype.N=function(){this.g.l=null,delete this.j,zt(this.g),delete this.g,dn.aa.N.call(this)},C(un,he),C(An,me),C(hn,Cn),hn.prototype.ua=function(){te(this.g,"a")},hn.prototype.ta=function(e){te(this.g,new un(e))},hn.prototype.sa=function(e){te(this.g,new An)},hn.prototype.ra=function(){te(this.g,"b")},cn.prototype.createWebChannel=cn.prototype.g,dn.prototype.send=dn.prototype.o,dn.prototype.open=dn.prototype.m,dn.prototype.close=dn.prototype.close,zg=function(){return new cn},Ug=function(){return ye()},Lg=be,Dg={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},We.NO_ERROR=0,We.TIMEOUT=8,We.HTTP_ERROR=6,Mg=We,ke.COMPLETE="complete",Kg=ke,ue.EventType=Ae,Ae.OPEN="a",Ae.CLOSE="b",Ae.ERROR="c",Ae.MESSAGE="d",ee.prototype.listen=ee.prototype.K,Tg=ue,Jt.prototype.listenOnce=Jt.prototype.L,Jt.prototype.getLastError=Jt.prototype.Ka,Jt.prototype.getLastErrorCode=Jt.prototype.Ba,Jt.prototype.getStatus=Jt.prototype.Z,Jt.prototype.getResponseJson=Jt.prototype.Oa,Jt.prototype.getResponseText=Jt.prototype.oa,Jt.prototype.send=Jt.prototype.ea,Jt.prototype.setWithCredentials=Jt.prototype.Ha,xg=Jt}).apply(void 0!==Qg?Qg:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Og="@firebase/firestore",jg="4.7.16";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Pg.UNAUTHENTICATED=new Pg(null),Pg.GOOGLE_CREDENTIALS=new Pg("google-credentials-uid"),Pg.FIRST_PARTY=new Pg("first-party-uid"),Pg.MOCK_USER=new Pg("mock-user");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let _g="11.8.1";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qg=new pn("@firebase/firestore");function $g(){return qg.logLevel}function er(e,...t){if(qg.logLevel<=dn.DEBUG){const n=t.map(gr);qg.debug(`Firestore (${_g}): ${e}`,...n)}}function tr(e,...t){if(qg.logLevel<=dn.ERROR){const n=t.map(gr);qg.error(`Firestore (${_g}): ${e}`,...n)}}function nr(e,...t){if(qg.logLevel<=dn.WARN){const n=t.map(gr);qg.warn(`Firestore (${_g}): ${e}`,...n)}}function gr(e){if("string"==typeof e)return e;try{
/**
    * @license
    * Copyright 2020 Google LLC
    *
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    *   http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    */
return t=e,JSON.stringify(t)}catch(n){return e}var t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rr(e,t,n){let g="Unexpected state";"string"==typeof t?g=t:n=t,ir(e,g,n)}function ir(e,t,n){let g=`FIRESTORE (${_g}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{g+=" CONTEXT: "+JSON.stringify(n)}catch(r){g+=" CONTEXT: "+n}throw tr(g),new Error(g)}function or(e,t,n,g){let r="Unexpected state";"string"==typeof n?r=n:g=n,e||ir(t,r,g)}function sr(e,t){return e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ar={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ir extends $t{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class cr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Pg.UNAUTHENTICATED)))}shutdown(){}}class dr{constructor(e){this.t=e,this.currentUser=Pg.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){or(void 0===this.o,42304);let n=this.i;const g=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new lr;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new lr,e.enqueueRetryable((()=>g(this.currentUser)))};const i=()=>{const t=r;e.enqueueRetryable((async()=>{await t.promise,await g(this.currentUser)}))},o=e=>{er("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(er("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new lr)}}),0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(er("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(or("string"==typeof t.accessToken,31837,{l:t}),new Cr(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return or(null===e||"string"==typeof e,2055,{h:e}),new Pg(e)}}class ur{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=Pg.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Ar{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new ur(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Pg.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class hr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class mr{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,yg(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){or(void 0===this.o,3512);const n=e=>{null!=e.error&&er("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,er("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const g=e=>{er("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((e=>g(e))),setTimeout((()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?g(e):er("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new hr(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(or("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new hr(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function br(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let g=0;g<e;g++)n[g]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pr(){return new TextEncoder}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=br(40);for(let g=0;g<n.length;++g)t.length<20&&n[g]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[g]%62))}return t}}function Zr(e,t){return e<t?-1:e>t?1:0}function fr(e,t){let n=0;for(;n<e.length&&n<t.length;){const g=e.codePointAt(n),r=t.codePointAt(n);if(g!==r){if(g<128&&r<128)return Zr(g,r);{const i=pr(),o=Br(i.encode(Gr(e,n)),i.encode(Gr(t,n)));return 0!==o?o:Zr(g,r)}}n+=g>65535?2:1}return Zr(e.length,t.length)}function Gr(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function Br(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return Zr(e[n],t[n]);return Zr(e.length,t.length)}function Sr(e,t,n){return e.length===t.length&&e.every(((e,g)=>n(e,t[g])))}function Rr(e){return e+"\0"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vr=-62135596800,Vr=1e6;class wr{static now(){return wr.fromMillis(Date.now())}static fromDate(e){return wr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Vr);return new wr(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Ir(ar.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Ir(ar.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<vr)throw new Ir(ar.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Ir(ar.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Vr}_compareTo(e){return this.seconds===e.seconds?Zr(this.nanoseconds,e.nanoseconds):Zr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-vr;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wr{static fromTimestamp(e){return new Wr(e)}static min(){return new Wr(new wr(0,0))}static max(){return new Wr(new wr(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kr="__name__";class Xr{constructor(e,t,n){void 0===t?t=0:t>e.length&&rr(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&rr(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Xr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Xr?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let g=0;g<n;g++){const n=Xr.compareSegments(e.get(g),t.get(g));if(0!==n)return n}return Zr(e.length,t.length)}static compareSegments(e,t){const n=Xr.isNumericId(e),g=Xr.isNumericId(t);return n&&!g?-1:!n&&g?1:n&&g?Xr.extractNumericId(e).compare(Xr.extractNumericId(t)):fr(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Eg.fromString(e.substring(4,e.length-2))}}class Nr extends Xr{construct(e,t,n){return new Nr(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Ir(ar.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Nr(t)}static emptyPath(){return new Nr([])}}const Jr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Yr extends Xr{construct(e,t,n){return new Yr(e,t,n)}static isValidIdentifier(e){return Jr.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Yr.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===kr}static keyField(){return new Yr([kr])}static fromServerFormat(e){const t=[];let n="",g=0;const r=()=>{if(0===n.length)throw new Ir(ar.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;g<e.length;){const t=e[g];if("\\"===t){if(g+1===e.length)throw new Ir(ar.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[g+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Ir(ar.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,g+=2}else"`"===t?(i=!i,g++):"."!==t||i?(n+=t,g++):(r(),g++)}if(r(),i)throw new Ir(ar.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Yr(t)}static emptyPath(){return new Yr([])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Er{constructor(e){this.path=e}static fromPath(e){return new Er(Nr.fromString(e))}static fromName(e){return new Er(Nr.fromString(e).popFirst(5))}static empty(){return new Er(Nr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Nr.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Nr.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Er(new Nr(e.slice()))}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hr=-1;class Fr{constructor(e,t,n,g){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=g}}function xr(e){return e.fields.find((e=>2===e.kind))}function Tr(e){return e.fields.filter((e=>2!==e.kind))}Fr.UNKNOWN_ID=-1;class Kr{constructor(e,t){this.fieldPath=e,this.kind=t}}class Mr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Mr(0,Ur.min())}}function Dr(e,t){const n=e.toTimestamp().seconds,g=e.toTimestamp().nanoseconds+1,r=Wr.fromTimestamp(1e9===g?new wr(n+1,0):new wr(n,g));return new Ur(r,Er.empty(),t)}function Lr(e){return new Ur(e.readTime,e.key,Hr)}class Ur{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ur(Wr.min(),Er.empty(),Hr)}static max(){return new Ur(Wr.max(),Er.empty(),Hr)}}function zr(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Er.comparator(e.documentKey,t.documentKey),0!==n?n:Zr(e.largestBatchId,t.largestBatchId)
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */)}const Qr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Or{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jr(e){if(e.code!==ar.FAILED_PRECONDITION||e.message!==Qr)throw e;er("LocalStore","Unexpectedly lost primary lease")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&rr(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Pr(((n,g)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,g)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,g)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Pr?t:Pr.resolve(t)}catch(t){return Pr.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Pr.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Pr.reject(t)}static resolve(e){return new Pr(((t,n)=>{t(e)}))}static reject(e){return new Pr(((t,n)=>{n(e)}))}static waitFor(e){return new Pr(((t,n)=>{let g=0,r=0,i=!1;e.forEach((e=>{++g,e.next((()=>{++r,i&&r===g&&t()}),(e=>n(e)))})),i=!0,r===g&&t()}))}static or(e){let t=Pr.resolve(!1);for(const n of e)t=t.next((e=>e?Pr.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,g)=>{n.push(t.call(this,e,g))})),this.waitFor(n)}static mapArray(e,t){return new Pr(((n,g)=>{const r=e.length,i=new Array(r);let o=0;for(let s=0;s<r;s++){const a=s;t(e[a]).next((e=>{i[a]=e,++o,o===r&&n(i)}),(e=>g(e)))}}))}static doWhile(e,t){return new Pr(((n,g)=>{const r=()=>{!0===e()?t().next((()=>{r()}),g):n()};r()}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _r="SimpleDb";class qr{static open(e,t,n,g){try{return new qr(t,e.transaction(g,n))}catch(r){throw new ni(t,r)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new lr,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new ni(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{const n=si(t.target.error);this.S.reject(new ni(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(er(_r,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new ri(t)}}class $r{static delete(e){return er(_r,"Removing database:",e),ii(Ft().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!qt())return!1;if($r.F())return!0;const e=Ot(),t=$r.M(e),n=0<t&&t<10,g=ei(e),r=0<g&&g<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||r)}static F(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,12.2===$r.M(Ot())&&tr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(er(_r,"Opening database:",this.name),this.db=await new Promise(((t,n)=>{const g=indexedDB.open(this.name,this.version);g.onsuccess=e=>{const n=e.target.result;t(n)},g.onblocked=()=>{n(new ni(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},g.onerror=t=>{const g=t.target.error;"VersionError"===g.name?n(new Ir(ar.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===g.name?n(new Ir(ar.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+g)):n(new ni(e,g))},g.onupgradeneeded=e=>{er(_r,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;if(null!==this.L&&this.L!==e.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${e.oldVersion}, event.newVersion=${e.newVersion}, db.version=${t.version}`);this.B.q(t,g.transaction,e.oldVersion,this.version).next((()=>{er(_r,"Database upgrade to version "+this.version+" complete")}))}})),this.db.addEventListener("close",(e=>{const t=e.target;this.L=t.version}),{passive:!0})),this.$&&(this.db.onversionchange=e=>this.$(e)),this.db}U(e){this.$=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,g){const r="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.k(e);const t=qr.open(this.db,e,r?"readonly":"readwrite",n),i=g(t).next((e=>(t.v(),e))).catch((e=>(t.abort(e),Pr.reject(e)))).toPromise();return i.catch((()=>{})),await t.D,i}catch(o){const e=o,t="FirebaseError"!==e.name&&i<3;if(er(_r,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ei(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class ti{constructor(e){this.K=e,this.W=!1,this.G=null}get isDone(){return this.W}get j(){return this.G}set cursor(e){this.K=e}done(){this.W=!0}H(e){this.G=e}delete(){return ii(this.K.delete())}}class ni extends Ir{constructor(e,t){super(ar.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function gi(e){return"IndexedDbTransactionError"===e.name}class ri{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(er(_r,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(er(_r,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ii(n)}add(e){return er(_r,"ADD",this.store.name,e,e),ii(this.store.add(e))}get(e){return ii(this.store.get(e)).next((t=>(void 0===t&&(t=null),er(_r,"GET",this.store.name,e,t),t)))}delete(e){return er(_r,"DELETE",this.store.name,e),ii(this.store.delete(e))}count(){return er(_r,"COUNT",this.store.name),ii(this.store.count())}J(e,t){const n=this.options(e,t),g=n.index?this.store.index(n.index):this.store;if("function"==typeof g.getAll){const e=g.getAll(n.range);return new Pr(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.Y(e,((e,n)=>{t.push(n)})).next((()=>t))}}Z(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Pr(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}X(e,t){er(_r,"DELETE ALL",this.store.name);const n=this.options(e,t);n.ee=!1;const g=this.cursor(n);return this.Y(g,((e,t,n)=>n.delete()))}te(e,t){let n;t?n=e:(n={},t=e);const g=this.cursor(n);return this.Y(g,t)}ne(e){const t=this.cursor({});return new Pr(((n,g)=>{t.onerror=e=>{const t=si(e.target.error);g(t)},t.onsuccess=t=>{const g=t.target.result;g?e(g.primaryKey,g.value).next((e=>{e?g.continue():n()})):n()}}))}Y(e,t){const n=[];return new Pr(((g,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{const r=e.target.result;if(!r)return void g();const i=new ti(r),o=t(r.primaryKey,r.value,i);if(o instanceof Pr){const e=o.catch((e=>(i.done(),Pr.reject(e))));n.push(e)}i.isDone?g():null===i.j?r.continue():r.continue(i.j)}})).next((()=>Pr.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.ee?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ii(e){return new Pr(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=si(e.target.error);n(t)}}))}let oi=!1;function si(e){const t=$r.M(Ot());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Ir("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return oi||(oi=!0,setTimeout((()=>{throw e}),0)),e}}return e}const ai="IndexBackfiller";class Ii{constructor(e,t){this.asyncQueue=e,this.re=t,this.task=null}start(){this.ie(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ie(e){er(ai,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const e=await this.re.se();er(ai,`Documents written: ${e}`)}catch(e){gi(e)?er(ai,"Ignoring IndexedDB error during index backfill: ",e):await jr(e)}await this.ie(6e4)}))}}class li{constructor(e,t){this.localStore=e,this.persistence=t}async se(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.oe(t,e)))}oe(e,t){const n=new Set;let g=t,r=!0;return Pr.doWhile((()=>!0===r&&g>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return er(ai,`Processing collection: ${t}`),this._e(e,t,g).next((e=>{g-=e,n.add(t)}));r=!1})))).next((()=>t-g))}_e(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((g=>this.localStore.localDocuments.getNextDocuments(e,t,g,n).next((n=>{const r=n.changes;return this.localStore.indexManager.updateIndexEntries(e,r).next((()=>this.ae(g,n))).next((n=>(er(ai,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>r.size))}))))}ae(e,t){let n=e;return t.changes.forEach(((e,t)=>{const g=Lr(t);zr(g,n)>0&&(n=g)})),new Ur(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ci{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}Ci.le=-1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ci=-1;function di(e){return null==e}function ui(e){return 0===e&&1/e==-1/0}function Ai(e){return"number"==typeof e&&Number.isInteger(e)&&!ui(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hi="";function mi(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=pi(t)),t=bi(e.get(n),t);return pi(t)}function bi(e,t){let n=t;const g=e.length;for(let r=0;r<g;r++){const t=e.charAt(r);switch(t){case"\0":n+="";break;case hi:n+="";break;default:n+=t}}return n}function pi(e){return e+hi+""}function yi(e){const t=e.length;if(or(t>=2,64408,{path:e}),2===t)return or(e.charAt(0)===hi&&""===e.charAt(1),56145,{path:e}),Nr.emptyPath();const n=t-2,g=[];let r="";for(let i=0;i<t;){const t=e.indexOf(hi,i);switch((t<0||t>n)&&rr(50515,{path:e}),e.charAt(t+1)){case"":const n=e.substring(i,t);let o;0===r.length?o=n:(r+=n,o=r,r=""),g.push(o);break;case"":r+=e.substring(i,t),r+="\0";break;case"":r+=e.substring(i,t+1);break;default:rr(61167,{path:e})}i=t+2}return new Nr(g)}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zi="remoteDocuments",fi="owner",Gi="owner",Bi="mutationQueues",Si="mutations",Ri="batchId",vi="userMutationsIndex",Vi=["userId","batchId"];
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wi(e,t){return[e,mi(t)]}function Wi(e,t,n){return[e,mi(t),n]}const ki={},Xi="documentMutations",Ni="remoteDocumentsV14",Ji=["prefixPath","collectionGroup","readTime","documentId"],Yi="documentKeyIndex",Ei=["prefixPath","collectionGroup","documentId"],Hi="collectionGroupIndex",Fi=["collectionGroup","readTime","prefixPath","documentId"],xi="remoteDocumentGlobal",Ti="remoteDocumentGlobalKey",Ki="targets",Mi="queryTargetsIndex",Di=["canonicalId","targetId"],Li="targetDocuments",Ui=["targetId","path"],zi="documentTargetsIndex",Qi=["path","targetId"],Oi="targetGlobalKey",ji="targetGlobal",Pi="collectionParents",_i=["collectionId","parent"],qi="clientMetadata",$i="bundles",eo="namedQueries",to="indexConfiguration",no="collectionGroupIndex",go="indexState",ro=["indexId","uid"],io="sequenceNumberIndex",oo=["uid","sequenceNumber"],so="indexEntries",ao=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Io="documentKeyIndex",lo=["indexId","uid","orderedDocumentKey"],Co="documentOverlays",co=["userId","collectionPath","documentId"],uo="collectionPathOverlayIndex",Ao=["userId","collectionPath","largestBatchId"],ho="collectionGroupOverlayIndex",mo=["userId","collectionGroup","largestBatchId"],bo="globals",po=[Bi,Si,Xi,Zi,Ki,fi,ji,Li,qi,xi,Pi,$i,eo],yo=[...po,Co],Zo=[Bi,Si,Xi,Ni,Ki,fi,ji,Li,qi,xi,Pi,$i,eo,Co],fo=Zo,Go=[...fo,to,go,so],Bo=Go,So=[...Go,bo],Ro=So;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vo extends Or{constructor(e,t){super(),this.he=e,this.currentSequenceNumber=t}}function Vo(e,t){const n=sr(e);return $r.N(n.he,t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wo(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Wo(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ko(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(e,t){this.comparator=e,this.root=t||Jo.EMPTY}insert(e,t){return new Xo(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Jo.BLACK,null,null))}remove(e){return new Xo(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Jo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const g=this.comparator(e,n.key);if(0===g)return t+n.left.size;g<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new No(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new No(this.root,e,this.comparator,!1)}getReverseIterator(){return new No(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new No(this.root,e,this.comparator,!0)}}class No{constructor(e,t,n,g){this.isReverse=g,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&g&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Jo{constructor(e,t,n,g,r){this.key=e,this.value=t,this.color=null!=n?n:Jo.RED,this.left=null!=g?g:Jo.EMPTY,this.right=null!=r?r:Jo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,g,r){return new Jo(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=g?g:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let g=this;const r=n(e,g.key);return g=r<0?g.copy(null,null,null,g.left.insert(e,t,n),null):0===r?g.copy(null,t,null,null,null):g.copy(null,null,null,null,g.right.insert(e,t,n)),g.fixUp()}removeMin(){if(this.left.isEmpty())return Jo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,g=this;if(t(e,g.key)<0)g.left.isEmpty()||g.left.isRed()||g.left.left.isRed()||(g=g.moveRedLeft()),g=g.copy(null,null,null,g.left.remove(e,t),null);else{if(g.left.isRed()&&(g=g.rotateRight()),g.right.isEmpty()||g.right.isRed()||g.right.left.isRed()||(g=g.moveRedRight()),0===t(e,g.key)){if(g.right.isEmpty())return Jo.EMPTY;n=g.right.min(),g=g.copy(n.key,n.value,null,null,g.right.removeMin())}g=g.copy(null,null,null,null,g.right.remove(e,t))}return g.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Jo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Jo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw rr(43730,{key:this.key,value:this.value});if(this.right.isRed())throw rr(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw rr(27949);return e+(this.isRed()?0:1)}}Jo.EMPTY=null,Jo.RED=!0,Jo.BLACK=!1,Jo.EMPTY=new class{constructor(){this.size=0}get key(){throw rr(57766)}get value(){throw rr(16141)}get color(){throw rr(16727)}get left(){throw rr(29726)}get right(){throw rr(36894)}copy(e,t,n,g,r){return this}insert(e,t,n){return new Jo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Yo{constructor(e){this.comparator=e,this.data=new Xo(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const g=n.getNext();if(this.comparator(g.key,e[1])>=0)return;t(g.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Eo(this.data.getIterator())}getIteratorFrom(e){return new Eo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Yo))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,g=n.getNext().key;if(0!==this.comparator(e,g))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Yo(this.comparator);return t.data=e,t}}class Eo{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ho(e){return e.hasNext()?e.getNext():void 0}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(e){this.fields=e,e.sort(Yr.comparator)}static empty(){return new Fo([])}unionWith(e){let t=new Yo(Yr.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Fo(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Sr(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new xo("Invalid base64 string: "+t):t}}(e);return new To(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new To(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Zr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}To.EMPTY_BYTE_STRING=new To("");const Ko=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mo(e){if(or(!!e,39018),"string"==typeof e){let t=0;const n=Ko.exec(e);if(or(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const g=new Date(e);return{seconds:Math.floor(g.getTime()/1e3),nanos:t}}return{seconds:Do(e.seconds),nanos:Do(e.nanos)}}function Do(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Lo(e){return"string"==typeof e?To.fromBase64String(e):To.fromUint8Array(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uo="server_timestamp",zo="__type__",Qo="__previous_value__",Oo="__local_write_time__";function jo(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[zo])||void 0===n?void 0:n.stringValue)===Uo}function Po(e){const t=e.mapValue.fields[Qo];return jo(t)?Po(t):t}function _o(e){const t=Mo(e.mapValue.fields[Oo].timestampValue);return new wr(t.seconds,t.nanos)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qo{constructor(e,t,n,g,r,i,o,s,a,I){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=g,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=s,this.useFetchStreams=a,this.isUsingEmulator=I}}const $o="(default)";class es{constructor(e,t){this.projectId=e,this.database=t||$o}static empty(){return new es("","")}get isDefaultDatabase(){return this.database===$o}isEqual(e){return e instanceof es&&e.projectId===this.projectId&&e.database===this.database}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ts="__type__",ns="__max__",gs={mapValue:{fields:{__type__:{stringValue:ns}}}},rs="__vector__",is="value",os={nullValue:"NULL_VALUE"};function ss(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?jo(e)?4:Bs(e)?9007199254740991:fs(e)?10:11:rr(28295,{value:e})}function as(e,t){if(e===t)return!0;const n=ss(e);if(n!==ss(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return _o(e).isEqual(_o(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Mo(e.timestampValue),g=Mo(t.timestampValue);return n.seconds===g.seconds&&n.nanos===g.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return g=t,Lo(e.bytesValue).isEqual(Lo(g.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Do(e.geoPointValue.latitude)===Do(t.geoPointValue.latitude)&&Do(e.geoPointValue.longitude)===Do(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Do(e.integerValue)===Do(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Do(e.doubleValue),g=Do(t.doubleValue);return n===g?ui(n)===ui(g):isNaN(n)&&isNaN(g)}return!1}(e,t);case 9:return Sr(e.arrayValue.values||[],t.arrayValue.values||[],as);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},g=t.mapValue.fields||{};if(wo(n)!==wo(g))return!1;for(const r in n)if(n.hasOwnProperty(r)&&(void 0===g[r]||!as(n[r],g[r])))return!1;return!0}(e,t);default:return rr(52216,{left:e})}var g}function Is(e,t){return void 0!==(e.values||[]).find((e=>as(e,t)))}function ls(e,t){if(e===t)return 0;const n=ss(e),g=ss(t);if(n!==g)return Zr(n,g);switch(n){case 0:case 9007199254740991:return 0;case 1:return Zr(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Do(e.integerValue||e.doubleValue),g=Do(t.integerValue||t.doubleValue);return n<g?-1:n>g?1:n===g?0:isNaN(n)?isNaN(g)?0:-1:1}(e,t);case 3:return Cs(e.timestampValue,t.timestampValue);case 4:return Cs(_o(e),_o(t));case 5:return fr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Lo(e),g=Lo(t);return n.compareTo(g)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),g=t.split("/");for(let r=0;r<n.length&&r<g.length;r++){const e=Zr(n[r],g[r]);if(0!==e)return e}return Zr(n.length,g.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Zr(Do(e.latitude),Do(t.latitude));return 0!==n?n:Zr(Do(e.longitude),Do(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return cs(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,g,r,i;const o=e.fields||{},s=t.fields||{},a=null===(n=o[is])||void 0===n?void 0:n.arrayValue,I=null===(g=s[is])||void 0===g?void 0:g.arrayValue,l=Zr((null===(r=null==a?void 0:a.values)||void 0===r?void 0:r.length)||0,(null===(i=null==I?void 0:I.values)||void 0===i?void 0:i.length)||0);return 0!==l?l:cs(a,I)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===gs.mapValue&&t===gs.mapValue)return 0;if(e===gs.mapValue)return 1;if(t===gs.mapValue)return-1;const n=e.fields||{},g=Object.keys(n),r=t.fields||{},i=Object.keys(r);g.sort(),i.sort();for(let o=0;o<g.length&&o<i.length;++o){const e=fr(g[o],i[o]);if(0!==e)return e;const t=ls(n[g[o]],r[i[o]]);if(0!==t)return t}return Zr(g.length,i.length)}(e.mapValue,t.mapValue);default:throw rr(23264,{Pe:n})}}function Cs(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Zr(e,t);const n=Mo(e),g=Mo(t),r=Zr(n.seconds,g.seconds);return 0!==r?r:Zr(n.nanos,g.nanos)}function cs(e,t){const n=e.values||[],g=t.values||[];for(let r=0;r<n.length&&r<g.length;++r){const e=ls(n[r],g[r]);if(e)return e}return Zr(n.length,g.length)}function ds(e){return us(e)}function us(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Mo(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Lo(e.bytesValue).toBase64():"referenceValue"in e?function(e){return Er.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const g of e.values||[])n?n=!1:t+=",",t+=us(g);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",g=!0;for(const r of t)g?g=!1:n+=",",n+=`${r}:${us(e.fields[r])}`;return n+"}"}(e.mapValue):rr(61005,{value:e})}function As(e){switch(ss(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Po(e);return t?16+As(t):16;case 5:return 2*e.stringValue.length;case 6:return Lo(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce(((e,t)=>e+As(t)),0);case 10:case 11:return function(e){let t=0;return Wo(e.fields,((e,n)=>{t+=e.length+As(n)})),t}(e.mapValue);default:throw rr(13486,{value:e})}}function hs(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ms(e){return!!e&&"integerValue"in e}function bs(e){return!!e&&"arrayValue"in e}function ps(e){return!!e&&"nullValue"in e}function ys(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Zs(e){return!!e&&"mapValue"in e}function fs(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[ts])||void 0===n?void 0:n.stringValue)===rs}function Gs(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Wo(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Gs(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Gs(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Bs(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===ns}const Ss={mapValue:{fields:{[ts]:{stringValue:rs},[is]:{arrayValue:{}}}}};function Rs(e){return"nullValue"in e?os:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?hs(es.empty(),Er.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?fs(e)?Ss:{mapValue:{}}:rr(35942,{value:e})}function vs(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?hs(es.empty(),Er.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?Ss:"mapValue"in e?fs(e)?{mapValue:{}}:gs:rr(61959,{value:e})}function Vs(e,t){const n=ls(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function ws(e,t){const n=ls(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws{constructor(e){this.value=e}static empty(){return new Ws({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Zs(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Gs(t)}setAll(e){let t=Yr.emptyPath(),n={},g=[];e.forEach(((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,g),n={},g=[],t=r.popLast()}e?n[r.lastSegment()]=Gs(e):g.push(r.lastSegment())}));const r=this.getFieldsMap(t);this.applyChanges(r,n,g)}delete(e){const t=this.field(e.popLast());Zs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return as(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let g=t.mapValue.fields[e.get(n)];Zs(g)&&g.mapValue.fields||(g={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=g),t=g}return t.mapValue.fields}applyChanges(e,t,n){Wo(t,((t,n)=>e[t]=n));for(const g of n)delete e[g]}clone(){return new Ws(Gs(this.value))}}function ks(e){const t=[];return Wo(e.fields,((e,n)=>{const g=new Yr([e]);if(Zs(n)){const e=ks(n.mapValue).fields;if(0===e.length)t.push(g);else for(const n of e)t.push(g.child(n))}else t.push(g)})),new Fo(t)
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class Xs{constructor(e,t,n,g,r,i,o){this.key=e,this.documentType=t,this.version=n,this.readTime=g,this.createTime=r,this.data=i,this.documentState=o}static newInvalidDocument(e){return new Xs(e,0,Wr.min(),Wr.min(),Wr.min(),Ws.empty(),0)}static newFoundDocument(e,t,n,g){return new Xs(e,1,t,Wr.min(),n,g,0)}static newNoDocument(e,t){return new Xs(e,2,t,Wr.min(),Wr.min(),Ws.empty(),0)}static newUnknownDocument(e,t){return new Xs(e,3,t,Wr.min(),Wr.min(),Ws.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Wr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ws.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ws.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Wr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Xs&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Xs(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ns{constructor(e,t){this.position=e,this.inclusive=t}}function Js(e,t,n){let g=0;for(let r=0;r<e.position.length;r++){const i=t[r],o=e.position[r];if(g=i.field.isKeyField()?Er.comparator(Er.fromName(o.referenceValue),n.key):ls(o,n.data.field(i.field)),"desc"===i.dir&&(g*=-1),0!==g)break}return g}function Ys(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!as(e.position[n],t.position[n]))return!1;return!0}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(e,t="asc"){this.field=e,this.dir=t}}function Hs(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fs{}class xs extends Fs{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new js(e,t,n):"array-contains"===t?new $s(e,n):"in"===t?new ea(e,n):"not-in"===t?new ta(e,n):"array-contains-any"===t?new na(e,n):new xs(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Ps(e,n):new _s(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(ls(t,this.value)):null!==t&&ss(this.value)===ss(t)&&this.matchesComparison(ls(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return rr(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ts extends Fs{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new Ts(e,t)}matches(e){return Ks(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function Ks(e){return"and"===e.op}function Ms(e){return"or"===e.op}function Ds(e){return Ls(e)&&Ks(e)}function Ls(e){for(const t of e.filters)if(t instanceof Ts)return!1;return!0}function Us(e){if(e instanceof xs)return e.field.canonicalString()+e.op.toString()+ds(e.value);if(Ds(e))return e.filters.map((e=>Us(e))).join(",");{const t=e.filters.map((e=>Us(e))).join(",");return`${e.op}(${t})`}}function zs(e,t){return e instanceof xs?(n=e,(g=t)instanceof xs&&n.op===g.op&&n.field.isEqual(g.field)&&as(n.value,g.value)):e instanceof Ts?function(e,t){return t instanceof Ts&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,g)=>e&&zs(n,t.filters[g])),!0)}(e,t):void rr(19439);var n,g}function Qs(e,t){const n=e.filters.concat(t);return Ts.create(n,e.op)}function Os(e){return e instanceof xs?`${(t=e).field.canonicalString()} ${t.op} ${ds(t.value)}`:e instanceof Ts?function(e){return e.op.toString()+" {"+e.getFilters().map(Os).join(" ,")+"}"}(e):"Filter";var t}class js extends xs{constructor(e,t,n){super(e,t,n),this.key=Er.fromName(n.referenceValue)}matches(e){const t=Er.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ps extends xs{constructor(e,t){super(e,"in",t),this.keys=qs("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class _s extends xs{constructor(e,t){super(e,"not-in",t),this.keys=qs("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function qs(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Er.fromName(e.referenceValue)))}class $s extends xs{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return bs(t)&&Is(t.arrayValue,this.value)}}class ea extends xs{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Is(this.value.arrayValue,t)}}class ta extends xs{constructor(e,t){super(e,"not-in",t)}matches(e){if(Is(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Is(this.value.arrayValue,t)}}class na extends xs{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!bs(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Is(this.value.arrayValue,e)))}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(e,t=null,n=[],g=[],r=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=g,this.limit=r,this.startAt=i,this.endAt=o,this.Ie=null}}function ra(e,t=null,n=[],g=[],r=null,i=null,o=null){return new ga(e,t,n,g,r,i,o)}function ia(e){const t=sr(e);if(null===t.Ie){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Us(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>{return(t=e).field.canonicalString()+t.dir;var t})).join(","),di(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>ds(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>ds(e))).join(",")),t.Ie=e}return t.Ie}function oa(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Hs(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!zs(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ys(e.startAt,t.startAt)&&Ys(e.endAt,t.endAt)}function sa(e){return Er.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function aa(e,t){return e.filters.filter((e=>e instanceof xs&&e.field.isEqual(t)))}function Ia(e,t,n){let g=os,r=!0;for(const i of aa(e,t)){let e=os,t=!0;switch(i.op){case"<":case"<=":e=Rs(i.value);break;case"==":case"in":case">=":e=i.value;break;case">":e=i.value,t=!1;break;case"!=":case"not-in":e=os}Vs({value:g,inclusive:r},{value:e,inclusive:t})<0&&(g=e,r=t)}if(null!==n)for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){const e=n.position[i];Vs({value:g,inclusive:r},{value:e,inclusive:n.inclusive})<0&&(g=e,r=n.inclusive);break}return{value:g,inclusive:r}}function la(e,t,n){let g=gs,r=!0;for(const i of aa(e,t)){let e=gs,t=!0;switch(i.op){case">=":case">":e=vs(i.value),t=!1;break;case"==":case"in":case"<=":e=i.value;break;case"<":e=i.value,t=!1;break;case"!=":case"not-in":e=gs}ws({value:g,inclusive:r},{value:e,inclusive:t})>0&&(g=e,r=t)}if(null!==n)for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){const e=n.position[i];ws({value:g,inclusive:r},{value:e,inclusive:n.inclusive})>0&&(g=e,r=n.inclusive);break}return{value:g,inclusive:r}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(e,t=null,n=[],g=[],r=null,i="F",o=null,s=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=g,this.limit=r,this.limitType=i,this.startAt=o,this.endAt=s,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function ca(e,t,n,g,r,i,o,s){return new Ca(e,t,n,g,r,i,o,s)}function da(e){return new Ca(e)}function ua(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Aa(e){return null!==e.collectionGroup}function ha(e){const t=sr(e);if(null===t.Ee){t.Ee=[];const e=new Set;for(const g of t.explicitOrderBy)t.Ee.push(g),e.add(g.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new Yo(Yr.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t})(t).forEach((g=>{e.has(g.canonicalString())||g.isKeyField()||t.Ee.push(new Es(g,n))})),e.has(Yr.keyField().canonicalString())||t.Ee.push(new Es(Yr.keyField(),n))}return t.Ee}function ma(e){const t=sr(e);return t.de||(t.de=function(e,t){if("F"===e.limitType)return ra(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new Es(e.field,t)}));const n=e.endAt?new Ns(e.endAt.position,e.endAt.inclusive):null,g=e.startAt?new Ns(e.startAt.position,e.startAt.inclusive):null;return ra(e.path,e.collectionGroup,t,e.filters,e.limit,n,g)}}(t,ha(e))),t.de}function ba(e,t){const n=e.filters.concat([t]);return new Ca(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function pa(e,t,n){return new Ca(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ya(e,t){return oa(ma(e),ma(t))&&e.limitType===t.limitType}function Za(e){return`${ia(ma(e))}|lt:${e.limitType}`}function fa(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Os(e))).join(", ")}]`),di(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t})).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>ds(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>ds(e))).join(",")),`Target(${t})`}(ma(e))}; limitType=${e.limitType})`}function Ga(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Er.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of ha(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(g=t,!((n=e).startAt&&!function(e,t,n){const g=Js(e,t,n);return e.inclusive?g<=0:g<0}(n.startAt,ha(n),g)||n.endAt&&!function(e,t,n){const g=Js(e,t,n);return e.inclusive?g>=0:g>0}(n.endAt,ha(n),g)));var n,g}function Ba(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Sa(e){return(t,n)=>{let g=!1;for(const r of ha(e)){const e=Ra(r,t,n);if(0!==e)return e;g=g||r.field.isKeyField()}return 0}}function Ra(e,t,n){const g=e.field.isKeyField()?Er.comparator(t.key,n.key):function(e,t,n){const g=t.data.field(e),r=n.data.field(e);return null!==g&&null!==r?ls(g,r):rr(42886)}(e.field,t,n);switch(e.dir){case"asc":return g;case"desc":return-1*g;default:return rr(19790,{direction:e.dir})}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[g,r]of n)if(this.equalsFn(g,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),g=this.inner[n];if(void 0===g)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<g.length;r++)if(this.equalsFn(g[r][0],e))return void(g[r]=[e,t]);g.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let g=0;g<n.length;g++)if(this.equalsFn(n[g][0],e))return 1===n.length?delete this.inner[t]:n.splice(g,1),this.innerSize--,!0;return!1}forEach(e){Wo(this.inner,((t,n)=>{for(const[g,r]of n)e(g,r)}))}isEmpty(){return ko(this.inner)}size(){return this.innerSize}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Va=new Xo(Er.comparator);function wa(){return Va}const Wa=new Xo(Er.comparator);function ka(...e){let t=Wa;for(const n of e)t=t.insert(n.key,n);return t}function Xa(e){let t=Wa;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Na(){return Ya()}function Ja(){return Ya()}function Ya(){return new va((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Ea=new Xo(Er.comparator),Ha=new Yo(Er.comparator);function Fa(...e){let t=Ha;for(const n of e)t=t.add(n);return t}const xa=new Yo(Zr);function Ta(){return xa}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ka(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ui(t)?"-0":t}}function Ma(e){return{integerValue:""+e}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Da{constructor(){this._=void 0}}function La(e,t,n){return e instanceof Qa?function(e,t){const n={fields:{[zo]:{stringValue:Uo},[Oo]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&jo(t)&&(t=Po(t)),t&&(n.fields[Qo]=t),{mapValue:n}}(n,t):e instanceof Oa?ja(e,t):e instanceof Pa?_a(e,t):function(e,t){const n=za(e,t),g=$a(n)+$a(e.Re);return ms(n)&&ms(e.Re)?Ma(g):Ka(e.serializer,g)}(e,t)}function Ua(e,t,n){return e instanceof Oa?ja(e,t):e instanceof Pa?_a(e,t):n}function za(e,t){return e instanceof qa?ms(n=t)||(g=n)&&"doubleValue"in g?t:{integerValue:0}:null;var n,g}class Qa extends Da{}class Oa extends Da{constructor(e){super(),this.elements=e}}function ja(e,t){const n=eI(t);for(const g of e.elements)n.some((e=>as(e,g)))||n.push(g);return{arrayValue:{values:n}}}class Pa extends Da{constructor(e){super(),this.elements=e}}function _a(e,t){let n=eI(t);for(const g of e.elements)n=n.filter((e=>!as(e,g)));return{arrayValue:{values:n}}}class qa extends Da{constructor(e,t){super(),this.serializer=e,this.Re=t}}function $a(e){return Do(e.integerValue||e.doubleValue)}function eI(e){return bs(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI{constructor(e,t){this.field=e,this.transform=t}}class nI{constructor(e,t){this.version=e,this.transformResults=t}}class gI{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new gI}static exists(e){return new gI(void 0,e)}static updateTime(e){return new gI(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rI(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class iI{}function oI(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new hI(e.key,gI.none()):new CI(e.key,e.data,gI.none());{const n=e.data,g=Ws.empty();let r=new Yo(Yr.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?g.delete(e):g.set(e,t),r=r.add(e)}return new cI(e.key,g,new Fo(r.toArray()),gI.none())}}function sI(e,t,n){var g;e instanceof CI?function(e,t,n){const g=e.value.clone(),r=uI(e.fieldTransforms,t,n.transformResults);g.setAll(r),t.convertToFoundDocument(n.version,g).setHasCommittedMutations()}(e,t,n):e instanceof cI?function(e,t,n){if(!rI(e.precondition,t))return void t.convertToUnknownDocument(n.version);const g=uI(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(dI(e)),r.setAll(g),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):(g=n,t.convertToNoDocument(g.version).setHasCommittedMutations())}function aI(e,t,n,g){return e instanceof CI?function(e,t,n,g){if(!rI(e.precondition,t))return n;const r=e.value.clone(),i=AI(e.fieldTransforms,g,t);return r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,g):e instanceof cI?function(e,t,n,g){if(!rI(e.precondition,t))return n;const r=AI(e.fieldTransforms,g,t),i=t.data;return i.setAll(dI(e)),i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,g):(r=t,i=n,rI(e.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):i);var r,i}function II(e,t){let n=null;for(const g of e.fieldTransforms){const e=t.data.field(g.field),r=za(g.transform,e||null);null!=r&&(null===n&&(n=Ws.empty()),n.set(g.field,r))}return n||null}function lI(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,g=t.fieldTransforms,!!(void 0===n&&void 0===g||n&&g&&Sr(n,g,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&(n=e.transform,g=t.transform,n instanceof Oa&&g instanceof Oa||n instanceof Pa&&g instanceof Pa?Sr(n.elements,g.elements,as):n instanceof qa&&g instanceof qa?as(n.Re,g.Re):n instanceof Qa&&g instanceof Qa);var n,g}(e,t))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,g}class CI extends iI{constructor(e,t,n,g=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=g,this.type=0}getFieldMask(){return null}}class cI extends iI{constructor(e,t,n,g,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=g,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function dI(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const g=e.data.field(n);t.set(n,g)}})),t}function uI(e,t,n){const g=new Map;or(e.length===n.length,32656,{Ve:n.length,me:e.length});for(let r=0;r<n.length;r++){const i=e[r],o=i.transform,s=t.data.field(i.field);g.set(i.field,Ua(o,s,n[r]))}return g}function AI(e,t,n){const g=new Map;for(const r of e){const e=r.transform,i=n.data.field(r.field);g.set(r.field,La(e,i,t))}return g}class hI extends iI{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class mI extends iI{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bI{constructor(e,t,n,g){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=g}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let g=0;g<this.mutations.length;g++){const t=this.mutations[g];t.key.isEqual(e.key)&&sI(t,e,n[g])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=aI(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=aI(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Ja();return this.mutations.forEach((g=>{const r=e.get(g.key),i=r.overlayedDocument;let o=this.applyToLocalView(i,r.mutatedFields);o=t.has(g.key)?null:o;const s=oI(i,o);null!==s&&n.set(g.key,s),i.isValidDocument()||i.convertToNoDocument(Wr.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Fa())}isEqual(e){return this.batchId===e.batchId&&Sr(this.mutations,e.mutations,((e,t)=>lI(e,t)))&&Sr(this.baseMutations,e.baseMutations,((e,t)=>lI(e,t)))}}class pI{constructor(e,t,n,g){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=g}static from(e,t,n){or(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let g=function(){return Ea}();const r=e.mutations;for(let i=0;i<r.length;i++)g=g.insert(r[i].key,n[i].version);return new pI(e,t,n,g)}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yI{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZI{constructor(e,t){this.count=e,this.unchangedNames=t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fI,GI;function BI(e){if(void 0===e)return tr("GRPC error has no .code"),ar.UNKNOWN;switch(e){case fI.OK:return ar.OK;case fI.CANCELLED:return ar.CANCELLED;case fI.UNKNOWN:return ar.UNKNOWN;case fI.DEADLINE_EXCEEDED:return ar.DEADLINE_EXCEEDED;case fI.RESOURCE_EXHAUSTED:return ar.RESOURCE_EXHAUSTED;case fI.INTERNAL:return ar.INTERNAL;case fI.UNAVAILABLE:return ar.UNAVAILABLE;case fI.UNAUTHENTICATED:return ar.UNAUTHENTICATED;case fI.INVALID_ARGUMENT:return ar.INVALID_ARGUMENT;case fI.NOT_FOUND:return ar.NOT_FOUND;case fI.ALREADY_EXISTS:return ar.ALREADY_EXISTS;case fI.PERMISSION_DENIED:return ar.PERMISSION_DENIED;case fI.FAILED_PRECONDITION:return ar.FAILED_PRECONDITION;case fI.ABORTED:return ar.ABORTED;case fI.OUT_OF_RANGE:return ar.OUT_OF_RANGE;case fI.UNIMPLEMENTED:return ar.UNIMPLEMENTED;case fI.DATA_LOSS:return ar.DATA_LOSS;default:return rr(39323,{code:e})}}(GI=fI||(fI={}))[GI.OK=0]="OK",GI[GI.CANCELLED=1]="CANCELLED",GI[GI.UNKNOWN=2]="UNKNOWN",GI[GI.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",GI[GI.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",GI[GI.NOT_FOUND=5]="NOT_FOUND",GI[GI.ALREADY_EXISTS=6]="ALREADY_EXISTS",GI[GI.PERMISSION_DENIED=7]="PERMISSION_DENIED",GI[GI.UNAUTHENTICATED=16]="UNAUTHENTICATED",GI[GI.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",GI[GI.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",GI[GI.ABORTED=10]="ABORTED",GI[GI.OUT_OF_RANGE=11]="OUT_OF_RANGE",GI[GI.UNIMPLEMENTED=12]="UNIMPLEMENTED",GI[GI.INTERNAL=13]="INTERNAL",GI[GI.UNAVAILABLE=14]="UNAVAILABLE",GI[GI.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const SI=new Eg([4294967295,4294967295],0);function RI(e){const t=pr().encode(e),n=new Hg;return n.update(t),new Uint8Array(n.digest())}function vI(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),g=t.getUint32(4,!0),r=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Eg([n,g],0),new Eg([r,i],0)]}class VI{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new wI(`Invalid padding: ${t}`);if(n<0)throw new wI(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new wI(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new wI(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=Eg.fromNumber(this.pe)}we(e,t,n){let g=e.add(t.multiply(Eg.fromNumber(n)));return 1===g.compare(SI)&&(g=new Eg([g.getBits(0),g.getBits(1)],0)),g.modulo(this.ye).toNumber()}Se(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;const t=RI(e),[n,g]=vI(t);for(let r=0;r<this.hashCount;r++){const e=this.we(n,g,r);if(!this.Se(e))return!1}return!0}static create(e,t,n){const g=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),i=new VI(r,g,t);return n.forEach((e=>i.insert(e))),i}insert(e){if(0===this.pe)return;const t=RI(e),[n,g]=vI(t);for(let r=0;r<this.hashCount;r++){const e=this.we(n,g,r);this.be(e)}}be(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class wI extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WI{constructor(e,t,n,g,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=g,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const g=new Map;return g.set(e,kI.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new WI(Wr.min(),g,new Xo(Zr),wa(),Fa())}}class kI{constructor(e,t,n,g,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=g,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new kI(n,t,Fa(),Fa(),Fa())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XI{constructor(e,t,n,g){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=g}}class NI{constructor(e,t){this.targetId=e,this.Ce=t}}class JI{constructor(e,t,n=To.EMPTY_BYTE_STRING,g=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=g}}class YI{constructor(){this.Fe=0,this.Me=FI(),this.xe=To.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=Fa(),t=Fa(),n=Fa();return this.Me.forEach(((g,r)=>{switch(r){case 0:e=e.add(g);break;case 2:t=t.add(g);break;case 1:n=n.add(g);break;default:rr(38017,{changeType:r})}})),new kI(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=FI()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,or(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class EI{constructor(e){this.ze=e,this.je=new Map,this.He=wa(),this.Je=HI(),this.Ye=HI(),this.Ze=new Xo(Zr)}Xe(e){for(const t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(const t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,(t=>{const n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:rr(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach(((e,n)=>{this.it(n)&&t(n)}))}ot(e){const t=e.targetId,n=e.Ce.count,g=this._t(t);if(g){const r=g.target;if(sa(r))if(0===n){const e=new Er(r.path);this.tt(t,e,Xs.newNoDocument(e,Wr.min()))}else or(1===n,20013,{expectedCount:n});else{const g=this.ut(t);if(g!==n){const n=this.ct(e),r=n?this.lt(n,e,g):1;if(0!==r){this.st(t);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,e)}}}}}ct(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:g=0},hashCount:r=0}=t;let i,o;try{i=Lo(n).toUint8Array()}catch(s){if(s instanceof xo)return nr("Decoding the base64 bloom filter in existence filter failed ("+s.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw s}try{o=new VI(i,g,r)}catch(s){return nr(s instanceof wI?"BloomFilter error: ":"Applying bloom filter failed: ",s),null}return 0===o.pe?null:o}lt(e,t,n){return t.Ce.count===n-this.Tt(e,t.targetId)?0:2}Tt(e,t){const n=this.ze.getRemoteKeysForTarget(t);let g=0;return n.forEach((n=>{const r=this.ze.Pt(),i=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.tt(t,n,null),g++)})),g}It(e){const t=new Map;this.je.forEach(((n,g)=>{const r=this._t(g);if(r){if(n.current&&sa(r.target)){const t=new Er(r.target.path);this.Et(t).has(g)||this.dt(g,t)||this.tt(g,t,Xs.newNoDocument(t,e))}n.Le&&(t.set(g,n.qe()),n.Qe())}}));let n=Fa();this.Ye.forEach(((e,t)=>{let g=!0;t.forEachWhile((e=>{const t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(g=!1,!1)})),g&&(n=n.add(e))})),this.He.forEach(((t,n)=>n.setReadTime(e)));const g=new WI(e,t,this.Ze,this.He,n);return this.He=wa(),this.Je=HI(),this.Ye=HI(),this.Ze=new Xo(Zr),g}et(e,t){if(!this.it(e))return;const n=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;const g=this.rt(e);this.dt(e,t)?g.$e(t,1):g.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){const t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new YI,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new Yo(Zr),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new Yo(Zr),this.Je=this.Je.insert(e,t)),t}it(e){const t=null!==this._t(e);return t||er("WatchChangeAggregator","Detected inactive target",e),t}_t(e){const t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new YI),this.ze.getRemoteKeysForTarget(e).forEach((t=>{this.tt(e,t,null)}))}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function HI(){return new Xo(Er.comparator)}function FI(){return new Xo(Er.comparator)}const xI=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),TI=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),KI=(()=>({and:"AND",or:"OR"}))();class MI{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function DI(e,t){return e.useProto3Json||di(t)?t:{value:t}}function LI(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function UI(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function zI(e,t){return LI(e,t.toTimestamp())}function QI(e){return or(!!e,49232),Wr.fromTimestamp(function(e){const t=Mo(e);return new wr(t.seconds,t.nanos)}(e))}function OI(e,t){return jI(e,t).canonicalString()}function jI(e,t){const n=(g=e,new Nr(["projects",g.projectId,"databases",g.database])).child("documents");var g;return void 0===t?n:n.child(t)}function PI(e){const t=Nr.fromString(e);return or(ml(t),10190,{key:t.toString()}),t}function _I(e,t){return OI(e.databaseId,t.path)}function qI(e,t){const n=PI(t);if(n.get(1)!==e.databaseId.projectId)throw new Ir(ar.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Ir(ar.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Er(nl(n))}function $I(e,t){return OI(e.databaseId,t)}function el(e){const t=PI(e);return 4===t.length?Nr.emptyPath():nl(t)}function tl(e){return new Nr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function nl(e){return or(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function gl(e,t,n){return{name:_I(e,t),fields:n.value.mapValue.fields}}function rl(e,t){let n;if(t instanceof CI)n={update:gl(e,t.key,t.value)};else if(t instanceof hI)n={delete:_I(e,t.key)};else if(t instanceof cI)n={update:gl(e,t.key,t.data),updateMask:hl(t.fieldMask)};else{if(!(t instanceof mI))return rr(16599,{ft:t.type});n={verify:_I(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Qa)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Oa)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Pa)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof qa)return{fieldPath:t.field.canonicalString(),increment:n.Re};throw rr(20930,{transform:t.transform})}(0,e)))),t.precondition.isNone||(n.currentDocument=(g=e,void 0!==(r=t.precondition).updateTime?{updateTime:zI(g,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:rr(27497))),n;var g,r}function il(e,t){const n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?gI.updateTime(QI(r.updateTime)):void 0!==r.exists?gI.exists(r.exists):gI.none():gI.none(),g=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)or("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new Qa;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Oa(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Pa(e)}else"increment"in t?n=new qa(e,t.increment):rr(16584,{proto:t});const g=Yr.fromServerFormat(t.fieldPath);return new tI(g,n)}(e,t))):[];var r;if(t.update){t.update.name;const r=qI(e,t.update.name),i=new Ws({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Fo(t.map((e=>Yr.fromServerFormat(e))))}(t.updateMask);return new cI(r,i,e,n,g)}return new CI(r,i,n,g)}if(t.delete){const g=qI(e,t.delete);return new hI(g,n)}if(t.verify){const g=qI(e,t.verify);return new mI(g,n)}return rr(1463,{proto:t})}function ol(e,t){return{documents:[$I(e,t.path)]}}function sl(e,t){const n={structuredQuery:{}},g=t.path;let r;null!==t.collectionGroup?(r=g,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=g.popLast(),n.structuredQuery.from=[{collectionId:g.lastSegment()}]),n.parent=$I(e,r);const i=function(e){if(0!==e.length)return Al(Ts.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const o=function(e){if(0!==e.length)return e.map((e=>{return{field:dl((t=e).field),direction:ll(t.dir)};var t}))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const s=DI(e,t.limit);return null!==s&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{gt:n,parent:r};var a}function al(e){let t=el(e.parent);const n=e.structuredQuery,g=n.from?n.from.length:0;let r=null;if(g>0){or(1===g,65062);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=Il(e);return t instanceof Ts&&Ds(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>{return new Es(ul((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t})));let s=null;n.limit&&(s=function(e){let t;return t="object"==typeof e?e.value:e,di(t)?null:t}(n.limit));let a=null;n.startAt&&(a=function(e){const t=!!e.before,n=e.values||[];return new Ns(n,t)}(n.startAt));let I=null;return n.endAt&&(I=function(e){const t=!e.before,n=e.values||[];return new Ns(n,t)}(n.endAt)),ca(t,r,o,i,s,"F",a,I)}function Il(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ul(e.unaryFilter.field);return xs.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=ul(e.unaryFilter.field);return xs.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const g=ul(e.unaryFilter.field);return xs.create(g,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=ul(e.unaryFilter.field);return xs.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return rr(61313);default:return rr(60726)}}(e):void 0!==e.fieldFilter?(t=e,xs.create(ul(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return rr(58110);default:return rr(50506)}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return Ts.create(e.compositeFilter.filters.map((e=>Il(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return rr(1026)}}(e.compositeFilter.op))}(e):rr(30097,{filter:e});var t}function ll(e){return xI[e]}function Cl(e){return TI[e]}function cl(e){return KI[e]}function dl(e){return{fieldPath:e.canonicalString()}}function ul(e){return Yr.fromServerFormat(e.fieldPath)}function Al(e){return e instanceof xs?function(e){if("=="===e.op){if(ys(e.value))return{unaryFilter:{field:dl(e.field),op:"IS_NAN"}};if(ps(e.value))return{unaryFilter:{field:dl(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ys(e.value))return{unaryFilter:{field:dl(e.field),op:"IS_NOT_NAN"}};if(ps(e.value))return{unaryFilter:{field:dl(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dl(e.field),op:Cl(e.op),value:e.value}}}(e):e instanceof Ts?function(e){const t=e.getFilters().map((e=>Al(e)));return 1===t.length?t[0]:{compositeFilter:{op:cl(e.op),filters:t}}}(e):rr(54877,{filter:e})}function hl(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function ml(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bl{constructor(e,t,n,g,r=Wr.min(),i=Wr.min(),o=To.EMPTY_BYTE_STRING,s=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=g,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=s}withSequenceNumber(e){return new bl(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new bl(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new bl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new bl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{constructor(e){this.wt=e}}function yl(e,t){let n;if(t.document)n=function(e,t,n){const g=qI(e,t.name),r=QI(t.updateTime),i=t.createTime?QI(t.createTime):Wr.min(),o=new Ws({mapValue:{fields:t.fields}}),s=Xs.newFoundDocument(g,r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}(e.wt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=Er.fromSegments(t.noDocument.path),g=Bl(t.noDocument.readTime);n=Xs.newNoDocument(e,g),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return rr(56709);{const e=Er.fromSegments(t.unknownDocument.path),g=Bl(t.unknownDocument.version);n=Xs.newUnknownDocument(e,g)}}return t.readTime&&n.setReadTime(function(e){const t=new wr(e[0],e[1]);return Wr.fromTimestamp(t)}(t.readTime)),n}function Zl(e,t){const n=t.key,g={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:fl(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())g.document={name:_I(r=e.wt,(i=t).key),fields:i.data.value.mapValue.fields,updateTime:LI(r,i.version.toTimestamp()),createTime:LI(r,i.createTime.toTimestamp())};else if(t.isNoDocument())g.noDocument={path:n.path.toArray(),readTime:Gl(t.version)};else{if(!t.isUnknownDocument())return rr(57904,{document:t});g.unknownDocument={path:n.path.toArray(),version:Gl(t.version)}}var r,i;return g}function fl(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Gl(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Bl(e){const t=new wr(e.seconds,e.nanoseconds);return Wr.fromTimestamp(t)}function Sl(e,t){const n=(t.baseMutations||[]).map((t=>il(e.wt,t)));for(let i=0;i<t.mutations.length-1;++i){const e=t.mutations[i];if(i+1<t.mutations.length&&void 0!==t.mutations[i+1].transform){const n=t.mutations[i+1];e.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}const g=t.mutations.map((t=>il(e.wt,t))),r=wr.fromMillis(t.localWriteTimeMs);return new bI(t.batchId,r,n,g)}function Rl(e){const t=Bl(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Bl(e.lastLimboFreeSnapshotVersion):Wr.min();let g;return g=void 0!==e.query.documents?function(e){const t=e.documents.length;return or(1===t,1966,{count:t}),ma(da(el(e.documents[0])))}(e.query):function(e){return ma(al(e))}(e.query),new bl(g,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,To.fromBase64String(e.resumeToken))}function vl(e,t){const n=Gl(t.snapshotVersion),g=Gl(t.lastLimboFreeSnapshotVersion);let r;r=sa(t.target)?ol(e.wt,t.target):sl(e.wt,t.target).gt;const i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:ia(t.target),readTime:n,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:g,query:r}}function Vl(e){const t=al({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?pa(t,t.limit,"L"):t}function wl(e,t){return new yI(t.largestBatchId,il(e.wt,t.overlayMutation))}function Wl(e,t){const n=t.path.lastSegment();return[e,mi(t.path.popLast()),n]}function kl(e,t,n,g){return{indexId:e,uid:t,sequenceNumber:n,readTime:Gl(g.readTime),documentKey:mi(g.documentKey.path),largestBatchId:g.largestBatchId}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xl{getBundleMetadata(e,t){return Nl(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:Bl(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return Nl(e).put({bundleId:(n=t).id,createTime:Gl(QI(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return Jl(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:Vl(t.bundledQuery),readTime:Bl(t.readTime)};var t}))}saveNamedQuery(e,t){return Jl(e).put({name:(n=t).name,readTime:Gl(QI(n.readTime)),bundledQuery:n.bundledQuery});var n}}function Nl(e){return Vo(e,$i)}function Jl(e){return Vo(e,eo)}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yl{constructor(e,t){this.serializer=e,this.userId=t}static St(e,t){const n=t.uid||"";return new Yl(e,n)}getOverlay(e,t){return El(e).get(Wl(this.userId,t)).next((e=>e?wl(this.serializer,e):null))}getOverlays(e,t){const n=Na();return Pr.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const g=[];return n.forEach(((n,r)=>{const i=new yI(t,r);g.push(this.bt(e,i))})),Pr.waitFor(g)}removeOverlaysForBatchId(e,t,n){const g=new Set;t.forEach((e=>g.add(mi(e.getCollectionPath()))));const r=[];return g.forEach((t=>{const g=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);r.push(El(e).X(uo,g))})),Pr.waitFor(r)}getOverlaysForCollection(e,t,n){const g=Na(),r=mi(t),i=IDBKeyRange.bound([this.userId,r,n],[this.userId,r,Number.POSITIVE_INFINITY],!0);return El(e).J(uo,i).next((e=>{for(const t of e){const e=wl(this.serializer,t);g.set(e.getKey(),e)}return g}))}getOverlaysForCollectionGroup(e,t,n,g){const r=Na();let i;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return El(e).te({index:ho,range:o},((e,t,n)=>{const o=wl(this.serializer,t);r.size()<g||o.largestBatchId===i?(r.set(o.getKey(),o),i=o.largestBatchId):n.done()})).next((()=>r))}bt(e,t){return El(e).put(function(e,t,n){const[g,r,i]=Wl(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:rl(e.wt,n.mutation)}}(this.serializer,this.userId,t))}}function El(e){return Vo(e,Co)}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{Dt(e){return Vo(e,bo)}getSessionToken(e){return this.Dt(e).get("sessionToken").next((e=>{const t=null==e?void 0:e.value;return t?To.fromUint8Array(t):To.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.Dt(e).put({name:"sessionToken",value:t.toUint8Array()})}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(Do(e.integerValue));else if("doubleValue"in e){const n=Do(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),ui(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),"string"==typeof n&&(n=Mo(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(Lo(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?Bs(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):fs(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):rr(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){const n=e.fields||{};this.Mt(t,55);for(const g of Object.keys(n))this.Nt(g,t),this.Ct(n[g],t)}qt(e,t){var n,g;const r=e.fields||{};this.Mt(t,53);const i=is,o=(null===(g=null===(n=r[i].arrayValue)||void 0===n?void 0:n.values)||void 0===g?void 0:g.length)||0;this.Mt(t,15),t.xt(Do(o)),this.Nt(i,t),this.Ct(r[i],t)}$t(e,t){const n=e.values||[];this.Mt(t,50);for(const g of n)this.Ct(g,t)}kt(e,t){this.Mt(t,37),Er.fromName(e).path.forEach((e=>{this.Mt(t,60),this.Kt(e,t)}))}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}Fl.Wt=new Fl;
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const xl=255;function Tl(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}function Kl(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const g=Tl(255&e[n]);if(t+=g,8!==g)break}return t}(e);return Math.ceil(t/8)}class Ml{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Gt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.zt(n.value),n=t.next();this.jt()}Ht(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Yt()}Zt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.zt(e);else if(e<2048)this.zt(960|e>>>6),this.zt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.zt(480|e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e);else{const e=t.codePointAt(0);this.zt(240|e>>>18),this.zt(128|63&e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e)}}this.jt()}Xt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{const e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Yt()}en(e){const t=this.tn(e),n=Kl(t);this.nn(1+n),this.buffer[this.position++]=255&n;for(let g=t.length-n;g<t.length;++g)this.buffer[this.position++]=255&t[g]}rn(e){const t=this.tn(e),n=Kl(t);this.nn(1+n),this.buffer[this.position++]=~(255&n);for(let g=t.length-n;g<t.length;++g)this.buffer[this.position++]=~(255&t[g])}sn(){this._n(xl),this._n(255)}an(){this.un(xl),this.un(255)}reset(){this.position=0}seed(e){this.nn(e.length),this.buffer.set(e,this.position),this.position+=e.length}cn(){return this.buffer.slice(0,this.position)}tn(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let g=1;g<t.length;++g)t[g]^=n?255:0;return t}zt(e){const t=255&e;0===t?(this._n(0),this._n(255)):t===xl?(this._n(xl),this._n(0)):this._n(t)}Jt(e){const t=255&e;0===t?(this.un(0),this.un(255)):t===xl?(this.un(xl),this.un(0)):this.un(e)}jt(){this._n(0),this._n(1)}Yt(){this.un(0),this.un(1)}_n(e){this.nn(1),this.buffer[this.position++]=e}un(e){this.nn(1),this.buffer[this.position++]=~e}nn(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const g=new Uint8Array(n);g.set(this.buffer),this.buffer=g}}class Dl{constructor(e){this.ln=e}Lt(e){this.ln.Gt(e)}Ot(e){this.ln.Zt(e)}xt(e){this.ln.en(e)}Ft(){this.ln.sn()}}class Ll{constructor(e){this.ln=e}Lt(e){this.ln.Ht(e)}Ot(e){this.ln.Xt(e)}xt(e){this.ln.rn(e)}Ft(){this.ln.an()}}class Ul{constructor(){this.ln=new Ml,this.hn=new Dl(this.ln),this.Pn=new Ll(this.ln)}seed(e){this.ln.seed(e)}Tn(e){return 0===e?this.hn:this.Pn}cn(){return this.ln.cn()}reset(){this.ln.reset()}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zl{constructor(e,t,n,g){this.In=e,this.En=t,this.dn=n,this.An=g}Rn(){const e=this.An.length,t=0===e||255===this.An[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.An,0),t!==e?n.set([0],this.An.length):++n[n.length-1],new zl(this.In,this.En,this.dn,n)}Vn(e,t,n){return{indexId:this.In,uid:e,arrayValue:jl(this.dn),directionalValue:jl(this.An),orderedDocumentKey:jl(t),documentKey:n.path.toArray()}}mn(e,t,n){const g=this.Vn(e,t,n);return[g.indexId,g.uid,g.arrayValue,g.directionalValue,g.orderedDocumentKey,g.documentKey]}}function Ql(e,t){let n=e.In-t.In;return 0!==n?n:(n=Ol(e.dn,t.dn),0!==n?n:(n=Ol(e.An,t.An),0!==n?n:Er.comparator(e.En,t.En)))}function Ol(e,t){for(let n=0;n<e.length&&n<t.length;++n){const g=e[n]-t[n];if(0!==g)return g}return e.length-t.length}function jl(e){return _t()?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(e):e}function Pl(e){return"string"!=typeof e?e:function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)}class _l{constructor(e){this.fn=new Yo(((e,t)=>Yr.comparator(e.field,t.field))),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.gn=e.orderBy,this.pn=[];for(const t of e.filters){const e=t;e.isInequality()?this.fn=this.fn.add(e):this.pn.push(e)}}get yn(){return this.fn.size>1}wn(e){if(or(e.collectionGroup===this.collectionId,49279),this.yn)return!1;const t=xr(e);if(void 0!==t&&!this.Sn(t))return!1;const n=Tr(e);let g=new Set,r=0,i=0;for(;r<n.length&&this.Sn(n[r]);++r)g=g.add(n[r].fieldPath.canonicalString());if(r===n.length)return!0;if(this.fn.size>0){const e=this.fn.getIterator().getNext();if(!g.has(e.field.canonicalString())){const t=n[r];if(!this.bn(e,t)||!this.Dn(this.gn[i++],t))return!1}++r}for(;r<n.length;++r){const e=n[r];if(i>=this.gn.length||!this.Dn(this.gn[i++],e))return!1}return!0}vn(){if(this.yn)return null;let e=new Yo(Yr.comparator);const t=[];for(const n of this.pn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new Kr(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Kr(n.field,0))}for(const n of this.gn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Kr(n.field,"asc"===n.dir?0:1)));return new Fr(Fr.UNKNOWN_ID,this.collectionId,t,Mr.empty())}Sn(e){for(const t of this.pn)if(this.bn(t,e))return!0;return!1}bn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}Dn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ql(e){var t,n;if(or(e instanceof xs||e instanceof Ts,20012),e instanceof xs){if(e instanceof ea){const g=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>xs.create(e.field,"==",t))))||[];return Ts.create(g,"or")}return e}const g=e.filters.map((e=>ql(e)));return Ts.create(g,e.op)}function $l(e){if(0===e.getFilters().length)return[];const t=gC(ql(e));return or(nC(t),7391),eC(t)||tC(t)?[t]:t.getFilters()}function eC(e){return e instanceof xs}function tC(e){return e instanceof Ts&&Ds(e)}function nC(e){return eC(e)||tC(e)||function(e){if(e instanceof Ts&&Ms(e)){for(const t of e.getFilters())if(!eC(t)&&!tC(t))return!1;return!0}return!1}(e)}function gC(e){if(or(e instanceof xs||e instanceof Ts,34018),e instanceof xs)return e;if(1===e.filters.length)return gC(e.filters[0]);const t=e.filters.map((e=>gC(e)));let n=Ts.create(t,e.op);return n=oC(n),nC(n)?n:(or(n instanceof Ts,64498),or(Ks(n),40251),or(n.filters.length>1,57927),n.filters.reduce(((e,t)=>rC(e,t))))}function rC(e,t){let n;return or(e instanceof xs||e instanceof Ts,38388),or(t instanceof xs||t instanceof Ts,25473),n=e instanceof xs?t instanceof xs?(g=e,r=t,Ts.create([g,r],"and")):iC(e,t):t instanceof xs?iC(t,e):function(e,t){if(or(e.filters.length>0&&t.filters.length>0,48005),Ks(e)&&Ks(t))return Qs(e,t.getFilters());const n=Ms(e)?e:t,g=Ms(e)?t:e,r=n.filters.map((e=>rC(e,g)));return Ts.create(r,"or")}(e,t),oC(n);var g,r}function iC(e,t){if(Ks(t))return Qs(t,e.getFilters());{const n=t.filters.map((t=>rC(e,t)));return Ts.create(n,"or")}}function oC(e){if(or(e instanceof xs||e instanceof Ts,11850),e instanceof xs)return e;const t=e.getFilters();if(1===t.length)return oC(t[0]);if(Ls(e))return e;const n=t.map((e=>oC(e))),g=[];return n.forEach((t=>{t instanceof xs?g.push(t):t instanceof Ts&&(t.op===e.op?g.push(...t.filters):g.push(t))})),1===g.length?g[0]:Ts.create(g,e.op)
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class sC{constructor(){this.Cn=new aC}addToCollectionParentIndex(e,t){return this.Cn.add(t),Pr.resolve()}getCollectionParents(e,t){return Pr.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Pr.resolve()}deleteFieldIndex(e,t){return Pr.resolve()}deleteAllFieldIndexes(e){return Pr.resolve()}createTargetIndexes(e,t){return Pr.resolve()}getDocumentsMatchingTarget(e,t){return Pr.resolve(null)}getIndexType(e,t){return Pr.resolve(0)}getFieldIndexes(e,t){return Pr.resolve([])}getNextCollectionGroupToUpdate(e){return Pr.resolve(null)}getMinOffset(e,t){return Pr.resolve(Ur.min())}getMinOffsetFromCollectionGroup(e,t){return Pr.resolve(Ur.min())}updateCollectionGroup(e,t,n){return Pr.resolve()}updateIndexEntries(e,t){return Pr.resolve()}}class aC{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),g=this.index[t]||new Yo(Nr.comparator),r=!g.has(n);return this.index[t]=g.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),g=this.index[t];return g&&g.has(n)}getEntries(e){return(this.index[e]||new Yo(Nr.comparator)).toArray()}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IC="IndexedDbIndexManager",lC=new Uint8Array(0);class CC{constructor(e,t){this.databaseId=t,this.Fn=new aC,this.Mn=new va((e=>ia(e)),((e,t)=>oa(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Fn.has(t)){const n=t.lastSegment(),g=t.popLast();e.addOnCommittedListener((()=>{this.Fn.add(t)}));const r={collectionId:n,parent:mi(g)};return cC(e).put(r)}return Pr.resolve()}getCollectionParents(e,t){const n=[],g=IDBKeyRange.bound([t,""],[Rr(t),""],!1,!0);return cC(e).J(g).next((e=>{for(const g of e){if(g.collectionId!==t)break;n.push(yi(g.parent))}return n}))}addFieldIndex(e,t){const n=uC(e),g={indexId:(r=t).indexId,collectionGroup:r.collectionGroup,fields:r.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))};var r;delete g.indexId;const i=n.add(g);if(t.indexState){const n=AC(e);return i.next((e=>{n.put(kl(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=uC(e),g=AC(e),r=dC(e);return n.delete(t.indexId).next((()=>g.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=uC(e),n=dC(e),g=AC(e);return t.X().next((()=>n.X())).next((()=>g.X()))}createTargetIndexes(e,t){return Pr.forEach(this.xn(t),(t=>this.getIndexType(e,t).next((n=>{if(0===n||1===n){const n=new _l(t).vn();if(null!=n)return this.addFieldIndex(e,n)}}))))}getDocumentsMatchingTarget(e,t){const n=dC(e);let g=!0;const r=new Map;return Pr.forEach(this.xn(t),(t=>this.On(e,t).next((e=>{g&&(g=!!e),r.set(t,e)})))).next((()=>{if(g){let e=Fa();const g=[];return Pr.forEach(r,((r,i)=>{var o;er(IC,`Using index ${o=r,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${ia(t)}`);const s=function(e,t){const n=xr(t);if(void 0===n)return null;for(const g of aa(e,n.fieldPath))switch(g.op){case"array-contains-any":return g.value.arrayValue.values||[];case"array-contains":return[g.value]}return null}(i,r),a=function(e,t){const n=new Map;for(const g of Tr(t))for(const t of aa(e,g.fieldPath))switch(t.op){case"==":case"in":n.set(g.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(g.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(i,r),I=function(e,t){const n=[];let g=!0;for(const r of Tr(t)){const t=0===r.kind?Ia(e,r.fieldPath,e.startAt):la(e,r.fieldPath,e.startAt);n.push(t.value),g&&(g=t.inclusive)}return new Ns(n,g)}(i,r),l=function(e,t){const n=[];let g=!0;for(const r of Tr(t)){const t=0===r.kind?la(e,r.fieldPath,e.endAt):Ia(e,r.fieldPath,e.endAt);n.push(t.value),g&&(g=t.inclusive)}return new Ns(n,g)}(i,r),C=this.Nn(r,i,I),c=this.Nn(r,i,l),d=this.Bn(r,i,a),u=this.Ln(r.indexId,s,C,I.inclusive,c,l.inclusive,d);return Pr.forEach(u,(r=>n.Z(r,t.limit).next((t=>{t.forEach((t=>{const n=Er.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),g.push(n))}))}))))})).next((()=>g))}return Pr.resolve(null)}))}xn(e){let t=this.Mn.get(e);return t||(t=0===e.filters.length?[e]:$l(Ts.create(e.filters,"and")).map((t=>ra(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.Mn.set(e,t),t)}Ln(e,t,n,g,r,i,o){const s=(null!=t?t.length:1)*Math.max(n.length,r.length),a=s/(null!=t?t.length:1),I=[];for(let l=0;l<s;++l){const s=t?this.kn(t[l/a]):lC,C=this.qn(e,s,n[l%a],g),c=this.Qn(e,s,r[l%a],i),d=o.map((t=>this.qn(e,s,t,!0)));I.push(...this.createRange(C,c,d))}return I}qn(e,t,n,g){const r=new zl(e,Er.empty(),t,n);return g?r:r.Rn()}Qn(e,t,n,g){const r=new zl(e,Er.empty(),t,n);return g?r.Rn():r}On(e,t){const n=new _l(t),g=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,g).next((e=>{let t=null;for(const g of e)n.wn(g)&&(!t||g.fields.length>t.fields.length)&&(t=g);return t}))}getIndexType(e,t){let n=2;const g=this.xn(t);return Pr.forEach(g,(t=>this.On(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new Yo(Yr.comparator),n=!1;for(const g of e.filters)for(const e of g.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const g of e.orderBy)g.field.isKeyField()||(t=t.add(g.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>null!==t.limit&&g.length>1&&2===n?1:n))}$n(e,t){const n=new Ul;for(const g of Tr(e)){const e=t.data.field(g.fieldPath);if(null==e)return null;const r=n.Tn(g.kind);Fl.Wt.vt(e,r)}return n.cn()}kn(e){const t=new Ul;return Fl.Wt.vt(e,t.Tn(0)),t.cn()}Un(e,t){const n=new Ul;return Fl.Wt.vt(hs(this.databaseId,t),n.Tn(function(e){const t=Tr(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.cn()}Bn(e,t,n){if(null===n)return[];let g=[];g.push(new Ul);let r=0;for(const i of Tr(e)){const e=n[r++];for(const n of g)if(this.Kn(t,i.fieldPath)&&bs(e))g=this.Wn(g,i,e);else{const t=n.Tn(i.kind);Fl.Wt.vt(e,t)}}return this.Gn(g)}Nn(e,t,n){return this.Bn(e,t,n.position)}Gn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].cn();return t}Wn(e,t,n){const g=[...e],r=[];for(const i of n.arrayValue.values||[])for(const e of g){const n=new Ul;n.seed(e.cn()),Fl.Wt.vt(i,n.Tn(t.kind)),r.push(n)}return r}Kn(e,t){return!!e.filters.find((e=>e instanceof xs&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=uC(e),g=AC(e);return(t?n.J(no,IDBKeyRange.bound(t,t)):n.J()).next((e=>{const t=[];return Pr.forEach(e,(e=>g.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new Mr(t.sequenceNumber,new Ur(Bl(t.readTime),new Er(yi(t.documentKey)),t.largestBatchId)):Mr.empty(),g=e.fields.map((([e,t])=>new Kr(Yr.fromServerFormat(e),t)));return new Fr(e.indexId,e.collectionGroup,g,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Zr(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const g=uC(e),r=AC(e);return this.zn(e).next((e=>g.J(no,IDBKeyRange.bound(t,t)).next((t=>Pr.forEach(t,(t=>r.put(kl(t.indexId,this.uid,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return Pr.forEach(t,((t,g)=>{const r=n.get(t.collectionGroup);return(r?Pr.resolve(r):this.getFieldIndexes(e,t.collectionGroup)).next((r=>(n.set(t.collectionGroup,r),Pr.forEach(r,(n=>this.jn(e,t,n).next((t=>{const r=this.Hn(g,n);return t.isEqual(r)?Pr.resolve():this.Jn(e,g,n,t,r)})))))))}))}Yn(e,t,n,g){return dC(e).put(g.Vn(this.uid,this.Un(n,t.key),t.key))}Zn(e,t,n,g){return dC(e).delete(g.mn(this.uid,this.Un(n,t.key),t.key))}jn(e,t,n){const g=dC(e);let r=new Yo(Ql);return g.te({index:Io,range:IDBKeyRange.only([n.indexId,this.uid,jl(this.Un(n,t))])},((e,g)=>{r=r.add(new zl(n.indexId,t,Pl(g.arrayValue),Pl(g.directionalValue)))})).next((()=>r))}Hn(e,t){let n=new Yo(Ql);const g=this.$n(t,e);if(null==g)return n;const r=xr(t);if(null!=r){const i=e.data.field(r.fieldPath);if(bs(i))for(const r of i.arrayValue.values||[])n=n.add(new zl(t.indexId,e.key,this.kn(r),g))}else n=n.add(new zl(t.indexId,e.key,lC,g));return n}Jn(e,t,n,g,r){er(IC,"Updating index entries for document '%s'",t.key);const i=[];return function(e,t,n,g,r){const i=e.getIterator(),o=t.getIterator();let s=Ho(i),a=Ho(o);for(;s||a;){let e=!1,t=!1;if(s&&a){const g=n(s,a);g<0?t=!0:g>0&&(e=!0)}else null!=s?t=!0:e=!0;e?(g(a),a=Ho(o)):t?(r(s),s=Ho(i)):(s=Ho(i),a=Ho(o))}}(g,r,Ql,(g=>{i.push(this.Yn(e,t,n,g))}),(g=>{i.push(this.Zn(e,t,n,g))})),Pr.waitFor(i)}zn(e){let t=1;return AC(e).te({index:io,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,g)=>{g.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Ql(e,t))).filter(((e,t,n)=>!t||0!==Ql(e,n[t-1])));const g=[];g.push(e);for(const i of n){const n=Ql(i,e),r=Ql(i,t);if(0===n)g[0]=e.Rn();else if(n>0&&r<0)g.push(i),g.push(i.Rn());else if(r>0)break}g.push(t);const r=[];for(let i=0;i<g.length;i+=2){if(this.Xn(g[i],g[i+1]))return[];const e=g[i].mn(this.uid,lC,Er.empty()),t=g[i+1].mn(this.uid,lC,Er.empty());r.push(IDBKeyRange.bound(e,t))}return r}Xn(e,t){return Ql(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(hC)}getMinOffset(e,t){return Pr.mapArray(this.xn(t),(t=>this.On(e,t).next((e=>e||rr(44426))))).next(hC)}}function cC(e){return Vo(e,Pi)}function dC(e){return Vo(e,so)}function uC(e){return Vo(e,to)}function AC(e){return Vo(e,go)}function hC(e){or(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let g=1;g<e.length;g++){const r=e[g].indexState.offset;zr(r,t)<0&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new Ur(t.readTime,t.documentKey,n)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mC={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},bC=41943040;class pC{static withCacheSize(e){return new pC(e,pC.DEFAULT_COLLECTION_PERCENTILE,pC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yC(e,t,n){const g=e.store(Si),r=e.store(Xi),i=[],o=IDBKeyRange.only(n.batchId);let s=0;const a=g.te({range:o},((e,t,n)=>(s++,n.delete())));i.push(a.next((()=>{or(1===s,47070,{batchId:n.batchId})})));const I=[];for(const l of n.mutations){const e=Wi(t,l.key.path,n.batchId);i.push(r.delete(e)),I.push(l.key)}return Pr.waitFor(i).next((()=>I))}function ZC(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw rr(14731);t=e.noDocument}return JSON.stringify(t).length}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */pC.DEFAULT_COLLECTION_PERCENTILE=10,pC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pC.DEFAULT=new pC(bC,pC.DEFAULT_COLLECTION_PERCENTILE,pC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pC.DISABLED=new pC(-1,0,0);class fC{constructor(e,t,n,g){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=g,this.er={}}static St(e,t,n,g){or(""!==e.uid,64387);const r=e.isAuthenticated()?e.uid:"";return new fC(r,t,n,g)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return BC(e).te({index:vi,range:n},((e,n,g)=>{t=!1,g.done()})).next((()=>t))}addMutationBatch(e,t,n,g){const r=SC(e),i=BC(e);return i.add({}).next((o=>{or("number"==typeof o,49019);const s=new bI(o,t,n,g),a=function(e,t,n){const g=n.baseMutations.map((t=>rl(e.wt,t))),r=n.mutations.map((t=>rl(e.wt,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:g,mutations:r}}(this.serializer,this.userId,s),I=[];let l=new Yo(((e,t)=>Zr(e.canonicalString(),t.canonicalString())));for(const e of g){const t=Wi(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),I.push(i.put(a)),I.push(r.put(t,ki))}return l.forEach((t=>{I.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.er[o]=s.keys()})),Pr.waitFor(I).next((()=>s))}))}lookupMutationBatch(e,t){return BC(e).get(t).next((e=>e?(or(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),Sl(this.serializer,e)):null))}tr(e,t){return this.er[t]?Pr.resolve(this.er[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.er[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,g=IDBKeyRange.lowerBound([this.userId,n]);let r=null;return BC(e).te({index:vi,range:g},((e,t,g)=>{t.userId===this.userId&&(or(t.batchId>=n,47524,{nr:n}),r=Sl(this.serializer,t)),g.done()})).next((()=>r))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=ci;return BC(e).te({index:vi,range:t,reverse:!0},((e,t,g)=>{n=t.batchId,g.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,ci],[this.userId,Number.POSITIVE_INFINITY]);return BC(e).J(vi,t).next((e=>e.map((e=>Sl(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=wi(this.userId,t.path),g=IDBKeyRange.lowerBound(n),r=[];return SC(e).te({range:g},((n,g,i)=>{const[o,s,a]=n,I=yi(s);if(o===this.userId&&t.path.isEqual(I))return BC(e).get(a).next((e=>{if(!e)throw rr(61480,{rr:n,batchId:a});or(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:a}),r.push(Sl(this.serializer,e))}));i.done()})).next((()=>r))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Yo(Zr);const g=[];return t.forEach((t=>{const r=wi(this.userId,t.path),i=IDBKeyRange.lowerBound(r),o=SC(e).te({range:i},((e,g,r)=>{const[i,o,s]=e,a=yi(o);i===this.userId&&t.path.isEqual(a)?n=n.add(s):r.done()}));g.push(o)})),Pr.waitFor(g).next((()=>this.ir(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,g=n.length+1,r=wi(this.userId,n),i=IDBKeyRange.lowerBound(r);let o=new Yo(Zr);return SC(e).te({range:i},((e,t,r)=>{const[i,s,a]=e,I=yi(s);i===this.userId&&n.isPrefixOf(I)?I.length===g&&(o=o.add(a)):r.done()})).next((()=>this.ir(e,o)))}ir(e,t){const n=[],g=[];return t.forEach((t=>{g.push(BC(e).get(t).next((e=>{if(null===e)throw rr(35274,{batchId:t});or(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(Sl(this.serializer,e))})))})),Pr.waitFor(g).next((()=>n))}removeMutationBatch(e,t){return yC(e.he,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.sr(t.batchId)})),Pr.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}sr(e){delete this.er[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Pr.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),g=[];return SC(e).te({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=yi(e[1]);g.push(t)}else n.done()})).next((()=>{or(0===g.length,56720,{_r:g.map((e=>e.canonicalString()))})}))}))}containsKey(e,t){return GC(e,this.userId,t)}ar(e){return RC(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:ci,lastStreamToken:""}))}}function GC(e,t,n){const g=wi(t,n.path),r=g[1],i=IDBKeyRange.lowerBound(g);let o=!1;return SC(e).te({range:i,ee:!0},((e,n,g)=>{const[i,s,a]=e;i===t&&s===r&&(o=!0),g.done()})).next((()=>o))}function BC(e){return Vo(e,Si)}function SC(e){return Vo(e,Xi)}function RC(e){return Vo(e,Bi)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vC{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new vC(0)}static lr(){return new vC(-1)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VC{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.hr(e).next((t=>{const n=new vC(t.highestTargetId);return t.highestTargetId=n.next(),this.Pr(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.hr(e).next((e=>Wr.fromTimestamp(new wr(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.hr(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.hr(e).next((g=>(g.highestListenSequenceNumber=t,n&&(g.lastRemoteSnapshotVersion=n.toTimestamp()),t>g.highestListenSequenceNumber&&(g.highestListenSequenceNumber=t),this.Pr(e,g))))}addTargetData(e,t){return this.Tr(e,t).next((()=>this.hr(e).next((n=>(n.targetCount+=1,this.Ir(t,n),this.Pr(e,n))))))}updateTargetData(e,t){return this.Tr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>wC(e).delete(t.targetId))).next((()=>this.hr(e))).next((t=>(or(t.targetCount>0,8065),t.targetCount-=1,this.Pr(e,t))))}removeTargets(e,t,n){let g=0;const r=[];return wC(e).te(((i,o)=>{const s=Rl(o);s.sequenceNumber<=t&&null===n.get(s.targetId)&&(g++,r.push(this.removeTargetData(e,s)))})).next((()=>Pr.waitFor(r))).next((()=>g))}forEachTarget(e,t){return wC(e).te(((e,n)=>{const g=Rl(n);t(g)}))}hr(e){return WC(e).get(Oi).next((e=>(or(null!==e,2888),e)))}Pr(e,t){return WC(e).put(Oi,t)}Tr(e,t){return wC(e).put(vl(this.serializer,t))}Ir(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.hr(e).next((e=>e.targetCount))}getTargetData(e,t){const n=ia(t),g=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let r=null;return wC(e).te({range:g,index:Mi},((e,n,g)=>{const i=Rl(n);oa(t,i.target)&&(r=i,g.done())})).next((()=>r))}addMatchingKeys(e,t,n){const g=[],r=kC(e);return t.forEach((t=>{const i=mi(t.path);g.push(r.put({targetId:n,path:i})),g.push(this.referenceDelegate.addReference(e,n,t))})),Pr.waitFor(g)}removeMatchingKeys(e,t,n){const g=kC(e);return Pr.forEach(t,(t=>{const r=mi(t.path);return Pr.waitFor([g.delete([n,r]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=kC(e),g=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(g)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),g=kC(e);let r=Fa();return g.te({range:n,ee:!0},((e,t,n)=>{const g=yi(e[1]),i=new Er(g);r=r.add(i)})).next((()=>r))}containsKey(e,t){const n=mi(t.path),g=IDBKeyRange.bound([n],[Rr(n)],!1,!0);let r=0;return kC(e).te({index:zi,ee:!0,range:g},(([e,t],n,g)=>{0!==e&&(r++,g.done())})).next((()=>r>0))}Rt(e,t){return wC(e).get(t).next((e=>e?Rl(e):null))}}function wC(e){return Vo(e,Ki)}function WC(e){return Vo(e,ji)}function kC(e){return Vo(e,Li)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XC="LruGarbageCollector",NC=1048576;function JC([e,t],[n,g]){const r=Zr(e,n);return 0===r?Zr(t,g):r}class YC{constructor(e){this.Er=e,this.buffer=new Yo(JC),this.dr=0}Ar(){return++this.dr}Rr(e){const t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();JC(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class EC{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Vr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return null!==this.Vr}mr(e){er(XC,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){gi(e)?er(XC,"Ignoring IndexedDB error during garbage collection: ",e):await jr(e)}await this.mr(3e5)}))}}class HC{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Pr.resolve(Ci.le);const n=new YC(t);return this.gr.forEachTarget(e,(e=>n.Rr(e.sequenceNumber))).next((()=>this.gr.yr(e,(e=>n.Rr(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.gr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(er("LruGarbageCollector","Garbage collection skipped; disabled"),Pr.resolve(mC)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(er("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),mC):this.wr(e,t)))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let n,g,r,i,o,s,a;const I=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(er("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),g=this.params.maximumSequenceNumbersToCollect):g=t,i=Date.now(),this.nthSequenceNumber(e,g)))).next((g=>(n=g,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(r=t,s=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(a=Date.now(),$g()<=dn.DEBUG&&er("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-I}ms\n\tDetermined least recently used ${g} in `+(o-i)+`ms\n\tRemoved ${r} targets in `+(s-o)+`ms\n\tRemoved ${e} documents in `+(a-s)+`ms\nTotal Duration: ${a-I}ms`),Pr.resolve({didRun:!0,sequenceNumbersCollected:g,targetsRemoved:r,documentsRemoved:e}))))}}function FC(e,t){return new HC(e,t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xC{constructor(e,t){this.db=e,this.garbageCollector=FC(this,t)}pr(e){const t=this.Sr(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Sr(e){let t=0;return this.yr(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}yr(e,t){return this.br(e,((e,n)=>t(n)))}addReference(e,t,n){return TC(e,n)}removeReference(e,t,n){return TC(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return TC(e,t)}Dr(e,t){return function(e,t){let n=!1;return RC(e).ne((g=>GC(e,g,t).next((e=>(e&&(n=!0),Pr.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),g=[];let r=0;return this.br(e,((i,o)=>{if(o<=t){const t=this.Dr(e,i).next((t=>{if(!t)return r++,n.getEntry(e,i).next((()=>(n.removeEntry(i,Wr.min()),kC(e).delete([0,mi(i.path)]))))}));g.push(t)}})).next((()=>Pr.waitFor(g))).next((()=>n.apply(e))).next((()=>r))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return TC(e,t)}br(e,t){const n=kC(e);let g,r=Ci.le;return n.te({index:zi},(([e,n],{path:i,sequenceNumber:o})=>{0===e?(r!==Ci.le&&t(new Er(yi(g)),r),r=o,g=i):r=Ci.le})).next((()=>{r!==Ci.le&&t(new Er(yi(g)),r)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function TC(e,t){return kC(e).put((n=t,g=e.currentSequenceNumber,{targetId:0,path:mi(n.path),sequenceNumber:g}));var n,g}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(){this.changes=new va((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Xs.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Pr.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MC{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return zC(e).put(n)}removeEntry(e,t,n){return zC(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],fl(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.vr(e,n))))}getEntry(e,t){let n=Xs.newInvalidDocument(t);return zC(e).te({index:Yi,range:IDBKeyRange.only(QC(t))},((e,g)=>{n=this.Cr(t,g)})).next((()=>n))}Fr(e,t){let n={size:0,document:Xs.newInvalidDocument(t)};return zC(e).te({index:Yi,range:IDBKeyRange.only(QC(t))},((e,g)=>{n={document:this.Cr(t,g),size:ZC(g)}})).next((()=>n))}getEntries(e,t){let n=wa();return this.Mr(e,t,((e,t)=>{const g=this.Cr(e,t);n=n.insert(e,g)})).next((()=>n))}Or(e,t){let n=wa(),g=new Xo(Er.comparator);return this.Mr(e,t,((e,t)=>{const r=this.Cr(e,t);n=n.insert(e,r),g=g.insert(e,ZC(t))})).next((()=>({documents:n,Nr:g})))}Mr(e,t,n){if(t.isEmpty())return Pr.resolve();let g=new Yo(jC);t.forEach((e=>g=g.add(e)));const r=IDBKeyRange.bound(QC(g.first()),QC(g.last())),i=g.getIterator();let o=i.getNext();return zC(e).te({index:Yi,range:r},((e,t,g)=>{const r=Er.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&jC(o,r)<0;)n(o,null),o=i.getNext();o&&o.isEqual(r)&&(n(o,t),o=i.hasNext()?i.getNext():null),o?g.H(QC(o)):g.done()})).next((()=>{for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))}getDocumentsMatchingQuery(e,t,n,g,r){const i=t.path,o=[i.popLast().toArray(),i.lastSegment(),fl(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],s=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return zC(e).J(IDBKeyRange.bound(o,s,!0)).next((e=>{null==r||r.incrementDocumentReadCount(e.length);let n=wa();for(const r of e){const e=this.Cr(Er.fromSegments(r.prefixPath.concat(r.collectionGroup,r.documentId)),r);e.isFoundDocument()&&(Ga(t,e)||g.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,g){let r=wa();const i=OC(t,n),o=OC(t,Ur.max());return zC(e).te({index:Hi,range:IDBKeyRange.bound(i,o,!0)},((e,t,n)=>{const i=this.Cr(Er.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);r=r.insert(i.key,i),r.size===g&&n.done()})).next((()=>r))}newChangeBuffer(e){return new LC(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return UC(e).get(Ti).next((e=>(or(!!e,20021),e)))}vr(e,t){return UC(e).put(Ti,t)}Cr(e,t){if(t){const e=yl(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(Wr.min()))return e}return Xs.newInvalidDocument(e)}}function DC(e){return new MC(e)}class LC extends KC{constructor(e,t){super(),this.Br=e,this.trackRemovals=t,this.Lr=new va((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,g=new Yo(((e,t)=>Zr(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((r,i)=>{const o=this.Lr.get(r);if(t.push(this.Br.removeEntry(e,r,o.readTime)),i.isValidDocument()){const s=Zl(this.Br.serializer,i);g=g.add(r.path.popLast());const a=ZC(s);n+=a-o.size,t.push(this.Br.addEntry(e,r,s))}else if(n-=o.size,this.trackRemovals){const n=Zl(this.Br.serializer,i.convertToNoDocument(Wr.min()));t.push(this.Br.addEntry(e,r,n))}})),g.forEach((n=>{t.push(this.Br.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.Br.updateMetadata(e,n)),Pr.waitFor(t)}getFromCache(e,t){return this.Br.Fr(e,t).next((e=>(this.Lr.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.Br.Or(e,t).next((({documents:e,Nr:t})=>(t.forEach(((t,n)=>{this.Lr.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function UC(e){return Vo(e,xi)}function zC(e){return Vo(e,Ni)}function QC(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function OC(e,t){const n=t.documentKey.path.toArray();return[e,fl(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function jC(e,t){const n=e.path.toArray(),g=t.path.toArray();let r=0;for(let i=0;i<n.length-2&&i<g.length-2;++i)if(r=Zr(n[i],g[i]),r)return r;return r=Zr(n.length,g.length),r||(r=Zr(n[n.length-2],g[g.length-2]),r||Zr(n[n.length-1],g[g.length-1])
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */)}class PC{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _C{constructor(e,t,n,g){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=g}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((g=>(n=g,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&aI(n.mutation,e,Fo.empty(),wr.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Fa()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Fa()){const g=Na();return this.populateOverlays(e,g,t).next((()=>this.computeViews(e,t,g,n).next((e=>{let t=ka();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Na();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Fa())))}populateOverlays(e,t,n){const g=[];return n.forEach((e=>{t.has(e)||g.push(e)})),this.documentOverlayCache.getOverlays(e,g).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,g){let r=wa();const i=Ya(),o=Ya();return t.forEach(((e,t)=>{const o=n.get(t.key);g.has(t.key)&&(void 0===o||o.mutation instanceof cI)?r=r.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),aI(o.mutation,t,o.mutation.getFieldMask(),wr.now())):i.set(t.key,Fo.empty())})),this.recalculateAndSaveOverlays(e,r).next((e=>(e.forEach(((e,t)=>i.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new PC(t,null!==(n=i.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Ya();let g=new Xo(((e,t)=>e-t)),r=Fa();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const r of e)r.keys().forEach((e=>{const i=t.get(e);if(null===i)return;let o=n.get(e)||Fo.empty();o=r.applyToLocalView(i,o),n.set(e,o);const s=(g.get(r.batchId)||Fa()).add(e);g=g.insert(r.batchId,s)}))})).next((()=>{const i=[],o=g.getReverseIterator();for(;o.hasNext();){const g=o.getNext(),s=g.key,a=g.value,I=Ja();a.forEach((e=>{if(!r.has(e)){const g=oI(t.get(e),n.get(e));null!==g&&I.set(e,g),r=r.add(e)}})),i.push(this.documentOverlayCache.saveOverlays(e,s,I))}return Pr.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,g){return r=t,Er.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Aa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,g):this.getDocumentsMatchingCollectionQuery(e,t,n,g);var r}getNextDocuments(e,t,n,g){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,g).next((r=>{const i=g-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,g-r.size):Pr.resolve(Na());let o=Hr,s=r;return i.next((t=>Pr.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?Pr.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{s=s.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,r))).next((()=>this.computeViews(e,s,t,Fa()))).next((e=>({batchId:o,changes:Xa(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Er(t)).next((e=>{let t=ka();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,g){const r=t.collectionGroup;let i=ka();return this.indexManager.getCollectionParents(e,r).next((o=>Pr.forEach(o,(o=>{const s=(a=t,I=o.child(r),new Ca(I,null,a.explicitOrderBy.slice(),a.filters.slice(),a.limit,a.limitType,a.startAt,a.endAt));var a,I;return this.getDocumentsMatchingCollectionQuery(e,s,n,g).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n,g){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,g)))).next((e=>{r.forEach(((t,n)=>{const g=n.getKey();null===e.get(g)&&(e=e.insert(g,Xs.newInvalidDocument(g)))}));let n=ka();return e.forEach(((e,g)=>{const i=r.get(e);void 0!==i&&aI(i.mutation,g,Fo.empty(),wr.now()),Ga(t,g)&&(n=n.insert(e,g))})),n}))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qC{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return Pr.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,{id:(n=t).id,version:n.version,createTime:QI(n.createTime)}),Pr.resolve();var n}getNamedQuery(e,t){return Pr.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,{name:(n=t).name,query:Vl(n.bundledQuery),readTime:QI(n.readTime)}),Pr.resolve();var n}}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $C{constructor(){this.overlays=new Xo(Er.comparator),this.Qr=new Map}getOverlay(e,t){return Pr.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Na();return Pr.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,g)=>{this.bt(e,t,g)})),Pr.resolve()}removeOverlaysForBatchId(e,t,n){const g=this.Qr.get(n);return void 0!==g&&(g.forEach((e=>this.overlays=this.overlays.remove(e))),this.Qr.delete(n)),Pr.resolve()}getOverlaysForCollection(e,t,n){const g=Na(),r=t.length+1,i=new Er(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===r&&e.largestBatchId>n&&g.set(e.getKey(),e)}return Pr.resolve(g)}getOverlaysForCollectionGroup(e,t,n,g){let r=new Xo(((e,t)=>e-t));const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=Na(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Na(),s=r.getIterator();for(;s.hasNext()&&(s.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=g)););return Pr.resolve(o)}bt(e,t,n){const g=this.overlays.get(n.key);if(null!==g){const e=this.Qr.get(g.largestBatchId).delete(n.key);this.Qr.set(g.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new yI(t,n));let r=this.Qr.get(t);void 0===r&&(r=Fa(),this.Qr.set(t,r)),this.Qr.set(t,r.add(n.key))}}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(){this.sessionToken=To.EMPTY_BYTE_STRING}getSessionToken(e){return Pr.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Pr.resolve()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tc{constructor(){this.$r=new Yo(nc.Ur),this.Kr=new Yo(nc.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){const n=new nc(e,t);this.$r=this.$r.add(n),this.Kr=this.Kr.add(n)}Gr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.zr(new nc(e,t))}jr(e,t){e.forEach((e=>this.removeReference(e,t)))}Hr(e){const t=new Er(new Nr([])),n=new nc(t,e),g=new nc(t,e+1),r=[];return this.Kr.forEachInRange([n,g],(e=>{this.zr(e),r.push(e.key)})),r}Jr(){this.$r.forEach((e=>this.zr(e)))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){const t=new Er(new Nr([])),n=new nc(t,e),g=new nc(t,e+1);let r=Fa();return this.Kr.forEachInRange([n,g],(e=>{r=r.add(e.key)})),r}containsKey(e){const t=new nc(e,0),n=this.$r.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class nc{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return Er.comparator(e.key,t.key)||Zr(e.Zr,t.Zr)}static Wr(e,t){return Zr(e.Zr,t.Zr)||Er.comparator(e.key,t.key)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new Yo(nc.Ur)}checkEmpty(e){return Pr.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,g){const r=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new bI(r,t,n,g);this.mutationQueue.push(i);for(const o of g)this.Xr=this.Xr.add(new nc(o.key,r)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return Pr.resolve(i)}lookupMutationBatch(e,t){return Pr.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,g=this.ti(n),r=g<0?0:g;return Pr.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return Pr.resolve(0===this.mutationQueue.length?ci:this.nr-1)}getAllMutationBatches(e){return Pr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new nc(t,0),g=new nc(t,Number.POSITIVE_INFINITY),r=[];return this.Xr.forEachInRange([n,g],(e=>{const t=this.ei(e.Zr);r.push(t)})),Pr.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Yo(Zr);return t.forEach((e=>{const t=new nc(e,0),g=new nc(e,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([t,g],(e=>{n=n.add(e.Zr)}))})),Pr.resolve(this.ni(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,g=n.length+1;let r=n;Er.isDocumentKey(r)||(r=r.child(""));const i=new nc(new Er(r),0);let o=new Yo(Zr);return this.Xr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===g&&(o=o.add(e.Zr)),!0)}),i),Pr.resolve(this.ni(o))}ni(e){const t=[];return e.forEach((e=>{const n=this.ei(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){or(0===this.ri(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Xr;return Pr.forEach(t.mutations,(g=>{const r=new nc(g.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,g.key)})).next((()=>{this.Xr=n}))}sr(e){}containsKey(e,t){const n=new nc(t,0),g=this.Xr.firstAfterOrEqual(n);return Pr.resolve(t.isEqual(g&&g.key))}performConsistencyCheck(e){return this.mutationQueue.length,Pr.resolve()}ri(e,t){return this.ti(e)}ti(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ei(e){const t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(e){this.ii=e,this.docs=new Xo(Er.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,g=this.docs.get(n),r=g?g.size:0,i=this.ii(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Pr.resolve(n?n.document.mutableCopy():Xs.newInvalidDocument(t))}getEntries(e,t){let n=wa();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Xs.newInvalidDocument(e))})),Pr.resolve(n)}getDocumentsMatchingQuery(e,t,n,g){let r=wa();const i=t.path,o=new Er(i.child("__id-9223372036854775808__")),s=this.docs.getIteratorFrom(o);for(;s.hasNext();){const{key:e,value:{document:o}}=s.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||zr(Lr(o),n)<=0||(g.has(o.key)||Ga(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return Pr.resolve(r)}getAllFromCollectionGroup(e,t,n,g){rr(9500)}si(e,t){return Pr.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new ic(this)}getSize(e){return Pr.resolve(this.size)}}class ic extends KC{constructor(e){super(),this.Br=e}applyChanges(e){const t=[];return this.changes.forEach(((n,g)=>{g.isValidDocument()?t.push(this.Br.addEntry(e,g)):this.Br.removeEntry(n)})),Pr.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oc{constructor(e){this.persistence=e,this.oi=new va((e=>ia(e)),oa),this.lastRemoteSnapshotVersion=Wr.min(),this.highestTargetId=0,this._i=0,this.ai=new tc,this.targetCount=0,this.ui=vC.cr()}forEachTarget(e,t){return this.oi.forEach(((e,n)=>t(n))),Pr.resolve()}getLastRemoteSnapshotVersion(e){return Pr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Pr.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),Pr.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this._i&&(this._i=t),Pr.resolve()}Tr(e){this.oi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ui=new vC(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,Pr.resolve()}updateTargetData(e,t){return this.Tr(t),Pr.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,Pr.resolve()}removeTargets(e,t,n){let g=0;const r=[];return this.oi.forEach(((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.oi.delete(i),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),g++)})),Pr.waitFor(r).next((()=>g))}getTargetCount(e){return Pr.resolve(this.targetCount)}getTargetData(e,t){const n=this.oi.get(t)||null;return Pr.resolve(n)}addMatchingKeys(e,t,n){return this.ai.Gr(t,n),Pr.resolve()}removeMatchingKeys(e,t,n){this.ai.jr(t,n);const g=this.persistence.referenceDelegate,r=[];return g&&t.forEach((t=>{r.push(g.markPotentiallyOrphaned(e,t))})),Pr.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),Pr.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ai.Yr(t);return Pr.resolve(n)}containsKey(e,t){return Pr.resolve(this.ai.containsKey(t))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc{constructor(e,t){this.ci={},this.overlays={},this.li=new Ci(0),this.hi=!1,this.hi=!0,this.Pi=new ec,this.referenceDelegate=e(this),this.Ti=new oc(this),this.indexManager=new sC,this.remoteDocumentCache=new rc((e=>this.referenceDelegate.Ii(e))),this.serializer=new pl(t),this.Ei=new qC(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $C,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ci[e.toKey()];return n||(n=new gc(t,this.referenceDelegate),this.ci[e.toKey()]=n),n}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,n){er("MemoryPersistence","Starting transaction:",e);const g=new ac(this.li.next());return this.referenceDelegate.di(),n(g).next((e=>this.referenceDelegate.Ai(g).next((()=>e)))).toPromise().then((e=>(g.raiseOnCommittedEvent(),e)))}Ri(e,t){return Pr.or(Object.values(this.ci).map((n=>()=>n.containsKey(e,t))))}}class ac extends Or{constructor(e){super(),this.currentSequenceNumber=e}}class Ic{constructor(e){this.persistence=e,this.Vi=new tc,this.mi=null}static fi(e){return new Ic(e)}get gi(){if(this.mi)return this.mi;throw rr(60996)}addReference(e,t,n){return this.Vi.addReference(n,t),this.gi.delete(n.toString()),Pr.resolve()}removeReference(e,t,n){return this.Vi.removeReference(n,t),this.gi.add(n.toString()),Pr.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),Pr.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach((e=>this.gi.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.gi.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}di(){this.mi=new Set}Ai(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Pr.forEach(this.gi,(n=>{const g=Er.fromPath(n);return this.pi(e,g).next((e=>{e||t.removeEntry(g,Wr.min())}))})).next((()=>(this.mi=null,t.apply(e))))}updateLimboDocument(e,t){return this.pi(e,t).next((e=>{e?this.gi.delete(t.toString()):this.gi.add(t.toString())}))}Ii(e){return 0}pi(e,t){return Pr.or([()=>Pr.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class lc{constructor(e,t){this.persistence=e,this.yi=new va((e=>mi(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=FC(this,t)}static fi(e,t){return new lc(e,t)}di(){}Ai(e){return Pr.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){const t=this.Sr(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Sr(e){let t=0;return this.yr(e,(e=>{t++})).next((()=>t))}yr(e,t){return Pr.forEach(this.yi,((n,g)=>this.Dr(e,n,g).next((e=>e?Pr.resolve():t(g)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const g=this.persistence.getRemoteDocumentCache(),r=g.newChangeBuffer();return g.si(e,(g=>this.Dr(e,g,t).next((e=>{e||(n++,r.removeEntry(g,Wr.min()))})))).next((()=>r.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),Pr.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),Pr.resolve()}removeReference(e,t,n){return this.yi.set(n,e.currentSequenceNumber),Pr.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),Pr.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=As(e.data.value)),t}Dr(e,t,n){return Pr.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.yi.get(t);return Pr.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc{constructor(e){this.serializer=e}q(e,t,n,g){const r=new qr("createOrUpgrade",t);n<1&&g>=1&&(e.createObjectStore(fi),function(e){e.createObjectStore(Bi,{keyPath:"userId"});e.createObjectStore(Si,{keyPath:Ri,autoIncrement:!0}).createIndex(vi,Vi,{unique:!0}),e.createObjectStore(Xi)}(e),cc(e),function(e){e.createObjectStore(Zi)}(e));let i=Pr.resolve();return n<3&&g>=3&&(0!==n&&(function(e){e.deleteObjectStore(Li),e.deleteObjectStore(Ki),e.deleteObjectStore(ji)}(e),cc(e)),i=i.next((()=>function(e){const t=e.store(ji),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Wr.min().toTimestamp(),targetCount:0};return t.put(Oi,n)}(r)))),n<4&&g>=4&&(0!==n&&(i=i.next((()=>function(e,t){return t.store(Si).J().next((n=>{e.deleteObjectStore(Si),e.createObjectStore(Si,{keyPath:Ri,autoIncrement:!0}).createIndex(vi,Vi,{unique:!0});const g=t.store(Si),r=n.map((e=>g.put(e)));return Pr.waitFor(r)}))}(e,r)))),i=i.next((()=>{!function(e){e.createObjectStore(qi,{keyPath:"clientId"})}(e)}))),n<5&&g>=5&&(i=i.next((()=>this.wi(r)))),n<6&&g>=6&&(i=i.next((()=>(function(e){e.createObjectStore(xi)}(e),this.Si(r))))),n<7&&g>=7&&(i=i.next((()=>this.bi(r)))),n<8&&g>=8&&(i=i.next((()=>this.Di(e,r)))),n<9&&g>=9&&(i=i.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&g>=10&&(i=i.next((()=>this.Ci(r)))),n<11&&g>=11&&(i=i.next((()=>{!function(e){e.createObjectStore($i,{keyPath:"bundleId"})}(e),function(e){e.createObjectStore(eo,{keyPath:"name"})}(e)}))),n<12&&g>=12&&(i=i.next((()=>{!function(e){const t=e.createObjectStore(Co,{keyPath:co});t.createIndex(uo,Ao,{unique:!1}),t.createIndex(ho,mo,{unique:!1})}(e)}))),n<13&&g>=13&&(i=i.next((()=>function(e){const t=e.createObjectStore(Ni,{keyPath:Ji});t.createIndex(Yi,Ei),t.createIndex(Hi,Fi)}(e))).next((()=>this.Fi(e,r))).next((()=>e.deleteObjectStore(Zi)))),n<14&&g>=14&&(i=i.next((()=>this.Mi(e,r)))),n<15&&g>=15&&(i=i.next((()=>function(e){e.createObjectStore(to,{keyPath:"indexId",autoIncrement:!0}).createIndex(no,"collectionGroup",{unique:!1});e.createObjectStore(go,{keyPath:ro}).createIndex(io,oo,{unique:!1});e.createObjectStore(so,{keyPath:ao}).createIndex(Io,lo,{unique:!1})}(e)))),n<16&&g>=16&&(i=i.next((()=>{t.objectStore(go).clear()})).next((()=>{t.objectStore(so).clear()}))),n<17&&g>=17&&(i=i.next((()=>{!function(e){e.createObjectStore(bo,{keyPath:"name"})}(e)}))),n<18&&g>=18&&_t()&&(i=i.next((()=>{t.objectStore(go).clear()})).next((()=>{t.objectStore(so).clear()}))),i}Si(e){let t=0;return e.store(Zi).te(((e,n)=>{t+=ZC(n)})).next((()=>{const n={byteSize:t};return e.store(xi).put(Ti,n)}))}wi(e){const t=e.store(Bi),n=e.store(Si);return t.J().next((t=>Pr.forEach(t,(t=>{const g=IDBKeyRange.bound([t.userId,ci],[t.userId,t.lastAcknowledgedBatchId]);return n.J(vi,g).next((n=>Pr.forEach(n,(n=>{or(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});const g=Sl(this.serializer,n);return yC(e,t.userId,g).next((()=>{}))}))))}))))}bi(e){const t=e.store(Li),n=e.store(Zi);return e.store(ji).get(Oi).next((e=>{const g=[];return n.te(((n,r)=>{const i=new Nr(n),o=[0,mi(i)];g.push(t.get(o).next((n=>{return n?Pr.resolve():(g=i,t.put({targetId:0,path:mi(g),sequenceNumber:e.highestListenSequenceNumber}));var g})))})).next((()=>Pr.waitFor(g)))}))}Di(e,t){e.createObjectStore(Pi,{keyPath:_i});const n=t.store(Pi),g=new aC,r=e=>{if(g.add(e)){const t=e.lastSegment(),g=e.popLast();return n.put({collectionId:t,parent:mi(g)})}};return t.store(Zi).te({ee:!0},((e,t)=>{const n=new Nr(e);return r(n.popLast())})).next((()=>t.store(Xi).te({ee:!0},(([e,t,n],g)=>{const i=yi(t);return r(i.popLast())}))))}Ci(e){const t=e.store(Ki);return t.te(((e,n)=>{const g=Rl(n),r=vl(this.serializer,g);return t.put(r)}))}Fi(e,t){const n=t.store(Zi),g=[];return n.te(((e,n)=>{const r=t.store(Ni),i=(s=n,s.document?new Er(Nr.fromString(s.document.name).popFirst(5)):s.noDocument?Er.fromSegments(s.noDocument.path):s.unknownDocument?Er.fromSegments(s.unknownDocument.path):rr(36783)).path.toArray(),o={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};var s;g.push(r.put(o))})).next((()=>Pr.waitFor(g)))}Mi(e,t){const n=t.store(Si),g=DC(this.serializer),r=new sc(Ic.fi,this.serializer.wt);return n.J().next((e=>{const n=new Map;return e.forEach((e=>{var t;let g=null!==(t=n.get(e.userId))&&void 0!==t?t:Fa();Sl(this.serializer,e).keys().forEach((e=>g=g.add(e))),n.set(e.userId,g)})),Pr.forEach(n,((e,n)=>{const i=new Pg(n),o=Yl.St(this.serializer,i),s=r.getIndexManager(i),a=fC.St(i,this.serializer,s,r.referenceDelegate);return new _C(g,a,o,s).recalculateAndSaveOverlaysForDocumentKeys(new vo(t,Ci.le),e).next()}))}))}}function cc(e){e.createObjectStore(Li,{keyPath:Ui}).createIndex(zi,Qi,{unique:!0}),e.createObjectStore(Ki,{keyPath:"targetId"}).createIndex(Mi,Di,{unique:!0}),e.createObjectStore(ji)}const dc="IndexedDbPersistence",uc=18e5,Ac=5e3,hc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class mc{constructor(e,t,n,g,r,i,o,s,a,I,l=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.xi=r,this.window=i,this.document=o,this.Oi=a,this.Ni=I,this.Bi=l,this.li=null,this.hi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Li=null,this.inForeground=!1,this.ki=null,this.qi=null,this.Qi=Number.NEGATIVE_INFINITY,this.$i=e=>Promise.resolve(),!mc.C())throw new Ir(ar.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new xC(this,g),this.Ui=t+"main",this.serializer=new pl(s),this.Ki=new $r(this.Ui,this.Bi,new Cc(this.serializer)),this.Pi=new Hl,this.Ti=new VC(this.referenceDelegate,this.serializer),this.remoteDocumentCache=DC(this.serializer),this.Ei=new Xl,this.window&&this.window.localStorage?this.Wi=this.window.localStorage:(this.Wi=null,!1===I&&tr(dc,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Gi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Ir(ar.FAILED_PRECONDITION,hc);return this.zi(),this.ji(),this.Hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Ti.getHighestSequenceNumber(e)))})).then((e=>{this.li=new Ci(e,this.Oi)})).then((()=>{this.hi=!0})).catch((e=>(this.Ki&&this.Ki.close(),Promise.reject(e))))}Ji(e){return this.$i=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ki.U((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.xi.enqueueAndForget((async()=>{this.started&&await this.Gi()})))}Gi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>pc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Yi(e).next((e=>{e||(this.isPrimary=!1,this.xi.enqueueRetryable((()=>this.$i(!1))))}))})).next((()=>this.Zi(e))).next((t=>this.isPrimary&&!t?this.Xi(e).next((()=>!1)):!!t&&this.es(e).next((()=>!0)))))).catch((e=>{if(gi(e))return er(dc,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return er(dc,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.xi.enqueueRetryable((()=>this.$i(e))),this.isPrimary=e}))}Yi(e){return bc(e).get(Gi).next((e=>Pr.resolve(this.ts(e))))}ns(e){return pc(e).delete(this.clientId)}async rs(){if(this.isPrimary&&!this.ss(this.Qi,uc)){this.Qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Vo(e,qi);return t.J().next((e=>{const n=this._s(e,uc),g=e.filter((e=>-1===n.indexOf(e)));return Pr.forEach(g,(e=>t.delete(e.clientId))).next((()=>g))}))})).catch((()=>[]));if(this.Wi)for(const t of e)this.Wi.removeItem(this.us(t.clientId))}}Hi(){this.qi=this.xi.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Gi().then((()=>this.rs())).then((()=>this.Hi()))))}ts(e){return!!e&&e.ownerId===this.clientId}Zi(e){return this.Ni?Pr.resolve(!0):bc(e).get(Gi).next((t=>{if(null!==t&&this.ss(t.leaseTimestampMs,Ac)&&!this.cs(t.ownerId)){if(this.ts(t)&&this.networkEnabled)return!0;if(!this.ts(t)){if(!t.allowTabSynchronization)throw new Ir(ar.FAILED_PRECONDITION,hc);return!1}}return!(!this.networkEnabled||!this.inForeground)||pc(e).J().next((e=>void 0===this._s(e,Ac).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,g=this.networkEnabled===e.networkEnabled;if(t||n&&g)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&er(dc,`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.hi=!1,this.ls(),this.qi&&(this.qi.cancel(),this.qi=null),this.hs(),this.Ps(),await this.Ki.runTransaction("shutdown","readwrite",[fi,qi],(e=>{const t=new vo(e,Ci.le);return this.Xi(t).next((()=>this.ns(t)))})),this.Ki.close(),this.Ts()}_s(e,t){return e.filter((e=>this.ss(e.updateTimeMs,t)&&!this.cs(e.clientId)))}Is(){return this.runTransaction("getActiveClients","readonly",(e=>pc(e).J().next((e=>this._s(e,uc).map((e=>e.clientId))))))}get started(){return this.hi}getGlobalsCache(){return this.Pi}getMutationQueue(e,t){return fC.St(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new CC(e,this.serializer.wt.databaseId)}getDocumentOverlayCache(e){return Yl.St(this.serializer,e)}getBundleCache(){return this.Ei}runTransaction(e,t,n){er(dc,"Starting transaction:",e);const g="readonly"===t?"readonly":"readwrite",r=18===(i=this.Bi)?Ro:17===i?So:16===i?Bo:15===i?Go:14===i?fo:13===i?Zo:12===i?yo:11===i?po:void rr(60245);var i;let o;return this.Ki.runTransaction(e,g,r,(g=>(o=new vo(g,this.li?this.li.next():Ci.le),"readwrite-primary"===t?this.Yi(o).next((e=>!!e||this.Zi(o))).next((t=>{if(!t)throw tr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.xi.enqueueRetryable((()=>this.$i(!1))),new Ir(ar.FAILED_PRECONDITION,Qr);return n(o)})).next((e=>this.es(o).next((()=>e)))):this.Es(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}Es(e){return bc(e).get(Gi).next((e=>{if(null!==e&&this.ss(e.leaseTimestampMs,Ac)&&!this.cs(e.ownerId)&&!this.ts(e)&&!(this.Ni||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Ir(ar.FAILED_PRECONDITION,hc)}))}es(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return bc(e).put(Gi,t)}static C(){return $r.C()}Xi(e){const t=bc(e);return t.get(Gi).next((e=>this.ts(e)?(er(dc,"Releasing primary lease."),t.delete(Gi)):Pr.resolve()))}ss(e,t){const n=Date.now();return!(e<n-t||e>n&&(tr(`Detected an update time that is in the future: ${e} > ${n}`),1))}zi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ki=()=>{this.xi.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Gi())))},this.document.addEventListener("visibilitychange",this.ki),this.inForeground="visible"===this.document.visibilityState)}hs(){this.ki&&(this.document.removeEventListener("visibilitychange",this.ki),this.ki=null)}ji(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Li=()=>{this.ls();const e=/(?:Version|Mobile)\/1[456]/;Pt()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.xi.enterRestrictedMode(!0),this.xi.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Li))}Ps(){this.Li&&(this.window.removeEventListener("pagehide",this.Li),this.Li=null)}cs(e){var t;try{const n=null!==(null===(t=this.Wi)||void 0===t?void 0:t.getItem(this.us(e)));return er(dc,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return tr(dc,"Failed to get zombied client id.",n),!1}}ls(){if(this.Wi)try{this.Wi.setItem(this.us(this.clientId),String(Date.now()))}catch(fp){tr("Failed to set zombie client id.",fp)}}Ts(){if(this.Wi)try{this.Wi.removeItem(this.us(this.clientId))}catch(fp){}}us(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function bc(e){return Vo(e,fi)}function pc(e){return Vo(e,qi)}function yc(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class Zc{constructor(e,t,n,g){this.targetId=e,this.fromCache=t,this.ds=n,this.As=g}static Rs(e,t){let n=Fa(),g=Fa();for(const r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:g=g.add(r.doc.key)}return new Zc(e,t.fromCache,n,g)}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fc{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=Pt()?8:ei(Ot())>0?6:4}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,n,g){const r={result:null};return this.ws(e,t).next((e=>{r.result=e})).next((()=>{if(!r.result)return this.Ss(e,t,g,n).next((e=>{r.result=e}))})).next((()=>{if(r.result)return;const n=new fc;return this.bs(e,t,n).next((g=>{if(r.result=g,this.fs)return this.Ds(e,t,n,g.size)}))})).next((()=>r.result))}Ds(e,t,n,g){return n.documentReadCount<this.gs?($g()<=dn.DEBUG&&er("QueryEngine","SDK will not create cache indexes for query:",fa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),Pr.resolve()):($g()<=dn.DEBUG&&er("QueryEngine","Query:",fa(t),"scans",n.documentReadCount,"local documents and returns",g,"documents as results."),n.documentReadCount>this.ps*g?($g()<=dn.DEBUG&&er("QueryEngine","The SDK decides to create cache indexes for query:",fa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ma(t))):Pr.resolve())}ws(e,t){if(ua(t))return Pr.resolve(null);let n=ma(t);return this.indexManager.getIndexType(e,n).next((g=>0===g?null:(null!==t.limit&&1===g&&(t=pa(t,null,"F"),n=ma(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((g=>{const r=Fa(...g);return this.ys.getDocuments(e,r).next((g=>this.indexManager.getMinOffset(e,n).next((n=>{const i=this.vs(t,g);return this.Cs(t,i,r,n.readTime)?this.ws(e,pa(t,null,"F")):this.Fs(e,i,t,n)}))))})))))}Ss(e,t,n,g){return ua(t)||g.isEqual(Wr.min())?Pr.resolve(null):this.ys.getDocuments(e,n).next((r=>{const i=this.vs(t,r);return this.Cs(t,i,n,g)?Pr.resolve(null):($g()<=dn.DEBUG&&er("QueryEngine","Re-using previous result from %s to execute query: %s",g.toString(),fa(t)),this.Fs(e,i,t,Dr(g,Hr)).next((e=>e)))}))}vs(e,t){let n=new Yo(Sa(e));return t.forEach(((t,g)=>{Ga(e,g)&&(n=n.add(g))})),n}Cs(e,t,n,g){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(g)>0)}bs(e,t,n){return $g()<=dn.DEBUG&&er("QueryEngine","Using full collection scan to execute query:",fa(t)),this.ys.getDocumentsMatchingQuery(e,t,Ur.min(),n)}Fs(e,t,n,g){return this.ys.getDocumentsMatchingQuery(e,n,g).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bc="LocalStore";class Sc{constructor(e,t,n,g){this.persistence=e,this.Ms=t,this.serializer=g,this.xs=new Xo(Zr),this.Os=new va((e=>ia(e)),oa),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(n)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new _C(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.xs)))}}function Rc(e,t,n,g){return new Sc(e,t,n,g)}async function vc(e,t){const n=sr(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let g;return n.mutationQueue.getAllMutationBatches(e).next((r=>(g=r,n.Ls(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const r=[],i=[];let o=Fa();for(const e of g){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({ks:e,removedBatchIds:r,addedBatchIds:i})))}))}))}function Vc(e){const t=sr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Ti.getLastRemoteSnapshotVersion(e)))}function wc(e,t){const n=sr(e),g=t.snapshotVersion;let r=n.xs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const i=n.Bs.newChangeBuffer({trackRemovals:!0});r=n.xs;const o=[];t.targetChanges.forEach(((i,s)=>{const a=r.get(s);if(!a)return;o.push(n.Ti.removeMatchingKeys(e,i.removedDocuments,s).next((()=>n.Ti.addMatchingKeys(e,i.addedDocuments,s))));let I=a.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(s)?I=I.withResumeToken(To.EMPTY_BYTE_STRING,Wr.min()).withLastLimboFreeSnapshotVersion(Wr.min()):i.resumeToken.approximateByteSize()>0&&(I=I.withResumeToken(i.resumeToken,g)),r=r.insert(s,I),function(e,t,n){if(0===e.resumeToken.approximateByteSize())return!0;if(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8)return!0;return n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,I,i)&&o.push(n.Ti.updateTargetData(e,I))}));let s=wa(),a=Fa();if(t.documentUpdates.forEach((g=>{t.resolvedLimboDocuments.has(g)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,g))})),o.push(function(e,t,n){let g=Fa(),r=Fa();return n.forEach((e=>g=g.add(e))),t.getEntries(e,g).next((e=>{let g=wa();return n.forEach(((n,i)=>{const o=e.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),i.isNoDocument()&&i.version.isEqual(Wr.min())?(t.removeEntry(n,i.readTime),g=g.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),g=g.insert(n,i)):er(Bc,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{qs:g,Qs:r}}))}(e,i,t.documentUpdates).next((e=>{s=e.qs,a=e.Qs}))),!g.isEqual(Wr.min())){const t=n.Ti.getLastRemoteSnapshotVersion(e).next((t=>n.Ti.setTargetsMetadata(e,e.currentSequenceNumber,g)));o.push(t)}return Pr.waitFor(o).next((()=>i.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,s,a))).next((()=>s))})).then((e=>(n.xs=r,e)))}function Wc(e,t){const n=sr(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=ci),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function kc(e,t){const n=sr(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let g;return n.Ti.getTargetData(e,t).next((r=>r?(g=r,Pr.resolve(g)):n.Ti.allocateTargetId(e).next((r=>(g=new bl(t,r,"TargetPurposeListen",e.currentSequenceNumber),n.Ti.addTargetData(e,g).next((()=>g)))))))})).then((e=>{const g=n.xs.get(e.targetId);return(null===g||e.snapshotVersion.compareTo(g.snapshotVersion)>0)&&(n.xs=n.xs.insert(e.targetId,e),n.Os.set(t,e.targetId)),e}))}async function Xc(e,t,n){const g=sr(e),r=g.xs.get(t),i=n?"readwrite":"readwrite-primary";try{n||await g.persistence.runTransaction("Release target",i,(e=>g.persistence.referenceDelegate.removeTarget(e,r)))}catch(o){if(!gi(o))throw o;er(Bc,`Failed to update sequence numbers for target ${t}: ${o}`)}g.xs=g.xs.remove(t),g.Os.delete(r.target)}function Nc(e,t,n){const g=sr(e);let r=Wr.min(),i=Fa();return g.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const g=sr(e),r=g.Os.get(n);return void 0!==r?Pr.resolve(g.xs.get(r)):g.Ti.getTargetData(t,n)}(g,e,ma(t)).next((t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,g.Ti.getMatchingKeysForTargetId(e,t.targetId).next((e=>{i=e}))})).next((()=>g.Ms.getDocumentsMatchingQuery(e,t,n?r:Wr.min(),n?i:Fa()))).next((e=>(Ec(g,Ba(t),e),{documents:e,$s:i})))))}function Jc(e,t){const n=sr(e),g=sr(n.Ti),r=n.xs.get(t);return r?Promise.resolve(r.target):n.persistence.runTransaction("Get target data","readonly",(e=>g.Rt(e,t).next((e=>e?e.target:null))))}function Yc(e,t){const n=sr(e),g=n.Ns.get(t)||Wr.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.Bs.getAllFromCollectionGroup(e,t,Dr(g,Hr),Number.MAX_SAFE_INTEGER))).then((e=>(Ec(n,t,e),e)))}function Ec(e,t,n){let g=e.Ns.get(t)||Wr.min();n.forEach(((e,t)=>{t.readTime.compareTo(g)>0&&(g=t.readTime)})),e.Ns.set(t,g)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hc="firestore_clients";function Fc(e,t){return`${Hc}_${e}_${t}`}const xc="firestore_mutations";function Tc(e,t,n){let g=`${xc}_${e}_${n}`;return t.isAuthenticated()&&(g+=`_${t.uid}`),g}const Kc="firestore_targets";function Mc(e,t){return`${Kc}_${e}_${t}`}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dc="SharedClientState";class Lc{constructor(e,t,n,g){this.user=e,this.batchId=t,this.state=n,this.error=g}static Gs(e,t,n){const g=JSON.parse(n);let r,i="object"==typeof g&&-1!==["pending","acknowledged","rejected"].indexOf(g.state)&&(void 0===g.error||"object"==typeof g.error);return i&&g.error&&(i="string"==typeof g.error.message&&"string"==typeof g.error.code,i&&(r=new Ir(g.error.code,g.error.message))),i?new Lc(e,t,g.state,r):(tr(Dc,`Failed to parse mutation state for ID '${t}': ${n}`),null)}zs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Uc{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Gs(e,t){const n=JSON.parse(t);let g,r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code,r&&(g=new Ir(n.error.code,n.error.message))),r?new Uc(e,n.state,g):(tr(Dc,`Failed to parse target state for ID '${e}': ${t}`),null)}zs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class zc{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Gs(e,t){const n=JSON.parse(t);let g="object"==typeof n&&n.activeTargetIds instanceof Array,r=Ta();for(let i=0;g&&i<n.activeTargetIds.length;++i)g=Ai(n.activeTargetIds[i]),r=r.add(n.activeTargetIds[i]);return g?new zc(e,r):(tr(Dc,`Failed to parse client data for instance '${e}': ${t}`),null)}}class Qc{constructor(e,t){this.clientId=e,this.onlineState=t}static Gs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Qc(t.clientId,t.onlineState):(tr(Dc,`Failed to parse online state: ${e}`),null)}}class Oc{constructor(){this.activeTargetIds=Ta()}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class jc{constructor(e,t,n,g,r){this.window=e,this.xi=t,this.persistenceKey=n,this.Js=g,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ys=this.Zs.bind(this),this.Xs=new Xo(Zr),this.started=!1,this.eo=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=r,this.no=Fc(this.persistenceKey,this.Js),this.ro=`firestore_sequence_number_${this.persistenceKey}`,this.Xs=this.Xs.insert(this.Js,new Oc),this.io=new RegExp(`^${Hc}_${i}_([^_]*)$`),this.so=new RegExp(`^${xc}_${i}_(\\d+)(?:_(.*))?$`),this.oo=new RegExp(`^${Kc}_${i}_(\\d+)$`),this._o=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.ao=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.Ys)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Is();for(const n of e){if(n===this.Js)continue;const e=this.getItem(Fc(this.persistenceKey,n));if(e){const t=zc.Gs(n,e);t&&(this.Xs=this.Xs.insert(t.clientId,t))}}this.uo();const t=this.storage.getItem(this._o);if(t){const e=this.co(t);e&&this.lo(e)}for(const n of this.eo)this.Zs(n);this.eo=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.ro,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ho(this.Xs)}isActiveQueryTarget(e){let t=!1;return this.Xs.forEach(((n,g)=>{g.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Po(e,"pending")}updateMutationState(e,t,n){this.Po(e,t,n),this.To(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const t=this.storage.getItem(Mc(this.persistenceKey,e));if(t){const g=Uc.Gs(e,t);g&&(n=g.state)}}return t&&this.Io.js(e),this.uo(),n}removeLocalQueryTarget(e){this.Io.Hs(e),this.uo()}isLocalQueryTarget(e){return this.Io.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Mc(this.persistenceKey,e))}updateQueryState(e,t,n){this.Eo(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.To(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Ao(e)}notifyBundleLoaded(e){this.Ro(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ys),this.removeItem(this.no),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return er(Dc,"READ",e,t),t}setItem(e,t){er(Dc,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){er(Dc,"REMOVE",e),this.storage.removeItem(e)}Zs(e){const t=e;if(t.storageArea===this.storage){if(er(Dc,"EVENT",t.key,t.newValue),t.key===this.no)return void tr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.xi.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.io.test(t.key)){if(null==t.newValue){const e=this.Vo(t.key);return this.mo(e,null)}{const e=this.fo(t.key,t.newValue);if(e)return this.mo(e.clientId,e)}}else if(this.so.test(t.key)){if(null!==t.newValue){const e=this.po(t.key,t.newValue);if(e)return this.yo(e)}}else if(this.oo.test(t.key)){if(null!==t.newValue){const e=this.wo(t.key,t.newValue);if(e)return this.So(e)}}else if(t.key===this._o){if(null!==t.newValue){const e=this.co(t.newValue);if(e)return this.lo(e)}}else if(t.key===this.ro){const e=function(e){let t=Ci.le;if(null!=e)try{const n=JSON.parse(e);or("number"==typeof n,30636,{bo:e}),t=n}catch(n){tr(Dc,"Failed to read sequence number from WebStorage",n)}return t}(t.newValue);e!==Ci.le&&this.sequenceNumberHandler(e)}else if(t.key===this.ao){const e=this.Do(t.newValue);await Promise.all(e.map((e=>this.syncEngine.vo(e))))}}else this.eo.push(t)}))}}get Io(){return this.Xs.get(this.Js)}uo(){this.setItem(this.no,this.Io.zs())}Po(e,t,n){const g=new Lc(this.currentUser,e,t,n),r=Tc(this.persistenceKey,this.currentUser,e);this.setItem(r,g.zs())}To(e){const t=Tc(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Ao(e){const t={clientId:this.Js,onlineState:e};this.storage.setItem(this._o,JSON.stringify(t))}Eo(e,t,n){const g=Mc(this.persistenceKey,e),r=new Uc(e,t,n);this.setItem(g,r.zs())}Ro(e){const t=JSON.stringify(Array.from(e));this.setItem(this.ao,t)}Vo(e){const t=this.io.exec(e);return t?t[1]:null}fo(e,t){const n=this.Vo(e);return zc.Gs(n,t)}po(e,t){const n=this.so.exec(e),g=Number(n[1]),r=void 0!==n[2]?n[2]:null;return Lc.Gs(new Pg(r),g,t)}wo(e,t){const n=this.oo.exec(e),g=Number(n[1]);return Uc.Gs(g,t)}co(e){return Qc.Gs(e)}Do(e){return JSON.parse(e)}async yo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Co(e.batchId,e.state,e.error);er(Dc,`Ignoring mutation for non-active user ${e.user.uid}`)}So(e){return this.syncEngine.Fo(e.targetId,e.state,e.error)}mo(e,t){const n=t?this.Xs.insert(e,t):this.Xs.remove(e),g=this.ho(this.Xs),r=this.ho(n),i=[],o=[];return r.forEach((e=>{g.has(e)||i.push(e)})),g.forEach((e=>{r.has(e)||o.push(e)})),this.syncEngine.Mo(i,o).then((()=>{this.Xs=n}))}lo(e){this.Xs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ho(e){let t=Ta();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class Pc{constructor(){this.xo=new Oc,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,n){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new Oc,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{No(e){}shutdown(){}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qc="ConnectivityMonitor";class $c{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){er(qc,"Network connectivity changed: AVAILABLE");for(const e of this.Qo)e(0)}qo(){er(qc,"Network connectivity changed: UNAVAILABLE");for(const e of this.Qo)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ed=null;function td(){return null===ed?ed=268435456+Math.round(2147483648*Math.random()):ed++,"0x"+ed.toString(16)
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}const nd="RestConnection",gd={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class rd{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),g=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${n}/databases/${g}`,this.Go=this.databaseId.database===$o?`project_id=${n}`:`project_id=${n}&database_id=${g}`}zo(e,t,n,g,r){const i=td(),o=this.jo(e,t.toUriEncodedString());er(nd,`Sending RPC '${e}' ${i}:`,o,n);const s={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(s,g,r);const{host:a}=new URL(o),I=Dt(a);return this.Jo(e,o,s,n,I).then((t=>(er(nd,`Received RPC '${e}' ${i}: `,t),t)),(t=>{throw nr(nd,`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",n),t}))}Yo(e,t,n,g,r,i){return this.zo(e,t,n,g,r)}Ho(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+_g,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}jo(e,t){const n=gd[e];return`${this.Ko}/v1/${t}:${n}`}terminate(){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class id{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const od="WebChannelConnection";class sd extends rd{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,g,r){const i=td();return new Promise(((r,o)=>{const s=new xg;s.setWithCredentials(!0),s.listenOnce(Kg.COMPLETE,(()=>{try{switch(s.getLastErrorCode()){case Mg.NO_ERROR:const t=s.getResponseJson();er(od,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),r(t);break;case Mg.TIMEOUT:er(od,`RPC '${e}' ${i} timed out`),o(new Ir(ar.DEADLINE_EXCEEDED,"Request time out"));break;case Mg.HTTP_ERROR:const n=s.getStatus();if(er(od,`RPC '${e}' ${i} failed with status:`,n,"response text:",s.getResponseText()),n>0){let e=s.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(ar).indexOf(t)>=0?t:ar.UNKNOWN}(t.status);o(new Ir(e,t.message))}else o(new Ir(ar.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Ir(ar.UNAVAILABLE,"Connection failed."));break;default:rr(9055,{l_:e,streamId:i,h_:s.getLastErrorCode(),P_:s.getLastError()})}}finally{er(od,`RPC '${e}' ${i} completed.`)}}));const a=JSON.stringify(g);er(od,`RPC '${e}' ${i} sending request:`,g),s.send(t,"POST",a,n,15)}))}T_(e,t,n){const g=td(),r=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=zg(),o=Ug(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},a=this.longPollingOptions.timeoutSeconds;void 0!==a&&(s.longPollingTimeout=Math.round(1e3*a)),this.useFetchStreams&&(s.useFetchStreams=!0),this.Ho(s.initMessageHeaders,t,n),s.encodeInitMessageHeaders=!0;const I=r.join("");er(od,`Creating RPC '${e}' stream ${g}: ${I}`,s);const l=i.createWebChannel(I,s);let C=!1,c=!1;const d=new id({Zo:t=>{c?er(od,`Not sending because RPC '${e}' stream ${g} is closed:`,t):(C||(er(od,`Opening RPC '${e}' stream ${g} transport.`),l.open(),C=!0),er(od,`RPC '${e}' stream ${g} sending:`,t),l.send(t))},Xo:()=>l.close()}),u=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(t){setTimeout((()=>{throw t}),0)}}))};return u(l,Tg.EventType.OPEN,(()=>{c||(er(od,`RPC '${e}' stream ${g} transport opened.`),d.__())})),u(l,Tg.EventType.CLOSE,(()=>{c||(c=!0,er(od,`RPC '${e}' stream ${g} transport closed`),d.u_())})),u(l,Tg.EventType.ERROR,(t=>{c||(c=!0,nr(od,`RPC '${e}' stream ${g} transport errored. Name:`,t.name,"Message:",t.message),d.u_(new Ir(ar.UNAVAILABLE,"The operation could not be completed")))})),u(l,Tg.EventType.MESSAGE,(t=>{var n;if(!c){const r=t.data[0];or(!!r,16349);const i=r,o=(null==i?void 0:i.error)||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){er(od,`RPC '${e}' stream ${g} received error:`,o);const t=o.status;let n=function(e){const t=fI[e];if(void 0!==t)return BI(t)}(t),r=o.message;void 0===n&&(n=ar.INTERNAL,r="Unknown error status: "+t+" with message "+o.message),c=!0,d.u_(new Ir(n,r)),l.close()}else er(od,`RPC '${e}' stream ${g} received:`,r),d.c_(r)}})),u(o,Lg.STAT_EVENT,(t=>{t.stat===Dg.PROXY?er(od,`RPC '${e}' stream ${g} detected buffering proxy`):t.stat===Dg.NOPROXY&&er(od,`RPC '${e}' stream ${g} detected no buffering proxy`)})),setTimeout((()=>{d.a_()}),0),d}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ad(){return"undefined"!=typeof window?window:null}function Id(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ld(e){return new MI(e,!0)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cd{constructor(e,t,n=1e3,g=1.5,r=6e4){this.xi=e,this.timerId=t,this.I_=n,this.E_=g,this.d_=r,this.A_=0,this.R_=null,this.V_=Date.now(),this.reset()}reset(){this.A_=0}m_(){this.A_=this.d_}f_(e){this.cancel();const t=Math.floor(this.A_+this.g_()),n=Math.max(0,Date.now()-this.V_),g=Math.max(0,t-n);g>0&&er("ExponentialBackoff",`Backing off for ${g} ms (base delay: ${this.A_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.R_=this.xi.enqueueAfterDelay(this.timerId,g,(()=>(this.V_=Date.now(),e()))),this.A_*=this.E_,this.A_<this.I_&&(this.A_=this.I_),this.A_>this.d_&&(this.A_=this.d_)}p_(){null!==this.R_&&(this.R_.skipDelay(),this.R_=null)}cancel(){null!==this.R_&&(this.R_.cancel(),this.R_=null)}g_(){return(Math.random()-.5)*this.A_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cd="PersistentStream";class dd{constructor(e,t,n,g,r,i,o,s){this.xi=e,this.y_=n,this.w_=g,this.connection=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=s,this.state=0,this.S_=0,this.b_=null,this.D_=null,this.stream=null,this.v_=0,this.C_=new Cd(e,t)}F_(){return 1===this.state||5===this.state||this.M_()}M_(){return 2===this.state||3===this.state}start(){this.v_=0,4!==this.state?this.auth():this.x_()}async stop(){this.F_()&&await this.close(0)}O_(){this.state=0,this.C_.reset()}N_(){this.M_()&&null===this.b_&&(this.b_=this.xi.enqueueAfterDelay(this.y_,6e4,(()=>this.B_())))}L_(e){this.k_(),this.stream.send(e)}async B_(){if(this.M_())return this.close(0)}k_(){this.b_&&(this.b_.cancel(),this.b_=null)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}async close(e,t){this.k_(),this.q_(),this.C_.cancel(),this.S_++,4!==e?this.C_.reset():t&&t.code===ar.RESOURCE_EXHAUSTED?(tr(t.toString()),tr("Using maximum backoff delay to prevent overloading the backend."),this.C_.m_()):t&&t.code===ar.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Q_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}Q_(){}auth(){this.state=1;const e=this.U_(this.S_),t=this.S_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.S_===t&&this.K_(e,n)}),(t=>{e((()=>{const e=new Ir(ar.UNKNOWN,"Fetching auth token failed: "+t.message);return this.W_(e)}))}))}K_(e,t){const n=this.U_(this.S_);this.stream=this.G_(e,t),this.stream.e_((()=>{n((()=>this.listener.e_()))})),this.stream.n_((()=>{n((()=>(this.state=2,this.D_=this.xi.enqueueAfterDelay(this.w_,1e4,(()=>(this.M_()&&(this.state=3),Promise.resolve()))),this.listener.n_())))})),this.stream.i_((e=>{n((()=>this.W_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.v_?this.z_(e):this.onNext(e)))}))}x_(){this.state=5,this.C_.f_((async()=>{this.state=0,this.start()}))}W_(e){return er(cd,`close with error: ${e}`),this.stream=null,this.close(4,e)}U_(e){return t=>{this.xi.enqueueAndForget((()=>this.S_===e?t():(er(cd,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ud extends dd{constructor(e,t,n,g,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,g,i),this.serializer=r}G_(e,t){return this.connection.T_("Listen",e,t)}z_(e){return this.onNext(e)}onNext(e){this.C_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r="NO_CHANGE"===(g=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===g?1:"REMOVE"===g?2:"CURRENT"===g?3:"RESET"===g?4:rr(39313,{state:g}),i=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(or(void 0===t||"string"==typeof t,58123),To.fromBase64String(t||"")):(or(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),To.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),s=t.targetChange.cause,a=s&&function(e){const t=void 0===e.code?ar.UNKNOWN:BI(e.code);return new Ir(t,e.message||"")}(s);n=new JI(r,i,o,a||null)}else if("documentChange"in t){t.documentChange;const g=t.documentChange;g.document,g.document.name,g.document.updateTime;const r=qI(e,g.document.name),i=QI(g.document.updateTime),o=g.document.createTime?QI(g.document.createTime):Wr.min(),s=new Ws({mapValue:{fields:g.document.fields}}),a=Xs.newFoundDocument(r,i,o,s),I=g.targetIds||[],l=g.removedTargetIds||[];n=new XI(I,l,a.key,a)}else if("documentDelete"in t){t.documentDelete;const g=t.documentDelete;g.document;const r=qI(e,g.document),i=g.readTime?QI(g.readTime):Wr.min(),o=Xs.newNoDocument(r,i),s=g.removedTargetIds||[];n=new XI([],s,o.key,o)}else if("documentRemove"in t){t.documentRemove;const g=t.documentRemove;g.document;const r=qI(e,g.document),i=g.removedTargetIds||[];n=new XI([],i,r,null)}else{if(!("filter"in t))return rr(11601,{Vt:t});{t.filter;const e=t.filter;e.targetId;const{count:g=0,unchangedNames:r}=e,i=new ZI(g,r),o=e.targetId;n=new NI(o,i)}}var g;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Wr.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Wr.min():t.readTime?QI(t.readTime):Wr.min()}(e);return this.listener.j_(t,n)}H_(e){const t={};t.database=tl(this.serializer),t.addTarget=function(e,t){let n;const g=t.target;if(n=sa(g)?{documents:ol(e,g)}:{query:sl(e,g).gt},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=UI(e,t.resumeToken);const g=DI(e,t.expectedCount);null!==g&&(n.expectedCount=g)}else if(t.snapshotVersion.compareTo(Wr.min())>0){n.readTime=LI(e,t.snapshotVersion.toTimestamp());const g=DI(e,t.expectedCount);null!==g&&(n.expectedCount=g)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return rr(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.L_(t)}J_(e){const t={};t.database=tl(this.serializer),t.removeTarget=e,this.L_(t)}}class Ad extends dd{constructor(e,t,n,g,r,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,g,i),this.serializer=r}get Y_(){return this.v_>0}start(){this.lastStreamToken=void 0,super.start()}Q_(){this.Y_&&this.Z_([])}G_(e,t){return this.connection.T_("Write",e,t)}z_(e){return or(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,or(!e.writeResults||0===e.writeResults.length,55816),this.listener.X_()}onNext(e){or(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.C_.reset();const t=function(e,t){return e&&e.length>0?(or(void 0!==t,14353),e.map((e=>function(e,t){let n=e.updateTime?QI(e.updateTime):QI(t);return n.isEqual(Wr.min())&&(n=QI(t)),new nI(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=QI(e.commitTime);return this.listener.ea(n,t)}ta(){const e={};e.database=tl(this.serializer),this.L_(e)}Z_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>rl(this.serializer,e)))};this.L_(t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hd{}class md extends hd{constructor(e,t,n,g){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=g,this.na=!1}ra(){if(this.na)throw new Ir(ar.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,n,g){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.zo(e,jI(t,n),g,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===ar.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ir(ar.UNKNOWN,e.toString())}))}Yo(e,t,n,g,r){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.Yo(e,jI(t,n),g,i,o,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===ar.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Ir(ar.UNKNOWN,e.toString())}))}terminate(){this.na=!0,this.connection.terminate()}}class bd{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ia=0,this.sa=null,this.oa=!0}_a(){0===this.ia&&(this.aa("Unknown"),this.sa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.sa=null,this.ua("Backend didn't respond within 10 seconds."),this.aa("Offline"),Promise.resolve()))))}ca(e){"Online"===this.state?this.aa("Unknown"):(this.ia++,this.ia>=1&&(this.la(),this.ua(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.aa("Offline")))}set(e){this.la(),this.ia=0,"Online"===e&&(this.oa=!1),this.aa(e)}aa(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ua(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.oa?(tr(t),this.oa=!1):er("OnlineStateTracker",t)}la(){null!==this.sa&&(this.sa.cancel(),this.sa=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pd="RemoteStore";class yd{constructor(e,t,n,g,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.ha=[],this.Pa=new Map,this.Ta=new Set,this.Ia=[],this.Ea=r,this.Ea.No((e=>{n.enqueueAndForget((async()=>{wd(this)&&(er(pd,"Restarting streams for network reachability change."),await async function(e){const t=sr(e);t.Ta.add(4),await fd(t),t.da.set("Unknown"),t.Ta.delete(4),await Zd(t)}(this))}))})),this.da=new bd(n,g)}}async function Zd(e){if(wd(e))for(const t of e.Ia)await t(!0)}async function fd(e){for(const t of e.Ia)await t(!1)}function Gd(e,t){const n=sr(e);n.Pa.has(t.targetId)||(n.Pa.set(t.targetId,t),Vd(n)?vd(n):Od(n).M_()&&Sd(n,t))}function Bd(e,t){const n=sr(e),g=Od(n);n.Pa.delete(t),g.M_()&&Rd(n,t),0===n.Pa.size&&(g.M_()?g.N_():wd(n)&&n.da.set("Unknown"))}function Sd(e,t){if(e.Aa.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Wr.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Od(e).H_(t)}function Rd(e,t){e.Aa.Ke(t),Od(e).J_(t)}function vd(e){e.Aa=new EI({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>e.Pa.get(t)||null,Pt:()=>e.datastore.serializer.databaseId}),Od(e).start(),e.da._a()}function Vd(e){return wd(e)&&!Od(e).F_()&&e.Pa.size>0}function wd(e){return 0===sr(e).Ta.size}function Wd(e){e.Aa=void 0}async function kd(e){e.da.set("Online")}async function Xd(e){e.Pa.forEach(((t,n)=>{Sd(e,t)}))}async function Nd(e,t){Wd(e),Vd(e)?(e.da.ca(t),vd(e)):e.da.set("Unknown")}async function Jd(e,t,n){if(e.da.set("Online"),t instanceof JI&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const g of t.targetIds)e.Pa.has(g)&&(await e.remoteSyncer.rejectListen(g,n),e.Pa.delete(g),e.Aa.removeTarget(g))}(e,t)}catch(g){er(pd,"Failed to remove targets %s: %s ",t.targetIds.join(","),g),await Yd(e,g)}else if(t instanceof XI?e.Aa.Xe(t):t instanceof NI?e.Aa.ot(t):e.Aa.nt(t),!n.isEqual(Wr.min()))try{const t=await Vc(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Aa.It(t);return n.targetChanges.forEach(((n,g)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.Pa.get(g);r&&e.Pa.set(g,r.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const g=e.Pa.get(t);if(!g)return;e.Pa.set(t,g.withResumeToken(To.EMPTY_BYTE_STRING,g.snapshotVersion)),Rd(e,t);const r=new bl(g.target,t,n,g.sequenceNumber);Sd(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(r){er(pd,"Failed to raise snapshot:",r),await Yd(e,r)}}async function Yd(e,t,n){if(!gi(t))throw t;e.Ta.add(1),await fd(e),e.da.set("Offline"),n||(n=()=>Vc(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{er(pd,"Retrying IndexedDB access"),await n(),e.Ta.delete(1),await Zd(e)}))}function Ed(e,t){return t().catch((n=>Yd(e,n,t)))}async function Hd(e){const t=sr(e),n=jd(t);let g=t.ha.length>0?t.ha[t.ha.length-1].batchId:ci;for(;Fd(t);)try{const e=await Wc(t.localStore,g);if(null===e){0===t.ha.length&&n.N_();break}g=e.batchId,xd(t,e)}catch(r){await Yd(t,r)}Td(t)&&Kd(t)}function Fd(e){return wd(e)&&e.ha.length<10}function xd(e,t){e.ha.push(t);const n=jd(e);n.M_()&&n.Y_&&n.Z_(t.mutations)}function Td(e){return wd(e)&&!jd(e).F_()&&e.ha.length>0}function Kd(e){jd(e).start()}async function Md(e){jd(e).ta()}async function Dd(e){const t=jd(e);for(const n of e.ha)t.Z_(n.mutations)}async function Ld(e,t,n){const g=e.ha.shift(),r=pI.from(g,t,n);await Ed(e,(()=>e.remoteSyncer.applySuccessfulWrite(r))),await Hd(e)}async function Ud(e,t){t&&jd(e).Y_&&await async function(e,t){if(function(e){switch(e){case ar.OK:return rr(64938);case ar.CANCELLED:case ar.UNKNOWN:case ar.DEADLINE_EXCEEDED:case ar.RESOURCE_EXHAUSTED:case ar.INTERNAL:case ar.UNAVAILABLE:case ar.UNAUTHENTICATED:return!1;case ar.INVALID_ARGUMENT:case ar.NOT_FOUND:case ar.ALREADY_EXISTS:case ar.PERMISSION_DENIED:case ar.FAILED_PRECONDITION:case ar.ABORTED:case ar.OUT_OF_RANGE:case ar.UNIMPLEMENTED:case ar.DATA_LOSS:return!0;default:return rr(15467,{code:e})}}(n=t.code)&&n!==ar.ABORTED){const n=e.ha.shift();jd(e).O_(),await Ed(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Hd(e)}var n}(e,t),Td(e)&&Kd(e)}async function zd(e,t){const n=sr(e);n.asyncQueue.verifyOperationInProgress(),er(pd,"RemoteStore received new credentials");const g=wd(n);n.Ta.add(3),await fd(n),g&&n.da.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ta.delete(3),await Zd(n)}async function Qd(e,t){const n=sr(e);t?(n.Ta.delete(2),await Zd(n)):t||(n.Ta.add(2),await fd(n),n.da.set("Unknown"))}function Od(e){return e.Ra||(e.Ra=function(e,t,n){const g=sr(e);return g.ra(),new ud(t,g.connection,g.authCredentials,g.appCheckCredentials,g.serializer,n)}(e.datastore,e.asyncQueue,{e_:kd.bind(null,e),n_:Xd.bind(null,e),i_:Nd.bind(null,e),j_:Jd.bind(null,e)}),e.Ia.push((async t=>{t?(e.Ra.O_(),Vd(e)?vd(e):e.da.set("Unknown")):(await e.Ra.stop(),Wd(e))}))),e.Ra}function jd(e){return e.Va||(e.Va=function(e,t,n){const g=sr(e);return g.ra(),new Ad(t,g.connection,g.authCredentials,g.appCheckCredentials,g.serializer,n)}(e.datastore,e.asyncQueue,{e_:()=>Promise.resolve(),n_:Md.bind(null,e),i_:Ud.bind(null,e),X_:Dd.bind(null,e),ea:Ld.bind(null,e)}),e.Ia.push((async t=>{t?(e.Va.O_(),await Hd(e)):(await e.Va.stop(),e.ha.length>0&&(er(pd,`Stopping write stream with ${e.ha.length} pending writes`),e.ha=[]))}))),e.Va
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class Pd{constructor(e,t,n,g,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=g,this.removalCallback=r,this.deferred=new lr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,g,r){const i=Date.now()+n,o=new Pd(e,t,i,g,r);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ir(ar.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function _d(e,t){if(tr("AsyncQueue",`${t}: ${e}`),gi(e))return new Ir(ar.UNAVAILABLE,`${t}: ${e}`);throw e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qd{static emptySet(e){return new qd(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||Er.comparator(t.key,n.key):(e,t)=>Er.comparator(e.key,t.key),this.keyedMap=ka(),this.sortedSet=new Xo(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof qd))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,g=n.getNext().key;if(!e.isEqual(g))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new qd;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d{constructor(){this.ma=new Xo(Er.comparator)}track(e){const t=e.doc.key,n=this.ma.get(t);n?0!==e.type&&3===n.type?this.ma=this.ma.insert(t,e):3===e.type&&1!==n.type?this.ma=this.ma.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ma=this.ma.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ma=this.ma.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ma=this.ma.remove(t):1===e.type&&2===n.type?this.ma=this.ma.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ma=this.ma.insert(t,{type:2,doc:e.doc}):rr(63341,{Vt:e,fa:n}):this.ma=this.ma.insert(t,e)}ga(){const e=[];return this.ma.inorderTraversal(((t,n)=>{e.push(n)})),e}}class eu{constructor(e,t,n,g,r,i,o,s,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=g,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=s,this.hasCachedResults=a}static fromInitialDocuments(e,t,n,g,r){const i=[];return t.forEach((e=>{i.push({type:0,doc:e})})),new eu(e,t,qd.emptySet(t),i,n,g,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ya(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let g=0;g<t.length;g++)if(t[g].type!==n[g].type||!t[g].doc.isEqual(n[g].doc))return!1;return!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu{constructor(){this.pa=void 0,this.ya=[]}wa(){return this.ya.some((e=>e.Sa()))}}class nu{constructor(){this.queries=gu(),this.onlineState="Unknown",this.ba=new Set}terminate(){!function(e,t){const n=sr(e),g=n.queries;n.queries=gu(),g.forEach(((e,n)=>{for(const g of n.ya)g.onError(t)}))}(this,new Ir(ar.ABORTED,"Firestore shutting down"))}}function gu(){return new va((e=>Za(e)),ya)}async function ru(e,t){const n=sr(e);let g=3;const r=t.query;let i=n.queries.get(r);i?!i.wa()&&t.Sa()&&(g=2):(i=new tu,g=t.Sa()?0:1);try{switch(g){case 0:i.pa=await n.onListen(r,!0);break;case 1:i.pa=await n.onListen(r,!1);break;case 2:await n.onFirstRemoteStoreListen(r)}}catch(o){const e=_d(o,`Initialization of query '${fa(t.query)}' failed`);return void t.onError(e)}n.queries.set(r,i),i.ya.push(t),t.Da(n.onlineState),i.pa&&t.va(i.pa)&&au(n)}async function iu(e,t){const n=sr(e),g=t.query;let r=3;const i=n.queries.get(g);if(i){const e=i.ya.indexOf(t);e>=0&&(i.ya.splice(e,1),0===i.ya.length?r=t.Sa()?0:1:!i.wa()&&t.Sa()&&(r=2))}switch(r){case 0:return n.queries.delete(g),n.onUnlisten(g,!0);case 1:return n.queries.delete(g),n.onUnlisten(g,!1);case 2:return n.onLastRemoteStoreUnlisten(g);default:return}}function ou(e,t){const n=sr(e);let g=!1;for(const r of t){const e=r.query,t=n.queries.get(e);if(t){for(const e of t.ya)e.va(r)&&(g=!0);t.pa=r}}g&&au(n)}function su(e,t,n){const g=sr(e),r=g.queries.get(t);if(r)for(const i of r.ya)i.onError(n);g.queries.delete(t)}function au(e){e.ba.forEach((e=>{e.next()}))}var Iu,lu;(lu=Iu||(Iu={})).Ca="default",lu.Cache="cache";class Cu{constructor(e,t,n){this.query=e,this.Fa=t,this.Ma=!1,this.xa=null,this.onlineState="Unknown",this.options=n||{}}va(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new eu(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Ma?this.Oa(e)&&(this.Fa.next(e),t=!0):this.Na(e,this.onlineState)&&(this.Ba(e),t=!0),this.xa=e,t}onError(e){this.Fa.error(e)}Da(e){this.onlineState=e;let t=!1;return this.xa&&!this.Ma&&this.Na(this.xa,e)&&(this.Ba(this.xa),t=!0),t}Na(e,t){if(!e.fromCache)return!0;if(!this.Sa())return!0;const n="Offline"!==t;return(!this.options.La||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Oa(e){if(e.docChanges.length>0)return!0;const t=this.xa&&this.xa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Ba(e){e=eu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Ma=!0,this.Fa.next(e)}Sa(){return this.options.source!==Iu.Cache}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu{constructor(e){this.key=e}}class du{constructor(e){this.key=e}}class uu{constructor(e,t){this.query=e,this.Ga=t,this.za=null,this.hasCachedResults=!1,this.current=!1,this.ja=Fa(),this.mutatedKeys=Fa(),this.Ha=Sa(e),this.Ja=new qd(this.Ha)}get Ya(){return this.Ga}Za(e,t){const n=t?t.Xa:new $d,g=t?t.Ja:this.Ja;let r=t?t.mutatedKeys:this.mutatedKeys,i=g,o=!1;const s="F"===this.query.limitType&&g.size===this.query.limit?g.last():null,a="L"===this.query.limitType&&g.size===this.query.limit?g.first():null;if(e.inorderTraversal(((e,t)=>{const I=g.get(e),l=Ga(this.query,t)?t:null,C=!!I&&this.mutatedKeys.has(I.key),c=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let d=!1;I&&l?I.data.isEqual(l.data)?C!==c&&(n.track({type:3,doc:l}),d=!0):this.eu(I,l)||(n.track({type:2,doc:l}),d=!0,(s&&this.Ha(l,s)>0||a&&this.Ha(l,a)<0)&&(o=!0)):!I&&l?(n.track({type:0,doc:l}),d=!0):I&&!l&&(n.track({type:1,doc:I}),d=!0,(s||a)&&(o=!0)),d&&(l?(i=i.add(l),r=c?r.add(e):r.delete(e)):(i=i.delete(e),r=r.delete(e)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{Ja:i,Xa:n,Cs:o,mutatedKeys:r}}eu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,g){const r=this.Ja;this.Ja=e.Ja,this.mutatedKeys=e.mutatedKeys;const i=e.Xa.ga();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return rr(20277,{Vt:e})}};return n(e)-n(t)}(e.type,t.type)||this.Ha(e.doc,t.doc))),this.tu(n),g=null!=g&&g;const o=t&&!g?this.nu():[],s=0===this.ja.size&&this.current&&!g?1:0,a=s!==this.za;return this.za=s,0!==i.length||a?{snapshot:new eu(this.query,e.Ja,r,i,e.mutatedKeys,0===s,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),ru:o}:{ru:o}}Da(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ja:this.Ja,Xa:new $d,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ru:[]}}iu(e){return!this.Ga.has(e)&&!!this.Ja.has(e)&&!this.Ja.get(e).hasLocalMutations}tu(e){e&&(e.addedDocuments.forEach((e=>this.Ga=this.Ga.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ga=this.Ga.delete(e))),this.current=e.current)}nu(){if(!this.current)return[];const e=this.ja;this.ja=Fa(),this.Ja.forEach((e=>{this.iu(e.key)&&(this.ja=this.ja.add(e.key))}));const t=[];return e.forEach((e=>{this.ja.has(e)||t.push(new du(e))})),this.ja.forEach((n=>{e.has(n)||t.push(new cu(n))})),t}su(e){this.Ga=e.$s,this.ja=Fa();const t=this.Za(e.documents);return this.applyChanges(t,!0)}ou(){return eu.fromInitialDocuments(this.query,this.Ja,this.mutatedKeys,0===this.za,this.hasCachedResults)}}const Au="SyncEngine";class hu{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class mu{constructor(e){this.key=e,this._u=!1}}class bu{constructor(e,t,n,g,r,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=g,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.au={},this.uu=new va((e=>Za(e)),ya),this.cu=new Map,this.lu=new Set,this.hu=new Xo(Er.comparator),this.Pu=new Map,this.Tu=new tc,this.Iu={},this.Eu=new Map,this.du=vC.lr(),this.onlineState="Unknown",this.Au=void 0}get isPrimaryClient(){return!0===this.Au}}async function pu(e,t,n=!0){const g=Ou(e);let r;const i=g.uu.get(t);return i?(g.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.ou()):r=await Zu(g,t,n,!0),r}async function yu(e,t){const n=Ou(e);await Zu(n,t,!0,!1)}async function Zu(e,t,n,g){const r=await kc(e.localStore,ma(t)),i=r.targetId,o=e.sharedClientState.addLocalQueryTarget(i,n);let s;return g&&(s=await fu(e,t,i,"current"===o,r.resumeToken)),e.isPrimaryClient&&n&&Gd(e.remoteStore,r),s}async function fu(e,t,n,g,r){e.Ru=(t,n,g)=>async function(e,t,n,g){let r=t.view.Za(n);r.Cs&&(r=await Nc(e.localStore,t.query,!1).then((({documents:e})=>t.view.Za(e,r))));const i=g&&g.targetChanges.get(t.targetId),o=g&&null!=g.targetMismatches.get(t.targetId),s=t.view.applyChanges(r,e.isPrimaryClient,i,o);return Ju(e,t.targetId,s.ru),s.snapshot}(e,t,n,g);const i=await Nc(e.localStore,t,!0),o=new uu(t,i.$s),s=o.Za(i.documents),a=kI.createSynthesizedTargetChangeForCurrentChange(n,g&&"Offline"!==e.onlineState,r),I=o.applyChanges(s,e.isPrimaryClient,a);Ju(e,n,I.ru);const l=new hu(t,n,o);return e.uu.set(t,l),e.cu.has(n)?e.cu.get(n).push(t):e.cu.set(n,[t]),I.snapshot}async function Gu(e,t,n){const g=sr(e),r=g.uu.get(t),i=g.cu.get(r.targetId);if(i.length>1)return g.cu.set(r.targetId,i.filter((e=>!ya(e,t)))),void g.uu.delete(t);g.isPrimaryClient?(g.sharedClientState.removeLocalQueryTarget(r.targetId),g.sharedClientState.isActiveQueryTarget(r.targetId)||await Xc(g.localStore,r.targetId,!1).then((()=>{g.sharedClientState.clearQueryState(r.targetId),n&&Bd(g.remoteStore,r.targetId),Xu(g,r.targetId)})).catch(jr)):(Xu(g,r.targetId),await Xc(g.localStore,r.targetId,!0))}async function Bu(e,t){const n=sr(e),g=n.uu.get(t),r=n.cu.get(g.targetId);n.isPrimaryClient&&1===r.length&&(n.sharedClientState.removeLocalQueryTarget(g.targetId),Bd(n.remoteStore,g.targetId))}async function Su(e,t){const n=sr(e);try{const e=await wc(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const g=n.Pu.get(t);g&&(or(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?g._u=!0:e.modifiedDocuments.size>0?or(g._u,14607):e.removedDocuments.size>0&&(or(g._u,42227),g._u=!1))})),await Hu(n,e,t)}catch(g){await jr(g)}}function Ru(e,t,n){const g=sr(e);if(g.isPrimaryClient&&0===n||!g.isPrimaryClient&&1===n){const e=[];g.uu.forEach(((n,g)=>{const r=g.view.Da(t);r.snapshot&&e.push(r.snapshot)})),function(e,t){const n=sr(e);n.onlineState=t;let g=!1;n.queries.forEach(((e,n)=>{for(const r of n.ya)r.Da(t)&&(g=!0)})),g&&au(n)}(g.eventManager,t),e.length&&g.au.j_(e),g.onlineState=t,g.isPrimaryClient&&g.sharedClientState.setOnlineState(t)}}async function vu(e,t,n){const g=sr(e);g.sharedClientState.updateQueryState(t,"rejected",n);const r=g.Pu.get(t),i=r&&r.key;if(i){let e=new Xo(Er.comparator);e=e.insert(i,Xs.newNoDocument(i,Wr.min()));const n=Fa().add(i),r=new WI(Wr.min(),new Map,new Xo(Zr),e,n);await Su(g,r),g.hu=g.hu.remove(i),g.Pu.delete(t),Eu(g)}else await Xc(g.localStore,t,!1).then((()=>Xu(g,t,n))).catch(jr)}async function Vu(e,t){const n=sr(e),g=t.batch.batchId;try{const e=await function(e,t){const n=sr(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const g=t.batch.keys(),r=n.Bs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,g){const r=n.batch,i=r.keys();let o=Pr.resolve();return i.forEach((e=>{o=o.next((()=>g.getEntry(t,e))).next((t=>{const i=n.docVersions.get(e);or(null!==i,48541),t.version.compareTo(i)<0&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),g.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,r)))}(n,e,t,r).next((()=>r.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,g,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Fa();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,g)))}))}(n.localStore,t);ku(n,g,null),Wu(n,g),n.sharedClientState.updateMutationState(g,"acknowledged"),await Hu(n,e)}catch(r){await jr(r)}}async function wu(e,t,n){const g=sr(e);try{const e=await function(e,t){const n=sr(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let g;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(or(null!==t,37113),g=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,g,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,g))).next((()=>n.localDocuments.getDocuments(e,g)))}))}(g.localStore,t);ku(g,t,n),Wu(g,t),g.sharedClientState.updateMutationState(t,"rejected",n),await Hu(g,e)}catch(r){await jr(r)}}function Wu(e,t){(e.Eu.get(t)||[]).forEach((e=>{e.resolve()})),e.Eu.delete(t)}function ku(e,t,n){const g=sr(e);let r=g.Iu[g.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),g.Iu[g.currentUser.toKey()]=r}}function Xu(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const g of e.cu.get(t))e.uu.delete(g),n&&e.au.Vu(g,n);e.cu.delete(t),e.isPrimaryClient&&e.Tu.Hr(t).forEach((t=>{e.Tu.containsKey(t)||Nu(e,t)}))}function Nu(e,t){e.lu.delete(t.path.canonicalString());const n=e.hu.get(t);null!==n&&(Bd(e.remoteStore,n),e.hu=e.hu.remove(t),e.Pu.delete(n),Eu(e))}function Ju(e,t,n){for(const g of n)g instanceof cu?(e.Tu.addReference(g.key,t),Yu(e,g)):g instanceof du?(er(Au,"Document no longer in limbo: "+g.key),e.Tu.removeReference(g.key,t),e.Tu.containsKey(g.key)||Nu(e,g.key)):rr(19791,{mu:g})}function Yu(e,t){const n=t.key,g=n.path.canonicalString();e.hu.get(n)||e.lu.has(g)||(er(Au,"New document in limbo: "+n),e.lu.add(g),Eu(e))}function Eu(e){for(;e.lu.size>0&&e.hu.size<e.maxConcurrentLimboResolutions;){const t=e.lu.values().next().value;e.lu.delete(t);const n=new Er(Nr.fromString(t)),g=e.du.next();e.Pu.set(g,new mu(n)),e.hu=e.hu.insert(n,g),Gd(e.remoteStore,new bl(ma(da(n.path)),g,"TargetPurposeLimboResolution",Ci.le))}}async function Hu(e,t,n){const g=sr(e),r=[],i=[],o=[];g.uu.isEmpty()||(g.uu.forEach(((e,s)=>{o.push(g.Ru(s,t,n).then((e=>{var t;if((e||n)&&g.isPrimaryClient){const r=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(s.targetId))||void 0===t?void 0:t.current;g.sharedClientState.updateQueryState(s.targetId,r?"current":"not-current")}if(e){r.push(e);const t=Zc.Rs(s.targetId,e);i.push(t)}})))})),await Promise.all(o),g.au.j_(r),await async function(e,t){const n=sr(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Pr.forEach(t,(t=>Pr.forEach(t.ds,(g=>n.persistence.referenceDelegate.addReference(e,t.targetId,g))).next((()=>Pr.forEach(t.As,(g=>n.persistence.referenceDelegate.removeReference(e,t.targetId,g)))))))))}catch(g){if(!gi(g))throw g;er(Bc,"Failed to update sequence numbers: "+g)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.xs.get(e),g=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(g);n.xs=n.xs.insert(e,r)}}}(g.localStore,i))}async function Fu(e,t){const n=sr(e);if(!n.currentUser.isEqual(t)){er(Au,"User change. New user:",t.toKey());const e=await vc(n.localStore,t);n.currentUser=t,r="'waitForPendingWrites' promise is rejected due to a user change.",(g=n).Eu.forEach((e=>{e.forEach((e=>{e.reject(new Ir(ar.CANCELLED,r))}))})),g.Eu.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Hu(n,e.ks)}var g,r}function xu(e,t){const n=sr(e),g=n.Pu.get(t);if(g&&g._u)return Fa().add(g.key);{let e=Fa();const g=n.cu.get(t);if(!g)return e;for(const t of g){const g=n.uu.get(t);e=e.unionWith(g.view.Ya)}return e}}async function Tu(e,t){const n=sr(e),g=await Nc(n.localStore,t.query,!0),r=t.view.su(g);return n.isPrimaryClient&&Ju(n,t.targetId,r.ru),r}async function Ku(e,t){const n=sr(e);return Yc(n.localStore,t).then((e=>Hu(n,e)))}async function Mu(e,t,n,g){const r=sr(e),i=await function(e,t){const n=sr(e),g=sr(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>g.tr(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):Pr.resolve(null)))))}(r.localStore,t);var o,s;null!==i?("pending"===n?await Hd(r.remoteStore):"acknowledged"===n||"rejected"===n?(ku(r,t,g||null),Wu(r,t),o=r.localStore,s=t,sr(sr(o).mutationQueue).sr(s)):rr(6720,"Unknown batchState",{fu:n}),await Hu(r,i)):er(Au,"Cannot apply mutation batch with id: "+t)}async function Du(e,t,n){const g=sr(e),r=[],i=[];for(const o of t){let e;const t=g.cu.get(o);if(t&&0!==t.length){e=await kc(g.localStore,ma(t[0]));for(const e of t){const t=g.uu.get(e),n=await Tu(g,t);n.snapshot&&i.push(n.snapshot)}}else{const t=await Jc(g.localStore,o);e=await kc(g.localStore,t),await fu(g,Lu(t),o,!1,e.resumeToken)}r.push(e)}return g.au.j_(i),r}function Lu(e){return ca(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Uu(e){return t=sr(e).localStore,sr(sr(t).persistence).Is();var t}async function zu(e,t,n,g){const r=sr(e);if(r.Au)return void er(Au,"Ignoring unexpected query state notification.");const i=r.cu.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{const e=await Yc(r.localStore,Ba(i[0])),g=WI.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,To.EMPTY_BYTE_STRING);await Hu(r,e,g);break}case"rejected":await Xc(r.localStore,t,!0),Xu(r,t,g);break;default:rr(64155,n)}}async function Qu(e,t,n){const g=Ou(e);if(g.Au){for(const e of t){if(g.cu.has(e)&&g.sharedClientState.isActiveQueryTarget(e)){er(Au,"Adding an already active target "+e);continue}const t=await Jc(g.localStore,e),n=await kc(g.localStore,t);await fu(g,Lu(t),n.targetId,!1,n.resumeToken),Gd(g.remoteStore,n)}for(const e of n)g.cu.has(e)&&await Xc(g.localStore,e,!1).then((()=>{Bd(g.remoteStore,e),Xu(g,e)})).catch(jr)}}function Ou(e){const t=sr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Su.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=xu.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=vu.bind(null,t),t.au.j_=ou.bind(null,t.eventManager),t.au.Vu=su.bind(null,t.eventManager),t}function ju(e){const t=sr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Vu.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=wu.bind(null,t),t}class Pu{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ld(e.databaseInfo.databaseId),this.sharedClientState=this.pu(e),this.persistence=this.yu(e),await this.persistence.start(),this.localStore=this.wu(e),this.gcScheduler=this.Su(e,this.localStore),this.indexBackfillerScheduler=this.bu(e,this.localStore)}Su(e,t){return null}bu(e,t){return null}wu(e){return Rc(this.persistence,new Gc,e.initialUser,this.serializer)}yu(e){return new sc(Ic.fi,this.serializer)}pu(e){return new Pc}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Pu.provider={build:()=>new Pu};class _u extends Pu{constructor(e){super(),this.cacheSizeBytes=e}Su(e,t){or(this.persistence.referenceDelegate instanceof lc,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new EC(n,e.asyncQueue,t)}yu(e){const t=void 0!==this.cacheSizeBytes?pC.withCacheSize(this.cacheSizeBytes):pC.DEFAULT;return new sc((e=>lc.fi(e,t)),this.serializer)}}class qu extends Pu{constructor(e,t,n){super(),this.Du=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Du.initialize(this,e),await ju(this.Du.syncEngine),await Hd(this.Du.remoteStore),await this.persistence.Ji((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}wu(e){return Rc(this.persistence,new Gc,e.initialUser,this.serializer)}Su(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new EC(n,e.asyncQueue,t)}bu(e,t){const n=new li(t,this.persistence);return new Ii(e.asyncQueue,n)}yu(e){const t=yc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?pC.withCacheSize(this.cacheSizeBytes):pC.DEFAULT;return new mc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,ad(),Id(),this.serializer,this.sharedClientState,!!this.forceOwnership)}pu(e){return new Pc}}class $u extends qu{constructor(e,t){super(e,t,!1),this.Du=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Du.syncEngine;this.sharedClientState instanceof jc&&(this.sharedClientState.syncEngine={Co:Mu.bind(null,t),Fo:zu.bind(null,t),Mo:Qu.bind(null,t),Is:Uu.bind(null,t),vo:Ku.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ji((async e=>{await async function(e,t){const n=sr(e);if(Ou(n),ju(n),!0===t&&!0!==n.Au){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Du(n,e.toArray());n.Au=!0,await Qd(n.remoteStore,!0);for(const g of t)Gd(n.remoteStore,g)}else if(!1===t&&!1!==n.Au){const e=[];let t=Promise.resolve();n.cu.forEach(((g,r)=>{n.sharedClientState.isLocalQueryTarget(r)?e.push(r):t=t.then((()=>(Xu(n,r),Xc(n.localStore,r,!0)))),Bd(n.remoteStore,r)})),await t,await Du(n,e),function(e){const t=sr(e);t.Pu.forEach(((e,n)=>{Bd(t.remoteStore,n)})),t.Tu.Jr(),t.Pu=new Map,t.hu=new Xo(Er.comparator)}(n),n.Au=!1,await Qd(n.remoteStore,!1)}}(this.Du.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}pu(e){const t=ad();if(!jc.C(t))throw new Ir(ar.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=yc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new jc(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class eA{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Ru(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Fu.bind(null,this.syncEngine),await Qd(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new nu}createDatastore(e){const t=ld(e.databaseInfo.databaseId),n=(g=e.databaseInfo,new sd(g));var g;return function(e,t,n,g){return new md(e,t,n,g)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,g=e.asyncQueue,r=e=>Ru(this.syncEngine,e,0),i=$c.C()?new $c:new _c,new yd(t,n,g,r,i);var t,n,g,r,i}createSyncEngine(e,t){return function(e,t,n,g,r,i,o){const s=new bu(e,t,n,g,r,i);return o&&(s.Au=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=sr(e);er(pd,"RemoteStore shutting down."),t.Ta.add(5),await fd(t),t.Ea.shutdown(),t.da.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}eA.provider={build:()=>new eA};
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class tA{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.vu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.vu(this.observer.error,e):tr("Uncaught Error in snapshot listener:",e.toString()))}Cu(){this.muted=!0}vu(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nA="FirestoreClient";class gA{constructor(e,t,n,g,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=g,this.user=Pg.UNAUTHENTICATED,this.clientId=yr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,(async e=>{er(nA,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(er(nA,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new lr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=_d(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function rA(e,t){e.asyncQueue.verifyOperationInProgress(),er(nA,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let g=n.initialUser;e.setCredentialChangeListener((async e=>{g.isEqual(e)||(await vc(t.localStore,e),g=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function iA(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){er(nA,"Using user provided OfflineComponentProvider");try{await rA(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!("FirebaseError"===(n=r).name?n.code===ar.FAILED_PRECONDITION||n.code===ar.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw r;nr("Error using user provided cache. Falling back to memory cache: "+r),await rA(e,new Pu)}}else er(nA,"Using default OfflineComponentProvider"),await rA(e,new _u(void 0));var n;return e._offlineComponents}(e);er(nA,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>zd(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>zd(t.remoteStore,n))),e._onlineComponents=t}async function oA(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(er(nA,"Using user provided OnlineComponentProvider"),await iA(e,e._uninitializedComponentsProvider._online)):(er(nA,"Using default OnlineComponentProvider"),await iA(e,new eA))),e._onlineComponents}async function sA(e){const t=await oA(e),n=t.eventManager;return n.onListen=pu.bind(null,t.syncEngine),n.onUnlisten=Gu.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=yu.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Bu.bind(null,t.syncEngine),n}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function aA(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}const IA=new Map;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lA(e,t,n){if(!n)throw new Ir(ar.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function CA(e){if(!Er.isDocumentKey(e))throw new Ir(ar.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function cA(e){if(Er.isDocumentKey(e))throw new Ir(ar.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function dA(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":rr(12329,{type:typeof e})}function uA(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Ir(ar.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=dA(e);throw new Ir(ar.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const AA=!0;class hA{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new Ir(ar.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=AA}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:AA;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=bC;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<NC)throw new Ir(ar.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,g){if(!0===t&&!0===g)throw new Ir(ar.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=aA(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Ir(ar.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new Ir(ar.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new Ir(ar.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class mA{constructor(e,t,n,g){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=g,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hA({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ir(ar.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Ir(ar.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hA(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new cr;switch(e.type){case"firstParty":return new Ar(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Ir(ar.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=IA.get(e);t&&(er("ComponentProvider","Removing Datastore"),IA.delete(e),t.terminate())}(this),Promise.resolve()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bA{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new bA(this.firestore,e,this._query)}}class pA{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yA(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new pA(this.firestore,e,this._key)}}class yA extends bA{constructor(e,t,n){super(e,t,da(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new pA(this.firestore,null,new Er(e))}withConverter(e){return new yA(this.firestore,e,this._path)}}function ZA(e,t,...n){if(e=an(e),lA("collection","path",t),e instanceof mA){const g=Nr.fromString(t,...n);return cA(g),new yA(e,null,g)}{if(!(e instanceof pA||e instanceof yA))throw new Ir(ar.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const g=e._path.child(Nr.fromString(t,...n));return cA(g),new yA(e.firestore,null,g)}}function fA(e,t,...n){if(e=an(e),1===arguments.length&&(t=yr.newId()),lA("doc","path",t),e instanceof mA){const g=Nr.fromString(t,...n);return CA(g),new pA(e,null,new Er(g))}{if(!(e instanceof pA||e instanceof yA))throw new Ir(ar.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const g=e._path.child(Nr.fromString(t,...n));return CA(g),new pA(e.firestore,e instanceof yA?e.converter:null,new Er(g))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GA="AsyncQueue";class BA{constructor(e=Promise.resolve()){this.zu=[],this.ju=!1,this.Hu=[],this.Ju=null,this.Yu=!1,this.Zu=!1,this.Xu=[],this.C_=new Cd(this,"async_queue_retry"),this.ec=()=>{const e=Id();e&&er(GA,"Visibility state changed to "+e.visibilityState),this.C_.p_()},this.tc=e;const t=Id();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ec)}get isShuttingDown(){return this.ju}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.nc(),this.rc(e)}enterRestrictedMode(e){if(!this.ju){this.ju=!0,this.Zu=e||!1;const t=Id();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ec)}}enqueue(e){if(this.nc(),this.ju)return new Promise((()=>{}));const t=new lr;return this.rc((()=>this.ju&&this.Zu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.zu.push(e),this.sc())))}async sc(){if(0!==this.zu.length){try{await this.zu[0](),this.zu.shift(),this.C_.reset()}catch(fp){if(!gi(fp))throw fp;er(GA,"Operation failed with retryable error: "+fp)}this.zu.length>0&&this.C_.f_((()=>this.sc()))}}rc(e){const t=this.tc.then((()=>(this.Yu=!0,e().catch((e=>{throw this.Ju=e,this.Yu=!1,tr("INTERNAL UNHANDLED ERROR: ",SA(e)),e})).then((e=>(this.Yu=!1,e))))));return this.tc=t,t}enqueueAfterDelay(e,t,n){this.nc(),this.Xu.indexOf(e)>-1&&(t=0);const g=Pd.createAndSchedule(this,e,t,n,(e=>this.oc(e)));return this.Hu.push(g),g}nc(){this.Ju&&rr(47125,{_c:SA(this.Ju)})}verifyOperationInProgress(){}async ac(){let e;do{e=this.tc,await e}while(e!==this.tc)}uc(e){for(const t of this.Hu)if(t.timerId===e)return!0;return!1}cc(e){return this.ac().then((()=>{this.Hu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Hu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.ac()}))}lc(e){this.Xu.push(e)}oc(e){const t=this.Hu.indexOf(e);this.Hu.splice(t,1)}}function SA(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class RA extends mA{constructor(e,t,n,g){super(e,t,n,g),this.type="firestore",this._queue=new BA,this._persistenceKey=(null==g?void 0:g.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new BA(e),this._firestoreClient=void 0,await e}}}function vA(e){if(e._terminated)throw new Ir(ar.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||VA(e),e._firestoreClient}function VA(e){var t,n,g;const r=e._freezeSettings(),i=(o=e._databaseId,s=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",a=e._persistenceKey,new qo(o,s,a,(I=r).host,I.ssl,I.experimentalForceLongPolling,I.experimentalAutoDetectLongPolling,aA(I.experimentalLongPollingOptions),I.useFetchStreams,I.isUsingEmulator));var o,s,a,I;e._componentsProvider||(null===(n=r.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(g=r.localCache)||void 0===g?void 0:g._onlineComponentProvider)&&(e._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),e._firestoreClient=new gA(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class wA{constructor(e){this._byteString=e}static fromBase64String(e){try{return new wA(To.fromBase64String(e))}catch(t){throw new Ir(ar.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new wA(To.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WA{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Ir(ar.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Yr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kA{constructor(e){this._methodName=e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XA{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Ir(ar.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Ir(ar.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Zr(this._lat,e._lat)||Zr(this._long,e._long)}}
/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NA{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JA=/^__.*__$/;class YA{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new cI(e,this.data,this.fieldMask,t,this.fieldTransforms):new CI(e,this.data,t,this.fieldTransforms)}}class EA{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new cI(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function HA(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw rr(40011,{hc:e})}}class FA{constructor(e,t,n,g,r,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=g,void 0===r&&this.Pc(),this.fieldTransforms=r||[],this.fieldMask=i||[]}get path(){return this.settings.path}get hc(){return this.settings.hc}Tc(e){return new FA(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ic(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),g=this.Tc({path:n,Ec:!1});return g.dc(e),g}Ac(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),g=this.Tc({path:n,Ec:!1});return g.Pc(),g}Rc(e){return this.Tc({path:void 0,Ec:!0})}Vc(e){return $A(e,this.settings.methodName,this.settings.mc||!1,this.path,this.settings.fc)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Pc(){if(this.path)for(let e=0;e<this.path.length;e++)this.dc(this.path.get(e))}dc(e){if(0===e.length)throw this.Vc("Document fields must not be empty");if(HA(this.hc)&&JA.test(e))throw this.Vc('Document fields cannot begin and end with "__"')}}class xA{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ld(e)}gc(e,t,n,g=!1){return new FA({hc:e,methodName:t,fc:n,path:Yr.emptyPath(),Ec:!1,mc:g},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function TA(e){const t=e._freezeSettings(),n=ld(e._databaseId);return new xA(e._databaseId,!!t.ignoreUndefinedProperties,n)}function KA(e,t,n,g,r,i={}){const o=e.gc(i.merge||i.mergeFields?2:0,t,n,r);jA("Data must be an object, but it was:",o,g);const s=QA(g,o);let a,I;if(i.merge)a=new Fo(o.fieldMask),I=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const g of i.mergeFields){const r=PA(t,g,n);if(!o.contains(r))throw new Ir(ar.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);eh(e,r)||e.push(r)}a=new Fo(e),I=o.fieldTransforms.filter((e=>a.covers(e.field)))}else a=null,I=o.fieldTransforms;return new YA(new Ws(s),a,I)}class MA extends kA{_toFieldTransform(e){if(2!==e.hc)throw 1===e.hc?e.Vc(`${this._methodName}() can only appear at the top level of your update data`):e.Vc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof MA}}class DA extends kA{_toFieldTransform(e){return new tI(e.path,new Qa)}isEqual(e){return e instanceof DA}}function LA(e,t,n,g){const r=e.gc(1,t,n);jA("Data must be an object, but it was:",r,g);const i=[],o=Ws.empty();Wo(g,((e,g)=>{const s=qA(t,e,n);g=an(g);const a=r.Ac(s);if(g instanceof MA)i.push(s);else{const e=zA(g,a);null!=e&&(i.push(s),o.set(s,e))}}));const s=new Fo(i);return new EA(o,s,r.fieldTransforms)}function UA(e,t,n,g,r,i){const o=e.gc(1,t,n),s=[PA(t,g,n)],a=[r];if(i.length%2!=0)throw new Ir(ar.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let c=0;c<i.length;c+=2)s.push(PA(t,i[c])),a.push(i[c+1]);const I=[],l=Ws.empty();for(let c=s.length-1;c>=0;--c)if(!eh(I,s[c])){const e=s[c];let t=a[c];t=an(t);const n=o.Ac(e);if(t instanceof MA)I.push(e);else{const g=zA(t,n);null!=g&&(I.push(e),l.set(e,g))}}const C=new Fo(I);return new EA(l,C,o.fieldTransforms)}function zA(e,t){if(OA(e=an(e)))return jA("Unsupported field value:",t,e),QA(e,t);if(e instanceof kA)return function(e,t){if(!HA(t.hc))throw t.Vc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Vc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Ec&&4!==t.hc)throw t.Vc("Nested arrays are not supported");return function(e,t){const n=[];let g=0;for(const r of e){let e=zA(r,t.Rc(g));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),g++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=an(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return function(e,t){return Ai(t)?Ma(t):Ka(e,t)}(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=wr.fromDate(e);return{timestampValue:LI(t.serializer,n)}}if(e instanceof wr){const n=new wr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:LI(t.serializer,n)}}if(e instanceof XA)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof wA)return{bytesValue:UI(t.serializer,e._byteString)};if(e instanceof pA){const n=t.databaseId,g=e.firestore._databaseId;if(!g.isEqual(n))throw t.Vc(`Document reference is for database ${g.projectId}/${g.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:OI(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof NA)return n=e,g=t,{mapValue:{fields:{[ts]:{stringValue:rs},[is]:{arrayValue:{values:n.toArray().map((e=>{if("number"!=typeof e)throw g.Vc("VectorValues must only contain numeric values.");return Ka(g.serializer,e)}))}}}}};var n,g;throw t.Vc(`Unsupported field value: ${dA(e)}`)}(e,t)}function QA(e,t){const n={};return ko(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Wo(e,((e,g)=>{const r=zA(g,t.Ic(e));null!=r&&(n[e]=r)})),{mapValue:{fields:n}}}function OA(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof wr||e instanceof XA||e instanceof wA||e instanceof pA||e instanceof kA||e instanceof NA)}function jA(e,t,n){if(!OA(n)||("object"!=typeof(g=n)||null===g||Object.getPrototypeOf(g)!==Object.prototype&&null!==Object.getPrototypeOf(g))){const g=dA(n);throw"an object"===g?t.Vc(e+" a custom object"):t.Vc(e+" "+g)}var g}function PA(e,t,n){if((t=an(t))instanceof WA)return t._internalPath;if("string"==typeof t)return qA(e,t);throw $A("Field path arguments must be of type string or ",e,!1,void 0,n)}const _A=new RegExp("[~\\*/\\[\\]]");function qA(e,t,n){if(t.search(_A)>=0)throw $A(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new WA(...t.split("."))._internalPath}catch(g){throw $A(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function $A(e,t,n,g,r){const i=g&&!g.isEmpty(),o=void 0!==r;let s=`Function ${t}() called with invalid data`;n&&(s+=" (via `toFirestore()`)"),s+=". ";let a="";return(i||o)&&(a+=" (found",i&&(a+=` in field ${g}`),o&&(a+=` in document ${r}`),a+=")"),new Ir(ar.INVALID_ARGUMENT,s+e+a)}function eh(e,t){return e.some((e=>e.isEqual(t)))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class th{constructor(e,t,n,g,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=g,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new pA(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new nh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(gh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class nh extends th{data(){return super.data()}}function gh(e,t){return"string"==typeof t?qA(e,t):t instanceof WA?t._internalPath:t._delegate._internalPath}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{}class ih extends rh{}function oh(e,t,...n){let g=[];t instanceof rh&&g.push(t),g=g.concat(n),function(e){const t=e.filter((e=>e instanceof ah)).length,n=e.filter((e=>e instanceof sh)).length;if(t>1||t>0&&n>0)throw new Ir(ar.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(g);for(const r of g)e=r._apply(e);return e}class sh extends ih{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new sh(e,t,n)}_apply(e){const t=this._parse(e);return Ah(e._query,t),new bA(e.firestore,e.converter,ba(e._query,t))}_parse(e){const t=TA(e.firestore),n=function(e,t,n,g,r,i,o){let s;if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Ir(ar.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){uh(o,i);const t=[];for(const n of o)t.push(dh(g,e,n));s={arrayValue:{values:t}}}else s=dh(g,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||uh(o,i),s=function(e,t,n,g=!1){return zA(n,e.gc(g?4:3,t))}(n,t,o,"in"===i||"not-in"===i);return xs.create(r,i,s)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class ah extends rh{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ah(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Ts.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const g=t.getFlattenedFilters();for(const r of g)Ah(n,r),n=ba(n,r)}(e._query,t),new bA(e.firestore,e.converter,ba(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Ih extends ih{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ih(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Ir(ar.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Ir(ar.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Es(t,n)}(e._query,this._field,this._direction);return new bA(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Ca(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function lh(e,t="asc"){const n=t,g=gh("orderBy",e);return Ih._create(g,n)}class Ch extends ih{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Ch(e,t,n)}_apply(e){return new bA(e.firestore,e.converter,pa(e._query,this._limit,this._limitType))}}function ch(e){return function(e,t){if(t<=0)throw new Ir(ar.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),Ch._create("limit",e,"F")}function dh(e,t,n){if("string"==typeof(n=an(n))){if(""===n)throw new Ir(ar.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Aa(t)&&-1!==n.indexOf("/"))throw new Ir(ar.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const g=t.path.child(Nr.fromString(n));if(!Er.isDocumentKey(g))throw new Ir(ar.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${g}' is not because it has an odd number of segments (${g.length}).`);return hs(e,new Er(g))}if(n instanceof pA)return hs(e,n._key);throw new Ir(ar.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${dA(n)}.`)}function uh(e,t){if(!Array.isArray(e)||0===e.length)throw new Ir(ar.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Ah(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Ir(ar.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Ir(ar.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class hh{convertValue(e,t="none"){switch(ss(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Do(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Lo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw rr(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Wo(e,((e,g)=>{n[e]=this.convertValue(g,t)})),n}convertVectorValue(e){var t,n,g;const r=null===(g=null===(n=null===(t=e.fields)||void 0===t?void 0:t[is].arrayValue)||void 0===n?void 0:n.values)||void 0===g?void 0:g.map((e=>Do(e.doubleValue)));return new NA(r)}convertGeoPoint(e){return new XA(Do(e.latitude),Do(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Po(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(_o(e));default:return null}}convertTimestamp(e){const t=Mo(e);return new wr(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Nr.fromString(e);or(ml(n),9688,{name:e});const g=new es(n.get(1),n.get(3)),r=new Er(n.popFirst(5));return g.isEqual(t)||tr(`Document ${r} contains a document reference within a different database (${g.projectId}/${g.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mh(e,t,n){let g;return g=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,g
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}class bh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ph extends th{constructor(e,t,n,g,r,i){super(e,t,n,g,i),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new yh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(gh("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class yh extends ph{data(e={}){return super.data(e)}}class Zh{constructor(e,t,n,g){this._firestore=e,this._userDataWriter=t,this._snapshot=g,this.metadata=new bh(g.hasPendingWrites,g.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new yh(this._firestore,this._userDataWriter,n.key,n,new bh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Ir(ar.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const g=new yh(e._firestore,e._userDataWriter,n.doc.key,n.doc,new bh(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:g,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const g=new yh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new bh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,i=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:fh(t.type),doc:g,oldIndex:r,newIndex:i}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function fh(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return rr(61501,{type:e})}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gh(e){e=uA(e,pA);const t=uA(e.firestore,RA);return function(e,t,n={}){const g=new lr;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,g,r){const i=new tA({next:s=>{i.Cu(),t.enqueueAndForget((()=>iu(e,o)));const a=s.docs.has(n);!a&&s.fromCache?r.reject(new Ir(ar.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&g&&"server"===g.source?r.reject(new Ir(ar.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(s)},error:e=>r.reject(e)}),o=new Cu(da(n.path),i,{includeMetadataChanges:!0,La:!0});return ru(e,o)}(await sA(e),e.asyncQueue,t,n,g))),g.promise}(vA(t),e._key).then((n=>function(e,t,n){const g=n.docs.get(t._key),r=new Bh(e);return new ph(e,r,t._key,g,new bh(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n)))}class Bh extends hh{constructor(e){super(),this.firestore=e}convertBytes(e){return new wA(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new pA(this.firestore,null,t)}}function Sh(e){e=uA(e,bA);const t=uA(e.firestore,RA),n=vA(t),g=new Bh(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Ir(ar.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),function(e,t,n={}){const g=new lr;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,g,r){const i=new tA({next:n=>{i.Cu(),t.enqueueAndForget((()=>iu(e,o))),n.fromCache&&"server"===g.source?r.reject(new Ir(ar.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:e=>r.reject(e)}),o=new Cu(n,i,{includeMetadataChanges:!0,La:!0});return ru(e,o)}(await sA(e),e.asyncQueue,t,n,g))),g.promise}(n,e._query).then((n=>new Zh(t,g,e,n)))}function Rh(e,t,n,...g){e=uA(e,pA);const r=uA(e.firestore,RA),i=TA(r);let o;return o="string"==typeof(t=an(t))||t instanceof WA?UA(i,"updateDoc",e._key,t,n,g):LA(i,"updateDoc",e._key,t),vh(r,[o.toMutation(e._key,gI.exists(!0))])}function vh(e,t){return function(e,t){const n=new lr;return e.asyncQueue.enqueueAndForget((async()=>async function(t,n,g){const r=ju(t);try{const e=await function(e,t){const n=sr(e),g=wr.now(),r=t.reduce(((e,t)=>e.add(t.key)),Fa());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let s=wa(),a=Fa();return n.Bs.getEntries(e,r).next((e=>{s=e,s.forEach(((e,t)=>{t.isValidDocument()||(a=a.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,s))).next((r=>{i=r;const o=[];for(const e of t){const t=II(e,i.get(e.key).overlayedDocument);null!=t&&o.push(new cI(e.key,t,ks(t.value.mapValue),gI.exists(!0)))}return n.mutationQueue.addMutationBatch(e,g,o,t)})).next((t=>{o=t;const g=t.applyToLocalDocumentSet(i,a);return n.documentOverlayCache.saveOverlays(e,t.batchId,g)}))})).then((()=>({batchId:o.batchId,changes:Xa(i)})))}(r.localStore,n);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let g=e.Iu[e.currentUser.toKey()];g||(g=new Xo(Zr)),g=g.insert(t,n),e.Iu[e.currentUser.toKey()]=g}(r,e.batchId,g),await Hu(r,e.changes),await Hd(r.remoteStore)}catch(e){const n=_d(e,"Failed to persist write");g.reject(n)}}(await function(e){return oA(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(vA(e),t)}class Vh{constructor(e){let t;this.kind="persistent",(null==e?void 0:e.tabManager)?(e.tabManager._initialize(e),t=e.tabManager):(t=new wh(void 0),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class wh{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=eA.provider,this._offlineComponentProvider={build:t=>new qu(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class Wh{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=eA.provider,this._offlineComponentProvider={build:t=>new $u(t,null==e?void 0:e.cacheSizeBytes)}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class kh{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=TA(e)}set(e,t,n){this._verifyNotCommitted();const g=Xh(e,this._firestore),r=mh(g.converter,t,n),i=KA(this._dataReader,"WriteBatch.set",g._key,r,null!==g.converter,n);return this._mutations.push(i.toMutation(g._key,gI.none())),this}update(e,t,n,...g){this._verifyNotCommitted();const r=Xh(e,this._firestore);let i;return i="string"==typeof(t=an(t))||t instanceof WA?UA(this._dataReader,"WriteBatch.update",r._key,t,n,g):LA(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(i.toMutation(r._key,gI.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Xh(e,this._firestore);return this._mutations=this._mutations.concat(new hI(t._key,gI.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Ir(ar.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Xh(e,t){if((e=an(e)).firestore!==t)throw new Ir(ar.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function Nh(){return new DA("serverTimestamp")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jh(e){return vA(e=uA(e,RA)),new kh(e,(t=>vh(e,t)))}function Yh(e,t){var n={};for(var g in e)Object.prototype.hasOwnProperty.call(e,g)&&t.indexOf(g)<0&&(n[g]=e[g]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(g=Object.getOwnPropertySymbols(e);r<g.length;r++)t.indexOf(g[r])<0&&Object.prototype.propertyIsEnumerable.call(e,g[r])&&(n[g[r]]=e[g[r]])}return n}function Eh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}!function(e,t=!0){_g=Gg,bg(new In("firestore",((e,{instanceIdentifier:n,options:g})=>{const r=e.getProvider("app").getImmediate(),i=new RA(new dr(e.getProvider("auth-internal")),new mr(r,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Ir(ar.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new es(e.options.projectId,t)}(r,n),r);return g=Object.assign({useFetchStreams:t},g),i._setSettings(g),i}),"PUBLIC").setMultipleInstances(!0)),Sg(Og,jg,e),Sg(Og,jg,"esm2017")}(),"function"==typeof SuppressedError&&SuppressedError;const Hh=Eh,Fh=new en("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),xh=new pn("@firebase/auth");function Th(e,...t){xh.logLevel<=dn.ERROR&&xh.error(`Auth (${Gg}): ${e}`,...t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kh(e,...t){throw Uh(e,...t)}function Mh(e,...t){return Uh(e,...t)}function Dh(e,t,n){const g=Object.assign(Object.assign({},Hh()),{[t]:n});return new en("auth","Firebase",g).create(t,{appName:e.name})}function Lh(e){return Dh(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Uh(e,...t){if("string"!=typeof e){const n=t[0],g=[...t.slice(1)];return g[0]&&(g[0].appName=e.name),e._errorFactory.create(n,...g)}return Fh.create(e,...t)}function zh(e,t,...n){if(!e)throw Uh(t,...n)}function Qh(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Th(t),new Error(t)}function Oh(e,t){e||Qh(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jh(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Ph(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _h(){return"undefined"==typeof navigator||!navigator||!("onLine"in navigator)||"boolean"!=typeof navigator.onLine||"http:"!==Ph()&&"https:"!==Ph()&&!function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()&&!("connection"in navigator)||navigator.onLine}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class qh{constructor(e,t){this.shortDelay=e,this.longDelay=t,Oh(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ot())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return _h()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $h(e,t){Oh(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class em{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Qh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Qh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Qh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},nm=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],gm=new qh(3e4,6e4);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rm(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function im(e,t,n,g,r={}){return om(e,r,(async()=>{let r={},i={};g&&("GET"===t?i=g:r={body:JSON.stringify(g)});const o=rn(Object.assign({key:e.config.apiKey},i)).slice(1),s=await e._getAdditionalHeaders();s["Content-Type"]="application/json",e.languageCode&&(s["X-Firebase-Locale"]=e.languageCode);const a=Object.assign({method:t,headers:s},r);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(a.referrerPolicy="no-referrer"),e.emulatorConfig&&Dt(e.emulatorConfig.host)&&(a.credentials="include"),em.fetch()(await sm(e,e.config.apiHost,n,o),a)}))}async function om(e,t,n){e._canInitEmulator=!1;const g=Object.assign(Object.assign({},tm),t);try{const t=new am(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await r.json();if("needConfirmation"in i)throw Im(e,"account-exists-with-different-credential",i);if(r.ok&&!("errorMessage"in i))return i;{const t=r.ok?i.errorMessage:i.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Im(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw Im(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw Im(e,"user-disabled",i);const s=g[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Dh(e,s,o);Kh(e,s)}}catch(fp){if(fp instanceof $t)throw fp;Kh(e,"network-request-failed",{message:String(fp)})}}async function sm(e,t,n,g){const r=`${t}${n}?${g}`,i=e,o=i.config.emulator?$h(e.config,r):`${e.config.apiScheme}://${r}`;if(nm.includes(n)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())){return i._getPersistence()._getFinalTarget(o).toString()}return o}class am{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Mh(this.auth,"network-request-failed"))),gm.get())}))}}function Im(e,t,n){const g={appName:e.name};n.email&&(g.email=n.email),n.phoneNumber&&(g.phoneNumber=n.phoneNumber);const r=Mh(e,t,g);return r.customData._tokenResponse=n,r}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lm(e,t){return im(e,"POST","/v1/accounts:lookup",t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cm(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(fp){}}function cm(e){return 1e3*Number(e)}function dm(e){const[t,n,g]=e.split(".");if(void 0===t||void 0===n||void 0===g)return Th("JWT malformed, contained fewer than 3 sections"),null;try{const e=Ht(n);return e?JSON.parse(e):(Th("Failed to decode base64 JWT payload"),null)}catch(fp){return Th("Caught error parsing JWT payload as JSON",null==fp?void 0:fp.toString()),null}}function um(e){const t=dm(e);return zh(t,"internal-error"),zh(void 0!==t.exp,"internal-error"),zh(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Am(e,t,n=!1){if(n)return t;try{return await t}catch(fp){throw fp instanceof $t&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(fp)&&e.auth.currentUser===e&&await e.auth.signOut(),fp}}class hm{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(fp){return void("auth/network-request-failed"===(null==fp?void 0:fp.code)&&this.schedule(!0))}this.schedule()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mm{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Cm(this.lastLoginAt),this.creationTime=Cm(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bm(e){var t;const n=e.auth,g=await e.getIdToken(),r=await Am(e,lm(n,{idToken:g}));zh(null==r?void 0:r.users.length,n,"internal-error");const i=r.users[0];e._notifyReloadListener(i);const o=(null===(t=i.providerUserInfo)||void 0===t?void 0:t.length)?pm(i.providerUserInfo):[],s=(a=e.providerData,I=o,[...a.filter((e=>!I.some((t=>t.providerId===e.providerId)))),...I]);var a,I;const l=e.isAnonymous,C=!(e.email&&i.passwordHash||(null==s?void 0:s.length)),c=!!l&&C,d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new mm(i.createdAt,i.lastLoginAt),isAnonymous:c};Object.assign(e,d)}function pm(e){return e.map((e=>{var{providerId:t}=e,n=Yh(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ym{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){zh(e.idToken,"internal-error"),zh(void 0!==e.idToken,"internal-error"),zh(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):um(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){zh(0!==e.length,"internal-error");const t=um(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(zh(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:g,expiresIn:r}=await async function(e,t){const n=await om(e,{},(async()=>{const n=rn({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:g,apiKey:r}=e.config,i=await sm(e,g,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",em.fetch()(i,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,g,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:g,expirationTime:r}=t,i=new ym;return n&&(zh("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),g&&(zh("string"==typeof g,"internal-error",{appName:e}),i.accessToken=g),r&&(zh("number"==typeof r,"internal-error",{appName:e}),i.expirationTime=r),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ym,this.toJSON())}_performRefresh(){return Qh("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zm(e,t){zh("string"==typeof e||void 0===e,"internal-error",{appName:t})}class fm{constructor(e){var{uid:t,auth:n,stsTokenManager:g}=e,r=Yh(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new hm(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=g,this.accessToken=g.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new mm(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Am(this,this.stsTokenManager.getToken(this.auth,e));return zh(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=an(e),g=await n.getIdToken(t),r=dm(g);zh(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const i="object"==typeof r.firebase?r.firebase:void 0,o=null==i?void 0:i.sign_in_provider;return{claims:r,token:g,authTime:Cm(cm(r.auth_time)),issuedAtTime:Cm(cm(r.iat)),expirationTime:Cm(cm(r.exp)),signInProvider:o||null,signInSecondFactor:(null==i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=an(e);await bm(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(zh(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new fm(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){zh(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await bm(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(yg(this.auth.app))return Promise.reject(Lh(this.auth));const e=await this.getIdToken();return await Am(this,async function(e,t){return im(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,g,r,i,o,s,a,I;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,C=null!==(g=t.email)&&void 0!==g?g:void 0,c=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,d=null!==(i=t.photoURL)&&void 0!==i?i:void 0,u=null!==(o=t.tenantId)&&void 0!==o?o:void 0,A=null!==(s=t._redirectEventId)&&void 0!==s?s:void 0,h=null!==(a=t.createdAt)&&void 0!==a?a:void 0,m=null!==(I=t.lastLoginAt)&&void 0!==I?I:void 0,{uid:b,emailVerified:p,isAnonymous:y,providerData:Z,stsTokenManager:f}=t;zh(b&&f,e,"internal-error");const G=ym.fromJSON(this.name,f);zh("string"==typeof b,e,"internal-error"),Zm(l,e.name),Zm(C,e.name),zh("boolean"==typeof p,e,"internal-error"),zh("boolean"==typeof y,e,"internal-error"),Zm(c,e.name),Zm(d,e.name),Zm(u,e.name),Zm(A,e.name),Zm(h,e.name),Zm(m,e.name);const B=new fm({uid:b,auth:e,email:C,emailVerified:p,displayName:l,isAnonymous:y,photoURL:d,phoneNumber:c,tenantId:u,stsTokenManager:G,createdAt:h,lastLoginAt:m});return Z&&Array.isArray(Z)&&(B.providerData=Z.map((e=>Object.assign({},e)))),A&&(B._redirectEventId=A),B}static async _fromIdTokenResponse(e,t,n=!1){const g=new ym;g.updateFromServerResponse(t);const r=new fm({uid:t.localId,auth:e,stsTokenManager:g,isAnonymous:n});return await bm(r),r}static async _fromGetAccountInfoResponse(e,t,n){const g=t.users[0];zh(void 0!==g.localId,"internal-error");const r=void 0!==g.providerUserInfo?pm(g.providerUserInfo):[],i=!(g.email&&g.passwordHash||(null==r?void 0:r.length)),o=new ym;o.updateFromIdToken(n);const s=new fm({uid:g.localId,auth:e,stsTokenManager:o,isAnonymous:i}),a={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:r,metadata:new mm(g.createdAt,g.lastLoginAt),isAnonymous:!(g.email&&g.passwordHash||(null==r?void 0:r.length))};return Object.assign(s,a),s}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gm=new Map;function Bm(e){Oh(e instanceof Function,"Expected a class definition");let t=Gm.get(e);return t?(Oh(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Gm.set(e,t),t)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sm{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Sm.type="NONE";const Rm=Sm;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vm(e,t,n){return`firebase:${e}:${t}:${n}`}class Vm{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:g,name:r}=this.auth;this.fullUserKey=vm(this.userKey,g.apiKey,r),this.fullPersistenceKey=vm("persistence",g.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await lm(this.auth,{idToken:e}).catch((()=>{}));return t?fm._fromGetAccountInfoResponse(this.auth,t,e):null}return fm._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Vm(Bm(Rm),e,n);const g=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let r=g[0]||Bm(Rm);const i=vm(n,e.config.apiKey,e.name);let o=null;for(const I of t)try{const t=await I._get(i);if(t){let n;if("string"==typeof t){const g=await lm(e,{idToken:t}).catch((()=>{}));if(!g)break;n=await fm._fromGetAccountInfoResponse(e,g,t)}else n=fm._fromJSON(e,t);I!==r&&(o=n),r=I;break}}catch(a){}const s=g.filter((e=>e._shouldAllowMigration));return r._shouldAllowMigration&&s.length?(r=s[0],o&&await r._set(i,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==r)try{await e._remove(i)}catch(a){}}))),new Vm(r,e,n)):new Vm(r,e,n)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wm(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Nm(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Wm(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ym(t))return"Blackberry";if(Em(t))return"Webos";if(km(t))return"Safari";if((t.includes("chrome/")||Xm(t))&&!t.includes("edge/"))return"Chrome";if(Jm(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Wm(e=Ot()){return/firefox\//i.test(e)}function km(e=Ot()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Xm(e=Ot()){return/crios\//i.test(e)}function Nm(e=Ot()){return/iemobile/i.test(e)}function Jm(e=Ot()){return/android/i.test(e)}function Ym(e=Ot()){return/blackberry/i.test(e)}function Em(e=Ot()){return/webos/i.test(e)}function Hm(e=Ot()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Fm(){return function(){const e=Ot();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function xm(e=Ot()){return Hm(e)||Jm(e)||Em(e)||Ym(e)||/windows phone/i.test(e)||Nm(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tm(e,t=[]){let n;switch(e){case"Browser":n=wm(Ot());break;case"Worker":n=`${wm(Ot())}-${e}`;break;default:n=e}const g=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Gg}/${g}`}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,g)=>{try{n(e(t))}catch(fp){g(fp)}}));n.onAbort=t,this.queue.push(n);const g=this.queue.length-1;return()=>{this.queue[g]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(fp){t.reverse();for(const g of t)try{g()}catch(n){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==fp?void 0:fp.message})}}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mm{constructor(e){var t,n,g,r;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(g=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==g?g:"",this.forceUpgradeOnSignin=null!==(r=e.forceUpgradeOnSignin)&&void 0!==r&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,g,r,i,o;const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,s),this.validatePasswordCharacterOptions(e,s),s.isValid&&(s.isValid=null===(t=s.meetsMinPasswordLength)||void 0===t||t),s.isValid&&(s.isValid=null===(n=s.meetsMaxPasswordLength)||void 0===n||n),s.isValid&&(s.isValid=null===(g=s.containsLowercaseLetter)||void 0===g||g),s.isValid&&(s.isValid=null===(r=s.containsUppercaseLetter)||void 0===r||r),s.isValid&&(s.isValid=null===(i=s.containsNumericCharacter)||void 0===i||i),s.isValid&&(s.isValid=null===(o=s.containsNonAlphanumericCharacter)||void 0===o||o),s}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,g=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),g&&(t.meetsMaxPasswordLength=e.length<=g)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let g=0;g<e.length;g++)n=e.charAt(g),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,g,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=g)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dm{constructor(e,t,n,g){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=g,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Um(this),this.idTokenSubscription=new Um(this),this.beforeStateQueue=new Km(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Fh,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=g.sdkClientVersion,this._persistenceManagerAvailable=new Promise((e=>this._resolvePersistenceManagerAvailable=e))}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Bm(t)),this._initializationPromise=this.queue((async()=>{var n,g,r;if(!this._deleted&&(this.persistenceManager=await Vm.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null===(g=this._popupRedirectResolver)||void 0===g?void 0:g._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(fp){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e,!0)):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await lm(this,{idToken:e}),n=await fm._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(yg(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let g=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null==g?void 0:g._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==i||!(null==o?void 0:o.user)||(g=o.user,r=!0)}if(!g)return this.directlySetCurrentUser(null);if(!g._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(g)}catch(fp){g=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(fp)))}return g?this.reloadAndSetCurrentUserOrClear(g):this.directlySetCurrentUser(null)}return zh(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===g._redirectEventId?this.directlySetCurrentUser(g):this.reloadAndSetCurrentUserOrClear(g)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(fp){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await bm(e)}catch(fp){if("auth/network-request-failed"!==(null==fp?void 0:fp.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(yg(this.app))return Promise.reject(Lh(this));const t=e?an(e):null;return t&&zh(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&zh(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return yg(this.app)?Promise.reject(Lh(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return yg(this.app)?Promise.reject(Lh(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Bm(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return im(e,"GET","/v2/passwordPolicy",rm(e,t))}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this),t=new Mm(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new en("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return im(e,"POST","/v2/accounts:revokeToken",rm(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Bm(e)||this._popupRedirectResolver;zh(t,this,"argument-error"),this.redirectPersistenceManager=await Vm.create(this,[Bm(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,g){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(zh(o,this,"internal-error"),o.then((()=>{i||r(this.currentUser)})),"function"==typeof t){const r=e.addObserver(t,n,g);return()=>{i=!0,r()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return zh(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Tm(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const g=await this._getAppCheckToken();return g&&(t["X-Firebase-AppCheck"]=g),t}async _getAppCheckToken(){var e;if(yg(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){xh.logLevel<=dn.WARN&&xh.warn(`Auth (${Gg}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Lm(e){return an(e)}class Um{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new on(e,t);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return zh(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zm={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Qm(e,t,n){const g=Lm(e);zh(/^https?:\/\//.test(t),g,"invalid-emulator-scheme");const r=Om(t),{host:i,port:o}=function(e){const t=Om(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const g=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(g);if(r){const e=r[1];return{host:e,port:jm(g.substr(e.length+1))}}{const[e,t]=g.split(":");return{host:e,port:jm(t)}}}(t),s=null===o?"":`:${o}`,a={url:`${r}//${i}${s}/`},I=Object.freeze({host:i,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!g._canInitEmulator)return zh(g.config.emulator&&g.emulatorConfig,g,"emulator-config-failed"),void zh(nn(a,g.config.emulator)&&nn(I,g.emulatorConfig),g,"emulator-config-failed");g.config.emulator=a,g.emulatorConfig=I,g.settings.appVerificationDisabledForTesting=!0,Dt(i)?(Lt(`${r}//${i}${s}`),Qt("Auth",!0)):function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&console.info;"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */()}function Om(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function jm(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Pm{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Qh("not implemented")}_getIdTokenResponse(e){return Qh("not implemented")}_linkToIdToken(e,t){return Qh("not implemented")}_getReauthenticationResolver(e){return Qh("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _m(e,t){return async function(e,t,n,g,r={}){const i=await im(e,t,n,g,r);return"mfaPendingCredential"in i&&Kh(e,"multi-factor-auth-required",{_serverResponse:i}),i}(e,"POST","/v1/accounts:signInWithIdp",rm(e,t))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm extends Pm{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new qm(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Kh("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:g}=t,r=Yh(t,["providerId","signInMethod"]);if(!n||!g)return null;const i=new qm(n,g);return i.idToken=r.idToken||void 0,i.accessToken=r.accessToken||void 0,i.secret=r.secret,i.nonce=r.nonce,i.pendingToken=r.pendingToken||null,i}_getIdTokenResponse(e){return _m(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,_m(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_m(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=rn(t)}return e}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eb extends $m{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb extends eb{constructor(){super("facebook.com")}static credential(e){return qm._fromParams({providerId:tb.PROVIDER_ID,signInMethod:tb.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tb.credentialFromTaggedObject(e)}static credentialFromError(e){return tb.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return tb.credential(e.oauthAccessToken)}catch(t){return null}}}tb.FACEBOOK_SIGN_IN_METHOD="facebook.com",tb.PROVIDER_ID="facebook.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class nb extends eb{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return qm._fromParams({providerId:nb.PROVIDER_ID,signInMethod:nb.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return nb.credentialFromTaggedObject(e)}static credentialFromError(e){return nb.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return nb.credential(t,n)}catch(g){return null}}}nb.GOOGLE_SIGN_IN_METHOD="google.com",nb.PROVIDER_ID="google.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class gb extends eb{constructor(){super("github.com")}static credential(e){return qm._fromParams({providerId:gb.PROVIDER_ID,signInMethod:gb.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gb.credentialFromTaggedObject(e)}static credentialFromError(e){return gb.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return gb.credential(e.oauthAccessToken)}catch(t){return null}}}gb.GITHUB_SIGN_IN_METHOD="github.com",gb.PROVIDER_ID="github.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class rb extends eb{constructor(){super("twitter.com")}static credential(e,t){return qm._fromParams({providerId:rb.PROVIDER_ID,signInMethod:rb.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rb.credentialFromTaggedObject(e)}static credentialFromError(e){return rb.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return rb.credential(t,n)}catch(g){return null}}}rb.TWITTER_SIGN_IN_METHOD="twitter.com",rb.PROVIDER_ID="twitter.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ib{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,g=!1){const r=await fm._fromIdTokenResponse(e,n,g),i=ob(n);return new ib({user:r,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const g=ob(n);return new ib({user:e,providerId:g,_tokenResponse:n,operationType:t})}}function ob(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sb extends $t{constructor(e,t,n,g){var r;super(t.code,t.message),this.operationType=n,this.user=g,Object.setPrototypeOf(this,sb.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,g){return new sb(e,t,n,g)}}function ab(e,t,n,g){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw sb._fromErrorAndOperation(e,n,t,g);throw n}))}const Ib="__sak";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ib,"1"),this.storage.removeItem(Ib),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cb extends lb{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=xm(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),g=this.localCache[t];n!==g&&e(t,g,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const g=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);Fm()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(g,10):g()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const g of Array.from(n))g(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Cb.type="LOCAL";const cb=Cb;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class db extends lb{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}db.type="SESSION";const ub=db;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ab{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Ab(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:g,data:r}=t.data,i=this.handlersMap[g];if(!(null==i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:g});const o=Array.from(i).map((async e=>e(t.origin,r))),s=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:g,response:s})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function hb(e="",t=10){let n="";for(let g=0;g<t;g++)n+=Math.floor(10*Math.random());return e+n}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ab.receivers=[];class mb{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const g="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!g)throw new Error("connection_unavailable");let r,i;return new Promise(((o,s)=>{const a=hb("",20);g.port1.start();const I=setTimeout((()=>{s(new Error("unsupported_event"))}),n);i={messageChannel:g,onMessage(e){const t=e;if(t.data.eventId===a)switch(t.data.status){case"ack":clearTimeout(I),r=setTimeout((()=>{s(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),o(t.data.response);break;default:clearTimeout(I),clearTimeout(r),s(new Error("invalid_response"))}}},this.handlers.add(i),g.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:a,data:t},[g.port2])})).finally((()=>{i&&this.removeMessageHandler(i)}))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bb(){return window}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function pb(){return void 0!==bb().WorkerGlobalScope&&"function"==typeof bb().importScripts}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const yb="firebaseLocalStorageDb",Zb="firebaseLocalStorage",fb="fbase_key";class Gb{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Bb(e,t){return e.transaction([Zb],t?"readwrite":"readonly").objectStore(Zb)}function Sb(){const e=indexedDB.open(yb,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Zb,{keyPath:fb})}catch(fp){n(fp)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Zb)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(yb);return new Gb(e).toPromise()}(),t(await Sb()))}))}))}async function Rb(e,t,n){const g=Bb(e,!0).put({[fb]:t,value:n});return new Gb(g).toPromise()}function vb(e,t){const n=Bb(e,!0).delete(t);return new Gb(n).toPromise()}class Vb{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Sb()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(fp){if(t++>3)throw fp;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return pb()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ab._getInstance(pb()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new mb(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Sb();return await Rb(e,Ib,"1"),await vb(e,Ib),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Rb(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Bb(e,!1).get(t),g=await new Gb(n).toPromise();return void 0===g?null:g.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>vb(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Bb(e,!1).getAll();return new Gb(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:g,value:r}of e)n.add(g),JSON.stringify(this.localCache[g])!==JSON.stringify(r)&&(this.notifyListeners(g,r),t.push(g));for(const g of Object.keys(this.localCache))this.localCache[g]&&!n.has(g)&&(this.notifyListeners(g,null),t.push(g));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const g of Array.from(n))g(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Vb.type="LOCAL";const wb=Vb;new qh(3e4,6e4);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Wb extends Pm{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _m(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _m(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _m(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function kb(e){
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
return async function(e,t,n=!1){if(yg(e.app))return Promise.reject(Lh(e));const g="signIn",r=await ab(e,g,t),i=await ib._fromIdTokenResponse(e,g,r);return n||await e._updateCurrentUser(i.user),i}(e.auth,new Wb(e),e.bypassAuthState)}function Xb(e){const{auth:t,user:n}=e;return zh(n,t,"internal-error"),
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(e,t,n=!1){const{auth:g}=e;if(yg(g.app))return Promise.reject(Lh(g));const r="reauthenticate";try{const i=await Am(e,ab(g,r,t,e),n);zh(i.idToken,g,"internal-error");const o=dm(i.idToken);zh(o,g,"internal-error");const{sub:s}=o;return zh(e.uid===s,g,"user-mismatch"),ib._forOperation(e,r,i)}catch(fp){throw"auth/user-not-found"===(null==fp?void 0:fp.code)&&Kh(g,"user-mismatch"),fp}}(n,new Wb(e),e.bypassAuthState)}async function Nb(e){const{auth:t,user:n}=e;return zh(n,t,"internal-error"),async function(e,t,n=!1){const g=await Am(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ib._forOperation(e,"link",g)}(n,new Wb(e),e.bypassAuthState)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jb{constructor(e,t,n,g,r=!1){this.auth=e,this.resolver=n,this.user=g,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(fp){this.reject(fp)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:g,tenantId:r,error:i,type:o}=e;if(i)return void this.reject(i);const s={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:g||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(s))}catch(fp){this.reject(fp)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return kb;case"linkViaPopup":case"linkViaRedirect":return Nb;case"reauthViaPopup":case"reauthViaRedirect":return Xb;default:Kh(this.auth,"internal-error")}}resolve(e){Oh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Oh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yb=new qh(2e3,1e4);class Eb extends Jb{constructor(e,t,n,g,r){super(e,t,g,r),this.provider=n,this.authWindow=null,this.pollId=null,Eb.currentPopupAction&&Eb.currentPopupAction.cancel(),Eb.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return zh(e,this.auth,"internal-error"),e}async onExecution(){Oh(1===this.filter.length,"Popup operations only handle one event");const e=hb();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Mh(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Mh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Eb.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Mh(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Yb.get())};e()}}Eb.currentPopupAction=null;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Hb="pendingRedirect",Fb=new Map;class xb extends Jb{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Fb.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return vm(Hb,e.config.apiKey,e.name)}(t),g=function(e){return Bm(e._redirectPersistence)}(e);if(!(await g._isAvailable()))return!1;const r="true"===await g._get(n);return await g._remove(n),r}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(fp){e=()=>Promise.reject(fp)}Fb.set(this.auth._key(),e)}return this.bypassAuthState||Fb.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Tb(e,t){Fb.set(e._key(),t)}async function Kb(e,t,n=!1){if(yg(e.app))return Promise.reject(Lh(e));const g=Lm(e),r=
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e,t){return t?Bm(t):(zh(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(g,t),i=new xb(g,r,n),o=await i.execute();return o&&!n&&(delete o.user._redirectEventId,await g._persistUserIfCurrent(o.user),await g._setRedirectUser(null,t)),o}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mb{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Lb(e);default:return!1}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Lb(e)){const g=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Mh(this.auth,g))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Db(e))}saveEventToCache(e){this.cachedEventUids.add(Db(e)),this.lastProcessedEventTime=Date.now()}}function Db(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Lb({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ub=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,zb=/^https?/;async function Qb(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return im(e,"GET","/v1/projects",t)}(e);for(const g of t)try{if(Ob(g))return}catch(n){}Kh(e,"unauthorized-domain")}function Ob(e){const t=jh(),{protocol:n,hostname:g}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===g?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===g}if(!zb.test(n))return!1;if(Ub.test(e))return g===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(g)}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jb=new qh(3e4,6e4);function Pb(){const e=bb().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function _b(e){return new Promise(((t,n)=>{var g,r,i,o;function s(){Pb(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Pb(),n(Mh(e,"network-request-failed"))},timeout:jb.get()})}if(null===(r=null===(g=bb().gapi)||void 0===g?void 0:g.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null===(i=bb().gapi)||void 0===i?void 0:i.load)){const t=`__${"iframefcb"}${Math.floor(1e6*Math.random())}`;return bb()[t]=()=>{gapi.load?s():n(Mh(e,"network-request-failed"))},(o=`${zm.gapiScript}?onload=${t}`,zm.loadJS(o)).catch((e=>n(e)))}s()}})).catch((e=>{throw qb=null,e}))}let qb=null;
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const $b=new qh(5e3,15e3),ep={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},tp=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function np(e){const t=e.config;zh(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?$h(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,g={apiKey:t.apiKey,appName:e.name,v:Gg},r=tp.get(e.config.apiHost);r&&(g.eid=r);const i=e._getFrameworks();return i.length&&(g.fw=i.join(",")),`${n}?${rn(g).slice(1)}`}async function gp(e){const t=await function(e){return qb=qb||_b(e),qb}(e),n=bb().gapi;return zh(n,e,"internal-error"),t.open({where:document.body,url:np(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ep,dontclear:!0},(t=>new Promise((async(n,g)=>{await t.restyle({setHideOnLeave:!1});const r=Mh(e,"network-request-failed"),i=bb().setTimeout((()=>{g(r)}),$b.get());function o(){bb().clearTimeout(i),n(t)}t.ping(o).then(o,(()=>{g(r)}))}))))}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rp={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ip{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(fp){}}}function op(e,t,n,g=500,r=600){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-g)/2,0).toString();let s="";const a=Object.assign(Object.assign({},rp),{width:g.toString(),height:r.toString(),top:i,left:o}),I=Ot().toLowerCase();n&&(s=Xm(I)?"_blank":n),Wm(I)&&(t=t||"http://localhost",a.scrollbars="yes");const l=Object.entries(a).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=Ot()){var t;return Hm(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(I)&&"_self"!==s)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const g=document.createEvent("MouseEvent");g.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(g)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t||"",s),new ip(null);const C=window.open(t||"",s,l);zh(C,e,"popup-blocked");try{C.focus()}catch(fp){}return new ip(C)}const sp="__/auth/handler",ap="emulator/auth/handler",Ip=encodeURIComponent("fac");async function lp(e,t,n,g,r,i){zh(e.config.authDomain,e,"auth-domain-config-required"),zh(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:g,v:Gg,eventId:r};if(t instanceof $m){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))o[e]=t}if(t instanceof eb){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const s=o;for(const l of Object.keys(s))void 0===s[l]&&delete s[l];const a=await e._getAppCheckToken(),I=a?`#${Ip}=${encodeURIComponent(a)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${sp}`;return $h(e,ap)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e)}?${rn(s).slice(1)}${I}`}const Cp="webStorageSupport";const cp=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ub,this._completeRedirectFn=Kb,this._overrideRedirectResult=Tb}async _openPopup(e,t,n,g){var r;Oh(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()");return op(e,await lp(e,t,n,jh(),g),hb())}async _openRedirect(e,t,n,g){await this._originValidation(e);return function(e){bb().location.href=e}(await lp(e,t,n,jh(),g)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Oh(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await gp(e),n=new Mb(e);return t.register("authEvent",(t=>{zh(null==t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Cp,{type:Cp},(n=>{var g;const r=null===(g=null==n?void 0:n[0])||void 0===g?void 0:g[Cp];void 0!==r&&t(!!r),Kh(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Qb(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return xm()||km()||Hm()}};var dp="@firebase/auth",up="1.10.6";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ap{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){zh(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const hp=Kt("authIdTokenMaxAge")||300;let mp=null;var bp,pp;bp={loadJS:e=>new Promise(((t,n)=>{const g=document.createElement("script");var r,i;g.setAttribute("src",e),g.onload=t,g.onerror=e=>{const t=Mh("internal-error");t.customData=e,n(t)},g.type="text/javascript",g.charset="UTF-8",(null!==(i=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==i?i:document).appendChild(g)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},zm=bp,pp="Browser",bg(new In("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),g=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:i,authDomain:o}=n.options;zh(i&&!i.includes(":"),"invalid-api-key",{appName:n.name});const s={apiKey:i,authDomain:o,clientPlatform:pp,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Tm(pp)},a=new Dm(n,g,r,s);return function(e,t){const n=(null==t?void 0:t.persistence)||[],g=(Array.isArray(n)?n:[n]).map(Bm);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(g,null==t?void 0:t.popupRedirectResolver)}(a,t),a}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),bg(new In("auth-internal",(e=>{const t=Lm(e.getProvider("auth").getImmediate());return new Ap(t)}),"PRIVATE").setInstantiationMode("EXPLICIT")),Sg(dp,up,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(pp)),Sg(dp,up,"esm2017");const yp=Bg({apiKey:"AIzaSyAJyHbhXTGWN8Frfnrkfh1yiAnNQuKb2Lg",authDomain:"mariage-a3309.firebaseapp.com",projectId:"mariage-a3309",storageBucket:"mariage-a3309.appspot.com",messagingSenderId:"851249523629",appId:"1:851249523629:web:0c73d232fbd2f2210a0f24",measurementId:"G-RJMFSEY5MB"}),Zp=function(e,t,n){n||(n=$o);const g=pg(e,"firestore");if(g.isInitialized(n)){const e=g.getImmediate({identifier:n});if(nn(g.getOptions(n),t))return e;throw new Ir(ar.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&void 0!==t.localCache)throw new Ir(ar.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<NC)throw new Ir(ar.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&Dt(t.host)&&Lt(t.host),g.initialize({options:t,instanceIdentifier:n})}(yp,{localCache:(fp={tabManager:new Wh},new Vh(fp))});var fp;try{(function(e){nr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=e._freezeSettings();return function(e,t,n){if((e=uA(e,RA))._firestoreClient||e._terminated)throw new Ir(ar.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new Ir(ar.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},VA(e)}(e,eA.provider,{build:e=>new qu(e,t.cacheSizeBytes,void 0)}),Promise.resolve()})(Zp).catch((e=>{"failed-precondition"===e.code||e.code}))}catch(Vye){}!function(e=function(e=cg){const t=ug.get(e);if(!t&&e===cg&&Tt())return Bg();if(!t)throw Zg.create("no-app",{appName:e});return t}()){const t=pg(e,"auth");if(t.isInitialized())return t.getImmediate();const n=
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(e,t){const n=pg(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(nn(n.getOptions(),null!=t?t:{}))return e;Kh(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:cp,persistence:[wb,cb,ub]}),g=Kt("authTokenSyncURL");if(g&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(g,location.origin);if(location.origin===e.origin){const t=(r=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>hp)return;const g=null==t?void 0:t.token;mp!==g&&(mp=g,await fetch(r,{method:g?"POST":"DELETE",headers:g?{Authorization:`Bearer ${g}`}:{}}))});!function(e,t,n){an(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,t,n,g){an(e).onIdTokenChanged(t,n,g)}(n,(e=>t(e)))}}var r;const i=(o="auth",null===(a=null===(s=xt())||void 0===s?void 0:s.emulatorHosts)||void 0===a?void 0:a[o]);var o,s,a;i&&Qm(n,`http://${i}`)}(yp);const Gp="guests",Bp="scans",Sp={async syncGuestsFromLocal(e){try{const t=500;let n=0,g=Jh(Zp),r=[];return Object.entries(e).forEach((([e,i])=>{i.forEach((i=>{const o=this.generateGuestId(e,i.name),s={id:o,name:i.name,group:e,count:i.count,message:i.message,createdAt:Nh(),updatedAt:Nh(),scanned:!1,scanCount:0},a=fA(Zp,Gp,o);g.set(a,s),n++,n>=t&&(r.push(g),g=Jh(Zp),n=0)}))})),n>0&&r.push(g),Promise.all(r.map((e=>e.commit())))}catch(Vye){throw Vye}},async getAllGuests(e=1e3){try{const t=oh(ZA(Zp,Gp),ch(e));return(await Sh(t)).docs.map((e=>e.data()))}catch(Vye){return[]}},async getGuestById(e){try{const t=this.sanitizeFirestoreId(e),n=await Gh(fA(Zp,Gp,t));return n.exists()?n.data():null}catch(Vye){return null}},async addGuest(e){try{const t=this.generateGuestId(e.group,e.name),n={...e,id:t,createdAt:Nh(),updatedAt:Nh(),scanned:!1,scanCount:0};return await function(e,t,n){e=uA(e,pA);const g=uA(e.firestore,RA),r=mh(e.converter,t,n);return vh(g,[KA(TA(g),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,gI.none())])}(fA(Zp,Gp,t),n),n}catch(Vye){throw Vye}},async updateGuest(e,t){try{const n=fA(Zp,Gp,e);await Rh(n,{...t,updatedAt:Nh()});return{id:e,...t,updatedAt:new Date}}catch(Vye){throw Vye}},async deleteGuest(e){try{return function(e){return vh(uA(e.firestore,RA),[new hI(e._key,gI.none())])}(fA(Zp,Gp,e))}catch(Vye){throw Vye}},async recordScan(e,t){try{const n=this.sanitizeFirestoreId(e),g=await function(e,t){const n=uA(e.firestore,RA),g=fA(e),r=mh(e.converter,t);return vh(n,[KA(TA(e.firestore),"addDoc",g._key,r,null!==e.converter,{}).toMutation(g._key,gI.exists(!1))]).then((()=>g))}(ZA(Zp,Bp),{guestId:n,timestamp:Nh(),...t}),r=fA(Zp,Gp,n),i=await Gh(r);if(i.exists()){const e=i.data();await Rh(r,{scanned:!0,scanCount:(e.scanCount||0)+1,lastScan:Nh()})}return g.id}catch(Vye){throw Vye}},async getGuestScans(e,t=10){try{const n=this.sanitizeFirestoreId(e),g=oh(ZA(Zp,Bp),function(e,t,n){const g=t,r=gh("where",e);return sh._create(r,g,n)}("guestId","==",n),lh("timestamp","desc"),ch(t));return(await Sh(g)).docs.map((e=>({id:e.id,...e.data()})))}catch(Vye){return[]}},async getAllScans(e=20,t=null){try{let n;n=t?oh(ZA(Zp,Bp),lh("timestamp","desc"),t,ch(e)):oh(ZA(Zp,Bp),lh("timestamp","desc"),ch(e));const g=await Sh(n),r=g.docs[g.docs.length-1];return{scans:g.docs.map((e=>({id:e.id,...e.data()}))),lastDoc:r,hasMore:g.docs.length===e}}catch(Vye){return{scans:[],lastDoc:null,hasMore:!1}}},generateGuestId:(e,t)=>`${e.replace(/\s+/g,"-").toLowerCase()}_${t.replace(/\s+/g,"-").toLowerCase()}`,sanitizeFirestoreId(e){if(e.includes("/")){const t=e.split("/");for(let e=t.length-1;e>=0;e--)if(t[e].trim())return t[e].trim()}return e.replace(/[#.[\]/]/g,"_")}},Rp=()=>{const[t,n]=e.useState(""),[g,r]=e.useState(""),[i,o]=e.useState([]),[s,a]=e.useState({totalGuests:0,totalPeople:0,sharedInvitations:0,scannedGuests:0}),[I,l]=e.useState([]),[C,c]=e.useState(!0),[d,u]=e.useState(!1),[A,h]=e.useState(null),[m,b]=e.useState([]);e.useEffect((()=>{(async()=>{c(!0);try{let e=await Sp.getAllGuests();0===e.length&&(await Sp.syncGuestsFromLocal(Te),e=await Sp.getAllGuests());const t=e.length,n=e.reduce(((e,t)=>e+t.count),0),g=e.filter((e=>e.scanned)).length;a({totalGuests:t,totalPeople:n,sharedInvitations:0,scannedGuests:g}),b(e),o(e)}catch(Vye){const t=[];Object.entries(Te).forEach((([e,n])=>{n.forEach((n=>{t.push({...n,group:e})}))})),o(t),b(t)}finally{c(!1)}})()}),[]),e.useEffect((()=>{if(0===m.length)return;const e=m.filter((e=>{const n=!g||e.group===g,r=e.name.toLowerCase().includes(t.toLowerCase())||e.group.toLowerCase().includes(t.toLowerCase());return n&&r}));o(e)}),[t,g,m]);const y=(e,t)=>{if(!I.some((n=>n.name===e.name&&n.group===t))){const n=[...I,{...e,group:t}];l(n),a((e=>({...e,sharedInvitations:e.sharedInvitations+1})))}},Z=async e=>{c(!0);try{await Sp.deleteGuest(e.id),b((t=>t.filter((t=>t.id!==e.id)))),a((t=>({...t,totalGuests:t.totalGuests-1,totalPeople:t.totalPeople-e.count,scannedGuests:e.scanned?t.scannedGuests-1:t.scannedGuests})))}catch(Vye){alert("Erreur lors de la suppression. Veuillez réessayer.")}finally{c(!1)}},f=e=>{h(e),u(!0)},G=Object.keys(Te);return p.jsxs("div",{className:"bg-secondary min-h-screen pb-10",children:[p.jsx("header",{className:"bg-primary text-white py-8 px-4",children:p.jsx("div",{className:"max-w-4xl mx-auto",children:p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"font-elegant text-3xl",children:"Gestion des Invités"}),p.jsx("p",{className:"text-white/70 mt-2",children:"Gérez les invitations pour le mariage de Fiston Zaka et Vino Banza"})]}),p.jsx("div",{children:p.jsxs("a",{href:"/qr-scanner",className:"inline-flex items-center px-4 py-2 bg-white text-primary rounded-md shadow hover:bg-primary/10 transition-colors",children:[p.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),"Scanner les QR codes"]})})]})})}),p.jsx("div",{className:"max-w-4xl mx-auto px-4 -mt-6",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[p.jsx(vp,{title:"Total des invités",value:s.totalGuests,icon:p.jsx("svg",{className:"w-8 h-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),p.jsx(vp,{title:"Total des personnes",value:s.totalPeople,icon:p.jsx("svg",{className:"w-8 h-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}),p.jsx(vp,{title:"Invitations partagées",value:s.sharedInvitations,percentage:Math.round(s.sharedInvitations/s.totalGuests*100),icon:p.jsx("svg",{className:"w-8 h-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}),p.jsx(vp,{title:"Invités scannés",value:s.scannedGuests,percentage:Math.round(s.scannedGuests/s.totalGuests*100),icon:p.jsx("svg",{className:"w-8 h-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})})]})}),p.jsx("div",{className:"max-w-4xl mx-auto px-4 mt-8",children:p.jsx(wt,{variant:"default",className:"p-4",children:p.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[p.jsx("div",{className:"flex-grow",children:p.jsxs("div",{className:"relative",children:[p.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:p.jsx("svg",{className:"w-5 h-5 text-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),p.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2 border border-gray-200 rounded-lg focus:ring-primary focus:border-primary bg-white text-primary-dark placeholder-muted",placeholder:"Rechercher un invité...",value:t,onChange:e=>n(e.target.value)})]})}),p.jsx("div",{className:"w-full md:w-1/4",children:p.jsxs("select",{className:"block w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-primary focus:border-primary bg-white text-primary-dark",value:g,onChange:e=>r(e.target.value),children:[p.jsx("option",{value:"",children:"Tous les groupes"}),G.map((e=>p.jsx("option",{value:e,children:e},e)))]})}),p.jsx("div",{className:"w-full md:w-auto",children:p.jsx(Pe,{variant:"primary",className:"w-full md:w-auto",onClick:()=>{h(null),u(!0)},icon:p.jsx("svg",{className:"w-5 h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),children:"Ajouter un invité"})})]})})}),d&&p.jsx("div",{className:"max-w-4xl mx-auto px-4 mt-6",children:p.jsx(kt,{guest:A,groups:G,onSubmit:A?async e=>{c(!0);try{await Sp.updateGuest(e.id,e),b((t=>t.map((t=>t.id===e.id?e:t)))),u(!1),h(null)}catch(Vye){alert("Erreur lors de la modification. Veuillez réessayer.")}finally{c(!1)}}:async e=>{c(!0);try{const t=await Sp.addGuest(e);b((e=>[...e,t])),a((t=>({...t,totalGuests:t.totalGuests+1,totalPeople:t.totalPeople+e.count}))),u(!1),h(null)}catch(Vye){alert("Erreur lors de l'ajout de l'invité. Veuillez réessayer.")}finally{c(!1)}},onCancel:()=>{h(null),u(!1)}})}),p.jsxs("div",{className:"max-w-4xl mx-auto px-4 mt-6",children:[p.jsxs("h2",{className:"font-elegant text-2xl text-primary-dark mb-4",children:[i.length," ",i.length>1?"invités trouvés":"invité trouvé"]}),p.jsx("div",{className:"space-y-4",children:C?p.jsx(wt,{variant:"flat",className:"p-8 text-center",children:p.jsx("p",{className:"text-muted",children:"Chargement des invités..."})}):p.jsxs(p.Fragment,{children:[i.map(((e,t)=>p.jsx(Wt,{guest:e,group:e.group,onShare:y,onEdit:f,onDelete:Z},`${e.group}-${e.name}-${t}`))),0===i.length&&p.jsx(wt,{variant:"flat",className:"p-8 text-center",children:p.jsxs("div",{className:"text-muted",children:[p.jsx("svg",{className:"w-12 h-12 mx-auto mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),p.jsx("p",{className:"text-lg font-elegant",children:"Aucun invité ne correspond à votre recherche"})]})})]})})]})]})},vp=({title:e,value:t,percentage:n,icon:g})=>p.jsx(wt,{variant:"elegant",className:"transform hover:-translate-y-1 transition-transform duration-300",children:p.jsx(wt.Body,{className:"p-5",children:p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"mr-4 bg-primary/10 p-3 rounded-full",children:g}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-lg font-medium text-primary-dark",children:e}),p.jsxs("div",{className:"flex items-end",children:[p.jsx("p",{className:"text-2xl font-semibold text-primary-dark",children:t}),void 0!==n&&p.jsxs("span",{className:"ml-2 text-sm text-primary/80 mb-1",children:["(",n,"%)"]})]})]})]})})});vp.propTypes={title:Ue.string.isRequired,value:Ue.number.isRequired,percentage:Ue.number,icon:Ue.node.isRequired};const Vp=()=>{const[t,n]=e.useState("");return e.useEffect((()=>{document.title=`Mariage de ${Ke.couple.groom} & ${Ke.couple.bride} - ${Ke.event.date}`;const e=document.querySelector('meta[name="description"]');e&&e.setAttribute("content",`Nous avons l'immense joie de vous convier au mariage de ${Ke.couple.groom} & ${Ke.couple.bride} qui aura lieu le ${Ke.event.date} à ${Ke.event.venue}.`);const t=localStorage.getItem("authMessage");if(t){n(t),localStorage.removeItem("authMessage");const e=setTimeout((()=>{n("")}),5e3);return()=>clearTimeout(e)}}),[]),p.jsxs("div",{className:"min-h-screen flex flex-col bg-secondary",children:[t&&p.jsx("div",{className:"fixed top-4 left-0 right-0 mx-auto max-w-md z-50 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded shadow-lg animate-fadeIn",children:p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"py-1",children:p.jsx("svg",{className:"w-6 h-6 mr-4 fill-current text-red-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:p.jsx("path",{d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"})})}),p.jsx("div",{children:p.jsx("p",{className:"text-sm",children:t})})]})}),p.jsxs("header",{className:"relative h-80 sm:h-96 bg-primary/10 overflow-hidden",children:[p.jsx("div",{className:"absolute inset-0 bg-floral-pattern opacity-20"}),p.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-4",children:[p.jsx(_e,{animation:"fade-down",delay:100,children:p.jsx("h1",{className:"text-primary font-elegant text-3xl sm:text-4xl md:text-5xl text-center",children:"Mariage de"})}),p.jsx(_e,{animation:"fade-up",delay:300,children:p.jsxs("div",{className:"mt-6 sm:mt-8 relative w-full px-4 max-w-4xl mx-auto",children:[p.jsxs("div",{className:"names-container flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-6 flex-wrap",children:[p.jsx("span",{className:"font-cursive text-4xl sm:text-5xl md:text-6xl text-primary text-center break-words",children:Ke.couple.groom}),p.jsx("div",{className:"wedding-ampersand my-2 sm:my-0",children:p.jsx("span",{className:"wedding-symbol text-3xl sm:text-4xl md:text-5xl text-gradient",children:"&"})}),p.jsx("span",{className:"font-cursive text-4xl sm:text-5xl md:text-6xl text-primary text-center break-words",children:Ke.couple.bride})]}),p.jsx("div",{className:"absolute -bottom-4 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-primary/40 to-transparent"})]})}),p.jsx(_e,{animation:"fade-up",delay:500,children:p.jsx("p",{className:"mt-8 text-muted font-sans text-lg sm:text-xl border-t border-primary/10 pt-4 px-6 rounded-full bg-white/30 shadow-sm",children:Ke.event.date})})]})]}),p.jsxs("main",{className:"flex-1 px-4 py-10 max-w-4xl mx-auto",children:[p.jsx(_e,{className:"mb-8 text-center",delay:100,children:p.jsxs("div",{className:"glass-card p-6 sm:p-8 rounded-xl",children:[p.jsx("h2",{className:"font-elegant text-2xl sm:text-3xl text-primary-dark mb-4",children:"Notre invitation"}),p.jsx("p",{className:"text-muted mb-4 max-w-2xl mx-auto",children:Ke.welcomeMessage}),p.jsx("p",{className:"text-sm text-primary-dark/70 italic",children:"Veuillez utiliser votre lien d'invitation personnalisé pour accéder à tous les détails."})]})}),p.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8",children:[p.jsx(_e,{animation:"fade-right",delay:200,children:p.jsxs("div",{className:"card p-5 sm:p-7 hover:shadow-lg transition-shadow",children:[p.jsx("h3",{className:"font-elegant text-xl text-primary-dark mb-3",children:"Date & Horaire"}),p.jsxs("p",{className:"text-muted",children:["Le ",Ke.event.date," à ",Ke.event.time]}),p.jsx("div",{className:"mt-3 bg-accent/10 rounded-lg p-3 text-sm text-center text-accent border-l-2 border-accent",children:p.jsx("span",{className:"font-medium",children:"Accueil des invités à partir de 19h"})})]})}),p.jsx(_e,{animation:"fade-left",delay:300,children:p.jsxs("div",{className:"card p-5 sm:p-7 hover:shadow-lg transition-shadow",children:[p.jsx("h3",{className:"font-elegant text-xl text-primary-dark mb-3",children:"Lieu"}),p.jsxs("p",{className:"text-muted",children:[Ke.event.venue,p.jsx("br",{}),Ke.event.address,p.jsx("br",{}),Ke.event.location]})]})})]}),p.jsx(_e,{animation:"zoom-in",delay:400,children:p.jsxs("div",{className:"text-center mt-8 mb-12 glass-card p-6 sm:p-8 rounded-xl",children:[p.jsx("h2",{className:"font-elegant text-2xl sm:text-3xl text-primary-dark mb-4",children:"Comment accéder à votre invitation personnalisée"}),p.jsx("p",{className:"text-muted mb-6",children:"L'invitation complète est accessible uniquement via le lien personnalisé qui vous a été envoyé. Si vous ne l'avez pas reçu, veuillez contacter les mariés."}),p.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[p.jsx(Ye,{to:"/admin-login",className:"px-6 py-3 bg-primary text-white rounded-lg shadow-elegant hover:bg-primary-dark transition-all transform hover:-translate-y-1",children:"Accéder à l'administration"}),p.jsxs("a",{href:"https://wa.me/243899895733",target:"_blank",rel:"noopener noreferrer",className:"px-6 py-3 bg-white text-primary-dark border border-primary/20 rounded-lg shadow-elegant hover:bg-highlight transition-all transform hover:-translate-y-1 flex items-center justify-center gap-2",children:[p.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{d:"M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"})}),"Contacter les mariés via WhatsApp"]})]})]})})]}),p.jsxs("footer",{className:"bg-primary text-white py-8 px-4 text-center",children:[p.jsx("div",{className:"mb-4",children:p.jsx(_e,{animation:"fade-up",children:p.jsxs("div",{className:"flex items-center justify-center gap-3 flex-wrap",children:[p.jsx("span",{className:"font-cursive text-2xl",children:Ke.couple.groom}),p.jsx("span",{className:"text-xl",children:"&"}),p.jsx("span",{className:"font-cursive text-2xl",children:Ke.couple.bride})]})})}),p.jsx("p",{className:"text-sm text-white/70",children:"Nous nous réjouissons de célébrer ce jour spécial avec vous"}),p.jsxs("div",{className:"mt-6 text-xs text-white/50",children:[p.jsxs("p",{children:["© ",(new Date).getFullYear()," - Tous droits réservés"]}),p.jsxs("p",{className:"mt-1",children:["Développé par Criho James,"," ",p.jsx("a",{href:"https://www.criho.tech",target:"_blank",rel:"noopener noreferrer",className:"hover:text-white transition-colors duration-300",children:"@https://www.criho.tech"})]})]})]}),p.jsx("style",{children:"\n        .text-gradient {\n          background-image: linear-gradient(to right, var(--color-primary), var(--color-accent));\n          -webkit-background-clip: text;\n          -webkit-text-fill-color: transparent;\n        }\n        .wedding-symbol {\n          display: inline-block;\n        }\n        .shadow-elegant {\n          box-shadow: 0 4px 14px rgba(0, 0, 0, 0.08);\n        }\n        \n        /* Animation pour les messages d'alerte */\n        @keyframes fadeIn {\n          from { opacity: 0; transform: translateY(-20px); }\n          to { opacity: 1; transform: translateY(0); }\n        }\n        .animate-fadeIn {\n          animation: fadeIn 0.3s ease-in-out;\n        }\n      "})]})};var wp={exports:{}};var Wp={exports:{}};const kp=i(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Xp;function Np(){return Xp||(Xp=1,Wp.exports=(e=e||function(e,t){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==o&&o.crypto&&(n=o.crypto),!n)try{n=kp}catch(h){}var g=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(h){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(h){}}throw new Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},s=i.lib={},a=s.Base=function(){return{extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),I=s.WordArray=a.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||C).stringify(this)},concat:function(e){var t=this.words,n=e.words,g=this.sigBytes,r=e.sigBytes;if(this.clamp(),g%4)for(var i=0;i<r;i++){var o=n[i>>>2]>>>24-i%4*8&255;t[g+i>>>2]|=o<<24-(g+i)%4*8}else for(var s=0;s<r;s+=4)t[g+s>>>2]=n[s>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(g());return new I.init(t,e)}}),l=i.enc={},C=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,g=[],r=0;r<n;r++){var i=t[r>>>2]>>>24-r%4*8&255;g.push((i>>>4).toString(16)),g.push((15&i).toString(16))}return g.join("")},parse:function(e){for(var t=e.length,n=[],g=0;g<t;g+=2)n[g>>>3]|=parseInt(e.substr(g,2),16)<<24-g%8*4;return new I.init(n,t/2)}},c=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,g=[],r=0;r<n;r++){var i=t[r>>>2]>>>24-r%4*8&255;g.push(String.fromCharCode(i))}return g.join("")},parse:function(e){for(var t=e.length,n=[],g=0;g<t;g++)n[g>>>2]|=(255&e.charCodeAt(g))<<24-g%4*8;return new I.init(n,t)}},d=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(fp){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},u=s.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new I.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,g=this._data,r=g.words,i=g.sigBytes,o=this.blockSize,s=i/(4*o),a=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,l=e.min(4*a,i);if(a){for(var C=0;C<a;C+=o)this._doProcessBlock(r,C);n=r.splice(0,a),g.sigBytes-=l}return new I.init(n,l)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});s.Hasher=u.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new A.HMAC.init(e,n).finalize(t)}}});var A=i.algo={};return i}(Math),e)),Wp.exports;var e}var Jp,Yp={exports:{}};function Ep(){return Jp?Yp.exports:(Jp=1,Yp.exports=(o=Np(),n=(t=o).lib,g=n.Base,r=n.WordArray,(i=t.x64={}).Word=g.extend({init:function(e,t){this.high=e,this.low=t}}),i.WordArray=g.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:8*t.length},toX32:function(){for(var e=this.words,t=e.length,n=[],g=0;g<t;g++){var i=e[g];n.push(i.high),n.push(i.low)}return r.create(n,this.sigBytes)},clone:function(){for(var e=g.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}}),o));var e,t,n,g,r,i,o}var Hp,Fp={exports:{}};function xp(){return Hp||(Hp=1,Fp.exports=(e=Np(),function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,n=t.init,g=t.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,g=[],r=0;r<t;r++)g[r>>>2]|=e[r]<<24-r%4*8;n.call(this,g,t)}else n.apply(this,arguments)};g.prototype=t}}(),e.lib.WordArray)),Fp.exports;var e}var Tp,Kp={exports:{}};function Mp(){return Tp?Kp.exports:(Tp=1,Kp.exports=(e=Np(),function(){var t=e,n=t.lib.WordArray,g=t.enc;function r(e){return e<<8&4278255360|e>>>8&16711935}g.Utf16=g.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,g=[],r=0;r<n;r+=2){var i=t[r>>>2]>>>16-r%4*8&65535;g.push(String.fromCharCode(i))}return g.join("")},parse:function(e){for(var t=e.length,g=[],r=0;r<t;r++)g[r>>>1]|=e.charCodeAt(r)<<16-r%2*16;return n.create(g,2*t)}},g.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,g=[],i=0;i<n;i+=2){var o=r(t[i>>>2]>>>16-i%4*8&65535);g.push(String.fromCharCode(o))}return g.join("")},parse:function(e){for(var t=e.length,g=[],i=0;i<t;i++)g[i>>>1]|=r(e.charCodeAt(i)<<16-i%2*16);return n.create(g,2*t)}}}(),e.enc.Utf16));var e}var Dp,Lp={exports:{}};function Up(){return Dp?Lp.exports:(Dp=1,Lp.exports=(e=Np(),function(){var t=e,n=t.lib.WordArray;function g(e,t,g){for(var r=[],i=0,o=0;o<t;o++)if(o%4){var s=g[e.charCodeAt(o-1)]<<o%4*2|g[e.charCodeAt(o)]>>>6-o%4*2;r[i>>>2]|=s<<24-i%4*8,i++}return n.create(r,i)}t.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,g=this._map;e.clamp();for(var r=[],i=0;i<n;i+=3)for(var o=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<n;s++)r.push(g.charAt(o>>>6*(3-s)&63));var a=g.charAt(64);if(a)for(;r.length%4;)r.push(a);return r.join("")},parse:function(e){var t=e.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var i=0;i<n.length;i++)r[n.charCodeAt(i)]=i}var o=n.charAt(64);if(o){var s=e.indexOf(o);-1!==s&&(t=s)}return g(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64));var e}var zp,Qp={exports:{}};function Op(){return zp?Qp.exports:(zp=1,Qp.exports=(e=Np(),function(){var t=e,n=t.lib.WordArray;function g(e,t,g){for(var r=[],i=0,o=0;o<t;o++)if(o%4){var s=g[e.charCodeAt(o-1)]<<o%4*2|g[e.charCodeAt(o)]>>>6-o%4*2;r[i>>>2]|=s<<24-i%4*8,i++}return n.create(r,i)}t.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var n=e.words,g=e.sigBytes,r=t?this._safe_map:this._map;e.clamp();for(var i=[],o=0;o<g;o+=3)for(var s=(n[o>>>2]>>>24-o%4*8&255)<<16|(n[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|n[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<g;a++)i.push(r.charAt(s>>>6*(3-a)&63));var I=r.charAt(64);if(I)for(;i.length%4;)i.push(I);return i.join("")},parse:function(e,t){void 0===t&&(t=!0);var n=e.length,r=t?this._safe_map:this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<r.length;o++)i[r.charCodeAt(o)]=o}var s=r.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(n=a)}return g(e,n,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),e.enc.Base64url));var e}var jp,Pp={exports:{}};function _p(){return jp?Pp.exports:(jp=1,Pp.exports=(e=Np(),function(t){var n=e,g=n.lib,r=g.WordArray,i=g.Hasher,o=n.algo,s=[];!function(){for(var e=0;e<64;e++)s[e]=4294967296*t.abs(t.sin(e+1))|0}();var a=o.MD5=i.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var g=t+n,r=e[g];e[g]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var i=this._hash.words,o=e[t+0],a=e[t+1],d=e[t+2],u=e[t+3],A=e[t+4],h=e[t+5],m=e[t+6],b=e[t+7],p=e[t+8],y=e[t+9],Z=e[t+10],f=e[t+11],G=e[t+12],B=e[t+13],S=e[t+14],R=e[t+15],v=i[0],V=i[1],w=i[2],W=i[3];v=I(v,V,w,W,o,7,s[0]),W=I(W,v,V,w,a,12,s[1]),w=I(w,W,v,V,d,17,s[2]),V=I(V,w,W,v,u,22,s[3]),v=I(v,V,w,W,A,7,s[4]),W=I(W,v,V,w,h,12,s[5]),w=I(w,W,v,V,m,17,s[6]),V=I(V,w,W,v,b,22,s[7]),v=I(v,V,w,W,p,7,s[8]),W=I(W,v,V,w,y,12,s[9]),w=I(w,W,v,V,Z,17,s[10]),V=I(V,w,W,v,f,22,s[11]),v=I(v,V,w,W,G,7,s[12]),W=I(W,v,V,w,B,12,s[13]),w=I(w,W,v,V,S,17,s[14]),v=l(v,V=I(V,w,W,v,R,22,s[15]),w,W,a,5,s[16]),W=l(W,v,V,w,m,9,s[17]),w=l(w,W,v,V,f,14,s[18]),V=l(V,w,W,v,o,20,s[19]),v=l(v,V,w,W,h,5,s[20]),W=l(W,v,V,w,Z,9,s[21]),w=l(w,W,v,V,R,14,s[22]),V=l(V,w,W,v,A,20,s[23]),v=l(v,V,w,W,y,5,s[24]),W=l(W,v,V,w,S,9,s[25]),w=l(w,W,v,V,u,14,s[26]),V=l(V,w,W,v,p,20,s[27]),v=l(v,V,w,W,B,5,s[28]),W=l(W,v,V,w,d,9,s[29]),w=l(w,W,v,V,b,14,s[30]),v=C(v,V=l(V,w,W,v,G,20,s[31]),w,W,h,4,s[32]),W=C(W,v,V,w,p,11,s[33]),w=C(w,W,v,V,f,16,s[34]),V=C(V,w,W,v,S,23,s[35]),v=C(v,V,w,W,a,4,s[36]),W=C(W,v,V,w,A,11,s[37]),w=C(w,W,v,V,b,16,s[38]),V=C(V,w,W,v,Z,23,s[39]),v=C(v,V,w,W,B,4,s[40]),W=C(W,v,V,w,o,11,s[41]),w=C(w,W,v,V,u,16,s[42]),V=C(V,w,W,v,m,23,s[43]),v=C(v,V,w,W,y,4,s[44]),W=C(W,v,V,w,G,11,s[45]),w=C(w,W,v,V,R,16,s[46]),v=c(v,V=C(V,w,W,v,d,23,s[47]),w,W,o,6,s[48]),W=c(W,v,V,w,b,10,s[49]),w=c(w,W,v,V,S,15,s[50]),V=c(V,w,W,v,h,21,s[51]),v=c(v,V,w,W,G,6,s[52]),W=c(W,v,V,w,u,10,s[53]),w=c(w,W,v,V,Z,15,s[54]),V=c(V,w,W,v,a,21,s[55]),v=c(v,V,w,W,p,6,s[56]),W=c(W,v,V,w,R,10,s[57]),w=c(w,W,v,V,m,15,s[58]),V=c(V,w,W,v,B,21,s[59]),v=c(v,V,w,W,A,6,s[60]),W=c(W,v,V,w,f,10,s[61]),w=c(w,W,v,V,d,15,s[62]),V=c(V,w,W,v,y,21,s[63]),i[0]=i[0]+v|0,i[1]=i[1]+V|0,i[2]=i[2]+w|0,i[3]=i[3]+W|0},_doFinalize:function(){var e=this._data,n=e.words,g=8*this._nDataBytes,r=8*e.sigBytes;n[r>>>5]|=128<<24-r%32;var i=t.floor(g/4294967296),o=g;n[15+(r+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(r+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(n.length+1),this._process();for(var s=this._hash,a=s.words,I=0;I<4;I++){var l=a[I];a[I]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return s},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function I(e,t,n,g,r,i,o){var s=e+(t&n|~t&g)+r+o;return(s<<i|s>>>32-i)+t}function l(e,t,n,g,r,i,o){var s=e+(t&g|n&~g)+r+o;return(s<<i|s>>>32-i)+t}function C(e,t,n,g,r,i,o){var s=e+(t^n^g)+r+o;return(s<<i|s>>>32-i)+t}function c(e,t,n,g,r,i,o){var s=e+(n^(t|~g))+r+o;return(s<<i|s>>>32-i)+t}n.MD5=i._createHelper(a),n.HmacMD5=i._createHmacHelper(a)}(Math),e.MD5));var e}var qp,$p={exports:{}};function ey(){return qp||(qp=1,$p.exports=(s=Np(),t=(e=s).lib,n=t.WordArray,g=t.Hasher,r=e.algo,i=[],o=r.SHA1=g.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,g=n[0],r=n[1],o=n[2],s=n[3],a=n[4],I=0;I<80;I++){if(I<16)i[I]=0|e[t+I];else{var l=i[I-3]^i[I-8]^i[I-14]^i[I-16];i[I]=l<<1|l>>>31}var C=(g<<5|g>>>27)+a+i[I];C+=I<20?1518500249+(r&o|~r&s):I<40?1859775393+(r^o^s):I<60?(r&o|r&s|o&s)-1894007588:(r^o^s)-899497514,a=s,s=o,o=r<<30|r>>>2,r=g,g=C}n[0]=n[0]+g|0,n[1]=n[1]+r|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,g=8*e.sigBytes;return t[g>>>5]|=128<<24-g%32,t[14+(g+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(g+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=g.clone.call(this);return e._hash=this._hash.clone(),e}}),e.SHA1=g._createHelper(o),e.HmacSHA1=g._createHmacHelper(o),s.SHA1)),$p.exports;var e,t,n,g,r,i,o,s}var ty,ny={exports:{}};function gy(){return ty||(ty=1,ny.exports=(e=Np(),function(t){var n=e,g=n.lib,r=g.WordArray,i=g.Hasher,o=n.algo,s=[],a=[];!function(){function e(e){for(var n=t.sqrt(e),g=2;g<=n;g++)if(!(e%g))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var g=2,r=0;r<64;)e(g)&&(r<8&&(s[r]=n(t.pow(g,.5))),a[r]=n(t.pow(g,1/3)),r++),g++}();var I=[],l=o.SHA256=i.extend({_doReset:function(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,g=n[0],r=n[1],i=n[2],o=n[3],s=n[4],l=n[5],C=n[6],c=n[7],d=0;d<64;d++){if(d<16)I[d]=0|e[t+d];else{var u=I[d-15],A=(u<<25|u>>>7)^(u<<14|u>>>18)^u>>>3,h=I[d-2],m=(h<<15|h>>>17)^(h<<13|h>>>19)^h>>>10;I[d]=A+I[d-7]+m+I[d-16]}var b=g&r^g&i^r&i,p=(g<<30|g>>>2)^(g<<19|g>>>13)^(g<<10|g>>>22),y=c+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&C)+a[d]+I[d];c=C,C=l,l=s,s=o+y|0,o=i,i=r,r=g,g=y+(p+b)|0}n[0]=n[0]+g|0,n[1]=n[1]+r|0,n[2]=n[2]+i|0,n[3]=n[3]+o|0,n[4]=n[4]+s|0,n[5]=n[5]+l|0,n[6]=n[6]+C|0,n[7]=n[7]+c|0},_doFinalize:function(){var e=this._data,n=e.words,g=8*this._nDataBytes,r=8*e.sigBytes;return n[r>>>5]|=128<<24-r%32,n[14+(r+64>>>9<<4)]=t.floor(g/4294967296),n[15+(r+64>>>9<<4)]=g,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=i._createHelper(l),n.HmacSHA256=i._createHmacHelper(l)}(Math),e.SHA256)),ny.exports;var e}var ry,iy={exports:{}};var oy,sy={exports:{}};function ay(){return oy||(oy=1,sy.exports=(e=Np(),Ep(),function(){var t=e,n=t.lib.Hasher,g=t.x64,r=g.Word,i=g.WordArray,o=t.algo;function s(){return r.create.apply(r,arguments)}var a=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],I=[];!function(){for(var e=0;e<80;e++)I[e]=s()}();var l=o.SHA512=n.extend({_doReset:function(){this._hash=new i.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,g=n[0],r=n[1],i=n[2],o=n[3],s=n[4],l=n[5],C=n[6],c=n[7],d=g.high,u=g.low,A=r.high,h=r.low,m=i.high,b=i.low,p=o.high,y=o.low,Z=s.high,f=s.low,G=l.high,B=l.low,S=C.high,R=C.low,v=c.high,V=c.low,w=d,W=u,k=A,X=h,N=m,J=b,Y=p,E=y,H=Z,F=f,x=G,T=B,K=S,M=R,D=v,L=V,U=0;U<80;U++){var z,Q,O=I[U];if(U<16)Q=O.high=0|e[t+2*U],z=O.low=0|e[t+2*U+1];else{var j=I[U-15],P=j.high,_=j.low,q=(P>>>1|_<<31)^(P>>>8|_<<24)^P>>>7,$=(_>>>1|P<<31)^(_>>>8|P<<24)^(_>>>7|P<<25),ee=I[U-2],te=ee.high,ne=ee.low,ge=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,re=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),ie=I[U-7],oe=ie.high,se=ie.low,ae=I[U-16],Ie=ae.high,le=ae.low;Q=(Q=(Q=q+oe+((z=$+se)>>>0<$>>>0?1:0))+ge+((z+=re)>>>0<re>>>0?1:0))+Ie+((z+=le)>>>0<le>>>0?1:0),O.high=Q,O.low=z}var Ce,ce=H&x^~H&K,de=F&T^~F&M,ue=w&k^w&N^k&N,Ae=W&X^W&J^X&J,he=(w>>>28|W<<4)^(w<<30|W>>>2)^(w<<25|W>>>7),me=(W>>>28|w<<4)^(W<<30|w>>>2)^(W<<25|w>>>7),be=(H>>>14|F<<18)^(H>>>18|F<<14)^(H<<23|F>>>9),pe=(F>>>14|H<<18)^(F>>>18|H<<14)^(F<<23|H>>>9),ye=a[U],Ze=ye.high,fe=ye.low,Ge=D+be+((Ce=L+pe)>>>0<L>>>0?1:0),Be=me+Ae;D=K,L=M,K=x,M=T,x=H,T=F,H=Y+(Ge=(Ge=(Ge=Ge+ce+((Ce+=de)>>>0<de>>>0?1:0))+Ze+((Ce+=fe)>>>0<fe>>>0?1:0))+Q+((Ce+=z)>>>0<z>>>0?1:0))+((F=E+Ce|0)>>>0<E>>>0?1:0)|0,Y=N,E=J,N=k,J=X,k=w,X=W,w=Ge+(he+ue+(Be>>>0<me>>>0?1:0))+((W=Ce+Be|0)>>>0<Ce>>>0?1:0)|0}u=g.low=u+W,g.high=d+w+(u>>>0<W>>>0?1:0),h=r.low=h+X,r.high=A+k+(h>>>0<X>>>0?1:0),b=i.low=b+J,i.high=m+N+(b>>>0<J>>>0?1:0),y=o.low=y+E,o.high=p+Y+(y>>>0<E>>>0?1:0),f=s.low=f+F,s.high=Z+H+(f>>>0<F>>>0?1:0),B=l.low=B+T,l.high=G+x+(B>>>0<T>>>0?1:0),R=C.low=R+M,C.high=S+K+(R>>>0<M>>>0?1:0),V=c.low=V+L,c.high=v+D+(V>>>0<L>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,g=8*e.sigBytes;return t[g>>>5]|=128<<24-g%32,t[30+(g+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(g+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});t.SHA512=n._createHelper(l),t.HmacSHA512=n._createHmacHelper(l)}(),e.SHA512)),sy.exports;var e}var Iy,ly={exports:{}};var Cy,cy={exports:{}};function dy(){return Cy?cy.exports:(Cy=1,cy.exports=(e=Np(),Ep(),function(t){var n=e,g=n.lib,r=g.WordArray,i=g.Hasher,o=n.x64.Word,s=n.algo,a=[],I=[],l=[];!function(){for(var e=1,t=0,n=0;n<24;n++){a[e+5*t]=(n+1)*(n+2)/2%64;var g=(2*e+3*t)%5;e=t%5,t=g}for(e=0;e<5;e++)for(t=0;t<5;t++)I[e+5*t]=t+(2*e+3*t)%5*5;for(var r=1,i=0;i<24;i++){for(var s=0,C=0,c=0;c<7;c++){if(1&r){var d=(1<<c)-1;d<32?C^=1<<d:s^=1<<d-32}128&r?r=r<<1^113:r<<=1}l[i]=o.create(s,C)}}();var C=[];!function(){for(var e=0;e<25;e++)C[e]=o.create()}();var c=s.SHA3=i.extend({cfg:i.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,g=this.blockSize/2,r=0;r<g;r++){var i=e[t+2*r],o=e[t+2*r+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),(V=n[r]).high^=o,V.low^=i}for(var s=0;s<24;s++){for(var c=0;c<5;c++){for(var d=0,u=0,A=0;A<5;A++)d^=(V=n[c+5*A]).high,u^=V.low;var h=C[c];h.high=d,h.low=u}for(c=0;c<5;c++){var m=C[(c+4)%5],b=C[(c+1)%5],p=b.high,y=b.low;for(d=m.high^(p<<1|y>>>31),u=m.low^(y<<1|p>>>31),A=0;A<5;A++)(V=n[c+5*A]).high^=d,V.low^=u}for(var Z=1;Z<25;Z++){var f=(V=n[Z]).high,G=V.low,B=a[Z];B<32?(d=f<<B|G>>>32-B,u=G<<B|f>>>32-B):(d=G<<B-32|f>>>64-B,u=f<<B-32|G>>>64-B);var S=C[I[Z]];S.high=d,S.low=u}var R=C[0],v=n[0];for(R.high=v.high,R.low=v.low,c=0;c<5;c++)for(A=0;A<5;A++){var V=n[Z=c+5*A],w=C[Z],W=C[(c+1)%5+5*A],k=C[(c+2)%5+5*A];V.high=w.high^~W.high&k.high,V.low=w.low^~W.low&k.low}V=n[0];var X=l[s];V.high^=X.high,V.low^=X.low}},_doFinalize:function(){var e=this._data,n=e.words;this._nDataBytes;var g=8*e.sigBytes,i=32*this.blockSize;n[g>>>5]|=1<<24-g%32,n[(t.ceil((g+1)/i)*i>>>5)-1]|=128,e.sigBytes=4*n.length,this._process();for(var o=this._state,s=this.cfg.outputLength/8,a=s/8,I=[],l=0;l<a;l++){var C=o[l],c=C.high,d=C.low;c=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),I.push(d),I.push(c)}return new r.init(I,s)},clone:function(){for(var e=i.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});n.SHA3=i._createHelper(c),n.HmacSHA3=i._createHmacHelper(c)}(Math),e.SHA3));var e}var uy,Ay={exports:{}};var hy,my={exports:{}};function by(){return hy||(hy=1,my.exports=(e=Np(),n=(t=e).lib.Base,g=t.enc.Utf8,void(t.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=g.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),s=i.words,a=o.words,I=0;I<n;I++)s[I]^=1549556828,a[I]^=909522486;i.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))),my.exports;var e,t,n,g}var py,yy={exports:{}};var Zy,fy={exports:{}};function Gy(){return Zy?fy.exports:(Zy=1,fy.exports=(s=Np(),ey(),by(),t=(e=s).lib,n=t.Base,g=t.WordArray,r=e.algo,i=r.MD5,o=r.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:i,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,r=this.cfg,i=r.hasher.create(),o=g.create(),s=o.words,a=r.keySize,I=r.iterations;s.length<a;){n&&i.update(n),n=i.update(e).finalize(t),i.reset();for(var l=1;l<I;l++)n=i.finalize(n),i.reset();o.concat(n)}return o.sigBytes=4*a,o}}),e.EvpKDF=function(e,t,n){return o.create(n).compute(e,t)},s.EvpKDF));var e,t,n,g,r,i,o,s}var By,Sy={exports:{}};function Ry(){return By||(By=1,Sy.exports=(e=Np(),Gy(),void(e.lib.Cipher||function(t){var n=e,g=n.lib,r=g.Base,i=g.WordArray,o=g.BufferedBlockAlgorithm,s=n.enc;s.Utf8;var a=s.Base64,I=n.algo.EvpKDF,l=g.Cipher=o.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?p:m}return function(t){return{encrypt:function(n,g,r){return e(g).encrypt(t,n,g,r)},decrypt:function(n,g,r){return e(g).decrypt(t,n,g,r)}}}}()});g.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var C=n.mode={},c=g.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),d=C.CBC=function(){var e=c.extend();function n(e,n,g){var r,i=this._iv;i?(r=i,this._iv=t):r=this._prevBlock;for(var o=0;o<g;o++)e[n+o]^=r[o]}return e.Encryptor=e.extend({processBlock:function(e,t){var g=this._cipher,r=g.blockSize;n.call(this,e,t,r),g.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),e.Decryptor=e.extend({processBlock:function(e,t){var g=this._cipher,r=g.blockSize,i=e.slice(t,t+r);g.decryptBlock(e,t),n.call(this,e,t,r),this._prevBlock=i}}),e}(),u=(n.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,g=n-e.sigBytes%n,r=g<<24|g<<16|g<<8|g,o=[],s=0;s<g;s+=4)o.push(r);var a=i.create(o,g);e.concat(a)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};g.BlockCipher=l.extend({cfg:l.cfg.extend({mode:d,padding:u}),reset:function(){var e;l.reset.call(this);var t=this.cfg,n=t.iv,g=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=g.createEncryptor:(e=g.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,n&&n.words):(this._mode=e.call(g,this,n&&n.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var A=g.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),h=(n.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;return(n?i.create([1398893684,1701076831]).concat(n).concat(t):t).toString(a)},parse:function(e){var t,n=a.parse(e),g=n.words;return 1398893684==g[0]&&1701076831==g[1]&&(t=i.create(g.slice(2,4)),g.splice(0,4),n.sigBytes-=16),A.create({ciphertext:n,salt:t})}},m=g.SerializableCipher=r.extend({cfg:r.extend({format:h}),encrypt:function(e,t,n,g){g=this.cfg.extend(g);var r=e.createEncryptor(n,g),i=r.finalize(t),o=r.cfg;return A.create({ciphertext:i,key:n,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:g.format})},decrypt:function(e,t,n,g){return g=this.cfg.extend(g),t=this._parse(t,g.format),e.createDecryptor(n,g).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),b=(n.kdf={}).OpenSSL={execute:function(e,t,n,g,r){if(g||(g=i.random(8)),r)o=I.create({keySize:t+n,hasher:r}).compute(e,g);else var o=I.create({keySize:t+n}).compute(e,g);var s=i.create(o.words.slice(t),4*n);return o.sigBytes=4*t,A.create({key:o,iv:s,salt:g})}},p=g.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:b}),encrypt:function(e,t,n,g){var r=(g=this.cfg.extend(g)).kdf.execute(n,e.keySize,e.ivSize,g.salt,g.hasher);g.iv=r.iv;var i=m.encrypt.call(this,e,t,r.key,g);return i.mixIn(r),i},decrypt:function(e,t,n,g){g=this.cfg.extend(g),t=this._parse(t,g.format);var r=g.kdf.execute(n,e.keySize,e.ivSize,t.salt,g.hasher);return g.iv=r.iv,m.decrypt.call(this,e,t,r.key,g)}})}()))),Sy.exports;var e}var vy,Vy={exports:{}};var wy,Wy={exports:{}};var ky,Xy={exports:{}};function Ny(){return ky?Xy.exports:(ky=1,Xy.exports=(e=Np(),Ry(),
/** @preserve
       * Counter block mode compatible with  Dr Brian Gladman fileenc.c
       * derived from CryptoJS.mode.CTR
       * Jan Hruby jhruby.web@gmail.com
       */
e.mode.CTRGladman=function(){var t=e.lib.BlockCipherMode.extend();function n(e){if(255&~(e>>24))e+=1<<24;else{var t=e>>16&255,n=e>>8&255,g=255&e;255===t?(t=0,255===n?(n=0,255===g?g=0:++g):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=g}return e}function g(e){return 0===(e[0]=n(e[0]))&&(e[1]=n(e[1])),e}var r=t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=this._iv,o=this._counter;i&&(o=this._counter=i.slice(0),this._iv=void 0),g(o);var s=o.slice(0);n.encryptBlock(s,0);for(var a=0;a<r;a++)e[t+a]^=s[a]}});return t.Decryptor=r,t}(),e.mode.CTRGladman));var e}var Jy,Yy={exports:{}};var Ey,Hy={exports:{}};var Fy,xy={exports:{}};var Ty,Ky={exports:{}};var My,Dy={exports:{}};var Ly,Uy={exports:{}};var zy,Qy={exports:{}};var Oy,jy={exports:{}};var Py,_y={exports:{}};var qy,$y={exports:{}};function eZ(){return qy?$y.exports:(qy=1,$y.exports=(e=Np(),Up(),_p(),Gy(),Ry(),function(){var t=e,n=t.lib,g=n.WordArray,r=n.BlockCipher,i=t.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],a=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],I=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],C=i.DES=r.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var g=o[n]-1;t[n]=e[g>>>5]>>>31-g%32&1}for(var r=this._subKeys=[],i=0;i<16;i++){var I=r[i]=[],l=a[i];for(n=0;n<24;n++)I[n/6|0]|=t[(s[n]-1+l)%28]<<31-n%6,I[4+(n/6|0)]|=t[28+(s[n+24]-1+l)%28]<<31-n%6;for(I[0]=I[0]<<1|I[0]>>>31,n=1;n<7;n++)I[n]=I[n]>>>4*(n-1)+3;I[7]=I[7]<<5|I[7]>>>27}var C=this._invSubKeys=[];for(n=0;n<16;n++)C[n]=r[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],c.call(this,4,252645135),c.call(this,16,65535),d.call(this,2,858993459),d.call(this,8,16711935),c.call(this,1,1431655765);for(var g=0;g<16;g++){for(var r=n[g],i=this._lBlock,o=this._rBlock,s=0,a=0;a<8;a++)s|=I[a][((o^r[a])&l[a])>>>0];this._lBlock=o,this._rBlock=i^s}var C=this._lBlock;this._lBlock=this._rBlock,this._rBlock=C,c.call(this,1,1431655765),d.call(this,8,16711935),d.call(this,2,858993459),c.call(this,16,65535),c.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function c(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function d(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}t.DES=r._createHelper(C);var u=i.TripleDES=r.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),n=e.length<4?e.slice(0,2):e.slice(2,4),r=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=C.createEncryptor(g.create(t)),this._des2=C.createEncryptor(g.create(n)),this._des3=C.createEncryptor(g.create(r))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});t.TripleDES=r._createHelper(u)}(),e.TripleDES));var e}var tZ,nZ={exports:{}};var gZ,rZ={exports:{}};var iZ,oZ={exports:{}};var sZ,aZ,IZ,lZ,CZ,cZ,dZ,uZ={exports:{}};function AZ(){return sZ||(sZ=1,uZ.exports=(e=Np(),Up(),_p(),Gy(),Ry(),function(){var t=e,n=t.lib.BlockCipher,g=t.algo;const r=16,i=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],o=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var s={pbox:[],sbox:[]};function a(e,t){let n=t>>24&255,g=t>>16&255,r=t>>8&255,i=255&t,o=e.sbox[0][n]+e.sbox[1][g];return o^=e.sbox[2][r],o+=e.sbox[3][i],o}function I(e,t,n){let g,i=t,o=n;for(let s=0;s<r;++s)i^=e.pbox[s],o=a(e,i)^o,g=i,i=o,o=g;return g=i,i=o,o=g,o^=e.pbox[r],i^=e.pbox[r+1],{left:i,right:o}}function l(e,t,n){let g,i=t,o=n;for(let s=r+1;s>1;--s)i^=e.pbox[s],o=a(e,i)^o,g=i,i=o,o=g;return g=i,i=o,o=g,o^=e.pbox[1],i^=e.pbox[0],{left:i,right:o}}function C(e,t,n){for(let r=0;r<4;r++){e.sbox[r]=[];for(let t=0;t<256;t++)e.sbox[r][t]=o[r][t]}let g=0;for(let o=0;o<r+2;o++)e.pbox[o]=i[o]^t[g],g++,g>=n&&(g=0);let s=0,a=0,l=0;for(let i=0;i<r+2;i+=2)l=I(e,s,a),s=l.left,a=l.right,e.pbox[i]=s,e.pbox[i+1]=a;for(let r=0;r<4;r++)for(let t=0;t<256;t+=2)l=I(e,s,a),s=l.left,a=l.right,e.sbox[r][t]=s,e.sbox[r][t+1]=a;return!0}var c=g.Blowfish=n.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4;C(s,t,n)}},encryptBlock:function(e,t){var n=I(s,e[t],e[t+1]);e[t]=n.left,e[t+1]=n.right},decryptBlock:function(e,t){var n=l(s,e[t],e[t+1]);e[t]=n.left,e[t+1]=n.right},blockSize:2,keySize:4,ivSize:2});t.Blowfish=n._createHelper(c)}(),e.Blowfish)),uZ.exports;var e}wp.exports=function(e){return e}(Np(),Ep(),xp(),Mp(),Up(),Op(),_p(),ey(),gy(),ry||(ry=1,iy.exports=(dZ=Np(),gy(),IZ=(aZ=dZ).lib.WordArray,lZ=aZ.algo,CZ=lZ.SHA256,cZ=lZ.SHA224=CZ.extend({_doReset:function(){this._hash=new IZ.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=CZ._doFinalize.call(this);return e.sigBytes-=4,e}}),aZ.SHA224=CZ._createHelper(cZ),aZ.HmacSHA224=CZ._createHmacHelper(cZ),dZ.SHA224)),ay(),function(){return Iy?ly.exports:(Iy=1,ly.exports=(s=Np(),Ep(),ay(),t=(e=s).x64,n=t.Word,g=t.WordArray,r=e.algo,i=r.SHA512,o=r.SHA384=i.extend({_doReset:function(){this._hash=new g.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var e=i._doFinalize.call(this);return e.sigBytes-=16,e}}),e.SHA384=i._createHelper(o),e.HmacSHA384=i._createHmacHelper(o),s.SHA384));var e,t,n,g,r,i,o,s}(),dy(),function(){return uy?Ay.exports:(uy=1,Ay.exports=(e=Np(),
/** @preserve
      			(c) 2012 by Cédric Mesnil. All rights reserved.
      
      			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
      
      			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
      			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
      
      			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
      			*/
function(){var t=e,n=t.lib,g=n.WordArray,r=n.Hasher,i=t.algo,o=g.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),s=g.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),a=g.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),I=g.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),l=g.create([0,1518500249,1859775393,2400959708,2840853838]),C=g.create([1352829926,1548603684,1836072691,2053994217,0]),c=i.RIPEMD160=r.extend({_doReset:function(){this._hash=g.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var g=t+n,r=e[g];e[g]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var i,c,p,y,Z,f,G,B,S,R,v,V=this._hash.words,w=l.words,W=C.words,k=o.words,X=s.words,N=a.words,J=I.words;for(f=i=V[0],G=c=V[1],B=p=V[2],S=y=V[3],R=Z=V[4],n=0;n<80;n+=1)v=i+e[t+k[n]]|0,v+=n<16?d(c,p,y)+w[0]:n<32?u(c,p,y)+w[1]:n<48?A(c,p,y)+w[2]:n<64?h(c,p,y)+w[3]:m(c,p,y)+w[4],v=(v=b(v|=0,N[n]))+Z|0,i=Z,Z=y,y=b(p,10),p=c,c=v,v=f+e[t+X[n]]|0,v+=n<16?m(G,B,S)+W[0]:n<32?h(G,B,S)+W[1]:n<48?A(G,B,S)+W[2]:n<64?u(G,B,S)+W[3]:d(G,B,S)+W[4],v=(v=b(v|=0,J[n]))+R|0,f=R,R=S,S=b(B,10),B=G,G=v;v=V[1]+p+S|0,V[1]=V[2]+y+R|0,V[2]=V[3]+Z+f|0,V[3]=V[4]+i+G|0,V[4]=V[0]+c+B|0,V[0]=v},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,g=8*e.sigBytes;t[g>>>5]|=128<<24-g%32,t[14+(g+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var r=this._hash,i=r.words,o=0;o<5;o++){var s=i[o];i[o]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return r},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function d(e,t,n){return e^t^n}function u(e,t,n){return e&t|~e&n}function A(e,t,n){return(e|~t)^n}function h(e,t,n){return e&n|t&~n}function m(e,t,n){return e^(t|~n)}function b(e,t){return e<<t|e>>>32-t}t.RIPEMD160=r._createHelper(c),t.HmacRIPEMD160=r._createHmacHelper(c)}(),e.RIPEMD160));var e}(),by(),function(){return py?yy.exports:(py=1,yy.exports=(a=Np(),gy(),by(),t=(e=a).lib,n=t.Base,g=t.WordArray,r=e.algo,i=r.SHA256,o=r.HMAC,s=r.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:i,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=o.create(n.hasher,e),i=g.create(),s=g.create([1]),a=i.words,I=s.words,l=n.keySize,C=n.iterations;a.length<l;){var c=r.update(t).finalize(s);r.reset();for(var d=c.words,u=d.length,A=c,h=1;h<C;h++){A=r.finalize(A),r.reset();for(var m=A.words,b=0;b<u;b++)d[b]^=m[b]}i.concat(c),I[0]++}return i.sigBytes=4*l,i}}),e.PBKDF2=function(e,t,n){return s.create(n).compute(e,t)},a.PBKDF2));var e,t,n,g,r,i,o,s,a}(),Gy(),Ry(),function(){return vy?Vy.exports:(vy=1,Vy.exports=(e=Np(),Ry(),e.mode.CFB=function(){var t=e.lib.BlockCipherMode.extend();function n(e,t,n,g){var r,i=this._iv;i?(r=i.slice(0),this._iv=void 0):r=this._prevBlock,g.encryptBlock(r,0);for(var o=0;o<n;o++)e[t+o]^=r[o]}return t.Encryptor=t.extend({processBlock:function(e,t){var g=this._cipher,r=g.blockSize;n.call(this,e,t,r,g),this._prevBlock=e.slice(t,t+r)}}),t.Decryptor=t.extend({processBlock:function(e,t){var g=this._cipher,r=g.blockSize,i=e.slice(t,t+r);n.call(this,e,t,r,g),this._prevBlock=i}}),t}(),e.mode.CFB));var e}(),function(){return wy?Wy.exports:(wy=1,Wy.exports=(n=Np(),Ry(),n.mode.CTR=(e=n.lib.BlockCipherMode.extend(),t=e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,g=n.blockSize,r=this._iv,i=this._counter;r&&(i=this._counter=r.slice(0),this._iv=void 0);var o=i.slice(0);n.encryptBlock(o,0),i[g-1]=i[g-1]+1|0;for(var s=0;s<g;s++)e[t+s]^=o[s]}}),e.Decryptor=t,e),n.mode.CTR));var e,t,n}(),Ny(),function(){return Jy?Yy.exports:(Jy=1,Yy.exports=(n=Np(),Ry(),n.mode.OFB=(e=n.lib.BlockCipherMode.extend(),t=e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,g=n.blockSize,r=this._iv,i=this._keystream;r&&(i=this._keystream=r.slice(0),this._iv=void 0),n.encryptBlock(i,0);for(var o=0;o<g;o++)e[t+o]^=i[o]}}),e.Decryptor=t,e),n.mode.OFB));var e,t,n}(),function(){return Ey?Hy.exports:(Ey=1,Hy.exports=(t=Np(),Ry(),t.mode.ECB=((e=t.lib.BlockCipherMode.extend()).Encryptor=e.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),e.Decryptor=e.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),e),t.mode.ECB));var e,t}(),function(){return Fy?xy.exports:(Fy=1,xy.exports=(e=Np(),Ry(),e.pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,g=4*t,r=g-n%g,i=n+r-1;e.clamp(),e.words[i>>>2]|=r<<24-i%4*8,e.sigBytes+=r},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Ansix923));var e}(),function(){return Ty?Ky.exports:(Ty=1,Ky.exports=(e=Np(),Ry(),e.pad.Iso10126={pad:function(t,n){var g=4*n,r=g-t.sigBytes%g;t.concat(e.lib.WordArray.random(r-1)).concat(e.lib.WordArray.create([r<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Iso10126));var e}(),function(){return My?Dy.exports:(My=1,Dy.exports=(e=Np(),Ry(),e.pad.Iso97971={pad:function(t,n){t.concat(e.lib.WordArray.create([2147483648],1)),e.pad.ZeroPadding.pad(t,n)},unpad:function(t){e.pad.ZeroPadding.unpad(t),t.sigBytes--}},e.pad.Iso97971));var e}(),function(){return Ly?Uy.exports:(Ly=1,Uy.exports=(e=Np(),Ry(),e.pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){var t=e.words,n=e.sigBytes-1;for(n=e.sigBytes-1;n>=0;n--)if(t[n>>>2]>>>24-n%4*8&255){e.sigBytes=n+1;break}}},e.pad.ZeroPadding));var e}(),function(){return zy?Qy.exports:(zy=1,Qy.exports=(e=Np(),Ry(),e.pad.NoPadding={pad:function(){},unpad:function(){}},e.pad.NoPadding));var e}(),function(){return Oy?jy.exports:(Oy=1,jy.exports=(g=Np(),Ry(),t=(e=g).lib.CipherParams,n=e.enc.Hex,e.format.Hex={stringify:function(e){return e.ciphertext.toString(n)},parse:function(e){var g=n.parse(e);return t.create({ciphertext:g})}},g.format.Hex));var e,t,n,g}(),function(){return Py||(Py=1,_y.exports=(e=Np(),Up(),_p(),Gy(),Ry(),function(){var t=e,n=t.lib.BlockCipher,g=t.algo,r=[],i=[],o=[],s=[],a=[],I=[],l=[],C=[],c=[],d=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,g=0;for(t=0;t<256;t++){var u=g^g<<1^g<<2^g<<3^g<<4;u=u>>>8^255&u^99,r[n]=u,i[u]=n;var A=e[n],h=e[A],m=e[h],b=257*e[u]^16843008*u;o[n]=b<<24|b>>>8,s[n]=b<<16|b>>>16,a[n]=b<<8|b>>>24,I[n]=b,b=16843009*m^65537*h^257*A^16843008*n,l[u]=b<<24|b>>>8,C[u]=b<<16|b>>>16,c[u]=b<<8|b>>>24,d[u]=b,n?(n=A^e[e[e[m^A]]],g^=e[e[g]]):n=g=1}}();var u=[0,1,2,4,8,16,32,64,128,27,54],A=g.AES=n.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,g=4*((this._nRounds=n+6)+1),i=this._keySchedule=[],o=0;o<g;o++)o<n?i[o]=t[o]:(I=i[o-1],o%n?n>6&&o%n==4&&(I=r[I>>>24]<<24|r[I>>>16&255]<<16|r[I>>>8&255]<<8|r[255&I]):(I=r[(I=I<<8|I>>>24)>>>24]<<24|r[I>>>16&255]<<16|r[I>>>8&255]<<8|r[255&I],I^=u[o/n|0]<<24),i[o]=i[o-n]^I);for(var s=this._invKeySchedule=[],a=0;a<g;a++){if(o=g-a,a%4)var I=i[o];else I=i[o-4];s[a]=a<4||o<=4?I:l[r[I>>>24]]^C[r[I>>>16&255]]^c[r[I>>>8&255]]^d[r[255&I]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,s,a,I,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,C,c,d,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,g,r,i,o,s){for(var a=this._nRounds,I=e[t]^n[0],l=e[t+1]^n[1],C=e[t+2]^n[2],c=e[t+3]^n[3],d=4,u=1;u<a;u++){var A=g[I>>>24]^r[l>>>16&255]^i[C>>>8&255]^o[255&c]^n[d++],h=g[l>>>24]^r[C>>>16&255]^i[c>>>8&255]^o[255&I]^n[d++],m=g[C>>>24]^r[c>>>16&255]^i[I>>>8&255]^o[255&l]^n[d++],b=g[c>>>24]^r[I>>>16&255]^i[l>>>8&255]^o[255&C]^n[d++];I=A,l=h,C=m,c=b}A=(s[I>>>24]<<24|s[l>>>16&255]<<16|s[C>>>8&255]<<8|s[255&c])^n[d++],h=(s[l>>>24]<<24|s[C>>>16&255]<<16|s[c>>>8&255]<<8|s[255&I])^n[d++],m=(s[C>>>24]<<24|s[c>>>16&255]<<16|s[I>>>8&255]<<8|s[255&l])^n[d++],b=(s[c>>>24]<<24|s[I>>>16&255]<<16|s[l>>>8&255]<<8|s[255&C])^n[d++],e[t]=A,e[t+1]=h,e[t+2]=m,e[t+3]=b},keySize:8});t.AES=n._createHelper(A)}(),e.AES)),_y.exports;var e}(),eZ(),function(){return tZ||(tZ=1,nZ.exports=(e=Np(),Up(),_p(),Gy(),Ry(),function(){var t=e,n=t.lib.StreamCipher,g=t.algo,r=g.RC4=n.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,g=this._S=[],r=0;r<256;r++)g[r]=r;r=0;for(var i=0;r<256;r++){var o=r%n,s=t[o>>>2]>>>24-o%4*8&255;i=(i+g[r]+s)%256;var a=g[r];g[r]=g[i],g[i]=a}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=i.call(this)},keySize:8,ivSize:0});function i(){for(var e=this._S,t=this._i,n=this._j,g=0,r=0;r<4;r++){n=(n+e[t=(t+1)%256])%256;var i=e[t];e[t]=e[n],e[n]=i,g|=e[(e[t]+e[n])%256]<<24-8*r}return this._i=t,this._j=n,g}t.RC4=n._createHelper(r);var o=g.RC4Drop=r.extend({cfg:r.cfg.extend({drop:192}),_doReset:function(){r._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)i.call(this)}});t.RC4Drop=n._createHelper(o)}(),e.RC4)),nZ.exports;var e}(),function(){return gZ?rZ.exports:(gZ=1,rZ.exports=(e=Np(),Up(),_p(),Gy(),Ry(),function(){var t=e,n=t.lib.StreamCipher,g=t.algo,r=[],i=[],o=[],s=g.Rabbit=n.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var g=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)a.call(this);for(n=0;n<8;n++)r[n]^=g[n+4&7];if(t){var i=t.words,o=i[0],s=i[1],I=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),C=I>>>16|4294901760&l,c=l<<16|65535&I;for(r[0]^=I,r[1]^=C,r[2]^=l,r[3]^=c,r[4]^=I,r[5]^=C,r[6]^=l,r[7]^=c,n=0;n<4;n++)a.call(this)}},_doProcessBlock:function(e,t){var n=this._X;a.call(this),r[0]=n[0]^n[5]>>>16^n[3]<<16,r[1]=n[2]^n[7]>>>16^n[5]<<16,r[2]=n[4]^n[1]>>>16^n[7]<<16,r[3]=n[6]^n[3]>>>16^n[1]<<16;for(var g=0;g<4;g++)r[g]=16711935&(r[g]<<8|r[g]>>>24)|4278255360&(r[g]<<24|r[g]>>>8),e[t+g]^=r[g]},blockSize:4,ivSize:2});function a(){for(var e=this._X,t=this._C,n=0;n<8;n++)i[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,n=0;n<8;n++){var g=e[n]+t[n],r=65535&g,s=g>>>16,a=((r*r>>>17)+r*s>>>15)+s*s,I=((4294901760&g)*g|0)+((65535&g)*g|0);o[n]=a^I}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}t.Rabbit=n._createHelper(s)}(),e.Rabbit));var e}(),function(){return iZ?oZ.exports:(iZ=1,oZ.exports=(e=Np(),Up(),_p(),Gy(),Ry(),function(){var t=e,n=t.lib.StreamCipher,g=t.algo,r=[],i=[],o=[],s=g.RabbitLegacy=n.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],g=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var r=0;r<4;r++)a.call(this);for(r=0;r<8;r++)g[r]^=n[r+4&7];if(t){var i=t.words,o=i[0],s=i[1],I=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),l=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),C=I>>>16|4294901760&l,c=l<<16|65535&I;for(g[0]^=I,g[1]^=C,g[2]^=l,g[3]^=c,g[4]^=I,g[5]^=C,g[6]^=l,g[7]^=c,r=0;r<4;r++)a.call(this)}},_doProcessBlock:function(e,t){var n=this._X;a.call(this),r[0]=n[0]^n[5]>>>16^n[3]<<16,r[1]=n[2]^n[7]>>>16^n[5]<<16,r[2]=n[4]^n[1]>>>16^n[7]<<16,r[3]=n[6]^n[3]>>>16^n[1]<<16;for(var g=0;g<4;g++)r[g]=16711935&(r[g]<<8|r[g]>>>24)|4278255360&(r[g]<<24|r[g]>>>8),e[t+g]^=r[g]},blockSize:4,ivSize:2});function a(){for(var e=this._X,t=this._C,n=0;n<8;n++)i[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,n=0;n<8;n++){var g=e[n]+t[n],r=65535&g,s=g>>>16,a=((r*r>>>17)+r*s>>>15)+s*s,I=((4294901760&g)*g|0)+((65535&g)*g|0);o[n]=a^I}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}t.RabbitLegacy=n._createHelper(s)}(),e.RabbitLegacy));var e}(),AZ());const hZ=g(wp.exports),mZ=(e="")=>hZ.SHA256(`mariage_app_security_${e}`).toString(),bZ="+243844270288",pZ=e=>e===bZ,yZ=e=>((e,t=null)=>{try{const n=t||mZ("admin"),g="string"==typeof e?e:JSON.stringify(e);return hZ.AES.encrypt(g,n).toString()}catch(Vye){return JSON.stringify(e)}})(e),ZZ=e=>((e,t=null)=>{try{if(0===e.indexOf("{"))return JSON.parse(e);const n=t||mZ("admin"),g=hZ.AES.decrypt(e,n).toString(hZ.enc.Utf8);if(!g)throw new Error("Décryptage a produit une chaîne vide");return JSON.parse(g)}catch(Vye){try{return JSON.parse(e)}catch{return null}}})(e),fZ=()=>{const[t,n]=e.useState(""),[g,r]=e.useState(!1),[i,o]=e.useState(0),[s,a]=e.useState(!1),I=de();e.useEffect((()=>{const e=localStorage.getItem("adminAuth");if(e)try{const t=ZZ?ZZ(e):JSON.parse(e);if(t){const{isAuthenticated:e,timestamp:n}=t,g=Date.now();e&&g-n<864e5&&I("/admin")}}catch(n){localStorage.removeItem("adminAuth")}const t=localStorage.getItem("authBlocked");if(t){const e=3e5,n=Date.now()-parseInt(t,10);if(n<e){const t=Math.ceil((e-n)/6e4);r(`Trop de tentatives incorrectes. Veuillez réessayer dans ${t} minute(s).`),a(!0)}else localStorage.removeItem("authBlocked")}}),[I]);return p.jsx("div",{className:"min-h-screen flex items-center justify-center bg-secondary p-4",children:p.jsxs("div",{className:"glass-card p-8 rounded-xl max-w-md w-full",children:[p.jsx("h1",{className:"font-elegant text-3xl text-primary-dark mb-6 text-center",children:"Espace Administrateur"}),g&&p.jsx("div",{className:"mb-6 p-3 bg-red-100 border-l-4 border-red-500 text-red-700 rounded",children:g}),p.jsxs("form",{onSubmit:e=>{e.preventDefault(),a(!0),setTimeout((()=>{if(pZ(t)){const e={isAuthenticated:!0,timestamp:Date.now()},t=yZ?yZ(e):JSON.stringify(e);localStorage.setItem("adminAuth",t),I("/admin")}else{const e=i+1;o(e),e>=5?(r("Trop de tentatives incorrectes. Veuillez réessayer dans 5 minutes."),localStorage.setItem("authBlocked",Date.now().toString()),setTimeout((()=>{I("/")}),2e3)):r(`Mot de passe incorrect. Tentative ${e}/5.`),n(""),a(!1)}}),1e3)},className:"space-y-6",children:[p.jsxs("div",{children:[p.jsx("label",{htmlFor:"password",className:"block mb-2 text-sm font-medium text-primary-dark",children:"Mot de passe"}),p.jsx("input",{type:"password",id:"password",value:t,onChange:e=>n(e.target.value),className:"w-full p-3 border border-primary/20 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent outline-none",placeholder:"Entrez le mot de passe administrateur",autoComplete:"off",disabled:s,required:!0}),p.jsx("p",{className:"mt-1 text-xs text-muted",children:"Ce mot de passe n'est pas stocké dans votre navigateur"})]}),p.jsx("button",{type:"submit",className:"w-full px-6 py-3 bg-primary text-white rounded-lg shadow-elegant hover:bg-primary-dark transition-all transform hover:-translate-y-1 "+(s?"opacity-70 cursor-not-allowed":""),disabled:s,children:s?p.jsxs("span",{className:"flex items-center justify-center",children:[p.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[p.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),p.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Vérification..."]}):"Se connecter"})]}),p.jsx("div",{className:"mt-8 text-center",children:p.jsx("a",{href:"/",className:"text-primary hover:text-primary-dark transition-colors",children:"Retour à l'accueil"})})]})})};function GZ(){return GZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var g in n)({}).hasOwnProperty.call(n,g)&&(e[g]=n[g])}return e},GZ.apply(null,arguments)}function BZ(e){return(BZ="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function SZ(e){var t=function(e,t){if("object"!=BZ(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var g=n.call(e,t);if("object"!=BZ(g))return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==BZ(t)?t:t+""}function RZ(e,t,n){return(t=SZ(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vZ(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,g=Array(t);n<t;n++)g[n]=e[n];return g}function VZ(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var g,r,i,o,s=[],a=!0,I=!1;try{if(i=(n=n.call(e)).next,0===t);else for(;!(a=(g=i.call(n)).done)&&(s.push(g.value),s.length!==t);a=!0);}catch(l){I=!0,r=l}finally{try{if(!a&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(I)throw r}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return vZ(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vZ(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var wZ={exports:{}},WZ={},kZ="function"==typeof Symbol&&Symbol.for,XZ=kZ?Symbol.for("react.element"):60103,NZ=kZ?Symbol.for("react.portal"):60106,JZ=kZ?Symbol.for("react.fragment"):60107,YZ=kZ?Symbol.for("react.strict_mode"):60108,EZ=kZ?Symbol.for("react.profiler"):60114,HZ=kZ?Symbol.for("react.provider"):60109,FZ=kZ?Symbol.for("react.context"):60110,xZ=kZ?Symbol.for("react.async_mode"):60111,TZ=kZ?Symbol.for("react.concurrent_mode"):60111,KZ=kZ?Symbol.for("react.forward_ref"):60112,MZ=kZ?Symbol.for("react.suspense"):60113,DZ=kZ?Symbol.for("react.suspense_list"):60120,LZ=kZ?Symbol.for("react.memo"):60115,UZ=kZ?Symbol.for("react.lazy"):60116,zZ=kZ?Symbol.for("react.block"):60121,QZ=kZ?Symbol.for("react.fundamental"):60117,OZ=kZ?Symbol.for("react.responder"):60118,jZ=kZ?Symbol.for("react.scope"):60119;function PZ(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case XZ:switch(e=e.type){case xZ:case TZ:case JZ:case EZ:case YZ:case MZ:return e;default:switch(e=e&&e.$$typeof){case FZ:case KZ:case UZ:case LZ:case HZ:return e;default:return t}}case NZ:return t}}}function _Z(e){return PZ(e)===TZ}WZ.AsyncMode=xZ,WZ.ConcurrentMode=TZ,WZ.ContextConsumer=FZ,WZ.ContextProvider=HZ,WZ.Element=XZ,WZ.ForwardRef=KZ,WZ.Fragment=JZ,WZ.Lazy=UZ,WZ.Memo=LZ,WZ.Portal=NZ,WZ.Profiler=EZ,WZ.StrictMode=YZ,WZ.Suspense=MZ,WZ.isAsyncMode=function(e){return _Z(e)||PZ(e)===xZ},WZ.isConcurrentMode=_Z,WZ.isContextConsumer=function(e){return PZ(e)===FZ},WZ.isContextProvider=function(e){return PZ(e)===HZ},WZ.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===XZ},WZ.isForwardRef=function(e){return PZ(e)===KZ},WZ.isFragment=function(e){return PZ(e)===JZ},WZ.isLazy=function(e){return PZ(e)===UZ},WZ.isMemo=function(e){return PZ(e)===LZ},WZ.isPortal=function(e){return PZ(e)===NZ},WZ.isProfiler=function(e){return PZ(e)===EZ},WZ.isStrictMode=function(e){return PZ(e)===YZ},WZ.isSuspense=function(e){return PZ(e)===MZ},WZ.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===JZ||e===TZ||e===EZ||e===YZ||e===MZ||e===DZ||"object"==typeof e&&null!==e&&(e.$$typeof===UZ||e.$$typeof===LZ||e.$$typeof===HZ||e.$$typeof===FZ||e.$$typeof===KZ||e.$$typeof===QZ||e.$$typeof===OZ||e.$$typeof===jZ||e.$$typeof===zZ)},WZ.typeOf=PZ;
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;!function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var g={};return"abcdefghijklmnopqrst".split("").forEach((function(e){g[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},g)).join("")}catch(r){return!1}}()||Object.assign;Function.call.bind(Object.prototype.hasOwnProperty);function qZ(){}function $Z(){}$Z.resetWarningCache=qZ;wZ.exports=function(){function e(e,t,n,g,r,i){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==i){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:$Z,resetWarningCache:qZ};return n.PropTypes=n,n}();var ef=wZ.exports;function tf(e,t,n){var g=function(e){return atob(e)}(e),r=g.indexOf("\n",10)+1,i=g.substring(r)+"",o=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(o)}var nf,gf,rf=(nf="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewoJJ3VzZSBzdHJpY3QnOwoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGdldEF1Z21lbnRlZE5hbWVzcGFjZShuKSB7CgkJaWYgKG4uX19lc01vZHVsZSkgcmV0dXJuIG47CgkJdmFyIGEgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdfX2VzTW9kdWxlJywge3ZhbHVlOiB0cnVlfSk7CgkJT2JqZWN0LmtleXMobikuZm9yRWFjaChmdW5jdGlvbiAoaykgewoJCQl2YXIgZCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobiwgayk7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBrLCBkLmdldCA/IGQgOiB7CgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuIG5ba107CgkJCQl9CgkJCX0pOwoJCX0pOwoJCXJldHVybiBhOwoJfQoKCXZhciBCaW5hcnlCaXRtYXAkMSA9IHt9OwoKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBFeGNlcHRpb24kMSA9IHt9OwoKCWZ1bmN0aW9uIGZpeFByb3RvKHRhcmdldCwgcHJvdG90eXBlKSB7CgkgIHZhciBzZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZjsKCSAgc2V0UHJvdG90eXBlT2YgPyBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvdHlwZSkgOiB0YXJnZXQuX19wcm90b19fID0gcHJvdG90eXBlOwoJfQoJZnVuY3Rpb24gZml4U3RhY2sodGFyZ2V0LCBmbikgewoJICBpZiAoZm4gPT09IHZvaWQgMCkgewoJICAgIGZuID0gdGFyZ2V0LmNvbnN0cnVjdG9yOwoJICB9CgoJICB2YXIgY2FwdHVyZVN0YWNrVHJhY2UgPSBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZTsKCSAgY2FwdHVyZVN0YWNrVHJhY2UgJiYgY2FwdHVyZVN0YWNrVHJhY2UodGFyZ2V0LCBmbik7Cgl9CgoJdmFyIF9fZXh0ZW5kcyRrID0gZnVuY3Rpb24gKCkgewoJICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCB7CgkgICAgICBfX3Byb3RvX186IFtdCgkgICAgfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICBkLl9fcHJvdG9fXyA9IGI7CgkgICAgfSB8fCBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgZm9yICh2YXIgcCBpbiBiKSB7IGlmIChiLmhhc093blByb3BlcnR5KHApKSB7IGRbcF0gPSBiW3BdOyB9IH0KCSAgICB9OwoKCSAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgfTsKCgkgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgoJICAgIGZ1bmN0aW9uIF9fKCkgewoJICAgICAgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7CgkgICAgfQoKCSAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgIH07Cgl9KCk7CgoJdmFyIEN1c3RvbUVycm9yID0gZnVuY3Rpb24gKF9zdXBlcikgewoJICBfX2V4dGVuZHMkayhDdXN0b21FcnJvciwgX3N1cGVyKTsKCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKG1lc3NhZ2UpIHsKCSAgICB2YXIgX25ld1RhcmdldCA9IHRoaXMuY29uc3RydWN0b3I7CgoJICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG1lc3NhZ2UpIHx8IHRoaXM7CgoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfdGhpcywgJ25hbWUnLCB7CgkgICAgICB2YWx1ZTogX25ld1RhcmdldC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmaXhQcm90byhfdGhpcywgX25ld1RhcmdldC5wcm90b3R5cGUpOwoJICAgIGZpeFN0YWNrKF90aGlzKTsKCSAgICByZXR1cm4gX3RoaXM7CgkgIH0KCgkgIHJldHVybiBDdXN0b21FcnJvcjsKCX0oRXJyb3IpOwoKCXZhciBfX3NwcmVhZEFycmF5cyA9IGZ1bmN0aW9uICgpIHsKCSAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwoKCSAgZm9yICh2YXIgcyA9IDAsIGkgPSAwLCBpbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBpbDsgaSsrKSB7IHMgKz0gYXJndW1lbnRzJDFbaV0ubGVuZ3RoOyB9CgoJICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspIHsgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspIHsgcltrXSA9IGFbal07IH0gfQoKCSAgcmV0dXJuIHI7Cgl9OwoJZnVuY3Rpb24gY3VzdG9tRXJyb3JGYWN0b3J5KGZuLCBwYXJlbnQpIHsKCSAgaWYgKHBhcmVudCA9PT0gdm9pZCAwKSB7CgkgICAgcGFyZW50ID0gRXJyb3I7CgkgIH0KCgkgIGZ1bmN0aW9uIEN1c3RvbUVycm9yKCkgewoJICAgIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKCgkgICAgdmFyIGFyZ3MgPSBbXTsKCgkgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzJDFbX2ldOwoJICAgIH0KCgkgICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEN1c3RvbUVycm9yKSkgeyByZXR1cm4gbmV3IChDdXN0b21FcnJvci5iaW5kLmFwcGx5KEN1c3RvbUVycm9yLCBfX3NwcmVhZEFycmF5cyhbdm9pZCAwXSwgYXJncykpKSgpOyB9CgkgICAgcGFyZW50LmFwcGx5KHRoaXMsIGFyZ3MpOwoJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnbmFtZScsIHsKCSAgICAgIHZhbHVlOiBmbi5uYW1lIHx8IHBhcmVudC5uYW1lLAoJICAgICAgZW51bWVyYWJsZTogZmFsc2UsCgkgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICB9KTsKCSAgICBmbi5hcHBseSh0aGlzLCBhcmdzKTsKCSAgICBmaXhTdGFjayh0aGlzLCBDdXN0b21FcnJvcik7CgkgIH0KCgkgIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhDdXN0b21FcnJvciwgewoJICAgIHByb3RvdHlwZTogewoJICAgICAgdmFsdWU6IE9iamVjdC5jcmVhdGUocGFyZW50LnByb3RvdHlwZSwgewoJICAgICAgICBjb25zdHJ1Y3RvcjogewoJICAgICAgICAgIHZhbHVlOiBDdXN0b21FcnJvciwKCSAgICAgICAgICB3cml0YWJsZTogdHJ1ZSwKCSAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKCSAgICAgICAgfQoJICAgICAgfSkKCSAgICB9CgkgIH0pOwoJfQoKCXZhciBjdXN0b21FcnJvciA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCQlfX3Byb3RvX186IG51bGwsCgkJQ3VzdG9tRXJyb3I6IEN1c3RvbUVycm9yLAoJCWN1c3RvbUVycm9yRmFjdG9yeTogY3VzdG9tRXJyb3JGYWN0b3J5Cgl9KTsKCgl2YXIgcmVxdWlyZSQkMCA9IC8qQF9fUFVSRV9fKi9nZXRBdWdtZW50ZWROYW1lc3BhY2UoY3VzdG9tRXJyb3IpOwoKCXZhciBfX2V4dGVuZHMkaiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIHRzX2N1c3RvbV9lcnJvcl8xID0gcmVxdWlyZSQkMDsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRqKEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICAvKioKCSAgICAgKiBBbGxvd3MgRXhjZXB0aW9uIHRvIGJlIGNvbnN0cnVjdGVkIGRpcmVjdGx5CgkgICAgICogd2l0aCBzb21lIG1lc3NhZ2UgYW5kIHByb3RvdHlwZSBkZWZpbml0aW9uLgoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEV4Y2VwdGlvbihtZXNzYWdlKSB7CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBFeGNlcHRpb24ucHJvdG90eXBlLmdldEtpbmQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBleCA9IHRoaXMuY29uc3RydWN0b3I7CgkgICAgICAgIHJldHVybiBleC5raW5kOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSXQncyB0eXBlZCBhcyBzdHJpbmcgc28gaXQgY2FuIGJlIGV4dGVuZGVkIGFuZCBvdmVycmlkZW4uCgkgICAgICovCgkgICAgRXhjZXB0aW9uLmtpbmQgPSAnRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRXhjZXB0aW9uOwoJfSh0c19jdXN0b21fZXJyb3JfMS5DdXN0b21FcnJvcikpOwoJRXhjZXB0aW9uJDEuZGVmYXVsdCA9IEV4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSQ5ID0gRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaShJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCkgewoJICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7CgkgICAgfQoJICAgIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0lsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbjsKCX0oRXhjZXB0aW9uXzEkOS5kZWZhdWx0KSk7CglJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMS5kZWZhdWx0ID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJ5Qml0bWFwJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgQmluYXJ5Qml0bWFwID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEJpbmFyeUJpdG1hcChiaW5hcml6ZXIpIHsKCSAgICAgICAgdGhpcy5iaW5hcml6ZXIgPSBiaW5hcml6ZXI7CgkgICAgICAgIGlmIChiaW5hcml6ZXIgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSRhLmRlZmF1bHQoJ0JpbmFyaXplciBtdXN0IGJlIG5vbi1udWxsLicpOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gVGhlIHdpZHRoIG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIGJpdG1hcC4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29udmVydHMgb25lIHJvdyBvZiBsdW1pbmFuY2UgZGF0YSB0byAxIGJpdCBkYXRhLiBNYXkgYWN0dWFsbHkgZG8gdGhlIGNvbnZlcnNpb24sIG9yIHJldHVybgoJICAgICAqIGNhY2hlZCBkYXRhLiBDYWxsZXJzIHNob3VsZCBhc3N1bWUgdGhpcyBtZXRob2QgaXMgZXhwZW5zaXZlIGFuZCBjYWxsIGl0IGFzIHNlbGRvbSBhcyBwb3NzaWJsZS4KCSAgICAgKiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMUQgYmFyY29kZXMgYW5kIG1heSBjaG9vc2UgdG8gYXBwbHkgc2hhcnBlbmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB5IFRoZSByb3cgdG8gZmV0Y2gsIHdoaWNoIG11c3QgYmUgaW4gWzAsIGJpdG1hcCBoZWlnaHQpCgkgICAgICogQHBhcmFtIHJvdyBBbiBvcHRpb25hbCBwcmVhbGxvY2F0ZWQgYXJyYXkuIElmIG51bGwgb3IgdG9vIHNtYWxsLCBpdCB3aWxsIGJlIGlnbm9yZWQuCgkgICAgICogICAgICAgICAgICBJZiB1c2VkLCB0aGUgQmluYXJpemVyIHdpbGwgY2FsbCBCaXRBcnJheS5jbGVhcigpLiBBbHdheXMgdXNlIHRoZSByZXR1cm5lZCBvYmplY3QuCgkgICAgICogQHJldHVybiBUaGUgYXJyYXkgb2YgYml0cyBmb3IgdGhpcyByb3cgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgcm93IGNhbid0IGJlIGJpbmFyaXplZAoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUuZ2V0QmxhY2tSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJpemVyLmdldEJsYWNrUm93KHksIHJvdyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBhIDJEIGFycmF5IG9mIGx1bWluYW5jZSBkYXRhIHRvIDEgYml0LiBBcyBhYm92ZSwgYXNzdW1lIHRoaXMgbWV0aG9kIGlzIGV4cGVuc2l2ZQoJICAgICAqIGFuZCBkbyBub3QgY2FsbCBpdCByZXBlYXRlZGx5LiBUaGlzIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZGVjb2RpbmcgMkQgYmFyY29kZXMgYW5kIG1heSBvcgoJICAgICAqIG1heSBub3QgYXBwbHkgc2hhcnBlbmluZy4gVGhlcmVmb3JlLCBhIHJvdyBmcm9tIHRoaXMgbWF0cml4IG1heSBub3QgYmUgaWRlbnRpY2FsIHRvIG9uZQoJICAgICAqIGZldGNoZWQgdXNpbmcgZ2V0QmxhY2tSb3coKSwgc28gZG9uJ3QgbWl4IGFuZCBtYXRjaCBiZXR3ZWVuIHRoZW0uCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIFRoZSAyRCBhcnJheSBvZiBiaXRzIGZvciB0aGUgaW1hZ2UgKHRydWUgbWVhbnMgYmxhY2spLgoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgaW1hZ2UgY2FuJ3QgYmUgYmluYXJpemVkIHRvIG1ha2UgYSBtYXRyaXgKCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmdldEJsYWNrTWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBUaGUgbWF0cml4IGlzIGNyZWF0ZWQgb24gZGVtYW5kIHRoZSBmaXJzdCB0aW1lIGl0IGlzIHJlcXVlc3RlZCwgdGhlbiBjYWNoZWQuIFRoZXJlIGFyZSB0d28KCSAgICAgICAgLy8gcmVhc29ucyBmb3IgdGhpczoKCSAgICAgICAgLy8gMS4gVGhpcyB3b3JrIHdpbGwgbmV2ZXIgYmUgZG9uZSBpZiB0aGUgY2FsbGVyIG9ubHkgaW5zdGFsbHMgMUQgUmVhZGVyIG9iamVjdHMsIG9yIGlmIGEKCSAgICAgICAgLy8gICAgMUQgUmVhZGVyIGZpbmRzIGEgYmFyY29kZSBiZWZvcmUgdGhlIDJEIFJlYWRlcnMgcnVuLgoJICAgICAgICAvLyAyLiBUaGlzIHdvcmsgd2lsbCBvbmx5IGJlIGRvbmUgb25jZSBldmVuIGlmIHRoZSBjYWxsZXIgaW5zdGFsbHMgbXVsdGlwbGUgMkQgUmVhZGVycy4KCSAgICAgICAgaWYgKHRoaXMubWF0cml4ID09PSBudWxsIHx8IHRoaXMubWF0cml4ID09PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gdGhpcy5iaW5hcml6ZXIuZ2V0QmxhY2tNYXRyaXgoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5tYXRyaXg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFdoZXRoZXIgdGhpcyBiaXRtYXAgY2FuIGJlIGNyb3BwZWQuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5pc0Nyb3BTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggY3JvcHBlZCBpbWFnZSBkYXRhLiBJbXBsZW1lbnRhdGlvbnMgbWF5IGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlCgkgICAgICogb3JpZ2luYWwgZGF0YSByYXRoZXIgdGhhbiBhIGNvcHkuIE9ubHkgY2FsbGFibGUgaWYgaXNDcm9wU3VwcG9ydGVkKCkgaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBsZWZ0IFRoZSBsZWZ0IGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0V2lkdGgoKSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB0b3AgY29vcmRpbmF0ZSwgd2hpY2ggbXVzdCBiZSBpbiBbMCxnZXRIZWlnaHQoKSkKCSAgICAgKiBAcGFyYW0gd2lkdGggVGhlIHdpZHRoIG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIHJlY3RhbmdsZSB0byBjcm9wLgoJICAgICAqIEByZXR1cm4gQSBjcm9wcGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBuZXdTb3VyY2UgPSB0aGlzLmJpbmFyaXplci5nZXRMdW1pbmFuY2VTb3VyY2UoKS5jcm9wKGxlZnQsIHRvcCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIGJpdG1hcCBzdXBwb3J0cyBjb3VudGVyLWNsb2Nrd2lzZSByb3RhdGlvbi4KCSAgICAgKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLmlzUm90YXRlU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkuaXNSb3RhdGVTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgQmluYXJ5Qml0bWFwLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpOwoJICAgICAgICByZXR1cm4gbmV3IEJpbmFyeUJpdG1hcCh0aGlzLmJpbmFyaXplci5jcmVhdGVCaW5hcml6ZXIobmV3U291cmNlKSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIHJvdGF0ZWQgaW1hZ2UgZGF0YSBieSA0NSBkZWdyZWVzIGNvdW50ZXJjbG9ja3dpc2UuCgkgICAgICogT25seSBjYWxsYWJsZSBpZiB7QGxpbmsgI2lzUm90YXRlU3VwcG9ydGVkKCl9IGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIEEgcm90YXRlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEJpbmFyeUJpdG1hcC5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3U291cmNlID0gdGhpcy5iaW5hcml6ZXIuZ2V0THVtaW5hbmNlU291cmNlKCkucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCk7CgkgICAgICAgIHJldHVybiBuZXcgQmluYXJ5Qml0bWFwKHRoaXMuYmluYXJpemVyLmNyZWF0ZUJpbmFyaXplcihuZXdTb3VyY2UpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaW5hcnlCaXRtYXAucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxhY2tNYXRyaXgoKS50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlIC8qOiBOb3RGb3VuZEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICByZXR1cm4gJyc7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaW5hcnlCaXRtYXA7Cgl9KCkpOwoJdmFyIF9kZWZhdWx0JDMgPSBCaW5hcnlCaXRtYXAkMS5kZWZhdWx0ID0gQmluYXJ5Qml0bWFwOwoKCXZhciBIeWJyaWRCaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSA9IHt9OwoKCXZhciBCaW5hcml6ZXIkMSA9IHt9OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmluYXJpemVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogVGhpcyBjbGFzcyBoaWVyYXJjaHkgcHJvdmlkZXMgYSBzZXQgb2YgbWV0aG9kcyB0byBjb252ZXJ0IGx1bWluYW5jZSBkYXRhIHRvIDEgYml0IGRhdGEuCgkgKiBJdCBhbGxvd3MgdGhlIGFsZ29yaXRobSB0byB2YXJ5IHBvbHltb3JwaGljYWxseSwgZm9yIGV4YW1wbGUgYWxsb3dpbmcgYSB2ZXJ5IGV4cGVuc2l2ZQoJICogdGhyZXNob2xkaW5nIHRlY2huaXF1ZSBmb3Igc2VydmVycyBhbmQgYSBmYXN0IG9uZSBmb3IgbW9iaWxlLiBJdCBhbHNvIHBlcm1pdHMgdGhlIGltcGxlbWVudGF0aW9uCgkgKiB0byB2YXJ5LCBlLmcuIGEgSk5JIHZlcnNpb24gZm9yIEFuZHJvaWQgYW5kIGEgSmF2YSBmYWxsYmFjayB2ZXJzaW9uIGZvciBvdGhlciBwbGF0Zm9ybXMuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpbmFyaXplciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBCaW5hcml6ZXIoc291cmNlKSB7CgkgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlOwoJICAgIH0KCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEx1bWluYW5jZVNvdXJjZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlOwoJICAgIH07CgkgICAgQmluYXJpemVyLnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldFdpZHRoKCk7CgkgICAgfTsKCSAgICBCaW5hcml6ZXIucHJvdG90eXBlLmdldEhlaWdodCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc291cmNlLmdldEhlaWdodCgpOwoJICAgIH07CgkgICAgcmV0dXJuIEJpbmFyaXplcjsKCX0oKSk7CglCaW5hcml6ZXIkMS5kZWZhdWx0ID0gQmluYXJpemVyOwoKCXZhciBCaXRBcnJheSQxID0ge307CgoJdmFyIEFycmF5cyQxID0ge307CgoJdmFyIFN5c3RlbSQxID0ge307CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN5c3RlbSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIFN5c3RlbSgpIHsKCSAgICB9CgkgICAgLy8gcHVibGljIHN0YXRpYyB2b2lkIGFycmF5Y29weShPYmplY3Qgc3JjLCBpbnQgc3JjUG9zLCBPYmplY3QgZGVzdCwgaW50IGRlc3RQb3MsIGludCBsZW5ndGgpCgkgICAgLyoqCgkgICAgICogTWFrZXMgYSBjb3B5IG9mIGEgYXJyYXkuCgkgICAgICovCgkgICAgU3lzdGVtLmFycmF5Y29weSA9IGZ1bmN0aW9uIChzcmMsIHNyY1BvcywgZGVzdCwgZGVzdFBvcywgbGVuZ3RoKSB7CgkgICAgICAgIC8vIFRPRE86IGJldHRlciB1c2Ugc3BsaXQgb3Igc2V0PwoJICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKCSAgICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tzcmNQb3MrK107CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgdGltZSBpbiBtaWxsaXNlY29uZHMuCgkgICAgICovCgkgICAgU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gRGF0ZS5ub3coKTsKCSAgICB9OwoJICAgIHJldHVybiBTeXN0ZW07Cgl9KCkpOwoJU3lzdGVtJDEuZGVmYXVsdCA9IFN5c3RlbTsKCgl2YXIgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyRoID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDggPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkaChJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbi5raW5kID0gJ0luZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ4LmRlZmF1bHQpKTsKCUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbjsKCgl2YXIgX19leHRlbmRzJGcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uXzEgPSBJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uJDE7CgkvKioKCSAqIEN1c3RvbSBFcnJvciBjbGFzcyBvZiB0eXBlIEV4Y2VwdGlvbi4KCSAqLwoJdmFyIEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZyhBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKGluZGV4LCBtZXNzYWdlKSB7CgkgICAgICAgIGlmIChpbmRleCA9PT0gdm9pZCAwKSB7IGluZGV4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIGlmIChtZXNzYWdlID09PSB2b2lkIDApIHsgbWVzc2FnZSA9IHVuZGVmaW5lZDsgfQoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBtZXNzYWdlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5pbmRleCA9IGluZGV4OwoJICAgICAgICBfdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24ua2luZCA9ICdBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24nOwoJICAgIHJldHVybiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb247Cgl9KEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KSk7CglBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24kMS5kZWZhdWx0ID0gQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uOwoKCXZhciBfX3ZhbHVlcyQ3ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFycmF5cyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3lzdGVtXzEkNSA9IFN5c3RlbSQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDkgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMSA9IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiQxOwoJdmFyIEFycmF5cyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBcnJheXMoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQgYXJyYXkKCSAgICAgKiBvZiBpbnRzLgoJICAgICAqCgkgICAgICogQHBhcmFtIGEgdGhlIGFycmF5IHRvIGJlIGZpbGxlZAoJICAgICAqIEBwYXJhbSB2YWwgdGhlIHZhbHVlIHRvIGJlIHN0b3JlZCBpbiBhbGwgZWxlbWVudHMgb2YgdGhlIGFycmF5CgkgICAgICovCgkgICAgQXJyYXlzLmZpbGwgPSBmdW5jdGlvbiAoYSwgdmFsKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKQoJICAgICAgICAgICAgYVtpXSA9IHZhbDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFzc2lnbnMgdGhlIHNwZWNpZmllZCBpbnQgdmFsdWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBzcGVjaWZpZWQKCSAgICAgKiByYW5nZSBvZiB0aGUgc3BlY2lmaWVkIGFycmF5IG9mIGludHMuICBUaGUgcmFuZ2UgdG8gYmUgZmlsbGVkCgkgICAgICogZXh0ZW5kcyBmcm9tIGluZGV4IHtAY29kZSBmcm9tSW5kZXh9LCBpbmNsdXNpdmUsIHRvIGluZGV4CgkgICAgICoge0Bjb2RlIHRvSW5kZXh9LCBleGNsdXNpdmUuICAoSWYge0Bjb2RlIGZyb21JbmRleD09dG9JbmRleH0sIHRoZQoJICAgICAqIHJhbmdlIHRvIGJlIGZpbGxlZCBpcyBlbXB0eS4pCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYSB0aGUgYXJyYXkgdG8gYmUgZmlsbGVkCgkgICAgICogQHBhcmFtIGZyb21JbmRleCB0aGUgaW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgKGluY2x1c2l2ZSkgdG8gYmUKCSAgICAgKiAgICAgICAgZmlsbGVkIHdpdGggdGhlIHNwZWNpZmllZCB2YWx1ZQoJICAgICAqIEBwYXJhbSB0b0luZGV4IHRoZSBpbmRleCBvZiB0aGUgbGFzdCBlbGVtZW50IChleGNsdXNpdmUpIHRvIGJlCgkgICAgICogICAgICAgIGZpbGxlZCB3aXRoIHRoZSBzcGVjaWZpZWQgdmFsdWUKCSAgICAgKiBAcGFyYW0gdmFsIHRoZSB2YWx1ZSB0byBiZSBzdG9yZWQgaW4gYWxsIGVsZW1lbnRzIG9mIHRoZSBhcnJheQoJICAgICAqIEB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPiB0b0luZGV4fQoJICAgICAqIEB0aHJvd3MgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGlmIHtAY29kZSBmcm9tSW5kZXggPCAwfSBvcgoJICAgICAqICAgICAgICAge0Bjb2RlIHRvSW5kZXggPiBhLmxlbmd0aH0KCSAgICAgKi8KCSAgICBBcnJheXMuZmlsbFdpdGhpbiA9IGZ1bmN0aW9uIChhLCBmcm9tSW5kZXgsIHRvSW5kZXgsIHZhbCkgewoJICAgICAgICBBcnJheXMucmFuZ2VDaGVjayhhLmxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZyb21JbmRleDsgaSA8IHRvSW5kZXg7IGkrKykKCSAgICAgICAgICAgIGFbaV0gPSB2YWw7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDaGVja3MgdGhhdCB7QGNvZGUgZnJvbUluZGV4fSBhbmQge0Bjb2RlIHRvSW5kZXh9IGFyZSBpbgoJICAgICAqIHRoZSByYW5nZSBhbmQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBpZiB0aGV5IGFyZW4ndC4KCSAgICAgKi8KCSAgICBBcnJheXMucmFuZ2VDaGVjayA9IGZ1bmN0aW9uIChhcnJheUxlbmd0aCwgZnJvbUluZGV4LCB0b0luZGV4KSB7CgkgICAgICAgIGlmIChmcm9tSW5kZXggPiB0b0luZGV4KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOS5kZWZhdWx0KCdmcm9tSW5kZXgoJyArIGZyb21JbmRleCArICcpID4gdG9JbmRleCgnICsgdG9JbmRleCArICcpJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGZyb21JbmRleCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb25fMS5kZWZhdWx0KGZyb21JbmRleCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvSW5kZXggPiBhcnJheUxlbmd0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbl8xLmRlZmF1bHQodG9JbmRleCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEFycmF5cy5hc0xpc3QgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBhcmdzID0gW107CgkgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CgkgICAgICAgICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGFyZ3M7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlID0gZnVuY3Rpb24gKHJvd3MsIGNvbHMsIHZhbHVlKSB7CgkgICAgICAgIHZhciBhcnIgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiByb3dzIH0pOwoJICAgICAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuY3JlYXRlSW50MzJBcnJheSA9IGZ1bmN0aW9uIChyb3dzLCBjb2xzLCB2YWx1ZSkgewoJICAgICAgICB2YXIgYXJyID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogcm93cyB9KTsKCSAgICAgICAgcmV0dXJuIGFyci5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIEludDMyQXJyYXkuZnJvbSh7IGxlbmd0aDogY29scyB9KS5maWxsKHZhbHVlKTsgfSk7CgkgICAgfTsKCSAgICBBcnJheXMuZXF1YWxzID0gZnVuY3Rpb24gKGZpcnN0LCBzZWNvbmQpIHsKCSAgICAgICAgaWYgKCFmaXJzdCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIGlmICghc2Vjb25kKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKCFmaXJzdC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoIXNlY29uZC5sZW5ndGgpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZmlyc3QubGVuZ3RoICE9PSBzZWNvbmQubGVuZ3RoKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gZmlyc3QubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgaWYgKGZpcnN0W2ldICE9PSBzZWNvbmRbaV0pIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICBBcnJheXMuaGFzaENvZGUgPSBmdW5jdGlvbiAoYSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgaWYgKGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSAxOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgYV8xID0gX192YWx1ZXMkNyhhKSwgYV8xXzEgPSBhXzEubmV4dCgpOyAhYV8xXzEuZG9uZTsgYV8xXzEgPSBhXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBhXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIGVsZW1lbnQ7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChhXzFfMSAmJiAhYV8xXzEuZG9uZSAmJiAoX2EgPSBhXzEucmV0dXJuKSkgX2EuY2FsbChhXzEpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBBcnJheXMuZmlsbFVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAoYSwgdmFsdWUpIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgIT09IGEubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIGFbaV0gPSB2YWx1ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZiA9IGZ1bmN0aW9uIChvcmlnaW5hbCwgbmV3TGVuZ3RoKSB7CgkgICAgICAgIHJldHVybiBvcmlnaW5hbC5zbGljZSgwLCBuZXdMZW5ndGgpOwoJICAgIH07CgkgICAgQXJyYXlzLmNvcHlPZlVpbnQ4QXJyYXkgPSBmdW5jdGlvbiAob3JpZ2luYWwsIG5ld0xlbmd0aCkgewoJICAgICAgICBpZiAob3JpZ2luYWwubGVuZ3RoIDw9IG5ld0xlbmd0aCkgewoJICAgICAgICAgICAgdmFyIG5ld0FycmF5ID0gbmV3IFVpbnQ4QXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgICAgIG5ld0FycmF5LnNldChvcmlnaW5hbCk7CgkgICAgICAgICAgICByZXR1cm4gbmV3QXJyYXk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG9yaWdpbmFsLnNsaWNlKDAsIG5ld0xlbmd0aCk7CgkgICAgfTsKCSAgICBBcnJheXMuY29weU9mUmFuZ2UgPSBmdW5jdGlvbiAob3JpZ2luYWwsIGZyb20sIHRvKSB7CgkgICAgICAgIHZhciBuZXdMZW5ndGggPSB0byAtIGZyb207CgkgICAgICAgIHZhciBjb3B5ID0gbmV3IEludDMyQXJyYXkobmV3TGVuZ3RoKTsKCSAgICAgICAgU3lzdGVtXzEkNS5kZWZhdWx0LmFycmF5Y29weShvcmlnaW5hbCwgZnJvbSwgY29weSwgMCwgbmV3TGVuZ3RoKTsKCSAgICAgICAgcmV0dXJuIGNvcHk7CgkgICAgfTsKCSAgICAvKgoJICAgICogUmV0dXJucyB0aGUgaW5kZXggb2Ygb2YgdGhlIGVsZW1lbnQgaW4gYSBzb3J0ZWQgYXJyYXkgb3IgKC1uLTEpIHdoZXJlIG4gaXMgdGhlIGluc2VydGlvbiBwb2ludAoJICAgICogZm9yIHRoZSBuZXcgZWxlbWVudC4KCSAgICAqIFBhcmFtZXRlcnM6CgkgICAgKiAgICAgYXIgLSBBIHNvcnRlZCBhcnJheQoJICAgICogICAgIGVsIC0gQW4gZWxlbWVudCB0byBzZWFyY2ggZm9yCgkgICAgKiAgICAgY29tcGFyYXRvciAtIEEgY29tcGFyYXRvciBmdW5jdGlvbi4gVGhlIGZ1bmN0aW9uIHRha2VzIHR3byBhcmd1bWVudHM6IChhLCBiKSBhbmQgcmV0dXJuczoKCSAgICAqICAgICAgICBhIG5lZ2F0aXZlIG51bWJlciAgaWYgYSBpcyBsZXNzIHRoYW4gYjsKCSAgICAqICAgICAgICAwIGlmIGEgaXMgZXF1YWwgdG8gYjsKCSAgICAqICAgICAgICBhIHBvc2l0aXZlIG51bWJlciBvZiBhIGlzIGdyZWF0ZXIgdGhhbiBiLgoJICAgICogVGhlIGFycmF5IG1heSBjb250YWluIGR1cGxpY2F0ZSBlbGVtZW50cy4gSWYgdGhlcmUgYXJlIG1vcmUgdGhhbiBvbmUgZXF1YWwgZWxlbWVudHMgaW4gdGhlIGFycmF5LAoJICAgICogdGhlIHJldHVybmVkIHZhbHVlIGNhbiBiZSB0aGUgaW5kZXggb2YgYW55IG9uZSBvZiB0aGUgZXF1YWwgZWxlbWVudHMuCgkgICAgKgoJICAgICogaHR0cDovL2pzZmlkZGxlLm5ldC9hcnl6aG92L3BrZnN0NTUwLwoJICAgICovCgkgICAgQXJyYXlzLmJpbmFyeVNlYXJjaCA9IGZ1bmN0aW9uIChhciwgZWwsIGNvbXBhcmF0b3IpIHsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY29tcGFyYXRvcikgewoJICAgICAgICAgICAgY29tcGFyYXRvciA9IEFycmF5cy5udW1iZXJDb21wYXJhdG9yOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtID0gMDsKCSAgICAgICAgdmFyIG4gPSBhci5sZW5ndGggLSAxOwoJICAgICAgICB3aGlsZSAobSA8PSBuKSB7CgkgICAgICAgICAgICB2YXIgayA9IChuICsgbSkgPj4gMTsKCSAgICAgICAgICAgIHZhciBjbXAgPSBjb21wYXJhdG9yKGVsLCBhcltrXSk7CgkgICAgICAgICAgICBpZiAoY21wID4gMCkgewoJICAgICAgICAgICAgICAgIG0gPSBrICsgMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA8IDApIHsKCSAgICAgICAgICAgICAgICBuID0gayAtIDE7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gLW0gLSAxOwoJICAgIH07CgkgICAgQXJyYXlzLm51bWJlckNvbXBhcmF0b3IgPSBmdW5jdGlvbiAoYSwgYikgewoJICAgICAgICByZXR1cm4gYSAtIGI7CgkgICAgfTsKCSAgICByZXR1cm4gQXJyYXlzOwoJfSgpKTsKCUFycmF5cyQxLmRlZmF1bHQgPSBBcnJheXM7CgoJdmFyIEludGVnZXIkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnRlZ2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogUG9ueWZpbGwgZm9yIEphdmEncyBJbnRlZ2VyIGNsYXNzLgoJICovCgl2YXIgSW50ZWdlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBJbnRlZ2VyKCkgewoJICAgIH0KCSAgICBJbnRlZ2VyLm51bWJlck9mVHJhaWxpbmdaZXJvcyA9IGZ1bmN0aW9uIChpKSB7CgkgICAgICAgIHZhciB5OwoJICAgICAgICBpZiAoaSA9PT0gMCkKCSAgICAgICAgICAgIHJldHVybiAzMjsKCSAgICAgICAgdmFyIG4gPSAzMTsKCSAgICAgICAgeSA9IGkgPDwgMTY7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDE2OwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgeSA9IGkgPDwgODsKCSAgICAgICAgaWYgKHkgIT09IDApIHsKCSAgICAgICAgICAgIG4gLT0gODsKCSAgICAgICAgICAgIGkgPSB5OwoJICAgICAgICB9CgkgICAgICAgIHkgPSBpIDw8IDQ7CgkgICAgICAgIGlmICh5ICE9PSAwKSB7CgkgICAgICAgICAgICBuIC09IDQ7CgkgICAgICAgICAgICBpID0geTsKCSAgICAgICAgfQoJICAgICAgICB5ID0gaSA8PCAyOwoJICAgICAgICBpZiAoeSAhPT0gMCkgewoJICAgICAgICAgICAgbiAtPSAyOwoJICAgICAgICAgICAgaSA9IHk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG4gLSAoKGkgPDwgMSkgPj4+IDMxKTsKCSAgICB9OwoJICAgIEludGVnZXIubnVtYmVyT2ZMZWFkaW5nWmVyb3MgPSBmdW5jdGlvbiAoaSkgewoJICAgICAgICAvLyBIRCwgRmlndXJlIDUtNgoJICAgICAgICBpZiAoaSA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDMyOwoJICAgICAgICB9CgkgICAgICAgIHZhciBuID0gMTsKCSAgICAgICAgaWYgKGkgPj4+IDE2ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDE2OwoJICAgICAgICAgICAgaSA8PD0gMTY7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGkgPj4+IDI0ID09PSAwKSB7CgkgICAgICAgICAgICBuICs9IDg7CgkgICAgICAgICAgICBpIDw8PSA4OwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID4+PiAyOCA9PT0gMCkgewoJICAgICAgICAgICAgbiArPSA0OwoJICAgICAgICAgICAgaSA8PD0gNDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaSA+Pj4gMzAgPT09IDApIHsKCSAgICAgICAgICAgIG4gKz0gMjsKCSAgICAgICAgICAgIGkgPDw9IDI7CgkgICAgICAgIH0KCSAgICAgICAgbiAtPSBpID4+PiAzMTsKCSAgICAgICAgcmV0dXJuIG47CgkgICAgfTsKCSAgICBJbnRlZ2VyLnRvSGV4U3RyaW5nID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgcmV0dXJuIGkudG9TdHJpbmcoMTYpOwoJICAgIH07CgkgICAgSW50ZWdlci50b0JpbmFyeVN0cmluZyA9IGZ1bmN0aW9uIChpbnROdW1iZXIpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZyhwYXJzZUludChTdHJpbmcoaW50TnVtYmVyKSwgMikpOwoJICAgIH07CgkgICAgLy8gUmV0dXJucyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4gVGhpcyBmdW5jdGlvbiBpcyBzb21ldGltZXMgcmVmZXJyZWQgdG8gYXMgdGhlIHBvcHVsYXRpb24gY291bnQuCgkgICAgLy8gUmV0dXJuczoKCSAgICAvLyB0aGUgbnVtYmVyIG9mIG9uZS1iaXRzIGluIHRoZSB0d28ncyBjb21wbGVtZW50IGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiB0aGUgc3BlY2lmaWVkIGludCB2YWx1ZS4KCSAgICBJbnRlZ2VyLmJpdENvdW50ID0gZnVuY3Rpb24gKGkpIHsKCSAgICAgICAgLy8gSEQsIEZpZ3VyZSA1LTIKCSAgICAgICAgaSA9IGkgLSAoKGkgPj4+IDEpICYgMHg1NTU1NTU1NSk7CgkgICAgICAgIGkgPSAoaSAmIDB4MzMzMzMzMzMpICsgKChpID4+PiAyKSAmIDB4MzMzMzMzMzMpOwoJICAgICAgICBpID0gKGkgKyAoaSA+Pj4gNCkpICYgMHgwZjBmMGYwZjsKCSAgICAgICAgaSA9IGkgKyAoaSA+Pj4gOCk7CgkgICAgICAgIGkgPSBpICsgKGkgPj4+IDE2KTsKCSAgICAgICAgcmV0dXJuIGkgJiAweDNmOwoJICAgIH07CgkgICAgSW50ZWdlci50cnVuY0RpdmlzaW9uID0gZnVuY3Rpb24gKGRpdmlkZW5kLCBkaXZpc29yKSB7CgkgICAgICAgIHJldHVybiBNYXRoLnRydW5jKGRpdmlkZW5kIC8gZGl2aXNvcik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDb252ZXJ0cyBBIHN0cmluZyB0byBhbiBpbnRlZ2VyLgoJICAgICAqIEBwYXJhbSBzIEEgc3RyaW5nIHRvIGNvbnZlcnQgaW50byBhIG51bWJlci4KCSAgICAgKiBAcGFyYW0gcmFkaXggQSB2YWx1ZSBiZXR3ZWVuIDIgYW5kIDM2IHRoYXQgc3BlY2lmaWVzIHRoZSBiYXNlIG9mIHRoZSBudW1iZXIgaW4gbnVtU3RyaW5nLiBJZiB0aGlzIGFyZ3VtZW50IGlzIG5vdCBzdXBwbGllZCwgc3RyaW5ncyB3aXRoIGEgcHJlZml4IG9mICcweCcgYXJlIGNvbnNpZGVyZWQgaGV4YWRlY2ltYWwuIEFsbCBvdGhlciBzdHJpbmdzIGFyZSBjb25zaWRlcmVkIGRlY2ltYWwuCgkgICAgICovCgkgICAgSW50ZWdlci5wYXJzZUludCA9IGZ1bmN0aW9uIChudW0sIHJhZGl4KSB7CgkgICAgICAgIGlmIChyYWRpeCA9PT0gdm9pZCAwKSB7IHJhZGl4ID0gdW5kZWZpbmVkOyB9CgkgICAgICAgIHJldHVybiBwYXJzZUludChudW0sIHJhZGl4KTsKCSAgICB9OwoJICAgIEludGVnZXIuTUlOX1ZBTFVFXzMyX0JJVFMgPSAtMjE0NzQ4MzY0ODsKCSAgICBJbnRlZ2VyLk1BWF9WQUxVRSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgIHJldHVybiBJbnRlZ2VyOwoJfSgpKTsKCUludGVnZXIkMS5kZWZhdWx0ID0gSW50ZWdlcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdEFycmF5JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDggPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcnJheXNfMSQxID0gQXJyYXlzJDE7Cgl2YXIgSW50ZWdlcl8xJDIgPSBJbnRlZ2VyJDE7Cgl2YXIgU3lzdGVtXzEkNCA9IFN5c3RlbSQxOwoJLyoqCgkgKiA8cD5BIHNpbXBsZSwgZmFzdCBhcnJheSBvZiBiaXRzLCByZXByZXNlbnRlZCBjb21wYWN0bHkgYnkgYW4gYXJyYXkgb2YgaW50cyBpbnRlcm5hbGx5LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgQml0QXJyYXkgLyppbXBsZW1lbnRzIENsb25lYWJsZSovID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHsKCSAgICAvLyAgIHRoaXMuc2l6ZSA9IDAKCSAgICAvLyAgIHRoaXMuYml0cyA9IG5ldyBJbnQzMkFycmF5KDEpCgkgICAgLy8gfQoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3RvcihzaXplPzogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh1bmRlZmluZWQgPT09IHNpemUpIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gMAoJICAgIC8vICAgfSBlbHNlIHsKCSAgICAvLyAgICAgdGhpcy5zaXplID0gc2l6ZQoJICAgIC8vICAgfQoJICAgIC8vICAgdGhpcy5iaXRzID0gdGhpcy5tYWtlQXJyYXkoc2l6ZSkKCSAgICAvLyB9CgkgICAgLy8gRm9yIHRlc3Rpbmcgb25seQoJICAgIGZ1bmN0aW9uIEJpdEFycmF5KHNpemUgLyppbnQqLywgYml0cykgewoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBzaXplKSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSAwOwoJICAgICAgICAgICAgdGhpcy5iaXRzID0gbmV3IEludDMyQXJyYXkoMSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnNpemUgPSBzaXplOwoJICAgICAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gQml0QXJyYXkubWFrZUFycmF5KHNpemUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc2l6ZTsKCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXRTaXplSW5CeXRlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKHRoaXMuc2l6ZSArIDcpIC8gOCk7CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZW5zdXJlQ2FwYWNpdHkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmIChzaXplID4gdGhpcy5iaXRzLmxlbmd0aCAqIDMyKSB7CgkgICAgICAgICAgICB2YXIgbmV3Qml0cyA9IEJpdEFycmF5Lm1ha2VBcnJheShzaXplKTsKCSAgICAgICAgICAgIFN5c3RlbV8xJDQuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5iaXRzLCAwLCBuZXdCaXRzLCAwLCB0aGlzLmJpdHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBpIGJpdCB0byBnZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGJpdCBpIGlzIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiAodGhpcy5iaXRzW01hdGguZmxvb3IoaSAvIDMyKV0gJiAoMSA8PCAoaSAmIDB4MUYpKSkgIT09IDA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoaSAvKmludCovKSB7CgkgICAgICAgIHRoaXMuYml0c1tNYXRoLmZsb29yKGkgLyAzMildIHw9IDEgPDwgKGkgJiAweDFGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEZsaXBzIGJpdCBpLgoJICAgICAqCgkgICAgICogQHBhcmFtIGkgYml0IHRvIHNldAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5mbGlwID0gZnVuY3Rpb24gKGkgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSBePSAxIDw8IChpICYgMHgxRik7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBmaXJzdCBiaXQgdG8gY2hlY2sKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIGZpcnN0IGJpdCB0aGF0IGlzIHNldCwgc3RhcnRpbmcgZnJvbSB0aGUgZ2l2ZW4gaW5kZXgsIG9yIHNpemUgaWYgbm9uZSBhcmUgc2V0CgkgICAgICogIGF0IG9yIGJleW9uZCB0aGlzIGdpdmVuIGluZGV4CgkgICAgICogQHNlZSAjZ2V0TmV4dFVuc2V0KGludCkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZ2V0TmV4dFNldCA9IGZ1bmN0aW9uIChmcm9tIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLnNpemU7CgkgICAgICAgIGlmIChmcm9tID49IHNpemUpIHsKCSAgICAgICAgICAgIHJldHVybiBzaXplOwoJICAgICAgICB9CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IE1hdGguZmxvb3IoZnJvbSAvIDMyKTsKCSAgICAgICAgdmFyIGN1cnJlbnRCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgLy8gbWFzayBvZmYgbGVzc2VyIGJpdHMgZmlyc3QKCSAgICAgICAgY3VycmVudEJpdHMgJj0gfigoMSA8PCAoZnJvbSAmIDB4MUYpKSAtIDEpOwoJICAgICAgICB2YXIgbGVuZ3RoID0gYml0cy5sZW5ndGg7CgkgICAgICAgIHdoaWxlIChjdXJyZW50Qml0cyA9PT0gMCkgewoJICAgICAgICAgICAgaWYgKCsrYml0c09mZnNldCA9PT0gbGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHNpemU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjdXJyZW50Qml0cyA9IGJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gZnJvbSBpbmRleCB0byBzdGFydCBsb29raW5nIGZvciB1bnNldCBiaXQKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgdW5zZXQgYml0LCBvciB7QGNvZGUgc2l6ZX0gaWYgbm9uZSBhcmUgdW5zZXQgdW50aWwgdGhlIGVuZAoJICAgICAqIEBzZWUgI2dldE5leHRTZXQoaW50KQoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5nZXROZXh0VW5zZXQgPSBmdW5jdGlvbiAoZnJvbSAvKmludCovKSB7CgkgICAgICAgIHZhciBzaXplID0gdGhpcy5zaXplOwoJICAgICAgICBpZiAoZnJvbSA+PSBzaXplKSB7CgkgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIGJpdHNPZmZzZXQgPSBNYXRoLmZsb29yKGZyb20gLyAzMik7CgkgICAgICAgIHZhciBjdXJyZW50Qml0cyA9IH5iaXRzW2JpdHNPZmZzZXRdOwoJICAgICAgICAvLyBtYXNrIG9mZiBsZXNzZXIgYml0cyBmaXJzdAoJICAgICAgICBjdXJyZW50Qml0cyAmPSB+KCgxIDw8IChmcm9tICYgMHgxRikpIC0gMSk7CgkgICAgICAgIHZhciBsZW5ndGggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgd2hpbGUgKGN1cnJlbnRCaXRzID09PSAwKSB7CgkgICAgICAgICAgICBpZiAoKytiaXRzT2Zmc2V0ID09PSBsZW5ndGgpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gc2l6ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGN1cnJlbnRCaXRzID0gfmJpdHNbYml0c09mZnNldF07CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdCA9IChiaXRzT2Zmc2V0ICogMzIpICsgSW50ZWdlcl8xJDIuZGVmYXVsdC5udW1iZXJPZlRyYWlsaW5nWmVyb3MoY3VycmVudEJpdHMpOwoJICAgICAgICByZXR1cm4gcmVzdWx0ID4gc2l6ZSA/IHNpemUgOiByZXN1bHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgYmxvY2sgb2YgMzIgYml0cywgc3RhcnRpbmcgYXQgYml0IGkuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gaSBmaXJzdCBiaXQgdG8gc2V0CgkgICAgICogQHBhcmFtIG5ld0JpdHMgdGhlIG5ldyB2YWx1ZSBvZiB0aGUgbmV4dCAzMiBiaXRzLiBOb3RlIGFnYWluIHRoYXQgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdAoJICAgICAqIGNvcnJlc3BvbmRzIHRvIGJpdCBpLCB0aGUgbmV4dC1sZWFzdC1zaWduaWZpY2FudCB0byBpKzEsIGFuZCBzbyBvbi4KCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0QnVsayA9IGZ1bmN0aW9uIChpIC8qaW50Ki8sIG5ld0JpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLmJpdHNbTWF0aC5mbG9vcihpIC8gMzIpXSA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZXRzIGEgcmFuZ2Ugb2YgYml0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydCBzdGFydCBvZiByYW5nZSwgaW5jbHVzaXZlLgoJICAgICAqIEBwYXJhbSBlbmQgZW5kIG9mIHJhbmdlLCBleGNsdXNpdmUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuc2V0UmFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQgLyppbnQqLywgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIGVuZC0tOyAvLyB3aWxsIGJlIGVhc2llciB0byB0cmVhdCB0aGlzIGFzIHRoZSBsYXN0IGFjdHVhbGx5IHNldCBiaXQgLS0gaW5jbHVzaXZlCgkgICAgICAgIHZhciBmaXJzdEludCA9IE1hdGguZmxvb3Ioc3RhcnQgLyAzMik7CgkgICAgICAgIHZhciBsYXN0SW50ID0gTWF0aC5mbG9vcihlbmQgLyAzMik7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICBmb3IgKHZhciBpID0gZmlyc3RJbnQ7IGkgPD0gbGFzdEludDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgZmlyc3RCaXQgPSBpID4gZmlyc3RJbnQgPyAwIDogc3RhcnQgJiAweDFGOwoJICAgICAgICAgICAgdmFyIGxhc3RCaXQgPSBpIDwgbGFzdEludCA/IDMxIDogZW5kICYgMHgxRjsKCSAgICAgICAgICAgIC8vIE9uZXMgZnJvbSBmaXJzdEJpdCB0byBsYXN0Qml0LCBpbmNsdXNpdmUKCSAgICAgICAgICAgIHZhciBtYXNrID0gKDIgPDwgbGFzdEJpdCkgLSAoMSA8PCBmaXJzdEJpdCk7CgkgICAgICAgICAgICBiaXRzW2ldIHw9IG1hc2s7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbWF4ID0gdGhpcy5iaXRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGJpdHNbaV0gPSAwOwoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBFZmZpY2llbnQgbWV0aG9kIHRvIGNoZWNrIGlmIGEgcmFuZ2Ugb2YgYml0cyBpcyBzZXQsIG9yIG5vdCBzZXQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnQgc3RhcnQgb2YgcmFuZ2UsIGluY2x1c2l2ZS4KCSAgICAgKiBAcGFyYW0gZW5kIGVuZCBvZiByYW5nZSwgZXhjbHVzaXZlCgkgICAgICogQHBhcmFtIHZhbHVlIGlmIHRydWUsIGNoZWNrcyB0aGF0IGJpdHMgaW4gcmFuZ2UgYXJlIHNldCwgb3RoZXJ3aXNlIGNoZWNrcyB0aGF0IHRoZXkgYXJlIG5vdCBzZXQKCSAgICAgKiBAcmV0dXJuIHRydWUgaWZmIGFsbCBiaXRzIGFyZSBzZXQgb3Igbm90IHNldCBpbiByYW5nZSwgYWNjb3JkaW5nIHRvIHZhbHVlIGFyZ3VtZW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgZW5kIGlzIGxlc3MgdGhhbiBzdGFydCBvciB0aGUgcmFuZ2UgaXMgbm90IGNvbnRhaW5lZCBpbiB0aGUgYXJyYXkKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuaXNSYW5nZSA9IGZ1bmN0aW9uIChzdGFydCAvKmludCovLCBlbmQgLyppbnQqLywgdmFsdWUpIHsKCSAgICAgICAgaWYgKGVuZCA8IHN0YXJ0IHx8IHN0YXJ0IDwgMCB8fCBlbmQgPiB0aGlzLnNpemUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ4LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoZW5kID09PSBzdGFydCkgewoJICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vIGVtcHR5IHJhbmdlIG1hdGNoZXMKCSAgICAgICAgfQoJICAgICAgICBlbmQtLTsgLy8gd2lsbCBiZSBlYXNpZXIgdG8gdHJlYXQgdGhpcyBhcyB0aGUgbGFzdCBhY3R1YWxseSBzZXQgYml0IC0tIGluY2x1c2l2ZQoJICAgICAgICB2YXIgZmlyc3RJbnQgPSBNYXRoLmZsb29yKHN0YXJ0IC8gMzIpOwoJICAgICAgICB2YXIgbGFzdEludCA9IE1hdGguZmxvb3IoZW5kIC8gMzIpOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgaSA9IGZpcnN0SW50OyBpIDw9IGxhc3RJbnQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGZpcnN0Qml0ID0gaSA+IGZpcnN0SW50ID8gMCA6IHN0YXJ0ICYgMHgxRjsKCSAgICAgICAgICAgIHZhciBsYXN0Qml0ID0gaSA8IGxhc3RJbnQgPyAzMSA6IGVuZCAmIDB4MUY7CgkgICAgICAgICAgICAvLyBPbmVzIGZyb20gZmlyc3RCaXQgdG8gbGFzdEJpdCwgaW5jbHVzaXZlCgkgICAgICAgICAgICB2YXIgbWFzayA9ICgyIDw8IGxhc3RCaXQpIC0gKDEgPDwgZmlyc3RCaXQpICYgMHhGRkZGRkZGRjsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiAmIDB4RkZGRkZGRkYgYWRkZWQgdG8gZGlzY2FyZCBhbnl0aGluZyBhZnRlciAzMiBiaXRzLCBhcyBFUyBoYXMgNTMgYml0cwoJICAgICAgICAgICAgLy8gUmV0dXJuIGZhbHNlIGlmIHdlJ3JlIGxvb2tpbmcgZm9yIDFzIGFuZCB0aGUgbWFza2VkIGJpdHNbaV0gaXNuJ3QgYWxsIDFzIChpczogdGhhdCwKCSAgICAgICAgICAgIC8vIGVxdWFscyB0aGUgbWFzaywgb3Igd2UncmUgbG9va2luZyBmb3IgMHMgYW5kIHRoZSBtYXNrZWQgcG9ydGlvbiBpcyBub3QgYWxsIDBzCgkgICAgICAgICAgICBpZiAoKGJpdHNbaV0gJiBtYXNrKSAhPT0gKHZhbHVlID8gbWFzayA6IDApKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0cnVlOwoJICAgIH07CgkgICAgQml0QXJyYXkucHJvdG90eXBlLmFwcGVuZEJpdCA9IGZ1bmN0aW9uIChiaXQpIHsKCSAgICAgICAgdGhpcy5lbnN1cmVDYXBhY2l0eSh0aGlzLnNpemUgKyAxKTsKCSAgICAgICAgaWYgKGJpdCkgewoJICAgICAgICAgICAgdGhpcy5iaXRzW01hdGguZmxvb3IodGhpcy5zaXplIC8gMzIpXSB8PSAxIDw8ICh0aGlzLnNpemUgJiAweDFGKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLnNpemUrKzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEFwcGVuZHMgdGhlIGxlYXN0LXNpZ25pZmljYW50IGJpdHMsIGZyb20gdmFsdWUsIGluIG9yZGVyIGZyb20gbW9zdC1zaWduaWZpY2FudCB0bwoJICAgICAqIGxlYXN0LXNpZ25pZmljYW50LiBGb3IgZXhhbXBsZSwgYXBwZW5kaW5nIDYgYml0cyBmcm9tIDB4MDAwMDAxRSB3aWxsIGFwcGVuZCB0aGUgYml0cwoJICAgICAqIDAsIDEsIDEsIDEsIDEsIDAgaW4gdGhhdCBvcmRlci4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB2YWx1ZSB7QGNvZGUgaW50fSBjb250YWluaW5nIGJpdHMgdG8gYXBwZW5kCgkgICAgICogQHBhcmFtIG51bUJpdHMgYml0cyBmcm9tIHZhbHVlIHRvIGFwcGVuZAoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5hcHBlbmRCaXRzID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICBpZiAobnVtQml0cyA8IDAgfHwgbnVtQml0cyA+IDMyKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkOC5kZWZhdWx0KCdOdW0gYml0cyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMzInKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmVuc3VyZUNhcGFjaXR5KHRoaXMuc2l6ZSArIG51bUJpdHMpOwoJICAgICAgICAvLyBjb25zdCBhcHBlbmRCaXQgPSB0aGlzLmFwcGVuZEJpdDsKCSAgICAgICAgZm9yICh2YXIgbnVtQml0c0xlZnQgPSBudW1CaXRzOyBudW1CaXRzTGVmdCA+IDA7IG51bUJpdHNMZWZ0LS0pIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KCgodmFsdWUgPj4gKG51bUJpdHNMZWZ0IC0gMSkpICYgMHgwMSkgPT09IDEpOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBCaXRBcnJheS5wcm90b3R5cGUuYXBwZW5kQml0QXJyYXkgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdmFyIG90aGVyU2l6ZSA9IG90aGVyLnNpemU7CgkgICAgICAgIHRoaXMuZW5zdXJlQ2FwYWNpdHkodGhpcy5zaXplICsgb3RoZXJTaXplKTsKCSAgICAgICAgLy8gY29uc3QgYXBwZW5kQml0ID0gdGhpcy5hcHBlbmRCaXQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3RoZXJTaXplOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kQml0KG90aGVyLmdldChpKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gb3RoZXIuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDguZGVmYXVsdCgnU2l6ZXMgZG9uXCd0IG1hdGNoJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGJpdHMubGVuZ3RoOyBpIDwgbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgLy8gVGhlIGxhc3QgaW50IGNvdWxkIGJlIGluY29tcGxldGUgKGkuZS4gbm90IGhhdmUgMzIgYml0cyBpbgoJICAgICAgICAgICAgLy8gaXQpIGJ1dCB0aGVyZSBpcyBubyBwcm9ibGVtIHNpbmNlIDAgWE9SIDAgPT0gMC4KCSAgICAgICAgICAgIGJpdHNbaV0gXj0gb3RoZXIuYml0c1tpXTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0T2Zmc2V0IGZpcnN0IGJpdCB0byBzdGFydCB3cml0aW5nCgkgICAgICogQHBhcmFtIGFycmF5IGFycmF5IHRvIHdyaXRlIGludG8uIEJ5dGVzIGFyZSB3cml0dGVuIG1vc3Qtc2lnbmlmaWNhbnQgYnl0ZSBmaXJzdC4gVGhpcyBpcyB0aGUgb3Bwb3NpdGUKCSAgICAgKiAgb2YgdGhlIGludGVybmFsIHJlcHJlc2VudGF0aW9uLCB3aGljaCBpcyBleHBvc2VkIGJ5IHtAbGluayAjZ2V0Qml0QXJyYXkoKX0KCSAgICAgKiBAcGFyYW0gb2Zmc2V0IHBvc2l0aW9uIGluIGFycmF5IHRvIHN0YXJ0IHdyaXRpbmcKCSAgICAgKiBAcGFyYW0gbnVtQnl0ZXMgaG93IG1hbnkgYnl0ZXMgdG8gd3JpdGUKCSAgICAgKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUudG9CeXRlcyA9IGZ1bmN0aW9uIChiaXRPZmZzZXQgLyppbnQqLywgYXJyYXksIG9mZnNldCAvKmludCovLCBudW1CeXRlcyAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQnl0ZXM7IGkrKykgewoJICAgICAgICAgICAgdmFyIHRoZUJ5dGUgPSAwOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCA4OyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5nZXQoYml0T2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICB0aGVCeXRlIHw9IDEgPDwgKDcgLSBqKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhcnJheVtvZmZzZXQgKyBpXSA9IC8qKGJ5dGUpKi8gdGhlQnl0ZTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB1bmRlcmx5aW5nIGFycmF5IG9mIGludHMuIFRoZSBmaXJzdCBlbGVtZW50IGhvbGRzIHRoZSBmaXJzdCAzMiBiaXRzLCBhbmQgdGhlIGxlYXN0CgkgICAgICogICAgICAgICBzaWduaWZpY2FudCBiaXQgaXMgYml0IDAuCgkgICAgICovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLmdldEJpdEFycmF5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV2ZXJzZXMgYWxsIGJpdHMgaW4gdGhlIGFycmF5LgoJICAgICAqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5yZXZlcnNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgbmV3Qml0cyA9IG5ldyBJbnQzMkFycmF5KHRoaXMuYml0cy5sZW5ndGgpOwoJICAgICAgICAvLyByZXZlcnNlIGFsbCBpbnQncyBmaXJzdAoJICAgICAgICB2YXIgbGVuID0gTWF0aC5mbG9vcigodGhpcy5zaXplIC0gMSkgLyAzMik7CgkgICAgICAgIHZhciBvbGRCaXRzTGVuID0gbGVuICsgMTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkQml0c0xlbjsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeCA9IGJpdHNbaV07CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDEpICYgMHg1NTU1NTU1NSkgfCAoKHggJiAweDU1NTU1NTU1KSA8PCAxKTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMikgJiAweDMzMzMzMzMzKSB8ICgoeCAmIDB4MzMzMzMzMzMpIDw8IDIpOwoJICAgICAgICAgICAgeCA9ICgoeCA+PiA0KSAmIDB4MGYwZjBmMGYpIHwgKCh4ICYgMHgwZjBmMGYwZikgPDwgNCk7CgkgICAgICAgICAgICB4ID0gKCh4ID4+IDgpICYgMHgwMGZmMDBmZikgfCAoKHggJiAweDAwZmYwMGZmKSA8PCA4KTsKCSAgICAgICAgICAgIHggPSAoKHggPj4gMTYpICYgMHgwMDAwZmZmZikgfCAoKHggJiAweDAwMDBmZmZmKSA8PCAxNik7CgkgICAgICAgICAgICBuZXdCaXRzW2xlbiAtIGldID0gLyooaW50KSovIHg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm93IGNvcnJlY3QgdGhlIGludCdzIGlmIHRoZSBiaXQgc2l6ZSBpc24ndCBhIG11bHRpcGxlIG9mIDMyCgkgICAgICAgIGlmICh0aGlzLnNpemUgIT09IG9sZEJpdHNMZW4gKiAzMikgewoJICAgICAgICAgICAgdmFyIGxlZnRPZmZzZXQgPSBvbGRCaXRzTGVuICogMzIgLSB0aGlzLnNpemU7CgkgICAgICAgICAgICB2YXIgY3VycmVudEludCA9IG5ld0JpdHNbMF0gPj4+IGxlZnRPZmZzZXQ7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IG9sZEJpdHNMZW47IGkrKykgewoJICAgICAgICAgICAgICAgIHZhciBuZXh0SW50ID0gbmV3Qml0c1tpXTsKCSAgICAgICAgICAgICAgICBjdXJyZW50SW50IHw9IG5leHRJbnQgPDwgKDMyIC0gbGVmdE9mZnNldCk7CgkgICAgICAgICAgICAgICAgbmV3Qml0c1tpIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICAgICAgICAgIGN1cnJlbnRJbnQgPSBuZXh0SW50ID4+PiBsZWZ0T2Zmc2V0OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgbmV3Qml0c1tvbGRCaXRzTGVuIC0gMV0gPSBjdXJyZW50SW50OwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0cyA9IG5ld0JpdHM7CgkgICAgfTsKCSAgICBCaXRBcnJheS5tYWtlQXJyYXkgPSBmdW5jdGlvbiAoc2l6ZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW50MzJBcnJheShNYXRoLmZsb29yKChzaXplICsgMzEpIC8gMzIpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdEFycmF5KSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnNpemUgPT09IG90aGVyLnNpemUgJiYgQXJyYXlzXzEkMS5kZWZhdWx0LmVxdWFscyh0aGlzLmJpdHMsIG90aGVyLmJpdHMpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdEFycmF5LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogdGhpcy5zaXplICsgQXJyYXlzXzEkMS5kZWZhdWx0Lmhhc2hDb2RlKHRoaXMuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0QXJyYXkucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcmVzdWx0ID0gJyc7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBzaXplID0gdGhpcy5zaXplOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICBpZiAoKGkgJiAweDA3KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnICc7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQgKz0gdGhpcy5nZXQoaSkgPyAnWCcgOiAnLic7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBCaXRBcnJheS5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0QXJyYXkodGhpcy5zaXplLCB0aGlzLmJpdHMuc2xpY2UoKSk7CgkgICAgfTsKCSAgICByZXR1cm4gQml0QXJyYXk7Cgl9KCkpOwoJQml0QXJyYXkkMS5kZWZhdWx0ID0gQml0QXJyYXk7CgoJdmFyIEJpdE1hdHJpeCQxID0ge307CgoJdmFyIFN0cmluZ0J1aWxkZXIkMSA9IHt9OwoKCXZhciBTdHJpbmdVdGlscyQxID0ge307CgoJdmFyIERlY29kZUhpbnRUeXBlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERlY29kZUhpbnRUeXBlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIHR5cGUgb2YgaGludCB0aGF0IGEgY2FsbGVyIG1heSBwYXNzIHRvIGEgYmFyY29kZSByZWFkZXIgdG8gaGVscCBpdAoJICogbW9yZSBxdWlja2x5IG9yIGFjY3VyYXRlbHkgZGVjb2RlIGl0LiBJdCBpcyB1cCB0byBpbXBsZW1lbnRhdGlvbnMgdG8gZGVjaWRlIHdoYXQsCgkgKiBpZiBhbnl0aGluZywgdG8gZG8gd2l0aCB0aGUgaW5mb3JtYXRpb24gdGhhdCBpcyBzdXBwbGllZC4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBzZWUgUmVhZGVyI2RlY29kZShCaW5hcnlCaXRtYXAsamF2YS51dGlsLk1hcCkKCSAqLwoJdmFyIERlY29kZUhpbnRUeXBlOwoJKGZ1bmN0aW9uIChEZWNvZGVIaW50VHlwZSkgewoJICAgIC8qKgoJICAgICAqIFVuc3BlY2lmaWVkLCBhcHBsaWNhdGlvbi1zcGVjaWZpYyBoaW50LiBNYXBzIHRvIGFuIHVuc3BlY2lmaWVkIHtAbGluayBPYmplY3R9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJPVEhFUiJdID0gMF0gPSAiT1RIRVIiOyAvKihPYmplY3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJbWFnZSBpcyBhIHB1cmUgbW9ub2Nocm9tZSBpbWFnZSBvZiBhIGJhcmNvZGUuIERvZXNuJ3QgbWF0dGVyIHdoYXQgaXQgbWFwcyB0bzsKCSAgICAgKiB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlBVUkVfQkFSQ09ERSJdID0gMV0gPSAiUFVSRV9CQVJDT0RFIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEltYWdlIGlzIGtub3duIHRvIGJlIG9mIG9uZSBvZiBhIGZldyBwb3NzaWJsZSBmb3JtYXRzLgoJICAgICAqIE1hcHMgdG8gYSB7QGxpbmsgTGlzdH0gb2Yge0BsaW5rIEJhcmNvZGVGb3JtYXR9cy4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiUE9TU0lCTEVfRk9STUFUUyJdID0gMl0gPSAiUE9TU0lCTEVfRk9STUFUUyI7IC8qKExpc3QuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVuZCBtb3JlIHRpbWUgdG8gdHJ5IHRvIGZpbmQgYSBiYXJjb2RlOyBvcHRpbWl6ZSBmb3IgYWNjdXJhY3ksIG5vdCBzcGVlZC4KCSAgICAgKiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87IHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiVFJZX0hBUkRFUiJdID0gM10gPSAiVFJZX0hBUkRFUiI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBTcGVjaWZpZXMgd2hhdCBjaGFyYWN0ZXIgZW5jb2RpbmcgdG8gdXNlIHdoZW4gZGVjb2RpbmcsIHdoZXJlIGFwcGxpY2FibGUgKHR5cGUgU3RyaW5nKQoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJDSEFSQUNURVJfU0VUIl0gPSA0XSA9ICJDSEFSQUNURVJfU0VUIjsgLyooU3RyaW5nLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQWxsb3dlZCBsZW5ndGhzIG9mIGVuY29kZWQgZGF0YSAtLSByZWplY3QgYW55dGhpbmcgZWxzZS4gTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfTEVOR1RIUyJdID0gNV0gPSAiQUxMT1dFRF9MRU5HVEhTIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIEFzc3VtZSBDb2RlIDM5IGNvZGVzIGVtcGxveSBhIGNoZWNrIGRpZ2l0LiBEb2Vzbid0IG1hdHRlciB3aGF0IGl0IG1hcHMgdG87CgkgICAgICogdXNlIHtAbGluayBCb29sZWFuI1RSVUV9LgoJICAgICAqLwoJICAgIERlY29kZUhpbnRUeXBlW0RlY29kZUhpbnRUeXBlWyJBU1NVTUVfQ09ERV8zOV9DSEVDS19ESUdJVCJdID0gNl0gPSAiQVNTVU1FX0NPREVfMzlfQ0hFQ0tfRElHSVQiOyAvKihWb2lkLmNsYXNzKSovCgkgICAgLyoqCgkgICAgICogQXNzdW1lIHRoZSBiYXJjb2RlIGlzIGJlaW5nIHByb2Nlc3NlZCBhcyBhIEdTMSBiYXJjb2RlLCBhbmQgbW9kaWZ5IGJlaGF2aW9yIGFzIG5lZWRlZC4KCSAgICAgKiBGb3IgZXhhbXBsZSB0aGlzIGFmZmVjdHMgRk5DMSBoYW5kbGluZyBmb3IgQ29kZSAxMjggKGFrYSBHUzEtMTI4KS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOwoJICAgICAqIHVzZSB7QGxpbmsgQm9vbGVhbiNUUlVFfS4KCSAgICAgKi8KCSAgICBEZWNvZGVIaW50VHlwZVtEZWNvZGVIaW50VHlwZVsiQVNTVU1FX0dTMSJdID0gN10gPSAiQVNTVU1FX0dTMSI7IC8qKFZvaWQuY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBJZiB0cnVlLCByZXR1cm4gdGhlIHN0YXJ0IGFuZCBlbmQgZGlnaXRzIGluIGEgQ29kYWJhciBiYXJjb2RlIGluc3RlYWQgb2Ygc3RyaXBwaW5nIHRoZW0uIFRoZXkKCSAgICAgKiBhcmUgYWxwaGEsIHdoZXJlYXMgdGhlIHJlc3QgYXJlIG51bWVyaWMuIEJ5IGRlZmF1bHQsIHRoZXkgYXJlIHN0cmlwcGVkLCBidXQgdGhpcyBjYXVzZXMgdGhlbQoJICAgICAqIHRvIG5vdCBiZS4gRG9lc24ndCBtYXR0ZXIgd2hhdCBpdCBtYXBzIHRvOyB1c2Uge0BsaW5rIEJvb2xlYW4jVFJVRX0uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIlJFVFVSTl9DT0RBQkFSX1NUQVJUX0VORCJdID0gOF0gPSAiUkVUVVJOX0NPREFCQVJfU1RBUlRfRU5EIjsgLyooVm9pZC5jbGFzcykqLwoJICAgIC8qKgoJICAgICAqIFRoZSBjYWxsZXIgbmVlZHMgdG8gYmUgbm90aWZpZWQgdmlhIGNhbGxiYWNrIHdoZW4gYSBwb3NzaWJsZSB7QGxpbmsgUmVzdWx0UG9pbnR9CgkgICAgICogaXMgZm91bmQuIE1hcHMgdG8gYSB7QGxpbmsgUmVzdWx0UG9pbnRDYWxsYmFja30uCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIk5FRURfUkVTVUxUX1BPSU5UX0NBTExCQUNLIl0gPSA5XSA9ICJORUVEX1JFU1VMVF9QT0lOVF9DQUxMQkFDSyI7IC8qKFJlc3VsdFBvaW50Q2FsbGJhY2suY2xhc3MpKi8KCSAgICAvKioKCSAgICAgKiBBbGxvd2VkIGV4dGVuc2lvbiBsZW5ndGhzIGZvciBFQU4gb3IgVVBDIGJhcmNvZGVzLiBPdGhlciBmb3JtYXRzIHdpbGwgaWdub3JlIHRoaXMuCgkgICAgICogTWFwcyB0byBhbiB7QGNvZGUgSW50MzJBcnJheX0gb2YgdGhlIGFsbG93ZWQgZXh0ZW5zaW9uIGxlbmd0aHMsIGZvciBleGFtcGxlIFsyXSwgWzVdLCBvciBbMiwgNV0uCgkgICAgICogSWYgaXQgaXMgb3B0aW9uYWwgdG8gaGF2ZSBhbiBleHRlbnNpb24sIGRvIG5vdCBzZXQgdGhpcyBoaW50LiBJZiB0aGlzIGlzIHNldCwKCSAgICAgKiBhbmQgYSBVUEMgb3IgRUFOIGJhcmNvZGUgaXMgZm91bmQgYnV0IGFuIGV4dGVuc2lvbiBpcyBub3QsIHRoZW4gbm8gcmVzdWx0IHdpbGwgYmUgcmV0dXJuZWQKCSAgICAgKiBhdCBhbGwuCgkgICAgICovCgkgICAgRGVjb2RlSGludFR5cGVbRGVjb2RlSGludFR5cGVbIkFMTE9XRURfRUFOX0VYVEVOU0lPTlMiXSA9IDEwXSA9ICJBTExPV0VEX0VBTl9FWFRFTlNJT05TIjsgLyooSW50MzJBcnJheS5jbGFzcykqLwoJICAgIC8vIEVuZCBvZiBlbnVtZXJhdGlvbiB2YWx1ZXMuCgkgICAgLyoqCgkgICAgICogRGF0YSB0eXBlIHRoZSBoaW50IGlzIGV4cGVjdGluZy4KCSAgICAgKiBBbW9uZyB0aGUgcG9zc2libGUgdmFsdWVzIHRoZSB7QGxpbmsgVm9pZH0gc3RhbmRzIG91dCBhcyBiZWluZyB1c2VkIGZvcgoJICAgICAqIGhpbnRzIHRoYXQgZG8gbm90IGV4cGVjdCBhIHZhbHVlIHRvIGJlIHN1cHBsaWVkIChmbGFnIGhpbnRzKS4gU3VjaCBoaW50cwoJICAgICAqIHdpbGwgcG9zc2libHkgaGF2ZSB0aGVpciB2YWx1ZSBpZ25vcmVkLCBvciByZXBsYWNlZCBieSBhCgkgICAgICoge0BsaW5rIEJvb2xlYW4jVFJVRX0uIEhpbnQgc3VwcGxpZXJzIHNob3VsZCBwcm9iYWJseSB1c2UKCSAgICAgKiB7QGxpbmsgQm9vbGVhbiNUUlVFfSBhcyBkaXJlY3RlZCBieSB0aGUgYWN0dWFsIGhpbnQgZG9jdW1lbnRhdGlvbi4KCSAgICAgKi8KCSAgICAvLyBwcml2YXRlIHZhbHVlVHlwZTogQ2xhc3M8Pz4KCSAgICAvLyBEZWNvZGVIaW50VHlwZSh2YWx1ZVR5cGU6IENsYXNzPD8+KSB7CgkgICAgLy8gICB0aGlzLnZhbHVlVHlwZSA9IHZhbHVlVHlwZQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgZ2V0VmFsdWVUeXBlKCk6IENsYXNzPD8+IHsKCSAgICAvLyAgIHJldHVybiB2YWx1ZVR5cGUKCSAgICAvLyB9Cgl9KShEZWNvZGVIaW50VHlwZSB8fCAoRGVjb2RlSGludFR5cGUgPSB7fSkpOwoJRGVjb2RlSGludFR5cGUkMS5kZWZhdWx0ID0gRGVjb2RlSGludFR5cGU7CgoJdmFyIENoYXJhY3RlclNldEVDSSA9IHt9OwoKCXZhciBGb3JtYXRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZiA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGb3JtYXRFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDcgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgRm9ybWF0RXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyRmKEZvcm1hdEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBGb3JtYXRFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgRm9ybWF0RXhjZXB0aW9uLmdldEZvcm1hdEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEV4Y2VwdGlvbigpOwoJICAgIH07CgkgICAgRm9ybWF0RXhjZXB0aW9uLmtpbmQgPSAnRm9ybWF0RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gRm9ybWF0RXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQ3LmRlZmF1bHQpKTsKCUZvcm1hdEV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBGb3JtYXRFeGNlcHRpb247CgoJKGZ1bmN0aW9uIChleHBvcnRzKSB7CgkvKgoJICogQ29weXJpZ2h0IDIwMDggWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCWV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHZvaWQgMDsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xID0gRm9ybWF0RXhjZXB0aW9uJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsqLwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJdmFyIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnM7CgkoZnVuY3Rpb24gKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMpIHsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwNDM3Il0gPSAwXSA9ICJDcDQzNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEiXSA9IDFdID0gIklTTzg4NTlfMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzIiXSA9IDJdID0gIklTTzg4NTlfMiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzMiXSA9IDNdID0gIklTTzg4NTlfMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzQiXSA9IDRdID0gIklTTzg4NTlfNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzUiXSA9IDVdID0gIklTTzg4NTlfNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzYiXSA9IDZdID0gIklTTzg4NTlfNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzciXSA9IDddID0gIklTTzg4NTlfNyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzgiXSA9IDhdID0gIklTTzg4NTlfOCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzkiXSA9IDldID0gIklTTzg4NTlfOSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEwIl0gPSAxMF0gPSAiSVNPODg1OV8xMCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzExIl0gPSAxMV0gPSAiSVNPODg1OV8xMSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzEzIl0gPSAxMl0gPSAiSVNPODg1OV8xMyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE0Il0gPSAxM10gPSAiSVNPODg1OV8xNCI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE1Il0gPSAxNF0gPSAiSVNPODg1OV8xNSI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJJU084ODU5XzE2Il0gPSAxNV0gPSAiSVNPODg1OV8xNiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJTSklTIl0gPSAxNl0gPSAiU0pJUyI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTAiXSA9IDE3XSA9ICJDcDEyNTAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQ3AxMjUxIl0gPSAxOF0gPSAiQ3AxMjUxIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkNwMTI1MiJdID0gMTldID0gIkNwMTI1MiI7CgkgICAgQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1tDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzWyJDcDEyNTYiXSA9IDIwXSA9ICJDcDEyNTYiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siVW5pY29kZUJpZ1VubWFya2VkIl0gPSAyMV0gPSAiVW5pY29kZUJpZ1VubWFya2VkIjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIlVURjgiXSA9IDIyXSA9ICJVVEY4IjsKCSAgICBDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzW0NoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbIkFTQ0lJIl0gPSAyM10gPSAiQVNDSUkiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siQmlnNSJdID0gMjRdID0gIkJpZzUiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siR0IxODAzMCJdID0gMjVdID0gIkdCMTgwMzAiOwoJICAgIENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnNbQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVyc1siRVVDX0tSIl0gPSAyNl0gPSAiRVVDX0tSIjsKCX0pKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgPSBleHBvcnRzLkNoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMgfHwgKGV4cG9ydHMuQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycyA9IHt9KSk7CgkvKioKCSAqIEVuY2Fwc3VsYXRlcyBhIENoYXJhY3RlciBTZXQgRUNJLCBhY2NvcmRpbmcgdG8gIkV4dGVuZGVkIENoYW5uZWwgSW50ZXJwcmV0YXRpb25zIiA1LjMuMS4xCgkgKiBvZiBJU08gMTgwMDQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIENoYXJhY3RlclNldEVDSSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBDaGFyYWN0ZXJTZXRFQ0kodmFsdWVJZGVudGlmaWVyLCB2YWx1ZXNQYXJhbSwgbmFtZSkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG90aGVyRW5jb2RpbmdOYW1lcyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDM7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgb3RoZXJFbmNvZGluZ05hbWVzW19pIC0gM10gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmFsdWVJZGVudGlmaWVyID0gdmFsdWVJZGVudGlmaWVyOwoJICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwoJICAgICAgICBpZiAodHlwZW9mIHZhbHVlc1BhcmFtID09PSAnbnVtYmVyJykgewoJICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSBJbnQzMkFycmF5LmZyb20oW3ZhbHVlc1BhcmFtXSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlc1BhcmFtOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzOwoJICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVfSURFTlRJRklFUl9UT19FQ0kuc2V0KHZhbHVlSWRlbnRpZmllciwgdGhpcyk7CgkgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQobmFtZSwgdGhpcyk7CgkgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlczsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gdmFsdWVzLmxlbmd0aDsgaSAhPT0gbGVuZ3RoXzE7IGkrKykgewoJICAgICAgICAgICAgdmFyIHYgPSB2YWx1ZXNbaV07CgkgICAgICAgICAgICBDaGFyYWN0ZXJTZXRFQ0kuVkFMVUVTX1RPX0VDSS5zZXQodiwgdGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIG90aGVyRW5jb2RpbmdOYW1lc18xID0gX192YWx1ZXMob3RoZXJFbmNvZGluZ05hbWVzKSwgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKTsgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZTsgb3RoZXJFbmNvZGluZ05hbWVzXzFfMSA9IG90aGVyRW5jb2RpbmdOYW1lc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBvdGhlck5hbWUgPSBvdGhlckVuY29kaW5nTmFtZXNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSS5zZXQob3RoZXJOYW1lLCB0aGlzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKG90aGVyRW5jb2RpbmdOYW1lc18xXzEgJiYgIW90aGVyRW5jb2RpbmdOYW1lc18xXzEuZG9uZSAmJiAoX2EgPSBvdGhlckVuY29kaW5nTmFtZXNfMS5yZXR1cm4pKSBfYS5jYWxsKG90aGVyRW5jb2RpbmdOYW1lc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgIH0KCSAgICAvLyBDaGFyYWN0ZXJTZXRFQ0kodmFsdWU6IG51bWJlciAvKmludCovKSB7CgkgICAgLy8gICB0aGlzKG5ldyBJbnQzMkFycmF5IHt2YWx1ZX0pCgkgICAgLy8gfQoJICAgIC8vIENoYXJhY3RlclNldEVDSSh2YWx1ZTogbnVtYmVyIC8qaW50Ki8sIFN0cmluZy4uLiBvdGhlckVuY29kaW5nTmFtZXMpIHsKCSAgICAvLyAgIHRoaXMudmFsdWVzID0gbmV3IEludDMyQXJyYXkge3ZhbHVlfQoJICAgIC8vICAgdGhpcy5vdGhlckVuY29kaW5nTmFtZXMgPSBvdGhlckVuY29kaW5nTmFtZXMKCSAgICAvLyB9CgkgICAgLy8gQ2hhcmFjdGVyU2V0RUNJKHZhbHVlczogSW50MzJBcnJheSwgU3RyaW5nLi4uIG90aGVyRW5jb2RpbmdOYW1lcykgewoJICAgIC8vICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMKCSAgICAvLyAgIHRoaXMub3RoZXJFbmNvZGluZ05hbWVzID0gb3RoZXJFbmNvZGluZ05hbWVzCgkgICAgLy8gfQoJICAgIENoYXJhY3RlclNldEVDSS5wcm90b3R5cGUuZ2V0VmFsdWVJZGVudGlmaWVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUlkZW50aWZpZXI7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldE5hbWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm5hbWU7CgkgICAgfTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbMF07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmFsdWUgY2hhcmFjdGVyIHNldCBFQ0kgdmFsdWUKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBDaGFyYWN0ZXJTZXRFQ0l9IHJlcHJlc2VudGluZyBFQ0kgb2YgZ2l2ZW4gdmFsdWUsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwgYnV0CgkgICAgICogICB1bnN1cHBvcnRlZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIEVDSSB2YWx1ZSBpcyBpbnZhbGlkCgkgICAgICovCgkgICAgQ2hhcmFjdGVyU2V0RUNJLmdldENoYXJhY3RlclNldEVDSUJ5VmFsdWUgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPCAwIHx8IHZhbHVlID49IDkwMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGNoYXJhY3RlclNldCA9IENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJLmdldCh2YWx1ZSk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNoYXJhY3RlclNldCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoJ2luY29yZWN0IHZhbHVlJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGNoYXJhY3RlclNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBuYW1lIGNoYXJhY3RlciBzZXQgRUNJIGVuY29kaW5nIG5hbWUKCSAgICAgKiBAcmV0dXJuIENoYXJhY3RlclNldEVDSSByZXByZXNlbnRpbmcgRUNJIGZvciBjaGFyYWN0ZXIgZW5jb2RpbmcsIG9yIG51bGwgaWYgaXQgaXMgbGVnYWwKCSAgICAgKiAgIGJ1dCB1bnN1cHBvcnRlZAoJICAgICAqLwoJICAgIENoYXJhY3RlclNldEVDSS5nZXRDaGFyYWN0ZXJTZXRFQ0lCeU5hbWUgPSBmdW5jdGlvbiAobmFtZSkgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gQ2hhcmFjdGVyU2V0RUNJLk5BTUVfVE9fRUNJLmdldChuYW1lKTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgnaW5jb3JlY3QgdmFsdWUnKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY2hhcmFjdGVyU2V0OwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgQ2hhcmFjdGVyU2V0RUNJKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLmdldE5hbWUoKSA9PT0gb3RoZXIuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlZBTFVFX0lERU5USUZJRVJfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5WQUxVRVNfVE9fRUNJID0gbmV3IE1hcCgpOwoJICAgIENoYXJhY3RlclNldEVDSS5OQU1FX1RPX0VDSSA9IG5ldyBNYXAoKTsKCSAgICAvLyBFbnVtIG5hbWUgaXMgYSBKYXZhIGVuY29kaW5nIHZhbGlkIGZvciBqYXZhLmxhbmcgYW5kIGphdmEuaW8KCSAgICAvLyBUWVBFU0NSSVBUUE9SVDogY2hhbmdlZCB0aGUgbWFpbiBsYWJlbCBmb3IgSVNPIGFzIHRoZSBUZXh0RW5jb2RlciBkaWQgbm90IHJlY29nbml6ZWQgdGhlbSBpbiB0aGUgZm9ybSBmcm9tIGphdmEKCSAgICAvLyAoZWcgSVNPODg1OV8xIG11c3QgYmUgSVNPODg1OTEgb3IgSVNPODg1OS0xIG9yIElTTy04ODU5LTEpCgkgICAgLy8gbGF0ZXIgb246IHdlbGwsIGV4Y2VwdCAxNiB3aWNoIGRvZXMgbm90IHdvcmsgd2l0aCBJU084ODU5MTYgc28gdXNlZCBJU08tODg1OS0xIGZvcm0gZm9yIGRlZmF1bHQKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3A0MzcgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3A0MzcsIEludDMyQXJyYXkuZnJvbShbMCwgMl0pLCAnQ3A0MzcnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMSwgSW50MzJBcnJheS5mcm9tKFsxLCAzXSksICdJU08tODg1OS0xJywgJ0lTTzg4NTkxJywgJ0lTTzg4NTlfMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzIgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8yLCA0LCAnSVNPLTg4NTktMicsICdJU084ODU5MicsICdJU084ODU5XzInKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8zID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMywgNSwgJ0lTTy04ODU5LTMnLCAnSVNPODg1OTMnLCAnSVNPODg1OV8zJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzQsIDYsICdJU08tODg1OS00JywgJ0lTTzg4NTk0JywgJ0lTTzg4NTlfNCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV81LCA3LCAnSVNPLTg4NTktNScsICdJU084ODU5NScsICdJU084ODU5XzUnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV82ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfNiwgOCwgJ0lTTy04ODU5LTYnLCAnSVNPODg1OTYnLCAnSVNPODg1OV82Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfNyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzcsIDksICdJU08tODg1OS03JywgJ0lTTzg4NTk3JywgJ0lTTzg4NTlfNycpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV84LCAxMCwgJ0lTTy04ODU5LTgnLCAnSVNPODg1OTgnLCAnSVNPODg1OV84Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfOSA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzksIDExLCAnSVNPLTg4NTktOScsICdJU084ODU5OScsICdJU084ODU5XzknKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xMCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzEwLCAxMiwgJ0lTTy04ODU5LTEwJywgJ0lTTzg4NTkxMCcsICdJU084ODU5XzEwJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xMSwgMTMsICdJU08tODg1OS0xMScsICdJU084ODU5MTEnLCAnSVNPODg1OV8xMScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzEzID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTMsIDE1LCAnSVNPLTg4NTktMTMnLCAnSVNPODg1OTEzJywgJ0lTTzg4NTlfMTMnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuSVNPODg1OV8xNCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5JU084ODU5XzE0LCAxNiwgJ0lTTy04ODU5LTE0JywgJ0lTTzg4NTkxNCcsICdJU084ODU5XzE0Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLklTTzg4NTlfMTUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuSVNPODg1OV8xNSwgMTcsICdJU08tODg1OS0xNScsICdJU084ODU5MTUnLCAnSVNPODg1OV8xNScpOwoJICAgIENoYXJhY3RlclNldEVDSS5JU084ODU5XzE2ID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLklTTzg4NTlfMTYsIDE4LCAnSVNPLTg4NTktMTYnLCAnSVNPODg1OTE2JywgJ0lTTzg4NTlfMTYnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuU0pJUyA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5TSklTLCAyMCwgJ1NKSVMnLCAnU2hpZnRfSklTJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1MCA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTAsIDIxLCAnQ3AxMjUwJywgJ3dpbmRvd3MtMTI1MCcpOwoJICAgIENoYXJhY3RlclNldEVDSS5DcDEyNTEgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQ3AxMjUxLCAyMiwgJ0NwMTI1MScsICd3aW5kb3dzLTEyNTEnKTsKCSAgICBDaGFyYWN0ZXJTZXRFQ0kuQ3AxMjUyID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkNwMTI1MiwgMjMsICdDcDEyNTInLCAnd2luZG93cy0xMjUyJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkNwMTI1NiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5DcDEyNTYsIDI0LCAnQ3AxMjU2JywgJ3dpbmRvd3MtMTI1NicpOwoJICAgIENoYXJhY3RlclNldEVDSS5Vbmljb2RlQmlnVW5tYXJrZWQgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVW5pY29kZUJpZ1VubWFya2VkLCAyNSwgJ1VuaWNvZGVCaWdVbm1hcmtlZCcsICdVVEYtMTZCRScsICdVbmljb2RlQmlnJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLlVURjggPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuVVRGOCwgMjYsICdVVEY4JywgJ1VURi04Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkFTQ0lJID0gbmV3IENoYXJhY3RlclNldEVDSShDaGFyYWN0ZXJTZXRWYWx1ZUlkZW50aWZpZXJzLkFTQ0lJLCBJbnQzMkFycmF5LmZyb20oWzI3LCAxNzBdKSwgJ0FTQ0lJJywgJ1VTLUFTQ0lJJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkJpZzUgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuQmlnNSwgMjgsICdCaWc1Jyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkdCMTgwMzAgPSBuZXcgQ2hhcmFjdGVyU2V0RUNJKENoYXJhY3RlclNldFZhbHVlSWRlbnRpZmllcnMuR0IxODAzMCwgMjksICdHQjE4MDMwJywgJ0dCMjMxMicsICdFVUNfQ04nLCAnR0JLJyk7CgkgICAgQ2hhcmFjdGVyU2V0RUNJLkVVQ19LUiA9IG5ldyBDaGFyYWN0ZXJTZXRFQ0koQ2hhcmFjdGVyU2V0VmFsdWVJZGVudGlmaWVycy5FVUNfS1IsIDMwLCAnRVVDX0tSJywgJ0VVQy1LUicpOwoJICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0k7Cgl9KCkpOwoJZXhwb3J0cy5kZWZhdWx0ID0gQ2hhcmFjdGVyU2V0RUNJOwoKCX0oQ2hhcmFjdGVyU2V0RUNJKSk7CgoJdmFyIFN0cmluZ0VuY29kaW5nJDEgPSB7fTsKCgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNiA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZShVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbi5raW5kID0gJ1Vuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCkpOwoJVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb24kMS5kZWZhdWx0ID0gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb247CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ0VuY29kaW5nJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEgPSBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbiQxOwoJdmFyIENoYXJhY3RlclNldEVDSV8xJDIgPSBDaGFyYWN0ZXJTZXRFQ0k7CgkvKioKCSAqIFJlc3BvbnNpYmxlIGZvciBlbi9kZWNvZGluZyBzdHJpbmdzLgoJICovCgl2YXIgU3RyaW5nRW5jb2RpbmcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nRW5jb2RpbmcoKSB7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIERlY29kZXMgc29tZSBVaW50OEFycmF5IHRvIGEgc3RyaW5nIGZvcm1hdC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5kZWNvZGUgPSBmdW5jdGlvbiAoYnl0ZXMsIGVuY29kaW5nKSB7CgkgICAgICAgIHZhciBlbmNvZGluZ05hbWUgPSB0aGlzLmVuY29kaW5nTmFtZShlbmNvZGluZyk7CgkgICAgICAgIGlmICh0aGlzLmN1c3RvbURlY29kZXIpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmN1c3RvbURlY29kZXIoYnl0ZXMsIGVuY29kaW5nTmFtZSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSW5jcmVhc2VzIGJyb3dzZXIgc3VwcG9ydC4KCSAgICAgICAgaWYgKHR5cGVvZiBUZXh0RGVjb2RlciA9PT0gJ3VuZGVmaW5lZCcgfHwgdGhpcy5zaG91bGREZWNvZGVPbkZhbGxiYWNrKGVuY29kaW5nTmFtZSkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUZhbGxiYWNrKGJ5dGVzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoZW5jb2RpbmdOYW1lKS5kZWNvZGUoYnl0ZXMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ2hlY2tzIGlmIHRoZSBkZWNvZGluZyBtZXRob2Qgc2hvdWxkIHVzZSB0aGUgZmFsbGJhY2sgZm9yIGRlY29kaW5nCgkgICAgICogb25jZSBOb2RlIFRleHREZWNvZGVyIGRvZXNuJ3Qgc3VwcG9ydCBhbGwgZW5jb2RpbmcgZm9ybWF0cy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBlbmNvZGluZ05hbWUKCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5zaG91bGREZWNvZGVPbkZhbGxiYWNrID0gZnVuY3Rpb24gKGVuY29kaW5nTmFtZSkgewoJICAgICAgICByZXR1cm4gIVN0cmluZ0VuY29kaW5nLmlzQnJvd3NlcigpICYmIGVuY29kaW5nTmFtZSA9PT0gJ0lTTy04ODU5LTEnOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRW5jb2RlcyBzb21lIHN0cmluZyBpbnRvIGEgVWludDhBcnJheS4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGUgPSBmdW5jdGlvbiAocywgZW5jb2RpbmcpIHsKCSAgICAgICAgdmFyIGVuY29kaW5nTmFtZSA9IHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKTsKCSAgICAgICAgaWYgKHRoaXMuY3VzdG9tRW5jb2RlcikgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tRW5jb2RlcihzLCBlbmNvZGluZ05hbWUpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEluY3JlYXNlcyBicm93c2VyIHN1cHBvcnQuCgkgICAgICAgIGlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVGYWxsYmFjayhzKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBUZXh0RW5jb2RlciBvbmx5IGVuY29kZXMgdG8gVVRGOCBieSBkZWZhdWx0IGFzIHNwZWNpZmllZCBieSBlbmNvZGluZy5zcGVjLndoYXR3Zy5vcmcKCSAgICAgICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzQnJvd3NlciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB7fS50b1N0cmluZy5jYWxsKHdpbmRvdykgPT09ICdbb2JqZWN0IFdpbmRvd10nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHN0cmluZyB2YWx1ZSBmcm9tIHNvbWUgZW5jb2RpbmcgY2hhcmFjdGVyIHNldC4KCSAgICAgKi8KCSAgICBTdHJpbmdFbmNvZGluZy5lbmNvZGluZ05hbWUgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgcmV0dXJuIHR5cGVvZiBlbmNvZGluZyA9PT0gJ3N0cmluZycKCSAgICAgICAgICAgID8gZW5jb2RpbmcKCSAgICAgICAgICAgIDogZW5jb2RpbmcuZ2V0TmFtZSgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBjaGFyYWN0ZXIgc2V0IGZyb20gc29tZSBlbmNvZGluZyBjaGFyYWN0ZXIgc2V0LgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmVuY29kaW5nQ2hhcmFjdGVyU2V0ID0gZnVuY3Rpb24gKGVuY29kaW5nKSB7CgkgICAgICAgIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdCkgewoJICAgICAgICAgICAgcmV0dXJuIGVuY29kaW5nOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlOYW1lKGVuY29kaW5nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJ1bnMgYSBmYWxsYmFjayBmb3IgdGhlIG5hdGl2ZSBkZWNvZGluZyBmdW5jaW9uLgoJICAgICAqLwoJICAgIFN0cmluZ0VuY29kaW5nLmRlY29kZUZhbGxiYWNrID0gZnVuY3Rpb24gKGJ5dGVzLCBlbmNvZGluZykgewoJICAgICAgICB2YXIgY2hhcmFjdGVyU2V0ID0gdGhpcy5lbmNvZGluZ0NoYXJhY3RlclNldChlbmNvZGluZyk7CgkgICAgICAgIGlmIChTdHJpbmdFbmNvZGluZy5pc0RlY29kZUZhbGxiYWNrU3VwcG9ydGVkKGNoYXJhY3RlclNldCkpIHsKCSAgICAgICAgICAgIHZhciBzID0gJyc7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoXzEgPSBieXRlcy5sZW5ndGg7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGggPSBieXRlc1tpXS50b1N0cmluZygxNik7CgkgICAgICAgICAgICAgICAgaWYgKGgubGVuZ3RoIDwgMikgewoJICAgICAgICAgICAgICAgICAgICBoID0gJzAnICsgaDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcyArPSAnJScgKyBoOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzKTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuVW5pY29kZUJpZ1VubWFya2VkKSkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgbmV3IFVpbnQxNkFycmF5KGJ5dGVzLmJ1ZmZlcikpOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgiRW5jb2RpbmcgIiArIHRoaXMuZW5jb2RpbmdOYW1lKGVuY29kaW5nKSArICIgbm90IHN1cHBvcnRlZCBieSBmYWxsYmFjay4iKTsKCSAgICB9OwoJICAgIFN0cmluZ0VuY29kaW5nLmlzRGVjb2RlRmFsbGJhY2tTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoY2hhcmFjdGVyU2V0KSB7CgkgICAgICAgIHJldHVybiBjaGFyYWN0ZXJTZXQuZXF1YWxzKENoYXJhY3RlclNldEVDSV8xJDIuZGVmYXVsdC5VVEY4KSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuSVNPODg1OV8xKSB8fAoJICAgICAgICAgICAgY2hhcmFjdGVyU2V0LmVxdWFscyhDaGFyYWN0ZXJTZXRFQ0lfMSQyLmRlZmF1bHQuQVNDSUkpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUnVucyBhIGZhbGxiYWNrIGZvciB0aGUgbmF0aXZlIGVuY29kaW5nIGZ1bmNpb24uCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xNzE5Mjg0NS80MzY3NjgzCgkgICAgICovCgkgICAgU3RyaW5nRW5jb2RpbmcuZW5jb2RlRmFsbGJhY2sgPSBmdW5jdGlvbiAocykgewoJICAgICAgICB2YXIgZW5jb2RlZFVSSXN0cmluZyA9IGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHMpKSk7CgkgICAgICAgIHZhciBjaGFyTGlzdCA9IGVuY29kZWRVUklzdHJpbmcuc3BsaXQoJycpOwoJICAgICAgICB2YXIgdWludEFycmF5ID0gW107CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckxpc3QubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHVpbnRBcnJheS5wdXNoKGNoYXJMaXN0W2ldLmNoYXJDb2RlQXQoMCkpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSh1aW50QXJyYXkpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0VuY29kaW5nOwoJfSgpKTsKCVN0cmluZ0VuY29kaW5nJDEuZGVmYXVsdCA9IFN0cmluZ0VuY29kaW5nOwoKCS8qCgkgKiBDb3B5cmlnaHQgKEMpIDIwMTAgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0cmluZ1V0aWxzJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS5uaW8uY2hhcnNldC5DaGFyc2V0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQzID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSQxID0gQ2hhcmFjdGVyU2V0RUNJOwoJdmFyIFN0cmluZ0VuY29kaW5nXzEkMSA9IFN0cmluZ0VuY29kaW5nJDE7CgkvKioKCSAqIENvbW1vbiBzdHJpbmctcmVsYXRlZCBmdW5jdGlvbnMuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgQWxleCBEdXByZQoJICovCgl2YXIgU3RyaW5nVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nVXRpbHMoKSB7CgkgICAgfQoJICAgIC8vIFNISUZUX0pJUy5lcXVhbHNJZ25vcmVDYXNlKFBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcpIHx8CgkgICAgLy8gRVVDX0pQLmVxdWFsc0lnbm9yZUNhc2UoUExBVEZPUk1fREVGQVVMVF9FTkNPRElORyk7CgkgICAgU3RyaW5nVXRpbHMuY2FzdEFzTm9uVXRmOENoYXIgPSBmdW5jdGlvbiAoY29kZSwgZW5jb2RpbmcpIHsKCSAgICAgICAgaWYgKGVuY29kaW5nID09PSB2b2lkIDApIHsgZW5jb2RpbmcgPSBudWxsOyB9CgkgICAgICAgIC8vIElTTyA4ODU5LTEgaXMgdGhlIEphdmEgZGVmYXVsdCBhcyBVVEYtOCBpcyBKYXZhU2NyaXB0cwoJICAgICAgICAvLyB5b3UgY2FuIHNlZSB0aGlzIG1ldGhvZCBhcyBhIEphdmEgdmVyc2lvbiBvZiBTdHJpbmcuZnJvbUNoYXJDb2RlCgkgICAgICAgIHZhciBlID0gZW5jb2RpbmcgPyBlbmNvZGluZy5nZXROYW1lKCkgOiB0aGlzLklTTzg4NTkxOwoJICAgICAgICAvLyB1c2UgcGFzc2VkIGZvcm1hdCAoZnJvbUNoYXJDb2RlIHdpbGwgcmV0dXJuIFVURjggZW5jb2RpbmcpCgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5kZWNvZGUobmV3IFVpbnQ4QXJyYXkoW2NvZGVdKSwgZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYnl0ZXMgYnl0ZXMgZW5jb2RpbmcgYSBzdHJpbmcsIHdob3NlIGVuY29kaW5nIHNob3VsZCBiZSBndWVzc2VkCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kZSBoaW50cyBpZiBhcHBsaWNhYmxlCgkgICAgICogQHJldHVybiBuYW1lIG9mIGd1ZXNzZWQgZW5jb2Rpbmc7IGF0IHRoZSBtb21lbnQgd2lsbCBvbmx5IGd1ZXNzIG9uZSBvZjoKCSAgICAgKiAge0BsaW5rICNTSElGVF9KSVN9LCB7QGxpbmsgI1VURjh9LCB7QGxpbmsgI0lTTzg4NTkxfSwgb3IgdGhlIHBsYXRmb3JtCgkgICAgICogIGRlZmF1bHQgZW5jb2RpbmcgaWYgbm9uZSBvZiB0aGVzZSBjYW4gcG9zc2libHkgYmUgY29ycmVjdAoJICAgICAqLwoJICAgIFN0cmluZ1V0aWxzLmd1ZXNzRW5jb2RpbmcgPSBmdW5jdGlvbiAoYnl0ZXMsIGhpbnRzKSB7CgkgICAgICAgIGlmIChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpKSB7CgkgICAgICAgICAgICByZXR1cm4gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEkMy5kZWZhdWx0LkNIQVJBQ1RFUl9TRVQpLnRvU3RyaW5nKCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRm9yIG5vdywgbWVyZWx5IHRyaWVzIHRvIGRpc3Rpbmd1aXNoIElTTy04ODU5LTEsIFVURi04IGFuZCBTaGlmdF9KSVMsCgkgICAgICAgIC8vIHdoaWNoIHNob3VsZCBiZSBieSBmYXIgdGhlIG1vc3QgY29tbW9uIGVuY29kaW5ncy4KCSAgICAgICAgdmFyIGxlbmd0aCA9IGJ5dGVzLmxlbmd0aDsKCSAgICAgICAgdmFyIGNhbkJlSVNPODg1OTEgPSB0cnVlOwoJICAgICAgICB2YXIgY2FuQmVTaGlmdEpJUyA9IHRydWU7CgkgICAgICAgIHZhciBjYW5CZVVURjggPSB0cnVlOwoJICAgICAgICB2YXIgdXRmOEJ5dGVzTGVmdCA9IDA7CgkgICAgICAgIC8vIGludCB1dGY4TG93Q2hhcnMgPSAwCgkgICAgICAgIHZhciB1dGYyQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGYzQnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciB1dGY0Qnl0ZXNDaGFycyA9IDA7CgkgICAgICAgIHZhciBzamlzQnl0ZXNMZWZ0ID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNMb3dDaGFycyA9IDAKCSAgICAgICAgdmFyIHNqaXNLYXRha2FuYUNoYXJzID0gMDsKCSAgICAgICAgLy8gaW50IHNqaXNEb3VibGVCeXRlc0NoYXJzID0gMAoJICAgICAgICB2YXIgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgIHZhciBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgdmFyIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSAwOwoJICAgICAgICB2YXIgc2ppc01heERvdWJsZUJ5dGVzV29yZExlbmd0aCA9IDA7CgkgICAgICAgIC8vIGludCBpc29Mb3dDaGFycyA9IDAKCSAgICAgICAgLy8gaW50IGlzb0hpZ2hDaGFycyA9IDAKCSAgICAgICAgdmFyIGlzb0hpZ2hPdGhlciA9IDA7CgkgICAgICAgIHZhciB1dGY4Ym9tID0gYnl0ZXMubGVuZ3RoID4gMyAmJgoJICAgICAgICAgICAgYnl0ZXNbMF0gPT09IC8qKGJ5dGUpICovIDB4RUYgJiYKCSAgICAgICAgICAgIGJ5dGVzWzFdID09PSAvKihieXRlKSAqLyAweEJCICYmCgkgICAgICAgICAgICBieXRlc1syXSA9PT0gLyooYnl0ZSkgKi8gMHhCRjsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGggJiYgKGNhbkJlSVNPODg1OTEgfHwgY2FuQmVTaGlmdEpJUyB8fCBjYW5CZVVURjgpOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB2YWx1ZSA9IGJ5dGVzW2ldICYgMHhGRjsKCSAgICAgICAgICAgIC8vIFVURi04IHN0dWZmCgkgICAgICAgICAgICBpZiAoY2FuQmVVVEY4KSB7CgkgICAgICAgICAgICAgICAgaWYgKHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDgwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgY2FuQmVVVEY4ID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAoKHZhbHVlICYgMHg4MCkgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4NDApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjhCeXRlc0xlZnQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDIwKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjJCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh2YWx1ZSAmIDB4MTApID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjNCeXRlc0NoYXJzKys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGY4Qnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgodmFsdWUgJiAweDA4KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRmNEJ5dGVzQ2hhcnMrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbkJlVVRGOCA9IGZhbHNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfSAvLyBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyB1dGY4TG93Q2hhcnMrKwoJICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIElTTy04ODU5LTEgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICAgICAgaWYgKHZhbHVlID4gMHg3RiAmJiB2YWx1ZSA8IDB4QTApIHsKCSAgICAgICAgICAgICAgICAgICAgY2FuQmVJU084ODU5MSA9IGZhbHNlOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA+IDB4OUYpIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMHhDMCB8fCB2YWx1ZSA9PT0gMHhENyB8fCB2YWx1ZSA9PT0gMHhGNykgewoJICAgICAgICAgICAgICAgICAgICAgICAgaXNvSGlnaE90aGVyKys7CgkgICAgICAgICAgICAgICAgICAgIH0gLy8gZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGlzb0hpZ2hDaGFycysrCgkgICAgICAgICAgICAgICAgICAgIC8vIH0KCSAgICAgICAgICAgICAgICB9IC8vIGVsc2UgewoJICAgICAgICAgICAgICAgIC8vIGlzb0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAvLyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBTaGlmdF9KSVMgc3R1ZmYKCSAgICAgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTKSB7CgkgICAgICAgICAgICAgICAgaWYgKHNqaXNCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDB4NDAgfHwgdmFsdWUgPT09IDB4N0YgfHwgdmFsdWUgPiAweEZDKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBjYW5CZVNoaWZ0SklTID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0LS07CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPT09IDB4ODAgfHwgdmFsdWUgPT09IDB4QTAgfHwgdmFsdWUgPiAweEVGKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhbkJlU2hpZnRKSVMgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgPiAweEEwICYmIHZhbHVlIDwgMHhFMCkgewoJICAgICAgICAgICAgICAgICAgICBzamlzS2F0YWthbmFDaGFycysrOwoJICAgICAgICAgICAgICAgICAgICBzamlzQ3VyRG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gMDsKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCsrOwoJICAgICAgICAgICAgICAgICAgICBpZiAoc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA+IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPSBzamlzQ3VyS2F0YWthbmFXb3JkTGVuZ3RoOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlID4gMHg3RikgewoJICAgICAgICAgICAgICAgICAgICBzamlzQnl0ZXNMZWZ0Kys7CgkgICAgICAgICAgICAgICAgICAgIC8vIHNqaXNEb3VibGVCeXRlc0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGgrKzsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPiBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID0gc2ppc0N1ckRvdWJsZUJ5dGVzV29yZExlbmd0aDsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gc2ppc0xvd0NoYXJzKysKCSAgICAgICAgICAgICAgICAgICAgc2ppc0N1ckthdGFrYW5hV29yZExlbmd0aCA9IDA7CgkgICAgICAgICAgICAgICAgICAgIHNqaXNDdXJEb3VibGVCeXRlc1dvcmRMZW5ndGggPSAwOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmIHV0ZjhCeXRlc0xlZnQgPiAwKSB7CgkgICAgICAgICAgICBjYW5CZVVURjggPSBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY2FuQmVTaGlmdEpJUyAmJiBzamlzQnl0ZXNMZWZ0ID4gMCkgewoJICAgICAgICAgICAgY2FuQmVTaGlmdEpJUyA9IGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhc3kgLS0gaWYgdGhlcmUgaXMgQk9NIG9yIGF0IGxlYXN0IDEgdmFsaWQgbm90LXNpbmdsZSBieXRlIGNoYXJhY3RlciAoYW5kIG5vIGV2aWRlbmNlIGl0IGNhbid0IGJlIFVURi04KSwgZG9uZQoJICAgICAgICBpZiAoY2FuQmVVVEY4ICYmICh1dGY4Ym9tIHx8IHV0ZjJCeXRlc0NoYXJzICsgdXRmM0J5dGVzQ2hhcnMgKyB1dGY0Qnl0ZXNDaGFycyA+IDApKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuVVRGODsKCSAgICAgICAgfQoJICAgICAgICAvLyBFYXN5IC0tIGlmIGFzc3VtaW5nIFNoaWZ0X0pJUyBvciBhdCBsZWFzdCAzIHZhbGlkIGNvbnNlY3V0aXZlIG5vdC1hc2NpaSBjaGFyYWN0ZXJzIChhbmQgbm8gZXZpZGVuY2UgaXQgY2FuJ3QgYmUpLCBkb25lCgkgICAgICAgIGlmIChjYW5CZVNoaWZ0SklTICYmIChTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTIHx8IHNqaXNNYXhLYXRha2FuYVdvcmRMZW5ndGggPj0gMyB8fCBzamlzTWF4RG91YmxlQnl0ZXNXb3JkTGVuZ3RoID49IDMpKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuU0hJRlRfSklTOwoJICAgICAgICB9CgkgICAgICAgIC8vIERpc3Rpbmd1aXNoaW5nIFNoaWZ0X0pJUyBhbmQgSVNPLTg4NTktMSBjYW4gYmUgYSBsaXR0bGUgdG91Z2ggZm9yIHNob3J0IHdvcmRzLiBUaGUgY3J1ZGUgaGV1cmlzdGljIGlzOgoJICAgICAgICAvLyAtIElmIHdlIHNhdwoJICAgICAgICAvLyAgIC0gb25seSB0d28gY29uc2VjdXRpdmUga2F0YWthbmEgY2hhcnMgaW4gdGhlIHdob2xlIHRleHQsIG9yCgkgICAgICAgIC8vICAgLSBhdCBsZWFzdCAxMCUgb2YgYnl0ZXMgdGhhdCBjb3VsZCBiZSAidXBwZXIiIG5vdC1hbHBoYW51bWVyaWMgTGF0aW4xLAoJICAgICAgICAvLyAtIHRoZW4gd2UgY29uY2x1ZGUgU2hpZnRfSklTLCBlbHNlIElTTy04ODU5LTEKCSAgICAgICAgaWYgKGNhbkJlSVNPODg1OTEgJiYgY2FuQmVTaGlmdEpJUykgewoJICAgICAgICAgICAgcmV0dXJuIChzamlzTWF4S2F0YWthbmFXb3JkTGVuZ3RoID09PSAyICYmIHNqaXNLYXRha2FuYUNoYXJzID09PSAyKSB8fCBpc29IaWdoT3RoZXIgKiAxMCA+PSBsZW5ndGgKCSAgICAgICAgICAgICAgICA/IFN0cmluZ1V0aWxzLlNISUZUX0pJUyA6IFN0cmluZ1V0aWxzLklTTzg4NTkxOwoJICAgICAgICB9CgkgICAgICAgIC8vIE90aGVyd2lzZSwgdHJ5IGluIG9yZGVyIElTTy04ODU5LTEsIFNoaWZ0IEpJUywgVVRGLTggYW5kIGZhbGwgYmFjayB0byBkZWZhdWx0IHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIGlmIChjYW5CZUlTTzg4NTkxKSB7CgkgICAgICAgICAgICByZXR1cm4gU3RyaW5nVXRpbHMuSVNPODg1OTE7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlU2hpZnRKSVMpIHsKCSAgICAgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5TSElGVF9KSVM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNhbkJlVVRGOCkgewoJICAgICAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLlVURjg7CgkgICAgICAgIH0KCSAgICAgICAgLy8gT3RoZXJ3aXNlLCB3ZSB0YWtlIGEgd2lsZCBndWVzcyB3aXRoIHBsYXRmb3JtIGVuY29kaW5nCgkgICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5QTEFURk9STV9ERUZBVUxUX0VOQ09ESU5HOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKiBAc2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8xMzQzOTcxMS80MzY3NjgzCgkgICAgICoKCSAgICAgKiBAcGFyYW0gYXBwZW5kIFRoZSBuZXcgc3RyaW5nIHRvIGFwcGVuZC4KCSAgICAgKiBAcGFyYW0gYXJncyBBcmd1bWV0cyB2YWx1ZXMgdG8gYmUgZm9ybWF0ZWQuCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZm9ybWF0ID0gZnVuY3Rpb24gKGFwcGVuZCkgewoJICAgICAgICB2YXIgYXJncyA9IFtdOwoJICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewoJICAgICAgICAgICAgYXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaSA9IC0xOwoJICAgICAgICBmdW5jdGlvbiBjYWxsYmFjayhleHAsIHAwLCBwMSwgcDIsIHAzLCBwNCkgewoJICAgICAgICAgICAgaWYgKGV4cCA9PT0gJyUlJykKCSAgICAgICAgICAgICAgICByZXR1cm4gJyUnOwoJICAgICAgICAgICAgaWYgKGFyZ3NbKytpXSA9PT0gdW5kZWZpbmVkKQoJICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CgkgICAgICAgICAgICBleHAgPSBwMiA/IHBhcnNlSW50KHAyLnN1YnN0cigxKSkgOiB1bmRlZmluZWQ7CgkgICAgICAgICAgICB2YXIgYmFzZSA9IHAzID8gcGFyc2VJbnQocDMuc3Vic3RyKDEpKSA6IHVuZGVmaW5lZDsKCSAgICAgICAgICAgIHZhciB2YWw7CgkgICAgICAgICAgICBzd2l0Y2ggKHA0KSB7CgkgICAgICAgICAgICAgICAgY2FzZSAncyc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IGFyZ3NbaV07CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2MnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBhcmdzW2ldWzBdOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdmJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChhcmdzW2ldKS50b0ZpeGVkKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ3AnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvUHJlY2lzaW9uKGV4cCk7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIGNhc2UgJ2UnOgoJICAgICAgICAgICAgICAgICAgICB2YWwgPSBwYXJzZUZsb2F0KGFyZ3NbaV0pLnRvRXhwb25lbnRpYWwoZXhwKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgY2FzZSAneCc6CgkgICAgICAgICAgICAgICAgICAgIHZhbCA9IHBhcnNlSW50KGFyZ3NbaV0pLnRvU3RyaW5nKGJhc2UgPyBiYXNlIDogMTYpOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICBjYXNlICdkJzoKCSAgICAgICAgICAgICAgICAgICAgdmFsID0gcGFyc2VGbG9hdChwYXJzZUludChhcmdzW2ldLCBiYXNlID8gYmFzZSA6IDEwKS50b1ByZWNpc2lvbihleHApKS50b0ZpeGVkKDApOwoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhbCA9IHR5cGVvZiB2YWwgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkodmFsKSA6ICgrdmFsKS50b1N0cmluZyhiYXNlKTsKCSAgICAgICAgICAgIHZhciBzaXplID0gcGFyc2VJbnQocDEpOyAvKiBwYWRkaW5nIHNpemUgKi8KCSAgICAgICAgICAgIHZhciBjaCA9IHAxICYmIChwMVswXSArICcnKSA9PT0gJzAnID8gJzAnIDogJyAnOyAvKiBpc251bGw/ICovCgkgICAgICAgICAgICB3aGlsZSAodmFsLmxlbmd0aCA8IHNpemUpCgkgICAgICAgICAgICAgICAgdmFsID0gcDAgIT09IHVuZGVmaW5lZCA/IHZhbCArIGNoIDogY2ggKyB2YWw7IC8qIGlzbWludXM/ICovCgkgICAgICAgICAgICByZXR1cm4gdmFsOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZWdleCA9IC8lKC0pPygwP1swLTldKyk/KFsuXVswLTldKyk/KFsjXVswLTldKyk/KFtzY2ZwZXhkJV0pL2c7CgkgICAgICAgIHJldHVybiBhcHBlbmQucmVwbGFjZShyZWdleCwgY2FsbGJhY2spOwoJICAgIH07CgkgICAgLyoqCgkgICAgICoKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRCeXRlcyA9IGZ1bmN0aW9uIChzdHIsIGVuY29kaW5nKSB7CgkgICAgICAgIHJldHVybiBTdHJpbmdFbmNvZGluZ18xJDEuZGVmYXVsdC5lbmNvZGUoc3RyLCBlbmNvZGluZyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIHRoZSBjaGFyY29kZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4IG9yIGF0IGluZGV4IHplcm8uCgkgICAgICovCgkgICAgU3RyaW5nVXRpbHMuZ2V0Q2hhckNvZGUgPSBmdW5jdGlvbiAoc3RyLCBpbmRleCkgewoJICAgICAgICBpZiAoaW5kZXggPT09IHZvaWQgMCkgeyBpbmRleCA9IDA7IH0KCSAgICAgICAgcmV0dXJuIHN0ci5jaGFyQ29kZUF0KGluZGV4KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgY2hhciBmb3IgZ2l2ZW4gY2hhcmNvZGUKCSAgICAgKi8KCSAgICBTdHJpbmdVdGlscy5nZXRDaGFyQXQgPSBmdW5jdGlvbiAoY2hhckNvZGUpIHsKCSAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUpOwoJICAgIH07CgkgICAgU3RyaW5nVXRpbHMuU0hJRlRfSklTID0gQ2hhcmFjdGVyU2V0RUNJXzEkMS5kZWZhdWx0LlNKSVMuZ2V0TmFtZSgpOyAvLyAiU0pJUyIKCSAgICBTdHJpbmdVdGlscy5HQjIzMTIgPSAnR0IyMzEyJzsKCSAgICBTdHJpbmdVdGlscy5JU084ODU5MSA9IENoYXJhY3RlclNldEVDSV8xJDEuZGVmYXVsdC5JU084ODU5XzEuZ2V0TmFtZSgpOyAvLyAiSVNPODg1OV8xIgoJICAgIFN0cmluZ1V0aWxzLkVVQ19KUCA9ICdFVUNfSlAnOwoJICAgIFN0cmluZ1V0aWxzLlVURjggPSBDaGFyYWN0ZXJTZXRFQ0lfMSQxLmRlZmF1bHQuVVRGOC5nZXROYW1lKCk7IC8vICJVVEY4IgoJICAgIFN0cmluZ1V0aWxzLlBMQVRGT1JNX0RFRkFVTFRfRU5DT0RJTkcgPSBTdHJpbmdVdGlscy5VVEY4OyAvLyAiVVRGOCIvL0NoYXJzZXQuZGVmYXVsdENoYXJzZXQoKS5uYW1lKCkKCSAgICBTdHJpbmdVdGlscy5BU1NVTUVfU0hJRlRfSklTID0gZmFsc2U7CgkgICAgcmV0dXJuIFN0cmluZ1V0aWxzOwoJfSgpKTsKCVN0cmluZ1V0aWxzJDEuZGVmYXVsdCA9IFN0cmluZ1V0aWxzOwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHJpbmdCdWlsZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBTdHJpbmdVdGlsc18xJDEgPSBTdHJpbmdVdGlscyQxOwoJdmFyIFN0cmluZ0J1aWxkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gU3RyaW5nQnVpbGRlcih2YWx1ZSkgewoJICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgeyB2YWx1ZSA9ICcnOyB9CgkgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKCSAgICB9CgkgICAgU3RyaW5nQnVpbGRlci5wcm90b3R5cGUuZW5hYmxlRGVjb2RpbmcgPSBmdW5jdGlvbiAoZW5jb2RpbmcpIHsKCSAgICAgICAgdGhpcy5lbmNvZGluZyA9IGVuY29kaW5nOwoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZCA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIGlmICh0eXBlb2YgcyA9PT0gJ3N0cmluZycpIHsKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gcy50b1N0cmluZygpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHRoaXMuZW5jb2RpbmcpIHsKCSAgICAgICAgICAgIC8vIHVzZSBwYXNzZWQgZm9ybWF0IChmcm9tQ2hhckNvZGUgd2lsbCByZXR1cm4gVVRGOCBlbmNvZGluZykKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nVXRpbHNfMSQxLmRlZmF1bHQuY2FzdEFzTm9uVXRmOENoYXIocywgdGhpcy5lbmNvZGluZyk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBjb3JyZWN0bHkgY29udmVydHMgZnJvbSBVVEYtOCwgYnV0IG5vdCBvdGhlciBlbmNvZGluZ3MKCSAgICAgICAgICAgIHRoaXMudmFsdWUgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShzKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpczsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmFwcGVuZENoYXJzID0gZnVuY3Rpb24gKHN0ciwgb2Zmc2V0LCBsZW4pIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldDsgb2Zmc2V0IDwgb2Zmc2V0ICsgbGVuOyBpKyspIHsKCSAgICAgICAgICAgIHRoaXMuYXBwZW5kKHN0cltpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5sZW5ndGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmxlbmd0aDsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlLmNoYXJBdChuKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmRlbGV0ZUNoYXJBdCA9IGZ1bmN0aW9uIChuKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIHRoaXMudmFsdWUuc3Vic3RyaW5nKG4gKyAxKTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnNldENoYXJBdCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgMSk7CgkgICAgfTsKCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zdWJzdHJpbmcgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZS5zdWJzdHJpbmcoc3RhcnQsIGVuZCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAbm90ZSBoZWxwZXIgbWV0aG9kIGZvciBSU1MgRXhwYW5kZWQKCSAgICAgKi8KCSAgICBTdHJpbmdCdWlsZGVyLnByb3RvdHlwZS5zZXRMZW5ndGhUb1plcm8gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSAnJzsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIFN0cmluZ0J1aWxkZXIucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChuLCBjKSB7CgkgICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlLnN1YnN0cigwLCBuKSArIGMgKyB0aGlzLnZhbHVlLnN1YnN0cihuICsgYy5sZW5ndGgpOwoJICAgIH07CgkgICAgcmV0dXJuIFN0cmluZ0J1aWxkZXI7Cgl9KCkpOwoJU3RyaW5nQnVpbGRlciQxLmRlZmF1bHQgPSBTdHJpbmdCdWlsZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQml0TWF0cml4JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5czsqLwoJdmFyIEJpdEFycmF5XzEkMSA9IEJpdEFycmF5JDE7Cgl2YXIgU3lzdGVtXzEkMyA9IFN5c3RlbSQxOwoJdmFyIEFycmF5c18xID0gQXJyYXlzJDE7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDIgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNyA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgMkQgbWF0cml4IG9mIGJpdHMuIEluIGZ1bmN0aW9uIGFyZ3VtZW50cyBiZWxvdywgYW5kIHRocm91Z2hvdXQgdGhlIGNvbW1vbgoJICogbW9kdWxlLCB4IGlzIHRoZSBjb2x1bW4gcG9zaXRpb24sIGFuZCB5IGlzIHRoZSByb3cgcG9zaXRpb24uIFRoZSBvcmRlcmluZyBpcyBhbHdheXMgeCwgeS4KCSAqIFRoZSBvcmlnaW4gaXMgYXQgdGhlIHRvcC1sZWZ0LjwvcD4KCSAqCgkgKiA8cD5JbnRlcm5hbGx5IHRoZSBiaXRzIGFyZSByZXByZXNlbnRlZCBpbiBhIDEtRCBhcnJheSBvZiAzMi1iaXQgaW50cy4gSG93ZXZlciwgZWFjaCByb3cgYmVnaW5zCgkgKiB3aXRoIGEgbmV3IGludC4gVGhpcyBpcyBkb25lIGludGVudGlvbmFsbHkgc28gdGhhdCB3ZSBjYW4gY29weSBvdXQgYSByb3cgaW50byBhIEJpdEFycmF5IHZlcnkKCSAqIGVmZmljaWVudGx5LjwvcD4KCSAqCgkgKiA8cD5UaGUgb3JkZXJpbmcgb2YgYml0cyBpcyByb3ctbWFqb3IuIFdpdGhpbiBlYWNoIGludCwgdGhlIGxlYXN0IHNpZ25pZmljYW50IGJpdHMgYXJlIHVzZWQgZmlyc3QsCgkgKiBtZWFuaW5nIHRoZXkgcmVwcmVzZW50IGxvd2VyIHggdmFsdWVzLiBUaGlzIGlzIGNvbXBhdGlibGUgd2l0aCBCaXRBcnJheSdzIGltcGxlbWVudGF0aW9uLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqLwoJdmFyIEJpdE1hdHJpeCAvKmltcGxlbWVudHMgQ2xvbmVhYmxlKi8gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSBzcXVhcmUge0BsaW5rIEJpdE1hdHJpeH0uCgkgICAgICoKCSAgICAgKiBAcGFyYW0gZGltZW5zaW9uIGhlaWdodCBhbmQgd2lkdGgKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoZGltZW5zaW9uOiBudW1iZXIgLyppbnQqLykgewoJICAgIC8vICAgdGhpcyhkaW1lbnNpb24sIGRpbWVuc2lvbikKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogQ3JlYXRlcyBhbiBlbXB0eSB7QGxpbmsgQml0TWF0cml4fS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB3aWR0aCBiaXQgbWF0cml4IHdpZHRoCgkgICAgICogQHBhcmFtIGhlaWdodCBiaXQgbWF0cml4IGhlaWdodAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyIC8qaW50Ki8sIGhlaWdodDogbnVtYmVyIC8qaW50Ki8pIHsKCSAgICAvLyAgIGlmICh3aWR0aCA8IDEgfHwgaGVpZ2h0IDwgMSkgewoJICAgIC8vICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJCb3RoIGRpbWVuc2lvbnMgbXVzdCBiZSBncmVhdGVyIHRoYW4gMCIpCgkgICAgLy8gICB9CgkgICAgLy8gICB0aGlzLndpZHRoID0gd2lkdGgKCSAgICAvLyAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0CgkgICAgLy8gICB0aGlzLnJvd1NpemUgPSAod2lkdGggKyAzMSkgLyAzMgoJICAgIC8vICAgYml0cyA9IG5ldyBpbnRbcm93U2l6ZSAqIGhlaWdodF07CgkgICAgLy8gfQoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeCh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgcm93U2l6ZSAvKmludCovLCBiaXRzKSB7CgkgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKCSAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkgICAgICAgIHRoaXMucm93U2l6ZSA9IHJvd1NpemU7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGhlaWdodCB8fCBudWxsID09PSBoZWlnaHQpIHsKCSAgICAgICAgICAgIGhlaWdodCA9IHdpZHRoOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgICAgICBpZiAod2lkdGggPCAxIHx8IGhlaWdodCA8IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0JvdGggZGltZW5zaW9ucyBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAwJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gcm93U2l6ZSB8fCBudWxsID09PSByb3dTaXplKSB7CgkgICAgICAgICAgICByb3dTaXplID0gTWF0aC5mbG9vcigod2lkdGggKyAzMSkgLyAzMik7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yb3dTaXplID0gcm93U2l6ZTsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gYml0cyB8fCBudWxsID09PSBiaXRzKSB7CgkgICAgICAgICAgICB0aGlzLmJpdHMgPSBuZXcgSW50MzJBcnJheSh0aGlzLnJvd1NpemUgKiB0aGlzLmhlaWdodCk7CgkgICAgICAgIH0KCSAgICB9CgkgICAgLyoqCgkgICAgICogSW50ZXJwcmV0cyBhIDJEIGFycmF5IG9mIGJvb2xlYW5zIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0sIHdoZXJlICJ0cnVlIiBtZWFucyBhbiAib24iIGJpdC4KCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBpbWFnZSBiaXRzIG9mIHRoZSBpbWFnZSwgYXMgYSByb3ctbWFqb3IgMkQgYXJyYXkuIEVsZW1lbnRzIGFyZSBhcnJheXMgcmVwcmVzZW50aW5nIHJvd3MKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCaXRNYXRyaXh9IHJlcHJlc2VudGF0aW9uIG9mIGltYWdlCgkgICAgICovCgkgICAgQml0TWF0cml4LnBhcnNlRnJvbUJvb2xlYW5BcnJheSA9IGZ1bmN0aW9uIChpbWFnZSkgewoJICAgICAgICB2YXIgaGVpZ2h0ID0gaW1hZ2UubGVuZ3RoOwoJICAgICAgICB2YXIgd2lkdGggPSBpbWFnZVswXS5sZW5ndGg7CgkgICAgICAgIHZhciBiaXRzID0gbmV3IEJpdE1hdHJpeCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewoJICAgICAgICAgICAgdmFyIGltYWdlSSA9IGltYWdlW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CgkgICAgICAgICAgICAgICAgaWYgKGltYWdlSVtqXSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldChqLCBpKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKgoJICAgICAqIEBmdW5jdGlvbiBwYXJzZQoJICAgICAqIEBwYXJhbSBzdHJpbmdSZXByZXNlbnRhdGlvbgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcKCSAgICAgKiBAcGFyYW0gdW5zZXRTdHJpbmcKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucGFyc2VGcm9tU3RyaW5nID0gZnVuY3Rpb24gKHN0cmluZ1JlcHJlc2VudGF0aW9uLCBzZXRTdHJpbmcsIHVuc2V0U3RyaW5nKSB7CgkgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnc3RyaW5nUmVwcmVzZW50YXRpb24gY2Fubm90IGJlIG51bGwnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBBcnJheShzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpOwoJICAgICAgICB2YXIgYml0c1BvcyA9IDA7CgkgICAgICAgIHZhciByb3dTdGFydFBvcyA9IDA7CgkgICAgICAgIHZhciByb3dMZW5ndGggPSAtMTsKCSAgICAgICAgdmFyIG5Sb3dzID0gMDsKCSAgICAgICAgdmFyIHBvcyA9IDA7CgkgICAgICAgIHdoaWxlIChwb3MgPCBzdHJpbmdSZXByZXNlbnRhdGlvbi5sZW5ndGgpIHsKCSAgICAgICAgICAgIGlmIChzdHJpbmdSZXByZXNlbnRhdGlvbi5jaGFyQXQocG9zKSA9PT0gJ1xuJyB8fAoJICAgICAgICAgICAgICAgIHN0cmluZ1JlcHJlc2VudGF0aW9uLmNoYXJBdChwb3MpID09PSAnXHInKSB7CgkgICAgICAgICAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgICAgICAgICBpZiAocm93TGVuZ3RoID09PSAtMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcm93TGVuZ3RoID0gYml0c1BvcyAtIHJvd1N0YXJ0UG9zOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJpdHNQb3MgLSByb3dTdGFydFBvcyAhPT0gcm93TGVuZ3RoKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdyb3cgbGVuZ3RocyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICByb3dTdGFydFBvcyA9IGJpdHNQb3M7CgkgICAgICAgICAgICAgICAgICAgIG5Sb3dzKys7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHBvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoc3RyaW5nUmVwcmVzZW50YXRpb24uc3Vic3RyaW5nKHBvcywgcG9zICsgc2V0U3RyaW5nLmxlbmd0aCkgPT09IHNldFN0cmluZykgewoJICAgICAgICAgICAgICAgIHBvcyArPSBzZXRTdHJpbmcubGVuZ3RoOwoJICAgICAgICAgICAgICAgIGJpdHNbYml0c1Bvc10gPSB0cnVlOwoJICAgICAgICAgICAgICAgIGJpdHNQb3MrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHN0cmluZ1JlcHJlc2VudGF0aW9uLnN1YnN0cmluZyhwb3MsIHBvcyArIHVuc2V0U3RyaW5nLmxlbmd0aCkgPT09IHVuc2V0U3RyaW5nKSB7CgkgICAgICAgICAgICAgICAgcG9zICs9IHVuc2V0U3RyaW5nLmxlbmd0aDsKCSAgICAgICAgICAgICAgICBiaXRzW2JpdHNQb3NdID0gZmFsc2U7CgkgICAgICAgICAgICAgICAgYml0c1BvcysrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnaWxsZWdhbCBjaGFyYWN0ZXIgZW5jb3VudGVyZWQ6ICcgKyBzdHJpbmdSZXByZXNlbnRhdGlvbi5zdWJzdHJpbmcocG9zKSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gbm8gRU9MIGF0IGVuZD8KCSAgICAgICAgaWYgKGJpdHNQb3MgPiByb3dTdGFydFBvcykgewoJICAgICAgICAgICAgaWYgKHJvd0xlbmd0aCA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICByb3dMZW5ndGggPSBiaXRzUG9zIC0gcm93U3RhcnRQb3M7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmIChiaXRzUG9zIC0gcm93U3RhcnRQb3MgIT09IHJvd0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ3JvdyBsZW5ndGhzIGRvIG5vdCBtYXRjaCcpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgblJvd3MrKzsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbWF0cml4ID0gbmV3IEJpdE1hdHJpeChyb3dMZW5ndGgsIG5Sb3dzKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaXRzUG9zOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChiaXRzW2ldKSB7CgkgICAgICAgICAgICAgICAgbWF0cml4LnNldChNYXRoLmZsb29yKGkgJSByb3dMZW5ndGgpLCBNYXRoLmZsb29yKGkgLyByb3dMZW5ndGgpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbWF0cml4OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+R2V0cyB0aGUgcmVxdWVzdGVkIGJpdCwgd2hlcmUgdHJ1ZSBtZWFucyBibGFjay48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0geCBUaGUgaG9yaXpvbnRhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggY29sdW1uKQoJICAgICAqIEBwYXJhbSB5IFRoZSB2ZXJ0aWNhbCBjb21wb25lbnQgKGkuZS4gd2hpY2ggcm93KQoJICAgICAqIEByZXR1cm4gdmFsdWUgb2YgZ2l2ZW4gYml0IGluIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKHggLyppbnQqLywgeSAvKmludCovKSB7CgkgICAgICAgIHZhciBvZmZzZXQgPSB5ICogdGhpcy5yb3dTaXplICsgTWF0aC5mbG9vcih4IC8gMzIpOwoJICAgICAgICByZXR1cm4gKCh0aGlzLmJpdHNbb2Zmc2V0XSA+Pj4gKHggJiAweDFmKSkgJiAxKSAhPT0gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgdGhlIGdpdmVuIGJpdCB0byB0cnVlLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB4IFRoZSBob3Jpem9udGFsIGNvbXBvbmVudCAoaS5lLiB3aGljaCBjb2x1bW4pCgkgICAgICogQHBhcmFtIHkgVGhlIHZlcnRpY2FsIGNvbXBvbmVudCAoaS5lLiB3aGljaCByb3cpCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIHw9ICgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRjsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUudW5zZXQgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdICY9IH4oKDEgPDwgKHggJiAweDFmKSkgJiAweEZGRkZGRkZGKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkZsaXBzIHRoZSBnaXZlbiBiaXQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHggVGhlIGhvcml6b250YWwgY29tcG9uZW50IChpLmUuIHdoaWNoIGNvbHVtbikKCSAgICAgKiBAcGFyYW0geSBUaGUgdmVydGljYWwgY29tcG9uZW50IChpLmUuIHdoaWNoIHJvdykKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmZsaXAgPSBmdW5jdGlvbiAoeCAvKmludCovLCB5IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiB0aGlzLnJvd1NpemUgKyBNYXRoLmZsb29yKHggLyAzMik7CgkgICAgICAgIHRoaXMuYml0c1tvZmZzZXRdIF49ICgoMSA8PCAoeCAmIDB4MWYpKSAmIDB4RkZGRkZGRkYpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRXhjbHVzaXZlLW9yIChYT1IpOiBGbGlwIHRoZSBiaXQgaW4gdGhpcyB7QGNvZGUgQml0TWF0cml4fSBpZiB0aGUgY29ycmVzcG9uZGluZwoJICAgICAqIG1hc2sgYml0IGlzIHNldC4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBtYXNrIFhPUiBtYXNrCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS54b3IgPSBmdW5jdGlvbiAobWFzaykgewoJICAgICAgICBpZiAodGhpcy53aWR0aCAhPT0gbWFzay5nZXRXaWR0aCgpIHx8IHRoaXMuaGVpZ2h0ICE9PSBtYXNrLmdldEhlaWdodCgpCgkgICAgICAgICAgICB8fCB0aGlzLnJvd1NpemUgIT09IG1hc2suZ2V0Um93U2l6ZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdpbnB1dCBtYXRyaXggZGltZW5zaW9ucyBkbyBub3QgbWF0Y2gnKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcm93QXJyYXkgPSBuZXcgQml0QXJyYXlfMSQxLmRlZmF1bHQoTWF0aC5mbG9vcih0aGlzLndpZHRoIC8gMzIpICsgMSk7CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIHZhciBvZmZzZXQgPSB5ICogcm93U2l6ZTsKCSAgICAgICAgICAgIHZhciByb3cgPSBtYXNrLmdldFJvdyh5LCByb3dBcnJheSkuZ2V0Qml0QXJyYXkoKTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgcm93U2l6ZTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgYml0c1tvZmZzZXQgKyB4XSBePSByb3dbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIENsZWFycyBhbGwgYml0cyAoc2V0cyB0byBmYWxzZSkuCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBtYXggPSBiaXRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkrKykgewoJICAgICAgICAgICAgYml0c1tpXSA9IDA7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlNldHMgYSBzcXVhcmUgcmVnaW9uIG9mIHRoZSBiaXQgbWF0cml4IHRvIHRydWUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGxlZnQgVGhlIGhvcml6b250YWwgcG9zaXRpb24gdG8gYmVnaW4gYXQgKGluY2x1c2l2ZSkKCSAgICAgKiBAcGFyYW0gdG9wIFRoZSB2ZXJ0aWNhbCBwb3NpdGlvbiB0byBiZWdpbiBhdCAoaW5jbHVzaXZlKQoJICAgICAqIEBwYXJhbSB3aWR0aCBUaGUgd2lkdGggb2YgdGhlIHJlZ2lvbgoJICAgICAqIEBwYXJhbSBoZWlnaHQgVGhlIGhlaWdodCBvZiB0aGUgcmVnaW9uCgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5zZXRSZWdpb24gPSBmdW5jdGlvbiAobGVmdCAvKmludCovLCB0b3AgLyppbnQqLywgd2lkdGggLyppbnQqLywgaGVpZ2h0IC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHRvcCA8IDAgfHwgbGVmdCA8IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ3LmRlZmF1bHQoJ0xlZnQgYW5kIHRvcCBtdXN0IGJlIG5vbm5lZ2F0aXZlJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGhlaWdodCA8IDEgfHwgd2lkdGggPCAxKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNy5kZWZhdWx0KCdIZWlnaHQgYW5kIHdpZHRoIG11c3QgYmUgYXQgbGVhc3QgMScpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByaWdodCA9IGxlZnQgKyB3aWR0aDsKCSAgICAgICAgdmFyIGJvdHRvbSA9IHRvcCArIGhlaWdodDsKCSAgICAgICAgaWYgKGJvdHRvbSA+IHRoaXMuaGVpZ2h0IHx8IHJpZ2h0ID4gdGhpcy53aWR0aCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDcuZGVmYXVsdCgnVGhlIHJlZ2lvbiBtdXN0IGZpdCBpbnNpZGUgdGhlIG1hdHJpeCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgZm9yICh2YXIgeSA9IHRvcDsgeSA8IGJvdHRvbTsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHJvd1NpemU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gbGVmdDsgeCA8IHJpZ2h0OyB4KyspIHsKCSAgICAgICAgICAgICAgICBiaXRzW29mZnNldCArIE1hdGguZmxvb3IoeCAvIDMyKV0gfD0gKCgxIDw8ICh4ICYgMHgxZikpICYgMHhGRkZGRkZGRik7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEEgZmFzdCBtZXRob2QgdG8gcmV0cmlldmUgb25lIHJvdyBvZiBkYXRhIGZyb20gdGhlIG1hdHJpeCBhcyBhIEJpdEFycmF5LgoJICAgICAqCgkgICAgICogQHBhcmFtIHkgVGhlIHJvdyB0byByZXRyaWV2ZQoJICAgICAqIEBwYXJhbSByb3cgQW4gb3B0aW9uYWwgY2FsbGVyLWFsbG9jYXRlZCBCaXRBcnJheSwgd2lsbCBiZSBhbGxvY2F0ZWQgaWYgbnVsbCBvciB0b28gc21hbGwKCSAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHRpbmcgQml0QXJyYXkgLSB0aGlzIHJlZmVyZW5jZSBzaG91bGQgYWx3YXlzIGJlIHVzZWQgZXZlbiB3aGVuIHBhc3NpbmcKCSAgICAgKiAgICAgICAgIHlvdXIgb3duIHJvdwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Um93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIGlmIChyb3cgPT09IG51bGwgfHwgcm93ID09PSB1bmRlZmluZWQgfHwgcm93LmdldFNpemUoKSA8IHRoaXMud2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh0aGlzLndpZHRoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHJvdy5jbGVhcigpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByb3dTaXplID0gdGhpcy5yb3dTaXplOwoJICAgICAgICB2YXIgYml0cyA9IHRoaXMuYml0czsKCSAgICAgICAgdmFyIG9mZnNldCA9IHkgKiByb3dTaXplOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHJvd1NpemU7IHgrKykgewoJICAgICAgICAgICAgcm93LnNldEJ1bGsoeCAqIDMyLCBiaXRzW29mZnNldCArIHhdKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIHkgcm93IHRvIHNldAoJICAgICAqIEBwYXJhbSByb3cge0BsaW5rIEJpdEFycmF5fSB0byBjb3B5IGZyb20KCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLnNldFJvdyA9IGZ1bmN0aW9uICh5IC8qaW50Ki8sIHJvdykgewoJICAgICAgICBTeXN0ZW1fMSQzLmRlZmF1bHQuYXJyYXljb3B5KHJvdy5nZXRCaXRBcnJheSgpLCAwLCB0aGlzLmJpdHMsIHkgKiB0aGlzLnJvd1NpemUsIHRoaXMucm93U2l6ZSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBNb2RpZmllcyB0aGlzIHtAY29kZSBCaXRNYXRyaXh9IHRvIHJlcHJlc2VudCB0aGUgc2FtZSBidXQgcm90YXRlZCAxODAgZGVncmVlcwoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUucm90YXRlMTgwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgdG9wUm93ID0gbmV3IEJpdEFycmF5XzEkMS5kZWZhdWx0KHdpZHRoKTsKCSAgICAgICAgdmFyIGJvdHRvbVJvdyA9IG5ldyBCaXRBcnJheV8xJDEuZGVmYXVsdCh3aWR0aCk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IE1hdGguZmxvb3IoKGhlaWdodCArIDEpIC8gMik7IGkgPCBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB0b3BSb3cgPSB0aGlzLmdldFJvdyhpLCB0b3BSb3cpOwoJICAgICAgICAgICAgYm90dG9tUm93ID0gdGhpcy5nZXRSb3coaGVpZ2h0IC0gMSAtIGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0b3BSb3cucmV2ZXJzZSgpOwoJICAgICAgICAgICAgYm90dG9tUm93LnJldmVyc2UoKTsKCSAgICAgICAgICAgIHRoaXMuc2V0Um93KGksIGJvdHRvbVJvdyk7CgkgICAgICAgICAgICB0aGlzLnNldFJvdyhoZWlnaHQgLSAxIC0gaSwgdG9wUm93KTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIHRoZSBlbmNsb3NpbmcgcmVjdGFuZ2xlIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSBsZWZ0LHRvcCx3aWR0aCxoZWlnaHR9IGVuY2xvc2luZyByZWN0YW5nbGUgb2YgYWxsIDEgYml0cywgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldEVuY2xvc2luZ1JlY3RhbmdsZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIGhlaWdodCA9IHRoaXMuaGVpZ2h0OwoJICAgICAgICB2YXIgcm93U2l6ZSA9IHRoaXMucm93U2l6ZTsKCSAgICAgICAgdmFyIGJpdHMgPSB0aGlzLmJpdHM7CgkgICAgICAgIHZhciBsZWZ0ID0gd2lkdGg7CgkgICAgICAgIHZhciB0b3AgPSBoZWlnaHQ7CgkgICAgICAgIHZhciByaWdodCA9IC0xOwoJICAgICAgICB2YXIgYm90dG9tID0gLTE7CgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHgzMiA9IDA7IHgzMiA8IHJvd1NpemU7IHgzMisrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHRoZUJpdHMgPSBiaXRzW3kgKiByb3dTaXplICsgeDMyXTsKCSAgICAgICAgICAgICAgICBpZiAodGhlQml0cyAhPT0gMCkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA8IHRvcCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdG9wID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeSA+IGJvdHRvbSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgYm90dG9tID0geTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBpZiAoeDMyICogMzIgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYml0ID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdCsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPCBsZWZ0KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVmdCA9IHgzMiAqIDMyICsgYml0OwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGlmICh4MzIgKiAzMiArIDMxID4gcmlnaHQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBiaXQgPSAzMTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgodGhlQml0cyA+Pj4gYml0KSA9PT0gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh4MzIgKiAzMiArIGJpdCkgPiByaWdodCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJpZ2h0ID0geDMyICogMzIgKyBiaXQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJpZ2h0IDwgbGVmdCB8fCBib3R0b20gPCB0b3ApIHsKCSAgICAgICAgICAgIHJldHVybiBudWxsOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2xlZnQsIHRvcCwgcmlnaHQgLSBsZWZ0ICsgMSwgYm90dG9tIC0gdG9wICsgMV0pOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogVGhpcyBpcyB1c2VmdWwgaW4gZGV0ZWN0aW5nIGEgY29ybmVyIG9mIGEgJ3B1cmUnIGJhcmNvZGUuCgkgICAgICoKCSAgICAgKiBAcmV0dXJuIHtAY29kZSB4LHl9IGNvb3JkaW5hdGUgb2YgdG9wLWxlZnQtbW9zdCAxIGJpdCwgb3IgbnVsbCBpZiBpdCBpcyBhbGwgd2hpdGUKCSAgICAgKi8KCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmdldFRvcExlZnRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IDA7CgkgICAgICAgIHdoaWxlIChiaXRzT2Zmc2V0IDwgYml0cy5sZW5ndGggJiYgYml0c1tiaXRzT2Zmc2V0XSA9PT0gMCkgewoJICAgICAgICAgICAgYml0c09mZnNldCsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChiaXRzT2Zmc2V0ID09PSBiaXRzLmxlbmd0aCkgewoJICAgICAgICAgICAgcmV0dXJuIG51bGw7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHkgPSBiaXRzT2Zmc2V0IC8gcm93U2l6ZTsKCSAgICAgICAgdmFyIHggPSAoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDA7CgkgICAgICAgIHdoaWxlICgoKHRoZUJpdHMgPDwgKDMxIC0gYml0KSkgJiAweEZGRkZGRkZGKSA9PT0gMCkgewoJICAgICAgICAgICAgYml0Kys7CgkgICAgICAgIH0KCSAgICAgICAgeCArPSBiaXQ7CgkgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW3gsIHldKTsKCSAgICB9OwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0Qm90dG9tUmlnaHRPbkJpdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJvd1NpemUgPSB0aGlzLnJvd1NpemU7CgkgICAgICAgIHZhciBiaXRzID0gdGhpcy5iaXRzOwoJICAgICAgICB2YXIgYml0c09mZnNldCA9IGJpdHMubGVuZ3RoIC0gMTsKCSAgICAgICAgd2hpbGUgKGJpdHNPZmZzZXQgPj0gMCAmJiBiaXRzW2JpdHNPZmZzZXRdID09PSAwKSB7CgkgICAgICAgICAgICBiaXRzT2Zmc2V0LS07CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJpdHNPZmZzZXQgPCAwKSB7CgkgICAgICAgICAgICByZXR1cm4gbnVsbDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IoYml0c09mZnNldCAvIHJvd1NpemUpOwoJICAgICAgICB2YXIgeCA9IE1hdGguZmxvb3IoYml0c09mZnNldCAlIHJvd1NpemUpICogMzI7CgkgICAgICAgIHZhciB0aGVCaXRzID0gYml0c1tiaXRzT2Zmc2V0XTsKCSAgICAgICAgdmFyIGJpdCA9IDMxOwoJICAgICAgICB3aGlsZSAoKHRoZUJpdHMgPj4+IGJpdCkgPT09IDApIHsKCSAgICAgICAgICAgIGJpdC0tOwoJICAgICAgICB9CgkgICAgICAgIHggKz0gYml0OwoJICAgICAgICByZXR1cm4gSW50MzJBcnJheS5mcm9tKFt4LCB5XSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRXaWR0aCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMud2lkdGg7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSBoZWlnaHQgb2YgdGhlIG1hdHJpeAoJICAgICAqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZ2V0SGVpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5oZWlnaHQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSByb3cgc2l6ZSBvZiB0aGUgbWF0cml4CgkgICAgICovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5nZXRSb3dTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yb3dTaXplOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKG8pIHsKCSAgICAgICAgaWYgKCEobyBpbnN0YW5jZW9mIEJpdE1hdHJpeCkpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy53aWR0aCA9PT0gb3RoZXIud2lkdGggJiYgdGhpcy5oZWlnaHQgPT09IG90aGVyLmhlaWdodCAmJiB0aGlzLnJvd1NpemUgPT09IG90aGVyLnJvd1NpemUgJiYKCSAgICAgICAgICAgIEFycmF5c18xLmRlZmF1bHQuZXF1YWxzKHRoaXMuYml0cywgb3RoZXIuYml0cyk7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGhhc2ggPSB0aGlzLndpZHRoOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy53aWR0aDsKCSAgICAgICAgaGFzaCA9IDMxICogaGFzaCArIHRoaXMuaGVpZ2h0OwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgdGhpcy5yb3dTaXplOwoJICAgICAgICBoYXNoID0gMzEgKiBoYXNoICsgQXJyYXlzXzEuZGVmYXVsdC5oYXNoQ29kZSh0aGlzLmJpdHMpOwoJICAgICAgICByZXR1cm4gaGFzaDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIHVzaW5nICJYIiBmb3Igc2V0IGFuZCAiICIgZm9yIHVuc2V0IGJpdHMKCSAgICAgKi8KCSAgICAvKkBPdmVycmlkZSovCgkgICAgLy8gcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdG9TdHJpbmcoIjogIlgsICIgICIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgdG9TdHJpbmcoc2V0U3RyaW5nOiBzdHJpbmcgPSAiWCAiLCB1bnNldFN0cmluZzogc3RyaW5nID0gIiAgIik6IHN0cmluZyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5idWlsZFRvU3RyaW5nKHNldFN0cmluZywgdW5zZXRTdHJpbmcsICJcbiIpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBzZXRTdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBzZXQgYml0CgkgICAgICogQHBhcmFtIHVuc2V0U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGFuIHVuc2V0IGJpdAoJICAgICAqIEBwYXJhbSBsaW5lU2VwYXJhdG9yIG5ld2xpbmUgY2hhcmFjdGVyIGluIHN0cmluZyByZXByZXNlbnRhdGlvbgoJICAgICAqIEByZXR1cm4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVudGlyZSBtYXRyaXggdXRpbGl6aW5nIGdpdmVuIHN0cmluZ3MgYW5kIGxpbmUgc2VwYXJhdG9yCgkgICAgICogQGRlcHJlY2F0ZWQgY2FsbCB7QGxpbmsgI3RvU3RyaW5nKFN0cmluZyxTdHJpbmcpfSBvbmx5LCB3aGljaCB1c2VzIFxuIGxpbmUgc2VwYXJhdG9yIGFsd2F5cwoJICAgICAqLwoJICAgIC8vIEBEZXByZWNhdGVkCgkgICAgQml0TWF0cml4LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIChzZXRTdHJpbmcsIHVuc2V0U3RyaW5nLCBsaW5lU2VwYXJhdG9yKSB7CgkgICAgICAgIGlmIChzZXRTdHJpbmcgPT09IHZvaWQgMCkgeyBzZXRTdHJpbmcgPSAnWCAnOyB9CgkgICAgICAgIGlmICh1bnNldFN0cmluZyA9PT0gdm9pZCAwKSB7IHVuc2V0U3RyaW5nID0gJyAgJzsgfQoJICAgICAgICBpZiAobGluZVNlcGFyYXRvciA9PT0gdm9pZCAwKSB7IGxpbmVTZXBhcmF0b3IgPSAnXG4nOyB9CgkgICAgICAgIHJldHVybiB0aGlzLmJ1aWxkVG9TdHJpbmcoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcik7CgkgICAgfTsKCSAgICBCaXRNYXRyaXgucHJvdG90eXBlLmJ1aWxkVG9TdHJpbmcgPSBmdW5jdGlvbiAoc2V0U3RyaW5nLCB1bnNldFN0cmluZywgbGluZVNlcGFyYXRvcikgewoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgLy8gcmVzdWx0LmFwcGVuZChsaW5lU2VwYXJhdG9yKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDAsIGhlaWdodCA9IHRoaXMuaGVpZ2h0OyB5IDwgaGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IHRoaXMud2lkdGg7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCh0aGlzLmdldCh4LCB5KSA/IHNldFN0cmluZyA6IHVuc2V0U3RyaW5nKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQobGluZVNlcGFyYXRvcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdC50b1N0cmluZygpOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEJpdE1hdHJpeC5wcm90b3R5cGUuY2xvbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgQml0TWF0cml4KHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLnJvd1NpemUsIHRoaXMuYml0cy5zbGljZSgpKTsKCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXg7Cgl9KCkpOwoJQml0TWF0cml4JDEuZGVmYXVsdCA9IEJpdE1hdHJpeDsKCgl2YXIgTm90Rm91bmRFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkZCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShOb3RGb3VuZEV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBOb3RGb3VuZEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkZChOb3RGb3VuZEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBOb3RGb3VuZEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5nZXROb3RGb3VuZEluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IE5vdEZvdW5kRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBOb3RGb3VuZEV4Y2VwdGlvbi5raW5kID0gJ05vdEZvdW5kRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gTm90Rm91bmRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCkpOwoJTm90Rm91bmRFeGNlcHRpb24kMS5kZWZhdWx0ID0gTm90Rm91bmRFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYyA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24geyovCgl2YXIgQmluYXJpemVyXzEgPSBCaW5hcml6ZXIkMTsKCXZhciBCaXRBcnJheV8xID0gQml0QXJyYXkkMTsKCXZhciBCaXRNYXRyaXhfMSQ1ID0gQml0TWF0cml4JDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQ2ID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qKgoJICogVGhpcyBCaW5hcml6ZXIgaW1wbGVtZW50YXRpb24gdXNlcyB0aGUgb2xkIFpYaW5nIGdsb2JhbCBoaXN0b2dyYW0gYXBwcm9hY2guIEl0IGlzIHN1aXRhYmxlCgkgKiBmb3IgbG93LWVuZCBtb2JpbGUgZGV2aWNlcyB3aGljaCBkb24ndCBoYXZlIGVub3VnaCBDUFUgb3IgbWVtb3J5IHRvIHVzZSBhIGxvY2FsIHRocmVzaG9sZGluZwoJICogYWxnb3JpdGhtLiBIb3dldmVyLCBiZWNhdXNlIGl0IHBpY2tzIGEgZ2xvYmFsIGJsYWNrIHBvaW50LCBpdCBjYW5ub3QgaGFuZGxlIGRpZmZpY3VsdCBzaGFkb3dzCgkgKiBhbmQgZ3JhZGllbnRzLgoJICoKCSAqIEZhc3RlciBtb2JpbGUgZGV2aWNlcyBhbmQgYWxsIGRlc2t0b3AgYXBwbGljYXRpb25zIHNob3VsZCBwcm9iYWJseSB1c2UgSHlicmlkQmluYXJpemVyIGluc3RlYWQuCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGMoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5sdW1pbmFuY2VzID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkVNUFRZOwoJICAgICAgICBfdGhpcy5idWNrZXRzID0gbmV3IEludDMyQXJyYXkoR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CVUNLRVRTKTsKCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvLyBBcHBsaWVzIHNpbXBsZSBzaGFycGVuaW5nIHRvIHRoZSByb3cgZGF0YSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlIG9mIHRoZSAxRCBSZWFkZXJzLgoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmdldEJsYWNrUm93ID0gZnVuY3Rpb24gKHkgLyppbnQqLywgcm93KSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gdW5kZWZpbmVkIHx8IHJvdyA9PT0gbnVsbCB8fCByb3cuZ2V0U2l6ZSgpIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBCaXRBcnJheV8xLmRlZmF1bHQod2lkdGgpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgcm93LmNsZWFyKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5pbml0QXJyYXlzKHdpZHRoKTsKCSAgICAgICAgdmFyIGxvY2FsTHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRSb3coeSwgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgdmFyIGxvY2FsQnVja2V0cyA9IHRoaXMuYnVja2V0czsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICBsb2NhbEJ1Y2tldHNbKGxvY2FsTHVtaW5hbmNlc1t4XSAmIDB4ZmYpID4+IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfU0hJRlRdKys7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGJsYWNrUG9pbnQgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuZXN0aW1hdGVCbGFja1BvaW50KGxvY2FsQnVja2V0cyk7CgkgICAgICAgIGlmICh3aWR0aCA8IDMpIHsKCSAgICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3IgdmVyeSBzbWFsbCBpbWFnZXMKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgICAgIGlmICgobG9jYWxMdW1pbmFuY2VzW3hdICYgMHhmZikgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIHJvdy5zZXQoeCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGxlZnQgPSBsb2NhbEx1bWluYW5jZXNbMF0gJiAweGZmOwoJICAgICAgICAgICAgdmFyIGNlbnRlciA9IGxvY2FsTHVtaW5hbmNlc1sxXSAmIDB4ZmY7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMTsgeCA8IHdpZHRoIC0gMTsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHJpZ2h0ID0gbG9jYWxMdW1pbmFuY2VzW3ggKyAxXSAmIDB4ZmY7CgkgICAgICAgICAgICAgICAgLy8gQSBzaW1wbGUgLTEgNCAtMSBib3ggZmlsdGVyIHdpdGggYSB3ZWlnaHQgb2YgMi4KCSAgICAgICAgICAgICAgICBpZiAoKChjZW50ZXIgKiA0KSAtIGxlZnQgLSByaWdodCkgLyAyIDwgYmxhY2tQb2ludCkgewoJICAgICAgICAgICAgICAgICAgICByb3cuc2V0KHgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBsZWZ0ID0gY2VudGVyOwoJICAgICAgICAgICAgICAgIGNlbnRlciA9IHJpZ2h0OwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByb3c7CgkgICAgfTsKCSAgICAvLyBEb2VzIG5vdCBzaGFycGVuIHRoZSBkYXRhLCBhcyB0aGlzIGNhbGwgaXMgaW50ZW5kZWQgdG8gb25seSBiZSB1c2VkIGJ5IDJEIFJlYWRlcnMuCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIG1hdHJpeCA9IG5ldyBCaXRNYXRyaXhfMSQ1LmRlZmF1bHQod2lkdGgsIGhlaWdodCk7CgkgICAgICAgIC8vIFF1aWNrbHkgY2FsY3VsYXRlcyB0aGUgaGlzdG9ncmFtIGJ5IHNhbXBsaW5nIGZvdXIgcm93cyBmcm9tIHRoZSBpbWFnZS4gVGhpcyBwcm92ZWQgdG8gYmUKCSAgICAgICAgLy8gbW9yZSByb2J1c3Qgb24gdGhlIGJsYWNrYm94IHRlc3RzIHRoYW4gc2FtcGxpbmcgYSBkaWFnb25hbCBhcyB3ZSB1c2VkIHRvIGRvLgoJICAgICAgICB0aGlzLmluaXRBcnJheXMod2lkdGgpOwoJICAgICAgICB2YXIgbG9jYWxCdWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB5ID0gMTsgeSA8IDU7IHkrKykgewoJICAgICAgICAgICAgdmFyIHJvdyA9IE1hdGguZmxvb3IoKGhlaWdodCAqIHkpIC8gNSk7CgkgICAgICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzXzEgPSBzb3VyY2UuZ2V0Um93KHJvdywgdGhpcy5sdW1pbmFuY2VzKTsKCSAgICAgICAgICAgIHZhciByaWdodCA9IE1hdGguZmxvb3IoKHdpZHRoICogNCkgLyA1KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSBNYXRoLmZsb29yKHdpZHRoIC8gNSk7IHggPCByaWdodDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzXzFbeF0gJiAweGZmOwoJICAgICAgICAgICAgICAgIGxvY2FsQnVja2V0c1twaXhlbCA+PiBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUXSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBibGFja1BvaW50ID0gR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludChsb2NhbEJ1Y2tldHMpOwoJICAgICAgICAvLyBXZSBkZWxheSByZWFkaW5nIHRoZSBlbnRpcmUgaW1hZ2UgbHVtaW5hbmNlIHVudGlsIHRoZSBibGFjayBwb2ludCBlc3RpbWF0aW9uIHN1Y2NlZWRzLgoJICAgICAgICAvLyBBbHRob3VnaCB3ZSBlbmQgdXAgcmVhZGluZyBmb3VyIHJvd3MgdHdpY2UsIGl0IGlzIGNvbnNpc3RlbnQgd2l0aCBvdXIgbW90dG8gb2YKCSAgICAgICAgLy8gImZhaWwgcXVpY2tseSIgd2hpY2ggaXMgbmVjZXNzYXJ5IGZvciBjb250aW51b3VzIHNjYW5uaW5nLgoJICAgICAgICB2YXIgbG9jYWxMdW1pbmFuY2VzID0gc291cmNlLmdldE1hdHJpeCgpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBpeGVsID0gbG9jYWxMdW1pbmFuY2VzW29mZnNldCArIHhdICYgMHhmZjsKCSAgICAgICAgICAgICAgICBpZiAocGl4ZWwgPCBibGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgIG1hdHJpeC5zZXQoeCwgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBtYXRyaXg7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLnByb3RvdHlwZS5jcmVhdGVCaW5hcml6ZXIgPSBmdW5jdGlvbiAoc291cmNlKSB7CgkgICAgICAgIHJldHVybiBuZXcgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyKHNvdXJjZSk7CgkgICAgfTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIucHJvdG90eXBlLmluaXRBcnJheXMgPSBmdW5jdGlvbiAobHVtaW5hbmNlU2l6ZSAvKmludCovKSB7CgkgICAgICAgIGlmICh0aGlzLmx1bWluYW5jZXMubGVuZ3RoIDwgbHVtaW5hbmNlU2l6ZSkgewoJICAgICAgICAgICAgdGhpcy5sdW1pbmFuY2VzID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGx1bWluYW5jZVNpemUpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBidWNrZXRzID0gdGhpcy5idWNrZXRzOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQlVDS0VUUzsgeCsrKSB7CgkgICAgICAgICAgICBidWNrZXRzW3hdID0gMDsKCSAgICAgICAgfQoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLmVzdGltYXRlQmxhY2tQb2ludCA9IGZ1bmN0aW9uIChidWNrZXRzKSB7CgkgICAgICAgIC8vIEZpbmQgdGhlIHRhbGxlc3QgcGVhayBpbiB0aGUgaGlzdG9ncmFtLgoJICAgICAgICB2YXIgbnVtQnVja2V0cyA9IGJ1Y2tldHMubGVuZ3RoOwoJICAgICAgICB2YXIgbWF4QnVja2V0Q291bnQgPSAwOwoJICAgICAgICB2YXIgZmlyc3RQZWFrID0gMDsKCSAgICAgICAgdmFyIGZpcnN0UGVha1NpemUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgaWYgKGJ1Y2tldHNbeF0gPiBmaXJzdFBlYWtTaXplKSB7CgkgICAgICAgICAgICAgICAgZmlyc3RQZWFrID0geDsKCSAgICAgICAgICAgICAgICBmaXJzdFBlYWtTaXplID0gYnVja2V0c1t4XTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChidWNrZXRzW3hdID4gbWF4QnVja2V0Q291bnQpIHsKCSAgICAgICAgICAgICAgICBtYXhCdWNrZXRDb3VudCA9IGJ1Y2tldHNbeF07CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCB0aGUgc2Vjb25kLXRhbGxlc3QgcGVhayB3aGljaCBpcyBzb21ld2hhdCBmYXIgZnJvbSB0aGUgdGFsbGVzdCBwZWFrLgoJICAgICAgICB2YXIgc2Vjb25kUGVhayA9IDA7CgkgICAgICAgIHZhciBzZWNvbmRQZWFrU2NvcmUgPSAwOwoJICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG51bUJ1Y2tldHM7IHgrKykgewoJICAgICAgICAgICAgdmFyIGRpc3RhbmNlVG9CaWdnZXN0ID0geCAtIGZpcnN0UGVhazsKCSAgICAgICAgICAgIC8vIEVuY291cmFnZSBtb3JlIGRpc3RhbnQgc2Vjb25kIHBlYWtzIGJ5IG11bHRpcGx5aW5nIGJ5IHNxdWFyZSBvZiBkaXN0YW5jZS4KCSAgICAgICAgICAgIHZhciBzY29yZSA9IGJ1Y2tldHNbeF0gKiBkaXN0YW5jZVRvQmlnZ2VzdCAqIGRpc3RhbmNlVG9CaWdnZXN0OwoJICAgICAgICAgICAgaWYgKHNjb3JlID4gc2Vjb25kUGVha1Njb3JlKSB7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVhayA9IHg7CgkgICAgICAgICAgICAgICAgc2Vjb25kUGVha1Njb3JlID0gc2NvcmU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTWFrZSBzdXJlIGZpcnN0UGVhayBjb3JyZXNwb25kcyB0byB0aGUgYmxhY2sgcGVhay4KCSAgICAgICAgaWYgKGZpcnN0UGVhayA+IHNlY29uZFBlYWspIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZmlyc3RQZWFrOwoJICAgICAgICAgICAgZmlyc3RQZWFrID0gc2Vjb25kUGVhazsKCSAgICAgICAgICAgIHNlY29uZFBlYWsgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHRoZXJlIGlzIHRvbyBsaXR0bGUgY29udHJhc3QgaW4gdGhlIGltYWdlIHRvIHBpY2sgYSBtZWFuaW5nZnVsIGJsYWNrIHBvaW50LCB0aHJvdyByYXRoZXIKCSAgICAgICAgLy8gdGhhbiB3YXN0ZSB0aW1lIHRyeWluZyB0byBkZWNvZGUgdGhlIGltYWdlLCBhbmQgcmlzayBmYWxzZSBwb3NpdGl2ZXMuCgkgICAgICAgIGlmIChzZWNvbmRQZWFrIC0gZmlyc3RQZWFrIDw9IG51bUJ1Y2tldHMgLyAxNikgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRmluZCBhIHZhbGxleSBiZXR3ZWVuIHRoZW0gdGhhdCBpcyBsb3cgYW5kIGNsb3NlciB0byB0aGUgd2hpdGUgcGVhay4KCSAgICAgICAgdmFyIGJlc3RWYWxsZXkgPSBzZWNvbmRQZWFrIC0gMTsKCSAgICAgICAgdmFyIGJlc3RWYWxsZXlTY29yZSA9IC0xOwoJICAgICAgICBmb3IgKHZhciB4ID0gc2Vjb25kUGVhayAtIDE7IHggPiBmaXJzdFBlYWs7IHgtLSkgewoJICAgICAgICAgICAgdmFyIGZyb21GaXJzdCA9IHggLSBmaXJzdFBlYWs7CgkgICAgICAgICAgICB2YXIgc2NvcmUgPSBmcm9tRmlyc3QgKiBmcm9tRmlyc3QgKiAoc2Vjb25kUGVhayAtIHgpICogKG1heEJ1Y2tldENvdW50IC0gYnVja2V0c1t4XSk7CgkgICAgICAgICAgICBpZiAoc2NvcmUgPiBiZXN0VmFsbGV5U2NvcmUpIHsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5ID0geDsKCSAgICAgICAgICAgICAgICBiZXN0VmFsbGV5U2NvcmUgPSBzY29yZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gYmVzdFZhbGxleSA8PCBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUOwoJICAgIH07CgkgICAgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLkxVTUlOQU5DRV9CSVRTID0gNTsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX1NISUZUID0gOCAtIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuTFVNSU5BTkNFX0JVQ0tFVFMgPSAxIDw8IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplci5MVU1JTkFOQ0VfQklUUzsKCSAgICBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIuRU1QVFkgPSBVaW50OENsYW1wZWRBcnJheS5mcm9tKFswXSk7CgkgICAgcmV0dXJuIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCX0oQmluYXJpemVyXzEuZGVmYXVsdCkpOwoJR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyJDEuZGVmYXVsdCA9IEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplcjsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyRiID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEh5YnJpZEJpbmFyaXplciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyXzEgPSBHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXIkMTsKCXZhciBCaXRNYXRyaXhfMSQ0ID0gQml0TWF0cml4JDE7CgkvKioKCSAqIFRoaXMgY2xhc3MgaW1wbGVtZW50cyBhIGxvY2FsIHRocmVzaG9sZGluZyBhbGdvcml0aG0sIHdoaWNoIHdoaWxlIHNsb3dlciB0aGFuIHRoZQoJICogR2xvYmFsSGlzdG9ncmFtQmluYXJpemVyLCBpcyBmYWlybHkgZWZmaWNpZW50IGZvciB3aGF0IGl0IGRvZXMuIEl0IGlzIGRlc2lnbmVkIGZvcgoJICogaGlnaCBmcmVxdWVuY3kgaW1hZ2VzIG9mIGJhcmNvZGVzIHdpdGggYmxhY2sgZGF0YSBvbiB3aGl0ZSBiYWNrZ3JvdW5kcy4gRm9yIHRoaXMgYXBwbGljYXRpb24sCgkgKiBpdCBkb2VzIGEgbXVjaCBiZXR0ZXIgam9iIHRoYW4gYSBnbG9iYWwgYmxhY2twb2ludCB3aXRoIHNldmVyZSBzaGFkb3dzIGFuZCBncmFkaWVudHMuCgkgKiBIb3dldmVyIGl0IHRlbmRzIHRvIHByb2R1Y2UgYXJ0aWZhY3RzIG9uIGxvd2VyIGZyZXF1ZW5jeSBpbWFnZXMgYW5kIGlzIHRoZXJlZm9yZSBub3QKCSAqIGEgZ29vZCBnZW5lcmFsIHB1cnBvc2UgYmluYXJpemVyIGZvciB1c2VzIG91dHNpZGUgWlhpbmcuCgkgKgoJICogVGhpcyBjbGFzcyBleHRlbmRzIEdsb2JhbEhpc3RvZ3JhbUJpbmFyaXplciwgdXNpbmcgdGhlIG9sZGVyIGhpc3RvZ3JhbSBhcHByb2FjaCBmb3IgMUQgcmVhZGVycywKCSAqIGFuZCB0aGUgbmV3ZXIgbG9jYWwgYXBwcm9hY2ggZm9yIDJEIHJlYWRlcnMuIDFEIGRlY29kaW5nIHVzaW5nIGEgcGVyLXJvdyBoaXN0b2dyYW0gaXMgYWxyZWFkeQoJICogaW5oZXJlbnRseSBsb2NhbCwgYW5kIG9ubHkgZmFpbHMgZm9yIGhvcml6b250YWwgZ3JhZGllbnRzLiBXZSBjYW4gcmV2aXNpdCB0aGF0IHByb2JsZW0gbGF0ZXIsCgkgKiBidXQgZm9yIG5vdyBpdCB3YXMgbm90IGEgd2luIHRvIHVzZSBsb2NhbCBibG9ja3MgZm9yIDFELgoJICoKCSAqIFRoaXMgQmluYXJpemVyIGlzIHRoZSBkZWZhdWx0IGZvciB0aGUgdW5pdCB0ZXN0cyBhbmQgdGhlIHJlY29tbWVuZGVkIGNsYXNzIGZvciBsaWJyYXJ5IHVzZXJzLgoJICoKCSAqIEBhdXRob3IgZHN3aXRraW5AZ29vZ2xlLmNvbSAoRGFuaWVsIFN3aXRraW4pCgkgKi8KCXZhciBIeWJyaWRCaW5hcml6ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGIoSHlicmlkQmluYXJpemVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIEh5YnJpZEJpbmFyaXplcihzb3VyY2UpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgc291cmNlKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5tYXRyaXggPSBudWxsOwoJICAgICAgICByZXR1cm4gX3RoaXM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIENhbGN1bGF0ZXMgdGhlIGZpbmFsIEJpdE1hdHJpeCBvbmNlIGZvciBhbGwgcmVxdWVzdHMuIFRoaXMgY291bGQgYmUgY2FsbGVkIG9uY2UgZnJvbSB0aGUKCSAgICAgKiBjb25zdHJ1Y3RvciBpbnN0ZWFkLCBidXQgdGhlcmUgYXJlIHNvbWUgYWR2YW50YWdlcyB0byBkb2luZyBpdCBsYXppbHksIHN1Y2ggYXMgbWFraW5nCgkgICAgICogcHJvZmlsaW5nIGVhc2llciwgYW5kIG5vdCBkb2luZyBoZWF2eSBsaWZ0aW5nIHdoZW4gY2FsbGVycyBkb24ndCBleHBlY3QgaXQuCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuZ2V0QmxhY2tNYXRyaXggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLm1hdHJpeCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEx1bWluYW5jZVNvdXJjZSgpOwoJICAgICAgICB2YXIgd2lkdGggPSBzb3VyY2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IHNvdXJjZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKHdpZHRoID49IEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiAmJiBoZWlnaHQgPj0gSHlicmlkQmluYXJpemVyLk1JTklNVU1fRElNRU5TSU9OKSB7CgkgICAgICAgICAgICB2YXIgbHVtaW5hbmNlcyA9IHNvdXJjZS5nZXRNYXRyaXgoKTsKCSAgICAgICAgICAgIHZhciBzdWJXaWR0aCA9IHdpZHRoID4+IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKCh3aWR0aCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViV2lkdGgrKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciBzdWJIZWlnaHQgPSBoZWlnaHQgPj4gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICBpZiAoKGhlaWdodCAmIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0spICE9PSAwKSB7CgkgICAgICAgICAgICAgICAgc3ViSGVpZ2h0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgYmxhY2tQb2ludHMgPSBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMobHVtaW5hbmNlcywgc3ViV2lkdGgsIHN1YkhlaWdodCwgd2lkdGgsIGhlaWdodCk7CgkgICAgICAgICAgICB2YXIgbmV3TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDQuZGVmYXVsdCh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgICAgIEh5YnJpZEJpbmFyaXplci5jYWxjdWxhdGVUaHJlc2hvbGRGb3JCbG9jayhsdW1pbmFuY2VzLCBzdWJXaWR0aCwgc3ViSGVpZ2h0LCB3aWR0aCwgaGVpZ2h0LCBibGFja1BvaW50cywgbmV3TWF0cml4KTsKCSAgICAgICAgICAgIHRoaXMubWF0cml4ID0gbmV3TWF0cml4OwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgLy8gSWYgdGhlIGltYWdlIGlzIHRvbyBzbWFsbCwgZmFsbCBiYWNrIHRvIHRoZSBnbG9iYWwgaGlzdG9ncmFtIGFwcHJvYWNoLgoJICAgICAgICAgICAgdGhpcy5tYXRyaXggPSBfc3VwZXIucHJvdG90eXBlLmdldEJsYWNrTWF0cml4LmNhbGwodGhpcyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMubWF0cml4OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEh5YnJpZEJpbmFyaXplci5wcm90b3R5cGUuY3JlYXRlQmluYXJpemVyID0gZnVuY3Rpb24gKHNvdXJjZSkgewoJICAgICAgICByZXR1cm4gbmV3IEh5YnJpZEJpbmFyaXplcihzb3VyY2UpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogRm9yIGVhY2ggYmxvY2sgaW4gdGhlIGltYWdlLCBjYWxjdWxhdGUgdGhlIGF2ZXJhZ2UgYmxhY2sgcG9pbnQgdXNpbmcgYSA1eDUgZ3JpZAoJICAgICAqIG9mIHRoZSBibG9ja3MgYXJvdW5kIGl0LiBBbHNvIGhhbmRsZXMgdGhlIGNvcm5lciBjYXNlcyAoZnJhY3Rpb25hbCBibG9ja3MgYXJlIGNvbXB1dGVkIGJhc2VkCgkgICAgICogb24gdGhlIGxhc3QgcGl4ZWxzIGluIHRoZSByb3cvY29sdW1uIHdoaWNoIGFyZSBhbHNvIHVzZWQgaW4gdGhlIHByZXZpb3VzIGJsb2NrKS4KCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlVGhyZXNob2xkRm9yQmxvY2sgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBibGFja1BvaW50cywgbWF0cml4KSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBzdWJIZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgdG9wXzEgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHksIDIsIHN1YkhlaWdodCAtIDMpOwoJICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBzdWJXaWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHhvZmZzZXQgPSB4IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgICAgIGlmICh4b2Zmc2V0ID4gbWF4WE9mZnNldCkgewoJICAgICAgICAgICAgICAgICAgICB4b2Zmc2V0ID0gbWF4WE9mZnNldDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgdmFyIGxlZnQgPSBIeWJyaWRCaW5hcml6ZXIuY2FwKHgsIDIsIHN1YldpZHRoIC0gMyk7CgkgICAgICAgICAgICAgICAgdmFyIHN1bSA9IDA7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeiA9IC0yOyB6IDw9IDI7IHorKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgYmxhY2tSb3cgPSBibGFja1BvaW50c1t0b3BfMSArIHpdOwoJICAgICAgICAgICAgICAgICAgICBzdW0gKz0gYmxhY2tSb3dbbGVmdCAtIDJdICsgYmxhY2tSb3dbbGVmdCAtIDFdICsgYmxhY2tSb3dbbGVmdF0gKyBibGFja1Jvd1tsZWZ0ICsgMV0gKyBibGFja1Jvd1tsZWZ0ICsgMl07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlID0gc3VtIC8gMjU7CgkgICAgICAgICAgICAgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrKGx1bWluYW5jZXMsIHhvZmZzZXQsIHlvZmZzZXQsIGF2ZXJhZ2UsIHdpZHRoLCBtYXRyaXgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FwID0gZnVuY3Rpb24gKHZhbHVlIC8qaW50Ki8sIG1pbiAvKmludCovLCBtYXggLyppbnQqLykgewoJICAgICAgICByZXR1cm4gdmFsdWUgPCBtaW4gPyBtaW4gOiB2YWx1ZSA+IG1heCA/IG1heCA6IHZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbGllcyBhIHNpbmdsZSB0aHJlc2hvbGQgdG8gYSBibG9jayBvZiBwaXhlbHMuCgkgICAgICovCgkgICAgSHlicmlkQmluYXJpemVyLnRocmVzaG9sZEJsb2NrID0gZnVuY3Rpb24gKGx1bWluYW5jZXMsIHhvZmZzZXQgLyppbnQqLywgeW9mZnNldCAvKmludCovLCB0aHJlc2hvbGQgLyppbnQqLywgc3RyaWRlIC8qaW50Ki8sIG1hdHJpeCkgewoJICAgICAgICBmb3IgKHZhciB5ID0gMCwgb2Zmc2V0ID0geW9mZnNldCAqIHN0cmlkZSArIHhvZmZzZXQ7IHkgPCBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsgeSsrLCBvZmZzZXQgKz0gc3RyaWRlKSB7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB4KyspIHsKCSAgICAgICAgICAgICAgICAvLyBDb21wYXJpc29uIG5lZWRzIHRvIGJlIDw9IHNvIHRoYXQgYmxhY2sgPT0gMCBwaXhlbHMgYXJlIGJsYWNrIGV2ZW4gaWYgdGhlIHRocmVzaG9sZCBpcyAwLgoJICAgICAgICAgICAgICAgIGlmICgobHVtaW5hbmNlc1tvZmZzZXQgKyB4XSAmIDB4RkYpIDw9IHRocmVzaG9sZCkgewoJICAgICAgICAgICAgICAgICAgICBtYXRyaXguc2V0KHhvZmZzZXQgKyB4LCB5b2Zmc2V0ICsgeSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBDYWxjdWxhdGVzIGEgc2luZ2xlIGJsYWNrIHBvaW50IGZvciBlYWNoIGJsb2NrIG9mIHBpeGVscyBhbmQgc2F2ZXMgaXQgYXdheS4KCSAgICAgKiBTZWUgdGhlIGZvbGxvd2luZyB0aHJlYWQgZm9yIGEgZGlzY3Vzc2lvbiBvZiB0aGlzIGFsZ29yaXRobToKCSAgICAgKiAgaHR0cDovL2dyb3Vwcy5nb29nbGUuY29tL2dyb3VwL3p4aW5nL2Jyb3dzZV90aHJlYWQvdGhyZWFkL2QwNmVmYTJjMzVhN2RkYzAKCSAgICAgKi8KCSAgICBIeWJyaWRCaW5hcml6ZXIuY2FsY3VsYXRlQmxhY2tQb2ludHMgPSBmdW5jdGlvbiAobHVtaW5hbmNlcywgc3ViV2lkdGggLyppbnQqLywgc3ViSGVpZ2h0IC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHZhciBtYXhZT2Zmc2V0ID0gaGVpZ2h0IC0gSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7CgkgICAgICAgIHZhciBtYXhYT2Zmc2V0ID0gd2lkdGggLSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRTsKCSAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOndoaXRlc3BhY2UKCSAgICAgICAgdmFyIGJsYWNrUG9pbnRzID0gbmV3IEFycmF5KHN1YkhlaWdodCk7IC8vIHN1YldpZHRoCgkgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgc3ViSGVpZ2h0OyB5KyspIHsKCSAgICAgICAgICAgIGJsYWNrUG9pbnRzW3ldID0gbmV3IEludDMyQXJyYXkoc3ViV2lkdGgpOwoJICAgICAgICAgICAgdmFyIHlvZmZzZXQgPSB5IDw8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSOwoJICAgICAgICAgICAgaWYgKHlvZmZzZXQgPiBtYXhZT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgeW9mZnNldCA9IG1heFlPZmZzZXQ7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHN1YldpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgeG9mZnNldCA9IHggPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7CgkgICAgICAgICAgICAgICAgaWYgKHhvZmZzZXQgPiBtYXhYT2Zmc2V0KSB7CgkgICAgICAgICAgICAgICAgICAgIHhvZmZzZXQgPSBtYXhYT2Zmc2V0OwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB2YXIgc3VtID0gMDsKCSAgICAgICAgICAgICAgICB2YXIgbWluID0gMHhGRjsKCSAgICAgICAgICAgICAgICB2YXIgbWF4ID0gMDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciB5eSA9IDAsIG9mZnNldCA9IHlvZmZzZXQgKiB3aWR0aCArIHhvZmZzZXQ7IHl5IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHl5KyssIG9mZnNldCArPSB3aWR0aCkgewoJICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwaXhlbCA9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgIHN1bSArPSBwaXhlbDsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0aWxsIGxvb2tpbmcgZm9yIGdvb2QgY29udHJhc3QKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwaXhlbCA8IG1pbikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbiA9IHBpeGVsOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBpeGVsID4gbWF4KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4ID0gcGl4ZWw7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgLy8gc2hvcnQtY2lyY3VpdCBtaW4vbWF4IHRlc3RzIG9uY2UgZHluYW1pYyByYW5nZSBpcyBtZXQKCSAgICAgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA+IEh5YnJpZEJpbmFyaXplci5NSU5fRFlOQU1JQ19SQU5HRSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmluaXNoIHRoZSByZXN0IG9mIHRoZSByb3dzIHF1aWNrbHkKCSAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoeXkrKywgb2Zmc2V0ICs9IHdpZHRoOyB5eSA8IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFOyB5eSsrLCBvZmZzZXQgKz0gd2lkdGgpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB4eCA9IDA7IHh4IDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkU7IHh4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VtICs9IGx1bWluYW5jZXNbb2Zmc2V0ICsgeHhdICYgMHhGRjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgLy8gVGhlIGRlZmF1bHQgZXN0aW1hdGUgaXMgdGhlIGF2ZXJhZ2Ugb2YgdGhlIHZhbHVlcyBpbiB0aGUgYmxvY2suCgkgICAgICAgICAgICAgICAgdmFyIGF2ZXJhZ2UgPSBzdW0gPj4gKEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSICogMik7CgkgICAgICAgICAgICAgICAgaWYgKG1heCAtIG1pbiA8PSBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gSWYgdmFyaWF0aW9uIHdpdGhpbiB0aGUgYmxvY2sgaXMgbG93LCBhc3N1bWUgdGhpcyBpcyBhIGJsb2NrIHdpdGggb25seSBsaWdodCBvciBvbmx5CgkgICAgICAgICAgICAgICAgICAgIC8vIGRhcmsgcGl4ZWxzLiBJbiB0aGF0IGNhc2Ugd2UgZG8gbm90IHdhbnQgdG8gdXNlIHRoZSBhdmVyYWdlLCBhcyBpdCB3b3VsZCBkaXZpZGUgdGhpcwoJICAgICAgICAgICAgICAgICAgICAvLyBsb3cgY29udHJhc3QgYXJlYSBpbnRvIGJsYWNrIGFuZCB3aGl0ZSBwaXhlbHMsIGVzc2VudGlhbGx5IGNyZWF0aW5nIGRhdGEgb3V0IG9mIG5vaXNlLgoJICAgICAgICAgICAgICAgICAgICAvLwoJICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZGVmYXVsdCBhc3N1bXB0aW9uIGlzIHRoYXQgdGhlIGJsb2NrIGlzIGxpZ2h0L2JhY2tncm91bmQuIFNpbmNlIG5vIGVzdGltYXRlIGZvcgoJICAgICAgICAgICAgICAgICAgICAvLyB0aGUgbGV2ZWwgb2YgZGFyayBwaXhlbHMgZXhpc3RzIGxvY2FsbHksIHVzZSBoYWxmIHRoZSBtaW4gZm9yIHRoZSBibG9jay4KCSAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IG1pbiAvIDI7CgkgICAgICAgICAgICAgICAgICAgIGlmICh5ID4gMCAmJiB4ID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29ycmVjdCB0aGUgIndoaXRlIGJhY2tncm91bmQiIGFzc3VtcHRpb24gZm9yIGJsb2NrcyB0aGF0IGhhdmUgbmVpZ2hib3JzIGJ5IGNvbXBhcmluZwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHBpeGVscyBpbiB0aGlzIGJsb2NrIHRvIHRoZSBwcmV2aW91c2x5IGNhbGN1bGF0ZWQgYmxhY2sgcG9pbnRzLiBUaGlzIGlzIGJhc2VkIG9uCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmFjdCB0aGF0IGRhcmsgYmFyY29kZSBzeW1ib2xvZ3kgaXMgYWx3YXlzIHN1cnJvdW5kZWQgYnkgc29tZSBhbW91bnQgb2YgbGlnaHQKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhY2tncm91bmQgZm9yIHdoaWNoIHJlYXNvbmFibGUgYmxhY2sgcG9pbnQgZXN0aW1hdGVzIHdlcmUgbWFkZS4gVGhlIGJwIGVzdGltYXRlZCBhdAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGJvdW5kYXJpZXMgaXMgdXNlZCBmb3IgdGhlIGludGVyaW9yLgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIChtaW4gPCBicCkgaXMgYXJiaXRyYXJ5IGJ1dCB3b3JrcyBiZXR0ZXIgdGhhbiBvdGhlciBoZXVyaXN0aWNzIHRoYXQgd2VyZSB0cmllZC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50ID0gKGJsYWNrUG9pbnRzW3kgLSAxXVt4XSArICgyICogYmxhY2tQb2ludHNbeV1beCAtIDFdKSArIGJsYWNrUG9pbnRzW3kgLSAxXVt4IC0gMV0pIC8gNDsKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW4gPCBhdmVyYWdlTmVpZ2hib3JCbGFja1BvaW50KSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXZlcmFnZSA9IGF2ZXJhZ2VOZWlnaGJvckJsYWNrUG9pbnQ7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgYmxhY2tQb2ludHNbeV1beF0gPSBhdmVyYWdlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBibGFja1BvaW50czsKCSAgICB9OwoJICAgIC8vIFRoaXMgY2xhc3MgdXNlcyA1eDUgYmxvY2tzIHRvIGNvbXB1dGUgbG9jYWwgbHVtaW5hbmNlLCB3aGVyZSBlYWNoIGJsb2NrIGlzIDh4OCBwaXhlbHMuCgkgICAgLy8gU28gdGhpcyBpcyB0aGUgc21hbGxlc3QgZGltZW5zaW9uIGluIGVhY2ggYXhpcyB3ZSBjYW4gYWNjZXB0LgoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX1BPV0VSID0gMzsKCSAgICBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSA9IDEgPDwgSHlicmlkQmluYXJpemVyLkJMT0NLX1NJWkVfUE9XRVI7IC8vIC4uLjAxMDAuLi4wMAoJICAgIEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFX01BU0sgPSBIeWJyaWRCaW5hcml6ZXIuQkxPQ0tfU0laRSAtIDE7IC8vIC4uLjAwMTEuLi4xMQoJICAgIEh5YnJpZEJpbmFyaXplci5NSU5JTVVNX0RJTUVOU0lPTiA9IEh5YnJpZEJpbmFyaXplci5CTE9DS19TSVpFICogNTsKCSAgICBIeWJyaWRCaW5hcml6ZXIuTUlOX0RZTkFNSUNfUkFOR0UgPSAyNDsKCSAgICByZXR1cm4gSHlicmlkQmluYXJpemVyOwoJfShHbG9iYWxIaXN0b2dyYW1CaW5hcml6ZXJfMS5kZWZhdWx0KSk7Cgl2YXIgX2RlZmF1bHQkMiA9IEh5YnJpZEJpbmFyaXplciQxLmRlZmF1bHQgPSBIeWJyaWRCaW5hcml6ZXI7CgoJdmFyIFJHQkx1bWluYW5jZVNvdXJjZSQxID0ge307CgoJdmFyIEludmVydGVkTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgl2YXIgTHVtaW5hbmNlU291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgU3RyaW5nQnVpbGRlcl8xJDEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMSA9IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uJDE7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nIHsqLwoJLyoqCgkgKiBUaGUgcHVycG9zZSBvZiB0aGlzIGNsYXNzIGhpZXJhcmNoeSBpcyB0byBhYnN0cmFjdCBkaWZmZXJlbnQgYml0bWFwIGltcGxlbWVudGF0aW9ucyBhY3Jvc3MKCSAqIHBsYXRmb3JtcyBpbnRvIGEgc3RhbmRhcmQgaW50ZXJmYWNlIGZvciByZXF1ZXN0aW5nIGdyZXlzY2FsZSBsdW1pbmFuY2UgdmFsdWVzLiBUaGUgaW50ZXJmYWNlCgkgKiBvbmx5IHByb3ZpZGVzIGltbXV0YWJsZSBtZXRob2RzOyB0aGVyZWZvcmUgY3JvcCBhbmQgcm90YXRpb24gY3JlYXRlIGNvcGllcy4gVGhpcyBpcyB0byBlbnN1cmUKCSAqIHRoYXQgb25lIFJlYWRlciBkb2VzIG5vdCBtb2RpZnkgdGhlIG9yaWdpbmFsIGx1bWluYW5jZSBzb3VyY2UgYW5kIGxlYXZlIGl0IGluIGFuIHVua25vd24gc3RhdGUKCSAqIGZvciBvdGhlciBSZWFkZXJzIGluIHRoZSBjaGFpbi4KCSAqCgkgKiBAYXV0aG9yIGRzd2l0a2luQGdvb2dsZS5jb20gKERhbmllbCBTd2l0a2luKQoJICovCgl2YXIgTHVtaW5hbmNlU291cmNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEx1bWluYW5jZVNvdXJjZSh3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CgkgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIFRoZSB3aWR0aCBvZiB0aGUgYml0bWFwLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLndpZHRoOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBUaGUgaGVpZ2h0IG9mIHRoZSBiaXRtYXAuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRIZWlnaHQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmhlaWdodDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNyb3BwaW5nLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBSZXR1cm5zIGEgbmV3IG9iamVjdCB3aXRoIGNyb3BwZWQgaW1hZ2UgZGF0YS4gSW1wbGVtZW50YXRpb25zIG1heSBrZWVwIGEgcmVmZXJlbmNlIHRvIHRoZQoJICAgICAqIG9yaWdpbmFsIGRhdGEgcmF0aGVyIHRoYW4gYSBjb3B5LiBPbmx5IGNhbGxhYmxlIGlmIGlzQ3JvcFN1cHBvcnRlZCgpIGlzIHRydWUuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gbGVmdCBUaGUgbGVmdCBjb29yZGluYXRlLCB3aGljaCBtdXN0IGJlIGluIFswLGdldFdpZHRoKCkpCgkgICAgICogQHBhcmFtIHRvcCBUaGUgdG9wIGNvb3JkaW5hdGUsIHdoaWNoIG11c3QgYmUgaW4gWzAsZ2V0SGVpZ2h0KCkpCgkgICAgICogQHBhcmFtIHdpZHRoIFRoZSB3aWR0aCBvZiB0aGUgcmVjdGFuZ2xlIHRvIGNyb3AuCgkgICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSByZWN0YW5nbGUgdG8gY3JvcC4KCSAgICAgKiBAcmV0dXJuIEEgY3JvcHBlZCB2ZXJzaW9uIG9mIHRoaXMgb2JqZWN0LgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCBjcm9wcGluZy4nKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gV2hldGhlciB0aGlzIHN1YmNsYXNzIHN1cHBvcnRzIGNvdW50ZXItY2xvY2t3aXNlIHJvdGF0aW9uLgoJICAgICAqLwoJICAgIEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgYSBuZXcgb2JqZWN0IHdpdGggcm90YXRlZCBpbWFnZSBkYXRhIGJ5IDkwIGRlZ3JlZXMgY291bnRlcmNsb2Nrd2lzZS4KCSAgICAgKiBPbmx5IGNhbGxhYmxlIGlmIHtAbGluayAjaXNSb3RhdGVTdXBwb3J0ZWQoKX0gaXMgdHJ1ZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gQSByb3RhdGVkIHZlcnNpb24gb2YgdGhpcyBvYmplY3QuCgkgICAgICovCgkgICAgTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25fMS5kZWZhdWx0KCdUaGlzIGx1bWluYW5jZSBzb3VyY2UgZG9lcyBub3Qgc3VwcG9ydCByb3RhdGlvbiBieSA5MCBkZWdyZWVzLicpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogUmV0dXJucyBhIG5ldyBvYmplY3Qgd2l0aCByb3RhdGVkIGltYWdlIGRhdGEgYnkgNDUgZGVncmVlcyBjb3VudGVyY2xvY2t3aXNlLgoJICAgICAqIE9ubHkgY2FsbGFibGUgaWYge0BsaW5rICNpc1JvdGF0ZVN1cHBvcnRlZCgpfSBpcyB0cnVlLgoJICAgICAqCgkgICAgICogQHJldHVybiBBIHJvdGF0ZWQgdmVyc2lvbiBvZiB0aGlzIG9iamVjdC4KCSAgICAgKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnJvdGF0ZUNvdW50ZXJDbG9ja3dpc2U0NSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnVGhpcyBsdW1pbmFuY2Ugc291cmNlIGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24gYnkgNDUgZGVncmVlcy4nKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgcm93ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHRoaXMud2lkdGgpOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFN0cmluZ0J1aWxkZXJfMSQxLmRlZmF1bHQoKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgc291cmNlUm93ID0gdGhpcy5nZXRSb3coeSwgcm93KTsKCSAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy53aWR0aDsgeCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGx1bWluYW5jZSA9IHNvdXJjZVJvd1t4XSAmIDB4RkY7CgkgICAgICAgICAgICAgICAgdmFyIGMgPSB2b2lkIDA7CgkgICAgICAgICAgICAgICAgaWYgKGx1bWluYW5jZSA8IDB4NDApIHsKCSAgICAgICAgICAgICAgICAgICAgYyA9ICcjJzsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAobHVtaW5hbmNlIDwgMHg4MCkgewoJICAgICAgICAgICAgICAgICAgICBjID0gJysnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIGlmIChsdW1pbmFuY2UgPCAweEMwKSB7CgkgICAgICAgICAgICAgICAgICAgIGMgPSAnLic7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICBjID0gJyAnOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICByZXN1bHQuYXBwZW5kKGMpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZCgnXG4nKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0LnRvU3RyaW5nKCk7CgkgICAgfTsKCSAgICByZXR1cm4gTHVtaW5hbmNlU291cmNlOwoJfSgpKTsKCUx1bWluYW5jZVNvdXJjZSQxLmRlZmF1bHQgPSBMdW1pbmFuY2VTb3VyY2U7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA5IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMkYSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnZlcnRlZEx1bWluYW5jZVNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEkMSA9IEx1bWluYW5jZVNvdXJjZSQxOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogQSB3cmFwcGVyIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHdoaWNoIGludmVydHMgdGhlIGx1bWluYW5jZXMgaXQgcmV0dXJucyAtLSBibGFjayBiZWNvbWVzCgkgKiB3aGl0ZSBhbmQgdmljZSB2ZXJzYSwgYW5kIGVhY2ggdmFsdWUgYmVjb21lcyAoMjU1LXZhbHVlKS4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJGEoSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UsIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UoZGVsZWdhdGUpIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgZGVsZWdhdGUuZ2V0V2lkdGgoKSwgZGVsZWdhdGUuZ2V0SGVpZ2h0KCkpIHx8IHRoaXM7CgkgICAgICAgIF90aGlzLmRlbGVnYXRlID0gZGVsZWdhdGU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgdmFyIHNvdXJjZVJvdyA9IHRoaXMuZGVsZWdhdGUuZ2V0Um93KHksIHJvdyk7CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrKSB7CgkgICAgICAgICAgICBzb3VyY2VSb3dbaV0gPSAvKihieXRlKSovICgyNTUgLSAoc291cmNlUm93W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBzb3VyY2VSb3c7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmdldE1hdHJpeCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIG1hdHJpeCA9IHRoaXMuZGVsZWdhdGUuZ2V0TWF0cml4KCk7CgkgICAgICAgIHZhciBsZW5ndGggPSB0aGlzLmdldFdpZHRoKCkgKiB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgaW52ZXJ0ZWRNYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobGVuZ3RoKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgaW52ZXJ0ZWRNYXRyaXhbaV0gPSAvKihieXRlKSovICgyNTUgLSAobWF0cml4W2ldICYgMHhGRikpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBpbnZlcnRlZE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNDcm9wU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5kZWxlZ2F0ZS5pc0Nyb3BTdXBwb3J0ZWQoKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuY3JvcCA9IGZ1bmN0aW9uIChsZWZ0IC8qaW50Ki8sIHRvcCAvKmludCovLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUuY3JvcChsZWZ0LCB0b3AsIHdpZHRoLCBoZWlnaHQpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuaXNSb3RhdGVTdXBwb3J0ZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlLmlzUm90YXRlU3VwcG9ydGVkKCk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG9yaWdpbmFsIGRlbGVnYXRlIHtAbGluayBMdW1pbmFuY2VTb3VyY2V9IHNpbmNlIGludmVydCB1bmRvZXMgaXRzZWxmCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlbGVnYXRlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEludmVydGVkTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5yb3RhdGVDb3VudGVyQ2xvY2t3aXNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZSgpKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBJbnZlcnRlZEx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IEludmVydGVkTHVtaW5hbmNlU291cmNlKHRoaXMuZGVsZWdhdGUucm90YXRlQ291bnRlckNsb2Nrd2lzZTQ1KCkpOwoJICAgIH07CgkgICAgcmV0dXJuIEludmVydGVkTHVtaW5hbmNlU291cmNlOwoJfShMdW1pbmFuY2VTb3VyY2VfMSQxLmRlZmF1bHQpKTsKCUludmVydGVkTHVtaW5hbmNlU291cmNlJDEuZGVmYXVsdCA9IEludmVydGVkTHVtaW5hbmNlU291cmNlOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwOSBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDkgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUkdCTHVtaW5hbmNlU291cmNlJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcgeyovCgkgLy8gcmVxdWlyZWQgYmVjYXVzZSBvZiBjaXJjdWxhciBkZXBlbmRlbmNpZXMgYmV0d2VlbiBMdW1pbmFuY2VTb3VyY2UgYW5kIEludmVydGVkTHVtaW5hbmNlU291cmNlCgl2YXIgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMSA9IEludmVydGVkTHVtaW5hbmNlU291cmNlJDE7Cgl2YXIgTHVtaW5hbmNlU291cmNlXzEgPSBMdW1pbmFuY2VTb3VyY2UkMTsKCXZhciBTeXN0ZW1fMSQyID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNiA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBUaGlzIGNsYXNzIGlzIHVzZWQgdG8gaGVscCBkZWNvZGUgaW1hZ2VzIGZyb20gZmlsZXMgd2hpY2ggYXJyaXZlIGFzIFJHQiBkYXRhIGZyb20KCSAqIGFuIEFSR0IgcGl4ZWwgYXJyYXkuIEl0IGRvZXMgbm90IHN1cHBvcnQgcm90YXRpb24uCgkgKgoJICogQGF1dGhvciBkc3dpdGtpbkBnb29nbGUuY29tIChEYW5pZWwgU3dpdGtpbikKCSAqIEBhdXRob3IgQmV0YW1pbm9zCgkgKi8KCXZhciBSR0JMdW1pbmFuY2VTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDkoUkdCTHVtaW5hbmNlU291cmNlLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIFJHQkx1bWluYW5jZVNvdXJjZShsdW1pbmFuY2VzLCB3aWR0aCAvKmludCovLCBoZWlnaHQgLyppbnQqLywgZGF0YVdpZHRoIC8qaW50Ki8sIGRhdGFIZWlnaHQgLyppbnQqLywgbGVmdCAvKmludCovLCB0b3AgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0KSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5kYXRhV2lkdGggPSBkYXRhV2lkdGg7CgkgICAgICAgIF90aGlzLmRhdGFIZWlnaHQgPSBkYXRhSGVpZ2h0OwoJICAgICAgICBfdGhpcy5sZWZ0ID0gbGVmdDsKCSAgICAgICAgX3RoaXMudG9wID0gdG9wOwoJICAgICAgICBpZiAobHVtaW5hbmNlcy5CWVRFU19QRVJfRUxFTUVOVCA9PT0gNCkgeyAvLyBJbnQzMkFycmF5CgkgICAgICAgICAgICB2YXIgc2l6ZSA9IHdpZHRoICogaGVpZ2h0OwoJICAgICAgICAgICAgdmFyIGx1bWluYW5jZXNVaW50OEFycmF5ID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHNpemUpOwoJICAgICAgICAgICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgc2l6ZTsgb2Zmc2V0KyspIHsKCSAgICAgICAgICAgICAgICB2YXIgcGl4ZWwgPSBsdW1pbmFuY2VzW29mZnNldF07CgkgICAgICAgICAgICAgICAgdmFyIHIgPSAocGl4ZWwgPj4gMTYpICYgMHhmZjsgLy8gcmVkCgkgICAgICAgICAgICAgICAgdmFyIGcyID0gKHBpeGVsID4+IDcpICYgMHgxZmU7IC8vIDIgKiBncmVlbgoJICAgICAgICAgICAgICAgIHZhciBiID0gcGl4ZWwgJiAweGZmOyAvLyBibHVlCgkgICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGdyZWVuLWZhdm91cmluZyBhdmVyYWdlIGNoZWFwbHkKCSAgICAgICAgICAgICAgICBsdW1pbmFuY2VzVWludDhBcnJheVtvZmZzZXRdID0gLyooYnl0ZSkgKi8gKChyICsgZzIgKyBiKSAvIDQpICYgMHhGRjsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzVWludDhBcnJheTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIF90aGlzLmx1bWluYW5jZXMgPSBsdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGRhdGFXaWR0aCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YVdpZHRoID0gd2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gZGF0YUhlaWdodCkgewoJICAgICAgICAgICAgX3RoaXMuZGF0YUhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSBsZWZ0KSB7CgkgICAgICAgICAgICBfdGhpcy5sZWZ0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAodW5kZWZpbmVkID09PSB0b3ApIHsKCSAgICAgICAgICAgIF90aGlzLnRvcCA9IDA7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKF90aGlzLmxlZnQgKyB3aWR0aCA+IF90aGlzLmRhdGFXaWR0aCB8fCBfdGhpcy50b3AgKyBoZWlnaHQgPiBfdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNi5kZWZhdWx0KCdDcm9wIHJlY3RhbmdsZSBkb2VzIG5vdCBmaXQgd2l0aGluIGltYWdlIGRhdGEuJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5nZXRSb3cgPSBmdW5jdGlvbiAoeSAvKmludCovLCByb3cpIHsKCSAgICAgICAgaWYgKHkgPCAwIHx8IHkgPj0gdGhpcy5nZXRIZWlnaHQoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDYuZGVmYXVsdCgnUmVxdWVzdGVkIHJvdyBpcyBvdXRzaWRlIHRoZSBpbWFnZTogJyArIHkpOwoJICAgICAgICB9CgkgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuZ2V0V2lkdGgoKTsKCSAgICAgICAgaWYgKHJvdyA9PT0gbnVsbCB8fCByb3cgPT09IHVuZGVmaW5lZCB8fCByb3cubGVuZ3RoIDwgd2lkdGgpIHsKCSAgICAgICAgICAgIHJvdyA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG9mZnNldCA9ICh5ICsgdGhpcy50b3ApICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIFN5c3RlbV8xJDIuZGVmYXVsdC5hcnJheWNvcHkodGhpcy5sdW1pbmFuY2VzLCBvZmZzZXQsIHJvdywgMCwgd2lkdGgpOwoJICAgICAgICByZXR1cm4gcm93OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJHQkx1bWluYW5jZVNvdXJjZS5wcm90b3R5cGUuZ2V0TWF0cml4ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgd2lkdGggPSB0aGlzLmdldFdpZHRoKCk7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBJZiB0aGUgY2FsbGVyIGFza3MgZm9yIHRoZSBlbnRpcmUgdW5kZXJseWluZyBpbWFnZSwgc2F2ZSB0aGUgY29weSBhbmQgZ2l2ZSB0aGVtIHRoZQoJICAgICAgICAvLyBvcmlnaW5hbCBkYXRhLiBUaGUgZG9jcyBzcGVjaWZpY2FsbHkgd2FybiB0aGF0IHJlc3VsdC5sZW5ndGggbXVzdCBiZSBpZ25vcmVkLgoJICAgICAgICBpZiAod2lkdGggPT09IHRoaXMuZGF0YVdpZHRoICYmIGhlaWdodCA9PT0gdGhpcy5kYXRhSGVpZ2h0KSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5sdW1pbmFuY2VzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhcmVhID0gd2lkdGggKiBoZWlnaHQ7CgkgICAgICAgIHZhciBtYXRyaXggPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoYXJlYSk7CgkgICAgICAgIHZhciBpbnB1dE9mZnNldCA9IHRoaXMudG9wICogdGhpcy5kYXRhV2lkdGggKyB0aGlzLmxlZnQ7CgkgICAgICAgIC8vIElmIHRoZSB3aWR0aCBtYXRjaGVzIHRoZSBmdWxsIHdpZHRoIG9mIHRoZSB1bmRlcmx5aW5nIGRhdGEsIHBlcmZvcm0gYSBzaW5nbGUgY29weS4KCSAgICAgICAgaWYgKHdpZHRoID09PSB0aGlzLmRhdGFXaWR0aCkgewoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIDAsIGFyZWEpOwoJICAgICAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICAgICAgfQoJICAgICAgICAvLyBPdGhlcndpc2UgY29weSBvbmUgY3JvcHBlZCByb3cgYXQgYSB0aW1lLgoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgb3V0cHV0T2Zmc2V0ID0geSAqIHdpZHRoOwoJICAgICAgICAgICAgU3lzdGVtXzEkMi5kZWZhdWx0LmFycmF5Y29weSh0aGlzLmx1bWluYW5jZXMsIGlucHV0T2Zmc2V0LCBtYXRyaXgsIG91dHB1dE9mZnNldCwgd2lkdGgpOwoJICAgICAgICAgICAgaW5wdXRPZmZzZXQgKz0gdGhpcy5kYXRhV2lkdGg7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSR0JMdW1pbmFuY2VTb3VyY2UucHJvdG90eXBlLmlzQ3JvcFN1cHBvcnRlZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5jcm9wID0gZnVuY3Rpb24gKGxlZnQgLyppbnQqLywgdG9wIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovKSB7CgkgICAgICAgIHJldHVybiBuZXcgUkdCTHVtaW5hbmNlU291cmNlKHRoaXMubHVtaW5hbmNlcywgd2lkdGgsIGhlaWdodCwgdGhpcy5kYXRhV2lkdGgsIHRoaXMuZGF0YUhlaWdodCwgdGhpcy5sZWZ0ICsgbGVmdCwgdGhpcy50b3AgKyB0b3ApOwoJICAgIH07CgkgICAgUkdCTHVtaW5hbmNlU291cmNlLnByb3RvdHlwZS5pbnZlcnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiBuZXcgSW52ZXJ0ZWRMdW1pbmFuY2VTb3VyY2VfMS5kZWZhdWx0KHRoaXMpOwoJICAgIH07CgkgICAgcmV0dXJuIFJHQkx1bWluYW5jZVNvdXJjZTsKCX0oTHVtaW5hbmNlU291cmNlXzEuZGVmYXVsdCkpOwoJdmFyIF9kZWZhdWx0JDEgPSBSR0JMdW1pbmFuY2VTb3VyY2UkMS5kZWZhdWx0ID0gUkdCTHVtaW5hbmNlU291cmNlOwoKCXZhciBRUkNvZGVSZWFkZXIkMSA9IHt9OwoKCXZhciBCYXJjb2RlRm9ybWF0JDEgPSB7fTsKCgkvKgoJICogRGlyZWN0IHBvcnQgdG8gVHlwZVNjcmlwdCBvZiBaWGluZyBieSBBZHJpYW4gVG/ImWPEgwoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoQmFyY29kZUZvcm1hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKgoJICogQ29weXJpZ2h0IDIwMDkgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogRW51bWVyYXRlcyBiYXJjb2RlIGZvcm1hdHMga25vd24gdG8gdGhpcyBwYWNrYWdlLiBQbGVhc2Uga2VlcCBhbHBoYWJldGl6ZWQuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJhcmNvZGVGb3JtYXQ7CgkoZnVuY3Rpb24gKEJhcmNvZGVGb3JtYXQpIHsKCSAgICAvKiogQXp0ZWMgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJBWlRFQyJdID0gMF0gPSAiQVpURUMiOwoJICAgIC8qKiBDT0RBQkFSIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREFCQVIiXSA9IDFdID0gIkNPREFCQVIiOwoJICAgIC8qKiBDb2RlIDM5IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfMzkiXSA9IDJdID0gIkNPREVfMzkiOwoJICAgIC8qKiBDb2RlIDkzIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkNPREVfOTMiXSA9IDNdID0gIkNPREVfOTMiOwoJICAgIC8qKiBDb2RlIDEyOCAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJDT0RFXzEyOCJdID0gNF0gPSAiQ09ERV8xMjgiOwoJICAgIC8qKiBEYXRhIE1hdHJpeCAyRCBiYXJjb2RlIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkRBVEFfTUFUUklYIl0gPSA1XSA9ICJEQVRBX01BVFJJWCI7CgkgICAgLyoqIEVBTi04IDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIkVBTl84Il0gPSA2XSA9ICJFQU5fOCI7CgkgICAgLyoqIEVBTi0xMyAxRCBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJFQU5fMTMiXSA9IDddID0gIkVBTl8xMyI7CgkgICAgLyoqIElURiAoSW50ZXJsZWF2ZWQgVHdvIG9mIEZpdmUpIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIklURiJdID0gOF0gPSAiSVRGIjsKCSAgICAvKiogTWF4aUNvZGUgMkQgYmFyY29kZSBmb3JtYXQuICovCgkgICAgQmFyY29kZUZvcm1hdFtCYXJjb2RlRm9ybWF0WyJNQVhJQ09ERSJdID0gOV0gPSAiTUFYSUNPREUiOwoJICAgIC8qKiBQREY0MTcgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUERGXzQxNyJdID0gMTBdID0gIlBERl80MTciOwoJICAgIC8qKiBRUiBDb2RlIDJEIGJhcmNvZGUgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUVJfQ09ERSJdID0gMTFdID0gIlFSX0NPREUiOwoJICAgIC8qKiBSU1MgMTQgKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlJTU18xNCJdID0gMTJdID0gIlJTU18xNCI7CgkgICAgLyoqIFJTUyBFWFBBTkRFRCAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiUlNTX0VYUEFOREVEIl0gPSAxM10gPSAiUlNTX0VYUEFOREVEIjsKCSAgICAvKiogVVBDLUEgMUQgZm9ybWF0LiAqLwoJICAgIEJhcmNvZGVGb3JtYXRbQmFyY29kZUZvcm1hdFsiVVBDX0EiXSA9IDE0XSA9ICJVUENfQSI7CgkgICAgLyoqIFVQQy1FIDFEIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FIl0gPSAxNV0gPSAiVVBDX0UiOwoJICAgIC8qKiBVUEMvRUFOIGV4dGVuc2lvbiBmb3JtYXQuIE5vdCBhIHN0YW5kLWFsb25lIGZvcm1hdC4gKi8KCSAgICBCYXJjb2RlRm9ybWF0W0JhcmNvZGVGb3JtYXRbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSAxNl0gPSAiVVBDX0VBTl9FWFRFTlNJT04iOwoJfSkoQmFyY29kZUZvcm1hdCB8fCAoQmFyY29kZUZvcm1hdCA9IHt9KSk7CglCYXJjb2RlRm9ybWF0JDEuZGVmYXVsdCA9IEJhcmNvZGVGb3JtYXQ7CgoJdmFyIFJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIFN5c3RlbV8xJDEgPSBTeXN0ZW0kMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBiYXJjb2RlIHdpdGhpbiBhbiBpbWFnZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocHJpdmF0ZSB0ZXh0OiBzdHJpbmcsCgkgICAgLy8gICAgICAgICAgICAgICBVaW50OEFycmF5IHJhd0J5dGVzLAoJICAgIC8vICAgICAgICAgICAgICAgUmVzdWx0UG9jb25zdCByZXN1bHRQb2ludHM6IEludDMyQXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICBCYXJjb2RlRm9ybWF0IGZvcm1hdCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmVzdWx0UG9pbnRzLCBmb3JtYXQsIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKQoJICAgIC8vIH0KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IodGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgVWludDhBcnJheSByYXdCeXRlcywKCSAgICAvLyAgICAgICAgICAgICAgIFJlc3VsdFBvY29uc3QgcmVzdWx0UG9pbnRzOiBJbnQzMkFycmF5LAoJICAgIC8vICAgICAgICAgICAgICAgQmFyY29kZUZvcm1hdCBmb3JtYXQsCgkgICAgLy8gICAgICAgICAgICAgICBsb25nIHRpbWVzdGFtcCkgewoJICAgIC8vICAgdGhpcyh0ZXh0LCByYXdCeXRlcywgcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoLAoJICAgIC8vICAgICAgICByZXN1bHRQb2ludHMsIGZvcm1hdCwgdGltZXN0YW1wKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBSZXN1bHQodGV4dCwgcmF3Qnl0ZXMsIG51bUJpdHMsIHJlc3VsdFBvaW50cywgZm9ybWF0LCB0aW1lc3RhbXApIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPT09IHZvaWQgMCkgeyBudW1CaXRzID0gcmF3Qnl0ZXMgPT0gbnVsbCA/IDAgOiA4ICogcmF3Qnl0ZXMubGVuZ3RoOyB9CgkgICAgICAgIGlmICh0aW1lc3RhbXAgPT09IHZvaWQgMCkgeyB0aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsgfQoJICAgICAgICB0aGlzLnRleHQgPSB0ZXh0OwoJICAgICAgICB0aGlzLnJhd0J5dGVzID0gcmF3Qnl0ZXM7CgkgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gcmVzdWx0UG9pbnRzOwoJICAgICAgICB0aGlzLmZvcm1hdCA9IGZvcm1hdDsKCSAgICAgICAgdGhpcy50aW1lc3RhbXAgPSB0aW1lc3RhbXA7CgkgICAgICAgIHRoaXMudGV4dCA9IHRleHQ7CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gbnVtQml0cyB8fCBudWxsID09PSBudW1CaXRzKSB7CgkgICAgICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IG51bGwgfHwgcmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMubnVtQml0cyA9IG51bUJpdHM7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludHMgPSByZXN1bHRQb2ludHM7CgkgICAgICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwoJICAgICAgICB0aGlzLnJlc3VsdE1ldGFkYXRhID0gbnVsbDsKCSAgICAgICAgaWYgKHVuZGVmaW5lZCA9PT0gdGltZXN0YW1wIHx8IG51bGwgPT09IHRpbWVzdGFtcCkgewoJICAgICAgICAgICAgdGhpcy50aW1lc3RhbXAgPSBTeXN0ZW1fMSQxLmRlZmF1bHQuY3VycmVudFRpbWVNaWxsaXMoKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHRoaXMudGltZXN0YW1wID0gdGltZXN0YW1wOwoJICAgICAgICB9CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IHRleHQgZW5jb2RlZCBieSB0aGUgYmFyY29kZQoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0VGV4dCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGV4dDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcmF3IGJ5dGVzIGVuY29kZWQgYnkgdGhlIGJhcmNvZGUsIGlmIGFwcGxpY2FibGUsIG90aGVyd2lzZSB7QGNvZGUgbnVsbH0KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0TnVtQml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMubnVtQml0czsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gcG9pbnRzIHJlbGF0ZWQgdG8gdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGVzZSBhcmUgdHlwaWNhbGx5IHBvaW50cwoJICAgICAqICAgICAgICAgaWRlbnRpZnlpbmcgZmluZGVyIHBhdHRlcm5zIG9yIHRoZSBjb3JuZXJzIG9mIHRoZSBiYXJjb2RlLiBUaGUgZXhhY3QgbWVhbmluZyBpcwoJICAgICAqICAgICAgICAgc3BlY2lmaWMgdG8gdGhlIHR5cGUgb2YgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkLgoJICAgICAqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUuZ2V0UmVzdWx0UG9pbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBCYXJjb2RlRm9ybWF0fSByZXByZXNlbnRpbmcgdGhlIGZvcm1hdCBvZiB0aGUgYmFyY29kZSB0aGF0IHdhcyBkZWNvZGVkCgkgICAgICovCgkgICAgUmVzdWx0LnByb3RvdHlwZS5nZXRCYXJjb2RlRm9ybWF0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHtAbGluayBNYXB9IG1hcHBpbmcge0BsaW5rIFJlc3VsdE1ldGFkYXRhVHlwZX0ga2V5cyB0byB2YWx1ZXMuIE1heSBiZQoJICAgICAqICAge0Bjb2RlIG51bGx9LiBUaGlzIGNvbnRhaW5zIG9wdGlvbmFsIG1ldGFkYXRhIGFib3V0IHdoYXQgd2FzIGRldGVjdGVkIGFib3V0IHRoZSBiYXJjb2RlLAoJICAgICAqICAgbGlrZSBvcmllbnRhdGlvbi4KCSAgICAgKi8KCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFJlc3VsdE1ldGFkYXRhID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRNZXRhZGF0YTsKCSAgICB9OwoJICAgIFJlc3VsdC5wcm90b3R5cGUucHV0TWV0YWRhdGEgPSBmdW5jdGlvbiAodHlwZSwgdmFsdWUpIHsKCSAgICAgICAgaWYgKHRoaXMucmVzdWx0TWV0YWRhdGEgPT09IG51bGwpIHsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0TWV0YWRhdGEgPSBuZXcgTWFwKCk7CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YS5zZXQodHlwZSwgdmFsdWUpOwoJICAgIH07CgkgICAgUmVzdWx0LnByb3RvdHlwZS5wdXRBbGxNZXRhZGF0YSA9IGZ1bmN0aW9uIChtZXRhZGF0YSkgewoJICAgICAgICBpZiAobWV0YWRhdGEgIT09IG51bGwpIHsKCSAgICAgICAgICAgIGlmICh0aGlzLnJlc3VsdE1ldGFkYXRhID09PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG1ldGFkYXRhOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRNZXRhZGF0YSA9IG5ldyBNYXAobWV0YWRhdGEpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmFkZFJlc3VsdFBvaW50cyA9IGZ1bmN0aW9uIChuZXdQb2ludHMpIHsKCSAgICAgICAgdmFyIG9sZFBvaW50cyA9IHRoaXMucmVzdWx0UG9pbnRzOwoJICAgICAgICBpZiAob2xkUG9pbnRzID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aGlzLnJlc3VsdFBvaW50cyA9IG5ld1BvaW50czsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChuZXdQb2ludHMgIT09IG51bGwgJiYgbmV3UG9pbnRzLmxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgIHZhciBhbGxQb2ludHMgPSBuZXcgQXJyYXkob2xkUG9pbnRzLmxlbmd0aCArIG5ld1BvaW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgU3lzdGVtXzEkMS5kZWZhdWx0LmFycmF5Y29weShvbGRQb2ludHMsIDAsIGFsbFBvaW50cywgMCwgb2xkUG9pbnRzLmxlbmd0aCk7CgkgICAgICAgICAgICBTeXN0ZW1fMSQxLmRlZmF1bHQuYXJyYXljb3B5KG5ld1BvaW50cywgMCwgYWxsUG9pbnRzLCBvbGRQb2ludHMubGVuZ3RoLCBuZXdQb2ludHMubGVuZ3RoKTsKCSAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRzID0gYWxsUG9pbnRzOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZXN1bHQucHJvdG90eXBlLmdldFRpbWVzdGFtcCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRleHQ7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0OwoJfSgpKTsKCVJlc3VsdCQxLmRlZmF1bHQgPSBSZXN1bHQ7CgoJdmFyIFJlc3VsdE1ldGFkYXRhVHlwZSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA4IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZXN1bHRNZXRhZGF0YVR5cGUkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCS8qKgoJICogUmVwcmVzZW50cyBzb21lIHR5cGUgb2YgbWV0YWRhdGEgYWJvdXQgdGhlIHJlc3VsdCBvZiB0aGUgZGVjb2RpbmcgdGhhdCB0aGUgZGVjb2RlcgoJICogd2lzaGVzIHRvIGNvbW11bmljYXRlIGJhY2sgdG8gdGhlIGNhbGxlci4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlOwoJKGZ1bmN0aW9uIChSZXN1bHRNZXRhZGF0YVR5cGUpIHsKCSAgICAvKioKCSAgICAgKiBVbnNwZWNpZmllZCwgYXBwbGljYXRpb24tc3BlY2lmaWMgbWV0YWRhdGEuIE1hcHMgdG8gYW4gdW5zcGVjaWZpZWQge0BsaW5rIE9iamVjdH0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiT1RIRVIiXSA9IDBdID0gIk9USEVSIjsKCSAgICAvKioKCSAgICAgKiBEZW5vdGVzIHRoZSBsaWtlbHkgYXBwcm94aW1hdGUgb3JpZW50YXRpb24gb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLiBUaGlzIHZhbHVlCgkgICAgICogaXMgZ2l2ZW4gYXMgZGVncmVlcyByb3RhdGVkIGNsb2Nrd2lzZSBmcm9tIHRoZSBub3JtYWwsIHVwcmlnaHQgb3JpZW50YXRpb24uCgkgICAgICogRm9yIGV4YW1wbGUgYSAxRCBiYXJjb2RlIHdoaWNoIHdhcyBmb3VuZCBieSByZWFkaW5nIHRvcC10by1ib3R0b20gd291bGQgYmUKCSAgICAgKiBzYWlkIHRvIGhhdmUgb3JpZW50YXRpb24gIjkwIi4gVGhpcyBrZXkgbWFwcyB0byBhbiB7QGxpbmsgSW50ZWdlcn0gd2hvc2UKCSAgICAgKiB2YWx1ZSBpcyBpbiB0aGUgcmFuZ2UgWzAsMzYwKS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJPUklFTlRBVElPTiJdID0gMV0gPSAiT1JJRU5UQVRJT04iOwoJICAgIC8qKgoJICAgICAqIDxwPjJEIGJhcmNvZGUgZm9ybWF0cyB0eXBpY2FsbHkgZW5jb2RlIHRleHQsIGJ1dCBhbGxvdyBmb3IgYSBzb3J0IG9mICdieXRlIG1vZGUnCgkgICAgICogd2hpY2ggaXMgc29tZXRpbWVzIHVzZWQgdG8gZW5jb2RlIGJpbmFyeSBkYXRhLiBXaGlsZSB7QGxpbmsgUmVzdWx0fSBtYWtlcyBhdmFpbGFibGUKCSAgICAgKiB0aGUgY29tcGxldGUgcmF3IGJ5dGVzIGluIHRoZSBiYXJjb2RlIGZvciB0aGVzZSBmb3JtYXRzLCBpdCBkb2VzIG5vdCBvZmZlciB0aGUgYnl0ZXMKCSAgICAgKiBmcm9tIHRoZSBieXRlIHNlZ21lbnRzIGFsb25lLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWFwcyB0byBhIHtAbGluayBqYXZhLnV0aWwuTGlzdH0gb2YgYnl0ZSBhcnJheXMgY29ycmVzcG9uZGluZyB0byB0aGUKCSAgICAgKiByYXcgYnl0ZXMgaW4gdGhlIGJ5dGUgc2VnbWVudHMgaW4gdGhlIGJhcmNvZGUsIGluIG9yZGVyLjwvcD4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJCWVRFX1NFR01FTlRTIl0gPSAyXSA9ICJCWVRFX1NFR01FTlRTIjsKCSAgICAvKioKCSAgICAgKiBFcnJvciBjb3JyZWN0aW9uIGxldmVsIHVzZWQsIGlmIGFwcGxpY2FibGUuIFRoZSB2YWx1ZSB0eXBlIGRlcGVuZHMgb24gdGhlCgkgICAgICogZm9ybWF0LCBidXQgaXMgdHlwaWNhbGx5IGEgU3RyaW5nLgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiXSA9IDNdID0gIkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHBlcmlvZGljYWxzLCBpbmRpY2F0ZXMgdGhlIGlzc3VlIG51bWJlciBhcyBhbiB7QGxpbmsgSW50ZWdlcn0uCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiSVNTVUVfTlVNQkVSIl0gPSA0XSA9ICJJU1NVRV9OVU1CRVIiOwoJICAgIC8qKgoJICAgICAqIEZvciBzb21lIHByb2R1Y3RzLCBpbmRpY2F0ZXMgdGhlIHN1Z2dlc3RlZCByZXRhaWwgcHJpY2UgaW4gdGhlIGJhcmNvZGUgYXMgYQoJICAgICAqIGZvcm1hdHRlZCB7QGxpbmsgU3RyaW5nfS4KCSAgICAgKi8KCSAgICBSZXN1bHRNZXRhZGF0YVR5cGVbUmVzdWx0TWV0YWRhdGFUeXBlWyJTVUdHRVNURURfUFJJQ0UiXSA9IDVdID0gIlNVR0dFU1RFRF9QUklDRSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBwb3NzaWJsZSBjb3VudHJ5IG9mIG1hbnVmYWN0dXJlIGFzIGEge0BsaW5rIFN0cmluZ30gZGVub3RpbmcgdGhlCgkgICAgICogSVNPIGNvdW50cnkgY29kZS4gU29tZSBtYXAgdG8gbXVsdGlwbGUgcG9zc2libGUgY291bnRyaWVzLCBsaWtlICJVUy9DQSIuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUE9TU0lCTEVfQ09VTlRSWSJdID0gNl0gPSAiUE9TU0lCTEVfQ09VTlRSWSI7CgkgICAgLyoqCgkgICAgICogRm9yIHNvbWUgcHJvZHVjdHMsIHRoZSBleHRlbnNpb24gdGV4dAoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlVQQ19FQU5fRVhURU5TSU9OIl0gPSA3XSA9ICJVUENfRUFOX0VYVEVOU0lPTiI7CgkgICAgLyoqCgkgICAgICogUERGNDE3LXNwZWNpZmljIG1ldGFkYXRhCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiUERGNDE3X0VYVFJBX01FVEFEQVRBIl0gPSA4XSA9ICJQREY0MTdfRVhUUkFfTUVUQURBVEEiOwoJICAgIC8qKgoJICAgICAqIElmIHRoZSBjb2RlIGZvcm1hdCBzdXBwb3J0cyBzdHJ1Y3R1cmVkIGFwcGVuZCBhbmQgdGhlIGN1cnJlbnQgc2Nhbm5lZCBjb2RlIGlzIHBhcnQgb2Ygb25lIHRoZW4gdGhlCgkgICAgICogc2VxdWVuY2UgbnVtYmVyIGlzIGdpdmVuIHdpdGggaXQuCgkgICAgICovCgkgICAgUmVzdWx0TWV0YWRhdGFUeXBlW1Jlc3VsdE1ldGFkYXRhVHlwZVsiU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UiXSA9IDldID0gIlNUUlVDVFVSRURfQVBQRU5EX1NFUVVFTkNFIjsKCSAgICAvKioKCSAgICAgKiBJZiB0aGUgY29kZSBmb3JtYXQgc3VwcG9ydHMgc3RydWN0dXJlZCBhcHBlbmQgYW5kIHRoZSBjdXJyZW50IHNjYW5uZWQgY29kZSBpcyBwYXJ0IG9mIG9uZSB0aGVuIHRoZQoJICAgICAqIHBhcml0eSBpcyBnaXZlbiB3aXRoIGl0LgoJICAgICAqLwoJICAgIFJlc3VsdE1ldGFkYXRhVHlwZVtSZXN1bHRNZXRhZGF0YVR5cGVbIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSJdID0gMTBdID0gIlNUUlVDVFVSRURfQVBQRU5EX1BBUklUWSI7Cgl9KShSZXN1bHRNZXRhZGF0YVR5cGUgfHwgKFJlc3VsdE1ldGFkYXRhVHlwZSA9IHt9KSk7CglSZXN1bHRNZXRhZGF0YVR5cGUkMS5kZWZhdWx0ID0gUmVzdWx0TWV0YWRhdGFUeXBlOwoKCXZhciBEZWNvZGVyJDEgPSB7fTsKCgl2YXIgQ2hlY2tzdW1FeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkOCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGVja3N1bUV4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkNCA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBDaGVja3N1bUV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkOChDaGVja3N1bUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBDaGVja3N1bUV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5nZXRDaGVja3N1bUluc3RhbmNlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gbmV3IENoZWNrc3VtRXhjZXB0aW9uKCk7CgkgICAgfTsKCSAgICBDaGVja3N1bUV4Y2VwdGlvbi5raW5kID0gJ0NoZWNrc3VtRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQ2hlY2tzdW1FeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCkpOwoJQ2hlY2tzdW1FeGNlcHRpb24kMS5kZWZhdWx0ID0gQ2hlY2tzdW1FeGNlcHRpb247CgoJdmFyIEdlbmVyaWNHRiQxID0ge307CgoJdmFyIEdlbmVyaWNHRlBvbHkkMSA9IHt9OwoKCXZhciBBYnN0cmFjdEdlbmVyaWNHRiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYnN0cmFjdEdlbmVyaWNHRiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGNvbnRhaW5zIHV0aWxpdHkgbWV0aG9kcyBmb3IgcGVyZm9ybWluZyBtYXRoZW1hdGljYWwgb3BlcmF0aW9ucyBvdmVyCgkgKiB0aGUgR2Fsb2lzIEZpZWxkcy4gT3BlcmF0aW9ucyB1c2UgYSBnaXZlbiBwcmltaXRpdmUgcG9seW5vbWlhbCBpbiBjYWxjdWxhdGlvbnMuPC9wPgoJICoKCSAqIDxwPlRocm91Z2hvdXQgdGhpcyBwYWNrYWdlLCBlbGVtZW50cyBvZiB0aGUgR0YgYXJlIHJlcHJlc2VudGVkIGFzIGFuIHtAY29kZSBpbnR9CgkgKiBmb3IgY29udmVuaWVuY2UgYW5kIHNwZWVkIChidXQgYXQgdGhlIGNvc3Qgb2YgbWVtb3J5KS4KCSAqIDwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICogQGF1dGhvciBEYXZpZCBPbGl2aWVyCgkgKi8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBBYnN0cmFjdEdlbmVyaWNHRigpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiAyIHRvIHRoZSBwb3dlciBvZiBhIGluIEdGKHNpemUpCgkgICAgICovCgkgICAgQWJzdHJhY3RHZW5lcmljR0YucHJvdG90eXBlLmV4cCA9IGZ1bmN0aW9uIChhKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmV4cFRhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBiYXNlIDIgbG9nIG9mIGEgaW4gR0Yoc2l6ZSkKCSAgICAgKi8KCSAgICBBYnN0cmFjdEdlbmVyaWNHRi5wcm90b3R5cGUubG9nID0gZnVuY3Rpb24gKGEgLyppbnQqLykgewoJICAgICAgICBpZiAoYSA9PT0gMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDUuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiB0aGlzLmxvZ1RhYmxlW2FdOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogSW1wbGVtZW50cyBib3RoIGFkZGl0aW9uIGFuZCBzdWJ0cmFjdGlvbiAtLSB0aGV5IGFyZSB0aGUgc2FtZSBpbiBHRihzaXplKS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gc3VtL2RpZmZlcmVuY2Ugb2YgYSBhbmQgYgoJICAgICAqLwoJICAgIEFic3RyYWN0R2VuZXJpY0dGLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIGEgXiBiOwoJICAgIH07CgkgICAgcmV0dXJuIEFic3RyYWN0R2VuZXJpY0dGOwoJfSgpKTsKCUFic3RyYWN0R2VuZXJpY0dGJDEuZGVmYXVsdCA9IEFic3RyYWN0R2VuZXJpY0dGOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGUG9seSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5yZWVkc29sb21vbiB7Ki8KCXZhciBBYnN0cmFjdEdlbmVyaWNHRl8xJDEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIFN5c3RlbV8xID0gU3lzdGVtJDE7Cgl2YXIgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNCA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5SZXByZXNlbnRzIGEgcG9seW5vbWlhbCB3aG9zZSBjb2VmZmljaWVudHMgYXJlIGVsZW1lbnRzIG9mIGEgR0YuCgkgKiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBhcmUgaW1tdXRhYmxlLjwvcD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdlbmVyaWNHRlBvbHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGZpZWxkIHRoZSB7QGxpbmsgR2VuZXJpY0dGfSBpbnN0YW5jZSByZXByZXNlbnRpbmcgdGhlIGZpZWxkIHRvIHVzZQoJICAgICAqIHRvIHBlcmZvcm0gY29tcHV0YXRpb25zCgkgICAgICogQHBhcmFtIGNvZWZmaWNpZW50cyBjb2VmZmljaWVudHMgYXMgaW50cyByZXByZXNlbnRpbmcgZWxlbWVudHMgb2YgR0Yoc2l6ZSksIGFycmFuZ2VkCgkgICAgICogZnJvbSBtb3N0IHNpZ25pZmljYW50IChoaWdoZXN0LXBvd2VyIHRlcm0pIGNvZWZmaWNpZW50IHRvIGxlYXN0IHNpZ25pZmljYW50CgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYXJndW1lbnQgaXMgbnVsbCBvciBlbXB0eSwKCSAgICAgKiBvciBpZiBsZWFkaW5nIGNvZWZmaWNpZW50IGlzIDAgYW5kIHRoaXMgaXMgbm90IGEKCSAgICAgKiBjb25zdGFudCBwb2x5bm9taWFsICh0aGF0IGlzLCBpdCBpcyBub3QgdGhlIG1vbm9taWFsICIwIikKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBHZW5lcmljR0ZQb2x5KGZpZWxkLCBjb2VmZmljaWVudHMpIHsKCSAgICAgICAgaWYgKGNvZWZmaWNpZW50cy5sZW5ndGggPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0aGlzLmZpZWxkID0gZmllbGQ7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHNMZW5ndGggPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICBpZiAoY29lZmZpY2llbnRzTGVuZ3RoID4gMSAmJiBjb2VmZmljaWVudHNbMF0gPT09IDApIHsKCSAgICAgICAgICAgIC8vIExlYWRpbmcgdGVybSBtdXN0IGJlIG5vbi16ZXJvIGZvciBhbnl0aGluZyBleGNlcHQgdGhlIGNvbnN0YW50IHBvbHlub21pYWwgIjAiCgkgICAgICAgICAgICB2YXIgZmlyc3ROb25aZXJvID0gMTsKCSAgICAgICAgICAgIHdoaWxlIChmaXJzdE5vblplcm8gPCBjb2VmZmljaWVudHNMZW5ndGggJiYgY29lZmZpY2llbnRzW2ZpcnN0Tm9uWmVyb10gPT09IDApIHsKCSAgICAgICAgICAgICAgICBmaXJzdE5vblplcm8rKzsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChmaXJzdE5vblplcm8gPT09IGNvZWZmaWNpZW50c0xlbmd0aCkgewoJICAgICAgICAgICAgICAgIHRoaXMuY29lZmZpY2llbnRzID0gSW50MzJBcnJheS5mcm9tKFswXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICB0aGlzLmNvZWZmaWNpZW50cyA9IG5ldyBJbnQzMkFycmF5KGNvZWZmaWNpZW50c0xlbmd0aCAtIGZpcnN0Tm9uWmVybyk7CgkgICAgICAgICAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkoY29lZmZpY2llbnRzLCBmaXJzdE5vblplcm8sIHRoaXMuY29lZmZpY2llbnRzLCAwLCB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGgpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdGhpcy5jb2VmZmljaWVudHMgPSBjb2VmZmljaWVudHM7CgkgICAgICAgIH0KCSAgICB9CgkgICAgR2VuZXJpY0dGUG9seS5wcm90b3R5cGUuZ2V0Q29lZmZpY2llbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGRlZ3JlZSBvZiB0aGlzIHBvbHlub21pYWwKCSAgICAgKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5nZXREZWdyZWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGlzIHBvbHlub21pYWwgaXMgdGhlIG1vbm9taWFsICIwIgoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmlzWmVybyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29lZmZpY2llbnRzWzBdID09PSAwOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBjb2VmZmljaWVudCBvZiB4XmRlZ3JlZSB0ZXJtIGluIHRoaXMgcG9seW5vbWlhbAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmdldENvZWZmaWNpZW50ID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvZWZmaWNpZW50c1t0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGggLSAxIC0gZGVncmVlXTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gZXZhbHVhdGlvbiBvZiB0aGlzIHBvbHlub21pYWwgYXQgYSBnaXZlbiBwb2ludAoJICAgICAqLwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmV2YWx1YXRlQXQgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHJldHVybiB0aGUgeF4wIGNvZWZmaWNpZW50CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgY29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciByZXN1bHQ7CgkgICAgICAgIGlmIChhID09PSAxKSB7CgkgICAgICAgICAgICAvLyBKdXN0IHRoZSBzdW0gb2YgdGhlIGNvZWZmaWNpZW50cwoJICAgICAgICAgICAgcmVzdWx0ID0gMDsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGhfMSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7IGkgIT09IGxlbmd0aF8xOyBpKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgY29lZmZpY2llbnQgPSBjb2VmZmljaWVudHNbaV07CgkgICAgICAgICAgICAgICAgcmVzdWx0ID0gQWJzdHJhY3RHZW5lcmljR0ZfMSQxLmRlZmF1bHQuYWRkT3JTdWJ0cmFjdChyZXN1bHQsIGNvZWZmaWNpZW50KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgICAgIH0KCSAgICAgICAgcmVzdWx0ID0gY29lZmZpY2llbnRzWzBdOwoJICAgICAgICB2YXIgc2l6ZSA9IGNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgc2l6ZTsgaSsrKSB7CgkgICAgICAgICAgICByZXN1bHQgPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KGZpZWxkLm11bHRpcGx5KGEsIHJlc3VsdCksIGNvZWZmaWNpZW50c1tpXSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLmFkZE9yU3VidHJhY3QgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiBvdGhlcjsKCSAgICAgICAgfQoJICAgICAgICBpZiAob3RoZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzbWFsbGVyQ29lZmZpY2llbnRzID0gdGhpcy5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBsYXJnZXJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIGlmIChzbWFsbGVyQ29lZmZpY2llbnRzLmxlbmd0aCA+IGxhcmdlckNvZWZmaWNpZW50cy5sZW5ndGgpIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gc21hbGxlckNvZWZmaWNpZW50czsKCSAgICAgICAgICAgIHNtYWxsZXJDb2VmZmljaWVudHMgPSBsYXJnZXJDb2VmZmljaWVudHM7CgkgICAgICAgICAgICBsYXJnZXJDb2VmZmljaWVudHMgPSB0ZW1wOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzdW1EaWZmID0gbmV3IEludDMyQXJyYXkobGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCk7CgkgICAgICAgIHZhciBsZW5ndGhEaWZmID0gbGFyZ2VyQ29lZmZpY2llbnRzLmxlbmd0aCAtIHNtYWxsZXJDb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICAvLyBDb3B5IGhpZ2gtb3JkZXIgdGVybXMgb25seSBmb3VuZCBpbiBoaWdoZXItZGVncmVlIHBvbHlub21pYWwncyBjb2VmZmljaWVudHMKCSAgICAgICAgU3lzdGVtXzEuZGVmYXVsdC5hcnJheWNvcHkobGFyZ2VyQ29lZmZpY2llbnRzLCAwLCBzdW1EaWZmLCAwLCBsZW5ndGhEaWZmKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IGxlbmd0aERpZmY7IGkgPCBsYXJnZXJDb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHN1bURpZmZbaV0gPSBBYnN0cmFjdEdlbmVyaWNHRl8xJDEuZGVmYXVsdC5hZGRPclN1YnRyYWN0KHNtYWxsZXJDb2VmZmljaWVudHNbaSAtIGxlbmd0aERpZmZdLCBsYXJnZXJDb2VmZmljaWVudHNbaV0pOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seSh0aGlzLmZpZWxkLCBzdW1EaWZmKTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5ID0gZnVuY3Rpb24gKG90aGVyKSB7CgkgICAgICAgIGlmICghdGhpcy5maWVsZC5lcXVhbHMob3RoZXIuZmllbGQpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdHZW5lcmljR0ZQb2x5cyBkbyBub3QgaGF2ZSBzYW1lIEdlbmVyaWNHRiBmaWVsZCcpOwoJICAgICAgICB9CgkgICAgICAgIGlmICh0aGlzLmlzWmVybygpIHx8IG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGFDb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIGFMZW5ndGggPSBhQ29lZmZpY2llbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGJDb2VmZmljaWVudHMgPSBvdGhlci5jb2VmZmljaWVudHM7CgkgICAgICAgIHZhciBiTGVuZ3RoID0gYkNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoYUxlbmd0aCArIGJMZW5ndGggLSAxKTsKCSAgICAgICAgdmFyIGZpZWxkID0gdGhpcy5maWVsZDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhTGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBhQ29lZmYgPSBhQ29lZmZpY2llbnRzW2ldOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBiTGVuZ3RoOyBqKyspIHsKCSAgICAgICAgICAgICAgICBwcm9kdWN0W2kgKyBqXSA9IEFic3RyYWN0R2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocHJvZHVjdFtpICsgal0sIGZpZWxkLm11bHRpcGx5KGFDb2VmZiwgYkNvZWZmaWNpZW50c1tqXSkpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5tdWx0aXBseVNjYWxhciA9IGZ1bmN0aW9uIChzY2FsYXIgLyppbnQqLykgewoJICAgICAgICBpZiAoc2NhbGFyID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC5nZXRaZXJvKCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHNjYWxhciA9PT0gMSkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXM7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHNpemUgPSB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGg7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBwcm9kdWN0ID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIHByb2R1Y3RbaV0gPSBmaWVsZC5tdWx0aXBseShjb2VmZmljaWVudHNbaV0sIHNjYWxhcik7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljR0ZQb2x5KGZpZWxkLCBwcm9kdWN0KTsKCSAgICB9OwoJICAgIEdlbmVyaWNHRlBvbHkucHJvdG90eXBlLm11bHRpcGx5QnlNb25vbWlhbCA9IGZ1bmN0aW9uIChkZWdyZWUgLyppbnQqLywgY29lZmZpY2llbnQgLyppbnQqLykgewoJICAgICAgICBpZiAoZGVncmVlIDwgMCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDQuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChjb2VmZmljaWVudCA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmllbGQuZ2V0WmVybygpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSB0aGlzLmNvZWZmaWNpZW50czsKCSAgICAgICAgdmFyIHNpemUgPSBjb2VmZmljaWVudHMubGVuZ3RoOwoJICAgICAgICB2YXIgcHJvZHVjdCA9IG5ldyBJbnQzMkFycmF5KHNpemUgKyBkZWdyZWUpOwoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpemU7IGkrKykgewoJICAgICAgICAgICAgcHJvZHVjdFtpXSA9IGZpZWxkLm11bHRpcGx5KGNvZWZmaWNpZW50c1tpXSwgY29lZmZpY2llbnQpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seShmaWVsZCwgcHJvZHVjdCk7CgkgICAgfTsKCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKCF0aGlzLmZpZWxkLmVxdWFscyhvdGhlci5maWVsZCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoJ0dlbmVyaWNHRlBvbHlzIGRvIG5vdCBoYXZlIHNhbWUgR2VuZXJpY0dGIGZpZWxkJyk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG90aGVyLmlzWmVybygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkNC5kZWZhdWx0KCdEaXZpZGUgYnkgMCcpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIHZhciBxdW90aWVudCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHJlbWFpbmRlciA9IHRoaXM7CgkgICAgICAgIHZhciBkZW5vbWluYXRvckxlYWRpbmdUZXJtID0gb3RoZXIuZ2V0Q29lZmZpY2llbnQob3RoZXIuZ2V0RGVncmVlKCkpOwoJICAgICAgICB2YXIgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0gPSBmaWVsZC5pbnZlcnNlKGRlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICB3aGlsZSAocmVtYWluZGVyLmdldERlZ3JlZSgpID49IG90aGVyLmdldERlZ3JlZSgpICYmICFyZW1haW5kZXIuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgIHZhciBkZWdyZWVEaWZmZXJlbmNlID0gcmVtYWluZGVyLmdldERlZ3JlZSgpIC0gb3RoZXIuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICB2YXIgc2NhbGUgPSBmaWVsZC5tdWx0aXBseShyZW1haW5kZXIuZ2V0Q29lZmZpY2llbnQocmVtYWluZGVyLmdldERlZ3JlZSgpKSwgaW52ZXJzZURlbm9taW5hdG9yTGVhZGluZ1Rlcm0pOwoJICAgICAgICAgICAgdmFyIHRlcm0gPSBvdGhlci5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZmVyZW5jZSwgc2NhbGUpOwoJICAgICAgICAgICAgdmFyIGl0ZXJhdGlvblF1b3RpZW50ID0gZmllbGQuYnVpbGRNb25vbWlhbChkZWdyZWVEaWZmZXJlbmNlLCBzY2FsZSk7CgkgICAgICAgICAgICBxdW90aWVudCA9IHF1b3RpZW50LmFkZE9yU3VidHJhY3QoaXRlcmF0aW9uUXVvdGllbnQpOwoJICAgICAgICAgICAgcmVtYWluZGVyID0gcmVtYWluZGVyLmFkZE9yU3VidHJhY3QodGVybSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFtxdW90aWVudCwgcmVtYWluZGVyXTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBHZW5lcmljR0ZQb2x5LnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIHJlc3VsdCA9ICcnOwoJICAgICAgICBmb3IgKHZhciBkZWdyZWUgPSB0aGlzLmdldERlZ3JlZSgpOyBkZWdyZWUgPj0gMDsgZGVncmVlLS0pIHsKCSAgICAgICAgICAgIHZhciBjb2VmZmljaWVudCA9IHRoaXMuZ2V0Q29lZmZpY2llbnQoZGVncmVlKTsKCSAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIGlmIChjb2VmZmljaWVudCA8IDApIHsKCSAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgLSAnOwoJICAgICAgICAgICAgICAgICAgICBjb2VmZmljaWVudCA9IC1jb2VmZmljaWVudDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICcgKyAnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgPT09IDAgfHwgY29lZmZpY2llbnQgIT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGFscGhhUG93ZXIgPSB0aGlzLmZpZWxkLmxvZyhjb2VmZmljaWVudCk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChhbHBoYVBvd2VyID09PSAwKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJzEnOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFscGhhUG93ZXIgPT09IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAnYSc7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gJ2FeJzsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBhbHBoYVBvd2VyOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGlmIChkZWdyZWUgIT09IDApIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKGRlZ3JlZSA9PT0gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9ICd4JzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSAneF4nOwoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IGRlZ3JlZTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIEdlbmVyaWNHRlBvbHk7Cgl9KCkpOwoJR2VuZXJpY0dGUG9seSQxLmRlZmF1bHQgPSBHZW5lcmljR0ZQb2x5OwoKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDcgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgRXhjZXB0aW9uXzEkMyA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcml0aG1ldGljRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ3KEFyaXRobWV0aWNFeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gQXJpdGhtZXRpY0V4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcml0aG1ldGljRXhjZXB0aW9uLmtpbmQgPSAnQXJpdGhtZXRpY0V4Y2VwdGlvbic7CgkgICAgcmV0dXJuIEFyaXRobWV0aWNFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCkpOwoJQXJpdGhtZXRpY0V4Y2VwdGlvbiQxLmRlZmF1bHQgPSBBcml0aG1ldGljRXhjZXB0aW9uOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoR2VuZXJpY0dGJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uLnJlZWRzb2xvbW9uIHsqLwoJdmFyIEdlbmVyaWNHRlBvbHlfMSQxID0gR2VuZXJpY0dGUG9seSQxOwoJdmFyIEFic3RyYWN0R2VuZXJpY0dGXzEgPSBBYnN0cmFjdEdlbmVyaWNHRiQxOwoJdmFyIEludGVnZXJfMSQxID0gSW50ZWdlciQxOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDMgPSBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBBcml0aG1ldGljRXhjZXB0aW9uXzEgPSBBcml0aG1ldGljRXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgY29udGFpbnMgdXRpbGl0eSBtZXRob2RzIGZvciBwZXJmb3JtaW5nIG1hdGhlbWF0aWNhbCBvcGVyYXRpb25zIG92ZXIKCSAqIHRoZSBHYWxvaXMgRmllbGRzLiBPcGVyYXRpb25zIHVzZSBhIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsIGluIGNhbGN1bGF0aW9ucy48L3A+CgkgKgoJICogPHA+VGhyb3VnaG91dCB0aGlzIHBhY2thZ2UsIGVsZW1lbnRzIG9mIHRoZSBHRiBhcmUgcmVwcmVzZW50ZWQgYXMgYW4ge0Bjb2RlIGludH0KCSAqIGZvciBjb252ZW5pZW5jZSBhbmQgc3BlZWQgKGJ1dCBhdCB0aGUgY29zdCBvZiBtZW1vcnkpLgoJICogPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKiBAYXV0aG9yIERhdmlkIE9saXZpZXIKCSAqLwoJdmFyIEdlbmVyaWNHRiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkNihHZW5lcmljR0YsIF9zdXBlcik7CgkgICAgLyoqCgkgICAgICogQ3JlYXRlIGEgcmVwcmVzZW50YXRpb24gb2YgR0Yoc2l6ZSkgdXNpbmcgdGhlIGdpdmVuIHByaW1pdGl2ZSBwb2x5bm9taWFsLgoJICAgICAqCgkgICAgICogQHBhcmFtIHByaW1pdGl2ZSBpcnJlZHVjaWJsZSBwb2x5bm9taWFsIHdob3NlIGNvZWZmaWNpZW50cyBhcmUgcmVwcmVzZW50ZWQgYnkKCSAgICAgKiAgdGhlIGJpdHMgb2YgYW4gaW50LCB3aGVyZSB0aGUgbGVhc3Qtc2lnbmlmaWNhbnQgYml0IHJlcHJlc2VudHMgdGhlIGNvbnN0YW50CgkgICAgICogIGNvZWZmaWNpZW50CgkgICAgICogQHBhcmFtIHNpemUgdGhlIHNpemUgb2YgdGhlIGZpZWxkCgkgICAgICogQHBhcmFtIGIgdGhlIGZhY3RvciBiIGluIHRoZSBnZW5lcmF0b3IgcG9seW5vbWlhbCBjYW4gYmUgMC0gb3IgMS1iYXNlZAoJICAgICAqICAoZyh4KSA9ICh4K2FeYikoeCthXihiKzEpKS4uLih4K2FeKGIrMnQtMSkpKS4KCSAgICAgKiAgSW4gbW9zdCBjYXNlcyBpdCBzaG91bGQgYmUgMSwgYnV0IGZvciBRUiBjb2RlIGl0IGlzIDAuCgkgICAgICovCgkgICAgZnVuY3Rpb24gR2VuZXJpY0dGKHByaW1pdGl2ZSAvKmludCovLCBzaXplIC8qaW50Ki8sIGdlbmVyYXRvckJhc2UgLyppbnQqLykgewoJICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzOwoJICAgICAgICBfdGhpcy5wcmltaXRpdmUgPSBwcmltaXRpdmU7CgkgICAgICAgIF90aGlzLnNpemUgPSBzaXplOwoJICAgICAgICBfdGhpcy5nZW5lcmF0b3JCYXNlID0gZ2VuZXJhdG9yQmFzZTsKCSAgICAgICAgdmFyIGV4cFRhYmxlID0gbmV3IEludDMyQXJyYXkoc2l6ZSk7CgkgICAgICAgIHZhciB4ID0gMTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplOyBpKyspIHsKCSAgICAgICAgICAgIGV4cFRhYmxlW2ldID0geDsKCSAgICAgICAgICAgIHggKj0gMjsgLy8gd2UncmUgYXNzdW1pbmcgdGhlIGdlbmVyYXRvciBhbHBoYSBpcyAyCgkgICAgICAgICAgICBpZiAoeCA+PSBzaXplKSB7CgkgICAgICAgICAgICAgICAgeCBePSBwcmltaXRpdmU7CgkgICAgICAgICAgICAgICAgeCAmPSBzaXplIC0gMTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBfdGhpcy5leHBUYWJsZSA9IGV4cFRhYmxlOwoJICAgICAgICB2YXIgbG9nVGFibGUgPSBuZXcgSW50MzJBcnJheShzaXplKTsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaXplIC0gMTsgaSsrKSB7CgkgICAgICAgICAgICBsb2dUYWJsZVtleHBUYWJsZVtpXV0gPSBpOwoJICAgICAgICB9CgkgICAgICAgIF90aGlzLmxvZ1RhYmxlID0gbG9nVGFibGU7CgkgICAgICAgIC8vIGxvZ1RhYmxlWzBdID09IDAgYnV0IHRoaXMgc2hvdWxkIG5ldmVyIGJlIHVzZWQKCSAgICAgICAgX3RoaXMuemVybyA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzBdKSk7CgkgICAgICAgIF90aGlzLm9uZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEkMS5kZWZhdWx0KF90aGlzLCBJbnQzMkFycmF5LmZyb20oWzFdKSk7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRaZXJvID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5nZXRPbmUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm9uZTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdGhlIG1vbm9taWFsIHJlcHJlc2VudGluZyBjb2VmZmljaWVudCAqIHheZGVncmVlCgkgICAgICovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5idWlsZE1vbm9taWFsID0gZnVuY3Rpb24gKGRlZ3JlZSAvKmludCovLCBjb2VmZmljaWVudCAvKmludCovKSB7CgkgICAgICAgIGlmIChkZWdyZWUgPCAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uXzEkMy5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvZWZmaWNpZW50ID09PSAwKSB7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy56ZXJvOwoJICAgICAgICB9CgkgICAgICAgIHZhciBjb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheShkZWdyZWUgKyAxKTsKCSAgICAgICAgY29lZmZpY2llbnRzWzBdID0gY29lZmZpY2llbnQ7CgkgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0dGUG9seV8xJDEuZGVmYXVsdCh0aGlzLCBjb2VmZmljaWVudHMpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBtdWx0aXBsaWNhdGl2ZSBpbnZlcnNlIG9mIGEKCSAgICAgKi8KCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmludmVyc2UgPSBmdW5jdGlvbiAoYSAvKmludCovKSB7CgkgICAgICAgIGlmIChhID09PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQXJpdGhtZXRpY0V4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5leHBUYWJsZVt0aGlzLnNpemUgLSB0aGlzLmxvZ1RhYmxlW2FdIC0gMV07CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHByb2R1Y3Qgb2YgYSBhbmQgYiBpbiBHRihzaXplKQoJICAgICAqLwoJICAgIEdlbmVyaWNHRi5wcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiAoYSAvKmludCovLCBiIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGEgPT09IDAgfHwgYiA9PT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIDA7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZXhwVGFibGVbKHRoaXMubG9nVGFibGVbYV0gKyB0aGlzLmxvZ1RhYmxlW2JdKSAlICh0aGlzLnNpemUgLSAxKV07CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnNpemU7CgkgICAgfTsKCSAgICBHZW5lcmljR0YucHJvdG90eXBlLmdldEdlbmVyYXRvckJhc2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRvckJhc2U7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICgnR0YoMHgnICsgSW50ZWdlcl8xJDEuZGVmYXVsdC50b0hleFN0cmluZyh0aGlzLnByaW1pdGl2ZSkgKyAnLCcgKyB0aGlzLnNpemUgKyAnKScpOwoJICAgIH07CgkgICAgR2VuZXJpY0dGLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICByZXR1cm4gbyA9PT0gdGhpczsKCSAgICB9OwoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEyID0gbmV3IEdlbmVyaWNHRigweDEwNjksIDQwOTYsIDEpOyAvLyB4XjEyICsgeF42ICsgeF41ICsgeF4zICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19EQVRBXzEwID0gbmV3IEdlbmVyaWNHRigweDQwOSwgMTAyNCwgMSk7IC8vIHheMTAgKyB4XjMgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfNiA9IG5ldyBHZW5lcmljR0YoMHg0MywgNjQsIDEpOyAvLyB4XjYgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5BWlRFQ19QQVJBTSA9IG5ldyBHZW5lcmljR0YoMHgxMywgMTYsIDEpOyAvLyB4XjQgKyB4ICsgMQoJICAgIEdlbmVyaWNHRi5RUl9DT0RFX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTFkLCAyNTYsIDApOyAvLyB4XjggKyB4XjQgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkRBVEFfTUFUUklYX0ZJRUxEXzI1NiA9IG5ldyBHZW5lcmljR0YoMHgwMTJkLCAyNTYsIDEpOyAvLyB4XjggKyB4XjUgKyB4XjMgKyB4XjIgKyAxCgkgICAgR2VuZXJpY0dGLkFaVEVDX0RBVEFfOCA9IEdlbmVyaWNHRi5EQVRBX01BVFJJWF9GSUVMRF8yNTY7CgkgICAgR2VuZXJpY0dGLk1BWElDT0RFX0ZJRUxEXzY0ID0gR2VuZXJpY0dGLkFaVEVDX0RBVEFfNjsKCSAgICByZXR1cm4gR2VuZXJpY0dGOwoJfShBYnN0cmFjdEdlbmVyaWNHRl8xLmRlZmF1bHQpKTsKCUdlbmVyaWNHRiQxLmRlZmF1bHQgPSBHZW5lcmljR0Y7CgoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciQxID0ge307CgoJdmFyIFJlZWRTb2xvbW9uRXhjZXB0aW9uJDEgPSB7fTsKCgl2YXIgX19leHRlbmRzJDUgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVlZFNvbG9tb25FeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDIgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgUmVlZFNvbG9tb25FeGNlcHRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDUoUmVlZFNvbG9tb25FeGNlcHRpb24sIF9zdXBlcik7CgkgICAgZnVuY3Rpb24gUmVlZFNvbG9tb25FeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgUmVlZFNvbG9tb25FeGNlcHRpb24ua2luZCA9ICdSZWVkU29sb21vbkV4Y2VwdGlvbic7CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQyLmRlZmF1bHQpKTsKCVJlZWRTb2xvbW9uRXhjZXB0aW9uJDEuZGVmYXVsdCA9IFJlZWRTb2xvbW9uRXhjZXB0aW9uOwoKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSA9IHt9OwoKCXZhciBfX2V4dGVuZHMkNCA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7CgkgICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8CgkgICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8CgkgICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTsKCSAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgfTsKCSAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9CgkgICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTsKCSAgICB9OwoJfSkoKTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbGxlZ2FsU3RhdGVFeGNlcHRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIEV4Y2VwdGlvbl8xJDEgPSBFeGNlcHRpb24kMTsKCS8qKgoJICogQ3VzdG9tIEVycm9yIGNsYXNzIG9mIHR5cGUgRXhjZXB0aW9uLgoJICovCgl2YXIgSWxsZWdhbFN0YXRlRXhjZXB0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyQ0KElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oKSB7CgkgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsKCSAgICB9CgkgICAgSWxsZWdhbFN0YXRlRXhjZXB0aW9uLmtpbmQgPSAnSWxsZWdhbFN0YXRlRXhjZXB0aW9uJzsKCSAgICByZXR1cm4gSWxsZWdhbFN0YXRlRXhjZXB0aW9uOwoJfShFeGNlcHRpb25fMSQxLmRlZmF1bHQpKTsKCUlsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxLmRlZmF1bHQgPSBJbGxlZ2FsU3RhdGVFeGNlcHRpb247CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShSZWVkU29sb21vbkRlY29kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5jb21tb24ucmVlZHNvbG9tb24geyovCgl2YXIgR2VuZXJpY0dGXzEkMSA9IEdlbmVyaWNHRiQxOwoJdmFyIEdlbmVyaWNHRlBvbHlfMSA9IEdlbmVyaWNHRlBvbHkkMTsKCXZhciBSZWVkU29sb21vbkV4Y2VwdGlvbl8xID0gUmVlZFNvbG9tb25FeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMSA9IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5JbXBsZW1lbnRzIFJlZWQtU29sb21vbiBkZWNvZGluZywgYXMgdGhlIG5hbWUgaW1wbGllcy48L3A+CgkgKgoJICogPHA+VGhlIGFsZ29yaXRobSB3aWxsIG5vdCBiZSBleHBsYWluZWQgaGVyZSwgYnV0IHRoZSBmb2xsb3dpbmcgcmVmZXJlbmNlcyB3ZXJlIGhlbHBmdWwKCSAqIGluIGNyZWF0aW5nIHRoaXMgaW1wbGVtZW50YXRpb246PC9wPgoJICoKCSAqIDx1bD4KCSAqIDxsaT5CcnVjZSBNYWdncy4KCSAqIDxhIGhyZWY9Imh0dHA6Ly93d3cuY3MuY211LmVkdS9hZnMvY3MuY211LmVkdS9wcm9qZWN0L3BzY2ljby1ndXliL3JlYWx3b3JsZC93d3cvcnNfZGVjb2RlLnBzIj4KCSAqICJEZWNvZGluZyBSZWVkLVNvbG9tb24gQ29kZXMiPC9hPiAoc2VlIGRpc2N1c3Npb24gb2YgRm9ybmV5J3MgRm9ybXVsYSk8L2xpPgoJICogPGxpPkouSS4gSGFsbC4gPGEgaHJlZj0id3d3Lm10aC5tc3UuZWR1L35qaGFsbC9jbGFzc2VzL2NvZGVub3Rlcy9HUlMucGRmIj4KCSAqICJDaGFwdGVyIDUuIEdlbmVyYWxpemVkIFJlZWQtU29sb21vbiBDb2RlcyI8L2E+CgkgKiAoc2VlIGRpc2N1c3Npb24gb2YgRXVjbGlkZWFuIGFsZ29yaXRobSk8L2xpPgoJICogPC91bD4KCSAqCgkgKiA8cD5NdWNoIGNyZWRpdCBpcyBkdWUgdG8gV2lsbGlhbSBSdWNrbGlkZ2Ugc2luY2UgcG9ydGlvbnMgb2YgdGhpcyBjb2RlIGFyZSBhbiBpbmRpcmVjdAoJICogcG9ydCBvZiBoaXMgQysrIFJlZWQtU29sb21vbiBpbXBsZW1lbnRhdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBhdXRob3IgV2lsbGlhbSBSdWNrbGlkZ2UKCSAqIEBhdXRob3Igc2FuZm9yZHNxdWlyZXMKCSAqLwoJdmFyIFJlZWRTb2xvbW9uRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBSZWVkU29sb21vbkRlY29kZXIoZmllbGQpIHsKCSAgICAgICAgdGhpcy5maWVsZCA9IGZpZWxkOwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5EZWNvZGVzIGdpdmVuIHNldCBvZiByZWNlaXZlZCBjb2Rld29yZHMsIHdoaWNoIGluY2x1ZGUgYm90aCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uCgkgICAgICogY29kZXdvcmRzLiBSZWFsbHksIHRoaXMgbWVhbnMgaXQgdXNlcyBSZWVkLVNvbG9tb24gdG8gZGV0ZWN0IGFuZCBjb3JyZWN0IGVycm9ycywgaW4tcGxhY2UsCgkgICAgICogaW4gdGhlIGlucHV0LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByZWNlaXZlZCBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcwoJICAgICAqIEBwYXJhbSB0d29TIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBhdmFpbGFibGUKCSAgICAgKiBAdGhyb3dzIFJlZWRTb2xvbW9uRXhjZXB0aW9uIGlmIGRlY29kaW5nIGZhaWxzIGZvciBhbnkgcmVhc29uCgkgICAgICovCgkgICAgUmVlZFNvbG9tb25EZWNvZGVyLnByb3RvdHlwZS5kZWNvZGUgPSBmdW5jdGlvbiAocmVjZWl2ZWQsIHR3b1MgLyppbnQqLykgewoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgcG9seSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgcmVjZWl2ZWQpOwoJICAgICAgICB2YXIgc3luZHJvbWVDb2VmZmljaWVudHMgPSBuZXcgSW50MzJBcnJheSh0d29TKTsKCSAgICAgICAgdmFyIG5vRXJyb3IgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHR3b1M7IGkrKykgewoJICAgICAgICAgICAgdmFyIGV2YWxSZXN1bHQgPSBwb2x5LmV2YWx1YXRlQXQoZmllbGQuZXhwKGkgKyBmaWVsZC5nZXRHZW5lcmF0b3JCYXNlKCkpKTsKCSAgICAgICAgICAgIHN5bmRyb21lQ29lZmZpY2llbnRzW3N5bmRyb21lQ29lZmZpY2llbnRzLmxlbmd0aCAtIDEgLSBpXSA9IGV2YWxSZXN1bHQ7CgkgICAgICAgICAgICBpZiAoZXZhbFJlc3VsdCAhPT0gMCkgewoJICAgICAgICAgICAgICAgIG5vRXJyb3IgPSBmYWxzZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBpZiAobm9FcnJvcikgewoJICAgICAgICAgICAgcmV0dXJuOwoJICAgICAgICB9CgkgICAgICAgIHZhciBzeW5kcm9tZSA9IG5ldyBHZW5lcmljR0ZQb2x5XzEuZGVmYXVsdChmaWVsZCwgc3luZHJvbWVDb2VmZmljaWVudHMpOwoJICAgICAgICB2YXIgc2lnbWFPbWVnYSA9IHRoaXMucnVuRXVjbGlkZWFuQWxnb3JpdGhtKGZpZWxkLmJ1aWxkTW9ub21pYWwodHdvUywgMSksIHN5bmRyb21lLCB0d29TKTsKCSAgICAgICAgdmFyIHNpZ21hID0gc2lnbWFPbWVnYVswXTsKCSAgICAgICAgdmFyIG9tZWdhID0gc2lnbWFPbWVnYVsxXTsKCSAgICAgICAgdmFyIGVycm9yTG9jYXRpb25zID0gdGhpcy5maW5kRXJyb3JMb2NhdGlvbnMoc2lnbWEpOwoJICAgICAgICB2YXIgZXJyb3JNYWduaXR1ZGVzID0gdGhpcy5maW5kRXJyb3JNYWduaXR1ZGVzKG9tZWdhLCBlcnJvckxvY2F0aW9ucyk7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZXJyb3JMb2NhdGlvbnMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IHJlY2VpdmVkLmxlbmd0aCAtIDEgLSBmaWVsZC5sb2coZXJyb3JMb2NhdGlvbnNbaV0pOwoJICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ0JhZCBlcnJvciBsb2NhdGlvbicpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVjZWl2ZWRbcG9zaXRpb25dID0gR2VuZXJpY0dGXzEkMS5kZWZhdWx0LmFkZE9yU3VidHJhY3QocmVjZWl2ZWRbcG9zaXRpb25dLCBlcnJvck1hZ25pdHVkZXNbaV0pOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBSZWVkU29sb21vbkRlY29kZXIucHJvdG90eXBlLnJ1bkV1Y2xpZGVhbkFsZ29yaXRobSA9IGZ1bmN0aW9uIChhLCBiLCBSIC8qaW50Ki8pIHsKCSAgICAgICAgLy8gQXNzdW1lIGEncyBkZWdyZWUgaXMgPj0gYidzCgkgICAgICAgIGlmIChhLmdldERlZ3JlZSgpIDwgYi5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgdmFyIHRlbXAgPSBhOwoJICAgICAgICAgICAgYSA9IGI7CgkgICAgICAgICAgICBiID0gdGVtcDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmllbGQgPSB0aGlzLmZpZWxkOwoJICAgICAgICB2YXIgckxhc3QgPSBhOwoJICAgICAgICB2YXIgciA9IGI7CgkgICAgICAgIHZhciB0TGFzdCA9IGZpZWxkLmdldFplcm8oKTsKCSAgICAgICAgdmFyIHQgPSBmaWVsZC5nZXRPbmUoKTsKCSAgICAgICAgLy8gUnVuIEV1Y2xpZGVhbiBhbGdvcml0aG0gdW50aWwgcidzIGRlZ3JlZSBpcyBsZXNzIHRoYW4gUi8yCgkgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IChSIC8gMiB8IDApKSB7CgkgICAgICAgICAgICB2YXIgckxhc3RMYXN0ID0gckxhc3Q7CgkgICAgICAgICAgICB2YXIgdExhc3RMYXN0ID0gdExhc3Q7CgkgICAgICAgICAgICByTGFzdCA9IHI7CgkgICAgICAgICAgICB0TGFzdCA9IHQ7CgkgICAgICAgICAgICAvLyBEaXZpZGUgckxhc3RMYXN0IGJ5IHJMYXN0LCB3aXRoIHF1b3RpZW50IGluIHEgYW5kIHJlbWFpbmRlciBpbiByCgkgICAgICAgICAgICBpZiAockxhc3QuaXNaZXJvKCkpIHsKCSAgICAgICAgICAgICAgICAvLyBPb3BzLCBFdWNsaWRlYW4gYWxnb3JpdGhtIGFscmVhZHkgdGVybWluYXRlZD8KCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUmVlZFNvbG9tb25FeGNlcHRpb25fMS5kZWZhdWx0KCdyX3tpLTF9IHdhcyB6ZXJvJyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByID0gckxhc3RMYXN0OwoJICAgICAgICAgICAgdmFyIHEgPSBmaWVsZC5nZXRaZXJvKCk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3JMZWFkaW5nVGVybSA9IHJMYXN0LmdldENvZWZmaWNpZW50KHJMYXN0LmdldERlZ3JlZSgpKTsKCSAgICAgICAgICAgIHZhciBkbHRJbnZlcnNlID0gZmllbGQuaW52ZXJzZShkZW5vbWluYXRvckxlYWRpbmdUZXJtKTsKCSAgICAgICAgICAgIHdoaWxlIChyLmdldERlZ3JlZSgpID49IHJMYXN0LmdldERlZ3JlZSgpICYmICFyLmlzWmVybygpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlZ3JlZURpZmYgPSByLmdldERlZ3JlZSgpIC0gckxhc3QuZ2V0RGVncmVlKCk7CgkgICAgICAgICAgICAgICAgdmFyIHNjYWxlID0gZmllbGQubXVsdGlwbHkoci5nZXRDb2VmZmljaWVudChyLmdldERlZ3JlZSgpKSwgZGx0SW52ZXJzZSk7CgkgICAgICAgICAgICAgICAgcSA9IHEuYWRkT3JTdWJ0cmFjdChmaWVsZC5idWlsZE1vbm9taWFsKGRlZ3JlZURpZmYsIHNjYWxlKSk7CgkgICAgICAgICAgICAgICAgciA9IHIuYWRkT3JTdWJ0cmFjdChyTGFzdC5tdWx0aXBseUJ5TW9ub21pYWwoZGVncmVlRGlmZiwgc2NhbGUpKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHQgPSBxLm11bHRpcGx5KHRMYXN0KS5hZGRPclN1YnRyYWN0KHRMYXN0TGFzdCk7CgkgICAgICAgICAgICBpZiAoci5nZXREZWdyZWUoKSA+PSByTGFzdC5nZXREZWdyZWUoKSkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb25fMS5kZWZhdWx0KCdEaXZpc2lvbiBhbGdvcml0aG0gZmFpbGVkIHRvIHJlZHVjZSBwb2x5bm9taWFsPycpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciBzaWdtYVRpbGRlQXRaZXJvID0gdC5nZXRDb2VmZmljaWVudCgwKTsKCSAgICAgICAgaWYgKHNpZ21hVGlsZGVBdFplcm8gPT09IDApIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBSZWVkU29sb21vbkV4Y2VwdGlvbl8xLmRlZmF1bHQoJ3NpZ21hVGlsZGUoMCkgd2FzIHplcm8nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgaW52ZXJzZSA9IGZpZWxkLmludmVyc2Uoc2lnbWFUaWxkZUF0WmVybyk7CgkgICAgICAgIHZhciBzaWdtYSA9IHQubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHZhciBvbWVnYSA9IHIubXVsdGlwbHlTY2FsYXIoaW52ZXJzZSk7CgkgICAgICAgIHJldHVybiBbc2lnbWEsIG9tZWdhXTsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTG9jYXRpb25zID0gZnVuY3Rpb24gKGVycm9yTG9jYXRvcikgewoJICAgICAgICAvLyBUaGlzIGlzIGEgZGlyZWN0IGFwcGxpY2F0aW9uIG9mIENoaWVuJ3Mgc2VhcmNoCgkgICAgICAgIHZhciBudW1FcnJvcnMgPSBlcnJvckxvY2F0b3IuZ2V0RGVncmVlKCk7CgkgICAgICAgIGlmIChudW1FcnJvcnMgPT09IDEpIHsgLy8gc2hvcnRjdXQKCSAgICAgICAgICAgIHJldHVybiBJbnQzMkFycmF5LmZyb20oW2Vycm9yTG9jYXRvci5nZXRDb2VmZmljaWVudCgxKV0pOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgSW50MzJBcnJheShudW1FcnJvcnMpOwoJICAgICAgICB2YXIgZSA9IDA7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgZmllbGQuZ2V0U2l6ZSgpICYmIGUgPCBudW1FcnJvcnM7IGkrKykgewoJICAgICAgICAgICAgaWYgKGVycm9yTG9jYXRvci5ldmFsdWF0ZUF0KGkpID09PSAwKSB7CgkgICAgICAgICAgICAgICAgcmVzdWx0W2VdID0gZmllbGQuaW52ZXJzZShpKTsKCSAgICAgICAgICAgICAgICBlKys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGUgIT09IG51bUVycm9ycykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IFJlZWRTb2xvbW9uRXhjZXB0aW9uXzEuZGVmYXVsdCgnRXJyb3IgbG9jYXRvciBkZWdyZWUgZG9lcyBub3QgbWF0Y2ggbnVtYmVyIG9mIHJvb3RzJyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIFJlZWRTb2xvbW9uRGVjb2Rlci5wcm90b3R5cGUuZmluZEVycm9yTWFnbml0dWRlcyA9IGZ1bmN0aW9uIChlcnJvckV2YWx1YXRvciwgZXJyb3JMb2NhdGlvbnMpIHsKCSAgICAgICAgLy8gVGhpcyBpcyBkaXJlY3RseSBhcHBseWluZyBGb3JuZXkncyBGb3JtdWxhCgkgICAgICAgIHZhciBzID0gZXJyb3JMb2NhdGlvbnMubGVuZ3RoOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEludDMyQXJyYXkocyk7CgkgICAgICAgIHZhciBmaWVsZCA9IHRoaXMuZmllbGQ7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgczsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgeGlJbnZlcnNlID0gZmllbGQuaW52ZXJzZShlcnJvckxvY2F0aW9uc1tpXSk7CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSAxOwoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaSAhPT0gaikgewoJICAgICAgICAgICAgICAgICAgICAvLyBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLAoJICAgICAgICAgICAgICAgICAgICAvLyAgICBHZW5lcmljR0YuYWRkT3JTdWJ0cmFjdCgxLCBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKSkpCgkgICAgICAgICAgICAgICAgICAgIC8vIEFib3ZlIHNob3VsZCB3b3JrIGJ1dCBmYWlscyBvbiBzb21lIEFwcGxlIGFuZCBMaW51eCBKREtzIGR1ZSB0byBhIEhvdHNwb3QgYnVnLgoJICAgICAgICAgICAgICAgICAgICAvLyBCZWxvdyBpcyBhIGZ1bm55LWxvb2tpbmcgd29ya2Fyb3VuZCBmcm9tIFN0ZXZlbiBQYXJrZXMKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm0gPSBmaWVsZC5tdWx0aXBseShlcnJvckxvY2F0aW9uc1tqXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm1QbHVzMSA9ICh0ZXJtICYgMHgxKSA9PT0gMCA/IHRlcm0gfCAxIDogdGVybSAmIH4xOwoJICAgICAgICAgICAgICAgICAgICBkZW5vbWluYXRvciA9IGZpZWxkLm11bHRpcGx5KGRlbm9taW5hdG9yLCB0ZXJtUGx1czEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KGVycm9yRXZhbHVhdG9yLmV2YWx1YXRlQXQoeGlJbnZlcnNlKSwgZmllbGQuaW52ZXJzZShkZW5vbWluYXRvcikpOwoJICAgICAgICAgICAgaWYgKGZpZWxkLmdldEdlbmVyYXRvckJhc2UoKSAhPT0gMCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IGZpZWxkLm11bHRpcGx5KHJlc3VsdFtpXSwgeGlJbnZlcnNlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgcmV0dXJuIFJlZWRTb2xvbW9uRGVjb2RlcjsKCX0oKSk7CglSZWVkU29sb21vbkRlY29kZXIkMS5kZWZhdWx0ID0gUmVlZFNvbG9tb25EZWNvZGVyOwoKCXZhciBCaXRNYXRyaXhQYXJzZXIkMSA9IHt9OwoKCXZhciBWZXJzaW9uJDEgPSB7fTsKCgl2YXIgRm9ybWF0SW5mb3JtYXRpb24kMSA9IHt9OwoKCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IHt9OwoKCXZhciBBcmd1bWVudEV4Y2VwdGlvbiQxID0ge307CgoJdmFyIF9fZXh0ZW5kcyQzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFyZ3VtZW50RXhjZXB0aW9uJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBFeGNlcHRpb25fMSA9IEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBDdXN0b20gRXJyb3IgY2xhc3Mgb2YgdHlwZSBFeGNlcHRpb24uCgkgKi8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsKCSAgICBfX2V4dGVuZHMkMyhBcmd1bWVudEV4Y2VwdGlvbiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBcmd1bWVudEV4Y2VwdGlvbigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICBBcmd1bWVudEV4Y2VwdGlvbi5raW5kID0gJ0FyZ3VtZW50RXhjZXB0aW9uJzsKCSAgICByZXR1cm4gQXJndW1lbnRFeGNlcHRpb247Cgl9KEV4Y2VwdGlvbl8xLmRlZmF1bHQpKTsKCUFyZ3VtZW50RXhjZXB0aW9uJDEuZGVmYXVsdCA9IEFyZ3VtZW50RXhjZXB0aW9uOwoKCShmdW5jdGlvbiAoZXhwb3J0cykgewoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CglleHBvcnRzLkVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gdm9pZCAwOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBBcmd1bWVudEV4Y2VwdGlvbl8xID0gQXJndW1lbnRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJdmFyIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzOwoJKGZ1bmN0aW9uIChFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcykgewoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJMIl0gPSAwXSA9ICJMIjsKCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1tFcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlc1siTSJdID0gMV0gPSAiTSI7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXNbIlEiXSA9IDJdID0gIlEiOwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzW0Vycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzWyJIIl0gPSAzXSA9ICJIIjsKCX0pKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzID0gZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyB8fCAoZXhwb3J0cy5FcnJvckNvcnJlY3Rpb25MZXZlbFZhbHVlcyA9IHt9KSk7CgkvKioKCSAqIDxwPlNlZSBJU08gMTgwMDQ6MjAwNiwgNi41LjEuIFRoaXMgZW51bSBlbmNhcHN1bGF0ZXMgdGhlIGZvdXIgZXJyb3IgY29ycmVjdGlvbiBsZXZlbHMKCSAqIGRlZmluZWQgYnkgdGhlIFFSIGNvZGUgc3RhbmRhcmQuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFcnJvckNvcnJlY3Rpb25MZXZlbCh2YWx1ZSwgc3RyaW5nVmFsdWUsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5iaXRzID0gYml0czsKCSAgICAgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2V0KGJpdHMsIHRoaXMpOwoJICAgICAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5nZXRCaXRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRzOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZnJvbVN0cmluZyA9IGZ1bmN0aW9uIChzKSB7CgkgICAgICAgIHN3aXRjaCAocykgewoJICAgICAgICAgICAgY2FzZSAnTCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5MOwoJICAgICAgICAgICAgY2FzZSAnTSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5NOwoJICAgICAgICAgICAgY2FzZSAnUSc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5ROwoJICAgICAgICAgICAgY2FzZSAnSCc6IHJldHVybiBFcnJvckNvcnJlY3Rpb25MZXZlbC5IOwoJICAgICAgICAgICAgZGVmYXVsdDogdGhyb3cgbmV3IEFyZ3VtZW50RXhjZXB0aW9uXzEuZGVmYXVsdChzICsgJ25vdCBhdmFpbGFibGUnKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIEVycm9yQ29ycmVjdGlvbkxldmVsLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAobykgewoJICAgICAgICBpZiAoIShvIGluc3RhbmNlb2YgRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG90aGVyID0gbzsKCSAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPT09IG90aGVyLnZhbHVlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgaW50IGNvbnRhaW5pbmcgdGhlIHR3byBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSdzIGVycm9yIGNvcnJlY3Rpb24gbGV2ZWwKCSAgICAgKiBAcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsIHJlcHJlc2VudGluZyB0aGUgZW5jb2RlZCBlcnJvciBjb3JyZWN0aW9uIGxldmVsCgkgICAgICovCgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuZm9yQml0cyA9IGZ1bmN0aW9uIChiaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGJpdHMgPCAwIHx8IGJpdHMgPj0gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuc2l6ZSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMuZ2V0KGJpdHMpOwoJICAgIH07CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgRXJyb3JDb3JyZWN0aW9uTGV2ZWwuRk9SX1ZBTFVFID0gbmV3IE1hcCgpOwoJICAgIC8qKiBMID0gfjclIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5MID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkwsICdMJywgMHgwMSk7CgkgICAgLyoqIE0gPSB+MTUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5NID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLk0sICdNJywgMHgwMCk7CgkgICAgLyoqIFEgPSB+MjUlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5RID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLlEsICdRJywgMHgwMyk7CgkgICAgLyoqIEggPSB+MzAlIGNvcnJlY3Rpb24gKi8KCSAgICBFcnJvckNvcnJlY3Rpb25MZXZlbC5IID0gbmV3IEVycm9yQ29ycmVjdGlvbkxldmVsKEVycm9yQ29ycmVjdGlvbkxldmVsVmFsdWVzLkgsICdIJywgMHgwMik7CgkgICAgcmV0dXJuIEVycm9yQ29ycmVjdGlvbkxldmVsOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IEVycm9yQ29ycmVjdGlvbkxldmVsOwoKCX0oRXJyb3JDb3JyZWN0aW9uTGV2ZWwpKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDYgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRm9ybWF0SW5mb3JtYXRpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBFcnJvckNvcnJlY3Rpb25MZXZlbF8xID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWw7Cgl2YXIgSW50ZWdlcl8xID0gSW50ZWdlciQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBRUiBDb2RlJ3MgZm9ybWF0IGluZm9ybWF0aW9uLCBpbmNsdWRpbmcgdGhlIGRhdGEgbWFzayB1c2VkIGFuZAoJICogZXJyb3IgY29ycmVjdGlvbiBsZXZlbC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqIEBzZWUgRGF0YU1hc2sKCSAqIEBzZWUgRXJyb3JDb3JyZWN0aW9uTGV2ZWwKCSAqLwoJdmFyIEZvcm1hdEluZm9ybWF0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZvcm1hdEluZm9ybWF0aW9uKGZvcm1hdEluZm8gLyppbnQqLykgewoJICAgICAgICAvLyBCaXRzIDMsNAoJICAgICAgICB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsID0gRXJyb3JDb3JyZWN0aW9uTGV2ZWxfMS5kZWZhdWx0LmZvckJpdHMoKGZvcm1hdEluZm8gPj4gMykgJiAweDAzKTsKCSAgICAgICAgLy8gQm90dG9tIDMgYml0cwoJICAgICAgICB0aGlzLmRhdGFNYXNrID0gLyooYnl0ZSkgKi8gKGZvcm1hdEluZm8gJiAweDA3KTsKCSAgICB9CgkgICAgRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyA9IGZ1bmN0aW9uIChhIC8qaW50Ki8sIGIgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gSW50ZWdlcl8xLmRlZmF1bHQuYml0Q291bnQoYSBeIGIpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHBhcmFtIG1hc2tlZEZvcm1hdEluZm8xIGZvcm1hdCBpbmZvIGluZGljYXRvciwgd2l0aCBtYXNrIHN0aWxsIGFwcGxpZWQKCSAgICAgKiBAcGFyYW0gbWFza2VkRm9ybWF0SW5mbzIgc2Vjb25kIGNvcHkgb2Ygc2FtZSBpbmZvOyBib3RoIGFyZSBjaGVja2VkIGF0IHRoZSBzYW1lIHRpbWUKCSAgICAgKiAgdG8gZXN0YWJsaXNoIGJlc3QgbWF0Y2gKCSAgICAgKiBAcmV0dXJuIGluZm9ybWF0aW9uIGFib3V0IHRoZSBmb3JtYXQgaXQgc3BlY2lmaWVzLCBvciB7QGNvZGUgbnVsbH0KCSAgICAgKiAgaWYgZG9lc24ndCBzZWVtIHRvIG1hdGNoIGFueSBrbm93biBwYXR0ZXJuCgkgICAgICovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24uZGVjb2RlRm9ybWF0SW5mb3JtYXRpb24gPSBmdW5jdGlvbiAobWFza2VkRm9ybWF0SW5mbzEgLyppbnQqLywgbWFza2VkRm9ybWF0SW5mbzIgLyppbnQqLykgewoJICAgICAgICB2YXIgZm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uLmRvRGVjb2RlRm9ybWF0SW5mb3JtYXRpb24obWFza2VkRm9ybWF0SW5mbzEsIG1hc2tlZEZvcm1hdEluZm8yKTsKCSAgICAgICAgaWYgKGZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiBmb3JtYXRJbmZvOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNob3VsZCByZXR1cm4gbnVsbCwgYnV0LCBzb21lIFFSIGNvZGVzIGFwcGFyZW50bHkKCSAgICAgICAgLy8gZG8gbm90IG1hc2sgdGhpcyBpbmZvLiBUcnkgYWdhaW4gYnkgYWN0dWFsbHkgbWFza2luZyB0aGUgcGF0dGVybgoJICAgICAgICAvLyBmaXJzdAoJICAgICAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb24uZG9EZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihtYXNrZWRGb3JtYXRJbmZvMSBeIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX01BU0tfUVIsIG1hc2tlZEZvcm1hdEluZm8yIF4gRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUik7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5kb0RlY29kZUZvcm1hdEluZm9ybWF0aW9uID0gZnVuY3Rpb24gKG1hc2tlZEZvcm1hdEluZm8xIC8qaW50Ki8sIG1hc2tlZEZvcm1hdEluZm8yIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGVfMSwgX2E7CgkgICAgICAgIC8vIEZpbmQgdGhlIGludCBpbiBGT1JNQVRfSU5GT19ERUNPREVfTE9PS1VQIHdpdGggZmV3ZXN0IGJpdHMgZGlmZmVyaW5nCgkgICAgICAgIHZhciBiZXN0RGlmZmVyZW5jZSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJICAgICAgICB2YXIgYmVzdEZvcm1hdEluZm8gPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyQ2KEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVApLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRlY29kZUluZm8gPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0SW5mbyA9IGRlY29kZUluZm9bMF07CgkgICAgICAgICAgICAgICAgaWYgKHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8xIHx8IHRhcmdldEluZm8gPT09IG1hc2tlZEZvcm1hdEluZm8yKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGFuIGV4YWN0IG1hdGNoCgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRm9ybWF0SW5mb3JtYXRpb24oZGVjb2RlSW5mb1sxXSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIHZhciBiaXRzRGlmZmVyZW5jZSA9IEZvcm1hdEluZm9ybWF0aW9uLm51bUJpdHNEaWZmZXJpbmcobWFza2VkRm9ybWF0SW5mbzEsIHRhcmdldEluZm8pOwoJICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgIGJlc3RGb3JtYXRJbmZvID0gZGVjb2RlSW5mb1sxXTsKCSAgICAgICAgICAgICAgICAgICAgYmVzdERpZmZlcmVuY2UgPSBiaXRzRGlmZmVyZW5jZTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKG1hc2tlZEZvcm1hdEluZm8xICE9PSBtYXNrZWRGb3JtYXRJbmZvMikgewoJICAgICAgICAgICAgICAgICAgICAvLyBhbHNvIHRyeSB0aGUgb3RoZXIgb3B0aW9uCgkgICAgICAgICAgICAgICAgICAgIGJpdHNEaWZmZXJlbmNlID0gRm9ybWF0SW5mb3JtYXRpb24ubnVtQml0c0RpZmZlcmluZyhtYXNrZWRGb3JtYXRJbmZvMiwgdGFyZ2V0SW5mbyk7CgkgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0Rm9ybWF0SW5mbyA9IGRlY29kZUluZm9bMV07CgkgICAgICAgICAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2IucmV0dXJuKSkgX2EuY2FsbChfYik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSGFtbWluZyBkaXN0YW5jZSBvZiB0aGUgMzIgbWFza2VkIGNvZGVzIGlzIDcsIGJ5IGNvbnN0cnVjdGlvbiwgc28gPD0gMyBiaXRzCgkgICAgICAgIC8vIGRpZmZlcmluZyBtZWFucyB3ZSBmb3VuZCBhIG1hdGNoCgkgICAgICAgIGlmIChiZXN0RGlmZmVyZW5jZSA8PSAzKSB7CgkgICAgICAgICAgICByZXR1cm4gbmV3IEZvcm1hdEluZm9ybWF0aW9uKGJlc3RGb3JtYXRJbmZvKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbnVsbDsKCSAgICB9OwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5nZXRFcnJvckNvcnJlY3Rpb25MZXZlbCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWw7CgkgICAgfTsKCSAgICBGb3JtYXRJbmZvcm1hdGlvbi5wcm90b3R5cGUuZ2V0RGF0YU1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFNYXNrOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICh0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsLmdldEJpdHMoKSA8PCAzKSB8IHRoaXMuZGF0YU1hc2s7CgkgICAgfTsKCSAgICAvKkBPdmVycmlkZSovCgkgICAgRm9ybWF0SW5mb3JtYXRpb24ucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBGb3JtYXRJbmZvcm1hdGlvbikpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgb3RoZXIgPSBvOwoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvckNvcnJlY3Rpb25MZXZlbCA9PT0gb3RoZXIuZXJyb3JDb3JyZWN0aW9uTGV2ZWwgJiYKCSAgICAgICAgICAgIHRoaXMuZGF0YU1hc2sgPT09IG90aGVyLmRhdGFNYXNrOwoJICAgIH07CgkgICAgRm9ybWF0SW5mb3JtYXRpb24uRk9STUFUX0lORk9fTUFTS19RUiA9IDB4NTQxMjsKCSAgICAvKioKCSAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYsIEFubmV4IEMsIFRhYmxlIEMuMQoJICAgICAqLwoJICAgIEZvcm1hdEluZm9ybWF0aW9uLkZPUk1BVF9JTkZPX0RFQ09ERV9MT09LVVAgPSBbCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1NDEyLCAweDAwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1MTI1LCAweDAxXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1RTdDLCAweDAyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg1QjRCLCAweDAzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0NUY5LCAweDA0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0MENFLCAweDA1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0Rjk3LCAweDA2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg0QUEwLCAweDA3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3N0M0LCAweDA4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3MkYzLCAweDA5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3REFBLCAweDBBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg3ODlELCAweDBCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2NjJGLCAweDBDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2MzE4LCAweDBEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2QzQxLCAweDBFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHg2OTc2LCAweDBGXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxNjg5LCAweDEwXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxM0JFLCAweDExXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxQ0U3LCAweDEyXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgxOUQwLCAweDEzXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwNzYyLCAweDE0XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwMjU1LCAweDE1XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwRDBDLCAweDE2XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgwODNCLCAweDE3XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzNTVGLCAweDE4XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzMDY4LCAweDE5XSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzRjMxLCAweDFBXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgzQTA2LCAweDFCXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyNEI0LCAweDFDXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyMTgzLCAweDFEXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyRURBLCAweDFFXSksCgkgICAgICAgIEludDMyQXJyYXkuZnJvbShbMHgyQkVELCAweDFGXSksCgkgICAgXTsKCSAgICByZXR1cm4gRm9ybWF0SW5mb3JtYXRpb247Cgl9KCkpOwoJRm9ybWF0SW5mb3JtYXRpb24kMS5kZWZhdWx0ID0gRm9ybWF0SW5mb3JtYXRpb247CgoJdmFyIEVDQmxvY2tzJDEgPSB7fTsKCgl2YXIgX192YWx1ZXMkNSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0Jsb2NrcyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHNldCBvZiBlcnJvci1jb3JyZWN0aW9uIGJsb2NrcyBpbiBvbmUgc3ltYm9sIHZlcnNpb24uIE1vc3QgdmVyc2lvbnMgd2lsbAoJICogdXNlIGJsb2NrcyBvZiBkaWZmZXJpbmcgc2l6ZXMgd2l0aGluIG9uZSB2ZXJzaW9uLCBzbywgdGhpcyBlbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yCgkgKiBlYWNoIHNldCBvZiBibG9ja3MuIEl0IGFsc28gaG9sZHMgdGhlIG51bWJlciBvZiBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyBwZXIgYmxvY2sgc2luY2UgaXQKCSAqIHdpbGwgYmUgdGhlIHNhbWUgYWNyb3NzIGFsbCBibG9ja3Mgd2l0aGluIG9uZSB2ZXJzaW9uLjwvcD4KCSAqLwoJdmFyIEVDQmxvY2tzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEVDQmxvY2tzKGVjQ29kZXdvcmRzUGVyQmxvY2sgLyppbnQqLykgewoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayA9IGVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgICAgIHRoaXMuZWNCbG9ja3MgPSBlY0Jsb2NrczsKCSAgICB9CgkgICAgRUNCbG9ja3MucHJvdG90eXBlLmdldEVDQ29kZXdvcmRzUGVyQmxvY2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQ29kZXdvcmRzUGVyQmxvY2s7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0TnVtQmxvY2tzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIHRvdGFsID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tzID0gdGhpcy5lY0Jsb2NrczsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIGVjQmxvY2tzXzEgPSBfX3ZhbHVlcyQ1KGVjQmxvY2tzKSwgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCk7ICFlY0Jsb2Nrc18xXzEuZG9uZTsgZWNCbG9ja3NfMV8xID0gZWNCbG9ja3NfMS5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tzXzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbCArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2Nrc18xXzEgJiYgIWVjQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGVjQmxvY2tzXzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2Nrc18xKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdG90YWw7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0VG90YWxFQ0NvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZWNDb2Rld29yZHNQZXJCbG9jayAqIHRoaXMuZ2V0TnVtQmxvY2tzKCk7CgkgICAgfTsKCSAgICBFQ0Jsb2Nrcy5wcm90b3R5cGUuZ2V0RUNCbG9ja3MgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmVjQmxvY2tzOwoJICAgIH07CgkgICAgcmV0dXJuIEVDQmxvY2tzOwoJfSgpKTsKCUVDQmxvY2tzJDEuZGVmYXVsdCA9IEVDQmxvY2tzOwoKCXZhciBFQ0IkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShFQ0IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgdGhlIHBhcmFtZXRlcnMgZm9yIG9uZSBlcnJvci1jb3JyZWN0aW9uIGJsb2NrIGluIG9uZSBzeW1ib2wgdmVyc2lvbi4KCSAqIFRoaXMgaW5jbHVkZXMgdGhlIG51bWJlciBvZiBkYXRhIGNvZGV3b3JkcywgYW5kIHRoZSBudW1iZXIgb2YgdGltZXMgYSBibG9jayB3aXRoIHRoZXNlCgkgKiBwYXJhbWV0ZXJzIGlzIHVzZWQgY29uc2VjdXRpdmVseSBpbiB0aGUgUVIgY29kZSB2ZXJzaW9uJ3MgZm9ybWF0LjwvcD4KCSAqLwoJdmFyIEVDQiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBFQ0IoY291bnQgLyppbnQqLywgZGF0YUNvZGV3b3JkcyAvKmludCovKSB7CgkgICAgICAgIHRoaXMuY291bnQgPSBjb3VudDsKCSAgICAgICAgdGhpcy5kYXRhQ29kZXdvcmRzID0gZGF0YUNvZGV3b3JkczsKCSAgICB9CgkgICAgRUNCLnByb3RvdHlwZS5nZXRDb3VudCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY291bnQ7CgkgICAgfTsKCSAgICBFQ0IucHJvdG90eXBlLmdldERhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICByZXR1cm4gRUNCOwoJfSgpKTsKCUVDQiQxLmRlZmF1bHQgPSBFQ0I7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX3ZhbHVlcyQ0ID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGVjb2RlciB7Ki8KCXZhciBCaXRNYXRyaXhfMSQzID0gQml0TWF0cml4JDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSQxID0gRm9ybWF0SW5mb3JtYXRpb24kMTsKCXZhciBFQ0Jsb2Nrc18xID0gRUNCbG9ja3MkMTsKCXZhciBFQ0JfMSA9IEVDQiQxOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDIgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQyID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIFNlZSBJU08gMTgwMDQ6MjAwNiBBbm5leCBECgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFZlcnNpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gVmVyc2lvbih2ZXJzaW9uTnVtYmVyIC8qaW50Ki8sIGFsaWdubWVudFBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgZWNCbG9ja3MgPSBbXTsKCSAgICAgICAgZm9yICh2YXIgX2kgPSAyOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKCSAgICAgICAgICAgIGVjQmxvY2tzW19pIC0gMl0gPSBhcmd1bWVudHNbX2ldOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMudmVyc2lvbk51bWJlciA9IHZlcnNpb25OdW1iZXI7CgkgICAgICAgIHRoaXMuYWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBhbGlnbm1lbnRQYXR0ZXJuQ2VudGVyczsKCSAgICAgICAgdGhpcy5lY0Jsb2NrcyA9IGVjQmxvY2tzOwoJICAgICAgICB2YXIgdG90YWwgPSAwOwoJICAgICAgICB2YXIgZWNDb2Rld29yZHMgPSBlY0Jsb2Nrc1swXS5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIHZhciBlY2JBcnJheSA9IGVjQmxvY2tzWzBdLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY2JBcnJheV8xID0gX192YWx1ZXMkNChlY2JBcnJheSksIGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpOyAhZWNiQXJyYXlfMV8xLmRvbmU7IGVjYkFycmF5XzFfMSA9IGVjYkFycmF5XzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGVjQmxvY2sgPSBlY2JBcnJheV8xXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdG90YWwgKz0gZWNCbG9jay5nZXRDb3VudCgpICogKGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpICsgZWNDb2Rld29yZHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzFfMSkgeyBlXzEgPSB7IGVycm9yOiBlXzFfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoZWNiQXJyYXlfMV8xICYmICFlY2JBcnJheV8xXzEuZG9uZSAmJiAoX2EgPSBlY2JBcnJheV8xLnJldHVybikpIF9hLmNhbGwoZWNiQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdGhpcy50b3RhbENvZGV3b3JkcyA9IHRvdGFsOwoJICAgIH0KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5nZXRWZXJzaW9uTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0VG90YWxDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnRvdGFsQ29kZXdvcmRzOwoJICAgIH07CgkgICAgVmVyc2lvbi5wcm90b3R5cGUuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDE3ICsgNCAqIHRoaXMudmVyc2lvbk51bWJlcjsKCSAgICB9OwoJICAgIFZlcnNpb24ucHJvdG90eXBlLmdldEVDQmxvY2tzRm9yTGV2ZWwgPSBmdW5jdGlvbiAoZWNMZXZlbCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0Jsb2Nrc1tlY0xldmVsLmdldFZhbHVlKCldOwoJICAgICAgICAvLyBUWVBFU0NSSVBUUE9SVDogb3JpZ2luYWwgd2FzIHVzaW5nIG9yZGluYWwsIGFuZCB1c2luZyB0aGUgb3JkZXIgb2YgbGV2ZWxzIGFzIGRlZmluZWQgaW4gRXJyb3JDb3JyZWN0aW9uTGV2ZWwgZW51bSAoTE1RSCkKCSAgICAgICAgLy8gSSB3aWxsIHVzZSB0aGUgZGlyZWN0IHZhbHVlIGZyb20gRXJyb3JDb3JyZWN0aW9uTGV2ZWxWYWx1ZXMgZW51bSB3aGljaCBpbiB0eXBlc2NyaXB0IGdvZXMgdG8gYSBudW1iZXIKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkRlZHVjZXMgdmVyc2lvbiBpbmZvcm1hdGlvbiBwdXJlbHkgZnJvbSBRUiBDb2RlIGRpbWVuc2lvbnMuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gaW4gbW9kdWxlcwoJICAgICAqIEByZXR1cm4gVmVyc2lvbiBmb3IgYSBRUiBDb2RlIG9mIHRoYXQgZGltZW5zaW9uCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCAxIG1vZCA0CgkgICAgICovCgkgICAgVmVyc2lvbi5nZXRQcm92aXNpb25hbFZlcnNpb25Gb3JEaW1lbnNpb24gPSBmdW5jdGlvbiAoZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiAlIDQgIT09IDEpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMSQyLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmVyc2lvbkZvck51bWJlcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlciA9IGZ1bmN0aW9uICh2ZXJzaW9uTnVtYmVyIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPCAxIHx8IHZlcnNpb25OdW1iZXIgPiA0MCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDIuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBWZXJzaW9uLlZFUlNJT05TW3ZlcnNpb25OdW1iZXIgLSAxXTsKCSAgICB9OwoJICAgIFZlcnNpb24uZGVjb2RlVmVyc2lvbkluZm9ybWF0aW9uID0gZnVuY3Rpb24gKHZlcnNpb25CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGJlc3REaWZmZXJlbmNlID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHZhciBiZXN0VmVyc2lvbiA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgVmVyc2lvbi5WRVJTSU9OX0RFQ09ERV9JTkZPLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgdGFyZ2V0VmVyc2lvbiA9IFZlcnNpb24uVkVSU0lPTl9ERUNPREVfSU5GT1tpXTsKCSAgICAgICAgICAgIC8vIERvIHRoZSB2ZXJzaW9uIGluZm8gYml0cyBtYXRjaCBleGFjdGx5PyBkb25lLgoJICAgICAgICAgICAgaWYgKHRhcmdldFZlcnNpb24gPT09IHZlcnNpb25CaXRzKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIFZlcnNpb24uZ2V0VmVyc2lvbkZvck51bWJlcihpICsgNyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2VlIGlmIHRoaXMgaXMgdGhlIGNsb3Nlc3QgdG8gYSByZWFsIHZlcnNpb24gaW5mbyBiaXQgc3RyaW5nCgkgICAgICAgICAgICAvLyB3ZSBoYXZlIHNlZW4gc28gZmFyCgkgICAgICAgICAgICB2YXIgYml0c0RpZmZlcmVuY2UgPSBGb3JtYXRJbmZvcm1hdGlvbl8xJDEuZGVmYXVsdC5udW1CaXRzRGlmZmVyaW5nKHZlcnNpb25CaXRzLCB0YXJnZXRWZXJzaW9uKTsKCSAgICAgICAgICAgIGlmIChiaXRzRGlmZmVyZW5jZSA8IGJlc3REaWZmZXJlbmNlKSB7CgkgICAgICAgICAgICAgICAgYmVzdFZlcnNpb24gPSBpICsgNzsKCSAgICAgICAgICAgICAgICBiZXN0RGlmZmVyZW5jZSA9IGJpdHNEaWZmZXJlbmNlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFdlIGNhbiB0b2xlcmF0ZSB1cCB0byAzIGJpdHMgb2YgZXJyb3Igc2luY2Ugbm8gdHdvIHZlcnNpb24gaW5mbyBjb2Rld29yZHMgd2lsbAoJICAgICAgICAvLyBkaWZmZXIgaW4gbGVzcyB0aGFuIDggYml0cy4KCSAgICAgICAgaWYgKGJlc3REaWZmZXJlbmNlIDw9IDMpIHsKCSAgICAgICAgICAgIHJldHVybiBWZXJzaW9uLmdldFZlcnNpb25Gb3JOdW1iZXIoYmVzdFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGRpZG4ndCBmaW5kIGEgY2xvc2UgZW5vdWdoIG1hdGNoLCBmYWlsCgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIElTTyAxODAwNDoyMDA2IEFubmV4IEUKCSAgICAgKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS5idWlsZEZ1bmN0aW9uUGF0dGVybiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpOwoJICAgICAgICB2YXIgYml0TWF0cml4ID0gbmV3IEJpdE1hdHJpeF8xJDMuZGVmYXVsdChkaW1lbnNpb24pOwoJICAgICAgICAvLyBUb3AgbGVmdCBmaW5kZXIgcGF0dGVybiArIHNlcGFyYXRvciArIGZvcm1hdAoJICAgICAgICBiaXRNYXRyaXguc2V0UmVnaW9uKDAsIDAsIDksIDkpOwoJICAgICAgICAvLyBUb3AgcmlnaHQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbihkaW1lbnNpb24gLSA4LCAwLCA4LCA5KTsKCSAgICAgICAgLy8gQm90dG9tIGxlZnQgZmluZGVyIHBhdHRlcm4gKyBzZXBhcmF0b3IgKyBmb3JtYXQKCSAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSA4LCA5LCA4KTsKCSAgICAgICAgLy8gQWxpZ25tZW50IHBhdHRlcm5zCgkgICAgICAgIHZhciBtYXggPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHgrKykgewoJICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmFsaWdubWVudFBhdHRlcm5DZW50ZXJzW3hdIC0gMjsKCSAgICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbWF4OyB5KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoKHggPT09IDAgJiYgKHkgPT09IDAgfHwgeSA9PT0gbWF4IC0gMSkpIHx8ICh4ID09PSBtYXggLSAxICYmIHkgPT09IDApKSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE5vIGFsaWdubWVudCBwYXR0ZXJucyBuZWFyIHRoZSB0aHJlZSBmaW5kZXIgcGF0dGVybnMKCSAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24odGhpcy5hbGlnbm1lbnRQYXR0ZXJuQ2VudGVyc1t5XSAtIDIsIGksIDUsIDUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIFZlcnRpY2FsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oNiwgOSwgMSwgZGltZW5zaW9uIC0gMTcpOwoJICAgICAgICAvLyBIb3Jpem9udGFsIHRpbWluZyBwYXR0ZXJuCgkgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oOSwgNiwgZGltZW5zaW9uIC0gMTcsIDEpOwoJICAgICAgICBpZiAodGhpcy52ZXJzaW9uTnVtYmVyID4gNikgewoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCB0b3AgcmlnaHQKCSAgICAgICAgICAgIGJpdE1hdHJpeC5zZXRSZWdpb24oZGltZW5zaW9uIC0gMTEsIDAsIDMsIDYpOwoJICAgICAgICAgICAgLy8gVmVyc2lvbiBpbmZvLCBib3R0b20gbGVmdAoJICAgICAgICAgICAgYml0TWF0cml4LnNldFJlZ2lvbigwLCBkaW1lbnNpb24gLSAxMSwgNiwgMyk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdE1hdHJpeDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBWZXJzaW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuICcnICsgdGhpcy52ZXJzaW9uTnVtYmVyOwoJICAgIH07CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgQW5uZXggRC4KCSAgICAgICAqIEVsZW1lbnQgaSByZXByZXNlbnRzIHRoZSByYXcgdmVyc2lvbiBiaXRzIHRoYXQgc3BlY2lmeSB2ZXJzaW9uIGkgKyA3CgkgICAgICAgKi8KCSAgICBWZXJzaW9uLlZFUlNJT05fREVDT0RFX0lORk8gPSBJbnQzMkFycmF5LmZyb20oWwoJICAgICAgICAweDA3Qzk0LCAweDA4NUJDLCAweDA5QTk5LCAweDBBNEQzLCAweDBCQkY2LAoJICAgICAgICAweDBDNzYyLCAweDBEODQ3LCAweDBFNjBELCAweDBGOTI4LCAweDEwQjc4LAoJICAgICAgICAweDExNDVELCAweDEyQTE3LCAweDEzNTMyLCAweDE0OUE2LCAweDE1NjgzLAoJICAgICAgICAweDE2OEM5LCAweDE3N0VDLCAweDE4RUM0LCAweDE5MUUxLCAweDFBRkFCLAoJICAgICAgICAweDFCMDhFLCAweDFDQzFBLCAweDFEMzNGLCAweDFFRDc1LCAweDFGMjUwLAoJICAgICAgICAweDIwOUQ1LCAweDIxNkYwLCAweDIyOEJBLCAweDIzNzlGLCAweDI0QjBCLAoJICAgICAgICAweDI1NDJFLCAweDI2QTY0LCAweDI3NTQxLCAweDI4QzY5CgkgICAgXSk7CgkgICAgLyoqCgkgICAgICAgKiBTZWUgSVNPIDE4MDA0OjIwMDYgNi41LjEgVGFibGUgOQoJICAgICAgICovCgkgICAgVmVyc2lvbi5WRVJTSU9OUyA9IFsKCSAgICAgICAgbmV3IFZlcnNpb24oMSwgbmV3IEludDMyQXJyYXkoMCksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxMywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNywgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOSkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMiwgSW50MzJBcnJheS5mcm9tKFs2LCAxOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDEwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMywgSW50MzJBcnJheS5mcm9tKFs2LCAyMl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE1LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1NSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA4MCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyNCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA5KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCA0MykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDE4LCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTIpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDYsIEludDMyQXJyYXkuZnJvbShbNiwgMzRdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgxNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDcsIEludDMyQXJyYXkuZnJvbShbNiwgMjIsIDM4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDc4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDMxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxNCkpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNCwgNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMzgpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzOSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxOCksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE5KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDksIEludDMyQXJyYXkuZnJvbShbNiwgMjYsIDQ2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIyLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAzNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDM3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTAsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDUwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMTgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDY4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgNjkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDMpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA0NCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxOSksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDIwKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDExLCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDIwLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA4MSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCA1MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDUxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTIpLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMykpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTIsIEludDMyQXJyYXkuZnJvbShbNiwgMzIsIDU4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDkyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgOTMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMzYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAzNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDE0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDEzLCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2Ml0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyMiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMzcpLCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAzOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAyMCksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDEyLCAxMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDYsIDY2XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCg0LCA0MCksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDQxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDE3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNSwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNDgsIDcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjIsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDg3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgODgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgNDEpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigxNiwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjQsIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDk4KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgOTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0NikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI0LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTkpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAyMCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMTcsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU0LCA3OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxLCAxMDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE4LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NiwgODJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIwKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTIxKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDQzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMiwgMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxOSwgMTUpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDE5LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1OCwgODZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTE0KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDQ0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDQ1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDE3LCAyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjYsIG5ldyBFQ0JfMS5kZWZhdWx0KDksIDEzKSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDE0KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMCwgSW50MzJBcnJheS5mcm9tKFs2LCAzNCwgNjIsIDkwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDEwNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDUsIDEwOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgzLCA0MSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCA0MikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIxLCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1MCwgNzIsIDk0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExNykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI2LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDIpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDIyLCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1MCwgNzQsIDk4XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDExMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDExMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNCwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDEzKSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyMywgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIxKSwgbmV3IEVDQl8xLmRlZmF1bHQoNSwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI0LCBJbnQzMkFycmF5LmZyb20oWzYsIDI4LCA1NCwgODAsIDEwNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTcpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTYsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMwLCAxNiksIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDE3KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyNSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyNiwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMTA2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTA3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEzLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMjYsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0XSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxMTUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNiwgMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzMsIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDI3LCBJbnQzMkFycmF5LmZyb20oWzYsIDM0LCA2MiwgOTAsIDExOF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg4LCAxMjIpLCBuZXcgRUNCXzEuZGVmYXVsdCg0LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjIsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoOCwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjgsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTAsIDc0LCA5OCwgMTIyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDMsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAxMTgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMywgNDUpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTEsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigyOSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTQsIDc4LCAxMDIsIDEyNl0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTYpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCAxMTcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMjEsIDQ1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgNDYpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMjMpLCBuZXcgRUNCXzEuZGVmYXVsdCgzNywgMjQpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMCwgSW50MzJBcnJheS5mcm9tKFs2LCAyNiwgNTIsIDc4LCAxMDQsIDEzMF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg1LCAxMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCA0NyksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNSwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjMsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjUsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzMSwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTYsIDgyLCAxMDgsIDEzNF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxMywgMTE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoMywgMTE2KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDIsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQyLCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIzLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDI4LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzIsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYwLCA4NiwgMTEyLCAxMzhdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzUsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDM1LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzMsIEludDMyQXJyYXkuZnJvbShbNiwgMzAsIDU4LCA4NiwgMTE0LCAxNDJdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTcsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDEsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMSwgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTksIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDExLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzQsIEludDMyQXJyYXkuZnJvbShbNiwgMzQsIDYyLCA5MCwgMTE4LCAxNDZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDExNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDExNikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgNDYpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMywgNDcpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNDQsIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoNywgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoNTksIDE2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMSwgMTcpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM1LCBJbnQzMkFycmF5LmZyb20oWzYsIDMwLCA1NCwgNzgsIDEwMiwgMTI2LCAxNTBdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTIsIDEyMSksIG5ldyBFQ0JfMS5kZWZhdWx0KDcsIDEyMikpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCgxMiwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCgyNiwgNDgpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMzksIDI0KSwgbmV3IEVDQl8xLmRlZmF1bHQoMTQsIDI1KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDIyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDQxLCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzYsIEludDMyQXJyYXkuZnJvbShbNiwgMjQsIDUwLCA3NiwgMTAyLCAxMjgsIDE1NF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMjEpLCBuZXcgRUNCXzEuZGVmYXVsdCgxNCwgMTIyKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDYsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzQsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ2LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDEwLCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyLCAxNSksIG5ldyBFQ0JfMS5kZWZhdWx0KDY0LCAxNikpKSwKCSAgICAgICAgbmV3IFZlcnNpb24oMzcsIEludDMyQXJyYXkuZnJvbShbNiwgMjgsIDU0LCA4MCwgMTA2LCAxMzIsIDE1OF0pLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgxNywgMTIyKSwgbmV3IEVDQl8xLmRlZmF1bHQoNCwgMTIzKSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMjgsIG5ldyBFQ0JfMS5kZWZhdWx0KDI5LCA0NiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCA0NykpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0OSwgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgxMCwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjQsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNDYsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbigzOCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMiwgNTgsIDg0LCAxMTAsIDEzNiwgMTYyXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDEyMiksIG5ldyBFQ0JfMS5kZWZhdWx0KDE4LCAxMjMpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTMsIDQ2KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzIsIDQ3KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDQ4LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDE0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MiwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCgzMiwgMTYpKSksCgkgICAgICAgIG5ldyBWZXJzaW9uKDM5LCBJbnQzMkFycmF5LmZyb20oWzYsIDI2LCA1NCwgODIsIDExMCwgMTM4LCAxNjZdKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMjAsIDExNyksIG5ldyBFQ0JfMS5kZWZhdWx0KDQsIDExOCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDI4LCBuZXcgRUNCXzEuZGVmYXVsdCg0MCwgNDcpLCBuZXcgRUNCXzEuZGVmYXVsdCg3LCA0OCkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCg0MywgMjQpLCBuZXcgRUNCXzEuZGVmYXVsdCgyMiwgMjUpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgzMCwgbmV3IEVDQl8xLmRlZmF1bHQoMTAsIDE1KSwgbmV3IEVDQl8xLmRlZmF1bHQoNjcsIDE2KSkpLAoJICAgICAgICBuZXcgVmVyc2lvbig0MCwgSW50MzJBcnJheS5mcm9tKFs2LCAzMCwgNTgsIDg2LCAxMTQsIDE0MiwgMTcwXSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDE5LCAxMTgpLCBuZXcgRUNCXzEuZGVmYXVsdCg2LCAxMTkpKSwgbmV3IEVDQmxvY2tzXzEuZGVmYXVsdCgyOCwgbmV3IEVDQl8xLmRlZmF1bHQoMTgsIDQ3KSwgbmV3IEVDQl8xLmRlZmF1bHQoMzEsIDQ4KSksIG5ldyBFQ0Jsb2Nrc18xLmRlZmF1bHQoMzAsIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNCksIG5ldyBFQ0JfMS5kZWZhdWx0KDM0LCAyNSkpLCBuZXcgRUNCbG9ja3NfMS5kZWZhdWx0KDMwLCBuZXcgRUNCXzEuZGVmYXVsdCgyMCwgMTUpLCBuZXcgRUNCXzEuZGVmYXVsdCg2MSwgMTYpKSkKCSAgICBdOwoJICAgIHJldHVybiBWZXJzaW9uOwoJfSgpKTsKCVZlcnNpb24kMS5kZWZhdWx0ID0gVmVyc2lvbjsKCgl2YXIgRGF0YU1hc2sgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5EYXRhTWFza1ZhbHVlcyA9IHZvaWQgMDsKCXZhciBEYXRhTWFza1ZhbHVlczsKCShmdW5jdGlvbiAoRGF0YU1hc2tWYWx1ZXMpIHsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAwMCJdID0gMF0gPSAiREFUQV9NQVNLXzAwMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18wMDEiXSA9IDFdID0gIkRBVEFfTUFTS18wMDEiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMDEwIl0gPSAyXSA9ICJEQVRBX01BU0tfMDEwIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzAxMSJdID0gM10gPSAiREFUQV9NQVNLXzAxMSI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMDAiXSA9IDRdID0gIkRBVEFfTUFTS18xMDAiOwoJICAgIERhdGFNYXNrVmFsdWVzW0RhdGFNYXNrVmFsdWVzWyJEQVRBX01BU0tfMTAxIl0gPSA1XSA9ICJEQVRBX01BU0tfMTAxIjsKCSAgICBEYXRhTWFza1ZhbHVlc1tEYXRhTWFza1ZhbHVlc1siREFUQV9NQVNLXzExMCJdID0gNl0gPSAiREFUQV9NQVNLXzExMCI7CgkgICAgRGF0YU1hc2tWYWx1ZXNbRGF0YU1hc2tWYWx1ZXNbIkRBVEFfTUFTS18xMTEiXSA9IDddID0gIkRBVEFfTUFTS18xMTEiOwoJfSkoRGF0YU1hc2tWYWx1ZXMgPSBleHBvcnRzLkRhdGFNYXNrVmFsdWVzIHx8IChleHBvcnRzLkRhdGFNYXNrVmFsdWVzID0ge30pKTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGRhdGEgbWFza3MgZm9yIHRoZSBkYXRhIGJpdHMgaW4gYSBRUiBjb2RlLCBwZXIgSVNPIDE4MDA0OjIwMDYgNi44LiBJbXBsZW1lbnRhdGlvbnMKCSAqIG9mIHRoaXMgY2xhc3MgY2FuIHVuLW1hc2sgYSByYXcgQml0TWF0cml4LiBGb3Igc2ltcGxpY2l0eSwgdGhleSB3aWxsIHVubWFzayB0aGUgZW50aXJlIEJpdE1hdHJpeCwKCSAqIGluY2x1ZGluZyBhcmVhcyB1c2VkIGZvciBmaW5kZXIgcGF0dGVybnMsIHRpbWluZyBwYXR0ZXJucywgZXRjLiBUaGVzZSBhcmVhcyBzaG91bGQgYmUgdW51c2VkCgkgKiBhZnRlciB0aGUgcG9pbnQgdGhleSBhcmUgdW5tYXNrZWQgYW55d2F5LjwvcD4KCSAqCgkgKiA8cD5Ob3RlIHRoYXQgdGhlIGRpYWdyYW0gaW4gc2VjdGlvbiA2LjguMSBpcyBtaXNsZWFkaW5nIHNpbmNlIGl0IGluZGljYXRlcyB0aGF0IGkgaXMgY29sdW1uIHBvc2l0aW9uCgkgKiBhbmQgaiBpcyByb3cgcG9zaXRpb24uIEluIGZhY3QsIGFzIHRoZSB0ZXh0IHNheXMsIGkgaXMgcm93IHBvc2l0aW9uIGFuZCBqIGlzIGNvbHVtbiBwb3NpdGlvbi48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFNYXNrID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8vIFNlZSBJU08gMTgwMDQ6MjAwNiA2LjguMQoJICAgIGZ1bmN0aW9uIERhdGFNYXNrKHZhbHVlLCBpc01hc2tlZCkgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuaXNNYXNrZWQgPSBpc01hc2tlZDsKCSAgICB9CgkgICAgLy8gRW5kIG9mIGVudW0gY29uc3RhbnRzLgoJICAgIC8qKgoJICAgICAqIDxwPkltcGxlbWVudGF0aW9ucyBvZiB0aGlzIG1ldGhvZCByZXZlcnNlIHRoZSBkYXRhIG1hc2tpbmcgcHJvY2VzcyBhcHBsaWVkIHRvIGEgUVIgQ29kZSBhbmQKCSAgICAgKiBtYWtlIGl0cyBiaXRzIHJlYWR5IHRvIHJlYWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGJpdHMgcmVwcmVzZW50YXRpb24gb2YgUVIgQ29kZSBiaXRzCgkgICAgICogQHBhcmFtIGRpbWVuc2lvbiBkaW1lbnNpb24gb2YgUVIgQ29kZSwgcmVwcmVzZW50ZWQgYnkgYml0cywgYmVpbmcgdW5tYXNrZWQKCSAgICAgKi8KCSAgICBEYXRhTWFzay5wcm90b3R5cGUudW5tYXNrQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGRpbWVuc2lvbiAvKmludCovKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGltZW5zaW9uOyBqKyspIHsKCSAgICAgICAgICAgICAgICBpZiAodGhpcy5pc01hc2tlZChpLCBqKSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLmZsaXAoaiwgaSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICBEYXRhTWFzay52YWx1ZXMgPSBuZXcgTWFwKFsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDAwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeCArIHkpIG1vZCAyID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDAwLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMCwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoKGkgKyBqKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeCBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAwMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMDEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgJiAweDAxKSA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMDEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoIHkgbW9kIDMgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMDEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuIGogJSAzID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAwMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKHggKyB5KSBtb2QgMyA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzAxMSwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18wMTEsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKGkgKyBqKSAlIDMgPT09IDA7IH0pXSwKCSAgICAgICAgLyoqCgkgICAgICAgICAqIDEwMDogbWFzayBiaXRzIGZvciB3aGljaCAoeC8yICsgeS8zKSBtb2QgMiA9PSAwCgkgICAgICAgICAqLwoJICAgICAgICBbRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMCwgbmV3IERhdGFNYXNrKERhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMDAsIGZ1bmN0aW9uIChpIC8qaW50Ki8sIGogLyppbnQqLykgeyByZXR1cm4gKChNYXRoLmZsb29yKGkgLyAyKSArIE1hdGguZmxvb3IoaiAvIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMDE6IG1hc2sgYml0cyBmb3Igd2hpY2ggeHkgbW9kIDIgKyB4eSBtb2QgMyA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2ID09IDAKCSAgICAgICAgICovCgkgICAgICAgIFtEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTAxLCBuZXcgRGF0YU1hc2soRGF0YU1hc2tWYWx1ZXMuREFUQV9NQVNLXzEwMSwgZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovKSB7IHJldHVybiAoaSAqIGopICUgNiA9PT0gMDsgfSldLAoJICAgICAgICAvKioKCSAgICAgICAgICogMTEwOiBtYXNrIGJpdHMgZm9yIHdoaWNoICh4eSBtb2QgMiArIHh5IG1vZCAzKSBtb2QgMiA9PSAwCgkgICAgICAgICAqIGVxdWl2YWxlbnRseSwgc3VjaCB0aGF0IHh5IG1vZCA2IDwgMwoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTAsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTEwLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSAqIGopICUgNikgPCAzOyB9KV0sCgkgICAgICAgIC8qKgoJICAgICAgICAgKiAxMTE6IG1hc2sgYml0cyBmb3Igd2hpY2ggKCh4K3kpbW9kIDIgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKiBlcXVpdmFsZW50bHksIHN1Y2ggdGhhdCAoeCArIHkgKyB4eSBtb2QgMykgbW9kIDIgPT0gMAoJICAgICAgICAgKi8KCSAgICAgICAgW0RhdGFNYXNrVmFsdWVzLkRBVEFfTUFTS18xMTEsIG5ldyBEYXRhTWFzayhEYXRhTWFza1ZhbHVlcy5EQVRBX01BU0tfMTExLCBmdW5jdGlvbiAoaSAvKmludCovLCBqIC8qaW50Ki8pIHsgcmV0dXJuICgoaSArIGogKyAoKGkgKiBqKSAlIDMpKSAmIDB4MDEpID09PSAwOyB9KV0sCgkgICAgXSk7CgkgICAgcmV0dXJuIERhdGFNYXNrOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IERhdGFNYXNrOwoKCX0oRGF0YU1hc2spKTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdE1hdHJpeFBhcnNlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7Cgl2YXIgVmVyc2lvbl8xJDEgPSBWZXJzaW9uJDE7Cgl2YXIgRm9ybWF0SW5mb3JtYXRpb25fMSA9IEZvcm1hdEluZm9ybWF0aW9uJDE7Cgl2YXIgRGF0YU1hc2tfMSA9IERhdGFNYXNrOwoJdmFyIEZvcm1hdEV4Y2VwdGlvbl8xJDEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCS8qKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEJpdE1hdHJpeFBhcnNlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYml0TWF0cml4IHtAbGluayBCaXRNYXRyaXh9IHRvIHBhcnNlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgZGltZW5zaW9uIGlzIG5vdCA+PSAyMSBhbmQgMSBtb2QgNAoJICAgICAqLwoJICAgIGZ1bmN0aW9uIEJpdE1hdHJpeFBhcnNlcihiaXRNYXRyaXgpIHsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IGJpdE1hdHJpeC5nZXRIZWlnaHQoKTsKCSAgICAgICAgaWYgKGRpbWVuc2lvbiA8IDIxIHx8IChkaW1lbnNpb24gJiAweDAzKSAhPT0gMSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0TWF0cml4ID0gYml0TWF0cml4OwoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5SZWFkcyBmb3JtYXQgaW5mb3JtYXRpb24gZnJvbSBvbmUgb2YgaXRzIHR3byBsb2NhdGlvbnMgd2l0aGluIHRoZSBRUiBDb2RlLjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEZvcm1hdEluZm9ybWF0aW9ufSBlbmNhcHN1bGF0aW5nIHRoZSBRUiBDb2RlJ3MgZm9ybWF0IGluZm8KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIGZvcm1hdCBpbmZvcm1hdGlvbiBsb2NhdGlvbnMgY2Fubm90IGJlIHBhcnNlZCBhcwoJICAgICAqIHRoZSB2YWxpZCBlbmNvZGluZyBvZiBmb3JtYXQgaW5mb3JtYXRpb24KCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRGb3JtYXRJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgaWYgKHRoaXMucGFyc2VkRm9ybWF0SW5mbyAhPT0gbnVsbCAmJiB0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VkRm9ybWF0SW5mbzsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRvcC1sZWZ0IGZvcm1hdCBpbmZvIGJpdHMKCSAgICAgICAgdmFyIGZvcm1hdEluZm9CaXRzMSA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNjsgaSsrKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoaSwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyAuLiBhbmQgc2tpcCBhIGJpdCBpbiB0aGUgdGltaW5nIHBhdHRlcm4gLi4uCgkgICAgICAgIGZvcm1hdEluZm9CaXRzMSA9IHRoaXMuY29weUJpdCg3LCA4LCBmb3JtYXRJbmZvQml0czEpOwoJICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgOCwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgZm9ybWF0SW5mb0JpdHMxID0gdGhpcy5jb3B5Qml0KDgsIDcsIGZvcm1hdEluZm9CaXRzMSk7CgkgICAgICAgIC8vIC4uIGFuZCBza2lwIGEgYml0IGluIHRoZSB0aW1pbmcgcGF0dGVybiAuLi4KCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3JtYXRJbmZvQml0czEgPSB0aGlzLmNvcHlCaXQoOCwgaiwgZm9ybWF0SW5mb0JpdHMxKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBSZWFkIHRoZSB0b3AtcmlnaHQvYm90dG9tLWxlZnQgcGF0dGVybiB0b28KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgZm9ybWF0SW5mb0JpdHMyID0gMDsKCSAgICAgICAgdmFyIGpNaW4gPSBkaW1lbnNpb24gLSA3OwoJICAgICAgICBmb3IgKHZhciBqID0gZGltZW5zaW9uIC0gMTsgaiA+PSBqTWluOyBqLS0pIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdCg4LCBqLCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIGZvciAodmFyIGkgPSBkaW1lbnNpb24gLSA4OyBpIDwgZGltZW5zaW9uOyBpKyspIHsKCSAgICAgICAgICAgIGZvcm1hdEluZm9CaXRzMiA9IHRoaXMuY29weUJpdChpLCA4LCBmb3JtYXRJbmZvQml0czIpOwoJICAgICAgICB9CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IEZvcm1hdEluZm9ybWF0aW9uXzEuZGVmYXVsdC5kZWNvZGVGb3JtYXRJbmZvcm1hdGlvbihmb3JtYXRJbmZvQml0czEsIGZvcm1hdEluZm9CaXRzMik7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZEZvcm1hdEluZm87CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+UmVhZHMgdmVyc2lvbiBpbmZvcm1hdGlvbiBmcm9tIG9uZSBvZiBpdHMgdHdvIGxvY2F0aW9ucyB3aXRoaW4gdGhlIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgVmVyc2lvbn0gZW5jYXBzdWxhdGluZyB0aGUgUVIgQ29kZSdzIHZlcnNpb24KCSAgICAgKiBAdGhyb3dzIEZvcm1hdEV4Y2VwdGlvbiBpZiBib3RoIHZlcnNpb24gaW5mb3JtYXRpb24gbG9jYXRpb25zIGNhbm5vdCBiZSBwYXJzZWQgYXMKCSAgICAgKiB0aGUgdmFsaWQgZW5jb2Rpbmcgb2YgdmVyc2lvbiBpbmZvcm1hdGlvbgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUucmVhZFZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZFZlcnNpb24gIT09IG51bGwgJiYgdGhpcy5wYXJzZWRWZXJzaW9uICE9PSB1bmRlZmluZWQpIHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgcHJvdmlzaW9uYWxWZXJzaW9uID0gTWF0aC5mbG9vcigoZGltZW5zaW9uIC0gMTcpIC8gNCk7CgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24gPD0gNikgewoJICAgICAgICAgICAgcmV0dXJuIFZlcnNpb25fMSQxLmRlZmF1bHQuZ2V0VmVyc2lvbkZvck51bWJlcihwcm92aXNpb25hbFZlcnNpb24pOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJlYWQgdG9wLXJpZ2h0IHZlcnNpb24gaW5mbzogMyB3aWRlIGJ5IDYgdGFsbAoJICAgICAgICB2YXIgdmVyc2lvbkJpdHMgPSAwOwoJICAgICAgICB2YXIgaWpNaW4gPSBkaW1lbnNpb24gLSAxMTsKCSAgICAgICAgZm9yICh2YXIgaiA9IDU7IGogPj0gMDsgai0tKSB7CgkgICAgICAgICAgICBmb3IgKHZhciBpID0gZGltZW5zaW9uIC0gOTsgaSA+PSBpak1pbjsgaS0tKSB7CgkgICAgICAgICAgICAgICAgdmVyc2lvbkJpdHMgPSB0aGlzLmNvcHlCaXQoaSwgaiwgdmVyc2lvbkJpdHMpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHZhciB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBmYWlsZWQuIFRyeSBib3R0b20gbGVmdDogNiB3aWRlIGJ5IDMgdGFsbAoJICAgICAgICB2ZXJzaW9uQml0cyA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSA1OyBpID49IDA7IGktLSkgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IGRpbWVuc2lvbiAtIDk7IGogPj0gaWpNaW47IGotLSkgewoJICAgICAgICAgICAgICAgIHZlcnNpb25CaXRzID0gdGhpcy5jb3B5Qml0KGksIGosIHZlcnNpb25CaXRzKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICB0aGVQYXJzZWRWZXJzaW9uID0gVmVyc2lvbl8xJDEuZGVmYXVsdC5kZWNvZGVWZXJzaW9uSW5mb3JtYXRpb24odmVyc2lvbkJpdHMpOwoJICAgICAgICBpZiAodGhlUGFyc2VkVmVyc2lvbiAhPT0gbnVsbCAmJiB0aGVQYXJzZWRWZXJzaW9uLmdldERpbWVuc2lvbkZvclZlcnNpb24oKSA9PT0gZGltZW5zaW9uKSB7CgkgICAgICAgICAgICB0aGlzLnBhcnNlZFZlcnNpb24gPSB0aGVQYXJzZWRWZXJzaW9uOwoJICAgICAgICAgICAgcmV0dXJuIHRoZVBhcnNlZFZlcnNpb247CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5jb3B5Qml0ID0gZnVuY3Rpb24gKGkgLyppbnQqLywgaiAvKmludCovLCB2ZXJzaW9uQml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBiaXQgPSB0aGlzLmlzTWlycm9yID8gdGhpcy5iaXRNYXRyaXguZ2V0KGosIGkpIDogdGhpcy5iaXRNYXRyaXguZ2V0KGksIGopOwoJICAgICAgICByZXR1cm4gYml0ID8gKHZlcnNpb25CaXRzIDw8IDEpIHwgMHgxIDogdmVyc2lvbkJpdHMgPDwgMTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlJlYWRzIHRoZSBiaXRzIGluIHRoZSB7QGxpbmsgQml0TWF0cml4fSByZXByZXNlbnRpbmcgdGhlIGZpbmRlciBwYXR0ZXJuIGluIHRoZQoJICAgICAqIGNvcnJlY3Qgb3JkZXIgaW4gb3JkZXIgdG8gcmVjb25zdHJ1Y3QgdGhlIGNvZGV3b3JkcyBieXRlcyBjb250YWluZWQgd2l0aGluIHRoZQoJICAgICAqIFFSIENvZGUuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBleGFjdCBudW1iZXIgb2YgYnl0ZXMgZXhwZWN0ZWQgaXMgbm90IHJlYWQKCSAgICAgKi8KCSAgICBCaXRNYXRyaXhQYXJzZXIucHJvdG90eXBlLnJlYWRDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHZhciBmb3JtYXRJbmZvID0gdGhpcy5yZWFkRm9ybWF0SW5mb3JtYXRpb24oKTsKCSAgICAgICAgdmFyIHZlcnNpb24gPSB0aGlzLnJlYWRWZXJzaW9uKCk7CgkgICAgICAgIC8vIEdldCB0aGUgZGF0YSBtYXNrIGZvciB0aGUgZm9ybWF0IHVzZWQgaW4gdGhpcyBRUiBDb2RlLiBUaGlzIHdpbGwgZXhjbHVkZQoJICAgICAgICAvLyBzb21lIGJpdHMgZnJvbSByZWFkaW5nIGFzIHdlIHdpbmQgdGhyb3VnaCB0aGUgYml0IG1hdHJpeC4KCSAgICAgICAgdmFyIGRhdGFNYXNrID0gRGF0YU1hc2tfMS5kZWZhdWx0LnZhbHVlcy5nZXQoZm9ybWF0SW5mby5nZXREYXRhTWFzaygpKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IHRoaXMuYml0TWF0cml4LmdldEhlaWdodCgpOwoJICAgICAgICBkYXRhTWFzay51bm1hc2tCaXRNYXRyaXgodGhpcy5iaXRNYXRyaXgsIGRpbWVuc2lvbik7CgkgICAgICAgIHZhciBmdW5jdGlvblBhdHRlcm4gPSB2ZXJzaW9uLmJ1aWxkRnVuY3Rpb25QYXR0ZXJuKCk7CgkgICAgICAgIHZhciByZWFkaW5nVXAgPSB0cnVlOwoJICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkodmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKTsKCSAgICAgICAgdmFyIHJlc3VsdE9mZnNldCA9IDA7CgkgICAgICAgIHZhciBjdXJyZW50Qnl0ZSA9IDA7CgkgICAgICAgIHZhciBiaXRzUmVhZCA9IDA7CgkgICAgICAgIC8vIFJlYWQgY29sdW1ucyBpbiBwYWlycywgZnJvbSByaWdodCB0byBsZWZ0CgkgICAgICAgIGZvciAodmFyIGogPSBkaW1lbnNpb24gLSAxOyBqID4gMDsgaiAtPSAyKSB7CgkgICAgICAgICAgICBpZiAoaiA9PT0gNikgewoJICAgICAgICAgICAgICAgIC8vIFNraXAgd2hvbGUgY29sdW1uIHdpdGggdmVydGljYWwgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgICAgICAgICAgICAvLyBzYXZlcyB0aW1lIGFuZCBtYWtlcyB0aGUgb3RoZXIgY29kZSBwcm9jZWVkIG1vcmUgY2xlYW5seQoJICAgICAgICAgICAgICAgIGotLTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIC8vIFJlYWQgYWx0ZXJuYXRpbmdseSBmcm9tIGJvdHRvbSB0byB0b3AgdGhlbiB0b3AgdG8gYm90dG9tCgkgICAgICAgICAgICBmb3IgKHZhciBjb3VudCA9IDA7IGNvdW50IDwgZGltZW5zaW9uOyBjb3VudCsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIGkgPSByZWFkaW5nVXAgPyBkaW1lbnNpb24gLSAxIC0gY291bnQgOiBjb3VudDsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBjb2wgPSAwOyBjb2wgPCAyOyBjb2wrKykgewoJICAgICAgICAgICAgICAgICAgICAvLyBJZ25vcmUgYml0cyBjb3ZlcmVkIGJ5IHRoZSBmdW5jdGlvbiBwYXR0ZXJuCgkgICAgICAgICAgICAgICAgICAgIGlmICghZnVuY3Rpb25QYXR0ZXJuLmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVhZCBhIGJpdAoJICAgICAgICAgICAgICAgICAgICAgICAgYml0c1JlYWQrKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIDw8PSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYml0TWF0cml4LmdldChqIC0gY29sLCBpKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCeXRlIHw9IDE7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB3ZSd2ZSBtYWRlIGEgd2hvbGUgYnl0ZSwgc2F2ZSBpdCBvZmYKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiaXRzUmVhZCA9PT0gOCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRPZmZzZXQrK10gPSAvKihieXRlKSAqLyBjdXJyZW50Qnl0ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRzUmVhZCA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJ5dGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVhZGluZ1VwID0gIXJlYWRpbmdVcDsgLy8gcmVhZGluZ1VwIF49IHRydWU7IC8vIHJlYWRpbmdVcCA9ICFyZWFkaW5nVXA7IC8vIHN3aXRjaCBkaXJlY3Rpb25zCgkgICAgICAgIH0KCSAgICAgICAgaWYgKHJlc3VsdE9mZnNldCAhPT0gdmVyc2lvbi5nZXRUb3RhbENvZGV3b3JkcygpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEkMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldmVydCB0aGUgbWFzayByZW1vdmFsIGRvbmUgd2hpbGUgcmVhZGluZyB0aGUgY29kZSB3b3Jkcy4gVGhlIGJpdCBtYXRyaXggc2hvdWxkIHJldmVydCB0byBpdHMgb3JpZ2luYWwgc3RhdGUuCgkgICAgICovCgkgICAgQml0TWF0cml4UGFyc2VyLnByb3RvdHlwZS5yZW1hc2sgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIGlmICh0aGlzLnBhcnNlZEZvcm1hdEluZm8gPT09IG51bGwpIHsKCSAgICAgICAgICAgIHJldHVybjsgLy8gV2UgaGF2ZSBubyBmb3JtYXQgaW5mb3JtYXRpb24sIGFuZCBoYXZlIG5vIGRhdGEgbWFzawoJICAgICAgICB9CgkgICAgICAgIHZhciBkYXRhTWFzayA9IERhdGFNYXNrXzEuZGVmYXVsdC52YWx1ZXNbdGhpcy5wYXJzZWRGb3JtYXRJbmZvLmdldERhdGFNYXNrKCldOwoJICAgICAgICB2YXIgZGltZW5zaW9uID0gdGhpcy5iaXRNYXRyaXguZ2V0SGVpZ2h0KCk7CgkgICAgICAgIGRhdGFNYXNrLnVubWFza0JpdE1hdHJpeCh0aGlzLmJpdE1hdHJpeCwgZGltZW5zaW9uKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFByZXBhcmUgdGhlIHBhcnNlciBmb3IgYSBtaXJyb3JlZCBvcGVyYXRpb24uCgkgICAgICogVGhpcyBmbGFnIGhhcyBlZmZlY3Qgb25seSBvbiB0aGUge0BsaW5rICNyZWFkRm9ybWF0SW5mb3JtYXRpb24oKX0gYW5kIHRoZQoJICAgICAqIHtAbGluayAjcmVhZFZlcnNpb24oKX0uIEJlZm9yZSBwcm9jZWVkaW5nIHdpdGgge0BsaW5rICNyZWFkQ29kZXdvcmRzKCl9IHRoZQoJICAgICAqIHtAbGluayAjbWlycm9yKCl9IG1ldGhvZCBzaG91bGQgYmUgY2FsbGVkLgoJICAgICAqCgkgICAgICogQHBhcmFtIG1pcnJvciBXaGV0aGVyIHRvIHJlYWQgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm9ybWF0aW9uIG1pcnJvcmVkLgoJICAgICAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUuc2V0TWlycm9yID0gZnVuY3Rpb24gKGlzTWlycm9yKSB7CgkgICAgICAgIHRoaXMucGFyc2VkVmVyc2lvbiA9IG51bGw7CgkgICAgICAgIHRoaXMucGFyc2VkRm9ybWF0SW5mbyA9IG51bGw7CgkgICAgICAgIHRoaXMuaXNNaXJyb3IgPSBpc01pcnJvcjsKCSAgICB9OwoJICAgIC8qKiBNaXJyb3IgdGhlIGJpdCBtYXRyaXggaW4gb3JkZXIgdG8gYXR0ZW1wdCBhIHNlY29uZCByZWFkaW5nLiAqLwoJICAgIEJpdE1hdHJpeFBhcnNlci5wcm90b3R5cGUubWlycm9yID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgYml0TWF0cml4ID0gdGhpcy5iaXRNYXRyaXg7CgkgICAgICAgIGZvciAodmFyIHggPSAwLCB3aWR0aCA9IGJpdE1hdHJpeC5nZXRXaWR0aCgpOyB4IDwgd2lkdGg7IHgrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgeSA9IHggKyAxLCBoZWlnaHQgPSBiaXRNYXRyaXguZ2V0SGVpZ2h0KCk7IHkgPCBoZWlnaHQ7IHkrKykgewoJICAgICAgICAgICAgICAgIGlmIChiaXRNYXRyaXguZ2V0KHgsIHkpICE9PSBiaXRNYXRyaXguZ2V0KHksIHgpKSB7CgkgICAgICAgICAgICAgICAgICAgIGJpdE1hdHJpeC5mbGlwKHksIHgpOwoJICAgICAgICAgICAgICAgICAgICBiaXRNYXRyaXguZmxpcCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHJldHVybiBCaXRNYXRyaXhQYXJzZXI7Cgl9KCkpOwoJQml0TWF0cml4UGFyc2VyJDEuZGVmYXVsdCA9IEJpdE1hdHJpeFBhcnNlcjsKCgl2YXIgRGF0YUJsb2NrJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGF0YUJsb2NrJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSQxID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIGJsb2NrIG9mIGRhdGEgd2l0aGluIGEgUVIgQ29kZS4gUVIgQ29kZXMgbWF5IHNwbGl0IHRoZWlyIGRhdGEgaW50bwoJICogbXVsdGlwbGUgYmxvY2tzLCBlYWNoIG9mIHdoaWNoIGlzIGEgdW5pdCBvZiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3Jkcy4gRWFjaAoJICogaXMgcmVwcmVzZW50ZWQgYnkgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERhdGFCbG9jayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEYXRhQmxvY2sobnVtRGF0YUNvZGV3b3JkcyAvKmludCovLCBjb2Rld29yZHMpIHsKCSAgICAgICAgdGhpcy5udW1EYXRhQ29kZXdvcmRzID0gbnVtRGF0YUNvZGV3b3JkczsKCSAgICAgICAgdGhpcy5jb2Rld29yZHMgPSBjb2Rld29yZHM7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIDxwPldoZW4gUVIgQ29kZXMgdXNlIG11bHRpcGxlIGRhdGEgYmxvY2tzLCB0aGV5IGFyZSBhY3R1YWxseSBpbnRlcmxlYXZlZC4KCSAgICAgKiBUaGF0IGlzLCB0aGUgZmlyc3QgYnl0ZSBvZiBkYXRhIGJsb2NrIDEgdG8gbiBpcyB3cml0dGVuLCB0aGVuIHRoZSBzZWNvbmQgYnl0ZXMsIGFuZCBzbyBvbi4gVGhpcwoJICAgICAqIG1ldGhvZCB3aWxsIHNlcGFyYXRlIHRoZSBkYXRhIGludG8gb3JpZ2luYWwgYmxvY2tzLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSByYXdDb2Rld29yZHMgYnl0ZXMgYXMgcmVhZCBkaXJlY3RseSBmcm9tIHRoZSBRUiBDb2RlCgkgICAgICogQHBhcmFtIHZlcnNpb24gdmVyc2lvbiBvZiB0aGUgUVIgQ29kZQoJICAgICAqIEBwYXJhbSBlY0xldmVsIGVycm9yLWNvcnJlY3Rpb24gbGV2ZWwgb2YgdGhlIFFSIENvZGUKCSAgICAgKiBAcmV0dXJuIERhdGFCbG9ja3MgY29udGFpbmluZyBvcmlnaW5hbCBieXRlcywgImRlLWludGVybGVhdmVkIiBmcm9tIHJlcHJlc2VudGF0aW9uIGluIHRoZQoJICAgICAqICAgICAgICAgUVIgQ29kZQoJICAgICAqLwoJICAgIERhdGFCbG9jay5nZXREYXRhQmxvY2tzID0gZnVuY3Rpb24gKHJhd0NvZGV3b3JkcywgdmVyc2lvbiwgZWNMZXZlbCkgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgaWYgKHJhd0NvZGV3b3Jkcy5sZW5ndGggIT09IHZlcnNpb24uZ2V0VG90YWxDb2Rld29yZHMoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEZpZ3VyZSBvdXQgdGhlIG51bWJlciBhbmQgc2l6ZSBvZiBkYXRhIGJsb2NrcyB1c2VkIGJ5IHRoaXMgdmVyc2lvbiBhbmQKCSAgICAgICAgLy8gZXJyb3IgY29ycmVjdGlvbiBsZXZlbAoJICAgICAgICB2YXIgZWNCbG9ja3MgPSB2ZXJzaW9uLmdldEVDQmxvY2tzRm9yTGV2ZWwoZWNMZXZlbCk7CgkgICAgICAgIC8vIEZpcnN0IGNvdW50IHRoZSB0b3RhbCBudW1iZXIgb2YgZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIHRvdGFsQmxvY2tzID0gMDsKCSAgICAgICAgdmFyIGVjQmxvY2tBcnJheSA9IGVjQmxvY2tzLmdldEVDQmxvY2tzKCk7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICBmb3IgKHZhciBlY0Jsb2NrQXJyYXlfMSA9IF9fdmFsdWVzJDMoZWNCbG9ja0FycmF5KSwgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKTsgIWVjQmxvY2tBcnJheV8xXzEuZG9uZTsgZWNCbG9ja0FycmF5XzFfMSA9IGVjQmxvY2tBcnJheV8xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgIHZhciBlY0Jsb2NrID0gZWNCbG9ja0FycmF5XzFfMS52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbEJsb2NrcyArPSBlY0Jsb2NrLmdldENvdW50KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChlY0Jsb2NrQXJyYXlfMV8xICYmICFlY0Jsb2NrQXJyYXlfMV8xLmRvbmUgJiYgKF9hID0gZWNCbG9ja0FycmF5XzEucmV0dXJuKSkgX2EuY2FsbChlY0Jsb2NrQXJyYXlfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGVzdGFibGlzaCBEYXRhQmxvY2tzIG9mIHRoZSBhcHByb3ByaWF0ZSBzaXplIGFuZCBudW1iZXIgb2YgZGF0YSBjb2Rld29yZHMKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBBcnJheSh0b3RhbEJsb2Nrcyk7CgkgICAgICAgIHZhciBudW1SZXN1bHRCbG9ja3MgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZWNCbG9ja0FycmF5XzIgPSBfX3ZhbHVlcyQzKGVjQmxvY2tBcnJheSksIGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCk7ICFlY0Jsb2NrQXJyYXlfMl8xLmRvbmU7IGVjQmxvY2tBcnJheV8yXzEgPSBlY0Jsb2NrQXJyYXlfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZWNCbG9jayA9IGVjQmxvY2tBcnJheV8yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlY0Jsb2NrLmdldENvdW50KCk7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtRGF0YUNvZGV3b3JkcyA9IGVjQmxvY2suZ2V0RGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgICAgICB2YXIgbnVtQmxvY2tDb2Rld29yZHMgPSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCkgKyBudW1EYXRhQ29kZXdvcmRzOwoJICAgICAgICAgICAgICAgICAgICByZXN1bHRbbnVtUmVzdWx0QmxvY2tzKytdID0gbmV3IERhdGFCbG9jayhudW1EYXRhQ29kZXdvcmRzLCBuZXcgVWludDhBcnJheShudW1CbG9ja0NvZGV3b3JkcykpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGVjQmxvY2tBcnJheV8yXzEgJiYgIWVjQmxvY2tBcnJheV8yXzEuZG9uZSAmJiAoX2IgPSBlY0Jsb2NrQXJyYXlfMi5yZXR1cm4pKSBfYi5jYWxsKGVjQmxvY2tBcnJheV8yKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8yKSB0aHJvdyBlXzIuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICAvLyBBbGwgYmxvY2tzIGhhdmUgdGhlIHNhbWUgYW1vdW50IG9mIGRhdGEsIGV4Y2VwdCB0aGF0IHRoZSBsYXN0IG4KCSAgICAgICAgLy8gKHdoZXJlIG4gbWF5IGJlIDApIGhhdmUgMSBtb3JlIGJ5dGUuIEZpZ3VyZSBvdXQgd2hlcmUgdGhlc2Ugc3RhcnQuCgkgICAgICAgIHZhciBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGxvbmdlckJsb2Nrc1N0YXJ0QXQgPSByZXN1bHQubGVuZ3RoIC0gMTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IGNoZWNrIGxlbmd0aCBpcyBjb3JyZWN0IGhlcmUKCSAgICAgICAgd2hpbGUgKGxvbmdlckJsb2Nrc1N0YXJ0QXQgPj0gMCkgewoJICAgICAgICAgICAgdmFyIG51bUNvZGV3b3JkcyA9IHJlc3VsdFtsb25nZXJCbG9ja3NTdGFydEF0XS5jb2Rld29yZHMubGVuZ3RoOwoJICAgICAgICAgICAgaWYgKG51bUNvZGV3b3JkcyA9PT0gc2hvcnRlckJsb2Nrc1RvdGFsQ29kZXdvcmRzKSB7CgkgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsb25nZXJCbG9ja3NTdGFydEF0LS07CgkgICAgICAgIH0KCSAgICAgICAgbG9uZ2VyQmxvY2tzU3RhcnRBdCsrOwoJICAgICAgICB2YXIgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHMgPSBzaG9ydGVyQmxvY2tzVG90YWxDb2Rld29yZHMgLSBlY0Jsb2Nrcy5nZXRFQ0NvZGV3b3Jkc1BlckJsb2NrKCk7CgkgICAgICAgIC8vIFRoZSBsYXN0IGVsZW1lbnRzIG9mIHJlc3VsdCBtYXkgYmUgMSBlbGVtZW50IGxvbmdlcgoJICAgICAgICAvLyBmaXJzdCBmaWxsIG91dCBhcyBtYW55IGVsZW1lbnRzIGFzIGFsbCBvZiB0aGVtIGhhdmUKCSAgICAgICAgdmFyIHJhd0NvZGV3b3Jkc09mZnNldCA9IDA7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBudW1SZXN1bHRCbG9ja3M7IGorKykgewoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaV0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIC8vIEZpbGwgb3V0IHRoZSBsYXN0IGRhdGEgYmxvY2sgaW4gdGhlIGxvbmdlciBvbmVzCgkgICAgICAgIGZvciAodmFyIGogPSBsb25nZXJCbG9ja3NTdGFydEF0OyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbc2hvcnRlckJsb2Nrc051bURhdGFDb2Rld29yZHNdID0gcmF3Q29kZXdvcmRzW3Jhd0NvZGV3b3Jkc09mZnNldCsrXTsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cgYWRkIGluIGVycm9yIGNvcnJlY3Rpb24gYmxvY2tzCgkgICAgICAgIHZhciBtYXggPSByZXN1bHRbMF0uY29kZXdvcmRzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IHNob3J0ZXJCbG9ja3NOdW1EYXRhQ29kZXdvcmRzOyBpIDwgbWF4OyBpKyspIHsKCSAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtUmVzdWx0QmxvY2tzOyBqKyspIHsKCSAgICAgICAgICAgICAgICB2YXIgaU9mZnNldCA9IGogPCBsb25nZXJCbG9ja3NTdGFydEF0ID8gaSA6IGkgKyAxOwoJICAgICAgICAgICAgICAgIHJlc3VsdFtqXS5jb2Rld29yZHNbaU9mZnNldF0gPSByYXdDb2Rld29yZHNbcmF3Q29kZXdvcmRzT2Zmc2V0KytdOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiByZXN1bHQ7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldE51bURhdGFDb2Rld29yZHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bURhdGFDb2Rld29yZHM7CgkgICAgfTsKCSAgICBEYXRhQmxvY2sucHJvdG90eXBlLmdldENvZGV3b3JkcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuY29kZXdvcmRzOwoJICAgIH07CgkgICAgcmV0dXJuIERhdGFCbG9jazsKCX0oKSk7CglEYXRhQmxvY2skMS5kZWZhdWx0ID0gRGF0YUJsb2NrOwoKCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEgPSB7fTsKCgl2YXIgQml0U291cmNlJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEJpdFNvdXJjZSQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbiB7Ki8KCXZhciBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMSA9IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiA8cD5UaGlzIHByb3ZpZGVzIGFuIGVhc3kgYWJzdHJhY3Rpb24gdG8gcmVhZCBiaXRzIGF0IGEgdGltZSBmcm9tIGEgc2VxdWVuY2Ugb2YgYnl0ZXMsIHdoZXJlIHRoZQoJICogbnVtYmVyIG9mIGJpdHMgcmVhZCBpcyBub3Qgb2Z0ZW4gYSBtdWx0aXBsZSBvZiA4LjwvcD4KCSAqCgkgKiA8cD5UaGlzIGNsYXNzIGlzIHRocmVhZC1zYWZlIGJ1dCBub3QgcmVlbnRyYW50IC0tIHVubGVzcyB0aGUgY2FsbGVyIG1vZGlmaWVzIHRoZSBieXRlcyBhcnJheQoJICogaXQgcGFzc2VkIGluLCBpbiB3aGljaCBjYXNlIGFsbCBiZXRzIGFyZSBvZmYuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBCaXRTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJ5dGVzIGJ5dGVzIGZyb20gd2hpY2ggdGhpcyB3aWxsIHJlYWQgYml0cy4gQml0cyB3aWxsIGJlIHJlYWQgZnJvbSB0aGUgZmlyc3QgYnl0ZSBmaXJzdC4KCSAgICAgKiBCaXRzIGFyZSByZWFkIHdpdGhpbiBhIGJ5dGUgZnJvbSBtb3N0LXNpZ25pZmljYW50IHRvIGxlYXN0LXNpZ25pZmljYW50IGJpdC4KCSAgICAgKi8KCSAgICBmdW5jdGlvbiBCaXRTb3VyY2UoYnl0ZXMpIHsKCSAgICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSAwOwoJICAgICAgICB0aGlzLmJpdE9mZnNldCA9IDA7CgkgICAgfQoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaW5kZXggb2YgbmV4dCBiaXQgaW4gY3VycmVudCBieXRlIHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qml0T2Zmc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5iaXRPZmZzZXQ7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGluZGV4IG9mIG5leHQgYnl0ZSBpbiBpbnB1dCBieXRlIGFycmF5IHdoaWNoIHdvdWxkIGJlIHJlYWQgYnkgdGhlIG5leHQgY2FsbCB0byB7QGxpbmsgI3JlYWRCaXRzKGludCl9LgoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuZ2V0Qnl0ZU9mZnNldCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZU9mZnNldDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBudW1CaXRzIG51bWJlciBvZiBiaXRzIHRvIHJlYWQKCSAgICAgKiBAcmV0dXJuIGludCByZXByZXNlbnRpbmcgdGhlIGJpdHMgcmVhZC4gVGhlIGJpdHMgd2lsbCBhcHBlYXIgYXMgdGhlIGxlYXN0LXNpZ25pZmljYW50CgkgICAgICogICAgICAgICBiaXRzIG9mIHRoZSBpbnQKCSAgICAgKiBAdGhyb3dzIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiBudW1CaXRzIGlzbid0IGluIFsxLDMyXSBvciBtb3JlIHRoYW4gaXMgYXZhaWxhYmxlCgkgICAgICovCgkgICAgQml0U291cmNlLnByb3RvdHlwZS5yZWFkQml0cyA9IGZ1bmN0aW9uIChudW1CaXRzIC8qaW50Ki8pIHsKCSAgICAgICAgaWYgKG51bUJpdHMgPCAxIHx8IG51bUJpdHMgPiAzMiB8fCBudW1CaXRzID4gdGhpcy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xLmRlZmF1bHQoJycgKyBudW1CaXRzKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVzdWx0ID0gMDsKCSAgICAgICAgdmFyIGJpdE9mZnNldCA9IHRoaXMuYml0T2Zmc2V0OwoJICAgICAgICB2YXIgYnl0ZU9mZnNldCA9IHRoaXMuYnl0ZU9mZnNldDsKCSAgICAgICAgdmFyIGJ5dGVzID0gdGhpcy5ieXRlczsKCSAgICAgICAgLy8gRmlyc3QsIHJlYWQgcmVtYWluZGVyIGZyb20gY3VycmVudCBieXRlCgkgICAgICAgIGlmIChiaXRPZmZzZXQgPiAwKSB7CgkgICAgICAgICAgICB2YXIgYml0c0xlZnQgPSA4IC0gYml0T2Zmc2V0OwoJICAgICAgICAgICAgdmFyIHRvUmVhZCA9IG51bUJpdHMgPCBiaXRzTGVmdCA/IG51bUJpdHMgOiBiaXRzTGVmdDsKCSAgICAgICAgICAgIHZhciBiaXRzVG9Ob3RSZWFkID0gYml0c0xlZnQgLSB0b1JlYWQ7CgkgICAgICAgICAgICB2YXIgbWFzayA9ICgweEZGID4+ICg4IC0gdG9SZWFkKSkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgIHJlc3VsdCA9IChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQ7CgkgICAgICAgICAgICBudW1CaXRzIC09IHRvUmVhZDsKCSAgICAgICAgICAgIGJpdE9mZnNldCArPSB0b1JlYWQ7CgkgICAgICAgICAgICBpZiAoYml0T2Zmc2V0ID09PSA4KSB7CgkgICAgICAgICAgICAgICAgYml0T2Zmc2V0ID0gMDsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gTmV4dCByZWFkIHdob2xlIGJ5dGVzCgkgICAgICAgIGlmIChudW1CaXRzID4gMCkgewoJICAgICAgICAgICAgd2hpbGUgKG51bUJpdHMgPj0gOCkgewoJICAgICAgICAgICAgICAgIHJlc3VsdCA9IChyZXN1bHQgPDwgOCkgfCAoYnl0ZXNbYnl0ZU9mZnNldF0gJiAweEZGKTsKCSAgICAgICAgICAgICAgICBieXRlT2Zmc2V0Kys7CgkgICAgICAgICAgICAgICAgbnVtQml0cyAtPSA4OwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gRmluYWxseSByZWFkIGEgcGFydGlhbCBieXRlCgkgICAgICAgICAgICBpZiAobnVtQml0cyA+IDApIHsKCSAgICAgICAgICAgICAgICB2YXIgYml0c1RvTm90UmVhZCA9IDggLSBudW1CaXRzOwoJICAgICAgICAgICAgICAgIHZhciBtYXNrID0gKDB4RkYgPj4gYml0c1RvTm90UmVhZCkgPDwgYml0c1RvTm90UmVhZDsKCSAgICAgICAgICAgICAgICByZXN1bHQgPSAocmVzdWx0IDw8IG51bUJpdHMpIHwgKChieXRlc1tieXRlT2Zmc2V0XSAmIG1hc2spID4+IGJpdHNUb05vdFJlYWQpOwoJICAgICAgICAgICAgICAgIGJpdE9mZnNldCArPSBudW1CaXRzOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHRoaXMuYml0T2Zmc2V0ID0gYml0T2Zmc2V0OwoJICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSBieXRlT2Zmc2V0OwoJICAgICAgICByZXR1cm4gcmVzdWx0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB0aGF0IGNhbiBiZSByZWFkIHN1Y2Nlc3NmdWxseQoJICAgICAqLwoJICAgIEJpdFNvdXJjZS5wcm90b3R5cGUuYXZhaWxhYmxlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gOCAqICh0aGlzLmJ5dGVzLmxlbmd0aCAtIHRoaXMuYnl0ZU9mZnNldCkgLSB0aGlzLmJpdE9mZnNldDsKCSAgICB9OwoJICAgIHJldHVybiBCaXRTb3VyY2U7Cgl9KCkpOwoJQml0U291cmNlJDEuZGVmYXVsdCA9IEJpdFNvdXJjZTsKCgl2YXIgRGVjb2RlclJlc3VsdCQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVyUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGVjb2RpbmcgYSBtYXRyaXggb2YgYml0cy4gVGhpcyB0eXBpY2FsbHkKCSAqIGFwcGxpZXMgdG8gMkQgYmFyY29kZSBmb3JtYXRzLiBGb3Igbm93IGl0IGNvbnRhaW5zIHRoZSByYXcgYnl0ZXMgb2J0YWluZWQsCgkgKiBhcyB3ZWxsIGFzIGEgU3RyaW5nIGludGVycHJldGF0aW9uIG9mIHRob3NlIGJ5dGVzLCBpZiBhcHBsaWNhYmxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlclJlc3VsdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IocmF3Qnl0ZXM6IFVpbnQ4QXJyYXksCgkgICAgLy8gICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyaW5nLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIExpc3Q8VWludDhBcnJheT4gYnl0ZVNlZ21lbnRzLAoJICAgIC8vICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBlY0xldmVsKSB7CgkgICAgLy8gICB0aGlzKHJhd0J5dGVzLCB0ZXh0LCBieXRlU2VnbWVudHMsIGVjTGV2ZWwsIC0xLCAtMSkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRGVjb2RlclJlc3VsdChyYXdCeXRlcywgdGV4dCwgYnl0ZVNlZ21lbnRzLCBlY0xldmVsLCBzdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXIsIHN0cnVjdHVyZWRBcHBlbmRQYXJpdHkpIHsKCSAgICAgICAgaWYgKHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9PT0gdm9pZCAwKSB7IHN0cnVjdHVyZWRBcHBlbmRTZXF1ZW5jZU51bWJlciA9IC0xOyB9CgkgICAgICAgIGlmIChzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID09PSB2b2lkIDApIHsgc3RydWN0dXJlZEFwcGVuZFBhcml0eSA9IC0xOyB9CgkgICAgICAgIHRoaXMucmF3Qnl0ZXMgPSByYXdCeXRlczsKCSAgICAgICAgdGhpcy50ZXh0ID0gdGV4dDsKCSAgICAgICAgdGhpcy5ieXRlU2VnbWVudHMgPSBieXRlU2VnbWVudHM7CgkgICAgICAgIHRoaXMuZWNMZXZlbCA9IGVjTGV2ZWw7CgkgICAgICAgIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyOwoJICAgICAgICB0aGlzLnN0cnVjdHVyZWRBcHBlbmRQYXJpdHkgPSBzdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgICAgICB0aGlzLm51bUJpdHMgPSAocmF3Qnl0ZXMgPT09IHVuZGVmaW5lZCB8fCByYXdCeXRlcyA9PT0gbnVsbCkgPyAwIDogOCAqIHJhd0J5dGVzLmxlbmd0aDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiByYXcgYnl0ZXMgcmVwcmVzZW50aW5nIHRoZSByZXN1bHQsIG9yIHtAY29kZSBudWxsfSBpZiBub3QgYXBwbGljYWJsZQoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldFJhd0J5dGVzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yYXdCeXRlczsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gaG93IG1hbnkgYml0cyBvZiB7QGxpbmsgI2dldFJhd0J5dGVzKCl9IGFyZSB2YWxpZDsgdHlwaWNhbGx5IDggdGltZXMgaXRzIGxlbmd0aAoJICAgICAqIEBzaW5jZSAzLjMuMAoJICAgICAqLwoJICAgIERlY29kZXJSZXN1bHQucHJvdG90eXBlLmdldE51bUJpdHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm51bUJpdHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gbnVtQml0cyBvdmVycmlkZXMgdGhlIG51bWJlciBvZiBiaXRzIHRoYXQgYXJlIHZhbGlkIGluIHtAbGluayAjZ2V0UmF3Qnl0ZXMoKX0KCSAgICAgKiBAc2luY2UgMy4zLjAKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXROdW1CaXRzID0gZnVuY3Rpb24gKG51bUJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLm51bUJpdHMgPSBudW1CaXRzOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0ZXh0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSByZXN1bHQKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRUZXh0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50ZXh0OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBsaXN0IG9mIGJ5dGUgc2VnbWVudHMgaW4gdGhlIHJlc3VsdCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0Qnl0ZVNlZ21lbnRzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5ieXRlU2VnbWVudHM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIG5hbWUgb2YgZXJyb3IgY29ycmVjdGlvbiBsZXZlbCB1c2VkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFQ0xldmVsID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lY0xldmVsOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJyb3JzIGNvcnJlY3RlZCwgb3Ige0Bjb2RlIG51bGx9IGlmIG5vdCBhcHBsaWNhYmxlCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0RXJyb3JzQ29ycmVjdGVkID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lcnJvcnNDb3JyZWN0ZWQ7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcnJvcnNDb3JyZWN0ZWQgPSBmdW5jdGlvbiAoZXJyb3JzQ29ycmVjdGVkIC8qSW50ZWdlciovKSB7CgkgICAgICAgIHRoaXMuZXJyb3JzQ29ycmVjdGVkID0gZXJyb3JzQ29ycmVjdGVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgZXJhc3VyZXMgY29ycmVjdGVkLCBvciB7QGNvZGUgbnVsbH0gaWYgbm90IGFwcGxpY2FibGUKCSAgICAgKi8KCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRFcmFzdXJlcyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuZXJhc3VyZXM7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5zZXRFcmFzdXJlcyA9IGZ1bmN0aW9uIChlcmFzdXJlcyAvKkludGVnZXIqLykgewoJICAgICAgICB0aGlzLmVyYXN1cmVzID0gZXJhc3VyZXM7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIGFyYml0cmFyeSBhZGRpdGlvbmFsIG1ldGFkYXRhCgkgICAgICovCgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0T3RoZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuc2V0T3RoZXIgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgdGhpcy5vdGhlciA9IG90aGVyOwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuaGFzU3RydWN0dXJlZEFwcGVuZCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuc3RydWN0dXJlZEFwcGVuZFBhcml0eSA+PSAwICYmIHRoaXMuc3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID49IDA7CgkgICAgfTsKCSAgICBEZWNvZGVyUmVzdWx0LnByb3RvdHlwZS5nZXRTdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kUGFyaXR5OwoJICAgIH07CgkgICAgRGVjb2RlclJlc3VsdC5wcm90b3R5cGUuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJ1Y3R1cmVkQXBwZW5kU2VxdWVuY2VOdW1iZXI7CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlclJlc3VsdDsKCX0oKSk7CglEZWNvZGVyUmVzdWx0JDEuZGVmYXVsdCA9IERlY29kZXJSZXN1bHQ7CgoJdmFyIE1vZGUgPSB7fTsKCgkoZnVuY3Rpb24gKGV4cG9ydHMpIHsKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJZXhwb3J0cy5Nb2RlVmFsdWVzID0gdm9pZCAwOwoJdmFyIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbl8xID0gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uJDE7Cgl2YXIgTW9kZVZhbHVlczsKCShmdW5jdGlvbiAoTW9kZVZhbHVlcykgewoJICAgIE1vZGVWYWx1ZXNbTW9kZVZhbHVlc1siVEVSTUlOQVRPUiJdID0gMF0gPSAiVEVSTUlOQVRPUiI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJOVU1FUklDIl0gPSAxXSA9ICJOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkFMUEhBTlVNRVJJQyJdID0gMl0gPSAiQUxQSEFOVU1FUklDIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIlNUUlVDVFVSRURfQVBQRU5EIl0gPSAzXSA9ICJTVFJVQ1RVUkVEX0FQUEVORCI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJCWVRFIl0gPSA0XSA9ICJCWVRFIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkVDSSJdID0gNV0gPSAiRUNJIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIktBTkpJIl0gPSA2XSA9ICJLQU5KSSI7CgkgICAgTW9kZVZhbHVlc1tNb2RlVmFsdWVzWyJGTkMxX0ZJUlNUX1BPU0lUSU9OIl0gPSA3XSA9ICJGTkMxX0ZJUlNUX1BPU0lUSU9OIjsKCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkZOQzFfU0VDT05EX1BPU0lUSU9OIl0gPSA4XSA9ICJGTkMxX1NFQ09ORF9QT1NJVElPTiI7CgkgICAgLyoqIFNlZSBHQlQgMTgyODQtMjAwMDsgIkhhbnppIiBpcyBhIHRyYW5zbGl0ZXJhdGlvbiBvZiB0aGlzIG1vZGUgbmFtZS4gKi8KCSAgICBNb2RlVmFsdWVzW01vZGVWYWx1ZXNbIkhBTlpJIl0gPSA5XSA9ICJIQU5aSSI7Cgl9KShNb2RlVmFsdWVzID0gZXhwb3J0cy5Nb2RlVmFsdWVzIHx8IChleHBvcnRzLk1vZGVWYWx1ZXMgPSB7fSkpOwoJLyoqCgkgKiA8cD5TZWUgSVNPIDE4MDA0OjIwMDYsIDYuNC4xLCBUYWJsZXMgMiBhbmQgMy4gVGhpcyBlbnVtIGVuY2Fwc3VsYXRlcyB0aGUgdmFyaW91cyBtb2RlcyBpbiB3aGljaAoJICogZGF0YSBjYW4gYmUgZW5jb2RlZCB0byBiaXRzIGluIHRoZSBRUiBjb2RlIHN0YW5kYXJkLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgTW9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBNb2RlKHZhbHVlLCBzdHJpbmdWYWx1ZSwgY2hhcmFjdGVyQ291bnRCaXRzRm9yVmVyc2lvbnMsIGJpdHMgLyppbnQqLykgewoJICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CgkgICAgICAgIHRoaXMuc3RyaW5nVmFsdWUgPSBzdHJpbmdWYWx1ZTsKCSAgICAgICAgdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9ucyA9IGNoYXJhY3RlckNvdW50Qml0c0ZvclZlcnNpb25zOwoJICAgICAgICB0aGlzLmJpdHMgPSBiaXRzOwoJICAgICAgICBNb2RlLkZPUl9CSVRTLnNldChiaXRzLCB0aGlzKTsKCSAgICAgICAgTW9kZS5GT1JfVkFMVUUuc2V0KHZhbHVlLCB0aGlzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHBhcmFtIGJpdHMgZm91ciBiaXRzIGVuY29kaW5nIGEgUVIgQ29kZSBkYXRhIG1vZGUKCSAgICAgKiBAcmV0dXJuIE1vZGUgZW5jb2RlZCBieSB0aGVzZSBiaXRzCgkgICAgICogQHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWYgYml0cyBkbyBub3QgY29ycmVzcG9uZCB0byBhIGtub3duIG1vZGUKCSAgICAgKi8KCSAgICBNb2RlLmZvckJpdHMgPSBmdW5jdGlvbiAoYml0cyAvKmludCovKSB7CgkgICAgICAgIHZhciBtb2RlID0gTW9kZS5GT1JfQklUUy5nZXQoYml0cyk7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IG1vZGUpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG1vZGU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gdmVyc2lvbiB2ZXJzaW9uIGluIHF1ZXN0aW9uCgkgICAgICogQHJldHVybiBudW1iZXIgb2YgYml0cyB1c2VkLCBpbiB0aGlzIFFSIENvZGUgc3ltYm9sIHtAbGluayBWZXJzaW9ufSwgdG8gZW5jb2RlIHRoZQoJICAgICAqICAgICAgICAgY291bnQgb2YgY2hhcmFjdGVycyB0aGF0IHdpbGwgZm9sbG93IGVuY29kZWQgaW4gdGhpcyBNb2RlCgkgICAgICovCgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Q2hhcmFjdGVyQ291bnRCaXRzID0gZnVuY3Rpb24gKHZlcnNpb24pIHsKCSAgICAgICAgdmFyIHZlcnNpb25OdW1iZXIgPSB2ZXJzaW9uLmdldFZlcnNpb25OdW1iZXIoKTsKCSAgICAgICAgdmFyIG9mZnNldDsKCSAgICAgICAgaWYgKHZlcnNpb25OdW1iZXIgPD0gOSkgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmICh2ZXJzaW9uTnVtYmVyIDw9IDI2KSB7CgkgICAgICAgICAgICBvZmZzZXQgPSAxOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgb2Zmc2V0ID0gMjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gdGhpcy5jaGFyYWN0ZXJDb3VudEJpdHNGb3JWZXJzaW9uc1tvZmZzZXRdOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlOwoJICAgIH07CgkgICAgTW9kZS5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLmVxdWFscyA9IGZ1bmN0aW9uIChvKSB7CgkgICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBNb2RlKSkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlciA9IG87CgkgICAgICAgIHJldHVybiB0aGlzLnZhbHVlID09PSBvdGhlci52YWx1ZTsKCSAgICB9OwoJICAgIE1vZGUucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdWYWx1ZTsKCSAgICB9OwoJICAgIE1vZGUuRk9SX0JJVFMgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5GT1JfVkFMVUUgPSBuZXcgTWFwKCk7CgkgICAgTW9kZS5URVJNSU5BVE9SID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5URVJNSU5BVE9SLCAnVEVSTUlOQVRPUicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDAwKTsgLy8gTm90IHJlYWxseSBhIG1vZGUuLi4KCSAgICBNb2RlLk5VTUVSSUMgPSBuZXcgTW9kZShNb2RlVmFsdWVzLk5VTUVSSUMsICdOVU1FUklDJywgSW50MzJBcnJheS5mcm9tKFsxMCwgMTIsIDE0XSksIDB4MDEpOwoJICAgIE1vZGUuQUxQSEFOVU1FUklDID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5BTFBIQU5VTUVSSUMsICdBTFBIQU5VTUVSSUMnLCBJbnQzMkFycmF5LmZyb20oWzksIDExLCAxM10pLCAweDAyKTsKCSAgICBNb2RlLlNUUlVDVFVSRURfQVBQRU5EID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5TVFJVQ1RVUkVEX0FQUEVORCwgJ1NUUlVDVFVSRURfQVBQRU5EJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDMpOyAvLyBOb3Qgc3VwcG9ydGVkCgkgICAgTW9kZS5CWVRFID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5CWVRFLCAnQllURScsIEludDMyQXJyYXkuZnJvbShbOCwgMTYsIDE2XSksIDB4MDQpOwoJICAgIE1vZGUuRUNJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5FQ0ksICdFQ0knLCBJbnQzMkFycmF5LmZyb20oWzAsIDAsIDBdKSwgMHgwNyk7IC8vIGNoYXJhY3RlciBjb3VudHMgZG9uJ3QgYXBwbHkKCSAgICBNb2RlLktBTkpJID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5LQU5KSSwgJ0tBTkpJJywgSW50MzJBcnJheS5mcm9tKFs4LCAxMCwgMTJdKSwgMHgwOCk7CgkgICAgTW9kZS5GTkMxX0ZJUlNUX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX0ZJUlNUX1BPU0lUSU9OLCAnRk5DMV9GSVJTVF9QT1NJVElPTicsIEludDMyQXJyYXkuZnJvbShbMCwgMCwgMF0pLCAweDA1KTsKCSAgICBNb2RlLkZOQzFfU0VDT05EX1BPU0lUSU9OID0gbmV3IE1vZGUoTW9kZVZhbHVlcy5GTkMxX1NFQ09ORF9QT1NJVElPTiwgJ0ZOQzFfU0VDT05EX1BPU0lUSU9OJywgSW50MzJBcnJheS5mcm9tKFswLCAwLCAwXSksIDB4MDkpOwoJICAgIC8qKiBTZWUgR0JUIDE4Mjg0LTIwMDA7ICJIYW56aSIgaXMgYSB0cmFuc2xpdGVyYXRpb24gb2YgdGhpcyBtb2RlIG5hbWUuICovCgkgICAgTW9kZS5IQU5aSSA9IG5ldyBNb2RlKE1vZGVWYWx1ZXMuSEFOWkksICdIQU5aSScsIEludDMyQXJyYXkuZnJvbShbOCwgMTAsIDEyXSksIDB4MEQpOwoJICAgIHJldHVybiBNb2RlOwoJfSgpKTsKCWV4cG9ydHMuZGVmYXVsdCA9IE1vZGU7CgoJfShNb2RlKSk7CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlLmRlY29kZXIgeyovCgl2YXIgQml0U291cmNlXzEgPSBCaXRTb3VyY2UkMTsKCXZhciBDaGFyYWN0ZXJTZXRFQ0lfMSA9IENoYXJhY3RlclNldEVDSTsKCXZhciBEZWNvZGVyUmVzdWx0XzEgPSBEZWNvZGVyUmVzdWx0JDE7Cgl2YXIgU3RyaW5nVXRpbHNfMSA9IFN0cmluZ1V0aWxzJDE7Cgl2YXIgRm9ybWF0RXhjZXB0aW9uXzEgPSBGb3JtYXRFeGNlcHRpb24kMTsKCXZhciBTdHJpbmdCdWlsZGVyXzEgPSBTdHJpbmdCdWlsZGVyJDE7Cgl2YXIgU3RyaW5nRW5jb2RpbmdfMSA9IFN0cmluZ0VuY29kaW5nJDE7Cgl2YXIgTW9kZV8xID0gTW9kZTsKCS8qaW1wb3J0IGphdmEuaW8uVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbjsqLwoJLyppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlFSIENvZGVzIGNhbiBlbmNvZGUgdGV4dCBhcyBiaXRzIGluIG9uZSBvZiBzZXZlcmFsIG1vZGVzLCBhbmQgY2FuIHVzZSBtdWx0aXBsZSBtb2RlcwoJICogaW4gb25lIFFSIENvZGUuIFRoaXMgY2xhc3MgZGVjb2RlcyB0aGUgYml0cyBiYWNrIGludG8gdGV4dC48L3A+CgkgKgoJICogPHA+U2VlIElTTyAxODAwNDoyMDA2LCA2LjQuMyAtIDYuNC43PC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWNvZGVkQml0U3RyZWFtUGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERlY29kZWRCaXRTdHJlYW1QYXJzZXIoKSB7CgkgICAgfQoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlID0gZnVuY3Rpb24gKGJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cykgewoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRTb3VyY2VfMS5kZWZhdWx0KGJ5dGVzKTsKCSAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBTdHJpbmdCdWlsZGVyXzEuZGVmYXVsdCgpOwoJICAgICAgICB2YXIgYnl0ZVNlZ21lbnRzID0gbmV3IEFycmF5KCk7IC8vIDEKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IEkgZG8gbm90IHVzZSBjb25zdHJ1Y3RvciB3aXRoIHNpemUgMSBhcyBpbiBvcmlnaW5hbCBKYXZhIG1lYW5zIGNhcGFjaXR5IGFuZCB0aGUgYXJyYXkgbGVuZ3RoIGlzIGNoZWNrZWQgYmVsb3cKCSAgICAgICAgdmFyIHN5bWJvbFNlcXVlbmNlID0gLTE7CgkgICAgICAgIHZhciBwYXJpdHlEYXRhID0gLTE7CgkgICAgICAgIHRyeSB7CgkgICAgICAgICAgICB2YXIgY3VycmVudENoYXJhY3RlclNldEVDSSA9IG51bGw7CgkgICAgICAgICAgICB2YXIgZmMxSW5FZmZlY3QgPSBmYWxzZTsKCSAgICAgICAgICAgIHZhciBtb2RlID0gdm9pZCAwOwoJICAgICAgICAgICAgZG8gewoJICAgICAgICAgICAgICAgIC8vIFdoaWxlIHN0aWxsIGFub3RoZXIgc2VnbWVudCB0byByZWFkLi4uCgkgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA0KSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIE9LLCBhc3N1bWUgd2UncmUgZG9uZS4gUmVhbGx5LCBhIFRFUk1JTkFUT1IgbW9kZSBzaG91bGQgaGF2ZSBiZWVuIHJlY29yZGVkIGhlcmUKCSAgICAgICAgICAgICAgICAgICAgbW9kZSA9IE1vZGVfMS5kZWZhdWx0LlRFUk1JTkFUT1I7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICB2YXIgbW9kZUJpdHMgPSBiaXRzLnJlYWRCaXRzKDQpOwoJICAgICAgICAgICAgICAgICAgICBtb2RlID0gTW9kZV8xLmRlZmF1bHQuZm9yQml0cyhtb2RlQml0cyk7IC8vIG1vZGUgaXMgZW5jb2RlZCBieSA0IGJpdHMKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgc3dpdGNoIChtb2RlKSB7CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUjoKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkZOQzFfRklSU1RfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuRk5DMV9TRUNPTkRfUE9TSVRJT046CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBkbyBsaXR0bGUgd2l0aCBGTkMxIGV4Y2VwdCBhbHRlciB0aGUgcGFyc2VkIHJlc3VsdCBhIGJpdCBhY2NvcmRpbmcgdG8gdGhlIHNwZWMKCSAgICAgICAgICAgICAgICAgICAgICAgIGZjMUluRWZmZWN0ID0gdHJ1ZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LlNUUlVDVFVSRURfQVBQRU5EOgoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCAxNikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXF1ZW5jZSBudW1iZXIgYW5kIHBhcml0eSBpcyBhZGRlZCBsYXRlciB0byB0aGUgcmVzdWx0IG1ldGFkYXRhCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWFkIG5leHQgOCBiaXRzIChzeW1ib2wgc2VxdWVuY2UgIykgYW5kIDggYml0cyAoZGF0YTogcGFyaXR5KSwgdGhlbiBjb250aW51ZQoJICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sU2VxdWVuY2UgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgcGFyaXR5RGF0YSA9IGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5FQ0k6CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3VudCBkb2Vzbid0IGFwcGx5IHRvIEVDSQoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5wYXJzZUVDSVZhbHVlKGJpdHMpOwoJICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENoYXJhY3RlclNldEVDSSA9IENoYXJhY3RlclNldEVDSV8xLmRlZmF1bHQuZ2V0Q2hhcmFjdGVyU2V0RUNJQnlWYWx1ZSh2YWx1ZSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgY2FzZSBNb2RlXzEuZGVmYXVsdC5IQU5aSToKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IGhhbmRsZSBIYW56aSBtb2RlIHdoaWNoIGRvZXMgbm90IHN0YXJ0IHdpdGggY2hhcmFjdGVyIGNvdW50CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBDaGluZXNlIG1vZGUgY29udGFpbnMgYSBzdWIgc2V0IGluZGljYXRvciByaWdodCBhZnRlciBtb2RlIGluZGljYXRvcgoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNldCA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRIYW56aSA9IGJpdHMucmVhZEJpdHMobW9kZS5nZXRDaGFyYWN0ZXJDb3VudEJpdHModmVyc2lvbikpOwoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNldCA9PT0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVIYW56aVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudEhhbnppKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gIk5vcm1hbCIgUVIgY29kZSBtb2RlczoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhvdyBtYW55IGNoYXJhY3RlcnMgd2lsbCBmb2xsb3csIGVuY29kZWQgaW4gdGhpcyBtb2RlPwoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gYml0cy5yZWFkQml0cyhtb2RlLmdldENoYXJhY3RlckNvdW50Qml0cyh2ZXJzaW9uKSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0Lk5VTUVSSUM6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlTnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuQUxQSEFOVU1FUklDOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgZmMxSW5FZmZlY3QpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIE1vZGVfMS5kZWZhdWx0LkJZVEU6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQoYml0cywgcmVzdWx0LCBjb3VudCwgY3VycmVudENoYXJhY3RlclNldEVDSSwgYnl0ZVNlZ21lbnRzLCBoaW50cyk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgTW9kZV8xLmRlZmF1bHQuS0FOSkk6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlS2FuamlTZWdtZW50KGJpdHMsIHJlc3VsdCwgY291bnQpOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSB3aGlsZSAobW9kZSAhPT0gTW9kZV8xLmRlZmF1bHQuVEVSTUlOQVRPUik7CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlhZSAvKjogSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIGZyb20gcmVhZEJpdHMoKSBjYWxscwoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gbmV3IERlY29kZXJSZXN1bHRfMS5kZWZhdWx0KGJ5dGVzLCByZXN1bHQudG9TdHJpbmcoKSwgYnl0ZVNlZ21lbnRzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBieXRlU2VnbWVudHMsIGVjTGV2ZWwgPT09IG51bGwgPyBudWxsIDogZWNMZXZlbC50b1N0cmluZygpLCBzeW1ib2xTZXF1ZW5jZSwgcGFyaXR5RGF0YSk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBTZWUgc3BlY2lmaWNhdGlvbiBHQlQgMTgyODQtMjAwMAoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlSGFuemlTZWdtZW50ID0gZnVuY3Rpb24gKGJpdHMsIHJlc3VsdCwgY291bnQgLyppbnQqLykgewoJICAgICAgICAvLyBEb24ndCBjcmFzaCB0cnlpbmcgdG8gcmVhZCBtb3JlIGJpdHMgdGhhbiB3ZSBoYXZlIGF2YWlsYWJsZS4KCSAgICAgICAgaWYgKGNvdW50ICogMTMgPiBiaXRzLmF2YWlsYWJsZSgpKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIC8vIEVhY2ggY2hhcmFjdGVyIHdpbGwgcmVxdWlyZSAyIGJ5dGVzLiBSZWFkIHRoZSBjaGFyYWN0ZXJzIGFzIDItYnl0ZSBwYWlycwoJICAgICAgICAvLyBhbmQgZGVjb2RlIGFzIEdCMjMxMiBhZnRlcndhcmRzCgkgICAgICAgIHZhciBidWZmZXIgPSBuZXcgVWludDhBcnJheSgyICogY291bnQpOwoJICAgICAgICB2YXIgb2Zmc2V0ID0gMDsKCSAgICAgICAgd2hpbGUgKGNvdW50ID4gMCkgewoJICAgICAgICAgICAgLy8gRWFjaCAxMyBiaXRzIGVuY29kZXMgYSAyLWJ5dGUgY2hhcmFjdGVyCgkgICAgICAgICAgICB2YXIgdHdvQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDEzKTsKCSAgICAgICAgICAgIHZhciBhc3NlbWJsZWRUd29CeXRlcyA9ICgoKHR3b0J5dGVzIC8gMHgwNjApIDw8IDgpICYgMHhGRkZGRkZGRikgfCAodHdvQnl0ZXMgJSAweDA2MCk7CgkgICAgICAgICAgICBpZiAoYXNzZW1ibGVkVHdvQnl0ZXMgPCAweDAwM0JGKSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QTFBMSB0byAweEFBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBMUExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgLy8gSW4gdGhlIDB4QjBBMSB0byAweEZBRkUgcmFuZ2UKCSAgICAgICAgICAgICAgICBhc3NlbWJsZWRUd29CeXRlcyArPSAweDBBNkExOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYnVmZmVyW29mZnNldF0gPSAvKihieXRlKSAqLyAoKGFzc2VtYmxlZFR3b0J5dGVzID4+IDgpICYgMHhGRik7CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0ICsgMV0gPSAvKihieXRlKSAqLyAoYXNzZW1ibGVkVHdvQnl0ZXMgJiAweEZGKTsKCSAgICAgICAgICAgIG9mZnNldCArPSAyOwoJICAgICAgICAgICAgY291bnQtLTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKGJ1ZmZlciwgU3RyaW5nVXRpbHNfMS5kZWZhdWx0LkdCMjMxMikpOwoJICAgICAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IFRPRE86IGltcGxlbWVudCBHQjIzMTIgZGVjb2RlLiBTdHJpbmdWaWV3IGZyb20gTUROIGNvdWxkIGJlIGEgc3RhcnRpbmcgcG9pbnQKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVLYW5qaVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoY291bnQgKiAxMyA+IGJpdHMuYXZhaWxhYmxlKCkpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gRWFjaCBjaGFyYWN0ZXIgd2lsbCByZXF1aXJlIDIgYnl0ZXMuIFJlYWQgdGhlIGNoYXJhY3RlcnMgYXMgMi1ieXRlIHBhaXJzCgkgICAgICAgIC8vIGFuZCBkZWNvZGUgYXMgU2hpZnRfSklTIGFmdGVyd2FyZHMKCSAgICAgICAgdmFyIGJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDIgKiBjb3VudCk7CgkgICAgICAgIHZhciBvZmZzZXQgPSAwOwoJICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEzIGJpdHMgZW5jb2RlcyBhIDItYnl0ZSBjaGFyYWN0ZXIKCSAgICAgICAgICAgIHZhciB0d29CeXRlcyA9IGJpdHMucmVhZEJpdHMoMTMpOwoJICAgICAgICAgICAgdmFyIGFzc2VtYmxlZFR3b0J5dGVzID0gKCgodHdvQnl0ZXMgLyAweDBDMCkgPDwgOCkgJiAweEZGRkZGRkZGKSB8ICh0d29CeXRlcyAlIDB4MEMwKTsKCSAgICAgICAgICAgIGlmIChhc3NlbWJsZWRUd29CeXRlcyA8IDB4MDFGMDApIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHg4MTQwIHRvIDB4OUZGQyByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MDgxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBJbiB0aGUgMHhFMDQwIHRvIDB4RUJCRiByYW5nZQoJICAgICAgICAgICAgICAgIGFzc2VtYmxlZFR3b0J5dGVzICs9IDB4MEMxNDA7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSA9IC8qKGJ5dGUpICovIChhc3NlbWJsZWRUd29CeXRlcyA+PiA4KTsKCSAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXQgKyAxXSA9IC8qKGJ5dGUpICovIGFzc2VtYmxlZFR3b0J5dGVzOwoJICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CgkgICAgICAgICAgICBjb3VudC0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIFNoaWZ0X0pJUyBtYXkgbm90IGJlIHN1cHBvcnRlZCBpbiBzb21lIGVudmlyb25tZW50czoKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoU3RyaW5nRW5jb2RpbmdfMS5kZWZhdWx0LmRlY29kZShidWZmZXIsIFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5TSElGVF9KSVMpKTsKCSAgICAgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBUT0RPOiBpbXBsZW1lbnQgU0hJRlRfSklTIGRlY29kZS4gU3RyaW5nVmlldyBmcm9tIE1ETiBjb3VsZCBiZSBhIHN0YXJ0aW5nIHBvaW50CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGlnbm9yZWQgLyo6IFVuc3VwcG9ydGVkRW5jb2RpbmdFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoaWdub3JlZCk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuZGVjb2RlQnl0ZVNlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLCBieXRlU2VnbWVudHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIERvbid0IGNyYXNoIHRyeWluZyB0byByZWFkIG1vcmUgYml0cyB0aGFuIHdlIGhhdmUgYXZhaWxhYmxlLgoJICAgICAgICBpZiAoOCAqIGNvdW50ID4gYml0cy5hdmFpbGFibGUoKSkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgcmVhZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoY291bnQpOwoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKCSAgICAgICAgICAgIHJlYWRCeXRlc1tpXSA9IC8qKGJ5dGUpICovIGJpdHMucmVhZEJpdHMoOCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVuY29kaW5nOwoJICAgICAgICBpZiAoY3VycmVudENoYXJhY3RlclNldEVDSSA9PT0gbnVsbCkgewoJICAgICAgICAgICAgLy8gVGhlIHNwZWMgaXNuJ3QgY2xlYXIgb24gdGhpcyBtb2RlOyBzZWUKCSAgICAgICAgICAgIC8vIHNlY3Rpb24gNi40LjU6IHQgZG9lcyBub3Qgc2F5IHdoaWNoIGVuY29kaW5nIHRvIGFzc3VtaW5nCgkgICAgICAgICAgICAvLyB1cG9uIGRlY29kaW5nLiBJIGhhdmUgc2VlbiBJU08tODg1OS0xIHVzZWQgYXMgd2VsbCBhcwoJICAgICAgICAgICAgLy8gU2hpZnRfSklTIC0tIHdpdGhvdXQgYW55dGhpbmcgbGlrZSBhbiBFQ0kgZGVzaWduYXRvciB0bwoJICAgICAgICAgICAgLy8gZ2l2ZSBhIGhpbnQuCgkgICAgICAgICAgICBlbmNvZGluZyA9IFN0cmluZ1V0aWxzXzEuZGVmYXVsdC5ndWVzc0VuY29kaW5nKHJlYWRCeXRlcywgaGludHMpOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgZW5jb2RpbmcgPSBjdXJyZW50Q2hhcmFjdGVyU2V0RUNJLmdldE5hbWUoKTsKCSAgICAgICAgfQoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChTdHJpbmdFbmNvZGluZ18xLmRlZmF1bHQuZGVjb2RlKHJlYWRCeXRlcywgZW5jb2RpbmcpKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoaWdub3JlZCAvKjogVW5zdXBwb3J0ZWRFbmNvZGluZ0V4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdChpZ25vcmVkKTsKCSAgICAgICAgfQoJICAgICAgICBieXRlU2VnbWVudHMucHVzaChyZWFkQnl0ZXMpOwoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIgPSBmdW5jdGlvbiAodmFsdWUgLyppbnQqLykgewoJICAgICAgICBpZiAodmFsdWUgPj0gRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5BTFBIQU5VTUVSSUNfQ0hBUlMubGVuZ3RoKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLkFMUEhBTlVNRVJJQ19DSEFSU1t2YWx1ZV07CgkgICAgfTsKCSAgICBEZWNvZGVkQml0U3RyZWFtUGFyc2VyLmRlY29kZUFscGhhbnVtZXJpY1NlZ21lbnQgPSBmdW5jdGlvbiAoYml0cywgcmVzdWx0LCBjb3VudCAvKmludCovLCBmYzFJbkVmZmVjdCkgewoJICAgICAgICAvLyBSZWFkIHR3byBjaGFyYWN0ZXJzIGF0IGEgdGltZQoJICAgICAgICB2YXIgc3RhcnQgPSByZXN1bHQubGVuZ3RoKCk7CgkgICAgICAgIHdoaWxlIChjb3VudCA+IDEpIHsKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTEpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIG5leHRUd29DaGFyc0JpdHMgPSBiaXRzLnJlYWRCaXRzKDExKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcihuZXh0VHdvQ2hhcnNCaXRzIC8gNDUpKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKG5leHRUd29DaGFyc0JpdHMgJSA0NSkpOwoJICAgICAgICAgICAgY291bnQgLT0gMjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoY291bnQgPT09IDEpIHsKCSAgICAgICAgICAgIC8vIHNwZWNpYWwgY2FzZTogb25lIGNoYXJhY3RlciBsZWZ0CgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDYpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcihiaXRzLnJlYWRCaXRzKDYpKSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gU2VlIHNlY3Rpb24gNi40LjguMSwgNi40LjguMgoJICAgICAgICBpZiAoZmMxSW5FZmZlY3QpIHsKCSAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gbWFzc2FnZSB0aGUgcmVzdWx0IGEgYml0IGlmIGluIGFuIEZOQzEgbW9kZToKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHJlc3VsdC5sZW5ndGgoKTsgaSsrKSB7CgkgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jaGFyQXQoaSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaSA8IHJlc3VsdC5sZW5ndGgoKSAtIDEgJiYgcmVzdWx0LmNoYXJBdChpICsgMSkgPT09ICclJykgewoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gJSUgaXMgcmVuZGVyZWQgYXMgJQoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlbGV0ZUNoYXJBdChpICsgMSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbiBhbHBoYSBtb2RlLCAlIHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gRk5DMSBzZXBhcmF0b3IgMHgxRAoJICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNldENoYXJBdChpLCBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4MUQpKTsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH07CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5kZWNvZGVOdW1lcmljU2VnbWVudCA9IGZ1bmN0aW9uIChiaXRzLCByZXN1bHQsIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgLy8gUmVhZCB0aHJlZSBkaWdpdHMgYXQgYSB0aW1lCgkgICAgICAgIHdoaWxlIChjb3VudCA+PSAzKSB7CgkgICAgICAgICAgICAvLyBFYWNoIDEwIGJpdHMgZW5jb2RlcyB0aHJlZSBkaWdpdHMKCSAgICAgICAgICAgIGlmIChiaXRzLmF2YWlsYWJsZSgpIDwgMTApIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIHRocmVlRGlnaXRzQml0cyA9IGJpdHMucmVhZEJpdHMoMTApOwoJICAgICAgICAgICAgaWYgKHRocmVlRGlnaXRzQml0cyA+PSAxMDAwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoTWF0aC5mbG9vcih0aHJlZURpZ2l0c0JpdHMgLyAxMDApKSk7CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodGhyZWVEaWdpdHNCaXRzIC8gMTApICUgMTApKTsKCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIodGhyZWVEaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgICAgIGNvdW50IC09IDM7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvdW50ID09PSAyKSB7CgkgICAgICAgICAgICAvLyBUd28gZGlnaXRzIGxlZnQgb3ZlciB0byByZWFkLCBlbmNvZGVkIGluIDcgYml0cwoJICAgICAgICAgICAgaWYgKGJpdHMuYXZhaWxhYmxlKCkgPCA3KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHZhciB0d29EaWdpdHNCaXRzID0gYml0cy5yZWFkQml0cyg3KTsKCSAgICAgICAgICAgIGlmICh0d29EaWdpdHNCaXRzID49IDEwMCkgewoJICAgICAgICAgICAgICAgIHRocm93IG5ldyBGb3JtYXRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZXN1bHQuYXBwZW5kKERlY29kZWRCaXRTdHJlYW1QYXJzZXIudG9BbHBoYU51bWVyaWNDaGFyKE1hdGguZmxvb3IodHdvRGlnaXRzQml0cyAvIDEwKSkpOwoJICAgICAgICAgICAgcmVzdWx0LmFwcGVuZChEZWNvZGVkQml0U3RyZWFtUGFyc2VyLnRvQWxwaGFOdW1lcmljQ2hhcih0d29EaWdpdHNCaXRzICUgMTApKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChjb3VudCA9PT0gMSkgewoJICAgICAgICAgICAgLy8gT25lIGRpZ2l0IGxlZnQgb3ZlciB0byByZWFkCgkgICAgICAgICAgICBpZiAoYml0cy5hdmFpbGFibGUoKSA8IDQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRm9ybWF0RXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdmFyIGRpZ2l0Qml0cyA9IGJpdHMucmVhZEJpdHMoNCk7CgkgICAgICAgICAgICBpZiAoZGlnaXRCaXRzID49IDEwKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoRGVjb2RlZEJpdFN0cmVhbVBhcnNlci50b0FscGhhTnVtZXJpY0NoYXIoZGlnaXRCaXRzKSk7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIucGFyc2VFQ0lWYWx1ZSA9IGZ1bmN0aW9uIChiaXRzKSB7CgkgICAgICAgIHZhciBmaXJzdEJ5dGUgPSBiaXRzLnJlYWRCaXRzKDgpOwoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4ODApID09PSAwKSB7CgkgICAgICAgICAgICAvLyBqdXN0IG9uZSBieXRlCgkgICAgICAgICAgICByZXR1cm4gZmlyc3RCeXRlICYgMHg3RjsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4QzApID09PSAweDgwKSB7CgkgICAgICAgICAgICAvLyB0d28gYnl0ZXMKCSAgICAgICAgICAgIHZhciBzZWNvbmRCeXRlID0gYml0cy5yZWFkQml0cyg4KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDNGKSA8PCA4KSAmIDB4RkZGRkZGRkYpIHwgc2Vjb25kQnl0ZTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoKGZpcnN0Qnl0ZSAmIDB4RTApID09PSAweEMwKSB7CgkgICAgICAgICAgICAvLyB0aHJlZSBieXRlcwoJICAgICAgICAgICAgdmFyIHNlY29uZFRoaXJkQnl0ZXMgPSBiaXRzLnJlYWRCaXRzKDE2KTsKCSAgICAgICAgICAgIHJldHVybiAoKChmaXJzdEJ5dGUgJiAweDFGKSA8PCAxNikgJiAweEZGRkZGRkZGKSB8IHNlY29uZFRoaXJkQnl0ZXM7CgkgICAgICAgIH0KCSAgICAgICAgdGhyb3cgbmV3IEZvcm1hdEV4Y2VwdGlvbl8xLmRlZmF1bHQoKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFNlZSBJU08gMTgwMDQ6MjAwNiwgNi40LjQgVGFibGUgNQoJICAgICAqLwoJICAgIERlY29kZWRCaXRTdHJlYW1QYXJzZXIuQUxQSEFOVU1FUklDX0NIQVJTID0gJzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiAkJSorLS4vOic7CgkgICAgRGVjb2RlZEJpdFN0cmVhbVBhcnNlci5HQjIzMTJfU1VCU0VUID0gMTsKCSAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcjsKCX0oKSk7CglEZWNvZGVkQml0U3RyZWFtUGFyc2VyJDEuZGVmYXVsdCA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXI7CgoJdmFyIFFSQ29kZURlY29kZXJNZXRhRGF0YSQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDEzIFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShRUkNvZGVEZWNvZGVyTWV0YURhdGEkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLyoqCgkgKiBNZXRhLWRhdGEgY29udGFpbmVyIGZvciBRUiBDb2RlIGRlY29kaW5nLiBJbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBtYXkgYmUgdXNlZCB0byBjb252ZXkgaW5mb3JtYXRpb24gYmFjayB0byB0aGUKCSAqIGRlY29kaW5nIGNhbGxlci4gQ2FsbGVycyBhcmUgZXhwZWN0ZWQgdG8gcHJvY2VzcyB0aGlzLgoJICoKCSAqIEBzZWUgY29tLmdvb2dsZS56eGluZy5jb21tb24uRGVjb2RlclJlc3VsdCNnZXRPdGhlcigpCgkgKi8KCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGEgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUVJDb2RlRGVjb2Rlck1ldGFEYXRhKG1pcnJvcmVkKSB7CgkgICAgICAgIHRoaXMubWlycm9yZWQgPSBtaXJyb3JlZDsKCSAgICB9CgkgICAgLyoqCgkgICAgICogQHJldHVybiB0cnVlIGlmIHRoZSBRUiBDb2RlIHdhcyBtaXJyb3JlZC4KCSAgICAgKi8KCSAgICBRUkNvZGVEZWNvZGVyTWV0YURhdGEucHJvdG90eXBlLmlzTWlycm9yZWQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLm1pcnJvcmVkOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQXBwbHkgdGhlIHJlc3VsdCBwb2ludHMnIG9yZGVyIGNvcnJlY3Rpb24gZHVlIHRvIG1pcnJvcmluZy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBwb2ludHMgQXJyYXkgb2YgcG9pbnRzIHRvIGFwcGx5IG1pcnJvciBjb3JyZWN0aW9uIHRvLgoJICAgICAqLwoJICAgIFFSQ29kZURlY29kZXJNZXRhRGF0YS5wcm90b3R5cGUuYXBwbHlNaXJyb3JlZENvcnJlY3Rpb24gPSBmdW5jdGlvbiAocG9pbnRzKSB7CgkgICAgICAgIGlmICghdGhpcy5taXJyb3JlZCB8fCBwb2ludHMgPT09IG51bGwgfHwgcG9pbnRzLmxlbmd0aCA8IDMpIHsKCSAgICAgICAgICAgIHJldHVybjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IHBvaW50c1swXTsKCSAgICAgICAgcG9pbnRzWzBdID0gcG9pbnRzWzJdOwoJICAgICAgICBwb2ludHNbMl0gPSBib3R0b21MZWZ0OwoJICAgICAgICAvLyBObyBuZWVkIHRvICdmaXgnIHRvcC1sZWZ0IGFuZCBhbGlnbm1lbnQgcGF0dGVybi4KCSAgICB9OwoJICAgIHJldHVybiBRUkNvZGVEZWNvZGVyTWV0YURhdGE7Cgl9KCkpOwoJUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDEuZGVmYXVsdCA9IFFSQ29kZURlY29kZXJNZXRhRGF0YTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX192YWx1ZXMpIHx8IGZ1bmN0aW9uKG8pIHsKCSAgICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgU3ltYm9sLml0ZXJhdG9yLCBtID0gcyAmJiBvW3NdLCBpID0gMDsKCSAgICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTsKCSAgICBpZiAobyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSByZXR1cm4gewoJICAgICAgICBuZXh0OiBmdW5jdGlvbiAoKSB7CgkgICAgICAgICAgICBpZiAobyAmJiBpID49IG8ubGVuZ3RoKSBvID0gdm9pZCAwOwoJICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9OwoJICAgICAgICB9CgkgICAgfTsKCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKCX07CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVjb2RlciQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZWNvZGVyIHsqLwoJdmFyIENoZWNrc3VtRXhjZXB0aW9uXzEgPSBDaGVja3N1bUV4Y2VwdGlvbiQxOwoJdmFyIEJpdE1hdHJpeF8xJDIgPSBCaXRNYXRyaXgkMTsKCXZhciBHZW5lcmljR0ZfMSA9IEdlbmVyaWNHRiQxOwoJdmFyIFJlZWRTb2xvbW9uRGVjb2Rlcl8xID0gUmVlZFNvbG9tb25EZWNvZGVyJDE7Cgl2YXIgQml0TWF0cml4UGFyc2VyXzEgPSBCaXRNYXRyaXhQYXJzZXIkMTsKCXZhciBEYXRhQmxvY2tfMSA9IERhdGFCbG9jayQxOwoJdmFyIERlY29kZWRCaXRTdHJlYW1QYXJzZXJfMSA9IERlY29kZWRCaXRTdHJlYW1QYXJzZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxID0gUVJDb2RlRGVjb2Rlck1ldGFEYXRhJDE7CgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoZSBtYWluIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgUVIgQ29kZSBkZWNvZGluZyAtLSBhcyBvcHBvc2VkIHRvIGxvY2F0aW5nIGFuZCBleHRyYWN0aW5nCgkgKiB0aGUgUVIgQ29kZSBmcm9tIGFuIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGVjb2RlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBEZWNvZGVyKCkgewoJICAgICAgICB0aGlzLnJzRGVjb2RlciA9IG5ldyBSZWVkU29sb21vbkRlY29kZXJfMS5kZWZhdWx0KEdlbmVyaWNHRl8xLmRlZmF1bHQuUVJfQ09ERV9GSUVMRF8yNTYpOwoJICAgIH0KCSAgICAvLyBwdWJsaWMgZGVjb2RlKGltYWdlOiBib29sZWFuW11bXSk6IERlY29kZXJSZXN1bHQgLyp0aHJvd3MgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkNvbnZlbmllbmNlIG1ldGhvZCB0aGF0IGNhbiBkZWNvZGUgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEgMkQgYXJyYXkgb2YgYm9vbGVhbnMuCgkgICAgICogInRydWUiIGlzIHRha2VuIHRvIG1lYW4gYSBibGFjayBtb2R1bGUuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGJvb2xlYW5zIHJlcHJlc2VudGluZyB3aGl0ZS9ibGFjayBRUiBDb2RlIG1vZHVsZXMKCSAgICAgKiBAcGFyYW0gaGludHMgZGVjb2RpbmcgaGludHMgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBpbmZsdWVuY2UgZGVjb2RpbmcKCSAgICAgKiBAcmV0dXJuIHRleHQgYW5kIGJ5dGVzIGVuY29kZWQgd2l0aGluIHRoZSBRUiBDb2RlCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgdGhlIFFSIENvZGUgY2Fubm90IGJlIGRlY29kZWQKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCb29sZWFuQXJyYXkgPSBmdW5jdGlvbiAoaW1hZ2UsIGhpbnRzKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeChCaXRNYXRyaXhfMSQyLmRlZmF1bHQucGFyc2VGcm9tQm9vbGVhbkFycmF5KGltYWdlKSwgaGludHMpOwoJICAgIH07CgkgICAgLy8gcHVibGljIGRlY29kZUJpdE1hdHJpeChiaXRzOiBCaXRNYXRyaXgpOiBEZWNvZGVyUmVzdWx0IC8qdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uLCBGb3JtYXRFeGNlcHRpb24qLyB7CgkgICAgLy8gICByZXR1cm4gZGVjb2RlKGJpdHMsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qKgoJICAgICAqIDxwPkRlY29kZXMgYSBRUiBDb2RlIHJlcHJlc2VudGVkIGFzIGEge0BsaW5rIEJpdE1hdHJpeH0uIEEgMSBvciAidHJ1ZSIgaXMgdGFrZW4gdG8gbWVhbiBhIGJsYWNrIG1vZHVsZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gYml0cyBib29sZWFucyByZXByZXNlbnRpbmcgd2hpdGUvYmxhY2sgUVIgQ29kZSBtb2R1bGVzCgkgICAgICogQHBhcmFtIGhpbnRzIGRlY29kaW5nIGhpbnRzIHRoYXQgc2hvdWxkIGJlIHVzZWQgdG8gaW5mbHVlbmNlIGRlY29kaW5nCgkgICAgICogQHJldHVybiB0ZXh0IGFuZCBieXRlcyBlbmNvZGVkIHdpdGhpbiB0aGUgUVIgQ29kZQoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIHRoZSBRUiBDb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgRGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlQml0TWF0cml4ID0gZnVuY3Rpb24gKGJpdHMsIGhpbnRzKSB7CgkgICAgICAgIC8vIENvbnN0cnVjdCBhIHBhcnNlciBhbmQgcmVhZCB2ZXJzaW9uLCBlcnJvci1jb3JyZWN0aW9uIGxldmVsCgkgICAgICAgIHZhciBwYXJzZXIgPSBuZXcgQml0TWF0cml4UGFyc2VyXzEuZGVmYXVsdChiaXRzKTsKCSAgICAgICAgdmFyIGV4ID0gbnVsbDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHJldHVybiB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKjogRm9ybWF0RXhjZXB0aW9uLCBDaGVja3N1bUV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICBleCA9IGU7CgkgICAgICAgIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIC8vIFJldmVydCB0aGUgYml0IG1hdHJpeAoJICAgICAgICAgICAgcGFyc2VyLnJlbWFzaygpOwoJICAgICAgICAgICAgLy8gV2lsbCBiZSBhdHRlbXB0aW5nIGEgbWlycm9yZWQgcmVhZGluZyBvZiB0aGUgdmVyc2lvbiBhbmQgZm9ybWF0IGluZm8uCgkgICAgICAgICAgICBwYXJzZXIuc2V0TWlycm9yKHRydWUpOwoJICAgICAgICAgICAgLy8gUHJlZW1wdGl2ZWx5IHJlYWQgdGhlIHZlcnNpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgICAgIC8vIFByZWVtcHRpdmVseSByZWFkIHRoZSBmb3JtYXQgaW5mb3JtYXRpb24uCgkgICAgICAgICAgICBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCk7CgkgICAgICAgICAgICAvKgoJICAgICAgICAgICAgICogU2luY2Ugd2UncmUgaGVyZSwgdGhpcyBtZWFucyB3ZSBoYXZlIHN1Y2Nlc3NmdWxseSBkZXRlY3RlZCBzb21lIGtpbmQKCSAgICAgICAgICAgICAqIG9mIHZlcnNpb24gYW5kIGZvcm1hdCBpbmZvcm1hdGlvbiB3aGVuIG1pcnJvcmVkLiBUaGlzIGlzIGEgZ29vZCBzaWduLAoJICAgICAgICAgICAgICogdGhhdCB0aGUgUVIgY29kZSBtYXkgYmUgbWlycm9yZWQsIGFuZCB3ZSBzaG91bGQgdHJ5IG9uY2UgbW9yZSB3aXRoIGEKCSAgICAgICAgICAgICAqIG1pcnJvcmVkIGNvbnRlbnQuCgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIFByZXBhcmUgZm9yIGEgbWlycm9yZWQgcmVhZGluZy4KCSAgICAgICAgICAgIHBhcnNlci5taXJyb3IoKTsKCSAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmRlY29kZUJpdE1hdHJpeFBhcnNlcihwYXJzZXIsIGhpbnRzKTsKCSAgICAgICAgICAgIC8vIFN1Y2Nlc3MhIE5vdGlmeSB0aGUgY2FsbGVyIHRoYXQgdGhlIGNvZGUgd2FzIG1pcnJvcmVkLgoJICAgICAgICAgICAgcmVzdWx0LnNldE90aGVyKG5ldyBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSQxLmRlZmF1bHQodHJ1ZSkpOwoJICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZSAvKkZvcm1hdEV4Y2VwdGlvbiB8IENoZWNrc3VtRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgIC8vIFRocm93IHRoZSBleGNlcHRpb24gZnJvbSB0aGUgb3JpZ2luYWwgcmVhZGluZwoJICAgICAgICAgICAgaWYgKGV4ICE9PSBudWxsKSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgZXg7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0aHJvdyBlOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBEZWNvZGVyLnByb3RvdHlwZS5kZWNvZGVCaXRNYXRyaXhQYXJzZXIgPSBmdW5jdGlvbiAocGFyc2VyLCBoaW50cykgewoJICAgICAgICB2YXIgZV8xLCBfYSwgZV8yLCBfYjsKCSAgICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZXIucmVhZFZlcnNpb24oKTsKCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBwYXJzZXIucmVhZEZvcm1hdEluZm9ybWF0aW9uKCkuZ2V0RXJyb3JDb3JyZWN0aW9uTGV2ZWwoKTsKCSAgICAgICAgLy8gUmVhZCBjb2Rld29yZHMKCSAgICAgICAgdmFyIGNvZGV3b3JkcyA9IHBhcnNlci5yZWFkQ29kZXdvcmRzKCk7CgkgICAgICAgIC8vIFNlcGFyYXRlIGludG8gZGF0YSBibG9ja3MKCSAgICAgICAgdmFyIGRhdGFCbG9ja3MgPSBEYXRhQmxvY2tfMS5kZWZhdWx0LmdldERhdGFCbG9ja3MoY29kZXdvcmRzLCB2ZXJzaW9uLCBlY0xldmVsKTsKCSAgICAgICAgLy8gQ291bnQgdG90YWwgbnVtYmVyIG9mIGRhdGEgYnl0ZXMKCSAgICAgICAgdmFyIHRvdGFsQnl0ZXMgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgZGF0YUJsb2Nrc18xID0gX192YWx1ZXMkMihkYXRhQmxvY2tzKSwgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpOyAhZGF0YUJsb2Nrc18xXzEuZG9uZTsgZGF0YUJsb2Nrc18xXzEgPSBkYXRhQmxvY2tzXzEubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIGRhdGFCbG9jayA9IGRhdGFCbG9ja3NfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgIHRvdGFsQnl0ZXMgKz0gZGF0YUJsb2NrLmdldE51bURhdGFDb2Rld29yZHMoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMV8xICYmICFkYXRhQmxvY2tzXzFfMS5kb25lICYmIChfYSA9IGRhdGFCbG9ja3NfMS5yZXR1cm4pKSBfYS5jYWxsKGRhdGFCbG9ja3NfMSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHJlc3VsdEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkodG90YWxCeXRlcyk7CgkgICAgICAgIHZhciByZXN1bHRPZmZzZXQgPSAwOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgLy8gRXJyb3ItY29ycmVjdCBhbmQgY29weSBkYXRhIGJsb2NrcyB0b2dldGhlciBpbnRvIGEgc3RyZWFtIG9mIGJ5dGVzCgkgICAgICAgICAgICBmb3IgKHZhciBkYXRhQmxvY2tzXzIgPSBfX3ZhbHVlcyQyKGRhdGFCbG9ja3MpLCBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCk7ICFkYXRhQmxvY2tzXzJfMS5kb25lOyBkYXRhQmxvY2tzXzJfMSA9IGRhdGFCbG9ja3NfMi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZGF0YUJsb2NrID0gZGF0YUJsb2Nrc18yXzEudmFsdWU7CgkgICAgICAgICAgICAgICAgdmFyIGNvZGV3b3JkQnl0ZXMgPSBkYXRhQmxvY2suZ2V0Q29kZXdvcmRzKCk7CgkgICAgICAgICAgICAgICAgdmFyIG51bURhdGFDb2Rld29yZHMgPSBkYXRhQmxvY2suZ2V0TnVtRGF0YUNvZGV3b3JkcygpOwoJICAgICAgICAgICAgICAgIHRoaXMuY29ycmVjdEVycm9ycyhjb2Rld29yZEJ5dGVzLCBudW1EYXRhQ29kZXdvcmRzKTsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bURhdGFDb2Rld29yZHM7IGkrKykgewoJICAgICAgICAgICAgICAgICAgICByZXN1bHRCeXRlc1tyZXN1bHRPZmZzZXQrK10gPSBjb2Rld29yZEJ5dGVzW2ldOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICBjYXRjaCAoZV8yXzEpIHsgZV8yID0geyBlcnJvcjogZV8yXzEgfTsgfQoJICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgaWYgKGRhdGFCbG9ja3NfMl8xICYmICFkYXRhQmxvY2tzXzJfMS5kb25lICYmIChfYiA9IGRhdGFCbG9ja3NfMi5yZXR1cm4pKSBfYi5jYWxsKGRhdGFCbG9ja3NfMik7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gRGVjb2RlIHRoZSBjb250ZW50cyBvZiB0aGF0IHN0cmVhbSBvZiBieXRlcwoJICAgICAgICByZXR1cm4gRGVjb2RlZEJpdFN0cmVhbVBhcnNlcl8xLmRlZmF1bHQuZGVjb2RlKHJlc3VsdEJ5dGVzLCB2ZXJzaW9uLCBlY0xldmVsLCBoaW50cyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5HaXZlbiBkYXRhIGFuZCBlcnJvci1jb3JyZWN0aW9uIGNvZGV3b3JkcyByZWNlaXZlZCwgcG9zc2libHkgY29ycnVwdGVkIGJ5IGVycm9ycywgYXR0ZW1wdHMgdG8KCSAgICAgKiBjb3JyZWN0IHRoZSBlcnJvcnMgaW4tcGxhY2UgdXNpbmcgUmVlZC1Tb2xvbW9uIGVycm9yIGNvcnJlY3Rpb24uPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGNvZGV3b3JkQnl0ZXMgZGF0YSBhbmQgZXJyb3IgY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgKiBAcGFyYW0gbnVtRGF0YUNvZGV3b3JkcyBudW1iZXIgb2YgY29kZXdvcmRzIHRoYXQgYXJlIGRhdGEgYnl0ZXMKCSAgICAgKiBAdGhyb3dzIENoZWNrc3VtRXhjZXB0aW9uIGlmIGVycm9yIGNvcnJlY3Rpb24gZmFpbHMKCSAgICAgKi8KCSAgICBEZWNvZGVyLnByb3RvdHlwZS5jb3JyZWN0RXJyb3JzID0gZnVuY3Rpb24gKGNvZGV3b3JkQnl0ZXMsIG51bURhdGFDb2Rld29yZHMgLyppbnQqLykgewoJICAgICAgICAvLyBjb25zdCBudW1Db2Rld29yZHMgPSBjb2Rld29yZEJ5dGVzLmxlbmd0aDsKCSAgICAgICAgLy8gRmlyc3QgcmVhZCBpbnRvIGFuIGFycmF5IG9mIGludHMKCSAgICAgICAgdmFyIGNvZGV3b3Jkc0ludHMgPSBuZXcgSW50MzJBcnJheShjb2Rld29yZEJ5dGVzKTsKCSAgICAgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG5vdCByZWFseSBuZWNlc3NhcnkgdG8gdHJhbnNmb3JtIHRvIGludHM/IGNvdWxkIHJlZGVzaWduIGV2ZXJ5dGhpbmcgdG8gd29yayB3aXRoIHVuc2lnbmVkIGJ5dGVzPwoJICAgICAgICAvLyBjb25zdCBjb2Rld29yZHNJbnRzID0gbmV3IEludDMyQXJyYXkobnVtQ29kZXdvcmRzKQoJICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IG51bUNvZGV3b3JkczsgaSsrKSB7CgkgICAgICAgIC8vICAgY29kZXdvcmRzSW50c1tpXSA9IGNvZGV3b3JkQnl0ZXNbaV0gJiAweEZGCgkgICAgICAgIC8vIH0KCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIHRoaXMucnNEZWNvZGVyLmRlY29kZShjb2Rld29yZHNJbnRzLCBjb2Rld29yZEJ5dGVzLmxlbmd0aCAtIG51bURhdGFDb2Rld29yZHMpOwoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChpZ25vcmVkIC8qOiBSZWVkU29sb21vbkV4Y2VwdGlvbiovKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgQ2hlY2tzdW1FeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29weSBiYWNrIGludG8gYXJyYXkgb2YgYnl0ZXMgLS0gb25seSBuZWVkIHRvIHdvcnJ5IGFib3V0IHRoZSBieXRlcyB0aGF0IHdlcmUgZGF0YQoJICAgICAgICAvLyBXZSBkb24ndCBjYXJlIGFib3V0IGVycm9ycyBpbiB0aGUgZXJyb3ItY29ycmVjdGlvbiBjb2Rld29yZHMKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1EYXRhQ29kZXdvcmRzOyBpKyspIHsKCSAgICAgICAgICAgIGNvZGV3b3JkQnl0ZXNbaV0gPSAvKihieXRlKSAqLyBjb2Rld29yZHNJbnRzW2ldOwoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gRGVjb2RlcjsKCX0oKSk7CglEZWNvZGVyJDEuZGVmYXVsdCA9IERlY29kZXI7CgoJdmFyIERldGVjdG9yJDEgPSB7fTsKCgl2YXIgTWF0aFV0aWxzJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMTIgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KE1hdGhVdGlscyQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLmNvbW1vbi5kZXRlY3RvciB7Ki8KCS8qKgoJICogR2VuZXJhbCBtYXRoLXJlbGF0ZWQgYW5kIG51bWVyaWMgdXRpbGl0eSBmdW5jdGlvbnMuCgkgKi8KCXZhciBNYXRoVXRpbHMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gTWF0aFV0aWxzKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBFbmRzIHVwIGJlaW5nIGEgYml0IGZhc3RlciB0aGFuIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0uIFRoaXMgbWVyZWx5IHJvdW5kcyBpdHMKCSAgICAgKiBhcmd1bWVudCB0byB0aGUgbmVhcmVzdCBpbnQsIHdoZXJlIHguNSByb3VuZHMgdXAgdG8geCsxLiBTZW1hbnRpY3Mgb2YgdGhpcyBzaG9ydGN1dAoJICAgICAqIGRpZmZlciBzbGlnaHRseSBmcm9tIHtAbGluayBNYXRoI3JvdW5kKGZsb2F0KX0gaW4gdGhhdCBoYWxmIHJvdW5kcyBkb3duIGZvciBuZWdhdGl2ZQoJICAgICAqIHZhbHVlcy4gLTIuNSByb3VuZHMgdG8gLTMsIG5vdCAtMi4gRm9yIHB1cnBvc2VzIGhlcmUgaXQgbWFrZXMgbm8gZGlmZmVyZW5jZS4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBkIHJlYWwgdmFsdWUgdG8gcm91bmQKCSAgICAgKiBAcmV0dXJuIG5lYXJlc3Qge0Bjb2RlIGludH0KCSAgICAgKi8KCSAgICBNYXRoVXRpbHMucm91bmQgPSBmdW5jdGlvbiAoZCAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE5hTiA9PT0gZCkKCSAgICAgICAgICAgIHJldHVybiAwOwoJICAgICAgICBpZiAoZCA8PSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUikKCSAgICAgICAgICAgIHJldHVybiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjsKCSAgICAgICAgaWYgKGQgPj0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpCgkgICAgICAgICAgICByZXR1cm4gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgICAgIHJldHVybiAvKihpbnQpICovIChkICsgKGQgPCAwLjAgPyAtMC41IDogMC41KSkgfCAwOwoJICAgIH07CgkgICAgLy8gVFlQRVNDUklQVFBPUlQ6IG1heWJlIHJlbW92ZSByb3VuZCBtZXRob2QgYW5kIGNhbGwgZGlyZWN0bHkgTWF0aC5yb3VuZCwgaXQgbG9va3MgbGlrZSBpdCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZm9yIGpzCgkgICAgLyoqCgkgICAgICogQHBhcmFtIGFYIHBvaW50IEEgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGFZIHBvaW50IEEgeSBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJYIHBvaW50IEIgeCBjb29yZGluYXRlCgkgICAgICogQHBhcmFtIGJZIHBvaW50IEIgeSBjb29yZGluYXRlCgkgICAgICogQHJldHVybiBFdWNsaWRlYW4gZGlzdGFuY2UgYmV0d2VlbiBwb2ludHMgQSBhbmQgQgoJICAgICAqLwoJICAgIE1hdGhVdGlscy5kaXN0YW5jZSA9IGZ1bmN0aW9uIChhWCAvKmZsb2F0fGludCovLCBhWSAvKmZsb2F0fGludCovLCBiWCAvKmZsb2F0fGludCovLCBiWSAvKmZsb2F0fGludCovKSB7CgkgICAgICAgIHZhciB4RGlmZiA9IGFYIC0gYlg7CgkgICAgICAgIHZhciB5RGlmZiA9IGFZIC0gYlk7CgkgICAgICAgIHJldHVybiAvKihmbG9hdCkgKi8gTWF0aC5zcXJ0KHhEaWZmICogeERpZmYgKyB5RGlmZiAqIHlEaWZmKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBhWCBwb2ludCBBIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBhWSBwb2ludCBBIHkgY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWCBwb2ludCBCIHggY29vcmRpbmF0ZQoJICAgICAqIEBwYXJhbSBiWSBwb2ludCBCIHkgY29vcmRpbmF0ZQoJICAgICAqIEByZXR1cm4gRXVjbGlkZWFuIGRpc3RhbmNlIGJldHdlZW4gcG9pbnRzIEEgYW5kIEIKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgc3RhdGljIGRpc3RhbmNlKGFYOiBudW1iZXIgLyppbnQqLywgYVk6IG51bWJlciAvKmludCovLCBiWDogbnVtYmVyIC8qaW50Ki8sIGJZOiBudW1iZXIgLyppbnQqLyk6IGZsb2F0IHsKCSAgICAvLyAgIGNvbnN0IHhEaWZmID0gYVggLSBiWAoJICAgIC8vICAgY29uc3QgeURpZmYgPSBhWSAtIGJZCgkgICAgLy8gICByZXR1cm4gKGZsb2F0KSBNYXRoLnNxcnQoeERpZmYgKiB4RGlmZiArIHlEaWZmICogeURpZmYpOwoJICAgIC8vIH0KCSAgICAvKioKCSAgICAgKiBAcGFyYW0gYXJyYXkgdmFsdWVzIHRvIHN1bQoJICAgICAqIEByZXR1cm4gc3VtIG9mIHZhbHVlcyBpbiBhcnJheQoJICAgICAqLwoJICAgIE1hdGhVdGlscy5zdW0gPSBmdW5jdGlvbiAoYXJyYXkpIHsKCSAgICAgICAgdmFyIGNvdW50ID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aF8xID0gYXJyYXkubGVuZ3RoOyBpICE9PSBsZW5ndGhfMTsgaSsrKSB7CgkgICAgICAgICAgICB2YXIgYSA9IGFycmF5W2ldOwoJICAgICAgICAgICAgY291bnQgKz0gYTsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gY291bnQ7CgkgICAgfTsKCSAgICByZXR1cm4gTWF0aFV0aWxzOwoJfSgpKTsKCU1hdGhVdGlscyQxLmRlZmF1bHQgPSBNYXRoVXRpbHM7CgoJdmFyIERldGVjdG9yUmVzdWx0JDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KERldGVjdG9yUmVzdWx0JDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIHRoZSByZXN1bHQgb2YgZGV0ZWN0aW5nIGEgYmFyY29kZSBpbiBhbiBpbWFnZS4gVGhpcyBpbmNsdWRlcyB0aGUgcmF3CgkgKiBtYXRyaXggb2YgYmxhY2svd2hpdGUgcGl4ZWxzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGJhcmNvZGUsIGFuZCBwb3NzaWJseSBwb2ludHMgb2YgaW50ZXJlc3QKCSAqIGluIHRoZSBpbWFnZSwgbGlrZSB0aGUgbG9jYXRpb24gb2YgZmluZGVyIHBhdHRlcm5zIG9yIGNvcm5lcnMgb2YgdGhlIGJhcmNvZGUgaW4gdGhlIGltYWdlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgRGV0ZWN0b3JSZXN1bHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gRGV0ZWN0b3JSZXN1bHQoYml0cywgcG9pbnRzKSB7CgkgICAgICAgIHRoaXMuYml0cyA9IGJpdHM7CgkgICAgICAgIHRoaXMucG9pbnRzID0gcG9pbnRzOwoJICAgIH0KCSAgICBEZXRlY3RvclJlc3VsdC5wcm90b3R5cGUuZ2V0Qml0cyA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYml0czsKCSAgICB9OwoJICAgIERldGVjdG9yUmVzdWx0LnByb3RvdHlwZS5nZXRQb2ludHMgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLnBvaW50czsKCSAgICB9OwoJICAgIHJldHVybiBEZXRlY3RvclJlc3VsdDsKCX0oKSk7CglEZXRlY3RvclJlc3VsdCQxLmRlZmF1bHQgPSBEZXRlY3RvclJlc3VsdDsKCgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSQxID0ge307CgoJdmFyIERlZmF1bHRHcmlkU2FtcGxlciQxID0ge307CgoJdmFyIEdyaWRTYW1wbGVyJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDUgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyoqCgkgKiBJbXBsZW1lbnRhdGlvbnMgb2YgdGhpcyBjbGFzcyBjYW4sIGdpdmVuIGxvY2F0aW9ucyBvZiBmaW5kZXIgcGF0dGVybnMgZm9yIGEgUVIgY29kZSBpbiBhbgoJICogaW1hZ2UsIHNhbXBsZSB0aGUgcmlnaHQgcG9pbnRzIGluIHRoZSBpbWFnZSB0byByZWNvbnN0cnVjdCB0aGUgUVIgY29kZSwgYWNjb3VudGluZyBmb3IKCSAqIHBlcnNwZWN0aXZlIGRpc3RvcnRpb24uIEl0IGlzIGFic3RyYWN0ZWQgc2luY2UgaXQgaXMgcmVsYXRpdmVseSBleHBlbnNpdmUgYW5kIHNob3VsZCBiZSBhbGxvd2VkCgkgKiB0byB0YWtlIGFkdmFudGFnZSBvZiBwbGF0Zm9ybS1zcGVjaWZpYyBvcHRpbWl6ZWQgaW1wbGVtZW50YXRpb25zLCBsaWtlIFN1bidzIEphdmEgQWR2YW5jZWQKCSAqIEltYWdpbmcgbGlicmFyeSwgYnV0IHdoaWNoIG1heSBub3QgYmUgYXZhaWxhYmxlIGluIG90aGVyIGVudmlyb25tZW50cyBzdWNoIGFzIEoyTUUsIGFuZCB2aWNlCgkgKiB2ZXJzYS4KCSAqCgkgKiBUaGUgaW1wbGVtZW50YXRpb24gdXNlZCBjYW4gYmUgY29udHJvbGxlZCBieSBjYWxsaW5nIHtAbGluayAjc2V0R3JpZFNhbXBsZXIoR3JpZFNhbXBsZXIpfQoJICogd2l0aCBhbiBpbnN0YW5jZSBvZiBhIGNsYXNzIHdoaWNoIGltcGxlbWVudHMgdGhpcyBpbnRlcmZhY2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEdyaWRTYW1wbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEdyaWRTYW1wbGVyKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiA8cD5DaGVja3MgYSBzZXQgb2YgcG9pbnRzIHRoYXQgaGF2ZSBiZWVuIHRyYW5zZm9ybWVkIHRvIHNhbXBsZSBwb2ludHMgb24gYW4gaW1hZ2UgYWdhaW5zdAoJICAgICAqIHRoZSBpbWFnZSdzIGRpbWVuc2lvbnMgdG8gc2VlIGlmIHRoZSBwb2ludCBhcmUgZXZlbiB3aXRoaW4gdGhlIGltYWdlLjwvcD4KCSAgICAgKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHdpbGwgYWN0dWFsbHkgIm51ZGdlIiB0aGUgZW5kcG9pbnRzIGJhY2sgb250byB0aGUgaW1hZ2UgaWYgdGhleSBhcmUgZm91bmQgdG8gYmUKCSAgICAgKiBiYXJlbHkgKGxlc3MgdGhhbiAxIHBpeGVsKSBvZmYgdGhlIGltYWdlLiBUaGlzIGFjY291bnRzIGZvciBpbXBlcmZlY3QgZGV0ZWN0aW9uIG9mIGZpbmRlcgoJICAgICAqIHBhdHRlcm5zIGluIGFuIGltYWdlIHdoZXJlIHRoZSBRUiBDb2RlIHJ1bnMgYWxsIHRoZSB3YXkgdG8gdGhlIGltYWdlIGJvcmRlci48L3A+CgkgICAgICoKCSAgICAgKiA8cD5Gb3IgZWZmaWNpZW5jeSwgdGhlIG1ldGhvZCB3aWxsIGNoZWNrIHBvaW50cyBmcm9tIGVpdGhlciBlbmQgb2YgdGhlIGxpbmUgdW50aWwgb25lIGlzIGZvdW5kCgkgICAgICogdG8gYmUgd2l0aGluIHRoZSBpbWFnZS4gQmVjYXVzZSB0aGUgc2V0IG9mIHBvaW50cyBhcmUgYXNzdW1lZCB0byBiZSBsaW5lYXIsIHRoaXMgaXMgdmFsaWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGltYWdlIGltYWdlIGludG8gd2hpY2ggdGhlIHBvaW50cyBzaG91bGQgbWFwCgkgICAgICogQHBhcmFtIHBvaW50cyBhY3R1YWwgcG9pbnRzIGluIHgxLHkxLC4uLix4bix5biBmb3JtCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhbiBlbmRwb2ludCBpcyBsaWVzIG91dHNpZGUgdGhlIGltYWdlIGJvdW5kYXJpZXMKCSAgICAgKi8KCSAgICBHcmlkU2FtcGxlci5jaGVja0FuZE51ZGdlUG9pbnRzID0gZnVuY3Rpb24gKGltYWdlLCBwb2ludHMpIHsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIGhlaWdodCA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gc3RhcnQgdW50aWwgd2Ugc2VlIHNvbWUgdGhhdCBhcmUgT0s6CgkgICAgICAgIHZhciBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSAwOyBvZmZzZXQgPCBwb2ludHMubGVuZ3RoICYmIG51ZGdlZDsgb2Zmc2V0ICs9IDIpIHsKCSAgICAgICAgICAgIHZhciB4ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0XSk7CgkgICAgICAgICAgICB2YXIgeSA9IE1hdGguZmxvb3IocG9pbnRzW29mZnNldCArIDFdKTsKCSAgICAgICAgICAgIGlmICh4IDwgLTEgfHwgeCA+IHdpZHRoIHx8IHkgPCAtMSB8fCB5ID4gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBudWRnZWQgPSBmYWxzZTsKCSAgICAgICAgICAgIGlmICh4ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gMC4wOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmICh4ID09PSB3aWR0aCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXRdID0gd2lkdGggLSAxOwoJICAgICAgICAgICAgICAgIG51ZGdlZCA9IHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAoeSA9PT0gLTEpIHsKCSAgICAgICAgICAgICAgICBwb2ludHNbb2Zmc2V0ICsgMV0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IGhlaWdodCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBDaGVjayBhbmQgbnVkZ2UgcG9pbnRzIGZyb20gZW5kOgoJICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSBwb2ludHMubGVuZ3RoIC0gMjsgb2Zmc2V0ID49IDAgJiYgbnVkZ2VkOyBvZmZzZXQgLT0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBNYXRoLmZsb29yKHBvaW50c1tvZmZzZXRdKTsKCSAgICAgICAgICAgIHZhciB5ID0gTWF0aC5mbG9vcihwb2ludHNbb2Zmc2V0ICsgMV0pOwoJICAgICAgICAgICAgaWYgKHggPCAtMSB8fCB4ID4gd2lkdGggfHwgeSA8IC0xIHx8IHkgPiBoZWlnaHQpIHsKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ1LmRlZmF1bHQoKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIG51ZGdlZCA9IGZhbHNlOwoJICAgICAgICAgICAgaWYgKHggPT09IC0xKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSAwLjA7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGVsc2UgaWYgKHggPT09IHdpZHRoKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldF0gPSB3aWR0aCAtIDE7CgkgICAgICAgICAgICAgICAgbnVkZ2VkID0gdHJ1ZTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmICh5ID09PSAtMSkgewoJICAgICAgICAgICAgICAgIHBvaW50c1tvZmZzZXQgKyAxXSA9IDAuMDsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSBpZiAoeSA9PT0gaGVpZ2h0KSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW29mZnNldCArIDFdID0gaGVpZ2h0IC0gMTsKCSAgICAgICAgICAgICAgICBudWRnZWQgPSB0cnVlOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgfTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXI7Cgl9KCkpOwoJR3JpZFNhbXBsZXIkMS5kZWZhdWx0ID0gR3JpZFNhbXBsZXI7CgoJdmFyIFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KFBlcnNwZWN0aXZlVHJhbnNmb3JtJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJLyoqCgkgKiA8cD5UaGlzIGNsYXNzIGltcGxlbWVudHMgYSBwZXJzcGVjdGl2ZSB0cmFuc2Zvcm0gaW4gdHdvIGRpbWVuc2lvbnMuIEdpdmVuIGZvdXIgc291cmNlIGFuZCBmb3VyCgkgKiBkZXN0aW5hdGlvbiBwb2ludHMsIGl0IHdpbGwgY29tcHV0ZSB0aGUgdHJhbnNmb3JtYXRpb24gaW1wbGllZCBiZXR3ZWVuIHRoZW0uIFRoZSBjb2RlIGlzIGJhc2VkCgkgKiBkaXJlY3RseSB1cG9uIHNlY3Rpb24gMy40LjIgb2YgR2VvcmdlIFdvbGJlcmcncyAiRGlnaXRhbCBJbWFnZSBXYXJwaW5nIjsgc2VlIHBhZ2VzIDU0LTU2LjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm0gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUGVyc3BlY3RpdmVUcmFuc2Zvcm0oYTExIC8qZmxvYXQqLywgYTIxIC8qZmxvYXQqLywgYTMxIC8qZmxvYXQqLywgYTEyIC8qZmxvYXQqLywgYTIyIC8qZmxvYXQqLywgYTMyIC8qZmxvYXQqLywgYTEzIC8qZmxvYXQqLywgYTIzIC8qZmxvYXQqLywgYTMzIC8qZmxvYXQqLykgewoJICAgICAgICB0aGlzLmExMSA9IGExMTsKCSAgICAgICAgdGhpcy5hMjEgPSBhMjE7CgkgICAgICAgIHRoaXMuYTMxID0gYTMxOwoJICAgICAgICB0aGlzLmExMiA9IGExMjsKCSAgICAgICAgdGhpcy5hMjIgPSBhMjI7CgkgICAgICAgIHRoaXMuYTMyID0gYTMyOwoJICAgICAgICB0aGlzLmExMyA9IGExMzsKCSAgICAgICAgdGhpcy5hMjMgPSBhMjM7CgkgICAgICAgIHRoaXMuYTMzID0gYTMzOwoJICAgIH0KCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsID0gZnVuY3Rpb24gKHgwIC8qZmxvYXQqLywgeTAgLypmbG9hdCovLCB4MSAvKmZsb2F0Ki8sIHkxIC8qZmxvYXQqLywgeDIgLypmbG9hdCovLCB5MiAvKmZsb2F0Ki8sIHgzIC8qZmxvYXQqLywgeTMgLypmbG9hdCovLCB4MHAgLypmbG9hdCovLCB5MHAgLypmbG9hdCovLCB4MXAgLypmbG9hdCovLCB5MXAgLypmbG9hdCovLCB4MnAgLypmbG9hdCovLCB5MnAgLypmbG9hdCovLCB4M3AgLypmbG9hdCovLCB5M3AgLypmbG9hdCovKSB7CgkgICAgICAgIHZhciBxVG9TID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0ucXVhZHJpbGF0ZXJhbFRvU3F1YXJlKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5Myk7CgkgICAgICAgIHZhciBzVG9RID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwcCwgeTBwLCB4MXAsIHkxcCwgeDJwLCB5MnAsIHgzcCwgeTNwKTsKCSAgICAgICAgcmV0dXJuIHNUb1EudGltZXMocVRvUyk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUudHJhbnNmb3JtUG9pbnRzID0gZnVuY3Rpb24gKHBvaW50cykgewoJICAgICAgICB2YXIgbWF4ID0gcG9pbnRzLmxlbmd0aDsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXg7IGkgKz0gMikgewoJICAgICAgICAgICAgdmFyIHggPSBwb2ludHNbaV07CgkgICAgICAgICAgICB2YXIgeSA9IHBvaW50c1tpICsgMV07CgkgICAgICAgICAgICB2YXIgZGVub21pbmF0b3IgPSBhMTMgKiB4ICsgYTIzICogeSArIGEzMzsKCSAgICAgICAgICAgIHBvaW50c1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHBvaW50c1tpICsgMV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50cmFuc2Zvcm1Qb2ludHNXaXRoVmFsdWVzID0gZnVuY3Rpb24gKHhWYWx1ZXMsIHlWYWx1ZXMpIHsKCSAgICAgICAgdmFyIGExMSA9IHRoaXMuYTExOwoJICAgICAgICB2YXIgYTEyID0gdGhpcy5hMTI7CgkgICAgICAgIHZhciBhMTMgPSB0aGlzLmExMzsKCSAgICAgICAgdmFyIGEyMSA9IHRoaXMuYTIxOwoJICAgICAgICB2YXIgYTIyID0gdGhpcy5hMjI7CgkgICAgICAgIHZhciBhMjMgPSB0aGlzLmEyMzsKCSAgICAgICAgdmFyIGEzMSA9IHRoaXMuYTMxOwoJICAgICAgICB2YXIgYTMyID0gdGhpcy5hMzI7CgkgICAgICAgIHZhciBhMzMgPSB0aGlzLmEzMzsKCSAgICAgICAgdmFyIG4gPSB4VmFsdWVzLmxlbmd0aDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIHsKCSAgICAgICAgICAgIHZhciB4ID0geFZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciB5ID0geVZhbHVlc1tpXTsKCSAgICAgICAgICAgIHZhciBkZW5vbWluYXRvciA9IGExMyAqIHggKyBhMjMgKiB5ICsgYTMzOwoJICAgICAgICAgICAgeFZhbHVlc1tpXSA9IChhMTEgKiB4ICsgYTIxICogeSArIGEzMSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHlWYWx1ZXNbaV0gPSAoYTEyICogeCArIGEyMiAqIHkgKyBhMzIpIC8gZGVub21pbmF0b3I7CgkgICAgICAgIH0KCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnNxdWFyZVRvUXVhZHJpbGF0ZXJhbCA9IGZ1bmN0aW9uICh4MCAvKmZsb2F0Ki8sIHkwIC8qZmxvYXQqLywgeDEgLypmbG9hdCovLCB5MSAvKmZsb2F0Ki8sIHgyIC8qZmxvYXQqLywgeTIgLypmbG9hdCovLCB4MyAvKmZsb2F0Ki8sIHkzIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgZHgzID0geDAgLSB4MSArIHgyIC0geDM7CgkgICAgICAgIHZhciBkeTMgPSB5MCAtIHkxICsgeTIgLSB5MzsKCSAgICAgICAgaWYgKGR4MyA9PT0gMC4wICYmIGR5MyA9PT0gMC4wKSB7CgkgICAgICAgICAgICAvLyBBZmZpbmUKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCwgeDIgLSB4MSwgeDAsIHkxIC0geTAsIHkyIC0geTEsIHkwLCAwLjAsIDAuMCwgMS4wKTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHZhciBkeDEgPSB4MSAtIHgyOwoJICAgICAgICAgICAgdmFyIGR4MiA9IHgzIC0geDI7CgkgICAgICAgICAgICB2YXIgZHkxID0geTEgLSB5MjsKCSAgICAgICAgICAgIHZhciBkeTIgPSB5MyAtIHkyOwoJICAgICAgICAgICAgdmFyIGRlbm9taW5hdG9yID0gZHgxICogZHkyIC0gZHgyICogZHkxOwoJICAgICAgICAgICAgdmFyIGExMyA9IChkeDMgKiBkeTIgLSBkeDIgKiBkeTMpIC8gZGVub21pbmF0b3I7CgkgICAgICAgICAgICB2YXIgYTIzID0gKGR4MSAqIGR5MyAtIGR4MyAqIGR5MSkgLyBkZW5vbWluYXRvcjsKCSAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc3BlY3RpdmVUcmFuc2Zvcm0oeDEgLSB4MCArIGExMyAqIHgxLCB4MyAtIHgwICsgYTIzICogeDMsIHgwLCB5MSAtIHkwICsgYTEzICogeTEsIHkzIC0geTAgKyBhMjMgKiB5MywgeTAsIGExMywgYTIzLCAxLjApOwoJICAgICAgICB9CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5xdWFkcmlsYXRlcmFsVG9TcXVhcmUgPSBmdW5jdGlvbiAoeDAgLypmbG9hdCovLCB5MCAvKmZsb2F0Ki8sIHgxIC8qZmxvYXQqLywgeTEgLypmbG9hdCovLCB4MiAvKmZsb2F0Ki8sIHkyIC8qZmxvYXQqLywgeDMgLypmbG9hdCovLCB5MyAvKmZsb2F0Ki8pIHsKCSAgICAgICAgLy8gSGVyZSwgdGhlIGFkam9pbnQgc2VydmVzIGFzIHRoZSBpbnZlcnNlOgoJICAgICAgICByZXR1cm4gUGVyc3BlY3RpdmVUcmFuc2Zvcm0uc3F1YXJlVG9RdWFkcmlsYXRlcmFsKHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHgzLCB5MykuYnVpbGRBZGpvaW50KCk7CgkgICAgfTsKCSAgICBQZXJzcGVjdGl2ZVRyYW5zZm9ybS5wcm90b3R5cGUuYnVpbGRBZGpvaW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBBZGpvaW50IGlzIHRoZSB0cmFuc3Bvc2Ugb2YgdGhlIGNvZmFjdG9yIG1hdHJpeDoKCSAgICAgICAgcmV0dXJuIG5ldyBQZXJzcGVjdGl2ZVRyYW5zZm9ybSh0aGlzLmEyMiAqIHRoaXMuYTMzIC0gdGhpcy5hMjMgKiB0aGlzLmEzMiwgdGhpcy5hMjMgKiB0aGlzLmEzMSAtIHRoaXMuYTIxICogdGhpcy5hMzMsIHRoaXMuYTIxICogdGhpcy5hMzIgLSB0aGlzLmEyMiAqIHRoaXMuYTMxLCB0aGlzLmExMyAqIHRoaXMuYTMyIC0gdGhpcy5hMTIgKiB0aGlzLmEzMywgdGhpcy5hMTEgKiB0aGlzLmEzMyAtIHRoaXMuYTEzICogdGhpcy5hMzEsIHRoaXMuYTEyICogdGhpcy5hMzEgLSB0aGlzLmExMSAqIHRoaXMuYTMyLCB0aGlzLmExMiAqIHRoaXMuYTIzIC0gdGhpcy5hMTMgKiB0aGlzLmEyMiwgdGhpcy5hMTMgKiB0aGlzLmEyMSAtIHRoaXMuYTExICogdGhpcy5hMjMsIHRoaXMuYTExICogdGhpcy5hMjIgLSB0aGlzLmExMiAqIHRoaXMuYTIxKTsKCSAgICB9OwoJICAgIFBlcnNwZWN0aXZlVHJhbnNmb3JtLnByb3RvdHlwZS50aW1lcyA9IGZ1bmN0aW9uIChvdGhlcikgewoJICAgICAgICByZXR1cm4gbmV3IFBlcnNwZWN0aXZlVHJhbnNmb3JtKHRoaXMuYTExICogb3RoZXIuYTExICsgdGhpcy5hMjEgKiBvdGhlci5hMTIgKyB0aGlzLmEzMSAqIG90aGVyLmExMywgdGhpcy5hMTEgKiBvdGhlci5hMjEgKyB0aGlzLmEyMSAqIG90aGVyLmEyMiArIHRoaXMuYTMxICogb3RoZXIuYTIzLCB0aGlzLmExMSAqIG90aGVyLmEzMSArIHRoaXMuYTIxICogb3RoZXIuYTMyICsgdGhpcy5hMzEgKiBvdGhlci5hMzMsIHRoaXMuYTEyICogb3RoZXIuYTExICsgdGhpcy5hMjIgKiBvdGhlci5hMTIgKyB0aGlzLmEzMiAqIG90aGVyLmExMywgdGhpcy5hMTIgKiBvdGhlci5hMjEgKyB0aGlzLmEyMiAqIG90aGVyLmEyMiArIHRoaXMuYTMyICogb3RoZXIuYTIzLCB0aGlzLmExMiAqIG90aGVyLmEzMSArIHRoaXMuYTIyICogb3RoZXIuYTMyICsgdGhpcy5hMzIgKiBvdGhlci5hMzMsIHRoaXMuYTEzICogb3RoZXIuYTExICsgdGhpcy5hMjMgKiBvdGhlci5hMTIgKyB0aGlzLmEzMyAqIG90aGVyLmExMywgdGhpcy5hMTMgKiBvdGhlci5hMjEgKyB0aGlzLmEyMyAqIG90aGVyLmEyMiArIHRoaXMuYTMzICogb3RoZXIuYTIzLCB0aGlzLmExMyAqIG90aGVyLmEzMSArIHRoaXMuYTIzICogb3RoZXIuYTMyICsgdGhpcy5hMzMgKiBvdGhlci5hMzMpOwoJICAgIH07CgkgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoJfSgpKTsKCVBlcnNwZWN0aXZlVHJhbnNmb3JtJDEuZGVmYXVsdCA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX19leHRlbmRzJDIgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGVmYXVsdEdyaWRTYW1wbGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcuY29tbW9uIHsqLwoJdmFyIEdyaWRTYW1wbGVyXzEgPSBHcmlkU2FtcGxlciQxOwoJdmFyIEJpdE1hdHJpeF8xJDEgPSBCaXRNYXRyaXgkMTsKCXZhciBQZXJzcGVjdGl2ZVRyYW5zZm9ybV8xJDEgPSBQZXJzcGVjdGl2ZVRyYW5zZm9ybSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEkNCA9IE5vdEZvdW5kRXhjZXB0aW9uJDE7CgkvKioKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBEZWZhdWx0R3JpZFNhbXBsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDIoRGVmYXVsdEdyaWRTYW1wbGVyLCBfc3VwZXIpOwoJICAgIGZ1bmN0aW9uIERlZmF1bHRHcmlkU2FtcGxlcigpIHsKCSAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOwoJICAgIH0KCSAgICAvKkBPdmVycmlkZSovCgkgICAgRGVmYXVsdEdyaWRTYW1wbGVyLnByb3RvdHlwZS5zYW1wbGVHcmlkID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgcDFUb1ggLypmbG9hdCovLCBwMVRvWSAvKmZsb2F0Ki8sIHAyVG9YIC8qZmxvYXQqLywgcDJUb1kgLypmbG9hdCovLCBwM1RvWCAvKmZsb2F0Ki8sIHAzVG9ZIC8qZmxvYXQqLywgcDRUb1ggLypmbG9hdCovLCBwNFRvWSAvKmZsb2F0Ki8sIHAxRnJvbVggLypmbG9hdCovLCBwMUZyb21ZIC8qZmxvYXQqLywgcDJGcm9tWCAvKmZsb2F0Ki8sIHAyRnJvbVkgLypmbG9hdCovLCBwM0Zyb21YIC8qZmxvYXQqLywgcDNGcm9tWSAvKmZsb2F0Ki8sIHA0RnJvbVggLypmbG9hdCovLCBwNEZyb21ZIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSQxLmRlZmF1bHQucXVhZHJpbGF0ZXJhbFRvUXVhZHJpbGF0ZXJhbChwMVRvWCwgcDFUb1ksIHAyVG9YLCBwMlRvWSwgcDNUb1gsIHAzVG9ZLCBwNFRvWCwgcDRUb1ksIHAxRnJvbVgsIHAxRnJvbVksIHAyRnJvbVgsIHAyRnJvbVksIHAzRnJvbVgsIHAzRnJvbVksIHA0RnJvbVgsIHA0RnJvbVkpOwoJICAgICAgICByZXR1cm4gdGhpcy5zYW1wbGVHcmlkV2l0aFRyYW5zZm9ybShpbWFnZSwgZGltZW5zaW9uWCwgZGltZW5zaW9uWSwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBEZWZhdWx0R3JpZFNhbXBsZXIucHJvdG90eXBlLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtID0gZnVuY3Rpb24gKGltYWdlLCBkaW1lbnNpb25YIC8qaW50Ki8sIGRpbWVuc2lvblkgLyppbnQqLywgdHJhbnNmb3JtKSB7CgkgICAgICAgIGlmIChkaW1lbnNpb25YIDw9IDAgfHwgZGltZW5zaW9uWSA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQ0LmRlZmF1bHQoKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMSQxLmRlZmF1bHQoZGltZW5zaW9uWCwgZGltZW5zaW9uWSk7CgkgICAgICAgIHZhciBwb2ludHMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiBkaW1lbnNpb25YKTsKCSAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBkaW1lbnNpb25ZOyB5KyspIHsKCSAgICAgICAgICAgIHZhciBtYXggPSBwb2ludHMubGVuZ3RoOwoJICAgICAgICAgICAgdmFyIGlWYWx1ZSA9IHkgKyAwLjU7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1heDsgeCArPSAyKSB7CgkgICAgICAgICAgICAgICAgcG9pbnRzW3hdID0gKHggLyAyKSArIDAuNTsKCSAgICAgICAgICAgICAgICBwb2ludHNbeCArIDFdID0gaVZhbHVlOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgdHJhbnNmb3JtLnRyYW5zZm9ybVBvaW50cyhwb2ludHMpOwoJICAgICAgICAgICAgLy8gUXVpY2sgY2hlY2sgdG8gc2VlIGlmIHBvaW50cyB0cmFuc2Zvcm1lZCB0byBzb21ldGhpbmcgaW5zaWRlIHRoZSBpbWFnZQoJICAgICAgICAgICAgLy8gc3VmZmljaWVudCB0byBjaGVjayB0aGUgZW5kcG9pbnRzCgkgICAgICAgICAgICBHcmlkU2FtcGxlcl8xLmRlZmF1bHQuY2hlY2tBbmROdWRnZVBvaW50cyhpbWFnZSwgcG9pbnRzKTsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXg7IHggKz0gMikgewoJICAgICAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KE1hdGguZmxvb3IocG9pbnRzW3hdKSwgTWF0aC5mbG9vcihwb2ludHNbeCArIDFdKSkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJsYWNrKC1pc2gpIHBpeGVsCgkgICAgICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4IC8gMiwgeSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoYWlvb2JlIC8qOiBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24qLykgewoJICAgICAgICAgICAgICAgIC8vIFRoaXMgZmVlbHMgd3JvbmcsIGJ1dCwgc29tZXRpbWVzIGlmIHRoZSBmaW5kZXIgcGF0dGVybnMgYXJlIG1pc2lkZW50aWZpZWQsIHRoZSByZXN1bHRpbmcKCSAgICAgICAgICAgICAgICAvLyB0cmFuc2Zvcm0gZ2V0cyAidHdpc3RlZCIgc3VjaCB0aGF0IGl0IG1hcHMgYSBzdHJhaWdodCBsaW5lIG9mIHBvaW50cyB0byBhIHNldCBvZiBwb2ludHMKCSAgICAgICAgICAgICAgICAvLyB3aG9zZSBlbmRwb2ludHMgYXJlIGluIGJvdW5kcywgYnV0IG90aGVycyBhcmUgbm90LiBUaGVyZSBpcyBwcm9iYWJseSBzb21lIG1hdGhlbWF0aWNhbAoJICAgICAgICAgICAgICAgIC8vIHdheSB0byBkZXRlY3QgdGhpcyBhYm91dCB0aGUgdHJhbnNmb3JtYXRpb24gdGhhdCBJIGRvbid0IGtub3cgeWV0LgoJICAgICAgICAgICAgICAgIC8vIFRoaXMgcmVzdWx0cyBpbiBhbiB1Z2x5IHJ1bnRpbWUgZXhjZXB0aW9uIGRlc3BpdGUgb3VyIGNsZXZlciBjaGVja3MgYWJvdmUgLS0gY2FuJ3QgaGF2ZQoJICAgICAgICAgICAgICAgIC8vIHRoYXQuIFdlIGNvdWxkIGNoZWNrIGVhY2ggcG9pbnQncyBjb29yZGluYXRlcyBidXQgdGhhdCBmZWVscyBkdXBsaWNhdGl2ZS4gV2Ugc2V0dGxlIGZvcgoJICAgICAgICAgICAgICAgIC8vIGNhdGNoaW5nIGFuZCB3cmFwcGluZyBBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24uCgkgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkNC5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICByZXR1cm4gRGVmYXVsdEdyaWRTYW1wbGVyOwoJfShHcmlkU2FtcGxlcl8xLmRlZmF1bHQpKTsKCURlZmF1bHRHcmlkU2FtcGxlciQxLmRlZmF1bHQgPSBEZWZhdWx0R3JpZFNhbXBsZXI7CgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEdyaWRTYW1wbGVySW5zdGFuY2UkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIERlZmF1bHRHcmlkU2FtcGxlcl8xID0gRGVmYXVsdEdyaWRTYW1wbGVyJDE7Cgl2YXIgR3JpZFNhbXBsZXJJbnN0YW5jZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBHcmlkU2FtcGxlckluc3RhbmNlKCkgewoJICAgIH0KCSAgICAvKioKCSAgICAgKiBTZXRzIHRoZSBpbXBsZW1lbnRhdGlvbiBvZiBHcmlkU2FtcGxlciB1c2VkIGJ5IHRoZSBsaWJyYXJ5LiBPbmUgZ2xvYmFsCgkgICAgICogaW5zdGFuY2UgaXMgc3RvcmVkLCB3aGljaCBtYXkgc291bmQgcHJvYmxlbWF0aWMuIEJ1dCwgdGhlIGltcGxlbWVudGF0aW9uIHByb3ZpZGVkCgkgICAgICogb3VnaHQgdG8gYmUgYXBwcm9wcmlhdGUgZm9yIHRoZSBlbnRpcmUgcGxhdGZvcm0sIGFuZCBhbGwgdXNlcyBvZiB0aGlzIGxpYnJhcnkKCSAgICAgKiBpbiB0aGUgd2hvbGUgbGlmZXRpbWUgb2YgdGhlIEpWTS4gRm9yIGluc3RhbmNlLCBhbiBBbmRyb2lkIGFjdGl2aXR5IGNhbiBzd2FwIGluCgkgICAgICogYW4gaW1wbGVtZW50YXRpb24gdGhhdCB0YWtlcyBhZHZhbnRhZ2Ugb2YgbmF0aXZlIHBsYXRmb3JtIGxpYnJhcmllcy4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBuZXdHcmlkU2FtcGxlciBUaGUgcGxhdGZvcm0tc3BlY2lmaWMgb2JqZWN0IHRvIGluc3RhbGwuCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5zZXRHcmlkU2FtcGxlciA9IGZ1bmN0aW9uIChuZXdHcmlkU2FtcGxlcikgewoJICAgICAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3R3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIG9mIEdyaWRTYW1wbGVyCgkgICAgICovCgkgICAgR3JpZFNhbXBsZXJJbnN0YW5jZS5nZXRJbnN0YW5jZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIEdyaWRTYW1wbGVySW5zdGFuY2UuZ3JpZFNhbXBsZXI7CgkgICAgfTsKCSAgICBHcmlkU2FtcGxlckluc3RhbmNlLmdyaWRTYW1wbGVyID0gbmV3IERlZmF1bHRHcmlkU2FtcGxlcl8xLmRlZmF1bHQoKTsKCSAgICByZXR1cm4gR3JpZFNhbXBsZXJJbnN0YW5jZTsKCX0oKSk7CglHcmlkU2FtcGxlckluc3RhbmNlJDEuZGVmYXVsdCA9IEdyaWRTYW1wbGVySW5zdGFuY2U7CgoJdmFyIFJlc3VsdFBvaW50JDEgPSB7fTsKCgl2YXIgRmxvYXQkMSA9IHt9OwoKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShGbG9hdCQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKioKCSAqIFBvbnlmaWxsIGZvciBKYXZhJ3MgRmxvYXQgY2xhc3MuCgkgKi8KCXZhciBGbG9hdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBGbG9hdCgpIHsKCSAgICB9CgkgICAgLyoqCgkgICAgICogU2luY1RTIGhhcyBubyBkaWZmZXJlbmNlIGJldHdlZW4gaW50IGFuZCBmbG9hdCwgdGhlcmUncyBhbGwgbnVtYmVycywKCSAgICAgKiB0aGlzIGlzIHVzZWQgb25seSB0byBwb2x5ZmlsbCBKYXZhIGNvZGUuCgkgICAgICovCgkgICAgRmxvYXQuZmxvYXRUb0ludEJpdHMgPSBmdW5jdGlvbiAoZikgewoJICAgICAgICByZXR1cm4gZjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFRoZSBmbG9hdCBtYXggdmFsdWUgaW4gSlMgaXMgdGhlIG51bWJlciBtYXggdmFsdWUuCgkgICAgICovCgkgICAgRmxvYXQuTUFYX1ZBTFVFID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CgkgICAgcmV0dXJuIEZsb2F0OwoJfSgpKTsKCUZsb2F0JDEuZGVmYXVsdCA9IEZsb2F0OwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVzdWx0UG9pbnQkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZyB7Ki8KCXZhciBNYXRoVXRpbHNfMSQxID0gTWF0aFV0aWxzJDE7Cgl2YXIgRmxvYXRfMSA9IEZsb2F0JDE7CgkvKioKCSAqIDxwPkVuY2Fwc3VsYXRlcyBhIHBvaW50IG9mIGludGVyZXN0IGluIGFuIGltYWdlIGNvbnRhaW5pbmcgYSBiYXJjb2RlLiBUeXBpY2FsbHksIHRoaXMKCSAqIHdvdWxkIGJlIHRoZSBsb2NhdGlvbiBvZiBhIGZpbmRlciBwYXR0ZXJuIG9yIHRoZSBjb3JuZXIgb2YgdGhlIGJhcmNvZGUsIGZvciBleGFtcGxlLjwvcD4KCSAqCgkgKiBAYXV0aG9yIFNlYW4gT3dlbgoJICovCgl2YXIgUmVzdWx0UG9pbnQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgZnVuY3Rpb24gUmVzdWx0UG9pbnQoeCwgeSkgewoJICAgICAgICB0aGlzLnggPSB4OwoJICAgICAgICB0aGlzLnkgPSB5OwoJICAgIH0KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUuZ2V0WCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMueDsKCSAgICB9OwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5nZXRZID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy55OwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHsKCSAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgUmVzdWx0UG9pbnQpIHsKCSAgICAgICAgICAgIHZhciBvdGhlclBvaW50ID0gb3RoZXI7CgkgICAgICAgICAgICByZXR1cm4gdGhpcy54ID09PSBvdGhlclBvaW50LnggJiYgdGhpcy55ID09PSBvdGhlclBvaW50Lnk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIFJlc3VsdFBvaW50LnByb3RvdHlwZS5oYXNoQ29kZSA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIDMxICogRmxvYXRfMS5kZWZhdWx0LmZsb2F0VG9JbnRCaXRzKHRoaXMueCkgKyBGbG9hdF8xLmRlZmF1bHQuZmxvYXRUb0ludEJpdHModGhpcy55KTsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBSZXN1bHRQb2ludC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiAnKCcgKyB0aGlzLnggKyAnLCcgKyB0aGlzLnkgKyAnKSc7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBPcmRlcnMgYW4gYXJyYXkgb2YgdGhyZWUgUmVzdWx0UG9pbnRzIGluIGFuIG9yZGVyIFtBLEIsQ10gc3VjaCB0aGF0IEFCIGlzIGxlc3MgdGhhbiBBQwoJICAgICAqIGFuZCBCQyBpcyBsZXNzIHRoYW4gQUMsIGFuZCB0aGUgYW5nbGUgYmV0d2VlbiBCQyBhbmQgQkEgaXMgbGVzcyB0aGFuIDE4MCBkZWdyZWVzLgoJICAgICAqCgkgICAgICogQHBhcmFtIHBhdHRlcm5zIGFycmF5IG9mIHRocmVlIHtAY29kZSBSZXN1bHRQb2ludH0gdG8gb3JkZXIKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5vcmRlckJlc3RQYXR0ZXJucyA9IGZ1bmN0aW9uIChwYXR0ZXJucykgewoJICAgICAgICAvLyBGaW5kIGRpc3RhbmNlcyBiZXR3ZWVuIHBhdHRlcm4gY2VudGVycwoJICAgICAgICB2YXIgemVyb09uZURpc3RhbmNlID0gdGhpcy5kaXN0YW5jZShwYXR0ZXJuc1swXSwgcGF0dGVybnNbMV0pOwoJICAgICAgICB2YXIgb25lVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzFdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciB6ZXJvVHdvRGlzdGFuY2UgPSB0aGlzLmRpc3RhbmNlKHBhdHRlcm5zWzBdLCBwYXR0ZXJuc1syXSk7CgkgICAgICAgIHZhciBwb2ludEE7CgkgICAgICAgIHZhciBwb2ludEI7CgkgICAgICAgIHZhciBwb2ludEM7CgkgICAgICAgIC8vIEFzc3VtZSBvbmUgY2xvc2VzdCB0byBvdGhlciB0d28gaXMgQjsgQSBhbmQgQyB3aWxsIGp1c3QgYmUgZ3Vlc3NlcyBhdCBmaXJzdAoJICAgICAgICBpZiAob25lVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlICYmIG9uZVR3b0Rpc3RhbmNlID49IHplcm9Ud29EaXN0YW5jZSkgewoJICAgICAgICAgICAgcG9pbnRCID0gcGF0dGVybnNbMF07CgkgICAgICAgICAgICBwb2ludEEgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QyA9IHBhdHRlcm5zWzJdOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgaWYgKHplcm9Ud29EaXN0YW5jZSA+PSBvbmVUd29EaXN0YW5jZSAmJiB6ZXJvVHdvRGlzdGFuY2UgPj0gemVyb09uZURpc3RhbmNlKSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1sxXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMl07CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICBwb2ludEIgPSBwYXR0ZXJuc1syXTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBhdHRlcm5zWzBdOwoJICAgICAgICAgICAgcG9pbnRDID0gcGF0dGVybnNbMV07CgkgICAgICAgIH0KCSAgICAgICAgLy8gVXNlIGNyb3NzIHByb2R1Y3QgdG8gZmlndXJlIG91dCB3aGV0aGVyIEEgYW5kIEMgYXJlIGNvcnJlY3Qgb3IgZmxpcHBlZC4KCSAgICAgICAgLy8gVGhpcyBhc2tzIHdoZXRoZXIgQkMgeCBCQSBoYXMgYSBwb3NpdGl2ZSB6IGNvbXBvbmVudCwgd2hpY2ggaXMgdGhlIGFycmFuZ2VtZW50CgkgICAgICAgIC8vIHdlIHdhbnQgZm9yIEEsIEIsIEMuIElmIGl0J3MgbmVnYXRpdmUsIHRoZW4gd2UndmUgZ290IGl0IGZsaXBwZWQgYXJvdW5kIGFuZAoJICAgICAgICAvLyBzaG91bGQgc3dhcCBBIGFuZCBDLgoJICAgICAgICBpZiAodGhpcy5jcm9zc1Byb2R1Y3RaKHBvaW50QSwgcG9pbnRCLCBwb2ludEMpIDwgMC4wKSB7CgkgICAgICAgICAgICB2YXIgdGVtcCA9IHBvaW50QTsKCSAgICAgICAgICAgIHBvaW50QSA9IHBvaW50QzsKCSAgICAgICAgICAgIHBvaW50QyA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgcGF0dGVybnNbMF0gPSBwb2ludEE7CgkgICAgICAgIHBhdHRlcm5zWzFdID0gcG9pbnRCOwoJICAgICAgICBwYXR0ZXJuc1syXSA9IHBvaW50QzsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEBwYXJhbSBwYXR0ZXJuMSBmaXJzdCBwYXR0ZXJuCgkgICAgICogQHBhcmFtIHBhdHRlcm4yIHNlY29uZCBwYXR0ZXJuCgkgICAgICogQHJldHVybiBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwb2ludHMKCSAgICAgKi8KCSAgICBSZXN1bHRQb2ludC5kaXN0YW5jZSA9IGZ1bmN0aW9uIChwYXR0ZXJuMSwgcGF0dGVybjIpIHsKCSAgICAgICAgcmV0dXJuIE1hdGhVdGlsc18xJDEuZGVmYXVsdC5kaXN0YW5jZShwYXR0ZXJuMS54LCBwYXR0ZXJuMS55LCBwYXR0ZXJuMi54LCBwYXR0ZXJuMi55KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIFJldHVybnMgdGhlIHogY29tcG9uZW50IG9mIHRoZSBjcm9zcyBwcm9kdWN0IGJldHdlZW4gdmVjdG9ycyBCQyBhbmQgQkEuCgkgICAgICovCgkgICAgUmVzdWx0UG9pbnQuY3Jvc3NQcm9kdWN0WiA9IGZ1bmN0aW9uIChwb2ludEEsIHBvaW50QiwgcG9pbnRDKSB7CgkgICAgICAgIHZhciBiWCA9IHBvaW50Qi54OwoJICAgICAgICB2YXIgYlkgPSBwb2ludEIueTsKCSAgICAgICAgcmV0dXJuICgocG9pbnRDLnggLSBiWCkgKiAocG9pbnRBLnkgLSBiWSkpIC0gKChwb2ludEMueSAtIGJZKSAqIChwb2ludEEueCAtIGJYKSk7CgkgICAgfTsKCSAgICByZXR1cm4gUmVzdWx0UG9pbnQ7Cgl9KCkpOwoJUmVzdWx0UG9pbnQkMS5kZWZhdWx0ID0gUmVzdWx0UG9pbnQ7CgoJdmFyIEFsaWdubWVudFBhdHRlcm5GaW5kZXIkMSA9IHt9OwoKCXZhciBBbGlnbm1lbnRQYXR0ZXJuJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fZXh0ZW5kcyQxID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHsKCSAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwKCSAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHwKCSAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9OwoJICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTsKCSAgICB9OwoJICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikgewoJICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH0KCSAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpOwoJICAgIH07Cgl9KSgpOwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEFsaWdubWVudFBhdHRlcm4kMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgUmVzdWx0UG9pbnRfMSQzID0gUmVzdWx0UG9pbnQkMTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGFuIGFsaWdubWVudCBwYXR0ZXJuLCB3aGljaCBhcmUgdGhlIHNtYWxsZXIgc3F1YXJlIHBhdHRlcm5zIGZvdW5kIGluCgkgKiBhbGwgYnV0IHRoZSBzaW1wbGVzdCBRUiBDb2Rlcy48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEFsaWdubWVudFBhdHRlcm4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7CgkgICAgX19leHRlbmRzJDEoQWxpZ25tZW50UGF0dGVybiwgX3N1cGVyKTsKCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIHJldHVybiBfdGhpczsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZXJtaW5lcyBpZiB0aGlzIGFsaWdubWVudCBwYXR0ZXJuICJhYm91dCBlcXVhbHMiIGFuIGFsaWdubWVudCBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhbiBhdmVyYWdlIG9mIHRoZSB0d28uCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybi5wcm90b3R5cGUuY29tYmluZUVzdGltYXRlID0gZnVuY3Rpb24gKGkgLypmbG9hdCovLCBqIC8qZmxvYXQqLywgbmV3TW9kdWxlU2l6ZSAvKmZsb2F0Ki8pIHsKCSAgICAgICAgdmFyIGNvbWJpbmVkWCA9ICh0aGlzLmdldFgoKSArIGopIC8gMi4wOwoJICAgICAgICB2YXIgY29tYmluZWRZID0gKHRoaXMuZ2V0WSgpICsgaSkgLyAyLjA7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplICsgbmV3TW9kdWxlU2l6ZSkgLyAyLjA7CgkgICAgICAgIHJldHVybiBuZXcgQWxpZ25tZW50UGF0dGVybihjb21iaW5lZFgsIGNvbWJpbmVkWSwgY29tYmluZWRNb2R1bGVTaXplKTsKCSAgICB9OwoJICAgIHJldHVybiBBbGlnbm1lbnRQYXR0ZXJuOwoJfShSZXN1bHRQb2ludF8xJDMuZGVmYXVsdCkpOwoJQWxpZ25tZW50UGF0dGVybiQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgX192YWx1ZXMkMSA9IChjb21tb25qc0dsb2JhbCAmJiBjb21tb25qc0dsb2JhbC5fX3ZhbHVlcykgfHwgZnVuY3Rpb24obykgewoJICAgIHZhciBzID0gdHlwZW9mIFN5bWJvbCA9PT0gImZ1bmN0aW9uIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwOwoJICAgIGlmIChtKSByZXR1cm4gbS5jYWxsKG8pOwoJICAgIGlmIChvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHJldHVybiB7CgkgICAgICAgIG5leHQ6IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CgkgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogbyAmJiBvW2krK10sIGRvbmU6ICFvIH07CgkgICAgICAgIH0KCSAgICB9OwoJICAgIHRocm93IG5ldyBUeXBlRXJyb3IocyA/ICJPYmplY3QgaXMgbm90IGl0ZXJhYmxlLiIgOiAiU3ltYm9sLml0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLiIpOwoJfTsKCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuXzEgPSBBbGlnbm1lbnRQYXR0ZXJuJDE7Cgl2YXIgTm90Rm91bmRFeGNlcHRpb25fMSQzID0gTm90Rm91bmRFeGNlcHRpb24kMTsKCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBhbGlnbm1lbnQgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBBbGlnbm1lbnQgcGF0dGVybnMgbG9vayBsaWtlIGZpbmRlcgoJICogcGF0dGVybnMgYnV0IGFyZSBzbWFsbGVyIGFuZCBhcHBlYXIgYXQgcmVndWxhciBpbnRlcnZhbHMgdGhyb3VnaG91dCB0aGUgaW1hZ2UuPC9wPgoJICoKCSAqIDxwPkF0IHRoZSBtb21lbnQgdGhpcyBvbmx5IGxvb2tzIGZvciB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAqCgkgKiA8cD5UaGlzIGlzIG1vc3RseSBhIHNpbXBsaWZpZWQgY29weSBvZiB7QGxpbmsgRmluZGVyUGF0dGVybkZpbmRlcn0uIEl0IGlzIGNvcGllZCwKCSAqIHBhc3RlZCBhbmQgc3RyaXBwZWQgZG93biBoZXJlIGZvciBtYXhpbXVtIHBlcmZvcm1hbmNlIGJ1dCBkb2VzIHVuZm9ydHVuYXRlbHkgZHVwbGljYXRlCgkgKiBzb21lIGNvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIC8qKgoJICAgICAqIDxwPkNyZWF0ZXMgYSBmaW5kZXIgdGhhdCB3aWxsIGxvb2sgaW4gYSBwb3J0aW9uIG9mIHRoZSB3aG9sZSBpbWFnZS48L3A+CgkgICAgICoKCSAgICAgKiBAcGFyYW0gaW1hZ2UgaW1hZ2UgdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIHN0YXJ0WCBsZWZ0IGNvbHVtbiBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSBzdGFydFkgdG9wIHJvdyBmcm9tIHdoaWNoIHRvIHN0YXJ0IHNlYXJjaGluZwoJICAgICAqIEBwYXJhbSB3aWR0aCB3aWR0aCBvZiByZWdpb24gdG8gc2VhcmNoCgkgICAgICogQHBhcmFtIGhlaWdodCBoZWlnaHQgb2YgcmVnaW9uIHRvIHNlYXJjaAoJICAgICAqIEBwYXJhbSBtb2R1bGVTaXplIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBzbyBmYXIKCSAgICAgKi8KCSAgICBmdW5jdGlvbiBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyKGltYWdlLCBzdGFydFggLyppbnQqLywgc3RhcnRZIC8qaW50Ki8sIHdpZHRoIC8qaW50Ki8sIGhlaWdodCAvKmludCovLCBtb2R1bGVTaXplIC8qZmxvYXQqLywgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMuc3RhcnRYID0gc3RhcnRYOwoJICAgICAgICB0aGlzLnN0YXJ0WSA9IHN0YXJ0WTsKCSAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwoJICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKCSAgICAgICAgdGhpcy5tb2R1bGVTaXplID0gbW9kdWxlU2l6ZTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICAgICAgdGhpcy5wb3NzaWJsZUNlbnRlcnMgPSBbXTsgLy8gbmV3IEFycmF5PGFueT4oNSkpCgkgICAgICAgIC8vIFRZUEVTQ1JJUFRQT1JUOiBhcnJheSBpbml0aWFsaXphdGlvbiB3aXRob3V0IHNpemUgYXMgdGhlIGxlbmd0aCBpcyBjaGVja2VkIGJlbG93CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSgzKTsKCSAgICB9CgkgICAgLyoqCgkgICAgICogPHA+VGhpcyBtZXRob2QgYXR0ZW1wdHMgdG8gZmluZCB0aGUgYm90dG9tLXJpZ2h0IGFsaWdubWVudCBwYXR0ZXJuIGluIHRoZSBpbWFnZS4gSXQgaXMgYSBiaXQgbWVzc3kgc2luY2UKCSAgICAgKiBpdCdzIHByZXR0eSBwZXJmb3JtYW5jZS1jcml0aWNhbCBhbmQgc28gaXMgd3JpdHRlbiB0byBiZSBmYXN0IGZvcmVtb3N0LjwvcD4KCSAgICAgKgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBub3QgZm91bmQKCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgc3RhcnRYID0gdGhpcy5zdGFydFg7CgkgICAgICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodDsKCSAgICAgICAgdmFyIHdpZHRoID0gdGhpcy53aWR0aDsKCSAgICAgICAgdmFyIG1heEogPSBzdGFydFggKyB3aWR0aDsKCSAgICAgICAgdmFyIG1pZGRsZUkgPSB0aGlzLnN0YXJ0WSArIChoZWlnaHQgLyAyKTsKCSAgICAgICAgLy8gV2UgYXJlIGxvb2tpbmcgZm9yIGJsYWNrL3doaXRlL2JsYWNrIG1vZHVsZXMgaW4gMToxOjEgcmF0aW8KCSAgICAgICAgLy8gdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIHNlZW4gc28gZmFyCgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoMyk7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIGZvciAodmFyIGlHZW4gPSAwOyBpR2VuIDwgaGVpZ2h0OyBpR2VuKyspIHsKCSAgICAgICAgICAgIC8vIFNlYXJjaCBmcm9tIG1pZGRsZSBvdXR3YXJkcwoJICAgICAgICAgICAgdmFyIGkgPSBtaWRkbGVJICsgKChpR2VuICYgMHgwMSkgPT09IDAgPyBNYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSA6IC1NYXRoLmZsb29yKChpR2VuICsgMSkgLyAyKSk7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICB2YXIgaiA9IHN0YXJ0WDsKCSAgICAgICAgICAgIC8vIEJ1cm4gb2ZmIGxlYWRpbmcgd2hpdGUgcGl4ZWxzIGJlZm9yZSBhbnl0aGluZyBlbHNlOyBpZiB3ZSBzdGFydCBpbiB0aGUgbWlkZGxlIG9mCgkgICAgICAgICAgICAvLyBhIHdoaXRlIHJ1biwgaXQgZG9lc24ndCBtYWtlIHNlbnNlIHRvIGNvdW50IGl0cyBsZW5ndGgsIHNpbmNlIHdlIGRvbid0IGtub3cgaWYgdGhlCgkgICAgICAgICAgICAvLyB3aGl0ZSBydW4gY29udGludWVkIHRvIHRoZSBsZWZ0IG9mIHRoZSBzdGFydCBwb2ludAoJICAgICAgICAgICAgd2hpbGUgKGogPCBtYXhKICYmICFpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gMDsKCSAgICAgICAgICAgIHdoaWxlIChqIDwgbWF4SikgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMV0rKzsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy8gQ291bnRpbmcgd2hpdGUgcGl4ZWxzCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAyKSB7IC8vIEEgd2lubmVyPwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmZvdW5kUGF0dGVybkNyb3NzKHN0YXRlQ291bnQpKSB7IC8vIFllcwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBqKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCAhPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gc3RhdGVDb3VudFsyXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gMTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsrK2N1cnJlbnRTdGF0ZV0rKzsKCSAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMSkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBqKys7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBpZiAodGhpcy5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSkgewoJICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIG1heEopOwoJICAgICAgICAgICAgICAgIGlmIChjb25maXJtZWQgIT09IG51bGwpIHsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpcm1lZDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgLy8gSG1tLCBub3RoaW5nIHdlIHNhdyB3YXMgb2JzZXJ2ZWQgYW5kIGNvbmZpcm1lZCB0d2ljZS4gSWYgd2UgaGFkCgkgICAgICAgIC8vIGFueSBndWVzcyBhdCBhbGwsIHJldHVybiBpdC4KCSAgICAgICAgaWYgKHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aCAhPT0gMCkgewoJICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zc2libGVDZW50ZXJzWzBdOwoJICAgICAgICB9CgkgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDMuZGVmYXVsdCgpOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogR2l2ZW4gYSBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCBzZWVuIGFuZCBhbiBlbmQgcG9zaXRpb24sCgkgICAgICogZmlndXJlcyB0aGUgbG9jYXRpb24gb2YgdGhlIGNlbnRlciBvZiB0aGlzIGJsYWNrL3doaXRlL2JsYWNrIHJ1bi4KCSAgICAgKi8KCSAgICBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCwgZW5kIC8qaW50Ki8pIHsKCSAgICAgICAgcmV0dXJuIChlbmQgLSBzdGF0ZUNvdW50WzJdKSAtIHN0YXRlQ291bnRbMV0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8xIHJhdGlvcwoJICAgICAqICAgICAgICAgdXNlZCBieSBhbGlnbm1lbnQgcGF0dGVybnMgdG8gYmUgY29uc2lkZXJlZCBhIG1hdGNoCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMubW9kdWxlU2l6ZTsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAzOyBpKyspIHsKCSAgICAgICAgICAgIGlmIChNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFtpXSkgPj0gbWF4VmFyaWFuY2UpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5BZnRlciBhIGhvcml6b250YWwgc2NhbiBmaW5kcyBhIHBvdGVudGlhbCBhbGlnbm1lbnQgcGF0dGVybiwgdGhpcyBtZXRob2QKCSAgICAgKiAiY3Jvc3MtY2hlY2tzIiBieSBzY2FubmluZyBkb3duIHZlcnRpY2FsbHkgdGhyb3VnaCB0aGUgY2VudGVyIG9mIHRoZSBwb3NzaWJsZQoJICAgICAqIGFsaWdubWVudCBwYXR0ZXJuIHRvIHNlZSBpZiB0aGUgc2FtZSBwcm9wb3J0aW9uIGlzIGRldGVjdGVkLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGFydEkgcm93IHdoZXJlIGFuIGFsaWdubWVudCBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYW4gYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBhbGlnbm1lbnQgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgQWxpZ25tZW50UGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAvLyBTdGFydCBjb3VudGluZyB1cCBmcm9tIGNlbnRlcgoJICAgICAgICB2YXIgaSA9IHN0YXJ0STsKCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbMF0gPD0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMF0rKzsKCSAgICAgICAgICAgIGktLTsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFswXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIC8vIE5vdyBhbHNvIGNvdW50IGRvd24gZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IHN0YXJ0SSArIDE7CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbMV0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA8IG1heEkgJiYgIWltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzJdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzJdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMl0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSAyICogb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRoaXMuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkgPyBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaSkgOiBOYU47CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5UaGlzIGlzIGNhbGxlZCB3aGVuIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4uIEl0IHdpbGwKCSAgICAgKiBjcm9zcyBjaGVjayB3aXRoIGEgdmVydGljYWwgc2NhbiwgYW5kIGlmIHN1Y2Nlc3NmdWwsIHdpbGwgc2VlIGlmIHRoaXMgcGF0dGVybiBoYWQgYmVlbgoJICAgICAqIGZvdW5kIG9uIGEgcHJldmlvdXMgaG9yaXpvbnRhbCBzY2FuLiBJZiBzbywgd2UgY29uc2lkZXIgaXQgY29uZmlybWVkIGFuZCBjb25jbHVkZSB3ZSBoYXZlCgkgICAgICogZm91bmQgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBzdGF0ZUNvdW50IHJlYWRpbmcgc3RhdGUgbW9kdWxlIGNvdW50cyBmcm9tIGhvcml6b250YWwgc2NhbgoJICAgICAqIEBwYXJhbSBpIHJvdyB3aGVyZSBhbGlnbm1lbnQgcGF0dGVybiBtYXkgYmUgZm91bmQKCSAgICAgKiBAcGFyYW0gaiBlbmQgb2YgcG9zc2libGUgYWxpZ25tZW50IHBhdHRlcm4gaW4gcm93CgkgICAgICogQHJldHVybiB7QGxpbmsgQWxpZ25tZW50UGF0dGVybn0gaWYgd2UgaGF2ZSBmb3VuZCB0aGUgc2FtZSBwYXR0ZXJuIHR3aWNlLCBvciBudWxsIGlmIG5vdAoJICAgICAqLwoJICAgIEFsaWdubWVudFBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmhhbmRsZVBvc3NpYmxlQ2VudGVyID0gZnVuY3Rpb24gKHN0YXRlQ291bnQsIGkgLyppbnQqLywgaiAvKmludCovKSB7CgkgICAgICAgIHZhciBlXzEsIF9hOwoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdOwoJICAgICAgICB2YXIgY2VudGVySiA9IEFsaWdubWVudFBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKTsKCSAgICAgICAgdmFyIGNlbnRlckkgPSB0aGlzLmNyb3NzQ2hlY2tWZXJ0aWNhbChpLCAvKihpbnQpICovIGNlbnRlckosIDIgKiBzdGF0ZUNvdW50WzFdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IChzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0pIC8gMy4wOwoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBmb3IgKHZhciBfYiA9IF9fdmFsdWVzJDEodGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgICAgIHZhciBjZW50ZXIgPSBfYy52YWx1ZTsKCSAgICAgICAgICAgICAgICAgICAgLy8gTG9vayBmb3IgYWJvdXQgdGhlIHNhbWUgY2VudGVyIGFuZCBtb2R1bGUgc2l6ZToKCSAgICAgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5hYm91dEVxdWFscyhlc3RpbWF0ZWRNb2R1bGVTaXplLCBjZW50ZXJJLCBjZW50ZXJKKSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbnRlci5jb21iaW5lRXN0aW1hdGUoY2VudGVySSwgY2VudGVySiwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBjYXRjaCAoZV8xXzEpIHsgZV8xID0geyBlcnJvcjogZV8xXzEgfTsgfQoJICAgICAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKF9jICYmICFfYy5kb25lICYmIChfYSA9IF9iLnJldHVybikpIF9hLmNhbGwoX2IpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAvLyBIYWRuJ3QgZm91bmQgdGhpcyBiZWZvcmU7IHNhdmUgaXQKCSAgICAgICAgICAgIHZhciBwb2ludCA9IG5ldyBBbGlnbm1lbnRQYXR0ZXJuXzEuZGVmYXVsdChjZW50ZXJKLCBjZW50ZXJJLCBlc3RpbWF0ZWRNb2R1bGVTaXplKTsKCSAgICAgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzLnB1c2gocG9pbnQpOwoJICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjay5mb3VuZFBvc3NpYmxlUmVzdWx0UG9pbnQocG9pbnQpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBudWxsOwoJICAgIH07CgkgICAgcmV0dXJuIEFsaWdubWVudFBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJQWxpZ25tZW50UGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyOwoKCXZhciBGaW5kZXJQYXR0ZXJuRmluZGVyJDEgPSB7fTsKCgl2YXIgRmluZGVyUGF0dGVybiQxID0ge307CgoJLyoKCSAqIENvcHlyaWdodCAyMDA3IFpYaW5nIGF1dGhvcnMKCSAqCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCgkgKgoJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgkgKi8KCXZhciBfX2V4dGVuZHMgPSAoY29tbW9uanNHbG9iYWwgJiYgY29tbW9uanNHbG9iYWwuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkgewoJICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHsKCSAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fAoJICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fAoJICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07CgkgICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpOwoJICAgIH07CgkgICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7CgkgICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7CgkgICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfQoJICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7CgkgICAgfTsKCX0pKCk7CglPYmplY3QuZGVmaW5lUHJvcGVydHkoRmluZGVyUGF0dGVybiQxLCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSk7CgkvKm5hbWVzcGFjZSBjb20uZ29vZ2xlLnp4aW5nLnFyY29kZS5kZXRlY3RvciB7Ki8KCXZhciBSZXN1bHRQb2ludF8xJDIgPSBSZXN1bHRQb2ludCQxOwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgYSBmaW5kZXIgcGF0dGVybiwgd2hpY2ggYXJlIHRoZSB0aHJlZSBzcXVhcmUgcGF0dGVybnMgZm91bmQgaW4KCSAqIHRoZSBjb3JuZXJzIG9mIFFSIENvZGVzLiBJdCBhbHNvIGVuY2Fwc3VsYXRlcyBhIGNvdW50IG9mIHNpbWlsYXIgZmluZGVyIHBhdHRlcm5zLAoJICogYXMgYSBjb252ZW5pZW5jZSB0byB0aGUgZmluZGVyJ3MgYm9va2tlZXBpbmcuPC9wPgoJICoKCSAqIEBhdXRob3IgU2VhbiBPd2VuCgkgKi8KCXZhciBGaW5kZXJQYXR0ZXJuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgewoJICAgIF9fZXh0ZW5kcyhGaW5kZXJQYXR0ZXJuLCBfc3VwZXIpOwoJICAgIC8vIEZpbmRlclBhdHRlcm4ocG9zWDogbnVtYmVyLypmbG9hdCovLCBwb3NZOiBudW1iZXIvKmZsb2F0Ki8sIGVzdGltYXRlZE1vZHVsZVNpemU6IG51bWJlci8qZmxvYXQqLykgewoJICAgIC8vICAgdGhpcyhwb3NYLCBwb3NZLCBlc3RpbWF0ZWRNb2R1bGVTaXplLCAxKQoJICAgIC8vIH0KCSAgICBmdW5jdGlvbiBGaW5kZXJQYXR0ZXJuKHBvc1ggLypmbG9hdCovLCBwb3NZIC8qZmxvYXQqLywgZXN0aW1hdGVkTW9kdWxlU2l6ZSAvKmZsb2F0Ki8sIGNvdW50IC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgcG9zWCwgcG9zWSkgfHwgdGhpczsKCSAgICAgICAgX3RoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IGVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIF90aGlzLmNvdW50ID0gY291bnQ7CgkgICAgICAgIGlmICh1bmRlZmluZWQgPT09IGNvdW50KSB7CgkgICAgICAgICAgICBfdGhpcy5jb3VudCA9IDE7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIF90aGlzOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5lc3RpbWF0ZWRNb2R1bGVTaXplOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybi5wcm90b3R5cGUuZ2V0Q291bnQgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmNvdW50OwoJICAgIH07CgkgICAgLyoKCSAgICB2b2lkIGluY3JlbWVudENvdW50KCkgewoJICAgICAgdGhpcy5jb3VudCsrCgkgICAgfQoJICAgICAqLwoJICAgIC8qKgoJICAgICAqIDxwPkRldGVybWluZXMgaWYgdGhpcyBmaW5kZXIgcGF0dGVybiAiYWJvdXQgZXF1YWxzIiBhIGZpbmRlciBwYXR0ZXJuIGF0IHRoZSBzdGF0ZWQKCSAgICAgKiBwb3NpdGlvbiBhbmQgc2l6ZSAtLSBtZWFuaW5nLCBpdCBpcyBhdCBuZWFybHkgdGhlIHNhbWUgY2VudGVyIHdpdGggbmVhcmx5IHRoZSBzYW1lIHNpemUuPC9wPgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm4ucHJvdG90eXBlLmFib3V0RXF1YWxzID0gZnVuY3Rpb24gKG1vZHVsZVNpemUgLypmbG9hdCovLCBpIC8qZmxvYXQqLywgaiAvKmZsb2F0Ki8pIHsKCSAgICAgICAgaWYgKE1hdGguYWJzKGkgLSB0aGlzLmdldFkoKSkgPD0gbW9kdWxlU2l6ZSAmJiBNYXRoLmFicyhqIC0gdGhpcy5nZXRYKCkpIDw9IG1vZHVsZVNpemUpIHsKCSAgICAgICAgICAgIHZhciBtb2R1bGVTaXplRGlmZiA9IE1hdGguYWJzKG1vZHVsZVNpemUgLSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVNpemVEaWZmIDw9IDEuMCB8fCBtb2R1bGVTaXplRGlmZiA8PSB0aGlzLmVzdGltYXRlZE1vZHVsZVNpemU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQ29tYmluZXMgdGhpcyBvYmplY3QncyBjdXJyZW50IGVzdGltYXRlIG9mIGEgZmluZGVyIHBhdHRlcm4gcG9zaXRpb24gYW5kIG1vZHVsZSBzaXplCgkgICAgICogd2l0aCBhIG5ldyBlc3RpbWF0ZS4gSXQgcmV0dXJucyBhIG5ldyB7QGNvZGUgRmluZGVyUGF0dGVybn0gY29udGFpbmluZyBhIHdlaWdodGVkIGF2ZXJhZ2UKCSAgICAgKiBiYXNlZCBvbiBjb3VudC4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuLnByb3RvdHlwZS5jb21iaW5lRXN0aW1hdGUgPSBmdW5jdGlvbiAoaSAvKmZsb2F0Ki8sIGogLypmbG9hdCovLCBuZXdNb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgY29tYmluZWRDb3VudCA9IHRoaXMuY291bnQgKyAxOwoJICAgICAgICB2YXIgY29tYmluZWRYID0gKHRoaXMuY291bnQgKiB0aGlzLmdldFgoKSArIGopIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgdmFyIGNvbWJpbmVkWSA9ICh0aGlzLmNvdW50ICogdGhpcy5nZXRZKCkgKyBpKSAvIGNvbWJpbmVkQ291bnQ7CgkgICAgICAgIHZhciBjb21iaW5lZE1vZHVsZVNpemUgPSAodGhpcy5jb3VudCAqIHRoaXMuZXN0aW1hdGVkTW9kdWxlU2l6ZSArIG5ld01vZHVsZVNpemUpIC8gY29tYmluZWRDb3VudDsKCSAgICAgICAgcmV0dXJuIG5ldyBGaW5kZXJQYXR0ZXJuKGNvbWJpbmVkWCwgY29tYmluZWRZLCBjb21iaW5lZE1vZHVsZVNpemUsIGNvbWJpbmVkQ291bnQpOwoJICAgIH07CgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm47Cgl9KFJlc3VsdFBvaW50XzEkMi5kZWZhdWx0KSk7CglGaW5kZXJQYXR0ZXJuJDEuZGVmYXVsdCA9IEZpbmRlclBhdHRlcm47CgoJdmFyIEZpbmRlclBhdHRlcm5JbmZvJDEgPSB7fTsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5JbmZvJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qKgoJICogPHA+RW5jYXBzdWxhdGVzIGluZm9ybWF0aW9uIGFib3V0IGZpbmRlciBwYXR0ZXJucyBpbiBhbiBpbWFnZSwgaW5jbHVkaW5nIHRoZSBsb2NhdGlvbiBvZgoJICogdGhlIHRocmVlIGZpbmRlciBwYXR0ZXJucywgYW5kIHRoZWlyIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5JbmZvID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIEZpbmRlclBhdHRlcm5JbmZvKHBhdHRlcm5DZW50ZXJzKSB7CgkgICAgICAgIHRoaXMuYm90dG9tTGVmdCA9IHBhdHRlcm5DZW50ZXJzWzBdOwoJICAgICAgICB0aGlzLnRvcExlZnQgPSBwYXR0ZXJuQ2VudGVyc1sxXTsKCSAgICAgICAgdGhpcy50b3BSaWdodCA9IHBhdHRlcm5DZW50ZXJzWzJdOwoJICAgIH0KCSAgICBGaW5kZXJQYXR0ZXJuSW5mby5wcm90b3R5cGUuZ2V0Qm90dG9tTGVmdCA9IGZ1bmN0aW9uICgpIHsKCSAgICAgICAgcmV0dXJuIHRoaXMuYm90dG9tTGVmdDsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5JbmZvLnByb3RvdHlwZS5nZXRUb3BMZWZ0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BMZWZ0OwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkluZm8ucHJvdG90eXBlLmdldFRvcFJpZ2h0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy50b3BSaWdodDsKCSAgICB9OwoJICAgIHJldHVybiBGaW5kZXJQYXR0ZXJuSW5mbzsKCX0oKSk7CglGaW5kZXJQYXR0ZXJuSW5mbyQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuSW5mbzsKCgkvKgoJICogQ29weXJpZ2h0IDIwMDcgWlhpbmcgYXV0aG9ycwoJICoKCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgoJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkgKgoJICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCSAqCgkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCgkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCSAqLwoJdmFyIF9fdmFsdWVzID0gKGNvbW1vbmpzR2xvYmFsICYmIGNvbW1vbmpzR2xvYmFsLl9fdmFsdWVzKSB8fCBmdW5jdGlvbihvKSB7CgkgICAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwgbSA9IHMgJiYgb1tzXSwgaSA9IDA7CgkgICAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CgkgICAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKCSAgICAgICAgbmV4dDogZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgaWYgKG8gJiYgaSA+PSBvLmxlbmd0aCkgbyA9IHZvaWQgMDsKCSAgICAgICAgICAgIHJldHVybiB7IHZhbHVlOiBvICYmIG9baSsrXSwgZG9uZTogIW8gfTsKCSAgICAgICAgfQoJICAgIH07CgkgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihzID8gIk9iamVjdCBpcyBub3QgaXRlcmFibGUuIiA6ICJTeW1ib2wuaXRlcmF0b3IgaXMgbm90IGRlZmluZWQuIik7Cgl9OwoJT2JqZWN0LmRlZmluZVByb3BlcnR5KEZpbmRlclBhdHRlcm5GaW5kZXIkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJLypuYW1lc3BhY2UgY29tLmdvb2dsZS56eGluZy5xcmNvZGUuZGV0ZWN0b3IgeyovCgl2YXIgRGVjb2RlSGludFR5cGVfMSQyID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBSZXN1bHRQb2ludF8xJDEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIEZpbmRlclBhdHRlcm5fMSA9IEZpbmRlclBhdHRlcm4kMTsKCXZhciBGaW5kZXJQYXR0ZXJuSW5mb18xID0gRmluZGVyUGF0dGVybkluZm8kMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDIgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJLyppbXBvcnQgamF2YS5pby5TZXJpYWxpemFibGU7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsqLwoJLyppbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5MaXN0OyovCgkvKmltcG9ydCBqYXZhLnV0aWwuTWFwOyovCgkvKioKCSAqIDxwPlRoaXMgY2xhc3MgYXR0ZW1wdHMgdG8gZmluZCBmaW5kZXIgcGF0dGVybnMgaW4gYSBRUiBDb2RlLiBGaW5kZXIgcGF0dGVybnMgYXJlIHRoZSBzcXVhcmUKCSAqIG1hcmtlcnMgYXQgdGhyZWUgY29ybmVycyBvZiBhIFFSIENvZGUuPC9wPgoJICoKCSAqIDxwPlRoaXMgY2xhc3MgaXMgdGhyZWFkLXNhZmUgYnV0IG5vdCByZWVudHJhbnQuIEVhY2ggdGhyZWFkIG11c3QgYWxsb2NhdGUgaXRzIG93biBvYmplY3QuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIEZpbmRlclBhdHRlcm5GaW5kZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7CgkgICAgLyoqCgkgICAgICogPHA+Q3JlYXRlcyBhIGZpbmRlciB0aGF0IHdpbGwgc2VhcmNoIHRoZSBpbWFnZSBmb3IgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBpbWFnZSBpbWFnZSB0byBzZWFyY2gKCSAgICAgKi8KCSAgICAvLyBwdWJsaWMgY29uc3RydWN0b3IoaW1hZ2U6IEJpdE1hdHJpeCkgewoJICAgIC8vICAgdGhpcyhpbWFnZSwgbnVsbCkKCSAgICAvLyB9CgkgICAgZnVuY3Rpb24gRmluZGVyUGF0dGVybkZpbmRlcihpbWFnZSwgcmVzdWx0UG9pbnRDYWxsYmFjaykgewoJICAgICAgICB0aGlzLmltYWdlID0gaW1hZ2U7CgkgICAgICAgIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayA9IHJlc3VsdFBvaW50Q2FsbGJhY2s7CgkgICAgICAgIHRoaXMucG9zc2libGVDZW50ZXJzID0gW107CgkgICAgICAgIHRoaXMuY3Jvc3NDaGVja1N0YXRlQ291bnQgPSBuZXcgSW50MzJBcnJheSg1KTsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gcmVzdWx0UG9pbnRDYWxsYmFjazsKCSAgICB9CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0SW1hZ2UgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmltYWdlOwoJICAgIH07CgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuZ2V0UG9zc2libGVDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKGhpbnRzKSB7CgkgICAgICAgIHZhciB0cnlIYXJkZXIgPSAoaGludHMgIT09IG51bGwgJiYgaGludHMgIT09IHVuZGVmaW5lZCkgJiYgdW5kZWZpbmVkICE9PSBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQyLmRlZmF1bHQuVFJZX0hBUkRFUik7CgkgICAgICAgIHZhciBwdXJlQmFyY29kZSA9IChoaW50cyAhPT0gbnVsbCAmJiBoaW50cyAhPT0gdW5kZWZpbmVkKSAmJiB1bmRlZmluZWQgIT09IGhpbnRzLmdldChEZWNvZGVIaW50VHlwZV8xJDIuZGVmYXVsdC5QVVJFX0JBUkNPREUpOwoJICAgICAgICB2YXIgaW1hZ2UgPSB0aGlzLmltYWdlOwoJICAgICAgICB2YXIgbWF4SSA9IGltYWdlLmdldEhlaWdodCgpOwoJICAgICAgICB2YXIgbWF4SiA9IGltYWdlLmdldFdpZHRoKCk7CgkgICAgICAgIC8vIFdlIGFyZSBsb29raW5nIGZvciBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBtb2R1bGVzIGluCgkgICAgICAgIC8vIDE6MTozOjE6MSByYXRpbzsgdGhpcyB0cmFja3MgdGhlIG51bWJlciBvZiBzdWNoIG1vZHVsZXMgc2VlbiBzbyBmYXIKCSAgICAgICAgLy8gTGV0J3MgYXNzdW1lIHRoYXQgdGhlIG1heGltdW0gdmVyc2lvbiBRUiBDb2RlIHdlIHN1cHBvcnQgdGFrZXMgdXAgMS80IHRoZSBoZWlnaHQgb2YgdGhlCgkgICAgICAgIC8vIGltYWdlLCBhbmQgdGhlbiBhY2NvdW50IGZvciB0aGUgY2VudGVyIGJlaW5nIDMgbW9kdWxlcyBpbiBzaXplLiBUaGlzIGdpdmVzIHRoZSBzbWFsbGVzdAoJICAgICAgICAvLyBudW1iZXIgb2YgcGl4ZWxzIHRoZSBjZW50ZXIgY291bGQgYmUsIHNvIHNraXAgdGhpcyBvZnRlbi4gV2hlbiB0cnlpbmcgaGFyZGVyLCBsb29rIGZvciBhbGwKCSAgICAgICAgLy8gUVIgdmVyc2lvbnMgcmVnYXJkbGVzcyBvZiBob3cgZGVuc2UgdGhleSBhcmUuCgkgICAgICAgIHZhciBpU2tpcCA9IE1hdGguZmxvb3IoKDMgKiBtYXhJKSAvICg0ICogRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUykpOwoJICAgICAgICBpZiAoaVNraXAgPCBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQIHx8IHRyeUhhcmRlcikgewoJICAgICAgICAgICAgaVNraXAgPSBGaW5kZXJQYXR0ZXJuRmluZGVyLk1JTl9TS0lQOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkb25lID0gZmFsc2U7CgkgICAgICAgIHZhciBzdGF0ZUNvdW50ID0gbmV3IEludDMyQXJyYXkoNSk7CgkgICAgICAgIGZvciAodmFyIGkgPSBpU2tpcCAtIDE7IGkgPCBtYXhJICYmICFkb25lOyBpICs9IGlTa2lwKSB7CgkgICAgICAgICAgICAvLyBHZXQgYSByb3cgb2YgYmxhY2svd2hpdGUgdmFsdWVzCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMV0gPSAwOwoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IDA7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0gPSAwOwoJICAgICAgICAgICAgdmFyIGN1cnJlbnRTdGF0ZSA9IDA7CgkgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1heEo7IGorKykgewoJICAgICAgICAgICAgICAgIGlmIChpbWFnZS5nZXQoaiwgaSkpIHsKCSAgICAgICAgICAgICAgICAgICAgLy8gQmxhY2sgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMSkgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBlbHNlIHsgLy8gV2hpdGUgcGl4ZWwKCSAgICAgICAgICAgICAgICAgICAgaWYgKChjdXJyZW50U3RhdGUgJiAxKSA9PT0gMCkgeyAvLyBDb3VudGluZyBibGFjayBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUgPT09IDQpIHsgLy8gQSB3aW5uZXI/CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsgLy8gWWVzCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb25maXJtZWQgPSB0aGlzLmhhbmRsZVBvc3NpYmxlQ2VudGVyKHN0YXRlQ291bnQsIGksIGosIHB1cmVCYXJjb2RlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgZXhhbWluaW5nIGV2ZXJ5IG90aGVyIGxpbmUuIENoZWNraW5nIGVhY2ggbGluZSB0dXJuZWQgb3V0IHRvIGJlIHRvbwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhwZW5zaXZlIGFuZCBkaWRuJ3QgaW1wcm92ZSBwZXJmb3JtYW5jZS4KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlTa2lwID0gMjsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQgPT09IHRydWUpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcm93U2tpcCA9IHRoaXMuZmluZFJvd1NraXAoKTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocm93U2tpcCA+IHN0YXRlQ291bnRbMl0pIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2tpcCByb3dzIGJldHdlZW4gcm93IG9mIGxvd2VyIGNvbmZpcm1lZCBjZW50ZXIKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRvcCBvZiBwcmVzdW1lZCB0aGlyZCBjb25maXJtZWQgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJ1dCBiYWNrIHVwIGEgYml0IHRvIGdldCBhIGZ1bGwgY2hhbmNlIG9mIGRldGVjdGluZwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCwgZW50aXJlIHdpZHRoIG9mIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTa2lwIGJ5IHJvd1NraXAsIGJ1dCBiYWNrIG9mZiBieSBzdGF0ZUNvdW50WzJdIChzaXplIG9mIGxhc3QgY2VudGVyCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG9mIHBhdHRlcm4gd2Ugc2F3KSB0byBiZSBjb25zZXJ2YXRpdmUsIGFuZCBhbHNvIGJhY2sgb2ZmIGJ5IGlTa2lwIHdoaWNoCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzIGFib3V0IHRvIGJlIHJlLWFkZGVkCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgKz0gcm93U2tpcCAtIHN0YXRlQ291bnRbMl0gLSBpU2tpcDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IG1heEogLSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IHN0YXRlQ291bnRbM107CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzJdID0gc3RhdGVDb3VudFs0XTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAzOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgc3RhdGUgdG8gc3RhcnQgbG9va2luZyBhZ2FpbgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGUgPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzBdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsxXSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzNdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFs0XSA9IDA7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBObywgc2hpZnQgY291bnRzIGJhY2sgYnkgdHdvCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbMF0gPSBzdGF0ZUNvdW50WzJdOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzFdID0gc3RhdGVDb3VudFszXTsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVDb3VudFsyXSA9IHN0YXRlQ291bnRbNF07CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPSAxOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFN0YXRlID0gMzsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZUNvdW50WysrY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgeyAvLyBDb3VudGluZyB3aGl0ZSBwaXhlbHMKCSAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlQ291bnRbY3VycmVudFN0YXRlXSsrOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgaWYgKEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3Moc3RhdGVDb3VudCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY29uZmlybWVkID0gdGhpcy5oYW5kbGVQb3NzaWJsZUNlbnRlcihzdGF0ZUNvdW50LCBpLCBtYXhKLCBwdXJlQmFyY29kZSk7CgkgICAgICAgICAgICAgICAgaWYgKGNvbmZpcm1lZCA9PT0gdHJ1ZSkgewoJICAgICAgICAgICAgICAgICAgICBpU2tpcCA9IHN0YXRlQ291bnRbMF07CgkgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc1NraXBwZWQpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvdW5kIGEgdGhpcmQgb25lCgkgICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdGhpcy5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzKCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBhdHRlcm5JbmZvID0gdGhpcy5zZWxlY3RCZXN0UGF0dGVybnMoKTsKCSAgICAgICAgUmVzdWx0UG9pbnRfMSQxLmRlZmF1bHQub3JkZXJCZXN0UGF0dGVybnMocGF0dGVybkluZm8pOwoJICAgICAgICByZXR1cm4gbmV3IEZpbmRlclBhdHRlcm5JbmZvXzEuZGVmYXVsdChwYXR0ZXJuSW5mbyk7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBHaXZlbiBhIGNvdW50IG9mIGJsYWNrL3doaXRlL2JsYWNrL3doaXRlL2JsYWNrIHBpeGVscyBqdXN0IHNlZW4gYW5kIGFuIGVuZCBwb3NpdGlvbiwKCSAgICAgKiBmaWd1cmVzIHRoZSBsb2NhdGlvbiBvZiB0aGUgY2VudGVyIG9mIHRoaXMgcnVuLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZCA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBlbmQgLyppbnQqLykgewoJICAgICAgICByZXR1cm4gKGVuZCAtIHN0YXRlQ291bnRbNF0gLSBzdGF0ZUNvdW50WzNdKSAtIHN0YXRlQ291bnRbMl0gLyAyLjA7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcGFyYW0gc3RhdGVDb3VudCBjb3VudCBvZiBibGFjay93aGl0ZS9ibGFjay93aGl0ZS9ibGFjayBwaXhlbHMganVzdCByZWFkCgkgICAgICogQHJldHVybiB0cnVlIGlmZiB0aGUgcHJvcG9ydGlvbnMgb2YgdGhlIGNvdW50cyBpcyBjbG9zZSBlbm91Z2ggdG8gdGhlIDEvMS8zLzEvMSByYXRpb3MKCSAgICAgKiAgICAgICAgIHVzZWQgYnkgZmluZGVyIHBhdHRlcm5zIHRvIGJlIGNvbnNpZGVyZWQgYSBtYXRjaAoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuZm91bmRQYXR0ZXJuQ3Jvc3MgPSBmdW5jdGlvbiAoc3RhdGVDb3VudCkgewoJICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMDsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA1OyBpKyspIHsKCSAgICAgICAgICAgIHZhciBjb3VudCA9IHN0YXRlQ291bnRbaV07CgkgICAgICAgICAgICBpZiAoY291bnQgPT09IDApIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gY291bnQ7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHRvdGFsTW9kdWxlU2l6ZSA8IDcpIHsKCSAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIDcuMDsKCSAgICAgICAgdmFyIG1heFZhcmlhbmNlID0gbW9kdWxlU2l6ZSAvIDIuMDsKCSAgICAgICAgLy8gQWxsb3cgbGVzcyB0aGFuIDUwJSB2YXJpYW5jZSBmcm9tIDEtMS0zLTEtMSBwcm9wb3J0aW9ucwoJICAgICAgICByZXR1cm4gTWF0aC5hYnMobW9kdWxlU2l6ZSAtIHN0YXRlQ291bnRbMF0pIDwgbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzFdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicygzLjAgKiBtb2R1bGVTaXplIC0gc3RhdGVDb3VudFsyXSkgPCAzICogbWF4VmFyaWFuY2UgJiYKCSAgICAgICAgICAgIE1hdGguYWJzKG1vZHVsZVNpemUgLSBzdGF0ZUNvdW50WzNdKSA8IG1heFZhcmlhbmNlICYmCgkgICAgICAgICAgICBNYXRoLmFicyhtb2R1bGVTaXplIC0gc3RhdGVDb3VudFs0XSkgPCBtYXhWYXJpYW5jZTsKCSAgICB9OwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgY3Jvc3NDaGVja1N0YXRlQ291bnQgPSB0aGlzLmNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFswXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzFdID0gMDsKCSAgICAgICAgY3Jvc3NDaGVja1N0YXRlQ291bnRbMl0gPSAwOwoJICAgICAgICBjcm9zc0NoZWNrU3RhdGVDb3VudFszXSA9IDA7CgkgICAgICAgIGNyb3NzQ2hlY2tTdGF0ZUNvdW50WzRdID0gMDsKCSAgICAgICAgcmV0dXJuIGNyb3NzQ2hlY2tTdGF0ZUNvdW50OwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQWZ0ZXIgYSB2ZXJ0aWNhbCBhbmQgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jcm9zcy1jcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gZGlhZ29uYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuCgkgICAgICoKCSAgICAgKiBAcGFyYW0gc3RhcnRJIHJvdyB3aGVyZSBhIGZpbmRlciBwYXR0ZXJuIHdhcyBkZXRlY3RlZAoJICAgICAqIEBwYXJhbSBjZW50ZXJKIGNlbnRlciBvZiB0aGUgc2VjdGlvbiB0aGF0IGFwcGVhcnMgdG8gY3Jvc3MgYSBmaW5kZXIgcGF0dGVybgoJICAgICAqIEBwYXJhbSBtYXhDb3VudCBtYXhpbXVtIHJlYXNvbmFibGUgbnVtYmVyIG9mIG1vZHVsZXMgdGhhdCBzaG91bGQgYmUKCSAgICAgKiAgb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcGFyYW0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgVGhlIG9yaWdpbmFsIHN0YXRlIGNvdW50IHRvdGFsLgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBwcm9wb3J0aW9ucyBhcmUgd2l0aGluZyBleHBlY3RlZCBsaW1pdHMKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrRGlhZ29uYWwgPSBmdW5jdGlvbiAoc3RhcnRJIC8qaW50Ki8sIGNlbnRlckogLyppbnQqLywgbWF4Q291bnQgLyppbnQqLywgb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwgLyppbnQqLykgewoJICAgICAgICB2YXIgc3RhdGVDb3VudCA9IHRoaXMuZ2V0Q3Jvc3NDaGVja1N0YXRlQ291bnQoKTsKCSAgICAgICAgLy8gU3RhcnQgY291bnRpbmcgdXAsIGxlZnQgZnJvbSBjZW50ZXIgZmluZGluZyBibGFjayBjZW50ZXIgbWFzcwoJICAgICAgICB2YXIgaSA9IDA7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHdoaWxlIChzdGFydEkgPj0gaSAmJiBjZW50ZXJKID49IGkgJiYgaW1hZ2UuZ2V0KGNlbnRlckogLSBpLCBzdGFydEkgLSBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgPCBpIHx8IGNlbnRlckogPCBpKSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyB3aGl0ZSBzcGFjZQoJICAgICAgICB3aGlsZSAoc3RhcnRJID49IGkgJiYgY2VudGVySiA+PSBpICYmICFpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzFdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgYWxyZWFkeSB0b28gbWFueSBtb2R1bGVzIGluIHRoaXMgc3RhdGUgb3IgcmFuIG9mZiB0aGUgZWRnZToKCSAgICAgICAgaWYgKHN0YXJ0SSA8IGkgfHwgY2VudGVySiA8IGkgfHwgc3RhdGVDb3VudFsxXSA+IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQ29udGludWUgdXAsIGxlZnQgZmluZGluZyBibGFjayBib3JkZXIKCSAgICAgICAgd2hpbGUgKHN0YXJ0SSA+PSBpICYmIGNlbnRlckogPj0gaSAmJiBpbWFnZS5nZXQoY2VudGVySiAtIGksIHN0YXJ0SSAtIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdIDw9IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzBdKys7CgkgICAgICAgICAgICBpKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbMF0gPiBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHZhciBtYXhJID0gaW1hZ2UuZ2V0SGVpZ2h0KCk7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biwgcmlnaHQgZnJvbSBjZW50ZXIKCSAgICAgICAgaSA9IDE7CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgaW1hZ2UuZ2V0KGNlbnRlckogKyBpLCBzdGFydEkgKyBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIC8vIFJhbiBvZmYgdGhlIGVkZ2U/CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChzdGFydEkgKyBpIDwgbWF4SSAmJiBjZW50ZXJKICsgaSA8IG1heEogJiYgIWltYWdlLmdldChjZW50ZXJKICsgaSwgc3RhcnRJICsgaSkgJiYKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGFydEkgKyBpID49IG1heEkgfHwgY2VudGVySiArIGkgPj0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gZmFsc2U7CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKHN0YXJ0SSArIGkgPCBtYXhJICYmIGNlbnRlckogKyBpIDwgbWF4SiAmJiBpbWFnZS5nZXQoY2VudGVySiArIGksIHN0YXJ0SSArIGkpICYmCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIHdlIGZvdW5kIGEgZmluZGVyLXBhdHRlcm4tbGlrZSBzZWN0aW9uLCBidXQgaXRzIHNpemUgaXMgbW9yZSB0aGFuIDEwMCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgcmV0dXJuIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA8IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAmJgoJICAgICAgICAgICAgRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkFmdGVyIGEgaG9yaXpvbnRhbCBzY2FuIGZpbmRzIGEgcG90ZW50aWFsIGZpbmRlciBwYXR0ZXJuLCB0aGlzIG1ldGhvZAoJICAgICAqICJjcm9zcy1jaGVja3MiIGJ5IHNjYW5uaW5nIGRvd24gdmVydGljYWxseSB0aHJvdWdoIHRoZSBjZW50ZXIgb2YgdGhlIHBvc3NpYmxlCgkgICAgICogZmluZGVyIHBhdHRlcm4gdG8gc2VlIGlmIHRoZSBzYW1lIHByb3BvcnRpb24gaXMgZGV0ZWN0ZWQuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXJ0SSByb3cgd2hlcmUgYSBmaW5kZXIgcGF0dGVybiB3YXMgZGV0ZWN0ZWQKCSAgICAgKiBAcGFyYW0gY2VudGVySiBjZW50ZXIgb2YgdGhlIHNlY3Rpb24gdGhhdCBhcHBlYXJzIHRvIGNyb3NzIGEgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gbWF4Q291bnQgbWF4aW11bSByZWFzb25hYmxlIG51bWJlciBvZiBtb2R1bGVzIHRoYXQgc2hvdWxkIGJlCgkgICAgICogb2JzZXJ2ZWQgaW4gYW55IHJlYWRpbmcgc3RhdGUsIGJhc2VkIG9uIHRoZSByZXN1bHRzIG9mIHRoZSBob3Jpem9udGFsIHNjYW4KCSAgICAgKiBAcmV0dXJuIHZlcnRpY2FsIGNlbnRlciBvZiBmaW5kZXIgcGF0dGVybiwgb3Ige0BsaW5rIEZsb2F0I05hTn0gaWYgbm90IGZvdW5kCgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuY3Jvc3NDaGVja1ZlcnRpY2FsID0gZnVuY3Rpb24gKHN0YXJ0SSAvKmludCovLCBjZW50ZXJKIC8qaW50Ki8sIG1heENvdW50IC8qaW50Ki8sIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGltYWdlID0gdGhpcy5pbWFnZTsKCSAgICAgICAgdmFyIG1heEkgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIC8vIFN0YXJ0IGNvdW50aW5nIHVwIGZyb20gY2VudGVyCgkgICAgICAgIHZhciBpID0gc3RhcnRJOwoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaSA+PSAwICYmICFpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIC8vIElmIGFscmVhZHkgdG9vIG1hbnkgbW9kdWxlcyBpbiB0aGlzIHN0YXRlIG9yIHJhbiBvZmYgdGhlIGVkZ2U6CgkgICAgICAgIGlmIChpIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpbWFnZS5nZXQoY2VudGVySiwgaSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgaS0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gTm93IGFsc28gY291bnQgZG93biBmcm9tIGNlbnRlcgoJICAgICAgICBpID0gc3RhcnRJICsgMTsKCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJKSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChpIDwgbWF4SSAmJiAhaW1hZ2UuZ2V0KGNlbnRlckosIGkpICYmIHN0YXRlQ291bnRbM10gPCBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFszXSsrOwoJICAgICAgICAgICAgaSsrOwoJICAgICAgICB9CgkgICAgICAgIGlmIChpID09PSBtYXhJIHx8IHN0YXRlQ291bnRbM10gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGkgPCBtYXhJICYmIGltYWdlLmdldChjZW50ZXJKLCBpKSAmJiBzdGF0ZUNvdW50WzRdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF0rKzsKCSAgICAgICAgICAgIGkrKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoc3RhdGVDb3VudFs0XSA+PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB3ZSBmb3VuZCBhIGZpbmRlci1wYXR0ZXJuLWxpa2Ugc2VjdGlvbiwgYnV0IGl0cyBzaXplIGlzIG1vcmUgdGhhbiA0MCUgZGlmZmVyZW50IHRoYW4KCSAgICAgICAgLy8gdGhlIG9yaWdpbmFsLCBhc3N1bWUgaXQncyBhIGZhbHNlIHBvc2l0aXZlCgkgICAgICAgIHZhciBzdGF0ZUNvdW50VG90YWwgPSBzdGF0ZUNvdW50WzBdICsgc3RhdGVDb3VudFsxXSArIHN0YXRlQ291bnRbMl0gKyBzdGF0ZUNvdW50WzNdICsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbNF07CgkgICAgICAgIGlmICg1ICogTWF0aC5hYnMoc3RhdGVDb3VudFRvdGFsIC0gb3JpZ2luYWxTdGF0ZUNvdW50VG90YWwpID49IDIgKiBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBpKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkxpa2Uge0BsaW5rICNjcm9zc0NoZWNrVmVydGljYWwoaW50LCBpbnQsIGludCwgaW50KX0sIGFuZCBpbiBmYWN0IGlzIGJhc2ljYWxseSBpZGVudGljYWwsCgkgICAgICogZXhjZXB0IGl0IHJlYWRzIGhvcml6b250YWxseSBpbnN0ZWFkIG9mIHZlcnRpY2FsbHkuIFRoaXMgaXMgdXNlZCB0byBjcm9zcy1jcm9zcwoJICAgICAqIGNoZWNrIGEgdmVydGljYWwgY3Jvc3MgY2hlY2sgYW5kIGxvY2F0ZSB0aGUgcmVhbCBjZW50ZXIgb2YgdGhlIGFsaWdubWVudCBwYXR0ZXJuLjwvcD4KCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5jcm9zc0NoZWNrSG9yaXpvbnRhbCA9IGZ1bmN0aW9uIChzdGFydEogLyppbnQqLywgY2VudGVySSAvKmludCovLCBtYXhDb3VudCAvKmludCovLCBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCAvKmludCovKSB7CgkgICAgICAgIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2U7CgkgICAgICAgIHZhciBtYXhKID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHN0YXRlQ291bnQgPSB0aGlzLmdldENyb3NzQ2hlY2tTdGF0ZUNvdW50KCk7CgkgICAgICAgIHZhciBqID0gc3RhcnRKOwoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmIGltYWdlLmdldChqLCBjZW50ZXJJKSkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsyXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA+PSAwICYmICFpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFsxXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFsxXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChqIDwgMCB8fCBzdGF0ZUNvdW50WzFdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgd2hpbGUgKGogPj0gMCAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFswXSA8PSBtYXhDb3VudCkgewoJICAgICAgICAgICAgc3RhdGVDb3VudFswXSsrOwoJICAgICAgICAgICAgai0tOwoJICAgICAgICB9CgkgICAgICAgIGlmIChzdGF0ZUNvdW50WzBdID4gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgaiA9IHN0YXJ0SiArIDE7CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbMl0rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SikgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICB3aGlsZSAoaiA8IG1heEogJiYgIWltYWdlLmdldChqLCBjZW50ZXJJKSAmJiBzdGF0ZUNvdW50WzNdIDwgbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHN0YXRlQ291bnRbM10rKzsKCSAgICAgICAgICAgIGorKzsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaiA9PT0gbWF4SiB8fCBzdGF0ZUNvdW50WzNdID49IG1heENvdW50KSB7CgkgICAgICAgICAgICByZXR1cm4gTmFOOwoJICAgICAgICB9CgkgICAgICAgIHdoaWxlIChqIDwgbWF4SiAmJiBpbWFnZS5nZXQoaiwgY2VudGVySSkgJiYgc3RhdGVDb3VudFs0XSA8IG1heENvdW50KSB7CgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdKys7CgkgICAgICAgICAgICBqKys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHN0YXRlQ291bnRbNF0gPj0gbWF4Q291bnQpIHsKCSAgICAgICAgICAgIHJldHVybiBOYU47CgkgICAgICAgIH0KCSAgICAgICAgLy8gSWYgd2UgZm91bmQgYSBmaW5kZXItcGF0dGVybi1saWtlIHNlY3Rpb24sIGJ1dCBpdHMgc2l6ZSBpcyBzaWduaWZpY2FudGx5IGRpZmZlcmVudCB0aGFuCgkgICAgICAgIC8vIHRoZSBvcmlnaW5hbCwgYXNzdW1lIGl0J3MgYSBmYWxzZSBwb3NpdGl2ZQoJICAgICAgICB2YXIgc3RhdGVDb3VudFRvdGFsID0gc3RhdGVDb3VudFswXSArIHN0YXRlQ291bnRbMV0gKyBzdGF0ZUNvdW50WzJdICsgc3RhdGVDb3VudFszXSArCgkgICAgICAgICAgICBzdGF0ZUNvdW50WzRdOwoJICAgICAgICBpZiAoNSAqIE1hdGguYWJzKHN0YXRlQ291bnRUb3RhbCAtIG9yaWdpbmFsU3RhdGVDb3VudFRvdGFsKSA+PSBvcmlnaW5hbFN0YXRlQ291bnRUb3RhbCkgewoJICAgICAgICAgICAgcmV0dXJuIE5hTjsKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gRmluZGVyUGF0dGVybkZpbmRlci5mb3VuZFBhdHRlcm5Dcm9zcyhzdGF0ZUNvdW50KSA/IEZpbmRlclBhdHRlcm5GaW5kZXIuY2VudGVyRnJvbUVuZChzdGF0ZUNvdW50LCBqKSA6IE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgaXMgY2FsbGVkIHdoZW4gYSBob3Jpem9udGFsIHNjYW4gZmluZHMgYSBwb3NzaWJsZSBhbGlnbm1lbnQgcGF0dGVybi4gSXQgd2lsbAoJICAgICAqIGNyb3NzIGNoZWNrIHdpdGggYSB2ZXJ0aWNhbCBzY2FuLCBhbmQgaWYgc3VjY2Vzc2Z1bCwgd2lsbCwgYWgsIGNyb3NzLWNyb3NzLWNoZWNrCgkgICAgICogd2l0aCBhbm90aGVyIGhvcml6b250YWwgc2Nhbi4gVGhpcyBpcyBuZWVkZWQgcHJpbWFyaWx5IHRvIGxvY2F0ZSB0aGUgcmVhbCBob3Jpem9udGFsCgkgICAgICogY2VudGVyIG9mIHRoZSBwYXR0ZXJuIGluIGNhc2VzIG9mIGV4dHJlbWUgc2tldy4KCSAgICAgKiBBbmQgdGhlbiB3ZSBjcm9zcy1jcm9zcy1jcm9zcyBjaGVjayB3aXRoIGFub3RoZXIgZGlhZ29uYWwgc2Nhbi48L3A+CgkgICAgICoKCSAgICAgKiA8cD5JZiB0aGF0IHN1Y2NlZWRzIHRoZSBmaW5kZXIgcGF0dGVybiBsb2NhdGlvbiBpcyBhZGRlZCB0byBhIGxpc3QgdGhhdCB0cmFja3MKCSAgICAgKiB0aGUgbnVtYmVyIG9mIHRpbWVzIGVhY2ggbG9jYXRpb24gaGFzIGJlZW4gbmVhcmx5LW1hdGNoZWQgYXMgYSBmaW5kZXIgcGF0dGVybi4KCSAgICAgKiBFYWNoIGFkZGl0aW9uYWwgZmluZCBpcyBtb3JlIGV2aWRlbmNlIHRoYXQgdGhlIGxvY2F0aW9uIGlzIGluIGZhY3QgYSBmaW5kZXIKCSAgICAgKiBwYXR0ZXJuIGNlbnRlcgoJICAgICAqCgkgICAgICogQHBhcmFtIHN0YXRlQ291bnQgcmVhZGluZyBzdGF0ZSBtb2R1bGUgY291bnRzIGZyb20gaG9yaXpvbnRhbCBzY2FuCgkgICAgICogQHBhcmFtIGkgcm93IHdoZXJlIGZpbmRlciBwYXR0ZXJuIG1heSBiZSBmb3VuZAoJICAgICAqIEBwYXJhbSBqIGVuZCBvZiBwb3NzaWJsZSBmaW5kZXIgcGF0dGVybiBpbiByb3cKCSAgICAgKiBAcGFyYW0gcHVyZUJhcmNvZGUgdHJ1ZSBpZiBpbiAicHVyZSBiYXJjb2RlIiBtb2RlCgkgICAgICogQHJldHVybiB0cnVlIGlmIGEgZmluZGVyIHBhdHRlcm4gY2FuZGlkYXRlIHdhcyBmb3VuZCB0aGlzIHRpbWUKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYW5kbGVQb3NzaWJsZUNlbnRlciA9IGZ1bmN0aW9uIChzdGF0ZUNvdW50LCBpIC8qaW50Ki8sIGogLyppbnQqLywgcHVyZUJhcmNvZGUpIHsKCSAgICAgICAgdmFyIHN0YXRlQ291bnRUb3RhbCA9IHN0YXRlQ291bnRbMF0gKyBzdGF0ZUNvdW50WzFdICsgc3RhdGVDb3VudFsyXSArIHN0YXRlQ291bnRbM10gKwoJICAgICAgICAgICAgc3RhdGVDb3VudFs0XTsKCSAgICAgICAgdmFyIGNlbnRlckogPSBGaW5kZXJQYXR0ZXJuRmluZGVyLmNlbnRlckZyb21FbmQoc3RhdGVDb3VudCwgaik7CgkgICAgICAgIHZhciBjZW50ZXJJID0gdGhpcy5jcm9zc0NoZWNrVmVydGljYWwoaSwgLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCBzdGF0ZUNvdW50WzJdLCBzdGF0ZUNvdW50VG90YWwpOwoJICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckkpKSB7CgkgICAgICAgICAgICAvLyBSZS1jcm9zcyBjaGVjawoJICAgICAgICAgICAgY2VudGVySiA9IHRoaXMuY3Jvc3NDaGVja0hvcml6b250YWwoLyooaW50KSAqLyBNYXRoLmZsb29yKGNlbnRlckopLCAvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIHN0YXRlQ291bnRbMl0sIHN0YXRlQ291bnRUb3RhbCk7CgkgICAgICAgICAgICBpZiAoIWlzTmFOKGNlbnRlckopICYmCgkgICAgICAgICAgICAgICAgKCFwdXJlQmFyY29kZSB8fCB0aGlzLmNyb3NzQ2hlY2tEaWFnb25hbCgvKihpbnQpICovIE1hdGguZmxvb3IoY2VudGVySSksIC8qKGludCkgKi8gTWF0aC5mbG9vcihjZW50ZXJKKSwgc3RhdGVDb3VudFsyXSwgc3RhdGVDb3VudFRvdGFsKSkpIHsKCSAgICAgICAgICAgICAgICB2YXIgZXN0aW1hdGVkTW9kdWxlU2l6ZSA9IHN0YXRlQ291bnRUb3RhbCAvIDcuMDsKCSAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXJzID0gdGhpcy5wb3NzaWJsZUNlbnRlcnM7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwLCBsZW5ndGhfMSA9IHBvc3NpYmxlQ2VudGVycy5sZW5ndGg7IGluZGV4IDwgbGVuZ3RoXzE7IGluZGV4KyspIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IHBvc3NpYmxlQ2VudGVyc1tpbmRleF07CgkgICAgICAgICAgICAgICAgICAgIC8vIExvb2sgZm9yIGFib3V0IHRoZSBzYW1lIGNlbnRlciBhbmQgbW9kdWxlIHNpemU6CgkgICAgICAgICAgICAgICAgICAgIGlmIChjZW50ZXIuYWJvdXRFcXVhbHMoZXN0aW1hdGVkTW9kdWxlU2l6ZSwgY2VudGVySSwgY2VudGVySikpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVyc1tpbmRleF0gPSBjZW50ZXIuY29tYmluZUVzdGltYXRlKGNlbnRlckksIGNlbnRlckosIGVzdGltYXRlZE1vZHVsZVNpemUpOwoJICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwoJICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9pbnQgPSBuZXcgRmluZGVyUGF0dGVybl8xLmRlZmF1bHQoY2VudGVySiwgY2VudGVySSwgZXN0aW1hdGVkTW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5wdXNoKHBvaW50KTsKCSAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayAhPT0gbnVsbCAmJiB0aGlzLnJlc3VsdFBvaW50Q2FsbGJhY2sgIT09IHVuZGVmaW5lZCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrLmZvdW5kUG9zc2libGVSZXN1bHRQb2ludChwb2ludCk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogQHJldHVybiBudW1iZXIgb2Ygcm93cyB3ZSBjb3VsZCBzYWZlbHkgc2tpcCBkdXJpbmcgc2Nhbm5pbmcsIGJhc2VkIG9uIHRoZSBmaXJzdAoJICAgICAqICAgICAgICAgdHdvIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBsb2NhdGVkLiBJbiBzb21lIGNhc2VzIHRoZWlyIHBvc2l0aW9uIHdpbGwKCSAgICAgKiAgICAgICAgIGFsbG93IHVzIHRvIGluZmVyIHRoYXQgdGhlIHRoaXJkIHBhdHRlcm4gbXVzdCBsaWUgYmVsb3cgYSBjZXJ0YWluIHBvaW50IGZhcnRoZXIKCSAgICAgKiAgICAgICAgIGRvd24gaW4gdGhlIGltYWdlLgoJICAgICAqLwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIucHJvdG90eXBlLmZpbmRSb3dTa2lwID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8xLCBfYTsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKG1heCA8PSAxKSB7CgkgICAgICAgICAgICByZXR1cm4gMDsKCSAgICAgICAgfQoJICAgICAgICB2YXIgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBudWxsOwoJICAgICAgICB0cnkgewoJICAgICAgICAgICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9jID0gX2IubmV4dCgpOyAhX2MuZG9uZTsgX2MgPSBfYi5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICB2YXIgY2VudGVyID0gX2MudmFsdWU7CgkgICAgICAgICAgICAgICAgaWYgKGNlbnRlci5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBpZiAoZmlyc3RDb25maXJtZWRDZW50ZXIgPT0gbnVsbCkgewoJICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RDb25maXJtZWRDZW50ZXIgPSBjZW50ZXI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBoYXZlIHR3byBjb25maXJtZWQgY2VudGVycwoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gSG93IGZhciBkb3duIGNhbiB3ZSBza2lwIGJlZm9yZSByZXN1bWluZyBsb29raW5nIGZvciB0aGUgbmV4dAoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGF0dGVybj8gSW4gdGhlIHdvcnN0IGNhc2UsIG9ubHkgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGUKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIHggLyB5IGNvb3JkaW5hdGVzIG9mIHRoZSB0d28gY2VudGVycy4KCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgdGhlIGNhc2Ugd2hlcmUgeW91IGZpbmQgdG9wIGxlZnQgbGFzdC4KCSAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzU2tpcHBlZCA9IHRydWU7CgkgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gLyooaW50KSAqLyBNYXRoLmZsb29yKChNYXRoLmFicyhmaXJzdENvbmZpcm1lZENlbnRlci5nZXRYKCkgLSBjZW50ZXIuZ2V0WCgpKSAtCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMoZmlyc3RDb25maXJtZWRDZW50ZXIuZ2V0WSgpIC0gY2VudGVyLmdldFkoKSkpIC8gMik7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgY2F0Y2ggKGVfMV8xKSB7IGVfMSA9IHsgZXJyb3I6IGVfMV8xIH07IH0KCSAgICAgICAgZmluYWxseSB7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGlmIChfYyAmJiAhX2MuZG9uZSAmJiAoX2EgPSBfYi5yZXR1cm4pKSBfYS5jYWxsKF9iKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGZpbmFsbHkgeyBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7IH0KCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIEByZXR1cm4gdHJ1ZSBpZmYgd2UgaGF2ZSBmb3VuZCBhdCBsZWFzdCAzIGZpbmRlciBwYXR0ZXJucyB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZAoJICAgICAqICAgICAgICAgYXQgbGVhc3Qge0BsaW5rICNDRU5URVJfUVVPUlVNfSB0aW1lcyBlYWNoLCBhbmQsIHRoZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgb2YgdGhlCgkgICAgICogICAgICAgICBjYW5kaWRhdGVzIGlzICJwcmV0dHkgc2ltaWxhciIKCSAgICAgKi8KCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLnByb3RvdHlwZS5oYXZlTXVsdGlwbHlDb25maXJtZWRDZW50ZXJzID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV8yLCBfYSwgZV8zLCBfYjsKCSAgICAgICAgdmFyIGNvbmZpcm1lZENvdW50ID0gMDsKCSAgICAgICAgdmFyIHRvdGFsTW9kdWxlU2l6ZSA9IDAuMDsKCSAgICAgICAgdmFyIG1heCA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9jID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZCA9IF9jLm5leHQoKTsgIV9kLmRvbmU7IF9kID0gX2MubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZC52YWx1ZTsKCSAgICAgICAgICAgICAgICBpZiAocGF0dGVybi5nZXRDb3VudCgpID49IEZpbmRlclBhdHRlcm5GaW5kZXIuQ0VOVEVSX1FVT1JVTSkgewoJICAgICAgICAgICAgICAgICAgICBjb25maXJtZWRDb3VudCsrOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcGF0dGVybi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzJfMSkgeyBlXzIgPSB7IGVycm9yOiBlXzJfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2QgJiYgIV9kLmRvbmUgJiYgKF9hID0gX2MucmV0dXJuKSkgX2EuY2FsbChfYyk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMikgdGhyb3cgZV8yLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGNvbmZpcm1lZENvdW50IDwgMykgewoJICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwoJICAgICAgICB9CgkgICAgICAgIC8vIE9LLCB3ZSBoYXZlIGF0IGxlYXN0IDMgY29uZmlybWVkIGNlbnRlcnMsIGJ1dCwgaXQncyBwb3NzaWJsZSB0aGF0IG9uZSBpcyBhICJmYWxzZSBwb3NpdGl2ZSIKCSAgICAgICAgLy8gYW5kIHRoYXQgd2UgbmVlZCB0byBrZWVwIGxvb2tpbmcuIFdlIGRldGVjdCB0aGlzIGJ5IGFza2luZyBpZiB0aGUgZXN0aW1hdGVkIG1vZHVsZSBzaXplcwoJICAgICAgICAvLyB2YXJ5IHRvbyBtdWNoLiBXZSBhcmJpdHJhcmlseSBzYXkgdGhhdCB3aGVuIHRoZSB0b3RhbCBkZXZpYXRpb24gZnJvbSBhdmVyYWdlIGV4Y2VlZHMKCSAgICAgICAgLy8gNSUgb2YgdGhlIHRvdGFsIG1vZHVsZSBzaXplIGVzdGltYXRlcywgaXQncyB0b28gbXVjaC4KCSAgICAgICAgdmFyIGF2ZXJhZ2UgPSB0b3RhbE1vZHVsZVNpemUgLyBtYXg7CgkgICAgICAgIHZhciB0b3RhbERldmlhdGlvbiA9IDAuMDsKCSAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgIGZvciAodmFyIF9lID0gX192YWx1ZXModGhpcy5wb3NzaWJsZUNlbnRlcnMpLCBfZiA9IF9lLm5leHQoKTsgIV9mLmRvbmU7IF9mID0gX2UubmV4dCgpKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBfZi52YWx1ZTsKCSAgICAgICAgICAgICAgICB0b3RhbERldmlhdGlvbiArPSBNYXRoLmFicyhwYXR0ZXJuLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGNhdGNoIChlXzNfMSkgeyBlXzMgPSB7IGVycm9yOiBlXzNfMSB9OyB9CgkgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgdHJ5IHsKCSAgICAgICAgICAgICAgICBpZiAoX2YgJiYgIV9mLmRvbmUgJiYgKF9iID0gX2UucmV0dXJuKSkgX2IuY2FsbChfZSk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfMykgdGhyb3cgZV8zLmVycm9yOyB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHRvdGFsRGV2aWF0aW9uIDw9IDAuMDUgKiB0b3RhbE1vZHVsZVNpemU7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBAcmV0dXJuIHRoZSAzIGJlc3Qge0BsaW5rIEZpbmRlclBhdHRlcm59cyBmcm9tIG91ciBsaXN0IG9mIGNhbmRpZGF0ZXMuIFRoZSAiYmVzdCIgYXJlCgkgICAgICogICAgICAgICB0aG9zZSB0aGF0IGhhdmUgYmVlbiBkZXRlY3RlZCBhdCBsZWFzdCB7QGxpbmsgI0NFTlRFUl9RVU9SVU19IHRpbWVzLCBhbmQgd2hvc2UgbW9kdWxlCgkgICAgICogICAgICAgICBzaXplIGRpZmZlcnMgZnJvbSB0aGUgYXZlcmFnZSBhbW9uZyB0aG9zZSBwYXR0ZXJucyB0aGUgbGVhc3QKCSAgICAgKiBAdGhyb3dzIE5vdEZvdW5kRXhjZXB0aW9uIGlmIDMgc3VjaCBmaW5kZXIgcGF0dGVybnMgZG8gbm90IGV4aXN0CgkgICAgICovCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5wcm90b3R5cGUuc2VsZWN0QmVzdFBhdHRlcm5zID0gZnVuY3Rpb24gKCkgewoJICAgICAgICB2YXIgZV80LCBfYSwgZV81LCBfYjsKCSAgICAgICAgdmFyIHN0YXJ0U2l6ZSA9IHRoaXMucG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgaWYgKHN0YXJ0U2l6ZSA8IDMpIHsKCSAgICAgICAgICAgIC8vIENvdWxkbid0IGZpbmQgZW5vdWdoIGZpbmRlciBwYXR0ZXJucwoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMi5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIHBvc3NpYmxlQ2VudGVycyA9IHRoaXMucG9zc2libGVDZW50ZXJzOwoJICAgICAgICB2YXIgYXZlcmFnZTsKCSAgICAgICAgLy8gRmlsdGVyIG91dGxpZXIgcG9zc2liaWxpdGllcyB3aG9zZSBtb2R1bGUgc2l6ZSBpcyB0b28gZGlmZmVyZW50CgkgICAgICAgIGlmIChzdGFydFNpemUgPiAzKSB7CgkgICAgICAgICAgICAvLyBCdXQgd2UgY2FuIG9ubHkgYWZmb3JkIHRvIGRvIHNvIGlmIHdlIGhhdmUgYXQgbGVhc3QgNCBwb3NzaWJpbGl0aWVzIHRvIGNob29zZSBmcm9tCgkgICAgICAgICAgICB2YXIgdG90YWxNb2R1bGVTaXplID0gMC4wOwoJICAgICAgICAgICAgdmFyIHNxdWFyZSA9IDAuMDsKCSAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgX2MgPSBfX3ZhbHVlcyh0aGlzLnBvc3NpYmxlQ2VudGVycyksIF9kID0gX2MubmV4dCgpOyAhX2QuZG9uZTsgX2QgPSBfYy5uZXh0KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGNlbnRlciA9IF9kLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IGNlbnRlci5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCk7CgkgICAgICAgICAgICAgICAgICAgIHRvdGFsTW9kdWxlU2l6ZSArPSBzaXplOwoJICAgICAgICAgICAgICAgICAgICBzcXVhcmUgKz0gc2l6ZSAqIHNpemU7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgY2F0Y2ggKGVfNF8xKSB7IGVfNCA9IHsgZXJyb3I6IGVfNF8xIH07IH0KCSAgICAgICAgICAgIGZpbmFsbHkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGlmIChfZCAmJiAhX2QuZG9uZSAmJiAoX2EgPSBfYy5yZXR1cm4pKSBfYS5jYWxsKF9jKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZmluYWxseSB7IGlmIChlXzQpIHRocm93IGVfNC5lcnJvcjsgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgYXZlcmFnZSA9IHRvdGFsTW9kdWxlU2l6ZSAvIHN0YXJ0U2l6ZTsKCSAgICAgICAgICAgIHZhciBzdGREZXYgPSBNYXRoLnNxcnQoc3F1YXJlIC8gc3RhcnRTaXplIC0gYXZlcmFnZSAqIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzLnNvcnQoCgkgICAgICAgICAgICAvKioKCSAgICAgICAgICAgICAqIDxwPk9yZGVycyBieSBmdXJ0aGVzdCBmcm9tIGF2ZXJhZ2U8L3A+CgkgICAgICAgICAgICAgKi8KCSAgICAgICAgICAgIC8vIEZ1cnRoZXN0RnJvbUF2ZXJhZ2VDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICB2YXIgZEEgPSBNYXRoLmFicyhjZW50ZXIyLmdldEVzdGltYXRlZE1vZHVsZVNpemUoKSAtIGF2ZXJhZ2UpOwoJICAgICAgICAgICAgICAgIHZhciBkQiA9IE1hdGguYWJzKGNlbnRlcjEuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSk7CgkgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAtMSA6IGRBID4gZEIgPyAxIDogMDsKCSAgICAgICAgICAgIH0pOwoJICAgICAgICAgICAgdmFyIGxpbWl0ID0gTWF0aC5tYXgoMC4yICogYXZlcmFnZSwgc3RkRGV2KTsKCSAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zc2libGVDZW50ZXJzLmxlbmd0aCAmJiBwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMzsgaSsrKSB7CgkgICAgICAgICAgICAgICAgdmFyIHBhdHRlcm4gPSBwb3NzaWJsZUNlbnRlcnNbaV07CgkgICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHBhdHRlcm4uZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpIC0gYXZlcmFnZSkgPiBsaW1pdCkgewoJICAgICAgICAgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKGksIDEpOwoJICAgICAgICAgICAgICAgICAgICBpLS07CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9CgkgICAgICAgIGlmIChwb3NzaWJsZUNlbnRlcnMubGVuZ3RoID4gMykgewoJICAgICAgICAgICAgLy8gVGhyb3cgYXdheSBhbGwgYnV0IHRob3NlIGZpcnN0IHNpemUgY2FuZGlkYXRlIHBvaW50cyB3ZSBmb3VuZC4KCSAgICAgICAgICAgIHZhciB0b3RhbE1vZHVsZVNpemUgPSAwLjA7CgkgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgIGZvciAodmFyIHBvc3NpYmxlQ2VudGVyc18xID0gX192YWx1ZXMocG9zc2libGVDZW50ZXJzKSwgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKTsgIXBvc3NpYmxlQ2VudGVyc18xXzEuZG9uZTsgcG9zc2libGVDZW50ZXJzXzFfMSA9IHBvc3NpYmxlQ2VudGVyc18xLm5leHQoKSkgewoJICAgICAgICAgICAgICAgICAgICB2YXIgcG9zc2libGVDZW50ZXIgPSBwb3NzaWJsZUNlbnRlcnNfMV8xLnZhbHVlOwoJICAgICAgICAgICAgICAgICAgICB0b3RhbE1vZHVsZVNpemUgKz0gcG9zc2libGVDZW50ZXIuZ2V0RXN0aW1hdGVkTW9kdWxlU2l6ZSgpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGNhdGNoIChlXzVfMSkgeyBlXzUgPSB7IGVycm9yOiBlXzVfMSB9OyB9CgkgICAgICAgICAgICBmaW5hbGx5IHsKCSAgICAgICAgICAgICAgICB0cnkgewoJICAgICAgICAgICAgICAgICAgICBpZiAocG9zc2libGVDZW50ZXJzXzFfMSAmJiAhcG9zc2libGVDZW50ZXJzXzFfMS5kb25lICYmIChfYiA9IHBvc3NpYmxlQ2VudGVyc18xLnJldHVybikpIF9iLmNhbGwocG9zc2libGVDZW50ZXJzXzEpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBmaW5hbGx5IHsgaWYgKGVfNSkgdGhyb3cgZV81LmVycm9yOyB9CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBhdmVyYWdlID0gdG90YWxNb2R1bGVTaXplIC8gcG9zc2libGVDZW50ZXJzLmxlbmd0aDsKCSAgICAgICAgICAgIHBvc3NpYmxlQ2VudGVycy5zb3J0KAoJICAgICAgICAgICAgLyoqCgkgICAgICAgICAgICAgKiA8cD5PcmRlcnMgYnkge0BsaW5rIEZpbmRlclBhdHRlcm4jZ2V0Q291bnQoKX0sIGRlc2NlbmRpbmcuPC9wPgoJICAgICAgICAgICAgICovCgkgICAgICAgICAgICAvLyBDZW50ZXJDb21wYXJhdG9yIGltcGxlbWVudHMgQ29tcGFyYXRvcjxGaW5kZXJQYXR0ZXJuPgoJICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnRlcjEsIGNlbnRlcjIpIHsKCSAgICAgICAgICAgICAgICBpZiAoY2VudGVyMi5nZXRDb3VudCgpID09PSBjZW50ZXIxLmdldENvdW50KCkpIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRBID0gTWF0aC5hYnMoY2VudGVyMi5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgdmFyIGRCID0gTWF0aC5hYnMoY2VudGVyMS5nZXRFc3RpbWF0ZWRNb2R1bGVTaXplKCkgLSBhdmVyYWdlKTsKCSAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRBIDwgZEIgPyAxIDogZEEgPiBkQiA/IC0xIDogMDsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZW50ZXIyLmdldENvdW50KCkgLSBjZW50ZXIxLmdldENvdW50KCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICBwb3NzaWJsZUNlbnRlcnMuc3BsaWNlKDMpOyAvLyB0aGlzIGlzIG5vdCByZWFseSBuZWNlc3NhcnkgYXMgd2Ugb25seSByZXR1cm4gZmlyc3QgMyBhbnl3YXkKCSAgICAgICAgfQoJICAgICAgICByZXR1cm4gWwoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzBdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzFdLAoJICAgICAgICAgICAgcG9zc2libGVDZW50ZXJzWzJdCgkgICAgICAgIF07CgkgICAgfTsKCSAgICBGaW5kZXJQYXR0ZXJuRmluZGVyLkNFTlRFUl9RVU9SVU0gPSAyOwoJICAgIEZpbmRlclBhdHRlcm5GaW5kZXIuTUlOX1NLSVAgPSAzOyAvLyAxIHBpeGVsL21vZHVsZSB0aW1lcyAzIG1vZHVsZXMvY2VudGVyCgkgICAgRmluZGVyUGF0dGVybkZpbmRlci5NQVhfTU9EVUxFUyA9IDU3OyAvLyBzdXBwb3J0IHVwIHRvIHZlcnNpb24gMTAgZm9yIG1vYmlsZSBjbGllbnRzCgkgICAgcmV0dXJuIEZpbmRlclBhdHRlcm5GaW5kZXI7Cgl9KCkpOwoJRmluZGVyUGF0dGVybkZpbmRlciQxLmRlZmF1bHQgPSBGaW5kZXJQYXR0ZXJuRmluZGVyOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoRGV0ZWN0b3IkMSwgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwoJdmFyIE1hdGhVdGlsc18xID0gTWF0aFV0aWxzJDE7Cgl2YXIgRGV0ZWN0b3JSZXN1bHRfMSA9IERldGVjdG9yUmVzdWx0JDE7CgkvLyBpbXBvcnQgR3JpZFNhbXBsZXIgZnJvbSAnLi4vLi4vY29tbW9uL0dyaWRTYW1wbGVyJzsKCXZhciBHcmlkU2FtcGxlckluc3RhbmNlXzEgPSBHcmlkU2FtcGxlckluc3RhbmNlJDE7Cgl2YXIgUGVyc3BlY3RpdmVUcmFuc2Zvcm1fMSA9IFBlcnNwZWN0aXZlVHJhbnNmb3JtJDE7Cgl2YXIgRGVjb2RlSGludFR5cGVfMSQxID0gRGVjb2RlSGludFR5cGUkMTsKCXZhciBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdFBvaW50XzEgPSBSZXN1bHRQb2ludCQxOwoJdmFyIFZlcnNpb25fMSA9IFZlcnNpb24kMTsKCXZhciBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyXzEgPSBBbGlnbm1lbnRQYXR0ZXJuRmluZGVyJDE7Cgl2YXIgRmluZGVyUGF0dGVybkZpbmRlcl8xID0gRmluZGVyUGF0dGVybkZpbmRlciQxOwoJLyppbXBvcnQgamF2YS51dGlsLk1hcDsqLwoJLyoqCgkgKiA8cD5FbmNhcHN1bGF0ZXMgbG9naWMgdGhhdCBjYW4gZGV0ZWN0IGEgUVIgQ29kZSBpbiBhbiBpbWFnZSwgZXZlbiBpZiB0aGUgUVIgQ29kZQoJICogaXMgcm90YXRlZCBvciBza2V3ZWQsIG9yIHBhcnRpYWxseSBvYnNjdXJlZC48L3A+CgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIERldGVjdG9yID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkgewoJICAgIGZ1bmN0aW9uIERldGVjdG9yKGltYWdlKSB7CgkgICAgICAgIHRoaXMuaW1hZ2UgPSBpbWFnZTsKCSAgICB9CgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLmdldEltYWdlID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5pbWFnZTsKCSAgICB9OwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5nZXRSZXN1bHRQb2ludENhbGxiYWNrID0gZnVuY3Rpb24gKCkgewoJICAgICAgICByZXR1cm4gdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIC8vIHB1YmxpYyBkZXRlY3QoKTogRGV0ZWN0b3JSZXN1bHQgLyp0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiovIHsKCSAgICAvLyAgIHJldHVybiBkZXRlY3QobnVsbCkKCSAgICAvLyB9CgkgICAgLyoqCgkgICAgICogPHA+RGV0ZWN0cyBhIFFSIENvZGUgaW4gYW4gaW1hZ2UuPC9wPgoJICAgICAqCgkgICAgICogQHBhcmFtIGhpbnRzIG9wdGlvbmFsIGhpbnRzIHRvIGRldGVjdG9yCgkgICAgICogQHJldHVybiB7QGxpbmsgRGV0ZWN0b3JSZXN1bHR9IGVuY2Fwc3VsYXRpbmcgcmVzdWx0cyBvZiBkZXRlY3RpbmcgYSBRUiBDb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBRUiBDb2RlIGNhbm5vdCBiZSBmb3VuZAoJICAgICAqIEB0aHJvd3MgRm9ybWF0RXhjZXB0aW9uIGlmIGEgUVIgQ29kZSBjYW5ub3QgYmUgZGVjb2RlZAoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5kZXRlY3QgPSBmdW5jdGlvbiAoaGludHMpIHsKCSAgICAgICAgdGhpcy5yZXN1bHRQb2ludENhbGxiYWNrID0gKGhpbnRzID09PSBudWxsIHx8IGhpbnRzID09PSB1bmRlZmluZWQpID8gbnVsbCA6CgkgICAgICAgICAgICAvKihSZXN1bHRQb2ludENhbGxiYWNrKSAqLyBoaW50cy5nZXQoRGVjb2RlSGludFR5cGVfMSQxLmRlZmF1bHQuTkVFRF9SRVNVTFRfUE9JTlRfQ0FMTEJBQ0spOwoJICAgICAgICB2YXIgZmluZGVyID0gbmV3IEZpbmRlclBhdHRlcm5GaW5kZXJfMS5kZWZhdWx0KHRoaXMuaW1hZ2UsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHZhciBpbmZvID0gZmluZGVyLmZpbmQoaGludHMpOwoJICAgICAgICByZXR1cm4gdGhpcy5wcm9jZXNzRmluZGVyUGF0dGVybkluZm8oaW5mbyk7CgkgICAgfTsKCSAgICBEZXRlY3Rvci5wcm90b3R5cGUucHJvY2Vzc0ZpbmRlclBhdHRlcm5JbmZvID0gZnVuY3Rpb24gKGluZm8pIHsKCSAgICAgICAgdmFyIHRvcExlZnQgPSBpbmZvLmdldFRvcExlZnQoKTsKCSAgICAgICAgdmFyIHRvcFJpZ2h0ID0gaW5mby5nZXRUb3BSaWdodCgpOwoJICAgICAgICB2YXIgYm90dG9tTGVmdCA9IGluZm8uZ2V0Qm90dG9tTGVmdCgpOwoJICAgICAgICB2YXIgbW9kdWxlU2l6ZSA9IHRoaXMuY2FsY3VsYXRlTW9kdWxlU2l6ZSh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCk7CgkgICAgICAgIGlmIChtb2R1bGVTaXplIDwgMS4wKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ05vIHBhdHRlcm4gZm91bmQgaW4gcHJvY2Nlc3MgZmluZGVyLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBkaW1lbnNpb24gPSBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHByb3Zpc2lvbmFsVmVyc2lvbiA9IFZlcnNpb25fMS5kZWZhdWx0LmdldFByb3Zpc2lvbmFsVmVyc2lvbkZvckRpbWVuc2lvbihkaW1lbnNpb24pOwoJICAgICAgICB2YXIgbW9kdWxlc0JldHdlZW5GUENlbnRlcnMgPSBwcm92aXNpb25hbFZlcnNpb24uZ2V0RGltZW5zaW9uRm9yVmVyc2lvbigpIC0gNzsKCSAgICAgICAgdmFyIGFsaWdubWVudFBhdHRlcm4gPSBudWxsOwoJICAgICAgICAvLyBBbnl0aGluZyBhYm92ZSB2ZXJzaW9uIDEgaGFzIGFuIGFsaWdubWVudCBwYXR0ZXJuCgkgICAgICAgIGlmIChwcm92aXNpb25hbFZlcnNpb24uZ2V0QWxpZ25tZW50UGF0dGVybkNlbnRlcnMoKS5sZW5ndGggPiAwKSB7CgkgICAgICAgICAgICAvLyBHdWVzcyB3aGVyZSBhICJib3R0b20gcmlnaHQiIGZpbmRlciBwYXR0ZXJuIHdvdWxkIGhhdmUgYmVlbgoJICAgICAgICAgICAgdmFyIGJvdHRvbVJpZ2h0WCA9IHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpICsgYm90dG9tTGVmdC5nZXRYKCk7CgkgICAgICAgICAgICB2YXIgYm90dG9tUmlnaHRZID0gdG9wUmlnaHQuZ2V0WSgpIC0gdG9wTGVmdC5nZXRZKCkgKyBib3R0b21MZWZ0LmdldFkoKTsKCSAgICAgICAgICAgIC8vIEVzdGltYXRlIHRoYXQgYWxpZ25tZW50IHBhdHRlcm4gaXMgY2xvc2VyIGJ5IDMgbW9kdWxlcwoJICAgICAgICAgICAgLy8gZnJvbSAiYm90dG9tIHJpZ2h0IiB0byBrbm93biB0b3AgbGVmdCBsb2NhdGlvbgoJICAgICAgICAgICAgdmFyIGNvcnJlY3Rpb25Ub1RvcExlZnQgPSAxLjAgLSAzLjAgLyBtb2R1bGVzQmV0d2VlbkZQQ2VudGVyczsKCSAgICAgICAgICAgIHZhciBlc3RBbGlnbm1lbnRYID0gLyooaW50KSAqLyBNYXRoLmZsb29yKHRvcExlZnQuZ2V0WCgpICsgY29ycmVjdGlvblRvVG9wTGVmdCAqIChib3R0b21SaWdodFggLSB0b3BMZWZ0LmdldFgoKSkpOwoJICAgICAgICAgICAgdmFyIGVzdEFsaWdubWVudFkgPSAvKihpbnQpICovIE1hdGguZmxvb3IodG9wTGVmdC5nZXRZKCkgKyBjb3JyZWN0aW9uVG9Ub3BMZWZ0ICogKGJvdHRvbVJpZ2h0WSAtIHRvcExlZnQuZ2V0WSgpKSk7CgkgICAgICAgICAgICAvLyBLaW5kIG9mIGFyYml0cmFyeSAtLSBleHBhbmQgc2VhcmNoIHJhZGl1cyBiZWZvcmUgZ2l2aW5nIHVwCgkgICAgICAgICAgICBmb3IgKHZhciBpID0gNDsgaSA8PSAxNjsgaSA8PD0gMSkgewoJICAgICAgICAgICAgICAgIHRyeSB7CgkgICAgICAgICAgICAgICAgICAgIGFsaWdubWVudFBhdHRlcm4gPSB0aGlzLmZpbmRBbGlnbm1lbnRJblJlZ2lvbihtb2R1bGVTaXplLCBlc3RBbGlnbm1lbnRYLCBlc3RBbGlnbm1lbnRZLCBpKTsKCSAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIGNhdGNoIChyZSAvKk5vdEZvdW5kRXhjZXB0aW9uKi8pIHsKCSAgICAgICAgICAgICAgICAgICAgaWYgKCEocmUgaW5zdGFuY2VvZiBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCkpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IHJlOwoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgICAgIC8vIHRyeSBuZXh0IHJvdW5kCgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gSWYgd2UgZGlkbid0IGZpbmQgYWxpZ25tZW50IHBhdHRlcm4uLi4gd2VsbCB0cnkgYW55d2F5IHdpdGhvdXQgaXQKCSAgICAgICAgfQoJICAgICAgICB2YXIgdHJhbnNmb3JtID0gRGV0ZWN0b3IuY3JlYXRlVHJhbnNmb3JtKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBhbGlnbm1lbnRQYXR0ZXJuLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgYml0cyA9IERldGVjdG9yLnNhbXBsZUdyaWQodGhpcy5pbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24pOwoJICAgICAgICB2YXIgcG9pbnRzOwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiA9PT0gbnVsbCkgewoJICAgICAgICAgICAgcG9pbnRzID0gW2JvdHRvbUxlZnQsIHRvcExlZnQsIHRvcFJpZ2h0XTsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgIHBvaW50cyA9IFtib3R0b21MZWZ0LCB0b3BMZWZ0LCB0b3BSaWdodCwgYWxpZ25tZW50UGF0dGVybl07CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIG5ldyBEZXRlY3RvclJlc3VsdF8xLmRlZmF1bHQoYml0cywgcG9pbnRzKTsKCSAgICB9OwoJICAgIERldGVjdG9yLmNyZWF0ZVRyYW5zZm9ybSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCwgYWxpZ25tZW50UGF0dGVybiwgZGltZW5zaW9uIC8qaW50Ki8pIHsKCSAgICAgICAgdmFyIGRpbU1pbnVzVGhyZWUgPSBkaW1lbnNpb24gLSAzLjU7CgkgICAgICAgIHZhciBib3R0b21SaWdodFg7IC8qZmxvYXQqLwoJICAgICAgICB2YXIgYm90dG9tUmlnaHRZOyAvKmZsb2F0Ki8KCSAgICAgICAgdmFyIHNvdXJjZUJvdHRvbVJpZ2h0WDsgLypmbG9hdCovCgkgICAgICAgIHZhciBzb3VyY2VCb3R0b21SaWdodFk7IC8qZmxvYXQqLwoJICAgICAgICBpZiAoYWxpZ25tZW50UGF0dGVybiAhPT0gbnVsbCkgewoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gYWxpZ25tZW50UGF0dGVybi5nZXRYKCk7CgkgICAgICAgICAgICBib3R0b21SaWdodFkgPSBhbGlnbm1lbnRQYXR0ZXJuLmdldFkoKTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WCA9IGRpbU1pbnVzVGhyZWUgLSAzLjA7CgkgICAgICAgICAgICBzb3VyY2VCb3R0b21SaWdodFkgPSBzb3VyY2VCb3R0b21SaWdodFg7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAvLyBEb24ndCBoYXZlIGFuIGFsaWdubWVudCBwYXR0ZXJuLCBqdXN0IG1ha2UgdXAgdGhlIGJvdHRvbS1yaWdodCBwb2ludAoJICAgICAgICAgICAgYm90dG9tUmlnaHRYID0gKHRvcFJpZ2h0LmdldFgoKSAtIHRvcExlZnQuZ2V0WCgpKSArIGJvdHRvbUxlZnQuZ2V0WCgpOwoJICAgICAgICAgICAgYm90dG9tUmlnaHRZID0gKHRvcFJpZ2h0LmdldFkoKSAtIHRvcExlZnQuZ2V0WSgpKSArIGJvdHRvbUxlZnQuZ2V0WSgpOwoJICAgICAgICAgICAgc291cmNlQm90dG9tUmlnaHRYID0gZGltTWludXNUaHJlZTsKCSAgICAgICAgICAgIHNvdXJjZUJvdHRvbVJpZ2h0WSA9IGRpbU1pbnVzVGhyZWU7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIFBlcnNwZWN0aXZlVHJhbnNmb3JtXzEuZGVmYXVsdC5xdWFkcmlsYXRlcmFsVG9RdWFkcmlsYXRlcmFsKDMuNSwgMy41LCBkaW1NaW51c1RocmVlLCAzLjUsIHNvdXJjZUJvdHRvbVJpZ2h0WCwgc291cmNlQm90dG9tUmlnaHRZLCAzLjUsIGRpbU1pbnVzVGhyZWUsIHRvcExlZnQuZ2V0WCgpLCB0b3BMZWZ0LmdldFkoKSwgdG9wUmlnaHQuZ2V0WCgpLCB0b3BSaWdodC5nZXRZKCksIGJvdHRvbVJpZ2h0WCwgYm90dG9tUmlnaHRZLCBib3R0b21MZWZ0LmdldFgoKSwgYm90dG9tTGVmdC5nZXRZKCkpOwoJICAgIH07CgkgICAgRGV0ZWN0b3Iuc2FtcGxlR3JpZCA9IGZ1bmN0aW9uIChpbWFnZSwgdHJhbnNmb3JtLCBkaW1lbnNpb24gLyppbnQqLykgewoJICAgICAgICB2YXIgc2FtcGxlciA9IEdyaWRTYW1wbGVySW5zdGFuY2VfMS5kZWZhdWx0LmdldEluc3RhbmNlKCk7CgkgICAgICAgIHJldHVybiBzYW1wbGVyLnNhbXBsZUdyaWRXaXRoVHJhbnNmb3JtKGltYWdlLCBkaW1lbnNpb24sIGRpbWVuc2lvbiwgdHJhbnNmb3JtKTsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkNvbXB1dGVzIHRoZSBkaW1lbnNpb24gKG51bWJlciBvZiBtb2R1bGVzIG9uIGEgc2l6ZSkgb2YgdGhlIFFSIENvZGUgYmFzZWQgb24gdGhlIHBvc2l0aW9uCgkgICAgICogb2YgdGhlIGZpbmRlciBwYXR0ZXJucyBhbmQgZXN0aW1hdGVkIG1vZHVsZSBzaXplLjwvcD4KCSAgICAgKi8KCSAgICBEZXRlY3Rvci5jb21wdXRlRGltZW5zaW9uID0gZnVuY3Rpb24gKHRvcExlZnQsIHRvcFJpZ2h0LCBib3R0b21MZWZ0LCBtb2R1bGVTaXplIC8qZmxvYXQqLykgewoJICAgICAgICB2YXIgdGx0ckNlbnRlcnNEaW1lbnNpb24gPSBNYXRoVXRpbHNfMS5kZWZhdWx0LnJvdW5kKFJlc3VsdFBvaW50XzEuZGVmYXVsdC5kaXN0YW5jZSh0b3BMZWZ0LCB0b3BSaWdodCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIHRsYmxDZW50ZXJzRGltZW5zaW9uID0gTWF0aFV0aWxzXzEuZGVmYXVsdC5yb3VuZChSZXN1bHRQb2ludF8xLmRlZmF1bHQuZGlzdGFuY2UodG9wTGVmdCwgYm90dG9tTGVmdCkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIGRpbWVuc2lvbiA9IE1hdGguZmxvb3IoKHRsdHJDZW50ZXJzRGltZW5zaW9uICsgdGxibENlbnRlcnNEaW1lbnNpb24pIC8gMikgKyA3OwoJICAgICAgICBzd2l0Y2ggKGRpbWVuc2lvbiAmIDB4MDMpIHsgLy8gbW9kIDQKCSAgICAgICAgICAgIGNhc2UgMDoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24rKzsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIC8vIDE/IGRvIG5vdGhpbmcKCSAgICAgICAgICAgIGNhc2UgMjoKCSAgICAgICAgICAgICAgICBkaW1lbnNpb24tLTsKCSAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgIGNhc2UgMzoKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMSQxLmRlZmF1bHQoJ0RpbWVuc2lvbnMgY291bGQgYmUgbm90IGZvdW5kLicpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiBkaW1lbnNpb247CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiA8cD5Db21wdXRlcyBhbiBhdmVyYWdlIGVzdGltYXRlZCBtb2R1bGUgc2l6ZSBiYXNlZCBvbiBlc3RpbWF0ZWQgZGVyaXZlZCBmcm9tIHRoZSBwb3NpdGlvbnMKCSAgICAgKiBvZiB0aGUgdGhyZWUgZmluZGVyIHBhdHRlcm5zLjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSB0b3BMZWZ0IGRldGVjdGVkIHRvcC1sZWZ0IGZpbmRlciBwYXR0ZXJuIGNlbnRlcgoJICAgICAqIEBwYXJhbSB0b3BSaWdodCBkZXRlY3RlZCB0b3AtcmlnaHQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHBhcmFtIGJvdHRvbUxlZnQgZGV0ZWN0ZWQgYm90dG9tLWxlZnQgZmluZGVyIHBhdHRlcm4gY2VudGVyCgkgICAgICogQHJldHVybiBlc3RpbWF0ZWQgbW9kdWxlIHNpemUKCSAgICAgKi8KCSAgICBEZXRlY3Rvci5wcm90b3R5cGUuY2FsY3VsYXRlTW9kdWxlU2l6ZSA9IGZ1bmN0aW9uICh0b3BMZWZ0LCB0b3BSaWdodCwgYm90dG9tTGVmdCkgewoJICAgICAgICAvLyBUYWtlIHRoZSBhdmVyYWdlCgkgICAgICAgIHJldHVybiAodGhpcy5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5KHRvcExlZnQsIHRvcFJpZ2h0KSArCgkgICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZU1vZHVsZVNpemVPbmVXYXkodG9wTGVmdCwgYm90dG9tTGVmdCkpIC8gMi4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogPHA+RXN0aW1hdGVzIG1vZHVsZSBzaXplIGJhc2VkIG9uIHR3byBmaW5kZXIgcGF0dGVybnMgLS0gaXQgdXNlcwoJICAgICAqIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuQm90aFdheXMoaW50LCBpbnQsIGludCwgaW50KX0gdG8gZmlndXJlIHRoZQoJICAgICAqIHdpZHRoIG9mIGVhY2gsIG1lYXN1cmluZyBhbG9uZyB0aGUgYXhpcyBiZXR3ZWVuIHRoZWlyIGNlbnRlcnMuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5jYWxjdWxhdGVNb2R1bGVTaXplT25lV2F5ID0gZnVuY3Rpb24gKHBhdHRlcm4sIG90aGVyUGF0dGVybikgewoJICAgICAgICB2YXIgbW9kdWxlU2l6ZUVzdDEgPSB0aGlzLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzKC8qKGludCkgKi8gTWF0aC5mbG9vcihwYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRZKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKG90aGVyUGF0dGVybi5nZXRZKCkpKTsKCSAgICAgICAgdmFyIG1vZHVsZVNpemVFc3QyID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW5Cb3RoV2F5cygvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFgoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3Iob3RoZXJQYXR0ZXJuLmdldFkoKSksIAoJICAgICAgICAvKihpbnQpICovIE1hdGguZmxvb3IocGF0dGVybi5nZXRYKCkpLCAKCSAgICAgICAgLyooaW50KSAqLyBNYXRoLmZsb29yKHBhdHRlcm4uZ2V0WSgpKSk7CgkgICAgICAgIGlmIChpc05hTihtb2R1bGVTaXplRXN0MSkpIHsKCSAgICAgICAgICAgIHJldHVybiBtb2R1bGVTaXplRXN0MiAvIDcuMDsKCSAgICAgICAgfQoJICAgICAgICBpZiAoaXNOYU4obW9kdWxlU2l6ZUVzdDIpKSB7CgkgICAgICAgICAgICByZXR1cm4gbW9kdWxlU2l6ZUVzdDEgLyA3LjA7CgkgICAgICAgIH0KCSAgICAgICAgLy8gQXZlcmFnZSB0aGVtLCBhbmQgZGl2aWRlIGJ5IDcgc2luY2Ugd2UndmUgY291bnRlZCB0aGUgd2lkdGggb2YgMyBibGFjayBtb2R1bGVzLAoJICAgICAgICAvLyBhbmQgMSB3aGl0ZSBhbmQgMSBibGFjayBtb2R1bGUgb24gZWl0aGVyIHNpZGUuIEVyZ28sIGRpdmlkZSBzdW0gYnkgMTQuCgkgICAgICAgIHJldHVybiAobW9kdWxlU2l6ZUVzdDEgKyBtb2R1bGVTaXplRXN0MikgLyAxNC4wOwoJICAgIH07CgkgICAgLyoqCgkgICAgICogU2VlIHtAbGluayAjc2l6ZU9mQmxhY2tXaGl0ZUJsYWNrUnVuKGludCwgaW50LCBpbnQsIGludCl9OyBjb21wdXRlcyB0aGUgdG90YWwgd2lkdGggb2YKCSAgICAgKiBhIGZpbmRlciBwYXR0ZXJuIGJ5IGxvb2tpbmcgZm9yIGEgYmxhY2std2hpdGUtYmxhY2sgcnVuIGZyb20gdGhlIGNlbnRlciBpbiB0aGUgZGlyZWN0aW9uCgkgICAgICogb2YgYW5vdGhlciBwb2ludCAoYW5vdGhlciBmaW5kZXIgcGF0dGVybiBjZW50ZXIpLCBhbmQgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiB0b28uCgkgICAgICovCgkgICAgRGV0ZWN0b3IucHJvdG90eXBlLnNpemVPZkJsYWNrV2hpdGVCbGFja1J1bkJvdGhXYXlzID0gZnVuY3Rpb24gKGZyb21YIC8qaW50Ki8sIGZyb21ZIC8qaW50Ki8sIHRvWCAvKmludCovLCB0b1kgLyppbnQqLykgewoJICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCB0b1gsIHRvWSk7CgkgICAgICAgIC8vIE5vdyBjb3VudCBvdGhlciB3YXkgLS0gZG9uJ3QgcnVuIG9mZiBpbWFnZSB0aG91Z2ggb2YgY291cnNlCgkgICAgICAgIHZhciBzY2FsZSA9IDEuMDsKCSAgICAgICAgdmFyIG90aGVyVG9YID0gZnJvbVggLSAodG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAob3RoZXJUb1ggPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21YIC8gLyooZmxvYXQpICovIChmcm9tWCAtIG90aGVyVG9YKTsKCSAgICAgICAgICAgIG90aGVyVG9YID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWCA+PSB0aGlzLmltYWdlLmdldFdpZHRoKCkpIHsKCSAgICAgICAgICAgIHNjYWxlID0gKHRoaXMuaW1hZ2UuZ2V0V2lkdGgoKSAtIDEgLSBmcm9tWCkgLyAvKihmbG9hdCkgKi8gKG90aGVyVG9YIC0gZnJvbVgpOwoJICAgICAgICAgICAgb3RoZXJUb1ggPSB0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIHZhciBvdGhlclRvWSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihmcm9tWSAtICh0b1kgLSBmcm9tWSkgKiBzY2FsZSk7CgkgICAgICAgIHNjYWxlID0gMS4wOwoJICAgICAgICBpZiAob3RoZXJUb1kgPCAwKSB7CgkgICAgICAgICAgICBzY2FsZSA9IGZyb21ZIC8gLyooZmxvYXQpICovIChmcm9tWSAtIG90aGVyVG9ZKTsKCSAgICAgICAgICAgIG90aGVyVG9ZID0gMDsKCSAgICAgICAgfQoJICAgICAgICBlbHNlIGlmIChvdGhlclRvWSA+PSB0aGlzLmltYWdlLmdldEhlaWdodCgpKSB7CgkgICAgICAgICAgICBzY2FsZSA9ICh0aGlzLmltYWdlLmdldEhlaWdodCgpIC0gMSAtIGZyb21ZKSAvIC8qKGZsb2F0KSAqLyAob3RoZXJUb1kgLSBmcm9tWSk7CgkgICAgICAgICAgICBvdGhlclRvWSA9IHRoaXMuaW1hZ2UuZ2V0SGVpZ2h0KCkgLSAxOwoJICAgICAgICB9CgkgICAgICAgIG90aGVyVG9YID0gLyooaW50KSAqLyBNYXRoLmZsb29yKGZyb21YICsgKG90aGVyVG9YIC0gZnJvbVgpICogc2NhbGUpOwoJICAgICAgICByZXN1bHQgKz0gdGhpcy5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4oZnJvbVgsIGZyb21ZLCBvdGhlclRvWCwgb3RoZXJUb1kpOwoJICAgICAgICAvLyBNaWRkbGUgcGl4ZWwgaXMgZG91YmxlLWNvdW50ZWQgdGhpcyB3YXk7IHN1YnRyYWN0IDEKCSAgICAgICAgcmV0dXJuIHJlc3VsdCAtIDEuMDsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPlRoaXMgbWV0aG9kIHRyYWNlcyBhIGxpbmUgZnJvbSBhIHBvaW50IGluIHRoZSBpbWFnZSwgaW4gdGhlIGRpcmVjdGlvbiB0b3dhcmRzIGFub3RoZXIgcG9pbnQuCgkgICAgICogSXQgYmVnaW5zIGluIGEgYmxhY2sgcmVnaW9uLCBhbmQga2VlcHMgZ29pbmcgdW50aWwgaXQgZmluZHMgd2hpdGUsIHRoZW4gYmxhY2ssIHRoZW4gd2hpdGUgYWdhaW4uCgkgICAgICogSXQgcmVwb3J0cyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgc3RhcnQgdG8gdGhpcyBwb2ludC48L3A+CgkgICAgICoKCSAgICAgKiA8cD5UaGlzIGlzIHVzZWQgd2hlbiBmaWd1cmluZyBvdXQgaG93IHdpZGUgYSBmaW5kZXIgcGF0dGVybiBpcywgd2hlbiB0aGUgZmluZGVyIHBhdHRlcm4KCSAgICAgKiBtYXkgYmUgc2tld2VkIG9yIHJvdGF0ZWQuPC9wPgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5zaXplT2ZCbGFja1doaXRlQmxhY2tSdW4gPSBmdW5jdGlvbiAoZnJvbVggLyppbnQqLywgZnJvbVkgLyppbnQqLywgdG9YIC8qaW50Ki8sIHRvWSAvKmludCovKSB7CgkgICAgICAgIC8vIE1pbGQgdmFyaWFudCBvZiBCcmVzZW5oYW0ncyBhbGdvcml0aG0KCSAgICAgICAgLy8gc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQnJlc2VuaGFtJ3NfbGluZV9hbGdvcml0aG0KCSAgICAgICAgdmFyIHN0ZWVwID0gTWF0aC5hYnModG9ZIC0gZnJvbVkpID4gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICBpZiAoc3RlZXApIHsKCSAgICAgICAgICAgIHZhciB0ZW1wID0gZnJvbVg7CgkgICAgICAgICAgICBmcm9tWCA9IGZyb21ZOwoJICAgICAgICAgICAgZnJvbVkgPSB0ZW1wOwoJICAgICAgICAgICAgdGVtcCA9IHRvWDsKCSAgICAgICAgICAgIHRvWCA9IHRvWTsKCSAgICAgICAgICAgIHRvWSA9IHRlbXA7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGR4ID0gTWF0aC5hYnModG9YIC0gZnJvbVgpOwoJICAgICAgICB2YXIgZHkgPSBNYXRoLmFicyh0b1kgLSBmcm9tWSk7CgkgICAgICAgIHZhciBlcnJvciA9IC1keCAvIDI7CgkgICAgICAgIHZhciB4c3RlcCA9IGZyb21YIDwgdG9YID8gMSA6IC0xOwoJICAgICAgICB2YXIgeXN0ZXAgPSBmcm9tWSA8IHRvWSA/IDEgOiAtMTsKCSAgICAgICAgLy8gSW4gYmxhY2sgcGl4ZWxzLCBsb29raW5nIGZvciB3aGl0ZSwgZmlyc3Qgb3Igc2Vjb25kIHRpbWUuCgkgICAgICAgIHZhciBzdGF0ZSA9IDA7CgkgICAgICAgIC8vIExvb3AgdXAgdW50aWwgeCA9PSB0b1gsIGJ1dCBub3QgYmV5b25kCgkgICAgICAgIHZhciB4TGltaXQgPSB0b1ggKyB4c3RlcDsKCSAgICAgICAgZm9yICh2YXIgeCA9IGZyb21YLCB5ID0gZnJvbVk7IHggIT09IHhMaW1pdDsgeCArPSB4c3RlcCkgewoJICAgICAgICAgICAgdmFyIHJlYWxYID0gc3RlZXAgPyB5IDogeDsKCSAgICAgICAgICAgIHZhciByZWFsWSA9IHN0ZWVwID8geCA6IHk7CgkgICAgICAgICAgICAvLyBEb2VzIGN1cnJlbnQgcGl4ZWwgbWVhbiB3ZSBoYXZlIG1vdmVkIHdoaXRlIHRvIGJsYWNrIG9yIHZpY2UgdmVyc2E/CgkgICAgICAgICAgICAvLyBTY2FubmluZyBibGFjayBpbiBzdGF0ZSAwLDIgYW5kIHdoaXRlIGluIHN0YXRlIDEsIHNvIGlmIHdlIGZpbmQgdGhlIHdyb25nCgkgICAgICAgICAgICAvLyBjb2xvciwgYWR2YW5jZSB0byBuZXh0IHN0YXRlIG9yIGVuZCBpZiB3ZSBhcmUgaW4gc3RhdGUgMiBhbHJlYWR5CgkgICAgICAgICAgICBpZiAoKHN0YXRlID09PSAxKSA9PT0gdGhpcy5pbWFnZS5nZXQocmVhbFgsIHJlYWxZKSkgewoJICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gMikgewoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aFV0aWxzXzEuZGVmYXVsdC5kaXN0YW5jZSh4LCB5LCBmcm9tWCwgZnJvbVkpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBzdGF0ZSsrOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZXJyb3IgKz0gZHk7CgkgICAgICAgICAgICBpZiAoZXJyb3IgPiAwKSB7CgkgICAgICAgICAgICAgICAgaWYgKHkgPT09IHRvWSkgewoJICAgICAgICAgICAgICAgICAgICBicmVhazsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgeSArPSB5c3RlcDsKCSAgICAgICAgICAgICAgICBlcnJvciAtPSBkeDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgICAgICAvLyBGb3VuZCBibGFjay13aGl0ZS1ibGFjazsgZ2l2ZSB0aGUgYmVuZWZpdCBvZiB0aGUgZG91YnQgdGhhdCB0aGUgbmV4dCBwaXhlbCBvdXRzaWRlIHRoZSBpbWFnZQoJICAgICAgICAvLyBpcyAid2hpdGUiIHNvIHRoaXMgbGFzdCBwb2ludCBhdCAodG9YK3hTdGVwLHRvWSkgaXMgdGhlIHJpZ2h0IGVuZGluZy4gVGhpcyBpcyByZWFsbHkgYQoJICAgICAgICAvLyBzbWFsbCBhcHByb3hpbWF0aW9uOyAodG9YK3hTdGVwLHRvWSt5U3RlcCkgbWlnaHQgYmUgcmVhbGx5IGNvcnJlY3QuIElnbm9yZSB0aGlzLgoJICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKCSAgICAgICAgICAgIHJldHVybiBNYXRoVXRpbHNfMS5kZWZhdWx0LmRpc3RhbmNlKHRvWCArIHhzdGVwLCB0b1ksIGZyb21YLCBmcm9tWSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gZWxzZSB3ZSBkaWRuJ3QgZmluZCBldmVuIGJsYWNrLXdoaXRlLWJsYWNrOyBubyBlc3RpbWF0ZSBpcyByZWFsbHkgcG9zc2libGUKCSAgICAgICAgcmV0dXJuIE5hTjsKCSAgICB9OwoJICAgIC8qKgoJICAgICAqIDxwPkF0dGVtcHRzIHRvIGxvY2F0ZSBhbiBhbGlnbm1lbnQgcGF0dGVybiBpbiBhIGxpbWl0ZWQgcmVnaW9uIG9mIHRoZSBpbWFnZSwgd2hpY2ggaXMKCSAgICAgKiBndWVzc2VkIHRvIGNvbnRhaW4gaXQuIFRoaXMgbWV0aG9kIHVzZXMge0BsaW5rIEFsaWdubWVudFBhdHRlcm59LjwvcD4KCSAgICAgKgoJICAgICAqIEBwYXJhbSBvdmVyYWxsRXN0TW9kdWxlU2l6ZSBlc3RpbWF0ZWQgbW9kdWxlIHNpemUgc28gZmFyCgkgICAgICogQHBhcmFtIGVzdEFsaWdubWVudFggeCBjb29yZGluYXRlIG9mIGNlbnRlciBvZiBhcmVhIHByb2JhYmx5IGNvbnRhaW5pbmcgYWxpZ25tZW50IHBhdHRlcm4KCSAgICAgKiBAcGFyYW0gZXN0QWxpZ25tZW50WSB5IGNvb3JkaW5hdGUgb2YgYWJvdmUKCSAgICAgKiBAcGFyYW0gYWxsb3dhbmNlRmFjdG9yIG51bWJlciBvZiBwaXhlbHMgaW4gYWxsIGRpcmVjdGlvbnMgdG8gc2VhcmNoIGZyb20gdGhlIGNlbnRlcgoJICAgICAqIEByZXR1cm4ge0BsaW5rIEFsaWdubWVudFBhdHRlcm59IGlmIGZvdW5kLCBvciBudWxsIG90aGVyd2lzZQoJICAgICAqIEB0aHJvd3MgTm90Rm91bmRFeGNlcHRpb24gaWYgYW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnMgZHVyaW5nIGRldGVjdGlvbgoJICAgICAqLwoJICAgIERldGVjdG9yLnByb3RvdHlwZS5maW5kQWxpZ25tZW50SW5SZWdpb24gPSBmdW5jdGlvbiAob3ZlcmFsbEVzdE1vZHVsZVNpemUgLypmbG9hdCovLCBlc3RBbGlnbm1lbnRYIC8qaW50Ki8sIGVzdEFsaWdubWVudFkgLyppbnQqLywgYWxsb3dhbmNlRmFjdG9yIC8qZmxvYXQqLykgewoJICAgICAgICAvLyBMb29rIGZvciBhbiBhbGlnbm1lbnQgcGF0dGVybiAoMyBtb2R1bGVzIGluIHNpemUpIGFyb3VuZCB3aGVyZSBpdAoJICAgICAgICAvLyBzaG91bGQgYmUKCSAgICAgICAgdmFyIGFsbG93YW5jZSA9IC8qKGludCkgKi8gTWF0aC5mbG9vcihhbGxvd2FuY2VGYWN0b3IgKiBvdmVyYWxsRXN0TW9kdWxlU2l6ZSk7CgkgICAgICAgIHZhciBhbGlnbm1lbnRBcmVhTGVmdFggPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRYIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFSaWdodFggPSBNYXRoLm1pbih0aGlzLmltYWdlLmdldFdpZHRoKCkgLSAxLCBlc3RBbGlnbm1lbnRYICsgYWxsb3dhbmNlKTsKCSAgICAgICAgaWYgKGFsaWdubWVudEFyZWFSaWdodFggLSBhbGlnbm1lbnRBcmVhTGVmdFggPCBvdmVyYWxsRXN0TW9kdWxlU2l6ZSAqIDMpIHsKCSAgICAgICAgICAgIHRocm93IG5ldyBOb3RGb3VuZEV4Y2VwdGlvbl8xJDEuZGVmYXVsdCgnQWxpZ25tZW50IHRvcCBleGNlZWRzIGVzdGltYXRlZCBtb2R1bGUgc2l6ZS4nKTsKCSAgICAgICAgfQoJICAgICAgICB2YXIgYWxpZ25tZW50QXJlYVRvcFkgPSBNYXRoLm1heCgwLCBlc3RBbGlnbm1lbnRZIC0gYWxsb3dhbmNlKTsKCSAgICAgICAgdmFyIGFsaWdubWVudEFyZWFCb3R0b21ZID0gTWF0aC5taW4odGhpcy5pbWFnZS5nZXRIZWlnaHQoKSAtIDEsIGVzdEFsaWdubWVudFkgKyBhbGxvd2FuY2UpOwoJICAgICAgICBpZiAoYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSA8IG92ZXJhbGxFc3RNb2R1bGVTaXplICogMykgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEkMS5kZWZhdWx0KCdBbGlnbm1lbnQgYm90dG9tIGV4Y2VlZHMgZXN0aW1hdGVkIG1vZHVsZSBzaXplLicpOwoJICAgICAgICB9CgkgICAgICAgIHZhciBhbGlnbm1lbnRGaW5kZXIgPSBuZXcgQWxpZ25tZW50UGF0dGVybkZpbmRlcl8xLmRlZmF1bHQodGhpcy5pbWFnZSwgYWxpZ25tZW50QXJlYUxlZnRYLCBhbGlnbm1lbnRBcmVhVG9wWSwgYWxpZ25tZW50QXJlYVJpZ2h0WCAtIGFsaWdubWVudEFyZWFMZWZ0WCwgYWxpZ25tZW50QXJlYUJvdHRvbVkgLSBhbGlnbm1lbnRBcmVhVG9wWSwgb3ZlcmFsbEVzdE1vZHVsZVNpemUsIHRoaXMucmVzdWx0UG9pbnRDYWxsYmFjayk7CgkgICAgICAgIHJldHVybiBhbGlnbm1lbnRGaW5kZXIuZmluZCgpOwoJICAgIH07CgkgICAgcmV0dXJuIERldGVjdG9yOwoJfSgpKTsKCURldGVjdG9yJDEuZGVmYXVsdCA9IERldGVjdG9yOwoKCS8qCgkgKiBDb3B5cmlnaHQgMjAwNyBaWGluZyBhdXRob3JzCgkgKgoJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKCSAqCgkgKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCglPYmplY3QuZGVmaW5lUHJvcGVydHkoUVJDb2RlUmVhZGVyJDEsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKCS8qbmFtZXNwYWNlIGNvbS5nb29nbGUuenhpbmcucXJjb2RlIHsqLwoJdmFyIEJhcmNvZGVGb3JtYXRfMSA9IEJhcmNvZGVGb3JtYXQkMTsKCXZhciBCaXRNYXRyaXhfMSA9IEJpdE1hdHJpeCQxOwoJdmFyIERlY29kZUhpbnRUeXBlXzEgPSBEZWNvZGVIaW50VHlwZSQxOwoJdmFyIE5vdEZvdW5kRXhjZXB0aW9uXzEgPSBOb3RGb3VuZEV4Y2VwdGlvbiQxOwoJdmFyIFJlc3VsdF8xID0gUmVzdWx0JDE7Cgl2YXIgUmVzdWx0TWV0YWRhdGFUeXBlXzEgPSBSZXN1bHRNZXRhZGF0YVR5cGUkMTsKCS8vIGltcG9ydCBEZXRlY3RvclJlc3VsdCBmcm9tICcuLi9jb21tb24vRGV0ZWN0b3JSZXN1bHQnOwoJdmFyIERlY29kZXJfMSA9IERlY29kZXIkMTsKCXZhciBRUkNvZGVEZWNvZGVyTWV0YURhdGFfMSA9IFFSQ29kZURlY29kZXJNZXRhRGF0YSQxOwoJdmFyIERldGVjdG9yXzEgPSBEZXRlY3RvciQxOwoJLyppbXBvcnQgamF2YS51dGlsLkxpc3Q7Ki8KCS8qaW1wb3J0IGphdmEudXRpbC5NYXA7Ki8KCS8qKgoJICogVGhpcyBpbXBsZW1lbnRhdGlvbiBjYW4gZGV0ZWN0IGFuZCBkZWNvZGUgUVIgQ29kZXMgaW4gYW4gaW1hZ2UuCgkgKgoJICogQGF1dGhvciBTZWFuIE93ZW4KCSAqLwoJdmFyIFFSQ29kZVJlYWRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHsKCSAgICBmdW5jdGlvbiBRUkNvZGVSZWFkZXIoKSB7CgkgICAgICAgIHRoaXMuZGVjb2RlciA9IG5ldyBEZWNvZGVyXzEuZGVmYXVsdCgpOwoJICAgIH0KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmdldERlY29kZXIgPSBmdW5jdGlvbiAoKSB7CgkgICAgICAgIHJldHVybiB0aGlzLmRlY29kZXI7CgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBMb2NhdGVzIGFuZCBkZWNvZGVzIGEgUVIgY29kZSBpbiBhbiBpbWFnZS4KCSAgICAgKgoJICAgICAqIEByZXR1cm4gYSByZXByZXNlbnRpbmc6IHN0cmluZyB0aGUgY29udGVudCBlbmNvZGVkIGJ5IHRoZSBRUiBjb2RlCgkgICAgICogQHRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiBpZiBhIFFSIGNvZGUgY2Fubm90IGJlIGZvdW5kCgkgICAgICogQHRocm93cyBGb3JtYXRFeGNlcHRpb24gaWYgYSBRUiBjb2RlIGNhbm5vdCBiZSBkZWNvZGVkCgkgICAgICogQHRocm93cyBDaGVja3N1bUV4Y2VwdGlvbiBpZiBlcnJvciBjb3JyZWN0aW9uIGZhaWxzCgkgICAgICovCgkgICAgLypAT3ZlcnJpZGUqLwoJICAgIC8vIHB1YmxpYyBkZWNvZGUoaW1hZ2U6IEJpbmFyeUJpdG1hcCk6IFJlc3VsdCAvKnRocm93cyBOb3RGb3VuZEV4Y2VwdGlvbiwgQ2hlY2tzdW1FeGNlcHRpb24sIEZvcm1hdEV4Y2VwdGlvbiAqLyB7CgkgICAgLy8gICByZXR1cm4gdGhpcy5kZWNvZGUoaW1hZ2UsIG51bGwpCgkgICAgLy8gfQoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChpbWFnZSwgaGludHMpIHsKCSAgICAgICAgdmFyIGRlY29kZXJSZXN1bHQ7CgkgICAgICAgIHZhciBwb2ludHM7CgkgICAgICAgIGlmIChoaW50cyAhPT0gdW5kZWZpbmVkICYmIGhpbnRzICE9PSBudWxsICYmIHVuZGVmaW5lZCAhPT0gaGludHMuZ2V0KERlY29kZUhpbnRUeXBlXzEuZGVmYXVsdC5QVVJFX0JBUkNPREUpKSB7CgkgICAgICAgICAgICB2YXIgYml0cyA9IFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMoaW1hZ2UuZ2V0QmxhY2tNYXRyaXgoKSk7CgkgICAgICAgICAgICBkZWNvZGVyUmVzdWx0ID0gdGhpcy5kZWNvZGVyLmRlY29kZUJpdE1hdHJpeChiaXRzLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgdmFyIGRldGVjdG9yUmVzdWx0ID0gbmV3IERldGVjdG9yXzEuZGVmYXVsdChpbWFnZS5nZXRCbGFja01hdHJpeCgpKS5kZXRlY3QoaGludHMpOwoJICAgICAgICAgICAgZGVjb2RlclJlc3VsdCA9IHRoaXMuZGVjb2Rlci5kZWNvZGVCaXRNYXRyaXgoZGV0ZWN0b3JSZXN1bHQuZ2V0Qml0cygpLCBoaW50cyk7CgkgICAgICAgICAgICBwb2ludHMgPSBkZXRlY3RvclJlc3VsdC5nZXRQb2ludHMoKTsKCSAgICAgICAgfQoJICAgICAgICAvLyBJZiB0aGUgY29kZSB3YXMgbWlycm9yZWQ6IHN3YXAgdGhlIGJvdHRvbS1sZWZ0IGFuZCB0aGUgdG9wLXJpZ2h0IHBvaW50cy4KCSAgICAgICAgaWYgKGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKSBpbnN0YW5jZW9mIFFSQ29kZURlY29kZXJNZXRhRGF0YV8xLmRlZmF1bHQpIHsKCSAgICAgICAgICAgIGRlY29kZXJSZXN1bHQuZ2V0T3RoZXIoKS5hcHBseU1pcnJvcmVkQ29ycmVjdGlvbihwb2ludHMpOwoJICAgICAgICB9CgkgICAgICAgIHZhciByZXN1bHQgPSBuZXcgUmVzdWx0XzEuZGVmYXVsdChkZWNvZGVyUmVzdWx0LmdldFRleHQoKSwgZGVjb2RlclJlc3VsdC5nZXRSYXdCeXRlcygpLCB1bmRlZmluZWQsIHBvaW50cywgQmFyY29kZUZvcm1hdF8xLmRlZmF1bHQuUVJfQ09ERSwgdW5kZWZpbmVkKTsKCSAgICAgICAgdmFyIGJ5dGVTZWdtZW50cyA9IGRlY29kZXJSZXN1bHQuZ2V0Qnl0ZVNlZ21lbnRzKCk7CgkgICAgICAgIGlmIChieXRlU2VnbWVudHMgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkJZVEVfU0VHTUVOVFMsIGJ5dGVTZWdtZW50cyk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIGVjTGV2ZWwgPSBkZWNvZGVyUmVzdWx0LmdldEVDTGV2ZWwoKTsKCSAgICAgICAgaWYgKGVjTGV2ZWwgIT09IG51bGwpIHsKCSAgICAgICAgICAgIHJlc3VsdC5wdXRNZXRhZGF0YShSZXN1bHRNZXRhZGF0YVR5cGVfMS5kZWZhdWx0LkVSUk9SX0NPUlJFQ1RJT05fTEVWRUwsIGVjTGV2ZWwpOwoJICAgICAgICB9CgkgICAgICAgIGlmIChkZWNvZGVyUmVzdWx0Lmhhc1N0cnVjdHVyZWRBcHBlbmQoKSkgewoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfU0VRVUVOQ0UsIGRlY29kZXJSZXN1bHQuZ2V0U3RydWN0dXJlZEFwcGVuZFNlcXVlbmNlTnVtYmVyKCkpOwoJICAgICAgICAgICAgcmVzdWx0LnB1dE1ldGFkYXRhKFJlc3VsdE1ldGFkYXRhVHlwZV8xLmRlZmF1bHQuU1RSVUNUVVJFRF9BUFBFTkRfUEFSSVRZLCBkZWNvZGVyUmVzdWx0LmdldFN0cnVjdHVyZWRBcHBlbmRQYXJpdHkoKSk7CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIHJlc3VsdDsKCSAgICB9OwoJICAgIC8qQE92ZXJyaWRlKi8KCSAgICBRUkNvZGVSZWFkZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgewoJICAgICAgICAvLyBkbyBub3RoaW5nCgkgICAgfTsKCSAgICAvKioKCSAgICAgKiBUaGlzIG1ldGhvZCBkZXRlY3RzIGEgY29kZSBpbiBhICJwdXJlIiBpbWFnZSAtLSB0aGF0IGlzLCBwdXJlIG1vbm9jaHJvbWUgaW1hZ2UKCSAgICAgKiB3aGljaCBjb250YWlucyBvbmx5IGFuIHVucm90YXRlZCwgdW5za2V3ZWQsIGltYWdlIG9mIGEgY29kZSwgd2l0aCBzb21lIHdoaXRlIGJvcmRlcgoJICAgICAqIGFyb3VuZCBpdC4gVGhpcyBpcyBhIHNwZWNpYWxpemVkIG1ldGhvZCB0aGF0IHdvcmtzIGV4Y2VwdGlvbmFsbHkgZmFzdCBpbiB0aGlzIHNwZWNpYWwKCSAgICAgKiBjYXNlLgoJICAgICAqCgkgICAgICogQHNlZSBjb20uZ29vZ2xlLnp4aW5nLmRhdGFtYXRyaXguRGF0YU1hdHJpeFJlYWRlciNleHRyYWN0UHVyZUJpdHMoQml0TWF0cml4KQoJICAgICAqLwoJICAgIFFSQ29kZVJlYWRlci5leHRyYWN0UHVyZUJpdHMgPSBmdW5jdGlvbiAoaW1hZ2UpIHsKCSAgICAgICAgdmFyIGxlZnRUb3BCbGFjayA9IGltYWdlLmdldFRvcExlZnRPbkJpdCgpOwoJICAgICAgICB2YXIgcmlnaHRCb3R0b21CbGFjayA9IGltYWdlLmdldEJvdHRvbVJpZ2h0T25CaXQoKTsKCSAgICAgICAgaWYgKGxlZnRUb3BCbGFjayA9PT0gbnVsbCB8fCByaWdodEJvdHRvbUJsYWNrID09PSBudWxsKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1vZHVsZVNpemUgPSB0aGlzLm1vZHVsZVNpemUobGVmdFRvcEJsYWNrLCBpbWFnZSk7CgkgICAgICAgIHZhciB0b3AgPSBsZWZ0VG9wQmxhY2tbMV07CgkgICAgICAgIHZhciBib3R0b20gPSByaWdodEJvdHRvbUJsYWNrWzFdOwoJICAgICAgICB2YXIgbGVmdCA9IGxlZnRUb3BCbGFja1swXTsKCSAgICAgICAgdmFyIHJpZ2h0ID0gcmlnaHRCb3R0b21CbGFja1swXTsKCSAgICAgICAgLy8gU2FuaXR5IGNoZWNrIQoJICAgICAgICBpZiAobGVmdCA+PSByaWdodCB8fCB0b3AgPj0gYm90dG9tKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKGJvdHRvbSAtIHRvcCAhPT0gcmlnaHQgLSBsZWZ0KSB7CgkgICAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UsIHdoZXJlIGJvdHRvbS1yaWdodCBtb2R1bGUgd2Fzbid0IGJsYWNrIHNvIHdlIGZvdW5kIHNvbWV0aGluZyBlbHNlIGluIHRoZSBsYXN0IHJvdwoJICAgICAgICAgICAgLy8gQXNzdW1lIGl0J3MgYSBzcXVhcmUsIHNvIHVzZSBoZWlnaHQgYXMgdGhlIHdpZHRoCgkgICAgICAgICAgICByaWdodCA9IGxlZnQgKyAoYm90dG9tIC0gdG9wKTsKCSAgICAgICAgICAgIGlmIChyaWdodCA+PSBpbWFnZS5nZXRXaWR0aCgpKSB7CgkgICAgICAgICAgICAgICAgLy8gQWJvcnQgaWYgdGhhdCB3b3VsZCBub3QgbWFrZSBzZW5zZSAtLSBvZmYgaW1hZ2UKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgdmFyIG1hdHJpeFdpZHRoID0gTWF0aC5yb3VuZCgocmlnaHQgLSBsZWZ0ICsgMSkgLyBtb2R1bGVTaXplKTsKCSAgICAgICAgdmFyIG1hdHJpeEhlaWdodCA9IE1hdGgucm91bmQoKGJvdHRvbSAtIHRvcCArIDEpIC8gbW9kdWxlU2l6ZSk7CgkgICAgICAgIGlmIChtYXRyaXhXaWR0aCA8PSAwIHx8IG1hdHJpeEhlaWdodCA8PSAwKSB7CgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKG1hdHJpeEhlaWdodCAhPT0gbWF0cml4V2lkdGgpIHsKCSAgICAgICAgICAgIC8vIE9ubHkgcG9zc2libHkgZGVjb2RlIHNxdWFyZSByZWdpb25zCgkgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gUHVzaCBpbiB0aGUgImJvcmRlciIgYnkgaGFsZiB0aGUgbW9kdWxlIHdpZHRoIHNvIHRoYXQgd2Ugc3RhcnQKCSAgICAgICAgLy8gc2FtcGxpbmcgaW4gdGhlIG1pZGRsZSBvZiB0aGUgbW9kdWxlLiBKdXN0IGluIGNhc2UgdGhlIGltYWdlIGlzIGEKCSAgICAgICAgLy8gbGl0dGxlIG9mZiwgdGhpcyB3aWxsIGhlbHAgcmVjb3Zlci4KCSAgICAgICAgdmFyIG51ZGdlID0gLyooaW50KSAqLyBNYXRoLmZsb29yKG1vZHVsZVNpemUgLyAyLjApOwoJICAgICAgICB0b3AgKz0gbnVkZ2U7CgkgICAgICAgIGxlZnQgKz0gbnVkZ2U7CgkgICAgICAgIC8vIEJ1dCBjYXJlZnVsIHRoYXQgdGhpcyBkb2VzIG5vdCBzYW1wbGUgb2ZmIHRoZSBlZGdlCgkgICAgICAgIC8vICJyaWdodCIgaXMgdGhlIGZhcnRoZXN0LXJpZ2h0IHZhbGlkIHBpeGVsIGxvY2F0aW9uIC0tIHJpZ2h0KzEgaXMgbm90IG5lY2Vzc2FyaWx5CgkgICAgICAgIC8vIFRoaXMgaXMgcG9zaXRpdmUgYnkgaG93IG11Y2ggdGhlIGlubmVyIHggbG9vcCBiZWxvdyB3b3VsZCBiZSB0b28gbGFyZ2UKCSAgICAgICAgdmFyIG51ZGdlZFRvb0ZhclJpZ2h0ID0gbGVmdCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4V2lkdGggLSAxKSAqIG1vZHVsZVNpemUpIC0gcmlnaHQ7CgkgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IDApIHsKCSAgICAgICAgICAgIGlmIChudWRnZWRUb29GYXJSaWdodCA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBsZWZ0IC09IG51ZGdlZFRvb0ZhclJpZ2h0OwoJICAgICAgICB9CgkgICAgICAgIC8vIFNlZSBsb2dpYyBhYm92ZQoJICAgICAgICB2YXIgbnVkZ2VkVG9vRmFyRG93biA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcigobWF0cml4SGVpZ2h0IC0gMSkgKiBtb2R1bGVTaXplKSAtIGJvdHRvbTsKCSAgICAgICAgaWYgKG51ZGdlZFRvb0ZhckRvd24gPiAwKSB7CgkgICAgICAgICAgICBpZiAobnVkZ2VkVG9vRmFyRG93biA+IG51ZGdlKSB7CgkgICAgICAgICAgICAgICAgLy8gTmVpdGhlciB3YXkgZml0czsgYWJvcnQKCSAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTm90Rm91bmRFeGNlcHRpb25fMS5kZWZhdWx0KCk7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB0b3AgLT0gbnVkZ2VkVG9vRmFyRG93bjsKCSAgICAgICAgfQoJICAgICAgICAvLyBOb3cganVzdCByZWFkIG9mZiB0aGUgYml0cwoJICAgICAgICB2YXIgYml0cyA9IG5ldyBCaXRNYXRyaXhfMS5kZWZhdWx0KG1hdHJpeFdpZHRoLCBtYXRyaXhIZWlnaHQpOwoJICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1hdHJpeEhlaWdodDsgeSsrKSB7CgkgICAgICAgICAgICB2YXIgaU9mZnNldCA9IHRvcCArIC8qKGludCkgKi8gTWF0aC5mbG9vcih5ICogbW9kdWxlU2l6ZSk7CgkgICAgICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1hdHJpeFdpZHRoOyB4KyspIHsKCSAgICAgICAgICAgICAgICBpZiAoaW1hZ2UuZ2V0KGxlZnQgKyAvKihpbnQpICovIE1hdGguZmxvb3IoeCAqIG1vZHVsZVNpemUpLCBpT2Zmc2V0KSkgewoJICAgICAgICAgICAgICAgICAgICBiaXRzLnNldCh4LCB5KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICAgICAgcmV0dXJuIGJpdHM7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIubW9kdWxlU2l6ZSA9IGZ1bmN0aW9uIChsZWZ0VG9wQmxhY2ssIGltYWdlKSB7CgkgICAgICAgIHZhciBoZWlnaHQgPSBpbWFnZS5nZXRIZWlnaHQoKTsKCSAgICAgICAgdmFyIHdpZHRoID0gaW1hZ2UuZ2V0V2lkdGgoKTsKCSAgICAgICAgdmFyIHggPSBsZWZ0VG9wQmxhY2tbMF07CgkgICAgICAgIHZhciB5ID0gbGVmdFRvcEJsYWNrWzFdOwoJICAgICAgICB2YXIgaW5CbGFjayA9IHRydWU7CgkgICAgICAgIHZhciB0cmFuc2l0aW9ucyA9IDA7CgkgICAgICAgIHdoaWxlICh4IDwgd2lkdGggJiYgeSA8IGhlaWdodCkgewoJICAgICAgICAgICAgaWYgKGluQmxhY2sgIT09IGltYWdlLmdldCh4LCB5KSkgewoJICAgICAgICAgICAgICAgIGlmICgrK3RyYW5zaXRpb25zID09PSA1KSB7CgkgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICBpbkJsYWNrID0gIWluQmxhY2s7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICB4Kys7CgkgICAgICAgICAgICB5Kys7CgkgICAgICAgIH0KCSAgICAgICAgaWYgKHggPT09IHdpZHRoIHx8IHkgPT09IGhlaWdodCkgewoJICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEZvdW5kRXhjZXB0aW9uXzEuZGVmYXVsdCgpOwoJICAgICAgICB9CgkgICAgICAgIHJldHVybiAoeCAtIGxlZnRUb3BCbGFja1swXSkgLyA3LjA7CgkgICAgfTsKCSAgICBRUkNvZGVSZWFkZXIuTk9fUE9JTlRTID0gbmV3IEFycmF5KCk7CgkgICAgcmV0dXJuIFFSQ29kZVJlYWRlcjsKCX0oKSk7Cgl2YXIgX2RlZmF1bHQgPSBRUkNvZGVSZWFkZXIkMS5kZWZhdWx0ID0gUVJDb2RlUmVhZGVyOwoKCXZhciB0b0dyYXlzY2FsZUJ1ZmZlciA9IGZ1bmN0aW9uIHRvR3JheXNjYWxlQnVmZmVyKGltYWdlQnVmZmVyLCB3aWR0aCwgaGVpZ2h0KSB7CgkgIHZhciBncmF5c2NhbGVCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQpOwoKCSAgZm9yICh2YXIgaSA9IDAsIGogPSAwLCBsZW5ndGhfMSA9IGltYWdlQnVmZmVyLmxlbmd0aDsgaSA8IGxlbmd0aF8xOyBpICs9IDQsIGorKykgewoJICAgIHZhciBncmF5ID0gdm9pZCAwOwoJICAgIHZhciBhbHBoYSA9IGltYWdlQnVmZmVyW2kgKyAzXTsgLy8gVGhlIGNvbG9yIG9mIGZ1bGx5LXRyYW5zcGFyZW50IHBpeGVscyBpcyBpcnJlbGV2YW50LiBUaGV5IGFyZSBvZnRlbiwgdGVjaG5pY2FsbHksIGZ1bGx5LXRyYW5zcGFyZW50CgkgICAgLy8gYmxhY2sgKDAgYWxwaGEsIGFuZCB0aGVuIDAgUkdCKS4gVGhleSBhcmUgb2Z0ZW4gdXNlZCwgb2YgY291cnNlIGFzIHRoZSAid2hpdGUiIGFyZWEgaW4gYQoJICAgIC8vIGJhcmNvZGUgaW1hZ2UuIEZvcmNlIGFueSBzdWNoIHBpeGVsIHRvIGJlIHdoaXRlOgoKCSAgICBpZiAoYWxwaGEgPT09IDApIHsKCSAgICAgIGdyYXkgPSAweEZGOwoJICAgIH0gZWxzZSB7CgkgICAgICB2YXIgcGl4ZWxSID0gaW1hZ2VCdWZmZXJbaV07CgkgICAgICB2YXIgcGl4ZWxHID0gaW1hZ2VCdWZmZXJbaSArIDFdOwoJICAgICAgdmFyIHBpeGVsQiA9IGltYWdlQnVmZmVyW2kgKyAyXTsgLy8gLjI5OVIgKyAwLjU4N0cgKyAwLjExNEIgKFlVVi9ZSVEgZm9yIFBBTCBhbmQgTlRTQyksCgkgICAgICAvLyAoMzA2KlIpID4+IDEwIGlzIGFwcHJveGltYXRlbHkgZXF1YWwgdG8gUiowLjI5OSwgYW5kIHNvIG9uLgoJICAgICAgLy8gMHgyMDAgPj4gMTAgaXMgMC41LCBpdCBpbXBsZW1lbnRzIHJvdW5kaW5nLgoKCSAgICAgIGdyYXkgPSAzMDYgKiBwaXhlbFIgKyA2MDEgKiBwaXhlbEcgKyAxMTcgKiBwaXhlbEIgKyAweDIwMCA+PiAxMDsKCSAgICB9CgoJICAgIGdyYXlzY2FsZUJ1ZmZlcltqXSA9IGdyYXk7CgkgIH0KCgkgIHJldHVybiBncmF5c2NhbGVCdWZmZXI7Cgl9OwoKCXZhciByZWFkZXIgPSBuZXcgX2RlZmF1bHQoKTsKCXNlbGYuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uIChlKSB7CgkgIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzCgkgIHRyeSB7CgkgICAgdmFyIGx1bWluYW5jZXMgPSB0b0dyYXlzY2FsZUJ1ZmZlcihlLmRhdGEuZGF0YSwgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgbHVtaW5hbmNlU291cmNlID0gbmV3IF9kZWZhdWx0JDEobHVtaW5hbmNlcywgZS5kYXRhLndpZHRoLCBlLmRhdGEuaGVpZ2h0KTsKCSAgICB2YXIgaHlicmlkQmluYXJpemVyID0gbmV3IF9kZWZhdWx0JDIobHVtaW5hbmNlU291cmNlKTsKCSAgICB2YXIgYmluYXJ5Qml0bWFwID0gbmV3IF9kZWZhdWx0JDMoaHlicmlkQmluYXJpemVyKTsKCSAgICB2YXIgZGVjb2RlZCA9IHJlYWRlci5kZWNvZGUoYmluYXJ5Qml0bWFwKTsKCSAgICBwb3N0TWVzc2FnZShkZWNvZGVkKTsKCSAgfSBjYXRjaCAoZXJyKSB7CgkgICAgcG9zdE1lc3NhZ2UobnVsbCk7CgkgIH0KCX0pOwoKfSkoKTsKCg==",function(e){return gf=gf||tf(nf),new Worker(gf,e)}),of=["constraints","onError","onLoad","onScan","resolution","qrArea"];function sf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(e);t&&(g=g.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,g)}return n}function af(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sf(Object(n),!0).forEach((function(t){RZ(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var If=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().forEach((function(t){e.removeTrack(t),t.stop()})),e.getAudioTracks().forEach((function(t){e.removeTrack(t),t.stop()}))):e.stop())},lf=function(t){var n=t.constraints,g=t.onError,r=t.onLoad,i=t.onScan,o=t.resolution,s=t.qrArea,a=function(e,t){if(null==e)return{};var n,g,r=function(e,t){if(null==e)return{};var n={};for(var g in e)if({}.hasOwnProperty.call(e,g)){if(-1!==t.indexOf(g))continue;n[g]=e[g]}return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(g=0;g<i.length;g++)n=i[g],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(t,of),I=e.useRef(null),l=e.useRef(null),C=e.useRef(document.createElement("canvas")),c=e.useRef(null),d=e.useRef(),u=VZ(e.useState(null),2),A=u[0],h=u[1],m=e.useRef(!1),b=e.useRef();e.useEffect((function(){b.current=new rf;var e=b.current;return e.onmessage=function(e){i&&i(e.data?af(af({},e.data),{},{canvas:C.current}):null),m.current=!1},function(){e.terminate()}}),[i]);var p=JSON.stringify(s),y=e.useCallback((function(){var e=JSON.parse(p),t=b.current,n=l.current&&l.current.readyState===l.current.HAVE_ENOUGH_DATA;if(!m.current&&n){m.current=!0;var g,r=l.current.videoWidth,i=l.current.videoHeight,s=r>i?r:i,a=Math.floor(o/s*100)/100;i=Math.floor(a*i),r=Math.floor(a*r),C.current.width=r,C.current.height=i,c.current=C.current.getContext("2d"),c.current.drawImage(l.current,0,0,r,i),g=e&&2===e.length&&e[0]>0&&e[1]>0?c.current.getImageData(Math.floor((r-e[0])/2),Math.floor((i-e[1])/2),e[0],e[1]):c.current.getImageData(0,0,r,i),t.postMessage(g)}d.current=requestAnimationFrame(y)}),[o,p]),Z=JSON.stringify(n);return e.useEffect((function(){var e=JSON.parse(Z),t=!0;return navigator.mediaDevices.getUserMedia(e).then((function(e){if(t){I.current=e;try{l.current&&(l.current.srcObject=e,l.current.setAttribute("playsinline",!0))}catch(Vye){h(window.URL.createObjectURL(e))}r&&r(),d.current=requestAnimationFrame(y)}else If(e)})).catch((function(e){return t?g(e):null})),function(){cancelAnimationFrame(d.current),t=!1,If(I.current),A&&window.URL.revokeObjectURL(A)}}),[y,Z,g,r,A]),e.createElement("video",GZ({autoPlay:!0,playsInline:!0,src:A,ref:l},a))};lf.propTypes={constraints:ef.object,onError:ef.func.isRequired,onLoad:ef.func,onScan:ef.func.isRequired,resolution:ef.number,qrArea:ef.array},lf.defaultProps={constraints:{audio:!1,video:!0},resolution:640,qrArea:[]};const Cf=({onScanComplete:t})=>{const[n,g]=e.useState(!0),[r,i]=e.useState(null),[o,s]=e.useState(null),[a,I]=e.useState(null),[l,C]=e.useState(!1),c=e.useRef(null),d=()=>{g(!0),s(null),I(null),i(null)};return p.jsxs("div",{className:"w-full",children:[p.jsx(wt,{variant:"elegant",className:"overflow-hidden",children:p.jsx(wt.Body,{className:"p-0",children:n?p.jsxs("div",{className:"relative",children:[p.jsx(lf,{ref:c,onScan:async e=>{if(e&&e.text&&!l){g(!1),C(!0);try{const n=e.text;s(n);const g=await Sp.getGuestById(n);g?(I(g),await Sp.recordScan(n,{location:"Entrée",userAgent:navigator.userAgent,manual:!1}),t&&t(g)):i("Invité non trouvé. QR code invalide.")}catch(n){i("Erreur lors du scan. Veuillez réessayer.")}finally{C(!1)}}},onError:e=>{i("Erreur d'accès à la caméra. Vérifiez vos permissions.")},delay:300,constraints:{video:{facingMode:"environment"}},style:{width:"100%",height:"auto",borderRadius:"0.5rem"}}),p.jsx("div",{className:"absolute inset-0 border-2 border-primary pointer-events-none",style:{borderRadius:"0.25rem",boxShadow:"inset 0 0 0 3px rgba(139, 93, 51, 0.5)"}})]}):p.jsx("div",{className:"p-4",children:l?p.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[p.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"}),p.jsx("p",{className:"mt-4 text-primary",children:"Chargement des informations..."})]}):a?p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"bg-primary/10 p-4 rounded-lg",children:[p.jsx("h3",{className:"text-xl font-elegant text-primary-dark",children:a.name}),p.jsxs("p",{className:"text-muted",children:["Groupe: ",a.group]}),p.jsxs("div",{className:"flex items-center mt-2",children:[p.jsxs("span",{className:"mr-2 text-sm",children:[a.count," personne(s)"]}),p.jsx("span",{className:"text-sm bg-primary/20 py-1 px-2 rounded-full ml-auto",children:a.scanCount>0?`Scannés ${a.scanCount} fois`:"Premier scan"})]})]}),p.jsxs("div",{className:"flex items-center justify-between bg-highlight p-3 rounded-lg",children:[p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"w-3 h-3 rounded-full mr-2 "+(a.scanned?"bg-success":"bg-primary")}),p.jsx("span",{className:"text-sm",children:a.scanned?"Déjà scannés":"Première entrée"})]}),p.jsx("span",{className:"text-xs text-muted",children:a.lastScan?new Date(a.lastScan.toDate()).toLocaleString():"Jamais"})]}),p.jsx(Pe,{onClick:d,variant:"primary",className:"w-full",children:"Scanner un autre QR code"})]}):p.jsxs("div",{className:"text-center py-4",children:[r?p.jsx("div",{className:"text-danger mb-4",children:r}):p.jsx("div",{className:"text-muted",children:"Aucun résultat"}),p.jsx(Pe,{onClick:d,variant:"primary",className:"mt-4",children:"Réessayer"})]})})})}),n&&p.jsx("p",{className:"text-center text-sm text-muted mt-4",children:"Placez le QR code de l'invitation dans le cadre pour le scanner"})]})},cf=()=>{const[t,n]=e.useState({totalScanned:0,totalGuests:0,recentScans:[]}),[g,r]=e.useState(!0),[i,o]=e.useState(!1),[s,a]=e.useState(""),[I,l]=e.useState([]);e.useEffect((()=>{const e=async()=>{try{const e=await Sp.getAllGuests(),t=await Sp.getAllScans(),g=e.filter((e=>e.scanned)),r=e.reduce(((e,t)=>e+t.count),0),i=[...t].sort(((e,t)=>{var n,g;return(null==(n=t.timestamp)?void 0:n.toDate())-(null==(g=e.timestamp)?void 0:g.toDate())}));n({totalScanned:g.length,totalGuests:e.length,totalPersons:r,scannedPersons:g.reduce(((e,t)=>e+t.count),0),recentScans:i.slice(0,5)})}catch(Vye){}finally{r(!1)}};e();const t=setInterval(e,3e4);return()=>clearInterval(t)}),[]);const C=e=>{n((t=>({...t,totalScanned:t.totalScanned+(e.scanned?0:1),recentScans:[{guestId:e.id,timestamp:new Date,guest:e},...t.recentScans].slice(0,5)})))},c=async()=>{if(!(s.trim().length<2)){r(!0);try{const e=(await Sp.getAllGuests()).filter((e=>e.name.toLowerCase().includes(s.toLowerCase())||e.group.toLowerCase().includes(s.toLowerCase())));l(e)}catch(Vye){}finally{r(!1)}}};return p.jsxs("div",{className:"bg-secondary min-h-screen pb-10",children:[p.jsx("header",{className:"bg-primary text-white py-6 px-4",children:p.jsxs("div",{className:"max-w-4xl mx-auto",children:[p.jsx("h1",{className:"font-elegant text-3xl",children:"Scanner d'entrée"}),p.jsx("p",{className:"text-white/70 mt-2",children:"Scannez les invitations à l'entrée du mariage"})]})}),p.jsx("div",{className:"max-w-4xl mx-auto px-4 -mt-6",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsx(df,{title:"Invités scannés",value:t.totalScanned||0,total:t.totalGuests||0,icon:p.jsx("svg",{className:"w-8 h-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),p.jsx(df,{title:"Personnes présentes",value:t.scannedPersons||0,total:t.totalPersons||0,icon:p.jsx("svg",{className:"w-8 h-8 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})})]})}),p.jsx("div",{className:"max-w-4xl mx-auto px-4 mt-8",children:p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[p.jsxs("div",{className:"md:col-span-2",children:[p.jsxs("div",{className:"flex justify-between items-center mb-4",children:[p.jsx("h2",{className:"font-elegant text-2xl text-primary-dark",children:i?"Entrée manuelle":"Scanner QR Code"}),p.jsx(Pe,{variant:"outline",onClick:()=>o(!i),className:"text-sm",children:i?"Utiliser le scanner":"Entrée manuelle"})]}),i?p.jsx(wt,{variant:"default",className:"p-4",children:p.jsxs("div",{className:"space-y-4",children:[p.jsxs("div",{className:"flex space-x-2",children:[p.jsx("input",{type:"text",className:"block w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-primary focus:border-primary bg-white text-primary-dark",placeholder:"Rechercher un invité...",value:s,onChange:e=>a(e.target.value),onKeyDown:e=>"Enter"===e.key&&c()}),p.jsx(Pe,{variant:"primary",onClick:c,disabled:g,children:"Rechercher"})]}),p.jsx("div",{className:"mt-4 space-y-2",children:I.length>0?I.map((e=>p.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 flex justify-between items-center bg-white",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"font-medium text-primary-dark",children:e.name}),p.jsxs("div",{className:"text-sm text-muted",children:[p.jsx("span",{children:e.group}),p.jsx("span",{className:"mx-2",children:"•"}),p.jsxs("span",{children:[e.count," personne(s)"]})]})]}),p.jsx(Pe,{variant:e.scanned?"outline":"primary",onClick:()=>(async e=>{try{await Sp.recordScan(e.id,{location:"Entrée",manual:!0,userAgent:navigator.userAgent}),l((t=>t.map((t=>t.id===e.id?{...t,scanned:!0,scanCount:(t.scanCount||0)+1}:t)))),C(e)}catch(Vye){}})(e),className:"text-sm",disabled:g,children:e.scanned?`Rescan (${e.scanCount})`:"Enregistrer"})]},e.id))):s&&!g?p.jsx("div",{className:"text-center py-4 text-muted",children:"Aucun invité trouvé"}):null})]})}):p.jsx(Cf,{onScanComplete:C})]}),p.jsxs("div",{children:[p.jsx("h2",{className:"font-elegant text-2xl text-primary-dark mb-4",children:"Derniers scans"}),p.jsx(wt,{variant:"default",className:"p-4",children:t.recentScans&&t.recentScans.length>0?p.jsx("ul",{className:"divide-y divide-gray-100",children:t.recentScans.map(((e,t)=>{var n,g,r;const i=(null==(n=e.guest)?void 0:n.name)||e.guestId,o=(null==(g=e.guest)?void 0:g.group)||"",s=e.timestamp instanceof Date?e.timestamp:(null==(r=e.timestamp)?void 0:r.toDate)?e.timestamp.toDate():new Date;return p.jsx("li",{className:"py-3",children:p.jsxs("div",{className:"flex items-start",children:[p.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center mr-3",children:p.jsx("svg",{className:"w-4 h-4 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),p.jsxs("div",{children:[p.jsx("p",{className:"font-medium text-primary-dark",children:i}),p.jsx("p",{className:"text-sm text-muted",children:o}),p.jsxs("p",{className:"text-xs text-muted mt-1",children:[s.toLocaleTimeString(),p.jsx("span",{className:"ml-1",children:e.manual?"(Manuel)":""})]})]})]})},t)}))}):p.jsxs("div",{className:"text-center py-8 text-muted",children:[p.jsx("svg",{className:"w-10 h-10 mx-auto mb-2 text-muted/50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),p.jsx("p",{children:"Aucun scan récent"})]})})]})]})})]})},df=({title:e,value:t,total:n,icon:g})=>{const r=n?Math.round(t/n*100):0;return p.jsx(wt,{variant:"elegant",className:"transform hover:-translate-y-1 transition-transform duration-300",children:p.jsx(wt.Body,{className:"p-5",children:p.jsxs("div",{className:"flex items-center",children:[p.jsx("div",{className:"mr-4 bg-primary/10 p-3 rounded-full",children:g}),p.jsxs("div",{children:[p.jsx("h3",{className:"text-lg font-medium text-primary-dark",children:e}),p.jsxs("div",{className:"flex items-end",children:[p.jsxs("p",{className:"text-2xl font-semibold text-primary-dark",children:[t," ",p.jsxs("span",{className:"text-sm font-normal text-muted",children:["/ ",n]})]}),p.jsxs("span",{className:"ml-2 text-sm text-primary/80 mb-1",children:["(",r,"%)"]})]})]})]})})})};var uf,Af;(Af=uf||(uf={}))[Af.QR_CODE=0]="QR_CODE",Af[Af.AZTEC=1]="AZTEC",Af[Af.CODABAR=2]="CODABAR",Af[Af.CODE_39=3]="CODE_39",Af[Af.CODE_93=4]="CODE_93",Af[Af.CODE_128=5]="CODE_128",Af[Af.DATA_MATRIX=6]="DATA_MATRIX",Af[Af.MAXICODE=7]="MAXICODE",Af[Af.ITF=8]="ITF",Af[Af.EAN_13=9]="EAN_13",Af[Af.EAN_8=10]="EAN_8",Af[Af.PDF_417=11]="PDF_417",Af[Af.RSS_14=12]="RSS_14",Af[Af.RSS_EXPANDED=13]="RSS_EXPANDED",Af[Af.UPC_A=14]="UPC_A",Af[Af.UPC_E=15]="UPC_E",Af[Af.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION";var hf,mf,bf,pf,yf=new Map([[uf.QR_CODE,"QR_CODE"],[uf.AZTEC,"AZTEC"],[uf.CODABAR,"CODABAR"],[uf.CODE_39,"CODE_39"],[uf.CODE_93,"CODE_93"],[uf.CODE_128,"CODE_128"],[uf.DATA_MATRIX,"DATA_MATRIX"],[uf.MAXICODE,"MAXICODE"],[uf.ITF,"ITF"],[uf.EAN_13,"EAN_13"],[uf.EAN_8,"EAN_8"],[uf.PDF_417,"PDF_417"],[uf.RSS_14,"RSS_14"],[uf.RSS_EXPANDED,"RSS_EXPANDED"],[uf.UPC_A,"UPC_A"],[uf.UPC_E,"UPC_E"],[uf.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]);function Zf(e){return Object.values(uf).includes(e)}(mf=hf||(hf={}))[mf.UNKNOWN=0]="UNKNOWN",mf[mf.URL=1]="URL",(pf=bf||(bf={}))[pf.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",pf[pf.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE";var ff,Gf,Bf=function(){function e(){}return e.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",e.SCAN_DEFAULT_FPS=2,e.DEFAULT_DISABLE_FLIP=!1,e.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,e.DEFAULT_SUPPORTED_SCAN_TYPE=[bf.SCAN_TYPE_CAMERA,bf.SCAN_TYPE_FILE],e}(),Sf=function(){function e(e,t){this.format=e,this.formatName=t}return e.prototype.toString=function(){return this.formatName},e.create=function(t){if(!yf.has(t))throw"".concat(t," not in html5QrcodeSupportedFormatsTextMap");return new e(t,yf.get(t))},e}(),Rf=function(){function e(){}return e.createFromText=function(e){return{decodedText:e,result:{text:e}}},e.createFromQrcodeResult=function(e){return{decodedText:e.text,result:e}},e}();(Gf=ff||(ff={}))[Gf.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",Gf[Gf.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",Gf[Gf.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR";var vf=function(){function e(){}return e.createFrom=function(e){return{errorMessage:e,type:ff.UNKWOWN_ERROR}},e}(),Vf=function(){function e(e){this.verbose=e}return e.prototype.log=function(e){this.verbose},e.prototype.warn=function(e){this.verbose},e.prototype.logError=function(e,t){this.verbose},e.prototype.logErrors=function(e){if(0===e.length)throw"Logger#logError called without arguments";this.verbose},e}();function wf(e){return null==e}var Wf=function(){function e(){}return e.codeParseError=function(e){return"QR code parse error, error = ".concat(e)},e.errorGettingUserMedia=function(e){return"Error getting userMedia, error = ".concat(e)},e.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},e.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},e.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},e.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},e.scannerPaused=function(){return"Scanner paused"},e}(),kf=function(){function e(){}return e.scanningStatus=function(){return"Scanning"},e.idleStatus=function(){return"Idle"},e.errorStatus=function(){return"Error"},e.permissionStatus=function(){return"Permission"},e.noCameraFoundErrorStatus=function(){return"No Cameras"},e.lastMatch=function(e){return"Last Match: ".concat(e)},e.codeScannerTitle=function(){return"Code Scanner"},e.cameraPermissionTitle=function(){return"Request Camera Permissions"},e.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},e.noCameraFound=function(){return"No camera found"},e.scanButtonStopScanningText=function(){return"Stop Scanning"},e.scanButtonStartScanningText=function(){return"Start Scanning"},e.torchOnButton=function(){return"Switch On Torch"},e.torchOffButton=function(){return"Switch Off Torch"},e.torchOnFailedMessage=function(){return"Failed to turn on torch"},e.torchOffFailedMessage=function(){return"Failed to turn off torch"},e.scanButtonScanningStarting=function(){return"Launching Camera..."},e.textIfCameraScanSelected=function(){return"Scan an Image File"},e.textIfFileScanSelected=function(){return"Scan using camera directly"},e.selectCamera=function(){return"Select Camera"},e.fileSelectionChooseImage=function(){return"Choose Image"},e.fileSelectionChooseAnother=function(){return"Choose Another"},e.fileSelectionNoImageSelected=function(){return"No image choosen"},e.anonymousCameraPrefix=function(){return"Anonymous Camera"},e.dragAndDropMessage=function(){return"Or drop an image to scan"},e.dragAndDropMessageOnlyImages=function(){return"Or drop an image to scan (other files not supported)"},e.zoom=function(){return"zoom"},e.loadingImage=function(){return"Loading image..."},e.cameraScanAltText=function(){return"Camera based scan"},e.fileScanAltText=function(){return"Fule based scan"},e}(),Xf=function(){function e(){}return e.poweredBy=function(){return"Powered by "},e.reportIssues=function(){return"Report issues"},e}(),Nf=function(){function e(){}return e.isMediaStreamConstraintsValid=function(e,t){if("object"!=typeof e){var n=typeof e;return t.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(n,"."),!0),!1}for(var g=new Set(["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"]),r=0,i=Object.keys(e);r<i.length;r++){var o=i[r];if(g.has(o))return t.logError("".concat(o," is not supported videoConstaints."),!0),!1}return!0},e}(),Jf={exports:{}};!function(e){function t(e){return null==e}var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function g(e,t){function g(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(g.prototype=t.prototype,new g)}function r(e,t){var n=Object.setPrototypeOf;n?n(e,t):e.__proto__=t}function i(e,t){void 0===t&&(t=e.constructor);var n=Error.captureStackTrace;n&&n(e,t)}var s,a,I=function(e){function t(t){var n=this.constructor,g=e.call(this,t)||this;return Object.defineProperty(g,"name",{value:n.name,enumerable:!1}),r(g,n.prototype),i(g),g}return g(t,e),t}(Error);class l extends I{constructor(e=void 0){super(e),this.message=e}getKind(){return this.constructor.kind}}l.kind="Exception";class C extends l{}C.kind="ArgumentException";class c extends l{}c.kind="IllegalArgumentException";class d{constructor(e){if(this.binarizer=e,null===e)throw new c("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(e,t){return this.binarizer.getBlackRow(e,t)}getBlackMatrix(){return null!==this.matrix&&void 0!==this.matrix||(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(e,t,n,g){const r=this.binarizer.getLuminanceSource().crop(e,t,n,g);return new d(this.binarizer.createBinarizer(r))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new d(this.binarizer.createBinarizer(e))}rotateCounterClockwise45(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new d(this.binarizer.createBinarizer(e))}toString(){try{return this.getBlackMatrix().toString()}catch(fp){return""}}}class u extends l{static getChecksumInstance(){return new u}}u.kind="ChecksumException";class A{constructor(e){this.source=e}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class h{static arraycopy(e,t,n,g,r){for(;r--;)n[g++]=e[t++]}static currentTimeMillis(){return Date.now()}}class m extends l{}m.kind="IndexOutOfBoundsException";class b extends m{constructor(e=void 0,t=void 0){super(t),this.index=e,this.message=t}}b.kind="ArrayIndexOutOfBoundsException";class p{static fill(e,t){for(let n=0,g=e.length;n<g;n++)e[n]=t}static fillWithin(e,t,n,g){p.rangeCheck(e.length,t,n);for(let r=t;r<n;r++)e[r]=g}static rangeCheck(e,t,n){if(t>n)throw new c("fromIndex("+t+") > toIndex("+n+")");if(t<0)throw new b(t);if(n>e)throw new b(n)}static asList(...e){return e}static create(e,t,n){return Array.from({length:e}).map((e=>Array.from({length:t}).fill(n)))}static createInt32Array(e,t,n){return Array.from({length:e}).map((e=>Int32Array.from({length:t}).fill(n)))}static equals(e,t){if(!e)return!1;if(!t)return!1;if(!e.length)return!1;if(!t.length)return!1;if(e.length!==t.length)return!1;for(let n=0,g=e.length;n<g;n++)if(e[n]!==t[n])return!1;return!0}static hashCode(e){if(null===e)return 0;let t=1;for(const n of e)t=31*t+n;return t}static fillUint8Array(e,t){for(let n=0;n!==e.length;n++)e[n]=t}static copyOf(e,t){return e.slice(0,t)}static copyOfUint8Array(e,t){if(e.length<=t){const n=new Uint8Array(t);return n.set(e),n}return e.slice(0,t)}static copyOfRange(e,t,n){const g=n-t,r=new Int32Array(g);return h.arraycopy(e,t,r,0,g),r}static binarySearch(e,t,n){void 0===n&&(n=p.numberComparator);let g=0,r=e.length-1;for(;g<=r;){const i=r+g>>1,o=n(t,e[i]);if(o>0)g=i+1;else{if(!(o<0))return i;r=i-1}}return-g-1}static numberComparator(e,t){return e-t}}class y{static numberOfTrailingZeros(e){let t;if(0===e)return 32;let n=31;return t=e<<16,0!==t&&(n-=16,e=t),t=e<<8,0!==t&&(n-=8,e=t),t=e<<4,0!==t&&(n-=4,e=t),t=e<<2,0!==t&&(n-=2,e=t),n-(e<<1>>>31)}static numberOfLeadingZeros(e){if(0===e)return 32;let t=1;return e>>>16==0&&(t+=16,e<<=16),e>>>24==0&&(t+=8,e<<=8),e>>>28==0&&(t+=4,e<<=4),e>>>30==0&&(t+=2,e<<=2),t-=e>>>31,t}static toHexString(e){return e.toString(16)}static toBinaryString(e){return String(parseInt(String(e),2))}static bitCount(e){return e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135,e+=e>>>8,63&(e+=e>>>16)}static truncDivision(e,t){return Math.trunc(e/t)}static parseInt(e,t=void 0){return parseInt(e,t)}}y.MIN_VALUE_32_BITS=-2147483648,y.MAX_VALUE=Number.MAX_SAFE_INTEGER;class Z{constructor(e,t){void 0===e?(this.size=0,this.bits=new Int32Array(1)):(this.size=e,this.bits=null==t?Z.makeArray(e):t)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(e){if(e>32*this.bits.length){const t=Z.makeArray(e);h.arraycopy(this.bits,0,t,0,this.bits.length),this.bits=t}}get(e){return!!(this.bits[Math.floor(e/32)]&1<<(31&e))}set(e){this.bits[Math.floor(e/32)]|=1<<(31&e)}flip(e){this.bits[Math.floor(e/32)]^=1<<(31&e)}getNextSet(e){const t=this.size;if(e>=t)return t;const n=this.bits;let g=Math.floor(e/32),r=n[g];r&=~((1<<(31&e))-1);const i=n.length;for(;0===r;){if(++g===i)return t;r=n[g]}const o=32*g+y.numberOfTrailingZeros(r);return o>t?t:o}getNextUnset(e){const t=this.size;if(e>=t)return t;const n=this.bits;let g=Math.floor(e/32),r=~n[g];r&=~((1<<(31&e))-1);const i=n.length;for(;0===r;){if(++g===i)return t;r=~n[g]}const o=32*g+y.numberOfTrailingZeros(r);return o>t?t:o}setBulk(e,t){this.bits[Math.floor(e/32)]=t}setRange(e,t){if(t<e||e<0||t>this.size)throw new c;if(t===e)return;t--;const n=Math.floor(e/32),g=Math.floor(t/32),r=this.bits;for(let i=n;i<=g;i++){const o=(2<<(i<g?31:31&t))-(1<<(i>n?0:31&e));r[i]|=o}}clear(){const e=this.bits.length,t=this.bits;for(let n=0;n<e;n++)t[n]=0}isRange(e,t,n){if(t<e||e<0||t>this.size)throw new c;if(t===e)return!0;t--;const g=Math.floor(e/32),r=Math.floor(t/32),i=this.bits;for(let o=g;o<=r;o++){const s=(2<<(o<r?31:31&t))-(1<<(o>g?0:31&e))&4294967295;if((i[o]&s)!==(n?s:0))return!1}return!0}appendBit(e){this.ensureCapacity(this.size+1),e&&(this.bits[Math.floor(this.size/32)]|=1<<(31&this.size)),this.size++}appendBits(e,t){if(t<0||t>32)throw new c("Num bits must be between 0 and 32");this.ensureCapacity(this.size+t);for(let n=t;n>0;n--)this.appendBit(1==(e>>n-1&1))}appendBitArray(e){const t=e.size;this.ensureCapacity(this.size+t);for(let n=0;n<t;n++)this.appendBit(e.get(n))}xor(e){if(this.size!==e.size)throw new c("Sizes don't match");const t=this.bits;for(let n=0,g=t.length;n<g;n++)t[n]^=e.bits[n]}toBytes(e,t,n,g){for(let r=0;r<g;r++){let g=0;for(let t=0;t<8;t++)this.get(e)&&(g|=1<<7-t),e++;t[n+r]=g}}getBitArray(){return this.bits}reverse(){const e=new Int32Array(this.bits.length),t=Math.floor((this.size-1)/32),n=t+1,g=this.bits;for(let r=0;r<n;r++){let n=g[r];n=n>>1&1431655765|(1431655765&n)<<1,n=n>>2&858993459|(858993459&n)<<2,n=n>>4&252645135|(252645135&n)<<4,n=n>>8&16711935|(16711935&n)<<8,n=n>>16&65535|(65535&n)<<16,e[t-r]=n}if(this.size!==32*n){const t=32*n-this.size;let g=e[0]>>>t;for(let r=1;r<n;r++){const n=e[r];g|=n<<32-t,e[r-1]=g,g=n>>>t}e[n-1]=g}this.bits=e}static makeArray(e){return new Int32Array(Math.floor((e+31)/32))}equals(e){if(!(e instanceof Z))return!1;const t=e;return this.size===t.size&&p.equals(this.bits,t.bits)}hashCode(){return 31*this.size+p.hashCode(this.bits)}toString(){let e="";for(let t=0,n=this.size;t<n;t++)7&t||(e+=" "),e+=this.get(t)?"X":".";return e}clone(){return new Z(this.size,this.bits.slice())}}(a=s||(s={}))[a.OTHER=0]="OTHER",a[a.PURE_BARCODE=1]="PURE_BARCODE",a[a.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",a[a.TRY_HARDER=3]="TRY_HARDER",a[a.CHARACTER_SET=4]="CHARACTER_SET",a[a.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",a[a.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",a[a.ASSUME_GS1=7]="ASSUME_GS1",a[a.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",a[a.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",a[a.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS";var f,G,B=s;class S extends l{static getFormatInstance(){return new S}}S.kind="FormatException",(G=f||(f={}))[G.Cp437=0]="Cp437",G[G.ISO8859_1=1]="ISO8859_1",G[G.ISO8859_2=2]="ISO8859_2",G[G.ISO8859_3=3]="ISO8859_3",G[G.ISO8859_4=4]="ISO8859_4",G[G.ISO8859_5=5]="ISO8859_5",G[G.ISO8859_6=6]="ISO8859_6",G[G.ISO8859_7=7]="ISO8859_7",G[G.ISO8859_8=8]="ISO8859_8",G[G.ISO8859_9=9]="ISO8859_9",G[G.ISO8859_10=10]="ISO8859_10",G[G.ISO8859_11=11]="ISO8859_11",G[G.ISO8859_13=12]="ISO8859_13",G[G.ISO8859_14=13]="ISO8859_14",G[G.ISO8859_15=14]="ISO8859_15",G[G.ISO8859_16=15]="ISO8859_16",G[G.SJIS=16]="SJIS",G[G.Cp1250=17]="Cp1250",G[G.Cp1251=18]="Cp1251",G[G.Cp1252=19]="Cp1252",G[G.Cp1256=20]="Cp1256",G[G.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",G[G.UTF8=22]="UTF8",G[G.ASCII=23]="ASCII",G[G.Big5=24]="Big5",G[G.GB18030=25]="GB18030",G[G.EUC_KR=26]="EUC_KR";class R{constructor(e,t,n,...g){this.valueIdentifier=e,this.name=n,this.values="number"==typeof t?Int32Array.from([t]):t,this.otherEncodingNames=g,R.VALUE_IDENTIFIER_TO_ECI.set(e,this),R.NAME_TO_ECI.set(n,this);const r=this.values;for(let i=0,o=r.length;i!==o;i++){const e=r[i];R.VALUES_TO_ECI.set(e,this)}for(const i of g)R.NAME_TO_ECI.set(i,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(e){if(e<0||e>=900)throw new S("incorect value");const t=R.VALUES_TO_ECI.get(e);if(void 0===t)throw new S("incorect value");return t}static getCharacterSetECIByName(e){const t=R.NAME_TO_ECI.get(e);if(void 0===t)throw new S("incorect value");return t}equals(e){if(!(e instanceof R))return!1;const t=e;return this.getName()===t.getName()}}R.VALUE_IDENTIFIER_TO_ECI=new Map,R.VALUES_TO_ECI=new Map,R.NAME_TO_ECI=new Map,R.Cp437=new R(f.Cp437,Int32Array.from([0,2]),"Cp437"),R.ISO8859_1=new R(f.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),R.ISO8859_2=new R(f.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),R.ISO8859_3=new R(f.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),R.ISO8859_4=new R(f.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),R.ISO8859_5=new R(f.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),R.ISO8859_6=new R(f.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),R.ISO8859_7=new R(f.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),R.ISO8859_8=new R(f.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),R.ISO8859_9=new R(f.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),R.ISO8859_10=new R(f.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),R.ISO8859_11=new R(f.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),R.ISO8859_13=new R(f.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),R.ISO8859_14=new R(f.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),R.ISO8859_15=new R(f.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),R.ISO8859_16=new R(f.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),R.SJIS=new R(f.SJIS,20,"SJIS","Shift_JIS"),R.Cp1250=new R(f.Cp1250,21,"Cp1250","windows-1250"),R.Cp1251=new R(f.Cp1251,22,"Cp1251","windows-1251"),R.Cp1252=new R(f.Cp1252,23,"Cp1252","windows-1252"),R.Cp1256=new R(f.Cp1256,24,"Cp1256","windows-1256"),R.UnicodeBigUnmarked=new R(f.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),R.UTF8=new R(f.UTF8,26,"UTF8","UTF-8"),R.ASCII=new R(f.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),R.Big5=new R(f.Big5,28,"Big5"),R.GB18030=new R(f.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),R.EUC_KR=new R(f.EUC_KR,30,"EUC_KR","EUC-KR");class v extends l{}v.kind="UnsupportedOperationException";class V{static decode(e,t){const n=this.encodingName(t);return this.customDecoder?this.customDecoder(e,n):"undefined"==typeof TextDecoder||this.shouldDecodeOnFallback(n)?this.decodeFallback(e,n):new TextDecoder(n).decode(e)}static shouldDecodeOnFallback(e){return!V.isBrowser()&&"ISO-8859-1"===e}static encode(e,t){const n=this.encodingName(t);return this.customEncoder?this.customEncoder(e,n):"undefined"==typeof TextEncoder?this.encodeFallback(e):(new TextEncoder).encode(e)}static isBrowser(){return"undefined"!=typeof window&&"[object Window]"==={}.toString.call(window)}static encodingName(e){return"string"==typeof e?e:e.getName()}static encodingCharacterSet(e){return e instanceof R?e:R.getCharacterSetECIByName(e)}static decodeFallback(e,t){const n=this.encodingCharacterSet(t);if(V.isDecodeFallbackSupported(n)){let t="";for(let n=0,g=e.length;n<g;n++){let g=e[n].toString(16);g.length<2&&(g="0"+g),t+="%"+g}return decodeURIComponent(t)}if(n.equals(R.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(e.buffer));throw new v(`Encoding ${this.encodingName(t)} not supported by fallback.`)}static isDecodeFallbackSupported(e){return e.equals(R.UTF8)||e.equals(R.ISO8859_1)||e.equals(R.ASCII)}static encodeFallback(e){const t=btoa(unescape(encodeURIComponent(e))).split(""),n=[];for(let g=0;g<t.length;g++)n.push(t[g].charCodeAt(0));return new Uint8Array(n)}}class w{static castAsNonUtf8Char(e,t=null){const n=t?t.getName():this.ISO88591;return V.decode(new Uint8Array([e]),n)}static guessEncoding(e,t){if(null!=t&&void 0!==t.get(B.CHARACTER_SET))return t.get(B.CHARACTER_SET).toString();const n=e.length;let g=!0,r=!0,i=!0,o=0,s=0,a=0,I=0,l=0,C=0,c=0,d=0,u=0,A=0,h=0;const m=e.length>3&&239===e[0]&&187===e[1]&&191===e[2];for(let b=0;b<n&&(g||r||i);b++){const t=255&e[b];i&&(o>0?128&t?o--:i=!1:128&t&&(64&t?(o++,32&t?(o++,16&t?(o++,8&t?i=!1:I++):a++):s++):i=!1)),g&&(t>127&&t<160?g=!1:t>159&&(t<192||215===t||247===t)&&h++),r&&(l>0?t<64||127===t||t>252?r=!1:l--:128===t||160===t||t>239?r=!1:t>160&&t<224?(C++,d=0,c++,c>u&&(u=c)):t>127?(l++,c=0,d++,d>A&&(A=d)):(c=0,d=0))}return i&&o>0&&(i=!1),r&&l>0&&(r=!1),i&&(m||s+a+I>0)?w.UTF8:r&&(w.ASSUME_SHIFT_JIS||u>=3||A>=3)?w.SHIFT_JIS:g&&r?2===u&&2===C||10*h>=n?w.SHIFT_JIS:w.ISO88591:g?w.ISO88591:r?w.SHIFT_JIS:i?w.UTF8:w.PLATFORM_DEFAULT_ENCODING}static format(e,...t){let n=-1;function g(e,g,r,i,o,s){if("%%"===e)return"%";if(void 0===t[++n])return;e=i?parseInt(i.substr(1)):void 0;let a,I=o?parseInt(o.substr(1)):void 0;switch(s){case"s":a=t[n];break;case"c":a=t[n][0];break;case"f":a=parseFloat(t[n]).toFixed(e);break;case"p":a=parseFloat(t[n]).toPrecision(e);break;case"e":a=parseFloat(t[n]).toExponential(e);break;case"x":a=parseInt(t[n]).toString(I||16);break;case"d":a=parseFloat(parseInt(t[n],I||10).toPrecision(e)).toFixed(0)}a="object"==typeof a?JSON.stringify(a):(+a).toString(I);let l=parseInt(r),C=r&&r[0]+""=="0"?"0":" ";for(;a.length<l;)a=void 0!==g?a+C:C+a;return a}let r=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(r,g)}static getBytes(e,t){return V.encode(e,t)}static getCharCode(e,t=0){return e.charCodeAt(t)}static getCharAt(e){return String.fromCharCode(e)}}w.SHIFT_JIS=R.SJIS.getName(),w.GB2312="GB2312",w.ISO88591=R.ISO8859_1.getName(),w.EUC_JP="EUC_JP",w.UTF8=R.UTF8.getName(),w.PLATFORM_DEFAULT_ENCODING=w.UTF8,w.ASSUME_SHIFT_JIS=!1;class W{constructor(e=""){this.value=e}enableDecoding(e){return this.encoding=e,this}append(e){return"string"==typeof e?this.value+=e.toString():this.encoding?this.value+=w.castAsNonUtf8Char(e,this.encoding):this.value+=String.fromCharCode(e),this}appendChars(e,t,n){for(let g=t;t<t+n;g++)this.append(e[g]);return this}length(){return this.value.length}charAt(e){return this.value.charAt(e)}deleteCharAt(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)}setCharAt(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+1)}substring(e,t){return this.value.substring(e,t)}setLengthToZero(){this.value=""}toString(){return this.value}insert(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+t.length)}}class k{constructor(e,t,n,g){if(this.width=e,this.height=t,this.rowSize=n,this.bits=g,null==t&&(t=e),this.height=t,e<1||t<1)throw new c("Both dimensions must be greater than 0");null==n&&(n=Math.floor((e+31)/32)),this.rowSize=n,null==g&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(e){const t=e.length,n=e[0].length,g=new k(n,t);for(let r=0;r<t;r++){const t=e[r];for(let e=0;e<n;e++)t[e]&&g.set(e,r)}return g}static parseFromString(e,t,n){if(null===e)throw new c("stringRepresentation cannot be null");const g=new Array(e.length);let r=0,i=0,o=-1,s=0,a=0;for(;a<e.length;)if("\n"===e.charAt(a)||"\r"===e.charAt(a)){if(r>i){if(-1===o)o=r-i;else if(r-i!==o)throw new c("row lengths do not match");i=r,s++}a++}else if(e.substring(a,a+t.length)===t)a+=t.length,g[r]=!0,r++;else{if(e.substring(a,a+n.length)!==n)throw new c("illegal character encountered: "+e.substring(a));a+=n.length,g[r]=!1,r++}if(r>i){if(-1===o)o=r-i;else if(r-i!==o)throw new c("row lengths do not match");s++}const I=new k(o,s);for(let l=0;l<r;l++)g[l]&&I.set(Math.floor(l%o),Math.floor(l/o));return I}get(e,t){const n=t*this.rowSize+Math.floor(e/32);return!!(this.bits[n]>>>(31&e)&1)}set(e,t){const n=t*this.rowSize+Math.floor(e/32);this.bits[n]|=1<<(31&e)&4294967295}unset(e,t){const n=t*this.rowSize+Math.floor(e/32);this.bits[n]&=~(1<<(31&e)&4294967295)}flip(e,t){const n=t*this.rowSize+Math.floor(e/32);this.bits[n]^=1<<(31&e)&4294967295}xor(e){if(this.width!==e.getWidth()||this.height!==e.getHeight()||this.rowSize!==e.getRowSize())throw new c("input matrix dimensions do not match");const t=new Z(Math.floor(this.width/32)+1),n=this.rowSize,g=this.bits;for(let r=0,i=this.height;r<i;r++){const i=r*n,o=e.getRow(r,t).getBitArray();for(let e=0;e<n;e++)g[i+e]^=o[e]}}clear(){const e=this.bits,t=e.length;for(let n=0;n<t;n++)e[n]=0}setRegion(e,t,n,g){if(t<0||e<0)throw new c("Left and top must be nonnegative");if(g<1||n<1)throw new c("Height and width must be at least 1");const r=e+n,i=t+g;if(i>this.height||r>this.width)throw new c("The region must fit inside the matrix");const o=this.rowSize,s=this.bits;for(let a=t;a<i;a++){const t=a*o;for(let n=e;n<r;n++)s[t+Math.floor(n/32)]|=1<<(31&n)&4294967295}}getRow(e,t){null==t||t.getSize()<this.width?t=new Z(this.width):t.clear();const n=this.rowSize,g=this.bits,r=e*n;for(let i=0;i<n;i++)t.setBulk(32*i,g[r+i]);return t}setRow(e,t){h.arraycopy(t.getBitArray(),0,this.bits,e*this.rowSize,this.rowSize)}rotate180(){const e=this.getWidth(),t=this.getHeight();let n=new Z(e),g=new Z(e);for(let r=0,i=Math.floor((t+1)/2);r<i;r++)n=this.getRow(r,n),g=this.getRow(t-1-r,g),n.reverse(),g.reverse(),this.setRow(r,g),this.setRow(t-1-r,n)}getEnclosingRectangle(){const e=this.width,t=this.height,n=this.rowSize,g=this.bits;let r=e,i=t,o=-1,s=-1;for(let a=0;a<t;a++)for(let e=0;e<n;e++){const t=g[a*n+e];if(0!==t){if(a<i&&(i=a),a>s&&(s=a),32*e<r){let n=0;for(;!(t<<31-n&4294967295);)n++;32*e+n<r&&(r=32*e+n)}if(32*e+31>o){let n=31;for(;t>>>n==0;)n--;32*e+n>o&&(o=32*e+n)}}}return o<r||s<i?null:Int32Array.from([r,i,o-r+1,s-i+1])}getTopLeftOnBit(){const e=this.rowSize,t=this.bits;let n=0;for(;n<t.length&&0===t[n];)n++;if(n===t.length)return null;const g=n/e;let r=n%e*32;const i=t[n];let o=0;for(;!(i<<31-o&4294967295);)o++;return r+=o,Int32Array.from([r,g])}getBottomRightOnBit(){const e=this.rowSize,t=this.bits;let n=t.length-1;for(;n>=0&&0===t[n];)n--;if(n<0)return null;const g=Math.floor(n/e);let r=32*Math.floor(n%e);const i=t[n];let o=31;for(;i>>>o==0;)o--;return r+=o,Int32Array.from([r,g])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(e){if(!(e instanceof k))return!1;const t=e;return this.width===t.width&&this.height===t.height&&this.rowSize===t.rowSize&&p.equals(this.bits,t.bits)}hashCode(){let e=this.width;return e=31*e+this.width,e=31*e+this.height,e=31*e+this.rowSize,e=31*e+p.hashCode(this.bits),e}toString(e="X ",t="  ",n="\n"){return this.buildToString(e,t,n)}buildToString(e,t,n){let g=new W;for(let r=0,i=this.height;r<i;r++){for(let n=0,i=this.width;n<i;n++)g.append(this.get(n,r)?e:t);g.append(n)}return g.toString()}clone(){return new k(this.width,this.height,this.rowSize,this.bits.slice())}}class X extends l{static getNotFoundInstance(){return new X}}X.kind="NotFoundException";class N extends A{constructor(e){super(e),this.luminances=N.EMPTY,this.buckets=new Int32Array(N.LUMINANCE_BUCKETS)}getBlackRow(e,t){const n=this.getLuminanceSource(),g=n.getWidth();null==t||t.getSize()<g?t=new Z(g):t.clear(),this.initArrays(g);const r=n.getRow(e,this.luminances),i=this.buckets;for(let s=0;s<g;s++)i[(255&r[s])>>N.LUMINANCE_SHIFT]++;const o=N.estimateBlackPoint(i);if(g<3)for(let s=0;s<g;s++)(255&r[s])<o&&t.set(s);else{let e=255&r[0],n=255&r[1];for(let i=1;i<g-1;i++){const g=255&r[i+1];(4*n-e-g)/2<o&&t.set(i),e=n,n=g}}return t}getBlackMatrix(){const e=this.getLuminanceSource(),t=e.getWidth(),n=e.getHeight(),g=new k(t,n);this.initArrays(t);const r=this.buckets;for(let s=1;s<5;s++){const g=Math.floor(n*s/5),i=e.getRow(g,this.luminances),o=Math.floor(4*t/5);for(let e=Math.floor(t/5);e<o;e++)r[(255&i[e])>>N.LUMINANCE_SHIFT]++}const i=N.estimateBlackPoint(r),o=e.getMatrix();for(let s=0;s<n;s++){const e=s*t;for(let n=0;n<t;n++)(255&o[e+n])<i&&g.set(n,s)}return g}createBinarizer(e){return new N(e)}initArrays(e){this.luminances.length<e&&(this.luminances=new Uint8ClampedArray(e));const t=this.buckets;for(let n=0;n<N.LUMINANCE_BUCKETS;n++)t[n]=0}static estimateBlackPoint(e){const t=e.length;let n=0,g=0,r=0;for(let I=0;I<t;I++)e[I]>r&&(g=I,r=e[I]),e[I]>n&&(n=e[I]);let i=0,o=0;for(let I=0;I<t;I++){const t=I-g,n=e[I]*t*t;n>o&&(i=I,o=n)}if(g>i){const e=g;g=i,i=e}if(i-g<=t/16)throw new X;let s=i-1,a=-1;for(let I=i-1;I>g;I--){const t=I-g,r=t*t*(i-I)*(n-e[I]);r>a&&(s=I,a=r)}return s<<N.LUMINANCE_SHIFT}}N.LUMINANCE_BITS=5,N.LUMINANCE_SHIFT=8-N.LUMINANCE_BITS,N.LUMINANCE_BUCKETS=1<<N.LUMINANCE_BITS,N.EMPTY=Uint8ClampedArray.from([0]);class J extends N{constructor(e){super(e),this.matrix=null}getBlackMatrix(){if(null!==this.matrix)return this.matrix;const e=this.getLuminanceSource(),t=e.getWidth(),n=e.getHeight();if(t>=J.MINIMUM_DIMENSION&&n>=J.MINIMUM_DIMENSION){const g=e.getMatrix();let r=t>>J.BLOCK_SIZE_POWER;t&J.BLOCK_SIZE_MASK&&r++;let i=n>>J.BLOCK_SIZE_POWER;n&J.BLOCK_SIZE_MASK&&i++;const o=J.calculateBlackPoints(g,r,i,t,n),s=new k(t,n);J.calculateThresholdForBlock(g,r,i,t,n,o,s),this.matrix=s}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(e){return new J(e)}static calculateThresholdForBlock(e,t,n,g,r,i,o){const s=r-J.BLOCK_SIZE,a=g-J.BLOCK_SIZE;for(let I=0;I<n;I++){let r=I<<J.BLOCK_SIZE_POWER;r>s&&(r=s);const l=J.cap(I,2,n-3);for(let n=0;n<t;n++){let s=n<<J.BLOCK_SIZE_POWER;s>a&&(s=a);const I=J.cap(n,2,t-3);let C=0;for(let e=-2;e<=2;e++){const t=i[l+e];C+=t[I-2]+t[I-1]+t[I]+t[I+1]+t[I+2]}const c=C/25;J.thresholdBlock(e,s,r,c,g,o)}}}static cap(e,t,n){return e<t?t:e>n?n:e}static thresholdBlock(e,t,n,g,r,i){for(let o=0,s=n*r+t;o<J.BLOCK_SIZE;o++,s+=r)for(let r=0;r<J.BLOCK_SIZE;r++)(255&e[s+r])<=g&&i.set(t+r,n+o)}static calculateBlackPoints(e,t,n,g,r){const i=r-J.BLOCK_SIZE,o=g-J.BLOCK_SIZE,s=new Array(n);for(let a=0;a<n;a++){s[a]=new Int32Array(t);let n=a<<J.BLOCK_SIZE_POWER;n>i&&(n=i);for(let r=0;r<t;r++){let t=r<<J.BLOCK_SIZE_POWER;t>o&&(t=o);let i=0,I=255,l=0;for(let r=0,o=n*g+t;r<J.BLOCK_SIZE;r++,o+=g){for(let t=0;t<J.BLOCK_SIZE;t++){const n=255&e[o+t];i+=n,n<I&&(I=n),n>l&&(l=n)}if(l-I>J.MIN_DYNAMIC_RANGE)for(r++,o+=g;r<J.BLOCK_SIZE;r++,o+=g)for(let t=0;t<J.BLOCK_SIZE;t++)i+=255&e[o+t]}let C=i>>2*J.BLOCK_SIZE_POWER;if(l-I<=J.MIN_DYNAMIC_RANGE&&(C=I/2,a>0&&r>0)){const e=(s[a-1][r]+2*s[a][r-1]+s[a-1][r-1])/4;I<e&&(C=e)}s[a][r]=C}}return s}}J.BLOCK_SIZE_POWER=3,J.BLOCK_SIZE=1<<J.BLOCK_SIZE_POWER,J.BLOCK_SIZE_MASK=J.BLOCK_SIZE-1,J.MINIMUM_DIMENSION=5*J.BLOCK_SIZE,J.MIN_DYNAMIC_RANGE=24;class Y{constructor(e,t){this.width=e,this.height=t}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(e,t,n,g){throw new v("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new v("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new v("This luminance source does not support rotation by 45 degrees.")}toString(){const e=new Uint8ClampedArray(this.width);let t=new W;for(let n=0;n<this.height;n++){const g=this.getRow(n,e);for(let e=0;e<this.width;e++){const n=255&g[e];let r;r=n<64?"#":n<128?"+":n<192?".":" ",t.append(r)}t.append("\n")}return t.toString()}}class E extends Y{constructor(e){super(e.getWidth(),e.getHeight()),this.delegate=e}getRow(e,t){const n=this.delegate.getRow(e,t),g=this.getWidth();for(let r=0;r<g;r++)n[r]=255-(255&n[r]);return n}getMatrix(){const e=this.delegate.getMatrix(),t=this.getWidth()*this.getHeight(),n=new Uint8ClampedArray(t);for(let g=0;g<t;g++)n[g]=255-(255&e[g]);return n}isCropSupported(){return this.delegate.isCropSupported()}crop(e,t,n,g){return new E(this.delegate.crop(e,t,n,g))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new E(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new E(this.delegate.rotateCounterClockwise45())}}class H extends Y{constructor(e){super(e.width,e.height),this.canvas=e,this.tempCanvasElement=null,this.buffer=H.makeBufferFromCanvasImageData(e)}static makeBufferFromCanvasImageData(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height);return H.toGrayscaleBuffer(t.data,e.width,e.height)}static toGrayscaleBuffer(e,t,n){const g=new Uint8ClampedArray(t*n);for(let r=0,i=0,o=e.length;r<o;r+=4,i++){let t;t=0===e[r+3]?255:306*e[r]+601*e[r+1]+117*e[r+2]+512>>10,g[i]=t}return g}getRow(e,t){if(e<0||e>=this.getHeight())throw new c("Requested row is outside the image: "+e);const n=this.getWidth(),g=e*n;return null===t?t=this.buffer.slice(g,g+n):(t.length<n&&(t=new Uint8ClampedArray(n)),t.set(this.buffer.slice(g,g+n))),t}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(e,t,n,g){return super.crop(e,t,n,g),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(null===this.tempCanvasElement){const e=this.canvas.ownerDocument.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height,this.tempCanvasElement=e}return this.tempCanvasElement}rotate(e){const t=this.getTempCanvasElement(),n=t.getContext("2d"),g=e*H.DEGREE_TO_RADIANS,r=this.canvas.width,i=this.canvas.height,o=Math.ceil(Math.abs(Math.cos(g))*r+Math.abs(Math.sin(g))*i),s=Math.ceil(Math.abs(Math.sin(g))*r+Math.abs(Math.cos(g))*i);return t.width=o,t.height=s,n.translate(o/2,s/2),n.rotate(g),n.drawImage(this.canvas,r/-2,i/-2),this.buffer=H.makeBufferFromCanvasImageData(t),this}invert(){return new E(this)}}H.DEGREE_TO_RADIANS=Math.PI/180;class F{constructor(e,t,n){this.deviceId=e,this.label=t,this.kind="videoinput",this.groupId=n||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var x,T,K=(globalThis||o||self||window?(globalThis||o||self||window||void 0).__awaiter:void 0)||function(e,t,n,g){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function o(e){try{a(g.next(e))}catch(fp){i(fp)}}function s(e){try{a(g.throw(e))}catch(fp){i(fp)}}function a(e){e.done?n(e.value):r(e.value).then(o,s)}a((g=g.apply(e,t||[])).next())}))};class M{constructor(e,t=500,n){this.reader=e,this.timeBetweenScansMillis=t,this._hints=n,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return"undefined"!=typeof navigator}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(e){this._timeBetweenDecodingAttempts=e<0?0:e}set hints(e){this._hints=e||null}get hints(){return this._hints}listVideoInputDevices(){return K(this,void 0,void 0,(function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const e=yield navigator.mediaDevices.enumerateDevices(),t=[];for(const n of e){const e="video"===n.kind?"videoinput":n.kind;if("videoinput"!==e)continue;const g={deviceId:n.deviceId||n.id,label:n.label||`Video device ${t.length+1}`,kind:e,groupId:n.groupId};t.push(g)}return t}))}getVideoInputDevices(){return K(this,void 0,void 0,(function*(){return(yield this.listVideoInputDevices()).map((e=>new F(e.deviceId,e.label)))}))}findDeviceById(e){return K(this,void 0,void 0,(function*(){const t=yield this.listVideoInputDevices();return t?t.find((t=>t.deviceId===e)):null}))}decodeFromInputVideoDevice(e,t){return K(this,void 0,void 0,(function*(){return yield this.decodeOnceFromVideoDevice(e,t)}))}decodeOnceFromVideoDevice(e,t){return K(this,void 0,void 0,(function*(){let n;this.reset(),n=e?{deviceId:{exact:e}}:{facingMode:"environment"};const g={video:n};return yield this.decodeOnceFromConstraints(g,t)}))}decodeOnceFromConstraints(e,t){return K(this,void 0,void 0,(function*(){const n=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeOnceFromStream(n,t)}))}decodeOnceFromStream(e,t){return K(this,void 0,void 0,(function*(){this.reset();const n=yield this.attachStreamToVideo(e,t);return yield this.decodeOnce(n)}))}decodeFromInputVideoDeviceContinuously(e,t,n){return K(this,void 0,void 0,(function*(){return yield this.decodeFromVideoDevice(e,t,n)}))}decodeFromVideoDevice(e,t,n){return K(this,void 0,void 0,(function*(){let g;g=e?{deviceId:{exact:e}}:{facingMode:"environment"};const r={video:g};return yield this.decodeFromConstraints(r,t,n)}))}decodeFromConstraints(e,t,n){return K(this,void 0,void 0,(function*(){const g=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeFromStream(g,t,n)}))}decodeFromStream(e,t,n){return K(this,void 0,void 0,(function*(){this.reset();const g=yield this.attachStreamToVideo(e,t);return yield this.decodeContinuously(g,n)}))}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(e,t){return K(this,void 0,void 0,(function*(){const n=this.prepareVideoElement(t);return this.addVideoSource(n,e),this.videoElement=n,this.stream=e,yield this.playVideoOnLoadAsync(n),n}))}playVideoOnLoadAsync(e){return new Promise(((t,n)=>this.playVideoOnLoad(e,(()=>t()))))}playVideoOnLoad(e,t){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(e),e.addEventListener("ended",this.videoEndedListener),e.addEventListener("canplay",this.videoCanPlayListener),e.addEventListener("playing",t),this.tryPlayVideo(e)}isVideoPlaying(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}tryPlayVideo(e){return K(this,void 0,void 0,(function*(){if(!this.isVideoPlaying(e))try{yield e.play()}catch(t){}}))}getMediaElement(e,t){const n=document.getElementById(e);if(!n)throw new C(`element with id '${e}' not found`);if(n.nodeName.toLowerCase()!==t.toLowerCase())throw new C(`element with id '${e}' must be an ${t} element`);return n}decodeFromImage(e,t){if(!e&&!t)throw new C("either imageElement with a src set or an url must be provided");return t&&!e?this.decodeFromImageUrl(t):this.decodeFromImageElement(e)}decodeFromVideo(e,t){if(!e&&!t)throw new C("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrl(t):this.decodeFromVideoElement(e)}decodeFromVideoContinuously(e,t,n){if(void 0===e&&void 0===t)throw new C("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrlContinuously(t,n):this.decodeFromVideoElementContinuously(e,n)}decodeFromImageElement(e){if(!e)throw new C("An image element must be provided.");this.reset();const t=this.prepareImageElement(e);let n;return this.imageElement=t,n=this.isImageLoaded(t)?this.decodeOnce(t,!1,!0):this._decodeOnLoadImage(t),n}decodeFromVideoElement(e){const t=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideo(t)}decodeFromVideoElementContinuously(e,t){const n=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideoContinuously(n,t)}_decodeFromVideoElementSetup(e){if(!e)throw new C("A video element must be provided.");this.reset();const t=this.prepareVideoElement(e);return this.videoElement=t,t}decodeFromImageUrl(e){if(!e)throw new C("An URL must be provided.");this.reset();const t=this.prepareImageElement();this.imageElement=t;const n=this._decodeOnLoadImage(t);return t.src=e,n}decodeFromVideoUrl(e){if(!e)throw new C("An URL must be provided.");this.reset();const t=this.prepareVideoElement(),n=this.decodeFromVideoElement(t);return t.src=e,n}decodeFromVideoUrlContinuously(e,t){if(!e)throw new C("An URL must be provided.");this.reset();const n=this.prepareVideoElement(),g=this.decodeFromVideoElementContinuously(n,t);return n.src=e,g}_decodeOnLoadImage(e){return new Promise(((t,n)=>{this.imageLoadedListener=()=>this.decodeOnce(e,!1,!0).then(t,n),e.addEventListener("load",this.imageLoadedListener)}))}_decodeOnLoadVideo(e){return K(this,void 0,void 0,(function*(){return yield this.playVideoOnLoadAsync(e),yield this.decodeOnce(e)}))}_decodeOnLoadVideoContinuously(e,t){return K(this,void 0,void 0,(function*(){yield this.playVideoOnLoadAsync(e),this.decodeContinuously(e,t)}))}isImageLoaded(e){return!!e.complete&&0!==e.naturalWidth}prepareImageElement(e){let t;return void 0===e&&(t=document.createElement("img"),t.width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"img")),e instanceof HTMLImageElement&&(t=e),t}prepareVideoElement(e){let t;return e||"undefined"==typeof document||(t=document.createElement("video"),t.width=200,t.height=200),"string"==typeof e&&(t=this.getMediaElement(e,"video")),e instanceof HTMLVideoElement&&(t=e),t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t}decodeOnce(e,t=!0,n=!0){this._stopAsyncDecode=!1;const g=(r,i)=>{if(this._stopAsyncDecode)return i(new X("Video stream has ended before any code could be detected.")),void(this._stopAsyncDecode=void 0);try{r(this.decode(e))}catch(fp){if(t&&fp instanceof X||(fp instanceof u||fp instanceof S)&&n)return setTimeout(g,this._timeBetweenDecodingAttempts,r,i);i(fp)}};return new Promise(((e,t)=>g(e,t)))}decodeContinuously(e,t){this._stopContinuousDecode=!1;const n=()=>{if(this._stopContinuousDecode)this._stopContinuousDecode=void 0;else try{const g=this.decode(e);t(g,null),setTimeout(n,this.timeBetweenScansMillis)}catch(fp){t(null,fp),(fp instanceof u||fp instanceof S||fp instanceof X)&&setTimeout(n,this._timeBetweenDecodingAttempts)}};n()}decode(e){const t=this.createBinaryBitmap(e);return this.decodeBitmap(t)}_isHTMLVideoElement(e){return 0!==e.videoWidth}drawFrameOnCanvas(e,t,n){t||(t={sx:0,sy:0,sWidth:e.videoWidth,sHeight:e.videoHeight,dx:0,dy:0,dWidth:e.videoWidth,dHeight:e.videoHeight}),n||(n=this.captureCanvasContext),n.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}drawImageOnCanvas(e,t,n=this.captureCanvasContext){t||(t={sx:0,sy:0,sWidth:e.naturalWidth,sHeight:e.naturalHeight,dx:0,dy:0,dWidth:e.naturalWidth,dHeight:e.naturalHeight}),n||(n=this.captureCanvasContext),n.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}createBinaryBitmap(e){this.getCaptureCanvasContext(e),this._isHTMLVideoElement(e)?this.drawFrameOnCanvas(e):this.drawImageOnCanvas(e);const t=this.getCaptureCanvas(e),n=new H(t),g=new J(n);return new d(g)}getCaptureCanvasContext(e){if(!this.captureCanvasContext){const t=this.getCaptureCanvas(e).getContext("2d");this.captureCanvasContext=t}return this.captureCanvasContext}getCaptureCanvas(e){if(!this.captureCanvas){const t=this.createCaptureCanvas(e);this.captureCanvas=t}return this.captureCanvas}decodeBitmap(e){return this.reader.decode(e,this._hints)}createCaptureCanvas(e){if("undefined"==typeof document)return this._destroyCaptureCanvas(),null;const t=document.createElement("canvas");let n,g;return void 0!==e&&(e instanceof HTMLVideoElement?(n=e.videoWidth,g=e.videoHeight):e instanceof HTMLImageElement&&(n=e.naturalWidth||e.width,g=e.naturalHeight||e.height)),t.style.width=n+"px",t.style.height=g+"px",t.width=n,t.height=g,t}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach((e=>e.stop())),this.stream=void 0),!1===this._stopAsyncDecode&&this.stopAsyncDecode(),!1===this._stopContinuousDecode&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(void 0!==this.videoEndedListener&&this.videoElement.removeEventListener("ended",this.videoEndedListener),void 0!==this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),void 0!==this.videoCanPlayListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(e,t){try{e.srcObject=t}catch(n){e.src=URL.createObjectURL(t)}}cleanVideoSource(e){try{e.srcObject=null}catch(t){e.src=""}this.videoElement.removeAttribute("src")}}class D{constructor(e,t,n=(null==t?0:8*t.length),g,r,i=h.currentTimeMillis()){this.text=e,this.rawBytes=t,this.numBits=n,this.resultPoints=g,this.format=r,this.timestamp=i,this.text=e,this.rawBytes=t,this.numBits=null==n?null==t?0:8*t.length:n,this.resultPoints=g,this.format=r,this.resultMetadata=null,this.timestamp=null==i?h.currentTimeMillis():i}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(e,t){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(e,t)}putAllMetadata(e){null!==e&&(null===this.resultMetadata?this.resultMetadata=e:this.resultMetadata=new Map(e))}addResultPoints(e){const t=this.resultPoints;if(null===t)this.resultPoints=e;else if(null!==e&&e.length>0){const n=new Array(t.length+e.length);h.arraycopy(t,0,n,0,t.length),h.arraycopy(e,0,n,t.length,e.length),this.resultPoints=n}}getTimestamp(){return this.timestamp}toString(){return this.text}}(T=x||(x={}))[T.AZTEC=0]="AZTEC",T[T.CODABAR=1]="CODABAR",T[T.CODE_39=2]="CODE_39",T[T.CODE_93=3]="CODE_93",T[T.CODE_128=4]="CODE_128",T[T.DATA_MATRIX=5]="DATA_MATRIX",T[T.EAN_8=6]="EAN_8",T[T.EAN_13=7]="EAN_13",T[T.ITF=8]="ITF",T[T.MAXICODE=9]="MAXICODE",T[T.PDF_417=10]="PDF_417",T[T.QR_CODE=11]="QR_CODE",T[T.RSS_14=12]="RSS_14",T[T.RSS_EXPANDED=13]="RSS_EXPANDED",T[T.UPC_A=14]="UPC_A",T[T.UPC_E=15]="UPC_E",T[T.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION";var L,U,z=x;(U=L||(L={}))[U.OTHER=0]="OTHER",U[U.ORIENTATION=1]="ORIENTATION",U[U.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",U[U.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",U[U.ISSUE_NUMBER=4]="ISSUE_NUMBER",U[U.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",U[U.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",U[U.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",U[U.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",U[U.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",U[U.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY";var Q,O,j,P,_,q,$,ee,te,ne,ge,re=L;class ie{constructor(e,t,n,g,r=-1,i=-1){this.rawBytes=e,this.text=t,this.byteSegments=n,this.ecLevel=g,this.structuredAppendSequenceNumber=r,this.structuredAppendParity=i,this.numBits=null==e?0:8*e.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(e){this.numBits=e}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(e){this.errorsCorrected=e}getErasures(){return this.erasures}setErasures(e){this.erasures=e}getOther(){return this.other}setOther(e){this.other=e}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class oe{exp(e){return this.expTable[e]}log(e){if(0===e)throw new c;return this.logTable[e]}static addOrSubtract(e,t){return e^t}}class se{constructor(e,t){if(0===t.length)throw new c;this.field=e;const n=t.length;if(n>1&&0===t[0]){let e=1;for(;e<n&&0===t[e];)e++;e===n?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(n-e),h.arraycopy(t,e,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(0===e)return this.getCoefficient(0);const t=this.coefficients;let n;if(1===e){n=0;for(let e=0,g=t.length;e!==g;e++){const g=t[e];n=oe.addOrSubtract(n,g)}return n}n=t[0];const g=t.length,r=this.field;for(let i=1;i<g;i++)n=oe.addOrSubtract(r.multiply(e,n),t[i]);return n}addOrSubtract(e){if(!this.field.equals(e.field))throw new c("GenericGFPolys do not have same GenericGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,n=e.coefficients;if(t.length>n.length){const e=t;t=n,n=e}let g=new Int32Array(n.length);const r=n.length-t.length;h.arraycopy(n,0,g,0,r);for(let i=r;i<n.length;i++)g[i]=oe.addOrSubtract(t[i-r],n[i]);return new se(this.field,g)}multiply(e){if(!this.field.equals(e.field))throw new c("GenericGFPolys do not have same GenericGF field");if(this.isZero()||e.isZero())return this.field.getZero();const t=this.coefficients,n=t.length,g=e.coefficients,r=g.length,i=new Int32Array(n+r-1),o=this.field;for(let s=0;s<n;s++){const e=t[s];for(let t=0;t<r;t++)i[s+t]=oe.addOrSubtract(i[s+t],o.multiply(e,g[t]))}return new se(o,i)}multiplyScalar(e){if(0===e)return this.field.getZero();if(1===e)return this;const t=this.coefficients.length,n=this.field,g=new Int32Array(t),r=this.coefficients;for(let i=0;i<t;i++)g[i]=n.multiply(r[i],e);return new se(n,g)}multiplyByMonomial(e,t){if(e<0)throw new c;if(0===t)return this.field.getZero();const n=this.coefficients,g=n.length,r=new Int32Array(g+e),i=this.field;for(let o=0;o<g;o++)r[o]=i.multiply(n[o],t);return new se(i,r)}divide(e){if(!this.field.equals(e.field))throw new c("GenericGFPolys do not have same GenericGF field");if(e.isZero())throw new c("Divide by 0");const t=this.field;let n=t.getZero(),g=this;const r=e.getCoefficient(e.getDegree()),i=t.inverse(r);for(;g.getDegree()>=e.getDegree()&&!g.isZero();){const r=g.getDegree()-e.getDegree(),o=t.multiply(g.getCoefficient(g.getDegree()),i),s=e.multiplyByMonomial(r,o),a=t.buildMonomial(r,o);n=n.addOrSubtract(a),g=g.addOrSubtract(s)}return[n,g]}toString(){let e="";for(let t=this.getDegree();t>=0;t--){let n=this.getCoefficient(t);if(0!==n){if(n<0?(e+=" - ",n=-n):e.length>0&&(e+=" + "),0===t||1!==n){const t=this.field.log(n);0===t?e+="1":1===t?e+="a":(e+="a^",e+=t)}0!==t&&(1===t?e+="x":(e+="x^",e+=t))}}return e}}class ae extends l{}ae.kind="ArithmeticException";class Ie extends oe{constructor(e,t,n){super(),this.primitive=e,this.size=t,this.generatorBase=n;const g=new Int32Array(t);let r=1;for(let o=0;o<t;o++)g[o]=r,r*=2,r>=t&&(r^=e,r&=t-1);this.expTable=g;const i=new Int32Array(t);for(let o=0;o<t-1;o++)i[g[o]]=o;this.logTable=i,this.zero=new se(this,Int32Array.from([0])),this.one=new se(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new c;if(0===t)return this.zero;const n=new Int32Array(e+1);return n[0]=t,new se(this,n)}inverse(e){if(0===e)throw new ae;return this.expTable[this.size-this.logTable[e]-1]}multiply(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+y.toHexString(this.primitive)+","+this.size+")"}equals(e){return e===this}}Ie.AZTEC_DATA_12=new Ie(4201,4096,1),Ie.AZTEC_DATA_10=new Ie(1033,1024,1),Ie.AZTEC_DATA_6=new Ie(67,64,1),Ie.AZTEC_PARAM=new Ie(19,16,1),Ie.QR_CODE_FIELD_256=new Ie(285,256,0),Ie.DATA_MATRIX_FIELD_256=new Ie(301,256,1),Ie.AZTEC_DATA_8=Ie.DATA_MATRIX_FIELD_256,Ie.MAXICODE_FIELD_64=Ie.AZTEC_DATA_6;class le extends l{}le.kind="ReedSolomonException";class Ce extends l{}Ce.kind="IllegalStateException";class ce{constructor(e){this.field=e}decode(e,t){const n=this.field,g=new se(n,e),r=new Int32Array(t);let i=!0;for(let c=0;c<t;c++){const e=g.evaluateAt(n.exp(c+n.getGeneratorBase()));r[r.length-1-c]=e,0!==e&&(i=!1)}if(i)return;const o=new se(n,r),s=this.runEuclideanAlgorithm(n.buildMonomial(t,1),o,t),a=s[0],I=s[1],l=this.findErrorLocations(a),C=this.findErrorMagnitudes(I,l);for(let c=0;c<l.length;c++){const t=e.length-1-n.log(l[c]);if(t<0)throw new le("Bad error location");e[t]=Ie.addOrSubtract(e[t],C[c])}}runEuclideanAlgorithm(e,t,n){if(e.getDegree()<t.getDegree()){const n=e;e=t,t=n}const g=this.field;let r=e,i=t,o=g.getZero(),s=g.getOne();for(;i.getDegree()>=(n/2|0);){let e=r,t=o;if(r=i,o=s,r.isZero())throw new le("r_{i-1} was zero");i=e;let n=g.getZero();const a=r.getCoefficient(r.getDegree()),I=g.inverse(a);for(;i.getDegree()>=r.getDegree()&&!i.isZero();){const e=i.getDegree()-r.getDegree(),t=g.multiply(i.getCoefficient(i.getDegree()),I);n=n.addOrSubtract(g.buildMonomial(e,t)),i=i.addOrSubtract(r.multiplyByMonomial(e,t))}if(s=n.multiply(o).addOrSubtract(t),i.getDegree()>=r.getDegree())throw new Ce("Division algorithm failed to reduce polynomial?")}const a=s.getCoefficient(0);if(0===a)throw new le("sigmaTilde(0) was zero");const I=g.inverse(a);return[s.multiplyScalar(I),i.multiplyScalar(I)]}findErrorLocations(e){const t=e.getDegree();if(1===t)return Int32Array.from([e.getCoefficient(1)]);const n=new Int32Array(t);let g=0;const r=this.field;for(let i=1;i<r.getSize()&&g<t;i++)0===e.evaluateAt(i)&&(n[g]=r.inverse(i),g++);if(g!==t)throw new le("Error locator degree does not match number of roots");return n}findErrorMagnitudes(e,t){const n=t.length,g=new Int32Array(n),r=this.field;for(let i=0;i<n;i++){const o=r.inverse(t[i]);let s=1;for(let e=0;e<n;e++)if(i!==e){const n=r.multiply(t[e],o),g=1&n?-2&n:1|n;s=r.multiply(s,g)}g[i]=r.multiply(e.evaluateAt(o),r.inverse(s)),0!==r.getGeneratorBase()&&(g[i]=r.multiply(g[i],o))}return g}}($=Q||(Q={}))[$.UPPER=0]="UPPER",$[$.LOWER=1]="LOWER",$[$.MIXED=2]="MIXED",$[$.DIGIT=3]="DIGIT",$[$.PUNCT=4]="PUNCT",$[$.BINARY=5]="BINARY";class de{decode(e){this.ddata=e;let t=e.getBits(),n=this.extractBits(t),g=this.correctBits(n),r=de.convertBoolArrayToByteArray(g),i=de.getEncodedData(g),o=new ie(r,i,null,null);return o.setNumBits(g.length),o}static highLevelDecode(e){return this.getEncodedData(e)}static getEncodedData(e){let t=e.length,n=Q.UPPER,g=Q.UPPER,r="",i=0;for(;i<t;)if(g===Q.BINARY){if(t-i<5)break;let o=de.readCode(e,i,5);if(i+=5,0===o){if(t-i<11)break;o=de.readCode(e,i,11)+31,i+=11}for(let n=0;n<o;n++){if(t-i<8){i=t;break}const n=de.readCode(e,i,8);r+=w.castAsNonUtf8Char(n),i+=8}g=n}else{let o=g===Q.DIGIT?4:5;if(t-i<o)break;let s=de.readCode(e,i,o);i+=o;let a=de.getCharacter(g,s);a.startsWith("CTRL_")?(n=g,g=de.getTable(a.charAt(5)),"L"===a.charAt(6)&&(n=g)):(r+=a,g=n)}return r}static getTable(e){switch(e){case"L":return Q.LOWER;case"P":return Q.PUNCT;case"M":return Q.MIXED;case"D":return Q.DIGIT;case"B":return Q.BINARY;default:return Q.UPPER}}static getCharacter(e,t){switch(e){case Q.UPPER:return de.UPPER_TABLE[t];case Q.LOWER:return de.LOWER_TABLE[t];case Q.MIXED:return de.MIXED_TABLE[t];case Q.PUNCT:return de.PUNCT_TABLE[t];case Q.DIGIT:return de.DIGIT_TABLE[t];default:throw new Ce("Bad table")}}correctBits(e){let t,n;this.ddata.getNbLayers()<=2?(n=6,t=Ie.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(n=8,t=Ie.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(n=10,t=Ie.AZTEC_DATA_10):(n=12,t=Ie.AZTEC_DATA_12);let g=this.ddata.getNbDatablocks(),r=e.length/n;if(r<g)throw new S;let i=e.length%n,o=new Int32Array(r);for(let c=0;c<r;c++,i+=n)o[c]=de.readCode(e,i,n);try{new ce(t).decode(o,r-g)}catch(C){throw new S(C)}let s=(1<<n)-1,a=0;for(let c=0;c<g;c++){let e=o[c];if(0===e||e===s)throw new S;1!==e&&e!==s-1||a++}let I=new Array(g*n-a),l=0;for(let c=0;c<g;c++){let e=o[c];if(1===e||e===s-1)I.fill(e>1,l,l+n-1),l+=n-1;else for(let t=n-1;t>=0;--t)I[l++]=!!(e&1<<t)}return I}extractBits(e){let t=this.ddata.isCompact(),n=this.ddata.getNbLayers(),g=(t?11:14)+4*n,r=new Int32Array(g),i=new Array(this.totalBitsInLayer(n,t));if(t)for(let o=0;o<r.length;o++)r[o]=o;else{let e=g+1+2*y.truncDivision(y.truncDivision(g,2)-1,15),t=g/2,n=y.truncDivision(e,2);for(let g=0;g<t;g++){let e=g+y.truncDivision(g,15);r[t-g-1]=n-e-1,r[t+g]=n+e+1}}for(let o=0,s=0;o<n;o++){let a=4*(n-o)+(t?9:12),I=2*o,l=g-1-I;for(let t=0;t<a;t++){let n=2*t;for(let g=0;g<2;g++)i[s+n+g]=e.get(r[I+g],r[I+t]),i[s+2*a+n+g]=e.get(r[I+t],r[l-g]),i[s+4*a+n+g]=e.get(r[l-g],r[l-t]),i[s+6*a+n+g]=e.get(r[l-t],r[I+g])}s+=8*a}return i}static readCode(e,t,n){let g=0;for(let r=t;r<t+n;r++)g<<=1,e[r]&&(g|=1);return g}static readByte(e,t){let n=e.length-t;return n>=8?de.readCode(e,t,8):de.readCode(e,t,n)<<8-n}static convertBoolArrayToByteArray(e){let t=new Uint8Array((e.length+7)/8);for(let n=0;n<t.length;n++)t[n]=de.readByte(e,8*n);return t}totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}de.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],de.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],de.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","\t","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],de.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],de.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class ue{constructor(){}static round(e){return NaN===e?0:e<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:e>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e+(e<0?-.5:.5)|0}static distance(e,t,n,g){const r=e-n,i=t-g;return Math.sqrt(r*r+i*i)}static sum(e){let t=0;for(let n=0,g=e.length;n!==g;n++)t+=e[n];return t}}class Ae{static floatToIntBits(e){return e}}Ae.MAX_VALUE=Number.MAX_SAFE_INTEGER;class he{constructor(e,t){this.x=e,this.y=t}getX(){return this.x}getY(){return this.y}equals(e){if(e instanceof he){const t=e;return this.x===t.x&&this.y===t.y}return!1}hashCode(){return 31*Ae.floatToIntBits(this.x)+Ae.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(e){const t=this.distance(e[0],e[1]),n=this.distance(e[1],e[2]),g=this.distance(e[0],e[2]);let r,i,o;if(n>=t&&n>=g?(i=e[0],r=e[1],o=e[2]):g>=n&&g>=t?(i=e[1],r=e[0],o=e[2]):(i=e[2],r=e[0],o=e[1]),this.crossProductZ(r,i,o)<0){const e=r;r=o,o=e}e[0]=r,e[1]=i,e[2]=o}static distance(e,t){return ue.distance(e.x,e.y,t.x,t.y)}static crossProductZ(e,t,n){const g=t.x,r=t.y;return(n.x-g)*(e.y-r)-(n.y-r)*(e.x-g)}}class me{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class be extends me{constructor(e,t,n,g,r){super(e,t),this.compact=n,this.nbDatablocks=g,this.nbLayers=r}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class pe{constructor(e,t,n,g){this.image=e,this.height=e.getHeight(),this.width=e.getWidth(),null==t&&(t=pe.INIT_SIZE),null==n&&(n=e.getWidth()/2|0),null==g&&(g=e.getHeight()/2|0);const r=t/2|0;if(this.leftInit=n-r,this.rightInit=n+r,this.upInit=g-r,this.downInit=g+r,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new X}detect(){let e=this.leftInit,t=this.rightInit,n=this.upInit,g=this.downInit,r=!1,i=!0,o=!1,s=!1,a=!1,I=!1,l=!1;const C=this.width,c=this.height;for(;i;){i=!1;let d=!0;for(;(d||!s)&&t<C;)d=this.containsBlackPoint(n,g,t,!1),d?(t++,i=!0,s=!0):s||t++;if(t>=C){r=!0;break}let u=!0;for(;(u||!a)&&g<c;)u=this.containsBlackPoint(e,t,g,!0),u?(g++,i=!0,a=!0):a||g++;if(g>=c){r=!0;break}let A=!0;for(;(A||!I)&&e>=0;)A=this.containsBlackPoint(n,g,e,!1),A?(e--,i=!0,I=!0):I||e--;if(e<0){r=!0;break}let h=!0;for(;(h||!l)&&n>=0;)h=this.containsBlackPoint(e,t,n,!0),h?(n--,i=!0,l=!0):l||n--;if(n<0){r=!0;break}i&&(o=!0)}if(!r&&o){const r=t-e;let i=null;for(let t=1;null===i&&t<r;t++)i=this.getBlackPointOnSegment(e,g-t,e+t,g);if(null==i)throw new X;let o=null;for(let t=1;null===o&&t<r;t++)o=this.getBlackPointOnSegment(e,n+t,e+t,n);if(null==o)throw new X;let s=null;for(let e=1;null===s&&e<r;e++)s=this.getBlackPointOnSegment(t,n+e,t-e,n);if(null==s)throw new X;let a=null;for(let e=1;null===a&&e<r;e++)a=this.getBlackPointOnSegment(t,g-e,t-e,g);if(null==a)throw new X;return this.centerEdges(a,i,s,o)}throw new X}getBlackPointOnSegment(e,t,n,g){const r=ue.round(ue.distance(e,t,n,g)),i=(n-e)/r,o=(g-t)/r,s=this.image;for(let a=0;a<r;a++){const n=ue.round(e+a*i),g=ue.round(t+a*o);if(s.get(n,g))return new he(n,g)}return null}centerEdges(e,t,n,g){const r=e.getX(),i=e.getY(),o=t.getX(),s=t.getY(),a=n.getX(),I=n.getY(),l=g.getX(),C=g.getY(),c=pe.CORR;return r<this.width/2?[new he(l-c,C+c),new he(o+c,s+c),new he(a-c,I-c),new he(r+c,i-c)]:[new he(l+c,C+c),new he(o+c,s-c),new he(a-c,I+c),new he(r-c,i-c)]}containsBlackPoint(e,t,n,g){const r=this.image;if(g){for(let i=e;i<=t;i++)if(r.get(i,n))return!0}else for(let i=e;i<=t;i++)if(r.get(n,i))return!0;return!1}}pe.INIT_SIZE=10,pe.CORR=1;class ye{static checkAndNudgePoints(e,t){const n=e.getWidth(),g=e.getHeight();let r=!0;for(let i=0;i<t.length&&r;i+=2){const e=Math.floor(t[i]),o=Math.floor(t[i+1]);if(e<-1||e>n||o<-1||o>g)throw new X;r=!1,-1===e?(t[i]=0,r=!0):e===n&&(t[i]=n-1,r=!0),-1===o?(t[i+1]=0,r=!0):o===g&&(t[i+1]=g-1,r=!0)}r=!0;for(let i=t.length-2;i>=0&&r;i-=2){const e=Math.floor(t[i]),o=Math.floor(t[i+1]);if(e<-1||e>n||o<-1||o>g)throw new X;r=!1,-1===e?(t[i]=0,r=!0):e===n&&(t[i]=n-1,r=!0),-1===o?(t[i+1]=0,r=!0):o===g&&(t[i+1]=g-1,r=!0)}}}class Ze{constructor(e,t,n,g,r,i,o,s,a){this.a11=e,this.a21=t,this.a31=n,this.a12=g,this.a22=r,this.a32=i,this.a13=o,this.a23=s,this.a33=a}static quadrilateralToQuadrilateral(e,t,n,g,r,i,o,s,a,I,l,C,c,d,u,A){const h=Ze.quadrilateralToSquare(e,t,n,g,r,i,o,s);return Ze.squareToQuadrilateral(a,I,l,C,c,d,u,A).times(h)}transformPoints(e){const t=e.length,n=this.a11,g=this.a12,r=this.a13,i=this.a21,o=this.a22,s=this.a23,a=this.a31,I=this.a32,l=this.a33;for(let C=0;C<t;C+=2){const t=e[C],c=e[C+1],d=r*t+s*c+l;e[C]=(n*t+i*c+a)/d,e[C+1]=(g*t+o*c+I)/d}}transformPointsWithValues(e,t){const n=this.a11,g=this.a12,r=this.a13,i=this.a21,o=this.a22,s=this.a23,a=this.a31,I=this.a32,l=this.a33,C=e.length;for(let c=0;c<C;c++){const C=e[c],d=t[c],u=r*C+s*d+l;e[c]=(n*C+i*d+a)/u,t[c]=(g*C+o*d+I)/u}}static squareToQuadrilateral(e,t,n,g,r,i,o,s){const a=e-n+r-o,I=t-g+i-s;if(0===a&&0===I)return new Ze(n-e,r-n,e,g-t,i-g,t,0,0,1);{const l=n-r,C=o-r,c=g-i,d=s-i,u=l*d-C*c,A=(a*d-C*I)/u,h=(l*I-a*c)/u;return new Ze(n-e+A*n,o-e+h*o,e,g-t+A*g,s-t+h*s,t,A,h,1)}}static quadrilateralToSquare(e,t,n,g,r,i,o,s){return Ze.squareToQuadrilateral(e,t,n,g,r,i,o,s).buildAdjoint()}buildAdjoint(){return new Ze(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(e){return new Ze(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)}}class fe extends ye{sampleGrid(e,t,n,g,r,i,o,s,a,I,l,C,c,d,u,A,h,m,b){const p=Ze.quadrilateralToQuadrilateral(g,r,i,o,s,a,I,l,C,c,d,u,A,h,m,b);return this.sampleGridWithTransform(e,t,n,p)}sampleGridWithTransform(e,t,n,g){if(t<=0||n<=0)throw new X;const r=new k(t,n),i=new Float32Array(2*t);for(let s=0;s<n;s++){const t=i.length,n=s+.5;for(let e=0;e<t;e+=2)i[e]=e/2+.5,i[e+1]=n;g.transformPoints(i),ye.checkAndNudgePoints(e,i);try{for(let n=0;n<t;n+=2)e.get(Math.floor(i[n]),Math.floor(i[n+1]))&&r.set(n/2,s)}catch(o){throw new X}}return r}}class Ge{static setGridSampler(e){Ge.gridSampler=e}static getInstance(){return Ge.gridSampler}}Ge.gridSampler=new fe;class Be{constructor(e,t){this.x=e,this.y=t}toResultPoint(){return new he(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class Se{constructor(e){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=e}detect(){return this.detectMirror(!1)}detectMirror(e){let t=this.getMatrixCenter(),n=this.getBullsEyeCorners(t);if(e){let e=n[0];n[0]=n[2],n[2]=e}this.extractParameters(n);let g=this.sampleGrid(this.image,n[this.shift%4],n[(this.shift+1)%4],n[(this.shift+2)%4],n[(this.shift+3)%4]),r=this.getMatrixCornerPoints(n);return new be(g,r,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(e){if(!(this.isValidPoint(e[0])&&this.isValidPoint(e[1])&&this.isValidPoint(e[2])&&this.isValidPoint(e[3])))throw new X;let t=2*this.nbCenterLayers,n=new Int32Array([this.sampleLine(e[0],e[1],t),this.sampleLine(e[1],e[2],t),this.sampleLine(e[2],e[3],t),this.sampleLine(e[3],e[0],t)]);this.shift=this.getRotation(n,t);let g=0;for(let i=0;i<4;i++){let e=n[(this.shift+i)%4];this.compact?(g<<=7,g+=e>>1&127):(g<<=10,g+=(e>>2&992)+(e>>1&31))}let r=this.getCorrectedParameterData(g,this.compact);this.compact?(this.nbLayers=1+(r>>6),this.nbDataBlocks=1+(63&r)):(this.nbLayers=1+(r>>11),this.nbDataBlocks=1+(2047&r))}getRotation(e,t){let n=0;e.forEach(((e,g,r)=>{n=(e>>t-2<<1)+(1&e)+(n<<3)})),n=((1&n)<<11)+(n>>1);for(let g=0;g<4;g++)if(y.bitCount(n^this.EXPECTED_CORNER_BITS[g])<=2)return g;throw new X}getCorrectedParameterData(e,t){let n,g;t?(n=7,g=2):(n=10,g=4);let r=n-g,i=new Int32Array(n);for(let a=n-1;a>=0;--a)i[a]=15&e,e>>=4;try{new ce(Ie.AZTEC_PARAM).decode(i,r)}catch(s){throw new X}let o=0;for(let a=0;a<g;a++)o=(o<<4)+i[a];return o}getBullsEyeCorners(e){let t=e,n=e,g=e,r=e,i=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let e=this.getFirstDifferent(t,i,1,-1),o=this.getFirstDifferent(n,i,1,1),s=this.getFirstDifferent(g,i,-1,1),a=this.getFirstDifferent(r,i,-1,-1);if(this.nbCenterLayers>2){let n=this.distancePoint(a,e)*this.nbCenterLayers/(this.distancePoint(r,t)*(this.nbCenterLayers+2));if(n<.75||n>1.25||!this.isWhiteOrBlackRectangle(e,o,s,a))break}t=e,n=o,g=s,r=a,i=!i}if(5!==this.nbCenterLayers&&7!==this.nbCenterLayers)throw new X;this.compact=5===this.nbCenterLayers;let o=new he(t.getX()+.5,t.getY()-.5),s=new he(n.getX()+.5,n.getY()+.5),a=new he(g.getX()-.5,g.getY()+.5),I=new he(r.getX()-.5,r.getY()-.5);return this.expandSquare([o,s,a,I],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let e,t,n,g;try{let r=new pe(this.image).detect();e=r[0],t=r[1],n=r[2],g=r[3]}catch(fp){let i=this.image.getWidth()/2,o=this.image.getHeight()/2;e=this.getFirstDifferent(new Be(i+7,o-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new Be(i+7,o+7),!1,1,1).toResultPoint(),n=this.getFirstDifferent(new Be(i-7,o+7),!1,-1,1).toResultPoint(),g=this.getFirstDifferent(new Be(i-7,o-7),!1,-1,-1).toResultPoint()}let r=ue.round((e.getX()+g.getX()+t.getX()+n.getX())/4),i=ue.round((e.getY()+g.getY()+t.getY()+n.getY())/4);try{let o=new pe(this.image,15,r,i).detect();e=o[0],t=o[1],n=o[2],g=o[3]}catch(fp){e=this.getFirstDifferent(new Be(r+7,i-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new Be(r+7,i+7),!1,1,1).toResultPoint(),n=this.getFirstDifferent(new Be(r-7,i+7),!1,-1,1).toResultPoint(),g=this.getFirstDifferent(new Be(r-7,i-7),!1,-1,-1).toResultPoint()}return r=ue.round((e.getX()+g.getX()+t.getX()+n.getX())/4),i=ue.round((e.getY()+g.getY()+t.getY()+n.getY())/4),new Be(r,i)}getMatrixCornerPoints(e){return this.expandSquare(e,2*this.nbCenterLayers,this.getDimension())}sampleGrid(e,t,n,g,r){let i=Ge.getInstance(),o=this.getDimension(),s=o/2-this.nbCenterLayers,a=o/2+this.nbCenterLayers;return i.sampleGrid(e,o,o,s,s,a,s,a,a,s,a,t.getX(),t.getY(),n.getX(),n.getY(),g.getX(),g.getY(),r.getX(),r.getY())}sampleLine(e,t,n){let g=0,r=this.distanceResultPoint(e,t),i=r/n,o=e.getX(),s=e.getY(),a=i*(t.getX()-e.getX())/r,I=i*(t.getY()-e.getY())/r;for(let l=0;l<n;l++)this.image.get(ue.round(o+l*a),ue.round(s+l*I))&&(g|=1<<n-l-1);return g}isWhiteOrBlackRectangle(e,t,n,g){let r=3;e=new Be(e.getX()-r,e.getY()+r),t=new Be(t.getX()-r,t.getY()-r),n=new Be(n.getX()+r,n.getY()-r),g=new Be(g.getX()+r,g.getY()+r);let i=this.getColor(g,e);if(0===i)return!1;let o=this.getColor(e,t);return o===i&&(o=this.getColor(t,n),o===i&&(o=this.getColor(n,g),o===i))}getColor(e,t){let n=this.distancePoint(e,t),g=(t.getX()-e.getX())/n,r=(t.getY()-e.getY())/n,i=0,o=e.getX(),s=e.getY(),a=this.image.get(e.getX(),e.getY()),I=Math.ceil(n);for(let C=0;C<I;C++)o+=g,s+=r,this.image.get(ue.round(o),ue.round(s))!==a&&i++;let l=i/n;return l>.1&&l<.9?0:l<=.1===a?1:-1}getFirstDifferent(e,t,n,g){let r=e.getX()+n,i=e.getY()+g;for(;this.isValid(r,i)&&this.image.get(r,i)===t;)r+=n,i+=g;for(r-=n,i-=g;this.isValid(r,i)&&this.image.get(r,i)===t;)r+=n;for(r-=n;this.isValid(r,i)&&this.image.get(r,i)===t;)i+=g;return i-=g,new Be(r,i)}expandSquare(e,t,n){let g=n/(2*t),r=e[0].getX()-e[2].getX(),i=e[0].getY()-e[2].getY(),o=(e[0].getX()+e[2].getX())/2,s=(e[0].getY()+e[2].getY())/2,a=new he(o+g*r,s+g*i),I=new he(o-g*r,s-g*i);return r=e[1].getX()-e[3].getX(),i=e[1].getY()-e[3].getY(),o=(e[1].getX()+e[3].getX())/2,s=(e[1].getY()+e[3].getY())/2,[a,new he(o+g*r,s+g*i),I,new he(o-g*r,s-g*i)]}isValid(e,t){return e>=0&&e<this.image.getWidth()&&t>0&&t<this.image.getHeight()}isValidPoint(e){let t=ue.round(e.getX()),n=ue.round(e.getY());return this.isValid(t,n)}distancePoint(e,t){return ue.distance(e.getX(),e.getY(),t.getX(),t.getY())}distanceResultPoint(e,t){return ue.distance(e.getX(),e.getY(),t.getX(),t.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(y.truncDivision(this.nbLayers-4,8)+1)+15}}class Re{decode(e,t=null){let n=null,g=new Se(e.getBlackMatrix()),r=null,i=null;try{let e=g.detectMirror(!1);r=e.getPoints(),this.reportFoundResultPoints(t,r),i=(new de).decode(e)}catch(fp){n=fp}if(null==i)try{let e=g.detectMirror(!0);r=e.getPoints(),this.reportFoundResultPoints(t,r),i=(new de).decode(e)}catch(fp){if(null!=n)throw n;throw fp}let o=new D(i.getText(),i.getRawBytes(),i.getNumBits(),r,z.AZTEC,h.currentTimeMillis()),s=i.getByteSegments();null!=s&&o.putMetadata(re.BYTE_SEGMENTS,s);let a=i.getECLevel();return null!=a&&o.putMetadata(re.ERROR_CORRECTION_LEVEL,a),o}reportFoundResultPoints(e,t){if(null!=e){let n=e.get(B.NEED_RESULT_POINT_CALLBACK);null!=n&&t.forEach(((e,t,g)=>{n.foundPossibleResultPoint(e)}))}}reset(){}}class ve extends M{constructor(e=500){super(new Re,e)}}class Ve{decode(e,t){try{return this.doDecode(e,t)}catch(n){if(t&&!0===t.get(B.TRY_HARDER)&&e.isRotateSupported()){const n=e.rotateCounterClockwise(),g=this.doDecode(n,t),r=g.getResultMetadata();let i=270;null!==r&&!0===r.get(re.ORIENTATION)&&(i+=r.get(re.ORIENTATION)%360),g.putMetadata(re.ORIENTATION,i);const o=g.getResultPoints();if(null!==o){const e=n.getHeight();for(let t=0;t<o.length;t++)o[t]=new he(e-o[t].getY()-1,o[t].getX())}return g}throw new X}}reset(){}doDecode(e,t){const n=e.getWidth(),g=e.getHeight();let r=new Z(n);const i=t&&!0===t.get(B.TRY_HARDER),o=Math.max(1,g>>(i?8:5));let s;s=i?g:15;const a=Math.trunc(g/2);for(let l=0;l<s;l++){const i=Math.trunc((l+1)/2),s=a+o*(1&l?-i:i);if(s<0||s>=g)break;try{r=e.getBlackRow(s,r)}catch(I){continue}for(let e=0;e<2;e++){if(1===e&&(r.reverse(),t&&!0===t.get(B.NEED_RESULT_POINT_CALLBACK))){const e=new Map;t.forEach(((t,n)=>e.set(n,t))),e.delete(B.NEED_RESULT_POINT_CALLBACK),t=e}try{const g=this.decodeRow(s,r,t);if(1===e){g.putMetadata(re.ORIENTATION,180);const e=g.getResultPoints();null!==e&&(e[0]=new he(n-e[0].getX()-1,e[0].getY()),e[1]=new he(n-e[1].getX()-1,e[1].getY()))}return g}catch(eee){}}}throw new X}static recordPattern(e,t,n){const g=n.length;for(let a=0;a<g;a++)n[a]=0;const r=e.getSize();if(t>=r)throw new X;let i=!e.get(t),o=0,s=t;for(;s<r;){if(e.get(s)!==i)n[o]++;else{if(++o===g)break;n[o]=1,i=!i}s++}if(o!==g&&(o!==g-1||s!==r))throw new X}static recordPatternInReverse(e,t,n){let g=n.length,r=e.get(t);for(;t>0&&g>=0;)e.get(--t)!==r&&(g--,r=!r);if(g>=0)throw new X;Ve.recordPattern(e,t+1,n)}static patternMatchVariance(e,t,n){const g=e.length;let r=0,i=0;for(let a=0;a<g;a++)r+=e[a],i+=t[a];if(r<i)return Number.POSITIVE_INFINITY;const o=r/i;n*=o;let s=0;for(let a=0;a<g;a++){const g=e[a],r=t[a]*o,i=g>r?g-r:r-g;if(i>n)return Number.POSITIVE_INFINITY;s+=i}return s/r}}class we extends Ve{static findStartPattern(e){const t=e.getSize(),n=e.getNextSet(0);let g=0,r=Int32Array.from([0,0,0,0,0,0]),i=n,o=!1;const s=6;for(let a=n;a<t;a++)if(e.get(a)!==o)r[g]++;else{if(g===s-1){let t=we.MAX_AVG_VARIANCE,n=-1;for(let e=we.CODE_START_A;e<=we.CODE_START_C;e++){const g=Ve.patternMatchVariance(r,we.CODE_PATTERNS[e],we.MAX_INDIVIDUAL_VARIANCE);g<t&&(t=g,n=e)}if(n>=0&&e.isRange(Math.max(0,i-(a-i)/2),i,!1))return Int32Array.from([i,a,n]);i+=r[0]+r[1],r=r.slice(2,r.length-1),r[g-1]=0,r[g]=0,g--}else g++;r[g]=1,o=!o}throw new X}static decodeCode(e,t,n){Ve.recordPattern(e,n,t);let g=we.MAX_AVG_VARIANCE,r=-1;for(let i=0;i<we.CODE_PATTERNS.length;i++){const e=we.CODE_PATTERNS[i],n=this.patternMatchVariance(t,e,we.MAX_INDIVIDUAL_VARIANCE);n<g&&(g=n,r=i)}if(r>=0)return r;throw new X}decodeRow(e,t,n){const g=n&&!0===n.get(B.ASSUME_GS1),r=we.findStartPattern(t),i=r[2];let o=0;const s=new Uint8Array(20);let a;switch(s[o++]=i,i){case we.CODE_START_A:a=we.CODE_CODE_A;break;case we.CODE_START_B:a=we.CODE_CODE_B;break;case we.CODE_START_C:a=we.CODE_CODE_C;break;default:throw new S}let I=!1,l=!1,C="",c=r[0],d=r[1];const A=Int32Array.from([0,0,0,0,0,0]);let h=0,m=0,b=i,p=0,y=!0,Z=!1,f=!1;for(;!I;){const e=l;switch(l=!1,h=m,m=we.decodeCode(t,A,d),s[o++]=m,m!==we.CODE_STOP&&(y=!0),m!==we.CODE_STOP&&(p++,b+=p*m),c=d,d+=A.reduce(((e,t)=>e+t),0),m){case we.CODE_START_A:case we.CODE_START_B:case we.CODE_START_C:throw new S}switch(a){case we.CODE_CODE_A:if(m<64)C+=f===Z?String.fromCharCode(" ".charCodeAt(0)+m):String.fromCharCode(" ".charCodeAt(0)+m+128),f=!1;else if(m<96)C+=f===Z?String.fromCharCode(m-64):String.fromCharCode(m+64),f=!1;else switch(m!==we.CODE_STOP&&(y=!1),m){case we.CODE_FNC_1:g&&(0===C.length?C+="]C1":C+=String.fromCharCode(29));break;case we.CODE_FNC_2:case we.CODE_FNC_3:break;case we.CODE_FNC_4_A:!Z&&f?(Z=!0,f=!1):Z&&f?(Z=!1,f=!1):f=!0;break;case we.CODE_SHIFT:l=!0,a=we.CODE_CODE_B;break;case we.CODE_CODE_B:a=we.CODE_CODE_B;break;case we.CODE_CODE_C:a=we.CODE_CODE_C;break;case we.CODE_STOP:I=!0}break;case we.CODE_CODE_B:if(m<96)C+=f===Z?String.fromCharCode(" ".charCodeAt(0)+m):String.fromCharCode(" ".charCodeAt(0)+m+128),f=!1;else switch(m!==we.CODE_STOP&&(y=!1),m){case we.CODE_FNC_1:g&&(0===C.length?C+="]C1":C+=String.fromCharCode(29));break;case we.CODE_FNC_2:case we.CODE_FNC_3:break;case we.CODE_FNC_4_B:!Z&&f?(Z=!0,f=!1):Z&&f?(Z=!1,f=!1):f=!0;break;case we.CODE_SHIFT:l=!0,a=we.CODE_CODE_A;break;case we.CODE_CODE_A:a=we.CODE_CODE_A;break;case we.CODE_CODE_C:a=we.CODE_CODE_C;break;case we.CODE_STOP:I=!0}break;case we.CODE_CODE_C:if(m<100)m<10&&(C+="0"),C+=m;else switch(m!==we.CODE_STOP&&(y=!1),m){case we.CODE_FNC_1:g&&(0===C.length?C+="]C1":C+=String.fromCharCode(29));break;case we.CODE_CODE_A:a=we.CODE_CODE_A;break;case we.CODE_CODE_B:a=we.CODE_CODE_B;break;case we.CODE_STOP:I=!0}}e&&(a=a===we.CODE_CODE_A?we.CODE_CODE_B:we.CODE_CODE_A)}const G=d-c;if(d=t.getNextUnset(d),!t.isRange(d,Math.min(t.getSize(),d+(d-c)/2),!1))throw new X;if(b-=p*h,b%103!==h)throw new u;const R=C.length;if(0===R)throw new X;R>0&&y&&(C=a===we.CODE_CODE_C?C.substring(0,R-2):C.substring(0,R-1));const v=(r[1]+r[0])/2,V=c+G/2,w=s.length,W=new Uint8Array(w);for(let u=0;u<w;u++)W[u]=s[u];const k=[new he(v,e),new he(V,e)];return new D(C,W,0,k,z.CODE_128,(new Date).getTime())}}we.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],we.MAX_AVG_VARIANCE=.25,we.MAX_INDIVIDUAL_VARIANCE=.7,we.CODE_SHIFT=98,we.CODE_CODE_C=99,we.CODE_CODE_B=100,we.CODE_CODE_A=101,we.CODE_FNC_1=102,we.CODE_FNC_2=97,we.CODE_FNC_3=96,we.CODE_FNC_4_A=101,we.CODE_FNC_4_B=100,we.CODE_START_A=103,we.CODE_START_B=104,we.CODE_START_C=105,we.CODE_STOP=106;class We extends Ve{constructor(e=!1,t=!1){super(),this.usingCheckDigit=e,this.extendedMode=t,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(e,t,n){let g=this.counters;g.fill(0),this.decodeRowResult="";let r,i,o=We.findAsteriskPattern(t,g),s=t.getNextSet(o[1]),a=t.getSize();do{We.recordPattern(t,s,g);let e=We.toNarrowWidePattern(g);if(e<0)throw new X;r=We.patternToChar(e),this.decodeRowResult+=r,i=s;for(let t of g)s+=t;s=t.getNextSet(s)}while("*"!==r);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let I,l=0;for(let d of g)l+=d;if(s!==a&&2*(s-i-l)<l)throw new X;if(this.usingCheckDigit){let e=this.decodeRowResult.length-1,t=0;for(let n=0;n<e;n++)t+=We.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(n));if(this.decodeRowResult.charAt(e)!==We.ALPHABET_STRING.charAt(t%43))throw new u;this.decodeRowResult=this.decodeRowResult.substring(0,e)}if(0===this.decodeRowResult.length)throw new X;I=this.extendedMode?We.decodeExtended(this.decodeRowResult):this.decodeRowResult;let C=(o[1]+o[0])/2,c=i+l/2;return new D(I,null,0,[new he(C,e),new he(c,e)],z.CODE_39,(new Date).getTime())}static findAsteriskPattern(e,t){let n=e.getSize(),g=e.getNextSet(0),r=0,i=g,o=!1,s=t.length;for(let a=g;a<n;a++)if(e.get(a)!==o)t[r]++;else{if(r===s-1){if(this.toNarrowWidePattern(t)===We.ASTERISK_ENCODING&&e.isRange(Math.max(0,i-Math.floor((a-i)/2)),i,!1))return[i,a];i+=t[0]+t[1],t.copyWithin(0,2,2+r-1),t[r-1]=0,t[r]=0,r--}else r++;t[r]=1,o=!o}throw new X}static toNarrowWidePattern(e){let t,n=e.length,g=0;do{let r=2147483647;for(let t of e)t<r&&t>g&&(r=t);g=r,t=0;let i=0,o=0;for(let s=0;s<n;s++){let r=e[s];r>g&&(o|=1<<n-1-s,t++,i+=r)}if(3===t){for(let r=0;r<n&&t>0;r++){let n=e[r];if(n>g&&(t--,2*n>=i))return-1}return o}}while(t>3);return-1}static patternToChar(e){for(let t=0;t<We.CHARACTER_ENCODINGS.length;t++)if(We.CHARACTER_ENCODINGS[t]===e)return We.ALPHABET_STRING.charAt(t);if(e===We.ASTERISK_ENCODING)return"*";throw new X}static decodeExtended(e){let t=e.length,n="";for(let g=0;g<t;g++){let t=e.charAt(g);if("+"===t||"$"===t||"%"===t||"/"===t){let r=e.charAt(g+1),i="\0";switch(t){case"+":if(!(r>="A"&&r<="Z"))throw new S;i=String.fromCharCode(r.charCodeAt(0)+32);break;case"$":if(!(r>="A"&&r<="Z"))throw new S;i=String.fromCharCode(r.charCodeAt(0)-64);break;case"%":if(r>="A"&&r<="E")i=String.fromCharCode(r.charCodeAt(0)-38);else if(r>="F"&&r<="J")i=String.fromCharCode(r.charCodeAt(0)-11);else if(r>="K"&&r<="O")i=String.fromCharCode(r.charCodeAt(0)+16);else if(r>="P"&&r<="T")i=String.fromCharCode(r.charCodeAt(0)+43);else if("U"===r)i="\0";else if("V"===r)i="@";else if("W"===r)i="`";else{if("X"!==r&&"Y"!==r&&"Z"!==r)throw new S;i=""}break;case"/":if(r>="A"&&r<="O")i=String.fromCharCode(r.charCodeAt(0)-32);else{if("Z"!==r)throw new S;i=":"}}n+=i,g++}else n+=t}return n}}We.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",We.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],We.ASTERISK_ENCODING=148;class ke extends Ve{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(e,t,n){let g=this.decodeStart(t),r=this.decodeEnd(t),i=new W;ke.decodeMiddle(t,g[1],r[0],i);let o=i.toString(),s=null;null!=n&&(s=n.get(B.ALLOWED_LENGTHS)),null==s&&(s=ke.DEFAULT_ALLOWED_LENGTHS);let a=o.length,I=!1,l=0;for(let c of s){if(a===c){I=!0;break}c>l&&(l=c)}if(!I&&a>l&&(I=!0),!I)throw new S;const C=[new he(g[1],e),new he(r[0],e)];return new D(o,null,0,C,z.ITF,(new Date).getTime())}static decodeMiddle(e,t,n,g){let r=new Int32Array(10),i=new Int32Array(5),o=new Int32Array(5);for(r.fill(0),i.fill(0),o.fill(0);t<n;){Ve.recordPattern(e,t,r);for(let e=0;e<5;e++){let t=2*e;i[e]=r[t],o[e]=r[t+1]}let n=ke.decodeDigit(i);g.append(n.toString()),n=this.decodeDigit(o),g.append(n.toString()),r.forEach((function(e){t+=e}))}}decodeStart(e){let t=ke.skipWhiteSpace(e),n=ke.findGuardPattern(e,t,ke.START_PATTERN);return this.narrowLineWidth=(n[1]-n[0])/4,this.validateQuietZone(e,n[0]),n}validateQuietZone(e,t){let n=10*this.narrowLineWidth;n=n<t?n:t;for(let g=t-1;n>0&&g>=0&&!e.get(g);g--)n--;if(0!==n)throw new X}static skipWhiteSpace(e){const t=e.getSize(),n=e.getNextSet(0);if(n===t)throw new X;return n}decodeEnd(e){e.reverse();try{let t,n=ke.skipWhiteSpace(e);try{t=ke.findGuardPattern(e,n,ke.END_PATTERN_REVERSED[0])}catch(Vye){Vye instanceof X&&(t=ke.findGuardPattern(e,n,ke.END_PATTERN_REVERSED[1]))}this.validateQuietZone(e,t[0]);let g=t[0];return t[0]=e.getSize()-t[1],t[1]=e.getSize()-g,t}finally{e.reverse()}}static findGuardPattern(e,t,n){let g=n.length,r=new Int32Array(g),i=e.getSize(),o=!1,s=0,a=t;r.fill(0);for(let I=t;I<i;I++)if(e.get(I)!==o)r[s]++;else{if(s===g-1){if(Ve.patternMatchVariance(r,n,ke.MAX_INDIVIDUAL_VARIANCE)<ke.MAX_AVG_VARIANCE)return[a,I];a+=r[0]+r[1],h.arraycopy(r,2,r,0,s-1),r[s-1]=0,r[s]=0,s--}else s++;r[s]=1,o=!o}throw new X}static decodeDigit(e){let t=ke.MAX_AVG_VARIANCE,n=-1,g=ke.PATTERNS.length;for(let r=0;r<g;r++){let g=ke.PATTERNS[r],i=Ve.patternMatchVariance(e,g,ke.MAX_INDIVIDUAL_VARIANCE);i<t?(t=i,n=r):i===t&&(n=-1)}if(n>=0)return n%10;throw new X}}ke.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],ke.MAX_AVG_VARIANCE=.38,ke.MAX_INDIVIDUAL_VARIANCE=.5,ke.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],ke.START_PATTERN=Int32Array.from([1,1,1,1]),ke.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Xe extends Ve{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(e){let t,n=!1,g=0,r=Int32Array.from([0,0,0]);for(;!n;){r=Int32Array.from([0,0,0]),t=Xe.findGuardPattern(e,g,!1,this.START_END_PATTERN,r);let i=t[0];g=t[1];let o=i-(g-i);o>=0&&(n=e.isRange(o,i,!1))}return t}static checkChecksum(e){return Xe.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(0===t)return!1;let n=parseInt(e.charAt(t-1),10);return Xe.getStandardUPCEANChecksum(e.substring(0,t-1))===n}static getStandardUPCEANChecksum(e){let t=e.length,n=0;for(let g=t-1;g>=0;g-=2){let t=e.charAt(g).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;n+=t}n*=3;for(let g=t-2;g>=0;g-=2){let t=e.charAt(g).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;n+=t}return(1e3-n)%10}static decodeEnd(e,t){return Xe.findGuardPattern(e,t,!1,Xe.START_END_PATTERN,new Int32Array(Xe.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(e,t,n,g){return this.findGuardPattern(e,t,n,g,new Int32Array(g.length))}static findGuardPattern(e,t,n,g,r){let i=e.getSize(),o=0,s=t=n?e.getNextUnset(t):e.getNextSet(t),a=g.length,I=n;for(let l=t;l<i;l++)if(e.get(l)!==I)r[o]++;else{if(o===a-1){if(Ve.patternMatchVariance(r,g,Xe.MAX_INDIVIDUAL_VARIANCE)<Xe.MAX_AVG_VARIANCE)return Int32Array.from([s,l]);s+=r[0]+r[1];let e=r.slice(2,r.length-1);for(let t=0;t<o-1;t++)r[t]=e[t];r[o-1]=0,r[o]=0,o--}else o++;r[o]=1,I=!I}throw new X}static decodeDigit(e,t,n,g){this.recordPattern(e,n,t);let r=this.MAX_AVG_VARIANCE,i=-1,o=g.length;for(let s=0;s<o;s++){let e=g[s],n=Ve.patternMatchVariance(t,e,Xe.MAX_INDIVIDUAL_VARIANCE);n<r&&(r=n,i=s)}if(i>=0)return i;throw new X}}Xe.MAX_AVG_VARIANCE=.48,Xe.MAX_INDIVIDUAL_VARIANCE=.7,Xe.START_END_PATTERN=Int32Array.from([1,1,1]),Xe.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Xe.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Xe.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class Ne{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,n){let g=this.decodeRowStringBuffer,r=this.decodeMiddle(t,n,g),i=g.toString(),o=Ne.parseExtensionString(i),s=[new he((n[0]+n[1])/2,e),new he(r,e)],a=new D(i,null,0,s,z.UPC_EAN_EXTENSION,(new Date).getTime());return null!=o&&a.putAllMetadata(o),a}decodeMiddle(e,t,n){let g=this.decodeMiddleCounters;g[0]=0,g[1]=0,g[2]=0,g[3]=0;let r=e.getSize(),i=t[1],o=0;for(let a=0;a<5&&i<r;a++){let t=Xe.decodeDigit(e,g,i,Xe.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of g)i+=e;t>=10&&(o|=1<<4-a),4!==a&&(i=e.getNextSet(i),i=e.getNextUnset(i))}if(5!==n.length)throw new X;let s=this.determineCheckDigit(o);if(Ne.extensionChecksum(n.toString())!==s)throw new X;return i}static extensionChecksum(e){let t=e.length,n=0;for(let g=t-2;g>=0;g-=2)n+=e.charAt(g).charCodeAt(0)-"0".charCodeAt(0);n*=3;for(let g=t-1;g>=0;g-=2)n+=e.charAt(g).charCodeAt(0)-"0".charCodeAt(0);return n*=3,n%10}determineCheckDigit(e){for(let t=0;t<10;t++)if(e===this.CHECK_DIGIT_ENCODINGS[t])return t;throw new X}static parseExtensionString(e){if(5!==e.length)return null;let t=Ne.parseExtension5String(e);return null==t?null:new Map([[re.SUGGESTED_PRICE,t]])}static parseExtension5String(e){let t;switch(e.charAt(0)){case"0":t="£";break;case"5":t="$";break;case"9":switch(e){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}t="";break;default:t=""}let n=parseInt(e.substring(1)),g=n%100;return t+(n/100).toString()+"."+(g<10?"0"+g:g.toString())}}class Je{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,n){let g=this.decodeRowStringBuffer,r=this.decodeMiddle(t,n,g),i=g.toString(),o=Je.parseExtensionString(i),s=[new he((n[0]+n[1])/2,e),new he(r,e)],a=new D(i,null,0,s,z.UPC_EAN_EXTENSION,(new Date).getTime());return null!=o&&a.putAllMetadata(o),a}decodeMiddle(e,t,n){let g=this.decodeMiddleCounters;g[0]=0,g[1]=0,g[2]=0,g[3]=0;let r=e.getSize(),i=t[1],o=0;for(let s=0;s<2&&i<r;s++){let t=Xe.decodeDigit(e,g,i,Xe.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of g)i+=e;t>=10&&(o|=1<<1-s),1!==s&&(i=e.getNextSet(i),i=e.getNextUnset(i))}if(2!==n.length)throw new X;if(parseInt(n.toString())%4!==o)throw new X;return i}static parseExtensionString(e){return 2!==e.length?null:new Map([[re.ISSUE_NUMBER,parseInt(e)]])}}class Ye{static decodeRow(e,t,n){let g=Xe.findGuardPattern(t,n,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return(new Ne).decodeRow(e,t,g)}catch(r){return(new Je).decodeRow(e,t,g)}}}Ye.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Ee extends Xe{constructor(){super(),this.decodeRowStringBuffer="",Ee.L_AND_G_PATTERNS=Ee.L_PATTERNS.map((e=>Int32Array.from(e)));for(let e=10;e<20;e++){let t=Ee.L_PATTERNS[e-10],n=new Int32Array(t.length);for(let e=0;e<t.length;e++)n[e]=t[t.length-e-1];Ee.L_AND_G_PATTERNS[e]=n}}decodeRow(e,t,n){let g=Ee.findStartGuardPattern(t),r=null==n?null:n.get(B.NEED_RESULT_POINT_CALLBACK);if(null!=r){const t=new he((g[0]+g[1])/2,e);r.foundPossibleResultPoint(t)}let i=this.decodeMiddle(t,g,this.decodeRowStringBuffer),o=i.rowOffset,s=i.resultString;if(null!=r){const t=new he(o,e);r.foundPossibleResultPoint(t)}let a=this.decodeEnd(t,o);if(null!=r){const t=new he((a[0]+a[1])/2,e);r.foundPossibleResultPoint(t)}let I=a[1],l=I+(I-a[0]);if(l>=t.getSize()||!t.isRange(I,l,!1))throw new X;let C=s.toString();if(C.length<8)throw new S;if(!Ee.checkChecksum(C))throw new u;let c=(g[1]+g[0])/2,d=(a[1]+a[0])/2,A=this.getBarcodeFormat(),h=[new he(c,e),new he(d,e)],m=new D(C,null,0,h,A,(new Date).getTime()),b=0;try{let n=Ye.decodeRow(e,t,a[1]);m.putMetadata(re.UPC_EAN_EXTENSION,n.getText()),m.putAllMetadata(n.getResultMetadata()),m.addResultPoints(n.getResultPoints()),b=n.getText().length}catch(y){}let p=null==n?null:n.get(B.ALLOWED_EAN_EXTENSIONS);if(null!=p){let e=!1;for(let t in p)if(b.toString()===t){e=!0;break}if(!e)throw new X}return m}decodeEnd(e,t){return Ee.findGuardPattern(e,t,!1,Ee.START_END_PATTERN,new Int32Array(Ee.START_END_PATTERN.length).fill(0))}static checkChecksum(e){return Ee.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(0===t)return!1;let n=parseInt(e.charAt(t-1),10);return Ee.getStandardUPCEANChecksum(e.substring(0,t-1))===n}static getStandardUPCEANChecksum(e){let t=e.length,n=0;for(let g=t-1;g>=0;g-=2){let t=e.charAt(g).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;n+=t}n*=3;for(let g=t-2;g>=0;g-=2){let t=e.charAt(g).charCodeAt(0)-"0".charCodeAt(0);if(t<0||t>9)throw new S;n+=t}return(1e3-n)%10}}class He extends Ee{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,n){let g=this.decodeMiddleCounters;g[0]=0,g[1]=0,g[2]=0,g[3]=0;let r=e.getSize(),i=t[1],o=0;for(let s=0;s<6&&i<r;s++){let t=Ee.decodeDigit(e,g,i,Ee.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of g)i+=e;t>=10&&(o|=1<<5-s)}n=He.determineFirstDigit(n,o),i=Ee.findGuardPattern(e,i,!0,Ee.MIDDLE_PATTERN,new Int32Array(Ee.MIDDLE_PATTERN.length).fill(0))[1];for(let s=0;s<6&&i<r;s++){let t=Ee.decodeDigit(e,g,i,Ee.L_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of g)i+=e}return{rowOffset:i,resultString:n}}getBarcodeFormat(){return z.EAN_13}static determineFirstDigit(e,t){for(let n=0;n<10;n++)if(t===this.FIRST_DIGIT_ENCODINGS[n])return e=String.fromCharCode("0".charCodeAt(0)+n)+e;throw new X}}He.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Fe extends Ee{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,n){const g=this.decodeMiddleCounters;g[0]=0,g[1]=0,g[2]=0,g[3]=0;let r=e.getSize(),i=t[1];for(let o=0;o<4&&i<r;o++){let t=Ee.decodeDigit(e,g,i,Ee.L_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of g)i+=e}i=Ee.findGuardPattern(e,i,!0,Ee.MIDDLE_PATTERN,new Int32Array(Ee.MIDDLE_PATTERN.length).fill(0))[1];for(let o=0;o<4&&i<r;o++){let t=Ee.decodeDigit(e,g,i,Ee.L_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t);for(let e of g)i+=e}return{rowOffset:i,resultString:n}}getBarcodeFormat(){return z.EAN_8}}class xe extends Ee{constructor(){super(...arguments),this.ean13Reader=new He}getBarcodeFormat(){return z.UPC_A}decode(e,t){return this.maybeReturnResult(this.ean13Reader.decode(e))}decodeRow(e,t,n){return this.maybeReturnResult(this.ean13Reader.decodeRow(e,t,n))}decodeMiddle(e,t,n){return this.ean13Reader.decodeMiddle(e,t,n)}maybeReturnResult(e){let t=e.getText();if("0"===t.charAt(0)){let n=new D(t.substring(1),null,null,e.getResultPoints(),z.UPC_A);return null!=e.getResultMetadata()&&n.putAllMetadata(e.getResultMetadata()),n}throw new X}reset(){this.ean13Reader.reset()}}class Te extends Ee{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(e,t,n){const g=this.decodeMiddleCounters.map((e=>e));g[0]=0,g[1]=0,g[2]=0,g[3]=0;const r=e.getSize();let i=t[1],o=0;for(let s=0;s<6&&i<r;s++){const t=Te.decodeDigit(e,g,i,Te.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+t%10);for(let e of g)i+=e;t>=10&&(o|=1<<5-s)}return{rowOffset:i,resultString:Te.determineNumSysAndCheckDigit(n,o)}}decodeEnd(e,t){return Te.findGuardPatternWithoutCounters(e,t,!0,Te.MIDDLE_END_PATTERN)}checkChecksum(e){return Ee.checkChecksum(Te.convertUPCEtoUPCA(e))}static determineNumSysAndCheckDigit(e,t){for(let n=0;n<=1;n++)for(let g=0;g<10;g++)if(t===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[n][g])return String.fromCharCode("0".charCodeAt(0)+n)+e+String.fromCharCode("0".charCodeAt(0)+g);throw X.getNotFoundInstance()}getBarcodeFormat(){return z.UPC_E}static convertUPCEtoUPCA(e){const t=e.slice(1,7).split("").map((e=>e.charCodeAt(0))),n=new W;n.append(e.charAt(0));let g=t[5];switch(g){case 0:case 1:case 2:n.appendChars(t,0,2),n.append(g),n.append("0000"),n.appendChars(t,2,3);break;case 3:n.appendChars(t,0,3),n.append("00000"),n.appendChars(t,3,2);break;case 4:n.appendChars(t,0,4),n.append("00000"),n.append(t[4]);break;default:n.appendChars(t,0,5),n.append("0000"),n.append(g)}return e.length>=8&&n.append(e.charAt(7)),n.toString()}}Te.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Te.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class Ke extends Ve{constructor(e){super();let n=null==e?null:e.get(B.POSSIBLE_FORMATS),g=[];t(n)?(g.push(new He),g.push(new xe),g.push(new Fe),g.push(new Te)):(n.indexOf(z.EAN_13)>-1&&g.push(new He),n.indexOf(z.UPC_A)>-1&&g.push(new xe),n.indexOf(z.EAN_8)>-1&&g.push(new Fe),n.indexOf(z.UPC_E)>-1&&g.push(new Te)),this.readers=g}decodeRow(e,t,n){for(let r of this.readers)try{const g=r.decodeRow(e,t,n),i=g.getBarcodeFormat()===z.EAN_13&&"0"===g.getText().charAt(0),o=null==n?null:n.get(B.POSSIBLE_FORMATS),s=null==o||o.includes(z.UPC_A);if(i&&s){const e=g.getRawBytes(),t=new D(g.getText().substring(1),e,e?e.length:null,g.getResultPoints(),z.UPC_A);return t.putAllMetadata(g.getResultMetadata()),t}return g}catch(g){}throw new X}reset(){for(let e of this.readers)e.reset()}}class Me extends Ve{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(e,t){for(let n=0;n<t.length;n++)if(Ve.patternMatchVariance(e,t[n],Me.MAX_INDIVIDUAL_VARIANCE)<Me.MAX_AVG_VARIANCE)return n;throw new X}static count(e){return ue.sum(new Int32Array(e))}static increment(e,t){let n=0,g=t[0];for(let r=1;r<e.length;r++)t[r]>g&&(g=t[r],n=r);e[n]++}static decrement(e,t){let n=0,g=t[0];for(let r=1;r<e.length;r++)t[r]<g&&(g=t[r],n=r);e[n]--}static isFinderPattern(e){let t=e[0]+e[1],n=t/(t+e[2]+e[3]);if(n>=Me.MIN_FINDER_PATTERN_RATIO&&n<=Me.MAX_FINDER_PATTERN_RATIO){let t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;for(let g of e)g>n&&(n=g),g<t&&(t=g);return n<10*t}return!1}}Me.MAX_AVG_VARIANCE=.2,Me.MAX_INDIVIDUAL_VARIANCE=.45,Me.MIN_FINDER_PATTERN_RATIO=9.5/12,Me.MAX_FINDER_PATTERN_RATIO=12.5/14;class De{constructor(e,t){this.value=e,this.checksumPortion=t}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(e){if(!(e instanceof De))return!1;const t=e;return this.value===t.value&&this.checksumPortion===t.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Le{constructor(e,t,n,g,r){this.value=e,this.startEnd=t,this.value=e,this.startEnd=t,this.resultPoints=new Array,this.resultPoints.push(new he(n,r)),this.resultPoints.push(new he(g,r))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(e){if(!(e instanceof Le))return!1;const t=e;return this.value===t.value}hashCode(){return this.value}}class Ue{constructor(){}static getRSSvalue(e,t,n){let g=0;for(let s of e)g+=s;let r=0,i=0,o=e.length;for(let s=0;s<o-1;s++){let a;for(a=1,i|=1<<s;a<e[s];a++,i&=~(1<<s)){let e=Ue.combins(g-a-1,o-s-2);if(n&&0===i&&g-a-(o-s-1)>=o-s-1&&(e-=Ue.combins(g-a-(o-s),o-s-2)),o-s-1>1){let n=0;for(let e=g-a-(o-s-2);e>t;e--)n+=Ue.combins(g-a-e-1,o-s-3);e-=n*(o-1-s)}else g-a>t&&e--;r+=e}g-=a}return r}static combins(e,t){let n,g;e-t>t?(g=t,n=e-t):(g=e-t,n=t);let r=1,i=1;for(let o=e;o>n;o--)r*=o,i<=g&&(r/=i,i++);for(;i<=g;)r/=i,i++;return r}}class ze{static buildBitArray(e){let t=2*e.length-1;null==e[e.length-1].getRightChar()&&(t-=1);let n=new Z(12*t),g=0,r=e[0].getRightChar().getValue();for(let i=11;i>=0;--i)r&1<<i&&n.set(g),g++;for(let i=1;i<e.length;++i){let t=e[i],r=t.getLeftChar().getValue();for(let e=11;e>=0;--e)r&1<<e&&n.set(g),g++;if(null!=t.getRightChar()){let e=t.getRightChar().getValue();for(let t=11;t>=0;--t)e&1<<t&&n.set(g),g++}}return n}}class Qe{constructor(e,t){t?this.decodedInformation=null:(this.finished=e,this.decodedInformation=t)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Oe{constructor(e){this.newPosition=e}getNewPosition(){return this.newPosition}}class je extends Oe{constructor(e,t){super(e),this.value=t}getValue(){return this.value}isFNC1(){return this.value===je.FNC1}}je.FNC1="$";class Pe extends Oe{constructor(e,t,n){super(e),n?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=t}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class _e extends Oe{constructor(e,t,n){if(super(e),t<0||t>10||n<0||n>10)throw new S;this.firstDigit=t,this.secondDigit=n}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return 10*this.firstDigit+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===_e.FNC1}isSecondDigitFNC1(){return this.secondDigit===_e.FNC1}isAnyFNC1(){return this.firstDigit===_e.FNC1||this.secondDigit===_e.FNC1}}_e.FNC1=10;class qe{constructor(){}static parseFieldsInGeneralPurpose(e){if(!e)return null;if(e.length<2)throw new X;let t=e.substring(0,2);for(let r of qe.TWO_DIGIT_DATA_LENGTH)if(r[0]===t)return r[1]===qe.VARIABLE_LENGTH?qe.processVariableAI(2,r[2],e):qe.processFixedAI(2,r[1],e);if(e.length<3)throw new X;let n=e.substring(0,3);for(let r of qe.THREE_DIGIT_DATA_LENGTH)if(r[0]===n)return r[1]===qe.VARIABLE_LENGTH?qe.processVariableAI(3,r[2],e):qe.processFixedAI(3,r[1],e);for(let r of qe.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(r[0]===n)return r[1]===qe.VARIABLE_LENGTH?qe.processVariableAI(4,r[2],e):qe.processFixedAI(4,r[1],e);if(e.length<4)throw new X;let g=e.substring(0,4);for(let r of qe.FOUR_DIGIT_DATA_LENGTH)if(r[0]===g)return r[1]===qe.VARIABLE_LENGTH?qe.processVariableAI(4,r[2],e):qe.processFixedAI(4,r[1],e);throw new X}static processFixedAI(e,t,n){if(n.length<e)throw new X;let g=n.substring(0,e);if(n.length<e+t)throw new X;let r=n.substring(e,e+t),i=n.substring(e+t),o="("+g+")"+r,s=qe.parseFieldsInGeneralPurpose(i);return null==s?o:o+s}static processVariableAI(e,t,n){let g,r=n.substring(0,e);g=n.length<e+t?n.length:e+t;let i=n.substring(e,g),o=n.substring(g),s="("+r+")"+i,a=qe.parseFieldsInGeneralPurpose(o);return null==a?s:s+a}}qe.VARIABLE_LENGTH=[],qe.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",qe.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",qe.VARIABLE_LENGTH,20],["22",qe.VARIABLE_LENGTH,29],["30",qe.VARIABLE_LENGTH,8],["37",qe.VARIABLE_LENGTH,8],["90",qe.VARIABLE_LENGTH,30],["91",qe.VARIABLE_LENGTH,30],["92",qe.VARIABLE_LENGTH,30],["93",qe.VARIABLE_LENGTH,30],["94",qe.VARIABLE_LENGTH,30],["95",qe.VARIABLE_LENGTH,30],["96",qe.VARIABLE_LENGTH,30],["97",qe.VARIABLE_LENGTH,3],["98",qe.VARIABLE_LENGTH,30],["99",qe.VARIABLE_LENGTH,30]],qe.THREE_DIGIT_DATA_LENGTH=[["240",qe.VARIABLE_LENGTH,30],["241",qe.VARIABLE_LENGTH,30],["242",qe.VARIABLE_LENGTH,6],["250",qe.VARIABLE_LENGTH,30],["251",qe.VARIABLE_LENGTH,30],["253",qe.VARIABLE_LENGTH,17],["254",qe.VARIABLE_LENGTH,20],["400",qe.VARIABLE_LENGTH,30],["401",qe.VARIABLE_LENGTH,30],["402",17],["403",qe.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",qe.VARIABLE_LENGTH,20],["421",qe.VARIABLE_LENGTH,15],["422",3],["423",qe.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],qe.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",qe.VARIABLE_LENGTH,15],["391",qe.VARIABLE_LENGTH,18],["392",qe.VARIABLE_LENGTH,15],["393",qe.VARIABLE_LENGTH,18],["703",qe.VARIABLE_LENGTH,30]],qe.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",qe.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",qe.VARIABLE_LENGTH,20],["8003",qe.VARIABLE_LENGTH,30],["8004",qe.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",qe.VARIABLE_LENGTH,30],["8008",qe.VARIABLE_LENGTH,12],["8018",18],["8020",qe.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",qe.VARIABLE_LENGTH,70],["8200",qe.VARIABLE_LENGTH,70]];class $e{constructor(e){this.buffer=new W,this.information=e}decodeAllCodes(e,t){let n=t,g=null;for(;;){let t=this.decodeGeneralPurposeField(n,g),r=qe.parseFieldsInGeneralPurpose(t.getNewString());if(null!=r&&e.append(r),g=t.isRemaining()?""+t.getRemainingValue():null,n===t.getNewPosition())break;n=t.getNewPosition()}return e.toString()}isStillNumeric(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(let t=e;t<e+3;++t)if(this.information.get(t))return!0;return this.information.get(e+3)}decodeNumeric(e){if(e+7>this.information.getSize()){let t=this.extractNumericValueFromBitArray(e,4);return new _e(this.information.getSize(),0===t?_e.FNC1:t-1,_e.FNC1)}let t=this.extractNumericValueFromBitArray(e,7);return new _e(e+7,(t-8)/11,(t-8)%11)}extractNumericValueFromBitArray(e,t){return $e.extractNumericValueFromBitArray(this.information,e,t)}static extractNumericValueFromBitArray(e,t,n){let g=0;for(let r=0;r<n;++r)e.get(t+r)&&(g|=1<<n-r-1);return g}decodeGeneralPurposeField(e,t){this.buffer.setLengthToZero(),null!=t&&this.buffer.append(t),this.current.setPosition(e);let n=this.parseBlocks();return null!=n&&n.isRemaining()?new Pe(this.current.getPosition(),this.buffer.toString(),n.getRemainingValue()):new Pe(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let e,t;do{let n=this.current.getPosition();if(this.current.isAlpha()?(t=this.parseAlphaBlock(),e=t.isFinished()):this.current.isIsoIec646()?(t=this.parseIsoIec646Block(),e=t.isFinished()):(t=this.parseNumericBlock(),e=t.isFinished()),n===this.current.getPosition()&&!e)break}while(!e);return t.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1()){let t;return t=e.isSecondDigitFNC1()?new Pe(this.current.getPosition(),this.buffer.toString()):new Pe(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()),new Qe(!0,t)}if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1()){let e=new Pe(this.current.getPosition(),this.buffer.toString());return new Qe(!0,e)}this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Qe(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let e=new Pe(this.current.getPosition(),this.buffer.toString());return new Qe(!0,e)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Qe(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let e=new Pe(this.current.getPosition(),this.buffer.toString());return new Qe(!0,e)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Qe(!1)}isStillIsoIec646(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+7>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(e,7);if(n>=64&&n<116)return!0;if(e+8>this.information.getSize())return!1;let g=this.extractNumericValueFromBitArray(e,8);return g>=232&&g<253}decodeIsoIec646(e){let t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new je(e+5,je.FNC1);if(t>=5&&t<15)return new je(e+5,"0"+(t-5));let n,g=this.extractNumericValueFromBitArray(e,7);if(g>=64&&g<90)return new je(e+7,""+(g+1));if(g>=90&&g<116)return new je(e+7,""+(g+7));switch(this.extractNumericValueFromBitArray(e,8)){case 232:n="!";break;case 233:n='"';break;case 234:n="%";break;case 235:n="&";break;case 236:n="'";break;case 237:n="(";break;case 238:n=")";break;case 239:n="*";break;case 240:n="+";break;case 241:n=",";break;case 242:n="-";break;case 243:n=".";break;case 244:n="/";break;case 245:n=":";break;case 246:n=";";break;case 247:n="<";break;case 248:n="=";break;case 249:n=">";break;case 250:n="?";break;case 251:n="_";break;case 252:n=" ";break;default:throw new S}return new je(e+8,n)}isStillAlpha(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+6>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(e,6);return n>=16&&n<63}decodeAlphanumeric(e){let t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new je(e+5,je.FNC1);if(t>=5&&t<15)return new je(e+5,"0"+(t-5));let n,g=this.extractNumericValueFromBitArray(e,6);if(g>=32&&g<58)return new je(e+6,""+(g+33));switch(g){case 58:n="*";break;case 59:n=",";break;case 60:n="-";break;case 61:n=".";break;case 62:n="/";break;default:throw new Ce("Decoding invalid alphanumeric value: "+g)}return new je(e+6,n)}isAlphaTo646ToAlphaLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<5&&t+e<this.information.getSize();++t)if(2===t){if(!this.information.get(e+2))return!1}else if(this.information.get(e+t))return!1;return!0}isAlphaOr646ToNumericLatch(e){if(e+3>this.information.getSize())return!1;for(let t=e;t<e+3;++t)if(this.information.get(t))return!1;return!0}isNumericToAlphaNumericLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<4&&t+e<this.information.getSize();++t)if(this.information.get(e+t))return!1;return!0}}class et{constructor(e){this.information=e,this.generalDecoder=new $e(e)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class tt extends et{constructor(e){super(e)}encodeCompressedGtin(e,t){e.append("(01)");let n=e.length();e.append("9"),this.encodeCompressedGtinWithoutAI(e,t,n)}encodeCompressedGtinWithoutAI(e,t,n){for(let g=0;g<4;++g){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(t+10*g,10);n/100==0&&e.append("0"),n/10==0&&e.append("0"),e.append(n)}tt.appendCheckDigit(e,n)}static appendCheckDigit(e,t){let n=0;for(let g=0;g<13;g++){let r=e.charAt(g+t).charCodeAt(0)-"0".charCodeAt(0);n+=1&g?r:3*r}n=10-n%10,10===n&&(n=0),e.append(n)}}tt.GTIN_SIZE=40;class nt extends tt{constructor(e){super(e)}parseInformation(){let e=new W;e.append("(01)");let t=e.length(),n=this.getGeneralDecoder().extractNumericValueFromBitArray(nt.HEADER_SIZE,4);return e.append(n),this.encodeCompressedGtinWithoutAI(e,nt.HEADER_SIZE+4,t),this.getGeneralDecoder().decodeAllCodes(e,nt.HEADER_SIZE+44)}}nt.HEADER_SIZE=4;class gt extends et{constructor(e){super(e)}parseInformation(){let e=new W;return this.getGeneralDecoder().decodeAllCodes(e,gt.HEADER_SIZE)}}gt.HEADER_SIZE=5;class rt extends tt{constructor(e){super(e)}encodeCompressedWeight(e,t,n){let g=this.getGeneralDecoder().extractNumericValueFromBitArray(t,n);this.addWeightCode(e,g);let r=this.checkWeight(g),i=1e5;for(let o=0;o<5;++o)r/i==0&&e.append("0"),i/=10;e.append(r)}}class it extends rt{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()!=it.HEADER_SIZE+rt.GTIN_SIZE+it.WEIGHT_SIZE)throw new X;let e=new W;return this.encodeCompressedGtin(e,it.HEADER_SIZE),this.encodeCompressedWeight(e,it.HEADER_SIZE+rt.GTIN_SIZE,it.WEIGHT_SIZE),e.toString()}}it.HEADER_SIZE=5,it.WEIGHT_SIZE=15;class ot extends it{constructor(e){super(e)}addWeightCode(e,t){e.append("(3103)")}checkWeight(e){return e}}class st extends it{constructor(e){super(e)}addWeightCode(e,t){t<1e4?e.append("(3202)"):e.append("(3203)")}checkWeight(e){return e<1e4?e:e-1e4}}class at extends tt{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<at.HEADER_SIZE+tt.GTIN_SIZE)throw new X;let e=new W;this.encodeCompressedGtin(e,at.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(at.HEADER_SIZE+tt.GTIN_SIZE,at.LAST_DIGIT_SIZE);e.append("(392"),e.append(t),e.append(")");let n=this.getGeneralDecoder().decodeGeneralPurposeField(at.HEADER_SIZE+tt.GTIN_SIZE+at.LAST_DIGIT_SIZE,null);return e.append(n.getNewString()),e.toString()}}at.HEADER_SIZE=8,at.LAST_DIGIT_SIZE=2;class It extends tt{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<It.HEADER_SIZE+tt.GTIN_SIZE)throw new X;let e=new W;this.encodeCompressedGtin(e,It.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(It.HEADER_SIZE+tt.GTIN_SIZE,It.LAST_DIGIT_SIZE);e.append("(393"),e.append(t),e.append(")");let n=this.getGeneralDecoder().extractNumericValueFromBitArray(It.HEADER_SIZE+tt.GTIN_SIZE+It.LAST_DIGIT_SIZE,It.FIRST_THREE_DIGITS_SIZE);n/100==0&&e.append("0"),n/10==0&&e.append("0"),e.append(n);let g=this.getGeneralDecoder().decodeGeneralPurposeField(It.HEADER_SIZE+tt.GTIN_SIZE+It.LAST_DIGIT_SIZE+It.FIRST_THREE_DIGITS_SIZE,null);return e.append(g.getNewString()),e.toString()}}It.HEADER_SIZE=8,It.LAST_DIGIT_SIZE=2,It.FIRST_THREE_DIGITS_SIZE=10;class lt extends rt{constructor(e,t,n){super(e),this.dateCode=n,this.firstAIdigits=t}parseInformation(){if(this.getInformation().getSize()!=lt.HEADER_SIZE+lt.GTIN_SIZE+lt.WEIGHT_SIZE+lt.DATE_SIZE)throw new X;let e=new W;return this.encodeCompressedGtin(e,lt.HEADER_SIZE),this.encodeCompressedWeight(e,lt.HEADER_SIZE+lt.GTIN_SIZE,lt.WEIGHT_SIZE),this.encodeCompressedDate(e,lt.HEADER_SIZE+lt.GTIN_SIZE+lt.WEIGHT_SIZE),e.toString()}encodeCompressedDate(e,t){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(t,lt.DATE_SIZE);if(38400==n)return;e.append("("),e.append(this.dateCode),e.append(")");let g=n%32;n/=32;let r=n%12+1;n/=12;let i=n;i/10==0&&e.append("0"),e.append(i),r/10==0&&e.append("0"),e.append(r),g/10==0&&e.append("0"),e.append(g)}addWeightCode(e,t){e.append("("),e.append(this.firstAIdigits),e.append(t/1e5),e.append(")")}checkWeight(e){return e%1e5}}function Ct(e){try{if(e.get(1))return new nt(e);if(!e.get(2))return new gt(e);switch($e.extractNumericValueFromBitArray(e,1,4)){case 4:return new ot(e);case 5:return new st(e)}switch($e.extractNumericValueFromBitArray(e,1,5)){case 12:return new at(e);case 13:return new It(e)}switch($e.extractNumericValueFromBitArray(e,1,7)){case 56:return new lt(e,"310","11");case 57:return new lt(e,"320","11");case 58:return new lt(e,"310","13");case 59:return new lt(e,"320","13");case 60:return new lt(e,"310","15");case 61:return new lt(e,"320","15");case 62:return new lt(e,"310","17");case 63:return new lt(e,"320","17")}}catch(fp){throw new Ce("unknown decoder: "+e)}}lt.HEADER_SIZE=8,lt.WEIGHT_SIZE=20,lt.DATE_SIZE=16;class ct{constructor(e,t,n,g){this.leftchar=e,this.rightchar=t,this.finderpattern=n,this.maybeLast=g}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return null==this.rightchar}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(null==this.finderpattern?"null":this.finderpattern.getValue())+" ]"}static equals(e,t){return e instanceof ct&&ct.equalsOrNull(e.leftchar,t.leftchar)&&ct.equalsOrNull(e.rightchar,t.rightchar)&&ct.equalsOrNull(e.finderpattern,t.finderpattern)}static equalsOrNull(e,t){return null===e?null===t:ct.equals(e,t)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class dt{constructor(e,t,n){this.pairs=e,this.rowNumber=t,this.wasReversed=n}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(e){return this.checkEqualitity(this,e)}toString(){return"{ "+this.pairs+" }"}equals(e,t){return e instanceof dt&&this.checkEqualitity(e,t)&&e.wasReversed===t.wasReversed}checkEqualitity(e,t){if(!e||!t)return;let n;return e.forEach(((e,g)=>{t.forEach((t=>{e.getLeftChar().getValue()===t.getLeftChar().getValue()&&e.getRightChar().getValue()===t.getRightChar().getValue()&&e.getFinderPatter().getValue()===t.getFinderPatter().getValue()&&(n=!0)}))})),n}}class ut extends Me{constructor(e){super(...arguments),this.pairs=new Array(ut.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=!0===e}decodeRow(e,t,n){this.pairs.length=0,this.startFromEven=!1;try{return ut.constructResult(this.decodeRow2pairs(e,t))}catch(fp){this.verbose}return this.pairs.length=0,this.startFromEven=!0,ut.constructResult(this.decodeRow2pairs(e,t))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(e,t){let n,g=!1;for(;!g;)try{this.pairs.push(this.retrieveNextPair(t,this.pairs,e))}catch(Vye){if(Vye instanceof X){if(!this.pairs.length)throw new X;g=!0}}if(this.checkChecksum())return this.pairs;if(n=!!this.rows.length,this.storeRow(e,!1),n){let e=this.checkRowsBoolean(!1);if(null!=e)return e;if(e=this.checkRowsBoolean(!0),null!=e)return e}throw new X}checkRowsBoolean(e){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,e&&(this.rows=this.rows.reverse());let t=null;try{t=this.checkRows(new Array,0)}catch(fp){this.verbose}return e&&(this.rows=this.rows.reverse()),t}checkRows(e,t){for(let n=t;n<this.rows.length;n++){let t=this.rows[n];this.pairs.length=0;for(let n of e)this.pairs.push(n.getPairs());if(this.pairs.push(t.getPairs()),!ut.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let g=new Array(e);g.push(t);try{return this.checkRows(g,n+1)}catch(fp){this.verbose}}throw new X}static isValidSequence(e){for(let t of ut.FINDER_PATTERN_SEQUENCES){if(e.length>t.length)continue;let n=!0;for(let g=0;g<e.length;g++)if(e[g].getFinderPattern().getValue()!=t[g]){n=!1;break}if(n)return!0}return!1}storeRow(e,t){let n=0,g=!1,r=!1;for(;n<this.rows.length;){let t=this.rows[n];if(t.getRowNumber()>e){r=t.isEquivalent(this.pairs);break}g=t.isEquivalent(this.pairs),n++}r||g||ut.isPartialRow(this.pairs,this.rows)||(this.rows.push(n,new dt(this.pairs,e,t)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(e,t){for(let n of t)if(n.getPairs().length!==e.length)for(let t of n.getPairs())for(let n of e)if(ct.equals(t,n))break}static isPartialRow(e,t){for(let n of t){let t=!0;for(let g of e){let e=!1;for(let t of n.getPairs())if(g.equals(t)){e=!0;break}if(!e){t=!1;break}}if(t)return!0}return!1}getRows(){return this.rows}static constructResult(e){let t=Ct(ze.buildBitArray(e)).parseInformation(),n=e[0].getFinderPattern().getResultPoints(),g=e[e.length-1].getFinderPattern().getResultPoints(),r=[n[0],n[1],g[0],g[1]];return new D(t,null,null,r,z.RSS_EXPANDED,null)}checkChecksum(){let e=this.pairs.get(0),t=e.getLeftChar(),n=e.getRightChar();if(null==n)return!1;let g=n.getChecksumPortion(),r=2;for(let i=1;i<this.pairs.size();++i){let e=this.pairs.get(i);g+=e.getLeftChar().getChecksumPortion(),r++;let t=e.getRightChar();null!=t&&(g+=t.getChecksumPortion(),r++)}return g%=211,211*(r-4)+g==t.getValue()}static getNextSecondBar(e,t){let n;return e.get(t)?(n=e.getNextUnset(t),n=e.getNextSet(n)):(n=e.getNextSet(t),n=e.getNextUnset(n)),n}retrieveNextPair(e,t,n){let g,r=t.length%2==0;this.startFromEven&&(r=!r);let i=!0,o=-1;do{this.findNextPair(e,t,o),g=this.parseFoundFinderPattern(e,n,r),null==g?o=ut.getNextSecondBar(e,this.startEnd[0]):i=!1}while(i);let s,a=this.decodeDataCharacter(e,g,r,!0);if(!this.isEmptyPair(t)&&t[t.length-1].mustBeLast())throw new X;try{s=this.decodeDataCharacter(e,g,r,!1)}catch(fp){s=null,this.verbose}return new ct(a,s,g,!0)}isEmptyPair(e){return 0===e.length}findNextPair(e,t,n){let g=this.getDecodeFinderCounters();g[0]=0,g[1]=0,g[2]=0,g[3]=0;let r,i=e.getSize();r=n>=0?n:this.isEmptyPair(t)?0:t[t.length-1].getFinderPattern().getStartEnd()[1];let o=t.length%2!=0;this.startFromEven&&(o=!o);let s=!1;for(;r<i&&(s=!e.get(r),s);)r++;let a=0,I=r;for(let l=r;l<i;l++)if(e.get(l)!=s)g[a]++;else{if(3==a){if(o&&ut.reverseCounters(g),ut.isFinderPattern(g))return this.startEnd[0]=I,void(this.startEnd[1]=l);o&&ut.reverseCounters(g),I+=g[0]+g[1],g[0]=g[2],g[1]=g[3],g[2]=0,g[3]=0,a--}else a++;g[a]=1,s=!s}throw new X}static reverseCounters(e){let t=e.length;for(let n=0;n<t/2;++n){let g=e[n];e[n]=e[t-n-1],e[t-n-1]=g}}parseFoundFinderPattern(e,t,n){let g,r,i;if(n){let t=this.startEnd[0]-1;for(;t>=0&&!e.get(t);)t--;t++,g=this.startEnd[0]-t,r=t,i=this.startEnd[1]}else r=this.startEnd[0],i=e.getNextUnset(this.startEnd[1]+1),g=i-this.startEnd[1];let o,s=this.getDecodeFinderCounters();h.arraycopy(s,0,s,1,s.length-1),s[0]=g;try{o=this.parseFinderValue(s,ut.FINDER_PATTERNS)}catch(fp){return null}return new Le(o,[r,i],r,i,t)}decodeDataCharacter(e,t,n,g){let r=this.getDataCharacterCounters();for(let B=0;B<r.length;B++)r[B]=0;if(g)ut.recordPatternInReverse(e,t.getStartEnd()[0],r);else{ut.recordPattern(e,t.getStartEnd()[1],r);for(let e=0,t=r.length-1;e<t;e++,t--){let n=r[e];r[e]=r[t],r[t]=n}}let i=17,o=ue.sum(new Int32Array(r))/i,s=(t.getStartEnd()[1]-t.getStartEnd()[0])/15;if(Math.abs(o-s)/s>.3)throw new X;let a=this.getOddCounts(),I=this.getEvenCounts(),l=this.getOddRoundingErrors(),C=this.getEvenRoundingErrors();for(let B=0;B<r.length;B++){let e=1*r[B]/o,t=e+.5;if(t<1){if(e<.3)throw new X;t=1}else if(t>8){if(e>8.7)throw new X;t=8}let n=B/2;1&B?(I[n]=t,C[n]=e-t):(a[n]=t,l[n]=e-t)}this.adjustOddEvenCounts(i);let c=4*t.getValue()+(n?0:2)+(g?0:1)-1,d=0,u=0;for(let B=a.length-1;B>=0;B--){if(ut.isNotA1left(t,n,g)){let e=ut.WEIGHTS[c][2*B];u+=a[B]*e}d+=a[B]}let A=0;for(let B=I.length-1;B>=0;B--)if(ut.isNotA1left(t,n,g)){let e=ut.WEIGHTS[c][2*B+1];A+=I[B]*e}let h=u+A;if(1&d||d>13||d<4)throw new X;let m=(13-d)/2,b=ut.SYMBOL_WIDEST[m],p=9-b,y=Ue.getRSSvalue(a,b,!0),Z=Ue.getRSSvalue(I,p,!1),f=ut.EVEN_TOTAL_SUBSET[m],G=ut.GSUM[m];return new De(y*f+Z+G,h)}static isNotA1left(e,t,n){return!(0==e.getValue()&&t&&n)}adjustOddEvenCounts(e){let t=ue.sum(new Int32Array(this.getOddCounts())),n=ue.sum(new Int32Array(this.getEvenCounts())),g=!1,r=!1;t>13?r=!0:t<4&&(g=!0);let i=!1,o=!1;n>13?o=!0:n<4&&(i=!0);let s=t+n-e,a=!(1&~t),I=!(1&n);if(1==s)if(a){if(I)throw new X;r=!0}else{if(!I)throw new X;o=!0}else if(-1==s)if(a){if(I)throw new X;g=!0}else{if(!I)throw new X;i=!0}else{if(0!=s)throw new X;if(a){if(!I)throw new X;t<n?(g=!0,o=!0):(r=!0,i=!0)}else if(I)throw new X}if(g){if(r)throw new X;ut.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(r&&ut.decrement(this.getOddCounts(),this.getOddRoundingErrors()),i){if(o)throw new X;ut.increment(this.getEvenCounts(),this.getOddRoundingErrors())}o&&ut.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ut.SYMBOL_WIDEST=[7,5,4,3,1],ut.EVEN_TOTAL_SUBSET=[4,20,52,104,204],ut.GSUM=[0,348,1388,2948,3988],ut.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],ut.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],ut.FINDER_PAT_A=0,ut.FINDER_PAT_B=1,ut.FINDER_PAT_C=2,ut.FINDER_PAT_D=3,ut.FINDER_PAT_E=4,ut.FINDER_PAT_F=5,ut.FINDER_PATTERN_SEQUENCES=[[ut.FINDER_PAT_A,ut.FINDER_PAT_A],[ut.FINDER_PAT_A,ut.FINDER_PAT_B,ut.FINDER_PAT_B],[ut.FINDER_PAT_A,ut.FINDER_PAT_C,ut.FINDER_PAT_B,ut.FINDER_PAT_D],[ut.FINDER_PAT_A,ut.FINDER_PAT_E,ut.FINDER_PAT_B,ut.FINDER_PAT_D,ut.FINDER_PAT_C],[ut.FINDER_PAT_A,ut.FINDER_PAT_E,ut.FINDER_PAT_B,ut.FINDER_PAT_D,ut.FINDER_PAT_D,ut.FINDER_PAT_F],[ut.FINDER_PAT_A,ut.FINDER_PAT_E,ut.FINDER_PAT_B,ut.FINDER_PAT_D,ut.FINDER_PAT_E,ut.FINDER_PAT_F,ut.FINDER_PAT_F],[ut.FINDER_PAT_A,ut.FINDER_PAT_A,ut.FINDER_PAT_B,ut.FINDER_PAT_B,ut.FINDER_PAT_C,ut.FINDER_PAT_C,ut.FINDER_PAT_D,ut.FINDER_PAT_D],[ut.FINDER_PAT_A,ut.FINDER_PAT_A,ut.FINDER_PAT_B,ut.FINDER_PAT_B,ut.FINDER_PAT_C,ut.FINDER_PAT_C,ut.FINDER_PAT_D,ut.FINDER_PAT_E,ut.FINDER_PAT_E],[ut.FINDER_PAT_A,ut.FINDER_PAT_A,ut.FINDER_PAT_B,ut.FINDER_PAT_B,ut.FINDER_PAT_C,ut.FINDER_PAT_C,ut.FINDER_PAT_D,ut.FINDER_PAT_E,ut.FINDER_PAT_F,ut.FINDER_PAT_F],[ut.FINDER_PAT_A,ut.FINDER_PAT_A,ut.FINDER_PAT_B,ut.FINDER_PAT_B,ut.FINDER_PAT_C,ut.FINDER_PAT_D,ut.FINDER_PAT_D,ut.FINDER_PAT_E,ut.FINDER_PAT_E,ut.FINDER_PAT_F,ut.FINDER_PAT_F]],ut.MAX_PAIRS=11;class At extends De{constructor(e,t,n){super(e,t),this.count=0,this.finderPattern=n}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class ht extends Me{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(e,t,n){const g=this.decodePair(t,!1,e,n);ht.addOrTally(this.possibleLeftPairs,g),t.reverse();let r=this.decodePair(t,!0,e,n);ht.addOrTally(this.possibleRightPairs,r),t.reverse();for(let i of this.possibleLeftPairs)if(i.getCount()>1)for(let e of this.possibleRightPairs)if(e.getCount()>1&&ht.checkChecksum(i,e))return ht.constructResult(i,e);throw new X}static addOrTally(e,t){if(null==t)return;let n=!1;for(let g of e)if(g.getValue()===t.getValue()){g.incrementCount(),n=!0;break}n||e.push(t)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(e,t){let n=4537077*e.getValue()+t.getValue(),g=new String(n).toString(),r=new W;for(let a=13-g.length;a>0;a--)r.append("0");r.append(g);let i=0;for(let a=0;a<13;a++){let e=r.charAt(a).charCodeAt(0)-"0".charCodeAt(0);i+=1&a?e:3*e}i=10-i%10,10===i&&(i=0),r.append(i.toString());let o=e.getFinderPattern().getResultPoints(),s=t.getFinderPattern().getResultPoints();return new D(r.toString(),null,0,[o[0],o[1],s[0],s[1]],z.RSS_14,(new Date).getTime())}static checkChecksum(e,t){let n=(e.getChecksumPortion()+16*t.getChecksumPortion())%79,g=9*e.getFinderPattern().getValue()+t.getFinderPattern().getValue();return g>72&&g--,g>8&&g--,n===g}decodePair(e,t,n,g){try{let r=this.findFinderPattern(e,t),i=this.parseFoundFinderPattern(e,n,t,r),o=null==g?null:g.get(B.NEED_RESULT_POINT_CALLBACK);if(null!=o){let g=(r[0]+r[1])/2;t&&(g=e.getSize()-1-g),o.foundPossibleResultPoint(new he(g,n))}let s=this.decodeDataCharacter(e,i,!0),a=this.decodeDataCharacter(e,i,!1);return new At(1597*s.getValue()+a.getValue(),s.getChecksumPortion()+4*a.getChecksumPortion(),i)}catch(r){return null}}decodeDataCharacter(e,t,n){let g=this.getDataCharacterCounters();for(let A=0;A<g.length;A++)g[A]=0;if(n)Ve.recordPatternInReverse(e,t.getStartEnd()[0],g);else{Ve.recordPattern(e,t.getStartEnd()[1]+1,g);for(let e=0,t=g.length-1;e<t;e++,t--){let n=g[e];g[e]=g[t],g[t]=n}}let r=n?16:15,i=ue.sum(new Int32Array(g))/r,o=this.getOddCounts(),s=this.getEvenCounts(),a=this.getOddRoundingErrors(),I=this.getEvenRoundingErrors();for(let A=0;A<g.length;A++){let e=g[A]/i,t=Math.floor(e+.5);t<1?t=1:t>8&&(t=8);let n=Math.floor(A/2);1&A?(s[n]=t,I[n]=e-t):(o[n]=t,a[n]=e-t)}this.adjustOddEvenCounts(n,r);let l=0,C=0;for(let A=o.length-1;A>=0;A--)C*=9,C+=o[A],l+=o[A];let c=0,d=0;for(let A=s.length-1;A>=0;A--)c*=9,c+=s[A],d+=s[A];let u=C+3*c;if(n){if(1&l||l>12||l<4)throw new X;let e=(12-l)/2,t=ht.OUTSIDE_ODD_WIDEST[e],n=9-t,g=Ue.getRSSvalue(o,t,!1),r=Ue.getRSSvalue(s,n,!0),i=ht.OUTSIDE_EVEN_TOTAL_SUBSET[e],a=ht.OUTSIDE_GSUM[e];return new De(g*i+r+a,u)}{if(1&d||d>10||d<4)throw new X;let e=(10-d)/2,t=ht.INSIDE_ODD_WIDEST[e],n=9-t,g=Ue.getRSSvalue(o,t,!0),r=Ue.getRSSvalue(s,n,!1),i=ht.INSIDE_ODD_TOTAL_SUBSET[e],a=ht.INSIDE_GSUM[e];return new De(r*i+g+a,u)}}findFinderPattern(e,t){let n=this.getDecodeFinderCounters();n[0]=0,n[1]=0,n[2]=0,n[3]=0;let g=e.getSize(),r=!1,i=0;for(;i<g&&(r=!e.get(i),t!==r);)i++;let o=0,s=i;for(let a=i;a<g;a++)if(e.get(a)!==r)n[o]++;else{if(3===o){if(Me.isFinderPattern(n))return[s,a];s+=n[0]+n[1],n[0]=n[2],n[1]=n[3],n[2]=0,n[3]=0,o--}else o++;n[o]=1,r=!r}throw new X}parseFoundFinderPattern(e,t,n,g){let r=e.get(g[0]),i=g[0]-1;for(;i>=0&&r!==e.get(i);)i--;i++;const o=g[0]-i,s=this.getDecodeFinderCounters(),a=new Int32Array(s.length);h.arraycopy(s,0,a,1,s.length-1),a[0]=o;const I=this.parseFinderValue(a,ht.FINDER_PATTERNS);let l=i,C=g[1];return n&&(l=e.getSize()-1-l,C=e.getSize()-1-C),new Le(I,[i,g[1]],l,C,t)}adjustOddEvenCounts(e,t){let n=ue.sum(new Int32Array(this.getOddCounts())),g=ue.sum(new Int32Array(this.getEvenCounts())),r=!1,i=!1,o=!1,s=!1;e?(n>12?i=!0:n<4&&(r=!0),g>12?s=!0:g<4&&(o=!0)):(n>11?i=!0:n<5&&(r=!0),g>10?s=!0:g<4&&(o=!0));let a=n+g-t,I=(1&n)==(e?1:0),l=!(1&~g);if(1===a)if(I){if(l)throw new X;i=!0}else{if(!l)throw new X;s=!0}else if(-1===a)if(I){if(l)throw new X;r=!0}else{if(!l)throw new X;o=!0}else{if(0!==a)throw new X;if(I){if(!l)throw new X;n<g?(r=!0,s=!0):(i=!0,o=!0)}else if(l)throw new X}if(r){if(i)throw new X;Me.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&Me.decrement(this.getOddCounts(),this.getOddRoundingErrors()),o){if(s)throw new X;Me.increment(this.getEvenCounts(),this.getOddRoundingErrors())}s&&Me.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ht.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],ht.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],ht.OUTSIDE_GSUM=[0,161,961,2015,2715],ht.INSIDE_GSUM=[0,336,1036,1516],ht.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],ht.INSIDE_ODD_WIDEST=[2,4,6,8],ht.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class mt extends Ve{constructor(e,t){super(),this.readers=[],this.verbose=!0===t;const n=e?e.get(B.POSSIBLE_FORMATS):null,g=e&&void 0!==e.get(B.ASSUME_CODE_39_CHECK_DIGIT);n?((n.includes(z.EAN_13)||n.includes(z.UPC_A)||n.includes(z.EAN_8)||n.includes(z.UPC_E))&&this.readers.push(new Ke(e)),n.includes(z.CODE_39)&&this.readers.push(new We(g)),n.includes(z.CODE_128)&&this.readers.push(new we),n.includes(z.ITF)&&this.readers.push(new ke),n.includes(z.RSS_14)&&this.readers.push(new ht),n.includes(z.RSS_EXPANDED)&&this.readers.push(new ut(this.verbose))):(this.readers.push(new Ke(e)),this.readers.push(new We),this.readers.push(new Ke(e)),this.readers.push(new we),this.readers.push(new ke),this.readers.push(new ht),this.readers.push(new ut(this.verbose)))}decodeRow(e,t,n){for(let g=0;g<this.readers.length;g++)try{return this.readers[g].decodeRow(e,t,n)}catch(eee){}throw new X}reset(){this.readers.forEach((e=>e.reset()))}}class bt extends M{constructor(e=500,t){super(new mt(t),e,t)}}class pt{constructor(e,t,n){this.ecCodewords=e,this.ecBlocks=[t],n&&this.ecBlocks.push(n)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class yt{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Zt{constructor(e,t,n,g,r,i){this.versionNumber=e,this.symbolSizeRows=t,this.symbolSizeColumns=n,this.dataRegionSizeRows=g,this.dataRegionSizeColumns=r,this.ecBlocks=i;let o=0;const s=i.getECCodewords(),a=i.getECBlocks();for(let I of a)o+=I.getCount()*(I.getDataCodewords()+s);this.totalCodewords=o}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(e,t){if(1&e||1&t)throw new S;for(let n of Zt.VERSIONS)if(n.symbolSizeRows===e&&n.symbolSizeColumns===t)return n;throw new S}toString(){return""+this.versionNumber}static buildVersions(){return[new Zt(1,10,10,8,8,new pt(5,new yt(1,3))),new Zt(2,12,12,10,10,new pt(7,new yt(1,5))),new Zt(3,14,14,12,12,new pt(10,new yt(1,8))),new Zt(4,16,16,14,14,new pt(12,new yt(1,12))),new Zt(5,18,18,16,16,new pt(14,new yt(1,18))),new Zt(6,20,20,18,18,new pt(18,new yt(1,22))),new Zt(7,22,22,20,20,new pt(20,new yt(1,30))),new Zt(8,24,24,22,22,new pt(24,new yt(1,36))),new Zt(9,26,26,24,24,new pt(28,new yt(1,44))),new Zt(10,32,32,14,14,new pt(36,new yt(1,62))),new Zt(11,36,36,16,16,new pt(42,new yt(1,86))),new Zt(12,40,40,18,18,new pt(48,new yt(1,114))),new Zt(13,44,44,20,20,new pt(56,new yt(1,144))),new Zt(14,48,48,22,22,new pt(68,new yt(1,174))),new Zt(15,52,52,24,24,new pt(42,new yt(2,102))),new Zt(16,64,64,14,14,new pt(56,new yt(2,140))),new Zt(17,72,72,16,16,new pt(36,new yt(4,92))),new Zt(18,80,80,18,18,new pt(48,new yt(4,114))),new Zt(19,88,88,20,20,new pt(56,new yt(4,144))),new Zt(20,96,96,22,22,new pt(68,new yt(4,174))),new Zt(21,104,104,24,24,new pt(56,new yt(6,136))),new Zt(22,120,120,18,18,new pt(68,new yt(6,175))),new Zt(23,132,132,20,20,new pt(62,new yt(8,163))),new Zt(24,144,144,22,22,new pt(62,new yt(8,156),new yt(2,155))),new Zt(25,8,18,6,16,new pt(7,new yt(1,5))),new Zt(26,8,32,6,14,new pt(11,new yt(1,10))),new Zt(27,12,26,10,24,new pt(14,new yt(1,16))),new Zt(28,12,36,10,16,new pt(18,new yt(1,22))),new Zt(29,16,36,14,16,new pt(24,new yt(1,32))),new Zt(30,16,48,14,22,new pt(28,new yt(1,49)))]}}Zt.VERSIONS=Zt.buildVersions();class ft{constructor(e){const t=e.getHeight();if(t<8||t>144||1&t)throw new S;this.version=ft.readVersion(e),this.mappingBitMatrix=this.extractDataRegion(e),this.readMappingMatrix=new k(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(e){const t=e.getHeight(),n=e.getWidth();return Zt.getVersionForDimensions(t,n)}readCodewords(){const e=new Int8Array(this.version.getTotalCodewords());let t=0,n=4,g=0;const r=this.mappingBitMatrix.getHeight(),i=this.mappingBitMatrix.getWidth();let o=!1,s=!1,a=!1,I=!1;do{if(n!==r||0!==g||o)if(n===r-2&&0===g&&3&i&&!s)e[t++]=255&this.readCorner2(r,i),n-=2,g+=2,s=!0;else if(n!==r+4||2!==g||7&i||a)if(n!==r-2||0!==g||4!=(7&i)||I){do{n<r&&g>=0&&!this.readMappingMatrix.get(g,n)&&(e[t++]=255&this.readUtah(n,g,r,i)),n-=2,g+=2}while(n>=0&&g<i);n+=1,g+=3;do{n>=0&&g<i&&!this.readMappingMatrix.get(g,n)&&(e[t++]=255&this.readUtah(n,g,r,i)),n+=2,g-=2}while(n<r&&g>=0);n+=3,g+=1}else e[t++]=255&this.readCorner4(r,i),n-=2,g+=2,I=!0;else e[t++]=255&this.readCorner3(r,i),n-=2,g+=2,a=!0;else e[t++]=255&this.readCorner1(r,i),n-=2,g+=2,o=!0}while(n<r||g<i);if(t!==this.version.getTotalCodewords())throw new S;return e}readModule(e,t,n,g){return e<0&&(e+=n,t+=4-(n+4&7)),t<0&&(t+=g,e+=4-(g+4&7)),this.readMappingMatrix.set(t,e),this.mappingBitMatrix.get(t,e)}readUtah(e,t,n,g){let r=0;return this.readModule(e-2,t-2,n,g)&&(r|=1),r<<=1,this.readModule(e-2,t-1,n,g)&&(r|=1),r<<=1,this.readModule(e-1,t-2,n,g)&&(r|=1),r<<=1,this.readModule(e-1,t-1,n,g)&&(r|=1),r<<=1,this.readModule(e-1,t,n,g)&&(r|=1),r<<=1,this.readModule(e,t-2,n,g)&&(r|=1),r<<=1,this.readModule(e,t-1,n,g)&&(r|=1),r<<=1,this.readModule(e,t,n,g)&&(r|=1),r}readCorner1(e,t){let n=0;return this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,1,e,t)&&(n|=1),n<<=1,this.readModule(e-1,2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n<<=1,this.readModule(2,t-1,e,t)&&(n|=1),n<<=1,this.readModule(3,t-1,e,t)&&(n|=1),n}readCorner2(e,t){let n=0;return this.readModule(e-3,0,e,t)&&(n|=1),n<<=1,this.readModule(e-2,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(0,t-4,e,t)&&(n|=1),n<<=1,this.readModule(0,t-3,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n}readCorner3(e,t){let n=0;return this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,t-1,e,t)&&(n|=1),n<<=1,this.readModule(0,t-3,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-3,e,t)&&(n|=1),n<<=1,this.readModule(1,t-2,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n}readCorner4(e,t){let n=0;return this.readModule(e-3,0,e,t)&&(n|=1),n<<=1,this.readModule(e-2,0,e,t)&&(n|=1),n<<=1,this.readModule(e-1,0,e,t)&&(n|=1),n<<=1,this.readModule(0,t-2,e,t)&&(n|=1),n<<=1,this.readModule(0,t-1,e,t)&&(n|=1),n<<=1,this.readModule(1,t-1,e,t)&&(n|=1),n<<=1,this.readModule(2,t-1,e,t)&&(n|=1),n<<=1,this.readModule(3,t-1,e,t)&&(n|=1),n}extractDataRegion(e){const t=this.version.getSymbolSizeRows(),n=this.version.getSymbolSizeColumns();if(e.getHeight()!==t)throw new c("Dimension of bitMatrix must match the version size");const g=this.version.getDataRegionSizeRows(),r=this.version.getDataRegionSizeColumns(),i=t/g|0,o=n/r|0,s=new k(o*r,i*g);for(let a=0;a<i;++a){const t=a*g;for(let n=0;n<o;++n){const i=n*r;for(let o=0;o<g;++o){const I=a*(g+2)+1+o,l=t+o;for(let t=0;t<r;++t){const g=n*(r+2)+1+t;if(e.get(g,I)){const e=i+t;s.set(e,l)}}}}}return s}}class Gt{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t){const n=t.getECBlocks();let g=0;const r=n.getECBlocks();for(let c of r)g+=c.getCount();const i=new Array(g);let o=0;for(let c of r)for(let e=0;e<c.getCount();e++){const e=c.getDataCodewords(),t=n.getECCodewords()+e;i[o++]=new Gt(e,new Uint8Array(t))}const s=i[0].codewords.length-n.getECCodewords(),a=s-1;let I=0;for(let c=0;c<a;c++)for(let t=0;t<o;t++)i[t].codewords[c]=e[I++];const l=24===t.getVersionNumber(),C=l?8:o;for(let c=0;c<C;c++)i[c].codewords[s-1]=e[I++];const d=i[0].codewords.length;for(let c=s;c<d;c++)for(let t=0;t<o;t++){const n=l?(t+8)%o:t,g=l&&n>7?c-1:c;i[n].codewords[g]=e[I++]}if(I!==e.length)throw new c;return i}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class Bt{constructor(e){this.bytes=e,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(e){if(e<1||e>32||e>this.available())throw new c(""+e);let t=0,n=this.bitOffset,g=this.byteOffset;const r=this.bytes;if(n>0){const i=8-n,o=e<i?e:i,s=i-o,a=255>>8-o<<s;t=(r[g]&a)>>s,e-=o,n+=o,8===n&&(n=0,g++)}if(e>0){for(;e>=8;)t=t<<8|255&r[g],g++,e-=8;if(e>0){const i=8-e,o=255>>i<<i;t=t<<e|(r[g]&o)>>i,n+=e}}return this.bitOffset=n,this.byteOffset=g,t}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}(ee=O||(O={}))[ee.PAD_ENCODE=0]="PAD_ENCODE",ee[ee.ASCII_ENCODE=1]="ASCII_ENCODE",ee[ee.C40_ENCODE=2]="C40_ENCODE",ee[ee.TEXT_ENCODE=3]="TEXT_ENCODE",ee[ee.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",ee[ee.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",ee[ee.BASE256_ENCODE=6]="BASE256_ENCODE";class St{static decode(e){const t=new Bt(e),n=new W,g=new W,r=new Array;let i=O.ASCII_ENCODE;do{if(i===O.ASCII_ENCODE)i=this.decodeAsciiSegment(t,n,g);else{switch(i){case O.C40_ENCODE:this.decodeC40Segment(t,n);break;case O.TEXT_ENCODE:this.decodeTextSegment(t,n);break;case O.ANSIX12_ENCODE:this.decodeAnsiX12Segment(t,n);break;case O.EDIFACT_ENCODE:this.decodeEdifactSegment(t,n);break;case O.BASE256_ENCODE:this.decodeBase256Segment(t,n,r);break;default:throw new S}i=O.ASCII_ENCODE}}while(i!==O.PAD_ENCODE&&t.available()>0);return g.length()>0&&n.append(g.toString()),new ie(e,n.toString(),0===r.length?null:r,null)}static decodeAsciiSegment(e,t,n){let g=!1;do{let r=e.readBits(8);if(0===r)throw new S;if(r<=128)return g&&(r+=128),t.append(String.fromCharCode(r-1)),O.ASCII_ENCODE;if(129===r)return O.PAD_ENCODE;if(r<=229){const e=r-130;e<10&&t.append("0"),t.append(""+e)}else switch(r){case 230:return O.C40_ENCODE;case 231:return O.BASE256_ENCODE;case 232:t.append(String.fromCharCode(29));break;case 233:case 234:case 241:break;case 235:g=!0;break;case 236:t.append("[)>05"),n.insert(0,"");break;case 237:t.append("[)>06"),n.insert(0,"");break;case 238:return O.ANSIX12_ENCODE;case 239:return O.TEXT_ENCODE;case 240:return O.EDIFACT_ENCODE;default:if(254!==r||0!==e.available())throw new S}}while(e.available()>0);return O.ASCII_ENCODE}static decodeC40Segment(e,t){let n=!1;const g=[];let r=0;do{if(8===e.available())return;const i=e.readBits(8);if(254===i)return;this.parseTwoBytes(i,e.readBits(8),g);for(let e=0;e<3;e++){const i=g[e];switch(r){case 0:if(i<3)r=i+1;else{if(!(i<this.C40_BASIC_SET_CHARS.length))throw new S;{const e=this.C40_BASIC_SET_CHARS[i];n?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),n=!1):t.append(e)}}break;case 1:n?(t.append(String.fromCharCode(i+128)),n=!1):t.append(String.fromCharCode(i)),r=0;break;case 2:if(i<this.C40_SHIFT2_SET_CHARS.length){const e=this.C40_SHIFT2_SET_CHARS[i];n?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),n=!1):t.append(e)}else switch(i){case 27:t.append(String.fromCharCode(29));break;case 30:n=!0;break;default:throw new S}r=0;break;case 3:n?(t.append(String.fromCharCode(i+224)),n=!1):t.append(String.fromCharCode(i+96)),r=0;break;default:throw new S}}}while(e.available()>0)}static decodeTextSegment(e,t){let n=!1,g=[],r=0;do{if(8===e.available())return;const i=e.readBits(8);if(254===i)return;this.parseTwoBytes(i,e.readBits(8),g);for(let e=0;e<3;e++){const i=g[e];switch(r){case 0:if(i<3)r=i+1;else{if(!(i<this.TEXT_BASIC_SET_CHARS.length))throw new S;{const e=this.TEXT_BASIC_SET_CHARS[i];n?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),n=!1):t.append(e)}}break;case 1:n?(t.append(String.fromCharCode(i+128)),n=!1):t.append(String.fromCharCode(i)),r=0;break;case 2:if(i<this.TEXT_SHIFT2_SET_CHARS.length){const e=this.TEXT_SHIFT2_SET_CHARS[i];n?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),n=!1):t.append(e)}else switch(i){case 27:t.append(String.fromCharCode(29));break;case 30:n=!0;break;default:throw new S}r=0;break;case 3:if(!(i<this.TEXT_SHIFT3_SET_CHARS.length))throw new S;{const e=this.TEXT_SHIFT3_SET_CHARS[i];n?(t.append(String.fromCharCode(e.charCodeAt(0)+128)),n=!1):t.append(e),r=0}break;default:throw new S}}}while(e.available()>0)}static decodeAnsiX12Segment(e,t){const n=[];do{if(8===e.available())return;const g=e.readBits(8);if(254===g)return;this.parseTwoBytes(g,e.readBits(8),n);for(let e=0;e<3;e++){const g=n[e];switch(g){case 0:t.append("\r");break;case 1:t.append("*");break;case 2:t.append(">");break;case 3:t.append(" ");break;default:if(g<14)t.append(String.fromCharCode(g+44));else{if(!(g<40))throw new S;t.append(String.fromCharCode(g+51))}}}}while(e.available()>0)}static parseTwoBytes(e,t,n){let g=(e<<8)+t-1,r=Math.floor(g/1600);n[0]=r,g-=1600*r,r=Math.floor(g/40),n[1]=r,n[2]=g-40*r}static decodeEdifactSegment(e,t){do{if(e.available()<=16)return;for(let n=0;n<4;n++){let n=e.readBits(6);if(31===n){const t=8-e.getBitOffset();return void(8!==t&&e.readBits(t))}32&n||(n|=64),t.append(String.fromCharCode(n))}}while(e.available()>0)}static decodeBase256Segment(e,t,n){let g=1+e.getByteOffset();const r=this.unrandomize255State(e.readBits(8),g++);let i;if(i=0===r?e.available()/8|0:r<250?r:250*(r-249)+this.unrandomize255State(e.readBits(8),g++),i<0)throw new S;const o=new Uint8Array(i);for(let a=0;a<i;a++){if(e.available()<8)throw new S;o[a]=this.unrandomize255State(e.readBits(8),g++)}n.push(o);try{t.append(V.decode(o,w.ISO88591))}catch(s){throw new Ce("Platform does not support required encoding: "+s.message)}}static unrandomize255State(e,t){const n=e-(149*t%255+1);return n>=0?n:n+256}}St.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],St.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],St.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],St.TEXT_SHIFT2_SET_CHARS=St.C40_SHIFT2_SET_CHARS,St.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)];class Rt{constructor(){this.rsDecoder=new ce(Ie.DATA_MATRIX_FIELD_256)}decode(e){const t=new ft(e),n=t.getVersion(),g=t.readCodewords(),r=Gt.getDataBlocks(g,n);let i=0;for(let a of r)i+=a.getNumDataCodewords();const o=new Uint8Array(i),s=r.length;for(let a=0;a<s;a++){const e=r[a],t=e.getCodewords(),n=e.getNumDataCodewords();this.correctErrors(t,n);for(let g=0;g<n;g++)o[g*s+a]=t[g]}return St.decode(o)}correctErrors(e,t){const n=new Int32Array(e);try{this.rsDecoder.decode(n,e.length-t)}catch(g){throw new u}for(let r=0;r<t;r++)e[r]=n[r]}}class vt{constructor(e){this.image=e,this.rectangleDetector=new pe(this.image)}detect(){const e=this.rectangleDetector.detect();let t=this.detectSolid1(e);if(t=this.detectSolid2(t),t[3]=this.correctTopRight(t),!t[3])throw new X;t=this.shiftToModuleCenter(t);const n=t[0],g=t[1],r=t[2],i=t[3];let o=this.transitionsBetween(n,i)+1,s=this.transitionsBetween(r,i)+1;1&~o||(o+=1),1&~s||(s+=1),4*o<7*s&&4*s<7*o&&(o=s=Math.max(o,s));let a=vt.sampleGrid(this.image,n,g,r,i,o,s);return new me(a,[n,g,r,i])}static shiftPoint(e,t,n){let g=(t.getX()-e.getX())/(n+1),r=(t.getY()-e.getY())/(n+1);return new he(e.getX()+g,e.getY()+r)}static moveAway(e,t,n){let g=e.getX(),r=e.getY();return g<t?g-=1:g+=1,r<n?r-=1:r+=1,new he(g,r)}detectSolid1(e){let t=e[0],n=e[1],g=e[3],r=e[2],i=this.transitionsBetween(t,n),o=this.transitionsBetween(n,g),s=this.transitionsBetween(g,r),a=this.transitionsBetween(r,t),I=i,l=[r,t,n,g];return I>o&&(I=o,l[0]=t,l[1]=n,l[2]=g,l[3]=r),I>s&&(I=s,l[0]=n,l[1]=g,l[2]=r,l[3]=t),I>a&&(l[0]=g,l[1]=r,l[2]=t,l[3]=n),l}detectSolid2(e){let t=e[0],n=e[1],g=e[2],r=e[3],i=this.transitionsBetween(t,r),o=vt.shiftPoint(n,g,4*(i+1)),s=vt.shiftPoint(g,n,4*(i+1));return this.transitionsBetween(o,t)<this.transitionsBetween(s,r)?(e[0]=t,e[1]=n,e[2]=g,e[3]=r):(e[0]=n,e[1]=g,e[2]=r,e[3]=t),e}correctTopRight(e){let t=e[0],n=e[1],g=e[2],r=e[3],i=this.transitionsBetween(t,r),o=this.transitionsBetween(n,r),s=vt.shiftPoint(t,n,4*(o+1)),a=vt.shiftPoint(g,n,4*(i+1));i=this.transitionsBetween(s,r),o=this.transitionsBetween(a,r);let I=new he(r.getX()+(g.getX()-n.getX())/(i+1),r.getY()+(g.getY()-n.getY())/(i+1)),l=new he(r.getX()+(t.getX()-n.getX())/(o+1),r.getY()+(t.getY()-n.getY())/(o+1));return this.isValid(I)?this.isValid(l)?this.transitionsBetween(s,I)+this.transitionsBetween(a,I)>this.transitionsBetween(s,l)+this.transitionsBetween(a,l)?I:l:I:this.isValid(l)?l:null}shiftToModuleCenter(e){let t=e[0],n=e[1],g=e[2],r=e[3],i=this.transitionsBetween(t,r)+1,o=this.transitionsBetween(g,r)+1,s=vt.shiftPoint(t,n,4*o),a=vt.shiftPoint(g,n,4*i);i=this.transitionsBetween(s,r)+1,o=this.transitionsBetween(a,r)+1,1&~i||(i+=1),1&~o||(o+=1);let I,l,C=(t.getX()+n.getX()+g.getX()+r.getX())/4,c=(t.getY()+n.getY()+g.getY()+r.getY())/4;return t=vt.moveAway(t,C,c),n=vt.moveAway(n,C,c),g=vt.moveAway(g,C,c),r=vt.moveAway(r,C,c),s=vt.shiftPoint(t,n,4*o),s=vt.shiftPoint(s,r,4*i),I=vt.shiftPoint(n,t,4*o),I=vt.shiftPoint(I,g,4*i),a=vt.shiftPoint(g,r,4*o),a=vt.shiftPoint(a,n,4*i),l=vt.shiftPoint(r,g,4*o),l=vt.shiftPoint(l,t,4*i),[s,I,a,l]}isValid(e){return e.getX()>=0&&e.getX()<this.image.getWidth()&&e.getY()>0&&e.getY()<this.image.getHeight()}static sampleGrid(e,t,n,g,r,i,o){return Ge.getInstance().sampleGrid(e,i,o,.5,.5,i-.5,.5,i-.5,o-.5,.5,o-.5,t.getX(),t.getY(),r.getX(),r.getY(),g.getX(),g.getY(),n.getX(),n.getY())}transitionsBetween(e,t){let n=Math.trunc(e.getX()),g=Math.trunc(e.getY()),r=Math.trunc(t.getX()),i=Math.trunc(t.getY()),o=Math.abs(i-g)>Math.abs(r-n);if(o){let e=n;n=g,g=e,e=r,r=i,i=e}let s=Math.abs(r-n),a=Math.abs(i-g),I=-s/2,l=g<i?1:-1,C=n<r?1:-1,c=0,d=this.image.get(o?g:n,o?n:g);for(let u=n,A=g;u!==r;u+=C){let e=this.image.get(o?A:u,o?u:A);if(e!==d&&(c++,d=e),I+=a,I>0){if(A===i)break;A+=l,I-=s}}return c}}class Vt{constructor(){this.decoder=new Rt}decode(e,t=null){let n,g;if(null!=t&&t.has(B.PURE_BARCODE)){const t=Vt.extractPureBits(e.getBlackMatrix());n=this.decoder.decode(t),g=Vt.NO_POINTS}else{const t=new vt(e.getBlackMatrix()).detect();n=this.decoder.decode(t.getBits()),g=t.getPoints()}const r=n.getRawBytes(),i=new D(n.getText(),r,8*r.length,g,z.DATA_MATRIX,h.currentTimeMillis()),o=n.getByteSegments();null!=o&&i.putMetadata(re.BYTE_SEGMENTS,o);const s=n.getECLevel();return null!=s&&i.putMetadata(re.ERROR_CORRECTION_LEVEL,s),i}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),n=e.getBottomRightOnBit();if(null==t||null==n)throw new X;const g=this.moduleSize(t,e);let r=t[1];const i=n[1];let o=t[0];const s=(n[0]-o+1)/g,a=(i-r+1)/g;if(s<=0||a<=0)throw new X;const I=g/2;r+=I,o+=I;const l=new k(s,a);for(let C=0;C<a;C++){const t=r+C*g;for(let n=0;n<s;n++)e.get(o+n*g,t)&&l.set(n,C)}return l}static moduleSize(e,t){const n=t.getWidth();let g=e[0];const r=e[1];for(;g<n&&t.get(g,r);)g++;if(g===n)throw new X;const i=g-e[0];if(0===i)throw new X;return i}}Vt.NO_POINTS=[];class wt extends M{constructor(e=500){super(new Vt,e)}}(te=j||(j={}))[te.L=0]="L",te[te.M=1]="M",te[te.Q=2]="Q",te[te.H=3]="H";class Wt{constructor(e,t,n){this.value=e,this.stringValue=t,this.bits=n,Wt.FOR_BITS.set(n,this),Wt.FOR_VALUE.set(e,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(e){switch(e){case"L":return Wt.L;case"M":return Wt.M;case"Q":return Wt.Q;case"H":return Wt.H;default:throw new C(e+"not available")}}toString(){return this.stringValue}equals(e){if(!(e instanceof Wt))return!1;const t=e;return this.value===t.value}static forBits(e){if(e<0||e>=Wt.FOR_BITS.size)throw new c;return Wt.FOR_BITS.get(e)}}Wt.FOR_BITS=new Map,Wt.FOR_VALUE=new Map,Wt.L=new Wt(j.L,"L",1),Wt.M=new Wt(j.M,"M",0),Wt.Q=new Wt(j.Q,"Q",3),Wt.H=new Wt(j.H,"H",2);class kt{constructor(e){this.errorCorrectionLevel=Wt.forBits(e>>3&3),this.dataMask=7&e}static numBitsDiffering(e,t){return y.bitCount(e^t)}static decodeFormatInformation(e,t){const n=kt.doDecodeFormatInformation(e,t);return null!==n?n:kt.doDecodeFormatInformation(e^kt.FORMAT_INFO_MASK_QR,t^kt.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(e,t){let n=Number.MAX_SAFE_INTEGER,g=0;for(const r of kt.FORMAT_INFO_DECODE_LOOKUP){const i=r[0];if(i===e||i===t)return new kt(r[1]);let o=kt.numBitsDiffering(e,i);o<n&&(g=r[1],n=o),e!==t&&(o=kt.numBitsDiffering(t,i),o<n&&(g=r[1],n=o))}return n<=3?new kt(g):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(e){if(!(e instanceof kt))return!1;const t=e;return this.errorCorrectionLevel===t.errorCorrectionLevel&&this.dataMask===t.dataMask}}kt.FORMAT_INFO_MASK_QR=21522,kt.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Xt{constructor(e,...t){this.ecCodewordsPerBlock=e,this.ecBlocks=t}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let e=0;const t=this.ecBlocks;for(const n of t)e+=n.getCount();return e}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class Nt{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Jt{constructor(e,t,...n){this.versionNumber=e,this.alignmentPatternCenters=t,this.ecBlocks=n;let g=0;const r=n[0].getECCodewordsPerBlock(),i=n[0].getECBlocks();for(const o of i)g+=o.getCount()*(o.getDataCodewords()+r);this.totalCodewords=g}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(e){return this.ecBlocks[e.getValue()]}static getProvisionalVersionForDimension(e){if(e%4!=1)throw new S;try{return this.getVersionForNumber((e-17)/4)}catch(t){throw new S}}static getVersionForNumber(e){if(e<1||e>40)throw new c;return Jt.VERSIONS[e-1]}static decodeVersionInformation(e){let t=Number.MAX_SAFE_INTEGER,n=0;for(let g=0;g<Jt.VERSION_DECODE_INFO.length;g++){const r=Jt.VERSION_DECODE_INFO[g];if(r===e)return Jt.getVersionForNumber(g+7);const i=kt.numBitsDiffering(e,r);i<t&&(n=g+7,t=i)}return t<=3?Jt.getVersionForNumber(n):null}buildFunctionPattern(){const e=this.getDimensionForVersion(),t=new k(e);t.setRegion(0,0,9,9),t.setRegion(e-8,0,8,9),t.setRegion(0,e-8,9,8);const n=this.alignmentPatternCenters.length;for(let g=0;g<n;g++){const e=this.alignmentPatternCenters[g]-2;for(let r=0;r<n;r++)0===g&&(0===r||r===n-1)||g===n-1&&0===r||t.setRegion(this.alignmentPatternCenters[r]-2,e,5,5)}return t.setRegion(6,9,1,e-17),t.setRegion(9,6,e-17,1),this.versionNumber>6&&(t.setRegion(e-11,0,3,6),t.setRegion(0,e-11,6,3)),t}toString(){return""+this.versionNumber}}Jt.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),Jt.VERSIONS=[new Jt(1,new Int32Array(0),new Xt(7,new Nt(1,19)),new Xt(10,new Nt(1,16)),new Xt(13,new Nt(1,13)),new Xt(17,new Nt(1,9))),new Jt(2,Int32Array.from([6,18]),new Xt(10,new Nt(1,34)),new Xt(16,new Nt(1,28)),new Xt(22,new Nt(1,22)),new Xt(28,new Nt(1,16))),new Jt(3,Int32Array.from([6,22]),new Xt(15,new Nt(1,55)),new Xt(26,new Nt(1,44)),new Xt(18,new Nt(2,17)),new Xt(22,new Nt(2,13))),new Jt(4,Int32Array.from([6,26]),new Xt(20,new Nt(1,80)),new Xt(18,new Nt(2,32)),new Xt(26,new Nt(2,24)),new Xt(16,new Nt(4,9))),new Jt(5,Int32Array.from([6,30]),new Xt(26,new Nt(1,108)),new Xt(24,new Nt(2,43)),new Xt(18,new Nt(2,15),new Nt(2,16)),new Xt(22,new Nt(2,11),new Nt(2,12))),new Jt(6,Int32Array.from([6,34]),new Xt(18,new Nt(2,68)),new Xt(16,new Nt(4,27)),new Xt(24,new Nt(4,19)),new Xt(28,new Nt(4,15))),new Jt(7,Int32Array.from([6,22,38]),new Xt(20,new Nt(2,78)),new Xt(18,new Nt(4,31)),new Xt(18,new Nt(2,14),new Nt(4,15)),new Xt(26,new Nt(4,13),new Nt(1,14))),new Jt(8,Int32Array.from([6,24,42]),new Xt(24,new Nt(2,97)),new Xt(22,new Nt(2,38),new Nt(2,39)),new Xt(22,new Nt(4,18),new Nt(2,19)),new Xt(26,new Nt(4,14),new Nt(2,15))),new Jt(9,Int32Array.from([6,26,46]),new Xt(30,new Nt(2,116)),new Xt(22,new Nt(3,36),new Nt(2,37)),new Xt(20,new Nt(4,16),new Nt(4,17)),new Xt(24,new Nt(4,12),new Nt(4,13))),new Jt(10,Int32Array.from([6,28,50]),new Xt(18,new Nt(2,68),new Nt(2,69)),new Xt(26,new Nt(4,43),new Nt(1,44)),new Xt(24,new Nt(6,19),new Nt(2,20)),new Xt(28,new Nt(6,15),new Nt(2,16))),new Jt(11,Int32Array.from([6,30,54]),new Xt(20,new Nt(4,81)),new Xt(30,new Nt(1,50),new Nt(4,51)),new Xt(28,new Nt(4,22),new Nt(4,23)),new Xt(24,new Nt(3,12),new Nt(8,13))),new Jt(12,Int32Array.from([6,32,58]),new Xt(24,new Nt(2,92),new Nt(2,93)),new Xt(22,new Nt(6,36),new Nt(2,37)),new Xt(26,new Nt(4,20),new Nt(6,21)),new Xt(28,new Nt(7,14),new Nt(4,15))),new Jt(13,Int32Array.from([6,34,62]),new Xt(26,new Nt(4,107)),new Xt(22,new Nt(8,37),new Nt(1,38)),new Xt(24,new Nt(8,20),new Nt(4,21)),new Xt(22,new Nt(12,11),new Nt(4,12))),new Jt(14,Int32Array.from([6,26,46,66]),new Xt(30,new Nt(3,115),new Nt(1,116)),new Xt(24,new Nt(4,40),new Nt(5,41)),new Xt(20,new Nt(11,16),new Nt(5,17)),new Xt(24,new Nt(11,12),new Nt(5,13))),new Jt(15,Int32Array.from([6,26,48,70]),new Xt(22,new Nt(5,87),new Nt(1,88)),new Xt(24,new Nt(5,41),new Nt(5,42)),new Xt(30,new Nt(5,24),new Nt(7,25)),new Xt(24,new Nt(11,12),new Nt(7,13))),new Jt(16,Int32Array.from([6,26,50,74]),new Xt(24,new Nt(5,98),new Nt(1,99)),new Xt(28,new Nt(7,45),new Nt(3,46)),new Xt(24,new Nt(15,19),new Nt(2,20)),new Xt(30,new Nt(3,15),new Nt(13,16))),new Jt(17,Int32Array.from([6,30,54,78]),new Xt(28,new Nt(1,107),new Nt(5,108)),new Xt(28,new Nt(10,46),new Nt(1,47)),new Xt(28,new Nt(1,22),new Nt(15,23)),new Xt(28,new Nt(2,14),new Nt(17,15))),new Jt(18,Int32Array.from([6,30,56,82]),new Xt(30,new Nt(5,120),new Nt(1,121)),new Xt(26,new Nt(9,43),new Nt(4,44)),new Xt(28,new Nt(17,22),new Nt(1,23)),new Xt(28,new Nt(2,14),new Nt(19,15))),new Jt(19,Int32Array.from([6,30,58,86]),new Xt(28,new Nt(3,113),new Nt(4,114)),new Xt(26,new Nt(3,44),new Nt(11,45)),new Xt(26,new Nt(17,21),new Nt(4,22)),new Xt(26,new Nt(9,13),new Nt(16,14))),new Jt(20,Int32Array.from([6,34,62,90]),new Xt(28,new Nt(3,107),new Nt(5,108)),new Xt(26,new Nt(3,41),new Nt(13,42)),new Xt(30,new Nt(15,24),new Nt(5,25)),new Xt(28,new Nt(15,15),new Nt(10,16))),new Jt(21,Int32Array.from([6,28,50,72,94]),new Xt(28,new Nt(4,116),new Nt(4,117)),new Xt(26,new Nt(17,42)),new Xt(28,new Nt(17,22),new Nt(6,23)),new Xt(30,new Nt(19,16),new Nt(6,17))),new Jt(22,Int32Array.from([6,26,50,74,98]),new Xt(28,new Nt(2,111),new Nt(7,112)),new Xt(28,new Nt(17,46)),new Xt(30,new Nt(7,24),new Nt(16,25)),new Xt(24,new Nt(34,13))),new Jt(23,Int32Array.from([6,30,54,78,102]),new Xt(30,new Nt(4,121),new Nt(5,122)),new Xt(28,new Nt(4,47),new Nt(14,48)),new Xt(30,new Nt(11,24),new Nt(14,25)),new Xt(30,new Nt(16,15),new Nt(14,16))),new Jt(24,Int32Array.from([6,28,54,80,106]),new Xt(30,new Nt(6,117),new Nt(4,118)),new Xt(28,new Nt(6,45),new Nt(14,46)),new Xt(30,new Nt(11,24),new Nt(16,25)),new Xt(30,new Nt(30,16),new Nt(2,17))),new Jt(25,Int32Array.from([6,32,58,84,110]),new Xt(26,new Nt(8,106),new Nt(4,107)),new Xt(28,new Nt(8,47),new Nt(13,48)),new Xt(30,new Nt(7,24),new Nt(22,25)),new Xt(30,new Nt(22,15),new Nt(13,16))),new Jt(26,Int32Array.from([6,30,58,86,114]),new Xt(28,new Nt(10,114),new Nt(2,115)),new Xt(28,new Nt(19,46),new Nt(4,47)),new Xt(28,new Nt(28,22),new Nt(6,23)),new Xt(30,new Nt(33,16),new Nt(4,17))),new Jt(27,Int32Array.from([6,34,62,90,118]),new Xt(30,new Nt(8,122),new Nt(4,123)),new Xt(28,new Nt(22,45),new Nt(3,46)),new Xt(30,new Nt(8,23),new Nt(26,24)),new Xt(30,new Nt(12,15),new Nt(28,16))),new Jt(28,Int32Array.from([6,26,50,74,98,122]),new Xt(30,new Nt(3,117),new Nt(10,118)),new Xt(28,new Nt(3,45),new Nt(23,46)),new Xt(30,new Nt(4,24),new Nt(31,25)),new Xt(30,new Nt(11,15),new Nt(31,16))),new Jt(29,Int32Array.from([6,30,54,78,102,126]),new Xt(30,new Nt(7,116),new Nt(7,117)),new Xt(28,new Nt(21,45),new Nt(7,46)),new Xt(30,new Nt(1,23),new Nt(37,24)),new Xt(30,new Nt(19,15),new Nt(26,16))),new Jt(30,Int32Array.from([6,26,52,78,104,130]),new Xt(30,new Nt(5,115),new Nt(10,116)),new Xt(28,new Nt(19,47),new Nt(10,48)),new Xt(30,new Nt(15,24),new Nt(25,25)),new Xt(30,new Nt(23,15),new Nt(25,16))),new Jt(31,Int32Array.from([6,30,56,82,108,134]),new Xt(30,new Nt(13,115),new Nt(3,116)),new Xt(28,new Nt(2,46),new Nt(29,47)),new Xt(30,new Nt(42,24),new Nt(1,25)),new Xt(30,new Nt(23,15),new Nt(28,16))),new Jt(32,Int32Array.from([6,34,60,86,112,138]),new Xt(30,new Nt(17,115)),new Xt(28,new Nt(10,46),new Nt(23,47)),new Xt(30,new Nt(10,24),new Nt(35,25)),new Xt(30,new Nt(19,15),new Nt(35,16))),new Jt(33,Int32Array.from([6,30,58,86,114,142]),new Xt(30,new Nt(17,115),new Nt(1,116)),new Xt(28,new Nt(14,46),new Nt(21,47)),new Xt(30,new Nt(29,24),new Nt(19,25)),new Xt(30,new Nt(11,15),new Nt(46,16))),new Jt(34,Int32Array.from([6,34,62,90,118,146]),new Xt(30,new Nt(13,115),new Nt(6,116)),new Xt(28,new Nt(14,46),new Nt(23,47)),new Xt(30,new Nt(44,24),new Nt(7,25)),new Xt(30,new Nt(59,16),new Nt(1,17))),new Jt(35,Int32Array.from([6,30,54,78,102,126,150]),new Xt(30,new Nt(12,121),new Nt(7,122)),new Xt(28,new Nt(12,47),new Nt(26,48)),new Xt(30,new Nt(39,24),new Nt(14,25)),new Xt(30,new Nt(22,15),new Nt(41,16))),new Jt(36,Int32Array.from([6,24,50,76,102,128,154]),new Xt(30,new Nt(6,121),new Nt(14,122)),new Xt(28,new Nt(6,47),new Nt(34,48)),new Xt(30,new Nt(46,24),new Nt(10,25)),new Xt(30,new Nt(2,15),new Nt(64,16))),new Jt(37,Int32Array.from([6,28,54,80,106,132,158]),new Xt(30,new Nt(17,122),new Nt(4,123)),new Xt(28,new Nt(29,46),new Nt(14,47)),new Xt(30,new Nt(49,24),new Nt(10,25)),new Xt(30,new Nt(24,15),new Nt(46,16))),new Jt(38,Int32Array.from([6,32,58,84,110,136,162]),new Xt(30,new Nt(4,122),new Nt(18,123)),new Xt(28,new Nt(13,46),new Nt(32,47)),new Xt(30,new Nt(48,24),new Nt(14,25)),new Xt(30,new Nt(42,15),new Nt(32,16))),new Jt(39,Int32Array.from([6,26,54,82,110,138,166]),new Xt(30,new Nt(20,117),new Nt(4,118)),new Xt(28,new Nt(40,47),new Nt(7,48)),new Xt(30,new Nt(43,24),new Nt(22,25)),new Xt(30,new Nt(10,15),new Nt(67,16))),new Jt(40,Int32Array.from([6,30,58,86,114,142,170]),new Xt(30,new Nt(19,118),new Nt(6,119)),new Xt(28,new Nt(18,47),new Nt(31,48)),new Xt(30,new Nt(34,24),new Nt(34,25)),new Xt(30,new Nt(20,15),new Nt(61,16)))],(ne=P||(P={}))[ne.DATA_MASK_000=0]="DATA_MASK_000",ne[ne.DATA_MASK_001=1]="DATA_MASK_001",ne[ne.DATA_MASK_010=2]="DATA_MASK_010",ne[ne.DATA_MASK_011=3]="DATA_MASK_011",ne[ne.DATA_MASK_100=4]="DATA_MASK_100",ne[ne.DATA_MASK_101=5]="DATA_MASK_101",ne[ne.DATA_MASK_110=6]="DATA_MASK_110",ne[ne.DATA_MASK_111=7]="DATA_MASK_111";class Yt{constructor(e,t){this.value=e,this.isMasked=t}unmaskBitMatrix(e,t){for(let n=0;n<t;n++)for(let g=0;g<t;g++)this.isMasked(n,g)&&e.flip(g,n)}}Yt.values=new Map([[P.DATA_MASK_000,new Yt(P.DATA_MASK_000,((e,t)=>!(e+t&1)))],[P.DATA_MASK_001,new Yt(P.DATA_MASK_001,((e,t)=>!(1&e)))],[P.DATA_MASK_010,new Yt(P.DATA_MASK_010,((e,t)=>t%3==0))],[P.DATA_MASK_011,new Yt(P.DATA_MASK_011,((e,t)=>(e+t)%3==0))],[P.DATA_MASK_100,new Yt(P.DATA_MASK_100,((e,t)=>!(Math.floor(e/2)+Math.floor(t/3)&1)))],[P.DATA_MASK_101,new Yt(P.DATA_MASK_101,((e,t)=>e*t%6==0))],[P.DATA_MASK_110,new Yt(P.DATA_MASK_110,((e,t)=>e*t%6<3))],[P.DATA_MASK_111,new Yt(P.DATA_MASK_111,((e,t)=>!(e+t+e*t%3&1)))]]);class Et{constructor(e){const t=e.getHeight();if(t<21||1!=(3&t))throw new S;this.bitMatrix=e}readFormatInformation(){if(null!==this.parsedFormatInfo&&void 0!==this.parsedFormatInfo)return this.parsedFormatInfo;let e=0;for(let r=0;r<6;r++)e=this.copyBit(r,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(let r=5;r>=0;r--)e=this.copyBit(8,r,e);const t=this.bitMatrix.getHeight();let n=0;const g=t-7;for(let r=t-1;r>=g;r--)n=this.copyBit(8,r,n);for(let r=t-8;r<t;r++)n=this.copyBit(r,8,n);if(this.parsedFormatInfo=kt.decodeFormatInformation(e,n),null!==this.parsedFormatInfo)return this.parsedFormatInfo;throw new S}readVersion(){if(null!==this.parsedVersion&&void 0!==this.parsedVersion)return this.parsedVersion;const e=this.bitMatrix.getHeight(),t=Math.floor((e-17)/4);if(t<=6)return Jt.getVersionForNumber(t);let n=0;const g=e-11;for(let i=5;i>=0;i--)for(let t=e-9;t>=g;t--)n=this.copyBit(t,i,n);let r=Jt.decodeVersionInformation(n);if(null!==r&&r.getDimensionForVersion()===e)return this.parsedVersion=r,r;n=0;for(let i=5;i>=0;i--)for(let t=e-9;t>=g;t--)n=this.copyBit(i,t,n);if(r=Jt.decodeVersionInformation(n),null!==r&&r.getDimensionForVersion()===e)return this.parsedVersion=r,r;throw new S}copyBit(e,t,n){return(this.isMirror?this.bitMatrix.get(t,e):this.bitMatrix.get(e,t))?n<<1|1:n<<1}readCodewords(){const e=this.readFormatInformation(),t=this.readVersion(),n=Yt.values.get(e.getDataMask()),g=this.bitMatrix.getHeight();n.unmaskBitMatrix(this.bitMatrix,g);const r=t.buildFunctionPattern();let i=!0;const o=new Uint8Array(t.getTotalCodewords());let s=0,a=0,I=0;for(let l=g-1;l>0;l-=2){6===l&&l--;for(let e=0;e<g;e++){const t=i?g-1-e:e;for(let e=0;e<2;e++)r.get(l-e,t)||(I++,a<<=1,this.bitMatrix.get(l-e,t)&&(a|=1),8===I&&(o[s++]=a,I=0,a=0))}i=!i}if(s!==t.getTotalCodewords())throw new S;return o}remask(){if(null===this.parsedFormatInfo)return;const e=Yt.values[this.parsedFormatInfo.getDataMask()],t=this.bitMatrix.getHeight();e.unmaskBitMatrix(this.bitMatrix,t)}setMirror(e){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=e}mirror(){const e=this.bitMatrix;for(let t=0,n=e.getWidth();t<n;t++)for(let g=t+1,r=e.getHeight();g<r;g++)e.get(t,g)!==e.get(g,t)&&(e.flip(g,t),e.flip(t,g))}}class Ht{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t,n){if(e.length!==t.getTotalCodewords())throw new c;const g=t.getECBlocksForLevel(n);let r=0;const i=g.getECBlocks();for(const c of i)r+=c.getCount();const o=new Array(r);let s=0;for(const c of i)for(let e=0;e<c.getCount();e++){const e=c.getDataCodewords(),t=g.getECCodewordsPerBlock()+e;o[s++]=new Ht(e,new Uint8Array(t))}const a=o[0].codewords.length;let I=o.length-1;for(;I>=0&&o[I].codewords.length!==a;)I--;I++;const l=a-g.getECCodewordsPerBlock();let C=0;for(let c=0;c<l;c++)for(let t=0;t<s;t++)o[t].codewords[c]=e[C++];for(let c=I;c<s;c++)o[c].codewords[l]=e[C++];const d=o[0].codewords.length;for(let c=l;c<d;c++)for(let t=0;t<s;t++){const n=t<I?c:c+1;o[t].codewords[n]=e[C++]}return o}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}(ge=_||(_={}))[ge.TERMINATOR=0]="TERMINATOR",ge[ge.NUMERIC=1]="NUMERIC",ge[ge.ALPHANUMERIC=2]="ALPHANUMERIC",ge[ge.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",ge[ge.BYTE=4]="BYTE",ge[ge.ECI=5]="ECI",ge[ge.KANJI=6]="KANJI",ge[ge.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",ge[ge.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",ge[ge.HANZI=9]="HANZI";class Ft{constructor(e,t,n,g){this.value=e,this.stringValue=t,this.characterCountBitsForVersions=n,this.bits=g,Ft.FOR_BITS.set(g,this),Ft.FOR_VALUE.set(e,this)}static forBits(e){const t=Ft.FOR_BITS.get(e);if(void 0===t)throw new c;return t}getCharacterCountBits(e){const t=e.getVersionNumber();let n;return n=t<=9?0:t<=26?1:2,this.characterCountBitsForVersions[n]}getValue(){return this.value}getBits(){return this.bits}equals(e){if(!(e instanceof Ft))return!1;const t=e;return this.value===t.value}toString(){return this.stringValue}}Ft.FOR_BITS=new Map,Ft.FOR_VALUE=new Map,Ft.TERMINATOR=new Ft(_.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Ft.NUMERIC=new Ft(_.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Ft.ALPHANUMERIC=new Ft(_.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Ft.STRUCTURED_APPEND=new Ft(_.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Ft.BYTE=new Ft(_.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Ft.ECI=new Ft(_.ECI,"ECI",Int32Array.from([0,0,0]),7),Ft.KANJI=new Ft(_.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Ft.FNC1_FIRST_POSITION=new Ft(_.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Ft.FNC1_SECOND_POSITION=new Ft(_.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Ft.HANZI=new Ft(_.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class xt{static decode(e,t,n,g){const r=new Bt(e);let i=new W;const o=new Array;let s=-1,a=-1;try{let e,n=null,I=!1;do{if(r.available()<4)e=Ft.TERMINATOR;else{const t=r.readBits(4);e=Ft.forBits(t)}switch(e){case Ft.TERMINATOR:break;case Ft.FNC1_FIRST_POSITION:case Ft.FNC1_SECOND_POSITION:I=!0;break;case Ft.STRUCTURED_APPEND:if(r.available()<16)throw new S;s=r.readBits(8),a=r.readBits(8);break;case Ft.ECI:const l=xt.parseECIValue(r);if(n=R.getCharacterSetECIByValue(l),null===n)throw new S;break;case Ft.HANZI:const C=r.readBits(4),c=r.readBits(e.getCharacterCountBits(t));C===xt.GB2312_SUBSET&&xt.decodeHanziSegment(r,i,c);break;default:const d=r.readBits(e.getCharacterCountBits(t));switch(e){case Ft.NUMERIC:xt.decodeNumericSegment(r,i,d);break;case Ft.ALPHANUMERIC:xt.decodeAlphanumericSegment(r,i,d,I);break;case Ft.BYTE:xt.decodeByteSegment(r,i,d,n,o,g);break;case Ft.KANJI:xt.decodeKanjiSegment(r,i,d);break;default:throw new S}}}while(e!==Ft.TERMINATOR)}catch(I){throw new S}return new ie(e,i.toString(),0===o.length?null:o,null===n?null:n.toString(),s,a)}static decodeHanziSegment(e,t,n){if(13*n>e.available())throw new S;const g=new Uint8Array(2*n);let r=0;for(;n>0;){const t=e.readBits(13);let i=t/96<<8&4294967295|t%96;i+=i<959?41377:42657,g[r]=i>>8&255,g[r+1]=255&i,r+=2,n--}try{t.append(V.decode(g,w.GB2312))}catch(i){throw new S(i)}}static decodeKanjiSegment(e,t,n){if(13*n>e.available())throw new S;const g=new Uint8Array(2*n);let r=0;for(;n>0;){const t=e.readBits(13);let i=t/192<<8&4294967295|t%192;i+=i<7936?33088:49472,g[r]=i>>8,g[r+1]=i,r+=2,n--}try{t.append(V.decode(g,w.SHIFT_JIS))}catch(i){throw new S(i)}}static decodeByteSegment(e,t,n,g,r,i){if(8*n>e.available())throw new S;const o=new Uint8Array(n);for(let I=0;I<n;I++)o[I]=e.readBits(8);let s;s=null===g?w.guessEncoding(o,i):g.getName();try{t.append(V.decode(o,s))}catch(a){throw new S(a)}r.push(o)}static toAlphaNumericChar(e){if(e>=xt.ALPHANUMERIC_CHARS.length)throw new S;return xt.ALPHANUMERIC_CHARS[e]}static decodeAlphanumericSegment(e,t,n,g){const r=t.length();for(;n>1;){if(e.available()<11)throw new S;const g=e.readBits(11);t.append(xt.toAlphaNumericChar(Math.floor(g/45))),t.append(xt.toAlphaNumericChar(g%45)),n-=2}if(1===n){if(e.available()<6)throw new S;t.append(xt.toAlphaNumericChar(e.readBits(6)))}if(g)for(let i=r;i<t.length();i++)"%"===t.charAt(i)&&(i<t.length()-1&&"%"===t.charAt(i+1)?t.deleteCharAt(i+1):t.setCharAt(i,String.fromCharCode(29)))}static decodeNumericSegment(e,t,n){for(;n>=3;){if(e.available()<10)throw new S;const g=e.readBits(10);if(g>=1e3)throw new S;t.append(xt.toAlphaNumericChar(Math.floor(g/100))),t.append(xt.toAlphaNumericChar(Math.floor(g/10)%10)),t.append(xt.toAlphaNumericChar(g%10)),n-=3}if(2===n){if(e.available()<7)throw new S;const n=e.readBits(7);if(n>=100)throw new S;t.append(xt.toAlphaNumericChar(Math.floor(n/10))),t.append(xt.toAlphaNumericChar(n%10))}else if(1===n){if(e.available()<4)throw new S;const n=e.readBits(4);if(n>=10)throw new S;t.append(xt.toAlphaNumericChar(n))}}static parseECIValue(e){const t=e.readBits(8);if(!(128&t))return 127&t;if(128==(192&t))return(63&t)<<8&4294967295|e.readBits(8);if(192==(224&t))return(31&t)<<16&4294967295|e.readBits(16);throw new S}}xt.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",xt.GB2312_SUBSET=1;class Tt{constructor(e){this.mirrored=e}isMirrored(){return this.mirrored}applyMirroredCorrection(e){if(!this.mirrored||null===e||e.length<3)return;const t=e[0];e[0]=e[2],e[2]=t}}class Kt{constructor(){this.rsDecoder=new ce(Ie.QR_CODE_FIELD_256)}decodeBooleanArray(e,t){return this.decodeBitMatrix(k.parseFromBooleanArray(e),t)}decodeBitMatrix(e,t){const n=new Et(e);let g=null;try{return this.decodeBitMatrixParser(n,t)}catch(fp){g=fp}try{n.remask(),n.setMirror(!0),n.readVersion(),n.readFormatInformation(),n.mirror();const e=this.decodeBitMatrixParser(n,t);return e.setOther(new Tt(!0)),e}catch(fp){if(null!==g)throw g;throw fp}}decodeBitMatrixParser(e,t){const n=e.readVersion(),g=e.readFormatInformation().getErrorCorrectionLevel(),r=e.readCodewords(),i=Ht.getDataBlocks(r,n,g);let o=0;for(const I of i)o+=I.getNumDataCodewords();const s=new Uint8Array(o);let a=0;for(const I of i){const e=I.getCodewords(),t=I.getNumDataCodewords();this.correctErrors(e,t);for(let n=0;n<t;n++)s[a++]=e[n]}return xt.decode(s,n,g,t)}correctErrors(e,t){const n=new Int32Array(e);try{this.rsDecoder.decode(n,e.length-t)}catch(g){throw new u}for(let r=0;r<t;r++)e[r]=n[r]}}class Mt extends he{constructor(e,t,n){super(e,t),this.estimatedModuleSize=n}aboutEquals(e,t,n){if(Math.abs(t-this.getY())<=e&&Math.abs(n-this.getX())<=e){const t=Math.abs(e-this.estimatedModuleSize);return t<=1||t<=this.estimatedModuleSize}return!1}combineEstimate(e,t,n){const g=(this.getX()+t)/2,r=(this.getY()+e)/2,i=(this.estimatedModuleSize+n)/2;return new Mt(g,r,i)}}class Dt{constructor(e,t,n,g,r,i,o){this.image=e,this.startX=t,this.startY=n,this.width=g,this.height=r,this.moduleSize=i,this.resultPointCallback=o,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const e=this.startX,t=this.height,n=e+this.width,g=this.startY+t/2,r=new Int32Array(3),i=this.image;for(let o=0;o<t;o++){const t=g+(1&o?-Math.floor((o+1)/2):Math.floor((o+1)/2));r[0]=0,r[1]=0,r[2]=0;let s=e;for(;s<n&&!i.get(s,t);)s++;let a=0;for(;s<n;){if(i.get(s,t))if(1===a)r[1]++;else if(2===a){if(this.foundPatternCross(r)){const e=this.handlePossibleCenter(r,t,s);if(null!==e)return e}r[0]=r[2],r[1]=1,r[2]=0,a=1}else r[++a]++;else 1===a&&a++,r[a]++;s++}if(this.foundPatternCross(r)){const e=this.handlePossibleCenter(r,t,n);if(null!==e)return e}}if(0!==this.possibleCenters.length)return this.possibleCenters[0];throw new X}static centerFromEnd(e,t){return t-e[2]-e[1]/2}foundPatternCross(e){const t=this.moduleSize,n=t/2;for(let g=0;g<3;g++)if(Math.abs(t-e[g])>=n)return!1;return!0}crossCheckVertical(e,t,n,g){const r=this.image,i=r.getHeight(),o=this.crossCheckStateCount;o[0]=0,o[1]=0,o[2]=0;let s=e;for(;s>=0&&r.get(t,s)&&o[1]<=n;)o[1]++,s--;if(s<0||o[1]>n)return NaN;for(;s>=0&&!r.get(t,s)&&o[0]<=n;)o[0]++,s--;if(o[0]>n)return NaN;for(s=e+1;s<i&&r.get(t,s)&&o[1]<=n;)o[1]++,s++;if(s===i||o[1]>n)return NaN;for(;s<i&&!r.get(t,s)&&o[2]<=n;)o[2]++,s++;if(o[2]>n)return NaN;const a=o[0]+o[1]+o[2];return 5*Math.abs(a-g)>=2*g?NaN:this.foundPatternCross(o)?Dt.centerFromEnd(o,s):NaN}handlePossibleCenter(e,t,n){const g=e[0]+e[1]+e[2],r=Dt.centerFromEnd(e,n),i=this.crossCheckVertical(t,r,2*e[1],g);if(!isNaN(i)){const t=(e[0]+e[1]+e[2])/3;for(const e of this.possibleCenters)if(e.aboutEquals(t,i,r))return e.combineEstimate(i,r,t);const n=new Mt(r,i,t);this.possibleCenters.push(n),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(n)}return null}}class Lt extends he{constructor(e,t,n,g){super(e,t),this.estimatedModuleSize=n,this.count=g,void 0===g&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(e,t,n){if(Math.abs(t-this.getY())<=e&&Math.abs(n-this.getX())<=e){const t=Math.abs(e-this.estimatedModuleSize);return t<=1||t<=this.estimatedModuleSize}return!1}combineEstimate(e,t,n){const g=this.count+1,r=(this.count*this.getX()+t)/g,i=(this.count*this.getY()+e)/g,o=(this.count*this.estimatedModuleSize+n)/g;return new Lt(r,i,o,g)}}class Ut{constructor(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class zt{constructor(e,t){this.image=e,this.resultPointCallback=t,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=t}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(e){const t=null!=e&&void 0!==e.get(B.TRY_HARDER),n=null!=e&&void 0!==e.get(B.PURE_BARCODE),g=this.image,r=g.getHeight(),i=g.getWidth();let o=Math.floor(3*r/(4*zt.MAX_MODULES));(o<zt.MIN_SKIP||t)&&(o=zt.MIN_SKIP);let s=!1;const a=new Int32Array(5);for(let l=o-1;l<r&&!s;l+=o){a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0;let e=0;for(let t=0;t<i;t++)if(g.get(t,l))1&~e||e++,a[e]++;else if(1&e)a[e]++;else if(4===e)if(zt.foundPatternCross(a)){if(!0!==this.handlePossibleCenter(a,l,t,n)){a[0]=a[2],a[1]=a[3],a[2]=a[4],a[3]=1,a[4]=0,e=3;continue}if(o=2,!0===this.hasSkipped)s=this.haveMultiplyConfirmedCenters();else{const e=this.findRowSkip();e>a[2]&&(l+=e-a[2]-o,t=i-1)}e=0,a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0}else a[0]=a[2],a[1]=a[3],a[2]=a[4],a[3]=1,a[4]=0,e=3;else a[++e]++;zt.foundPatternCross(a)&&!0===this.handlePossibleCenter(a,l,i,n)&&(o=a[0],this.hasSkipped&&(s=this.haveMultiplyConfirmedCenters()))}const I=this.selectBestPatterns();return he.orderBestPatterns(I),new Ut(I)}static centerFromEnd(e,t){return t-e[4]-e[3]-e[2]/2}static foundPatternCross(e){let t=0;for(let r=0;r<5;r++){const n=e[r];if(0===n)return!1;t+=n}if(t<7)return!1;const n=t/7,g=n/2;return Math.abs(n-e[0])<g&&Math.abs(n-e[1])<g&&Math.abs(3*n-e[2])<3*g&&Math.abs(n-e[3])<g&&Math.abs(n-e[4])<g}getCrossCheckStateCount(){const e=this.crossCheckStateCount;return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e}crossCheckDiagonal(e,t,n,g){const r=this.getCrossCheckStateCount();let i=0;const o=this.image;for(;e>=i&&t>=i&&o.get(t-i,e-i);)r[2]++,i++;if(e<i||t<i)return!1;for(;e>=i&&t>=i&&!o.get(t-i,e-i)&&r[1]<=n;)r[1]++,i++;if(e<i||t<i||r[1]>n)return!1;for(;e>=i&&t>=i&&o.get(t-i,e-i)&&r[0]<=n;)r[0]++,i++;if(r[0]>n)return!1;const s=o.getHeight(),a=o.getWidth();for(i=1;e+i<s&&t+i<a&&o.get(t+i,e+i);)r[2]++,i++;if(e+i>=s||t+i>=a)return!1;for(;e+i<s&&t+i<a&&!o.get(t+i,e+i)&&r[3]<n;)r[3]++,i++;if(e+i>=s||t+i>=a||r[3]>=n)return!1;for(;e+i<s&&t+i<a&&o.get(t+i,e+i)&&r[4]<n;)r[4]++,i++;if(r[4]>=n)return!1;const I=r[0]+r[1]+r[2]+r[3]+r[4];return Math.abs(I-g)<2*g&&zt.foundPatternCross(r)}crossCheckVertical(e,t,n,g){const r=this.image,i=r.getHeight(),o=this.getCrossCheckStateCount();let s=e;for(;s>=0&&r.get(t,s);)o[2]++,s--;if(s<0)return NaN;for(;s>=0&&!r.get(t,s)&&o[1]<=n;)o[1]++,s--;if(s<0||o[1]>n)return NaN;for(;s>=0&&r.get(t,s)&&o[0]<=n;)o[0]++,s--;if(o[0]>n)return NaN;for(s=e+1;s<i&&r.get(t,s);)o[2]++,s++;if(s===i)return NaN;for(;s<i&&!r.get(t,s)&&o[3]<n;)o[3]++,s++;if(s===i||o[3]>=n)return NaN;for(;s<i&&r.get(t,s)&&o[4]<n;)o[4]++,s++;if(o[4]>=n)return NaN;const a=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(a-g)>=2*g?NaN:zt.foundPatternCross(o)?zt.centerFromEnd(o,s):NaN}crossCheckHorizontal(e,t,n,g){const r=this.image,i=r.getWidth(),o=this.getCrossCheckStateCount();let s=e;for(;s>=0&&r.get(s,t);)o[2]++,s--;if(s<0)return NaN;for(;s>=0&&!r.get(s,t)&&o[1]<=n;)o[1]++,s--;if(s<0||o[1]>n)return NaN;for(;s>=0&&r.get(s,t)&&o[0]<=n;)o[0]++,s--;if(o[0]>n)return NaN;for(s=e+1;s<i&&r.get(s,t);)o[2]++,s++;if(s===i)return NaN;for(;s<i&&!r.get(s,t)&&o[3]<n;)o[3]++,s++;if(s===i||o[3]>=n)return NaN;for(;s<i&&r.get(s,t)&&o[4]<n;)o[4]++,s++;if(o[4]>=n)return NaN;const a=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(a-g)>=g?NaN:zt.foundPatternCross(o)?zt.centerFromEnd(o,s):NaN}handlePossibleCenter(e,t,n,g){const r=e[0]+e[1]+e[2]+e[3]+e[4];let i=zt.centerFromEnd(e,n),o=this.crossCheckVertical(t,Math.floor(i),e[2],r);if(!isNaN(o)&&(i=this.crossCheckHorizontal(Math.floor(i),Math.floor(o),e[2],r),!isNaN(i)&&(!g||this.crossCheckDiagonal(Math.floor(o),Math.floor(i),e[2],r)))){const e=r/7;let t=!1;const n=this.possibleCenters;for(let g=0,r=n.length;g<r;g++){const r=n[g];if(r.aboutEquals(e,o,i)){n[g]=r.combineEstimate(o,i,e),t=!0;break}}if(!t){const t=new Lt(i,o,e);n.push(t),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(t)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let e=null;for(const t of this.possibleCenters)if(t.getCount()>=zt.CENTER_QUORUM){if(null!=e)return this.hasSkipped=!0,Math.floor((Math.abs(e.getX()-t.getX())-Math.abs(e.getY()-t.getY()))/2);e=t}return 0}haveMultiplyConfirmedCenters(){let e=0,t=0;const n=this.possibleCenters.length;for(const i of this.possibleCenters)i.getCount()>=zt.CENTER_QUORUM&&(e++,t+=i.getEstimatedModuleSize());if(e<3)return!1;const g=t/n;let r=0;for(const i of this.possibleCenters)r+=Math.abs(i.getEstimatedModuleSize()-g);return r<=.05*t}selectBestPatterns(){const e=this.possibleCenters.length;if(e<3)throw new X;const t=this.possibleCenters;let n;if(e>3){let g=0,r=0;for(const e of this.possibleCenters){const t=e.getEstimatedModuleSize();g+=t,r+=t*t}n=g/e;let i=Math.sqrt(r/e-n*n);t.sort(((e,t)=>{const g=Math.abs(t.getEstimatedModuleSize()-n),r=Math.abs(e.getEstimatedModuleSize()-n);return g<r?-1:g>r?1:0}));const o=Math.max(.2*n,i);for(let e=0;e<t.length&&t.length>3;e++){const g=t[e];Math.abs(g.getEstimatedModuleSize()-n)>o&&(t.splice(e,1),e--)}}if(t.length>3){let e=0;for(const n of t)e+=n.getEstimatedModuleSize();n=e/t.length,t.sort(((e,t)=>{if(t.getCount()===e.getCount()){const g=Math.abs(t.getEstimatedModuleSize()-n),r=Math.abs(e.getEstimatedModuleSize()-n);return g<r?1:g>r?-1:0}return t.getCount()-e.getCount()})),t.splice(3)}return[t[0],t[1],t[2]]}}zt.CENTER_QUORUM=2,zt.MIN_SKIP=3,zt.MAX_MODULES=57;class Qt{constructor(e){this.image=e}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(e){this.resultPointCallback=null==e?null:e.get(B.NEED_RESULT_POINT_CALLBACK);const t=new zt(this.image,this.resultPointCallback).find(e);return this.processFinderPatternInfo(t)}processFinderPatternInfo(e){const t=e.getTopLeft(),n=e.getTopRight(),g=e.getBottomLeft(),r=this.calculateModuleSize(t,n,g);if(r<1)throw new X("No pattern found in proccess finder.");const i=Qt.computeDimension(t,n,g,r),o=Jt.getProvisionalVersionForDimension(i),s=o.getDimensionForVersion()-7;let a=null;if(o.getAlignmentPatternCenters().length>0){const e=n.getX()-t.getX()+g.getX(),i=n.getY()-t.getY()+g.getY(),o=1-3/s,I=Math.floor(t.getX()+o*(e-t.getX())),l=Math.floor(t.getY()+o*(i-t.getY()));for(let t=4;t<=16;t<<=1)try{a=this.findAlignmentInRegion(r,I,l,t);break}catch(eee){if(!(eee instanceof X))throw eee}}const I=Qt.createTransform(t,n,g,a,i),l=Qt.sampleGrid(this.image,I,i);let C;return C=null===a?[g,t,n]:[g,t,n,a],new me(l,C)}static createTransform(e,t,n,g,r){const i=r-3.5;let o,s,a,I;return null!==g?(o=g.getX(),s=g.getY(),a=i-3,I=a):(o=t.getX()-e.getX()+n.getX(),s=t.getY()-e.getY()+n.getY(),a=i,I=i),Ze.quadrilateralToQuadrilateral(3.5,3.5,i,3.5,a,I,3.5,i,e.getX(),e.getY(),t.getX(),t.getY(),o,s,n.getX(),n.getY())}static sampleGrid(e,t,n){return Ge.getInstance().sampleGridWithTransform(e,n,n,t)}static computeDimension(e,t,n,g){const r=ue.round(he.distance(e,t)/g),i=ue.round(he.distance(e,n)/g);let o=Math.floor((r+i)/2)+7;switch(3&o){case 0:o++;break;case 2:o--;break;case 3:throw new X("Dimensions could be not found.")}return o}calculateModuleSize(e,t,n){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,n))/2}calculateModuleSizeOneWay(e,t){const n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY())),g=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(n)?g/7:isNaN(g)?n/7:(n+g)/14}sizeOfBlackWhiteBlackRunBothWays(e,t,n,g){let r=this.sizeOfBlackWhiteBlackRun(e,t,n,g),i=1,o=e-(n-e);o<0?(i=e/(e-o),o=0):o>=this.image.getWidth()&&(i=(this.image.getWidth()-1-e)/(o-e),o=this.image.getWidth()-1);let s=Math.floor(t-(g-t)*i);return i=1,s<0?(i=t/(t-s),s=0):s>=this.image.getHeight()&&(i=(this.image.getHeight()-1-t)/(s-t),s=this.image.getHeight()-1),o=Math.floor(e+(o-e)*i),r+=this.sizeOfBlackWhiteBlackRun(e,t,o,s),r-1}sizeOfBlackWhiteBlackRun(e,t,n,g){const r=Math.abs(g-t)>Math.abs(n-e);if(r){let r=e;e=t,t=r,r=n,n=g,g=r}const i=Math.abs(n-e),o=Math.abs(g-t);let s=-i/2;const a=e<n?1:-1,I=t<g?1:-1;let l=0;const C=n+a;for(let c=e,d=t;c!==C;c+=a){const n=r?d:c,a=r?c:d;if(1===l===this.image.get(n,a)){if(2===l)return ue.distance(c,d,e,t);l++}if(s+=o,s>0){if(d===g)break;d+=I,s-=i}}return 2===l?ue.distance(n+a,g,e,t):NaN}findAlignmentInRegion(e,t,n,g){const r=Math.floor(g*e),i=Math.max(0,t-r),o=Math.min(this.image.getWidth()-1,t+r);if(o-i<3*e)throw new X("Alignment top exceeds estimated module size.");const s=Math.max(0,n-r),a=Math.min(this.image.getHeight()-1,n+r);if(a-s<3*e)throw new X("Alignment bottom exceeds estimated module size.");return new Dt(this.image,i,s,o-i,a-s,e,this.resultPointCallback).find()}}class Ot{constructor(){this.decoder=new Kt}getDecoder(){return this.decoder}decode(e,t){let n,g;if(null!=t&&void 0!==t.get(B.PURE_BARCODE)){const r=Ot.extractPureBits(e.getBlackMatrix());n=this.decoder.decodeBitMatrix(r,t),g=Ot.NO_POINTS}else{const r=new Qt(e.getBlackMatrix()).detect(t);n=this.decoder.decodeBitMatrix(r.getBits(),t),g=r.getPoints()}n.getOther()instanceof Tt&&n.getOther().applyMirroredCorrection(g);const r=new D(n.getText(),n.getRawBytes(),void 0,g,z.QR_CODE,void 0),i=n.getByteSegments();null!==i&&r.putMetadata(re.BYTE_SEGMENTS,i);const o=n.getECLevel();return null!==o&&r.putMetadata(re.ERROR_CORRECTION_LEVEL,o),n.hasStructuredAppend()&&(r.putMetadata(re.STRUCTURED_APPEND_SEQUENCE,n.getStructuredAppendSequenceNumber()),r.putMetadata(re.STRUCTURED_APPEND_PARITY,n.getStructuredAppendParity())),r}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),n=e.getBottomRightOnBit();if(null===t||null===n)throw new X;const g=this.moduleSize(t,e);let r=t[1],i=n[1],o=t[0],s=n[0];if(o>=s||r>=i)throw new X;if(i-r!=s-o&&(s=o+(i-r),s>=e.getWidth()))throw new X;const a=Math.round((s-o+1)/g),I=Math.round((i-r+1)/g);if(a<=0||I<=0)throw new X;if(I!==a)throw new X;const l=Math.floor(g/2);r+=l,o+=l;const C=o+Math.floor((a-1)*g)-s;if(C>0){if(C>l)throw new X;o-=C}const c=r+Math.floor((I-1)*g)-i;if(c>0){if(c>l)throw new X;r-=c}const d=new k(a,I);for(let u=0;u<I;u++){const t=r+Math.floor(u*g);for(let n=0;n<a;n++)e.get(o+Math.floor(n*g),t)&&d.set(n,u)}return d}static moduleSize(e,t){const n=t.getHeight(),g=t.getWidth();let r=e[0],i=e[1],o=!0,s=0;for(;r<g&&i<n;){if(o!==t.get(r,i)){if(5==++s)break;o=!o}r++,i++}if(r===g||i===n)throw new X;return(r-e[0])/7}}Ot.NO_POINTS=new Array;class jt{PDF417Common(){}static getBitCountSum(e){return ue.sum(e)}static toIntArray(e){if(null==e||!e.length)return jt.EMPTY_INT_ARRAY;const t=new Int32Array(e.length);let n=0;for(const g of e)t[n++]=g;return t}static getCodeword(e){const t=p.binarySearch(jt.SYMBOL_TABLE,262143&e);return t<0?-1:(jt.CODEWORD_TABLE[t]-1)%jt.NUMBER_OF_CODEWORDS}}jt.NUMBER_OF_CODEWORDS=929,jt.MAX_CODEWORDS_IN_BARCODE=jt.NUMBER_OF_CODEWORDS-1,jt.MIN_ROWS_IN_BARCODE=3,jt.MAX_ROWS_IN_BARCODE=90,jt.MODULES_IN_CODEWORD=17,jt.MODULES_IN_STOP_PATTERN=18,jt.BARS_IN_MODULE=8,jt.EMPTY_INT_ARRAY=new Int32Array([]),jt.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),jt.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class Pt{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class _t{static detectMultiple(e,t,n){let g=e.getBlackMatrix(),r=_t.detect(n,g);return r.length||(g=g.clone(),g.rotate180(),r=_t.detect(n,g)),new Pt(g,r)}static detect(e,t){const n=new Array;let g=0,r=0,i=!1;for(;g<t.getHeight();){const o=_t.findVertices(t,g,r);if(null!=o[0]||null!=o[3]){if(i=!0,n.push(o),!e)break;null!=o[2]?(r=Math.trunc(o[2].getX()),g=Math.trunc(o[2].getY())):(r=Math.trunc(o[4].getX()),g=Math.trunc(o[4].getY()))}else{if(!i)break;i=!1,r=0;for(const e of n)null!=e[1]&&(g=Math.trunc(Math.max(g,e[1].getY()))),null!=e[3]&&(g=Math.max(g,Math.trunc(e[3].getY())));g+=_t.ROW_STEP}}return n}static findVertices(e,t,n){const g=e.getHeight(),r=e.getWidth(),i=new Array(8);return _t.copyToResult(i,_t.findRowsWithPattern(e,g,r,t,n,_t.START_PATTERN),_t.INDEXES_START_PATTERN),null!=i[4]&&(n=Math.trunc(i[4].getX()),t=Math.trunc(i[4].getY())),_t.copyToResult(i,_t.findRowsWithPattern(e,g,r,t,n,_t.STOP_PATTERN),_t.INDEXES_STOP_PATTERN),i}static copyToResult(e,t,n){for(let g=0;g<n.length;g++)e[n[g]]=t[g]}static findRowsWithPattern(e,t,n,g,r,i){const o=new Array(4);let s=!1;const a=new Int32Array(i.length);for(;g<t;g+=_t.ROW_STEP){let t=_t.findGuardPattern(e,r,g,n,!1,i,a);if(null!=t){for(;g>0;){const o=_t.findGuardPattern(e,r,--g,n,!1,i,a);if(null==o){g++;break}t=o}o[0]=new he(t[0],g),o[1]=new he(t[1],g),s=!0;break}}let I=g+1;if(s){let g=0,r=Int32Array.from([Math.trunc(o[0].getX()),Math.trunc(o[1].getX())]);for(;I<t;I++){const t=_t.findGuardPattern(e,r[0],I,n,!1,i,a);if(null!=t&&Math.abs(r[0]-t[0])<_t.MAX_PATTERN_DRIFT&&Math.abs(r[1]-t[1])<_t.MAX_PATTERN_DRIFT)r=t,g=0;else{if(g>_t.SKIPPED_ROW_COUNT_MAX)break;g++}}I-=g+1,o[2]=new he(r[0],I),o[3]=new he(r[1],I)}return I-g<_t.BARCODE_MIN_HEIGHT&&p.fill(o,null),o}static findGuardPattern(e,t,n,g,r,i,o){p.fillWithin(o,0,o.length,0);let s=t,a=0;for(;e.get(s,n)&&s>0&&a++<_t.MAX_PIXEL_DRIFT;)s--;let I=s,l=0,C=i.length;for(let c=r;I<g;I++)if(e.get(I,n)!==c)o[l]++;else{if(l===C-1){if(_t.patternMatchVariance(o,i,_t.MAX_INDIVIDUAL_VARIANCE)<_t.MAX_AVG_VARIANCE)return new Int32Array([s,I]);s+=o[0]+o[1],h.arraycopy(o,2,o,0,l-1),o[l-1]=0,o[l]=0,l--}else l++;o[l]=1,c=!c}return l===C-1&&_t.patternMatchVariance(o,i,_t.MAX_INDIVIDUAL_VARIANCE)<_t.MAX_AVG_VARIANCE?new Int32Array([s,I-1]):null}static patternMatchVariance(e,t,n){let g=e.length,r=0,i=0;for(let a=0;a<g;a++)r+=e[a],i+=t[a];if(r<i)return 1/0;let o=r/i;n*=o;let s=0;for(let a=0;a<g;a++){let g=e[a],r=t[a]*o,i=g>r?g-r:r-g;if(i>n)return 1/0;s+=i}return s/r}}_t.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),_t.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),_t.MAX_AVG_VARIANCE=.42,_t.MAX_INDIVIDUAL_VARIANCE=.8,_t.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),_t.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),_t.MAX_PIXEL_DRIFT=3,_t.MAX_PATTERN_DRIFT=5,_t.SKIPPED_ROW_COUNT_MAX=25,_t.ROW_STEP=5,_t.BARCODE_MIN_HEIGHT=10;class qt{constructor(e,t){if(0===t.length)throw new c;this.field=e;let n=t.length;if(n>1&&0===t[0]){let e=1;for(;e<n&&0===t[e];)e++;e===n?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(n-e),h.arraycopy(t,e,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(0===e)return this.getCoefficient(0);if(1===e){let e=0;for(let t of this.coefficients)e=this.field.add(e,t);return e}let t=this.coefficients[0],n=this.coefficients.length;for(let g=1;g<n;g++)t=this.field.add(this.field.multiply(e,t),this.coefficients[g]);return t}add(e){if(!this.field.equals(e.field))throw new c("ModulusPolys do not have same ModulusGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,n=e.coefficients;if(t.length>n.length){let e=t;t=n,n=e}let g=new Int32Array(n.length),r=n.length-t.length;h.arraycopy(n,0,g,0,r);for(let i=r;i<n.length;i++)g[i]=this.field.add(t[i-r],n[i]);return new qt(this.field,g)}subtract(e){if(!this.field.equals(e.field))throw new c("ModulusPolys do not have same ModulusGF field");return e.isZero()?this:this.add(e.negative())}multiply(e){return e instanceof qt?this.multiplyOther(e):this.multiplyScalar(e)}multiplyOther(e){if(!this.field.equals(e.field))throw new c("ModulusPolys do not have same ModulusGF field");if(this.isZero()||e.isZero())return new qt(this.field,new Int32Array([0]));let t=this.coefficients,n=t.length,g=e.coefficients,r=g.length,i=new Int32Array(n+r-1);for(let o=0;o<n;o++){let e=t[o];for(let t=0;t<r;t++)i[o+t]=this.field.add(i[o+t],this.field.multiply(e,g[t]))}return new qt(this.field,i)}negative(){let e=this.coefficients.length,t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=this.field.subtract(0,this.coefficients[n]);return new qt(this.field,t)}multiplyScalar(e){if(0===e)return new qt(this.field,new Int32Array([0]));if(1===e)return this;let t=this.coefficients.length,n=new Int32Array(t);for(let g=0;g<t;g++)n[g]=this.field.multiply(this.coefficients[g],e);return new qt(this.field,n)}multiplyByMonomial(e,t){if(e<0)throw new c;if(0===t)return new qt(this.field,new Int32Array([0]));let n=this.coefficients.length,g=new Int32Array(n+e);for(let r=0;r<n;r++)g[r]=this.field.multiply(this.coefficients[r],t);return new qt(this.field,g)}toString(){let e=new W;for(let t=this.getDegree();t>=0;t--){let n=this.getCoefficient(t);0!==n&&(n<0?(e.append(" - "),n=-n):e.length()>0&&e.append(" + "),0!==t&&1===n||e.append(n),0!==t&&(1===t?e.append("x"):(e.append("x^"),e.append(t))))}return e.toString()}}class $t{add(e,t){return(e+t)%this.modulus}subtract(e,t){return(this.modulus+e-t)%this.modulus}exp(e){return this.expTable[e]}log(e){if(0===e)throw new c;return this.logTable[e]}inverse(e){if(0===e)throw new ae;return this.expTable[this.modulus-this.logTable[e]-1]}multiply(e,t){return 0===e||0===t?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.modulus-1)]}getSize(){return this.modulus}equals(e){return e===this}}class en extends $t{constructor(e,t){super(),this.modulus=e,this.expTable=new Int32Array(e),this.logTable=new Int32Array(e);let n=1;for(let g=0;g<e;g++)this.expTable[g]=n,n=n*t%e;for(let g=0;g<e-1;g++)this.logTable[this.expTable[g]]=g;this.zero=new qt(this,new Int32Array([0])),this.one=new qt(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new c;if(0===t)return this.zero;let n=new Int32Array(e+1);return n[0]=t,new qt(this,n)}}en.PDF417_GF=new en(jt.NUMBER_OF_CODEWORDS,3);class tn{constructor(){this.field=en.PDF417_GF}decode(e,t,n){let g=new qt(this.field,e),r=new Int32Array(t),i=!1;for(let d=t;d>0;d--){let e=g.evaluateAt(this.field.exp(d));r[t-d]=e,0!==e&&(i=!0)}if(!i)return 0;let o=this.field.getOne();if(null!=n)for(const d of n){let t=this.field.exp(e.length-1-d),n=new qt(this.field,new Int32Array([this.field.subtract(0,t),1]));o=o.multiply(n)}let s=new qt(this.field,r),a=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),s,t),I=a[0],l=a[1],C=this.findErrorLocations(I),c=this.findErrorMagnitudes(l,I,C);for(let d=0;d<C.length;d++){let t=e.length-1-this.field.log(C[d]);if(t<0)throw u.getChecksumInstance();e[t]=this.field.subtract(e[t],c[d])}return C.length}runEuclideanAlgorithm(e,t,n){if(e.getDegree()<t.getDegree()){let n=e;e=t,t=n}let g=e,r=t,i=this.field.getZero(),o=this.field.getOne();for(;r.getDegree()>=Math.round(n/2);){let e=g,t=i;if(g=r,i=o,g.isZero())throw u.getChecksumInstance();r=e;let n=this.field.getZero(),s=g.getCoefficient(g.getDegree()),a=this.field.inverse(s);for(;r.getDegree()>=g.getDegree()&&!r.isZero();){let e=r.getDegree()-g.getDegree(),t=this.field.multiply(r.getCoefficient(r.getDegree()),a);n=n.add(this.field.buildMonomial(e,t)),r=r.subtract(g.multiplyByMonomial(e,t))}o=n.multiply(i).subtract(t).negative()}let s=o.getCoefficient(0);if(0===s)throw u.getChecksumInstance();let a=this.field.inverse(s);return[o.multiply(a),r.multiply(a)]}findErrorLocations(e){let t=e.getDegree(),n=new Int32Array(t),g=0;for(let r=1;r<this.field.getSize()&&g<t;r++)0===e.evaluateAt(r)&&(n[g]=this.field.inverse(r),g++);if(g!==t)throw u.getChecksumInstance();return n}findErrorMagnitudes(e,t,n){let g=t.getDegree(),r=new Int32Array(g);for(let a=1;a<=g;a++)r[g-a]=this.field.multiply(a,t.getCoefficient(a));let i=new qt(this.field,r),o=n.length,s=new Int32Array(o);for(let a=0;a<o;a++){let t=this.field.inverse(n[a]),g=this.field.subtract(0,e.evaluateAt(t)),r=this.field.inverse(i.evaluateAt(t));s[a]=this.field.multiply(g,r)}return s}}class nn{constructor(e,t,n,g,r){e instanceof nn?this.constructor_2(e):this.constructor_1(e,t,n,g,r)}constructor_1(e,t,n,g,r){const i=null==t||null==n,o=null==g||null==r;if(i&&o)throw new X;i?(t=new he(0,g.getY()),n=new he(0,r.getY())):o&&(g=new he(e.getWidth()-1,t.getY()),r=new he(e.getWidth()-1,n.getY())),this.image=e,this.topLeft=t,this.bottomLeft=n,this.topRight=g,this.bottomRight=r,this.minX=Math.trunc(Math.min(t.getX(),n.getX())),this.maxX=Math.trunc(Math.max(g.getX(),r.getX())),this.minY=Math.trunc(Math.min(t.getY(),g.getY())),this.maxY=Math.trunc(Math.max(n.getY(),r.getY()))}constructor_2(e){this.image=e.image,this.topLeft=e.getTopLeft(),this.bottomLeft=e.getBottomLeft(),this.topRight=e.getTopRight(),this.bottomRight=e.getBottomRight(),this.minX=e.getMinX(),this.maxX=e.getMaxX(),this.minY=e.getMinY(),this.maxY=e.getMaxY()}static merge(e,t){return null==e?t:null==t?e:new nn(e.image,e.topLeft,e.bottomLeft,t.topRight,t.bottomRight)}addMissingRows(e,t,n){let g=this.topLeft,r=this.bottomLeft,i=this.topRight,o=this.bottomRight;if(e>0){let t=n?this.topLeft:this.topRight,r=Math.trunc(t.getY()-e);r<0&&(r=0);let o=new he(t.getX(),r);n?g=o:i=o}if(t>0){let e=n?this.bottomLeft:this.bottomRight,g=Math.trunc(e.getY()+t);g>=this.image.getHeight()&&(g=this.image.getHeight()-1);let i=new he(e.getX(),g);n?r=i:o=i}return new nn(this.image,g,r,i,o)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class gn{constructor(e,t,n,g){this.columnCount=e,this.errorCorrectionLevel=g,this.rowCountUpperPart=t,this.rowCountLowerPart=n,this.rowCount=t+n}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class rn{constructor(){this.buffer=""}static form(e,t){let n=-1;function g(e,g,r,i,o,s){if("%%"===e)return"%";if(void 0===t[++n])return;e=i?parseInt(i.substr(1)):void 0;let a,I=o?parseInt(o.substr(1)):void 0;switch(s){case"s":a=t[n];break;case"c":a=t[n][0];break;case"f":a=parseFloat(t[n]).toFixed(e);break;case"p":a=parseFloat(t[n]).toPrecision(e);break;case"e":a=parseFloat(t[n]).toExponential(e);break;case"x":a=parseInt(t[n]).toString(I||16);break;case"d":a=parseFloat(parseInt(t[n],I||10).toPrecision(e)).toFixed(0)}a="object"==typeof a?JSON.stringify(a):(+a).toString(I);let l=parseInt(r),C=r&&r[0]+""=="0"?"0":" ";for(;a.length<l;)a=void 0!==g?a+C:C+a;return a}let r=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(r,g)}format(e,...t){this.buffer+=rn.form(e,t)}toString(){return this.buffer}}class on{constructor(e){this.boundingBox=new nn(e),this.codewords=new Array(e.getMaxY()-e.getMinY()+1)}getCodewordNearby(e){let t=this.getCodeword(e);if(null!=t)return t;for(let n=1;n<on.MAX_NEARBY_DISTANCE;n++){let g=this.imageRowToCodewordIndex(e)-n;if(g>=0&&(t=this.codewords[g],null!=t))return t;if(g=this.imageRowToCodewordIndex(e)+n,g<this.codewords.length&&(t=this.codewords[g],null!=t))return t}return null}imageRowToCodewordIndex(e){return e-this.boundingBox.getMinY()}setCodeword(e,t){this.codewords[this.imageRowToCodewordIndex(e)]=t}getCodeword(e){return this.codewords[this.imageRowToCodewordIndex(e)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const e=new rn;let t=0;for(const n of this.codewords)null!=n?e.format("%3d: %3d|%3d%n",t++,n.getRowNumber(),n.getValue()):e.format("%3d:    |   %n",t++);return e.toString()}}on.MAX_NEARBY_DISTANCE=5;class sn{constructor(){this.values=new Map}setValue(e){e=Math.trunc(e);let t=this.values.get(e);null==t&&(t=0),t++,this.values.set(e,t)}getValue(){let e=-1,t=new Array;for(const[n,g]of this.values.entries()){const r={getKey:()=>n,getValue:()=>g};r.getValue()>e?(e=r.getValue(),t=[],t.push(r.getKey())):r.getValue()===e&&t.push(r.getKey())}return jt.toIntArray(t)}getConfidence(e){return this.values.get(e)}}class an extends on{constructor(e,t){super(e),this._isLeft=t}setRowNumbers(){for(let e of this.getCodewords())null!=e&&e.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(e){let t=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(t,e);let n=this.getBoundingBox(),g=this._isLeft?n.getTopLeft():n.getTopRight(),r=this._isLeft?n.getBottomLeft():n.getBottomRight(),i=this.imageRowToCodewordIndex(Math.trunc(g.getY())),o=this.imageRowToCodewordIndex(Math.trunc(r.getY())),s=-1,a=1,I=0;for(let l=i;l<o;l++){if(null==t[l])continue;let n=t[l],g=n.getRowNumber()-s;if(0===g)I++;else if(1===g)a=Math.max(a,I),I=1,s=n.getRowNumber();else if(g<0||n.getRowNumber()>=e.getRowCount()||g>l)t[l]=null;else{let e;e=a>2?(a-2)*g:g;let r=e>=l;for(let n=1;n<=e&&!r;n++)r=null!=t[l-n];r?t[l]=null:(s=n.getRowNumber(),I=1)}}}getRowHeights(){let e=this.getBarcodeMetadata();if(null==e)return null;this.adjustIncompleteIndicatorColumnRowNumbers(e);let t=new Int32Array(e.getRowCount());for(let n of this.getCodewords())if(null!=n){let e=n.getRowNumber();if(e>=t.length)continue;t[e]++}return t}adjustIncompleteIndicatorColumnRowNumbers(e){let t=this.getBoundingBox(),n=this._isLeft?t.getTopLeft():t.getTopRight(),g=this._isLeft?t.getBottomLeft():t.getBottomRight(),r=this.imageRowToCodewordIndex(Math.trunc(n.getY())),i=this.imageRowToCodewordIndex(Math.trunc(g.getY())),o=this.getCodewords(),s=-1;for(let a=r;a<i;a++){if(null==o[a])continue;let t=o[a];t.setRowNumberAsRowIndicatorColumn();let n=t.getRowNumber()-s;0===n||(1===n?s=t.getRowNumber():t.getRowNumber()>=e.getRowCount()?o[a]=null:s=t.getRowNumber())}}getBarcodeMetadata(){let e=this.getCodewords(),t=new sn,n=new sn,g=new sn,r=new sn;for(let o of e){if(null==o)continue;o.setRowNumberAsRowIndicatorColumn();let e=o.getValue()%30,i=o.getRowNumber();switch(this._isLeft||(i+=2),i%3){case 0:n.setValue(3*e+1);break;case 1:r.setValue(e/3),g.setValue(e%3);break;case 2:t.setValue(e+1)}}if(0===t.getValue().length||0===n.getValue().length||0===g.getValue().length||0===r.getValue().length||t.getValue()[0]<1||n.getValue()[0]+g.getValue()[0]<jt.MIN_ROWS_IN_BARCODE||n.getValue()[0]+g.getValue()[0]>jt.MAX_ROWS_IN_BARCODE)return null;let i=new gn(t.getValue()[0],n.getValue()[0],g.getValue()[0],r.getValue()[0]);return this.removeIncorrectCodewords(e,i),i}removeIncorrectCodewords(e,t){for(let n=0;n<e.length;n++){let g=e[n];if(null==e[n])continue;let r=g.getValue()%30,i=g.getRowNumber();if(i>t.getRowCount())e[n]=null;else switch(this._isLeft||(i+=2),i%3){case 0:3*r+1!==t.getRowCountUpperPart()&&(e[n]=null);break;case 1:Math.trunc(r/3)===t.getErrorCorrectionLevel()&&r%3===t.getRowCountLowerPart()||(e[n]=null);break;case 2:r+1!==t.getColumnCount()&&(e[n]=null)}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+"\n"+super.toString()}}class In{constructor(e,t){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=e,this.barcodeColumnCount=e.getColumnCount(),this.boundingBox=t,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let e,t=jt.MAX_CODEWORDS_IN_BARCODE;do{e=t,t=this.adjustRowNumbersAndGetCount()}while(t>0&&t<e);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(e){null!=e&&e.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let e=this.adjustRowNumbersByRow();if(0===e)return 0;for(let t=1;t<this.barcodeColumnCount+1;t++){let e=this.detectionResultColumns[t].getCodewords();for(let n=0;n<e.length;n++)null!=e[n]&&(e[n].hasValidRowNumber()||this.adjustRowNumbers(t,n,e))}return e}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(null==this.detectionResultColumns[0]||null==this.detectionResultColumns[this.barcodeColumnCount+1])return;let e=this.detectionResultColumns[0].getCodewords(),t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let n=0;n<e.length;n++)if(null!=e[n]&&null!=t[n]&&e[n].getRowNumber()===t[n].getRowNumber())for(let t=1;t<=this.barcodeColumnCount;t++){let g=this.detectionResultColumns[t].getCodewords()[n];null!=g&&(g.setRowNumber(e[n].getRowNumber()),g.hasValidRowNumber()||(this.detectionResultColumns[t].getCodewords()[n]=null))}}adjustRowNumbersFromRRI(){if(null==this.detectionResultColumns[this.barcodeColumnCount+1])return 0;let e=0,t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let n=0;n<t.length;n++){if(null==t[n])continue;let g=t[n].getRowNumber(),r=0;for(let t=this.barcodeColumnCount+1;t>0&&r<this.ADJUST_ROW_NUMBER_SKIP;t--){let i=this.detectionResultColumns[t].getCodewords()[n];null!=i&&(r=In.adjustRowNumberIfValid(g,r,i),i.hasValidRowNumber()||e++)}}return e}adjustRowNumbersFromLRI(){if(null==this.detectionResultColumns[0])return 0;let e=0,t=this.detectionResultColumns[0].getCodewords();for(let n=0;n<t.length;n++){if(null==t[n])continue;let g=t[n].getRowNumber(),r=0;for(let t=1;t<this.barcodeColumnCount+1&&r<this.ADJUST_ROW_NUMBER_SKIP;t++){let i=this.detectionResultColumns[t].getCodewords()[n];null!=i&&(r=In.adjustRowNumberIfValid(g,r,i),i.hasValidRowNumber()||e++)}}return e}static adjustRowNumberIfValid(e,t,n){return null==n||n.hasValidRowNumber()||(n.isValidRowNumber(e)?(n.setRowNumber(e),t=0):++t),t}adjustRowNumbers(e,t,n){if(!this.detectionResultColumns[e-1])return;let g=n[t],r=this.detectionResultColumns[e-1].getCodewords(),i=r;null!=this.detectionResultColumns[e+1]&&(i=this.detectionResultColumns[e+1].getCodewords());let o=new Array(14);o[2]=r[t],o[3]=i[t],t>0&&(o[0]=n[t-1],o[4]=r[t-1],o[5]=i[t-1]),t>1&&(o[8]=n[t-2],o[10]=r[t-2],o[11]=i[t-2]),t<n.length-1&&(o[1]=n[t+1],o[6]=r[t+1],o[7]=i[t+1]),t<n.length-2&&(o[9]=n[t+2],o[12]=r[t+2],o[13]=i[t+2]);for(let s of o)if(In.adjustRowNumber(g,s))return}static adjustRowNumber(e,t){return!(null==t||!t.hasValidRowNumber()||t.getBucket()!==e.getBucket()||(e.setRowNumber(t.getRowNumber()),0))}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(e){this.boundingBox=e}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(e,t){this.detectionResultColumns[e]=t}getDetectionResultColumn(e){return this.detectionResultColumns[e]}toString(){let e=this.detectionResultColumns[0];null==e&&(e=this.detectionResultColumns[this.barcodeColumnCount+1]);let t=new rn;for(let n=0;n<e.getCodewords().length;n++){t.format("CW %3d:",n);for(let e=0;e<this.barcodeColumnCount+2;e++){if(null==this.detectionResultColumns[e]){t.format("    |   ");continue}let g=this.detectionResultColumns[e].getCodewords()[n];null!=g?t.format(" %3d|%3d",g.getRowNumber(),g.getValue()):t.format("    |   ")}t.format("%n")}return t.toString()}}class ln{constructor(e,t,n,g){this.rowNumber=ln.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(e),this.endX=Math.trunc(t),this.bucket=Math.trunc(n),this.value=Math.trunc(g)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(e){return e!==ln.BARCODE_ROW_UNKNOWN&&this.bucket===e%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(3*Math.trunc(this.value/30)+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(e){this.rowNumber=e}toString(){return this.rowNumber+"|"+this.value}}ln.BARCODE_ROW_UNKNOWN=-1;class Cn{static initialize(){for(let e=0;e<jt.SYMBOL_TABLE.length;e++){let t=jt.SYMBOL_TABLE[e],n=1&t;for(let g=0;g<jt.BARS_IN_MODULE;g++){let r=0;for(;(1&t)===n;)r+=1,t>>=1;n=1&t,Cn.RATIOS_TABLE[e]||(Cn.RATIOS_TABLE[e]=new Array(jt.BARS_IN_MODULE)),Cn.RATIOS_TABLE[e][jt.BARS_IN_MODULE-g-1]=Math.fround(r/jt.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(e){let t=Cn.getDecodedCodewordValue(Cn.sampleBitCounts(e));return-1!==t?t:Cn.getClosestDecodedValue(e)}static sampleBitCounts(e){let t=ue.sum(e),n=new Int32Array(jt.BARS_IN_MODULE),g=0,r=0;for(let i=0;i<jt.MODULES_IN_CODEWORD;i++){let o=t/(2*jt.MODULES_IN_CODEWORD)+i*t/jt.MODULES_IN_CODEWORD;r+e[g]<=o&&(r+=e[g],g++),n[g]++}return n}static getDecodedCodewordValue(e){let t=Cn.getBitValue(e);return-1===jt.getCodeword(t)?-1:t}static getBitValue(e){let t=0;for(let n=0;n<e.length;n++)for(let g=0;g<e[n];g++)t=t<<1|(n%2==0?1:0);return Math.trunc(t)}static getClosestDecodedValue(e){let t=ue.sum(e),n=new Array(jt.BARS_IN_MODULE);if(t>1)for(let i=0;i<n.length;i++)n[i]=Math.fround(e[i]/t);let g=Ae.MAX_VALUE,r=-1;this.bSymbolTableReady||Cn.initialize();for(let i=0;i<Cn.RATIOS_TABLE.length;i++){let e=0,t=Cn.RATIOS_TABLE[i];for(let r=0;r<jt.BARS_IN_MODULE;r++){let i=Math.fround(t[r]-n[r]);if(e+=Math.fround(i*i),e>=g)break}e<g&&(g=e,r=jt.SYMBOL_TABLE[i])}return r}}Cn.bSymbolTableReady=!1,Cn.RATIOS_TABLE=new Array(jt.SYMBOL_TABLE.length).map((e=>new Array(jt.BARS_IN_MODULE)));class cn{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(e){this.segmentIndex=e}getFileId(){return this.fileId}setFileId(e){this.fileId=e}getOptionalData(){return this.optionalData}setOptionalData(e){this.optionalData=e}isLastSegment(){return this.lastSegment}setLastSegment(e){this.lastSegment=e}getSegmentCount(){return this.segmentCount}setSegmentCount(e){this.segmentCount=e}getSender(){return this.sender||null}setSender(e){this.sender=e}getAddressee(){return this.addressee||null}setAddressee(e){this.addressee=e}getFileName(){return this.fileName}setFileName(e){this.fileName=e}getFileSize(){return this.fileSize}setFileSize(e){this.fileSize=e}getChecksum(){return this.checksum}setChecksum(e){this.checksum=e}getTimestamp(){return this.timestamp}setTimestamp(e){this.timestamp=e}}class dn{static parseLong(e,t=void 0){return parseInt(e,t)}}class un extends l{}un.kind="NullPointerException";class An{writeBytes(e){this.writeBytesOffset(e,0,e.length)}writeBytesOffset(e,t,n){if(null==e)throw new un;if(t<0||t>e.length||n<0||t+n>e.length||t+n<0)throw new m;if(0!==n)for(let g=0;g<n;g++)this.write(e[t+g])}flush(){}close(){}}class hn extends l{}class mn extends An{constructor(e=32){if(super(),this.count=0,e<0)throw new c("Negative initial size: "+e);this.buf=new Uint8Array(e)}ensureCapacity(e){e-this.buf.length>0&&this.grow(e)}grow(e){let t=this.buf.length<<1;if(t-e<0&&(t=e),t<0){if(e<0)throw new hn;t=y.MAX_VALUE}this.buf=p.copyOfUint8Array(this.buf,t)}write(e){this.ensureCapacity(this.count+1),this.buf[this.count]=e,this.count+=1}writeBytesOffset(e,t,n){if(t<0||t>e.length||n<0||t+n-e.length>0)throw new m;this.ensureCapacity(this.count+n),h.arraycopy(e,t,this.buf,this.count,n),this.count+=n}writeTo(e){e.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return p.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(e){return e?"string"==typeof e?this.toString_string(e):this.toString_number(e):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(e){return new String(this.buf).toString()}toString_number(e){return new String(this.buf).toString()}close(){}}function bn(){if("undefined"!=typeof window)return window.BigInt||null;if(void 0!==o)return o.BigInt||null;if("undefined"!=typeof self)return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let pn;function yn(e){if(void 0===pn&&(pn=bn()),null===pn)throw new Error("BigInt is not supported!");return pn(e)}function Zn(){let e=[];e[0]=yn(1);let t=yn(900);e[1]=t;for(let n=2;n<16;n++)e[n]=e[n-1]*t;return e}!function(e){e[e.ALPHA=0]="ALPHA",e[e.LOWER=1]="LOWER",e[e.MIXED=2]="MIXED",e[e.PUNCT=3]="PUNCT",e[e.ALPHA_SHIFT=4]="ALPHA_SHIFT",e[e.PUNCT_SHIFT=5]="PUNCT_SHIFT"}(q||(q={}));class fn{static decode(e,t){let n=new W(""),g=R.ISO8859_1;n.enableDecoding(g);let r=1,i=e[r++],o=new cn;for(;r<e[0];){switch(i){case fn.TEXT_COMPACTION_MODE_LATCH:r=fn.textCompaction(e,r,n);break;case fn.BYTE_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH_6:r=fn.byteCompaction(i,e,g,r,n);break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(e[r++]);break;case fn.NUMERIC_COMPACTION_MODE_LATCH:r=fn.numericCompaction(e,r,n);break;case fn.ECI_CHARSET:R.getCharacterSetECIByValue(e[r++]);break;case fn.ECI_GENERAL_PURPOSE:r+=2;break;case fn.ECI_USER_DEFINED:r++;break;case fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:r=fn.decodeMacroBlock(e,r,o);break;case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case fn.MACRO_PDF417_TERMINATOR:throw new S;default:r--,r=fn.textCompaction(e,r,n)}if(!(r<e.length))throw S.getFormatInstance();i=e[r++]}if(0===n.length())throw S.getFormatInstance();let s=new ie(null,n.toString(),null,t);return s.setOther(o),s}static decodeMacroBlock(e,t,n){if(t+fn.NUMBER_OF_SEQUENCE_CODEWORDS>e[0])throw S.getFormatInstance();let g=new Int32Array(fn.NUMBER_OF_SEQUENCE_CODEWORDS);for(let o=0;o<fn.NUMBER_OF_SEQUENCE_CODEWORDS;o++,t++)g[o]=e[t];n.setSegmentIndex(y.parseInt(fn.decodeBase900toBase10(g,fn.NUMBER_OF_SEQUENCE_CODEWORDS)));let r=new W;t=fn.textCompaction(e,t,r),n.setFileId(r.toString());let i=-1;for(e[t]===fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(i=t+1);t<e[0];)switch(e[t]){case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(e[++t]){case fn.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let g=new W;t=fn.textCompaction(e,t+1,g),n.setFileName(g.toString());break;case fn.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let r=new W;t=fn.textCompaction(e,t+1,r),n.setSender(r.toString());break;case fn.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let i=new W;t=fn.textCompaction(e,t+1,i),n.setAddressee(i.toString());break;case fn.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let o=new W;t=fn.numericCompaction(e,t+1,o),n.setSegmentCount(y.parseInt(o.toString()));break;case fn.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let s=new W;t=fn.numericCompaction(e,t+1,s),n.setTimestamp(dn.parseLong(s.toString()));break;case fn.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let a=new W;t=fn.numericCompaction(e,t+1,a),n.setChecksum(y.parseInt(a.toString()));break;case fn.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let I=new W;t=fn.numericCompaction(e,t+1,I),n.setFileSize(dn.parseLong(I.toString()));break;default:throw S.getFormatInstance()}break;case fn.MACRO_PDF417_TERMINATOR:t++,n.setLastSegment(!0);break;default:throw S.getFormatInstance()}if(-1!==i){let g=t-i;n.isLastSegment()&&g--,n.setOptionalData(p.copyOfRange(e,i,i+g))}return t}static textCompaction(e,t,n){let g=new Int32Array(2*(e[0]-t)),r=new Int32Array(2*(e[0]-t)),i=0,o=!1;for(;t<e[0]&&!o;){let n=e[t++];if(n<fn.TEXT_COMPACTION_MODE_LATCH)g[i]=n/30,g[i+1]=n%30,i+=2;else switch(n){case fn.TEXT_COMPACTION_MODE_LATCH:g[i++]=fn.TEXT_COMPACTION_MODE_LATCH;break;case fn.BYTE_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH_6:case fn.NUMERIC_COMPACTION_MODE_LATCH:case fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case fn.MACRO_PDF417_TERMINATOR:t--,o=!0;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g[i]=fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,n=e[t++],r[i]=n,i++}}return fn.decodeTextCompaction(g,r,i,n),t}static decodeTextCompaction(e,t,n,g){let r=q.ALPHA,i=q.ALPHA,o=0;for(;o<n;){let n=e[o],s="";switch(r){case q.ALPHA:if(n<26)s=String.fromCharCode(65+n);else switch(n){case 26:s=" ";break;case fn.LL:r=q.LOWER;break;case fn.ML:r=q.MIXED;break;case fn.PS:i=r,r=q.PUNCT_SHIFT;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(t[o]);break;case fn.TEXT_COMPACTION_MODE_LATCH:r=q.ALPHA}break;case q.LOWER:if(n<26)s=String.fromCharCode(97+n);else switch(n){case 26:s=" ";break;case fn.AS:i=r,r=q.ALPHA_SHIFT;break;case fn.ML:r=q.MIXED;break;case fn.PS:i=r,r=q.PUNCT_SHIFT;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(t[o]);break;case fn.TEXT_COMPACTION_MODE_LATCH:r=q.ALPHA}break;case q.MIXED:if(n<fn.PL)s=fn.MIXED_CHARS[n];else switch(n){case fn.PL:r=q.PUNCT;break;case 26:s=" ";break;case fn.LL:r=q.LOWER;break;case fn.AL:r=q.ALPHA;break;case fn.PS:i=r,r=q.PUNCT_SHIFT;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(t[o]);break;case fn.TEXT_COMPACTION_MODE_LATCH:r=q.ALPHA}break;case q.PUNCT:if(n<fn.PAL)s=fn.PUNCT_CHARS[n];else switch(n){case fn.PAL:r=q.ALPHA;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(t[o]);break;case fn.TEXT_COMPACTION_MODE_LATCH:r=q.ALPHA}break;case q.ALPHA_SHIFT:if(r=i,n<26)s=String.fromCharCode(65+n);else switch(n){case 26:s=" ";break;case fn.TEXT_COMPACTION_MODE_LATCH:r=q.ALPHA}break;case q.PUNCT_SHIFT:if(r=i,n<fn.PAL)s=fn.PUNCT_CHARS[n];else switch(n){case fn.PAL:r=q.ALPHA;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:g.append(t[o]);break;case fn.TEXT_COMPACTION_MODE_LATCH:r=q.ALPHA}}""!==s&&g.append(s),o++}}static byteCompaction(e,t,n,g,r){let i=new mn,o=0,s=0,a=!1;switch(e){case fn.BYTE_COMPACTION_MODE_LATCH:let e=new Int32Array(6),n=t[g++];for(;g<t[0]&&!a;)switch(e[o++]=n,s=900*s+n,n=t[g++],n){case fn.TEXT_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH:case fn.NUMERIC_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH_6:case fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case fn.MACRO_PDF417_TERMINATOR:g--,a=!0;break;default:if(o%5==0&&o>0){for(let e=0;e<6;++e)i.write(Number(yn(s)>>yn(8*(5-e))));s=0,o=0}}g===t[0]&&n<fn.TEXT_COMPACTION_MODE_LATCH&&(e[o++]=n);for(let t=0;t<o;t++)i.write(e[t]);break;case fn.BYTE_COMPACTION_MODE_LATCH_6:for(;g<t[0]&&!a;){let e=t[g++];if(e<fn.TEXT_COMPACTION_MODE_LATCH)o++,s=900*s+e;else switch(e){case fn.TEXT_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH:case fn.NUMERIC_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH_6:case fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case fn.MACRO_PDF417_TERMINATOR:g--,a=!0}if(o%5==0&&o>0){for(let e=0;e<6;++e)i.write(Number(yn(s)>>yn(8*(5-e))));s=0,o=0}}}return r.append(V.decode(i.toByteArray(),n)),g}static numericCompaction(e,t,n){let g=0,r=!1,i=new Int32Array(fn.MAX_NUMERIC_CODEWORDS);for(;t<e[0]&&!r;){let o=e[t++];if(t===e[0]&&(r=!0),o<fn.TEXT_COMPACTION_MODE_LATCH)i[g]=o,g++;else switch(o){case fn.TEXT_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH_6:case fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case fn.MACRO_PDF417_TERMINATOR:t--,r=!0}(g%fn.MAX_NUMERIC_CODEWORDS==0||o===fn.NUMERIC_COMPACTION_MODE_LATCH||r)&&g>0&&(n.append(fn.decodeBase900toBase10(i,g)),g=0)}return t}static decodeBase900toBase10(e,t){let n=yn(0);for(let r=0;r<t;r++)n+=fn.EXP900[t-r-1]*yn(e[r]);let g=n.toString();if("1"!==g.charAt(0))throw new S;return g.substring(1)}}fn.TEXT_COMPACTION_MODE_LATCH=900,fn.BYTE_COMPACTION_MODE_LATCH=901,fn.NUMERIC_COMPACTION_MODE_LATCH=902,fn.BYTE_COMPACTION_MODE_LATCH_6=924,fn.ECI_USER_DEFINED=925,fn.ECI_GENERAL_PURPOSE=926,fn.ECI_CHARSET=927,fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,fn.MACRO_PDF417_TERMINATOR=922,fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,fn.MAX_NUMERIC_CODEWORDS=15,fn.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,fn.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,fn.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,fn.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,fn.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,fn.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,fn.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,fn.PL=25,fn.LL=27,fn.AS=27,fn.ML=28,fn.AL=28,fn.PS=29,fn.PAL=29,fn.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",fn.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",fn.EXP900=bn()?Zn():[],fn.NUMBER_OF_SEQUENCE_CODEWORDS=2;class Gn{constructor(){}static decode(e,t,n,g,r,i,o){let s,a=new nn(e,t,n,g,r),I=null,l=null;for(let d=!0;;d=!1){if(null!=t&&(I=Gn.getRowIndicatorColumn(e,a,t,!0,i,o)),null!=g&&(l=Gn.getRowIndicatorColumn(e,a,g,!1,i,o)),s=Gn.merge(I,l),null==s)throw X.getNotFoundInstance();let n=s.getBoundingBox();if(!d||null==n||!(n.getMinY()<a.getMinY()||n.getMaxY()>a.getMaxY()))break;a=n}s.setBoundingBox(a);let C=s.getBarcodeColumnCount()+1;s.setDetectionResultColumn(0,I),s.setDetectionResultColumn(C,l);let c=null!=I;for(let d=1;d<=C;d++){let t,n=c?d:C-d;if(void 0!==s.getDetectionResultColumn(n))continue;t=0===n||n===C?new an(a,0===n):new on(a),s.setDetectionResultColumn(n,t);let g=-1,r=g;for(let I=a.getMinY();I<=a.getMaxY();I++){if(g=Gn.getStartColumn(s,n,I,c),g<0||g>a.getMaxX()){if(-1===r)continue;g=r}let l=Gn.detectCodeword(e,a.getMinX(),a.getMaxX(),c,g,I,i,o);null!=l&&(t.setCodeword(I,l),r=g,i=Math.min(i,l.getWidth()),o=Math.max(o,l.getWidth()))}}return Gn.createDecoderResult(s)}static merge(e,t){if(null==e&&null==t)return null;let n=Gn.getBarcodeMetadata(e,t);if(null==n)return null;let g=nn.merge(Gn.adjustBoundingBox(e),Gn.adjustBoundingBox(t));return new In(n,g)}static adjustBoundingBox(e){if(null==e)return null;let t=e.getRowHeights();if(null==t)return null;let n=Gn.getMax(t),g=0;for(let o of t)if(g+=n-o,o>0)break;let r=e.getCodewords();for(let o=0;g>0&&null==r[o];o++)g--;let i=0;for(let o=t.length-1;o>=0&&(i+=n-t[o],!(t[o]>0));o--);for(let o=r.length-1;i>0&&null==r[o];o--)i--;return e.getBoundingBox().addMissingRows(g,i,e.isLeft())}static getMax(e){let t=-1;for(let n of e)t=Math.max(t,n);return t}static getBarcodeMetadata(e,t){let n,g;return null==e||null==(n=e.getBarcodeMetadata())?null==t?null:t.getBarcodeMetadata():null==t||null==(g=t.getBarcodeMetadata())?n:n.getColumnCount()!==g.getColumnCount()&&n.getErrorCorrectionLevel()!==g.getErrorCorrectionLevel()&&n.getRowCount()!==g.getRowCount()?null:n}static getRowIndicatorColumn(e,t,n,g,r,i){let o=new an(t,g);for(let s=0;s<2;s++){let a=0===s?1:-1,I=Math.trunc(Math.trunc(n.getX()));for(let s=Math.trunc(Math.trunc(n.getY()));s<=t.getMaxY()&&s>=t.getMinY();s+=a){let t=Gn.detectCodeword(e,0,e.getWidth(),g,I,s,r,i);null!=t&&(o.setCodeword(s,t),I=g?t.getStartX():t.getEndX())}}return o}static adjustCodewordCount(e,t){let n=t[0][1],g=n.getValue(),r=e.getBarcodeColumnCount()*e.getBarcodeRowCount()-Gn.getNumberOfECCodeWords(e.getBarcodeECLevel());if(0===g.length){if(r<1||r>jt.MAX_CODEWORDS_IN_BARCODE)throw X.getNotFoundInstance();n.setValue(r)}else g[0]!==r&&n.setValue(r)}static createDecoderResult(e){let t=Gn.createBarcodeMatrix(e);Gn.adjustCodewordCount(e,t);let n=new Array,g=new Int32Array(e.getBarcodeRowCount()*e.getBarcodeColumnCount()),r=[],i=new Array;for(let s=0;s<e.getBarcodeRowCount();s++)for(let o=0;o<e.getBarcodeColumnCount();o++){let a=t[s][o+1].getValue(),I=s*e.getBarcodeColumnCount()+o;0===a.length?n.push(I):1===a.length?g[I]=a[0]:(i.push(I),r.push(a))}let o=new Array(r.length);for(let s=0;s<o.length;s++)o[s]=r[s];return Gn.createDecoderResultFromAmbiguousValues(e.getBarcodeECLevel(),g,jt.toIntArray(n),jt.toIntArray(i),o)}static createDecoderResultFromAmbiguousValues(e,t,n,g,r){let i=new Int32Array(g.length),o=100;for(;o-- >0;){for(let e=0;e<i.length;e++)t[g[e]]=r[e][i[e]];try{return Gn.decodeCodewords(t,e,n)}catch(s){if(!(s instanceof u))throw s}if(0===i.length)throw u.getChecksumInstance();for(let e=0;e<i.length;e++){if(i[e]<r[e].length-1){i[e]++;break}if(i[e]=0,e===i.length-1)throw u.getChecksumInstance()}}throw u.getChecksumInstance()}static createBarcodeMatrix(e){let t=Array.from({length:e.getBarcodeRowCount()},(()=>new Array(e.getBarcodeColumnCount()+2)));for(let g=0;g<t.length;g++)for(let e=0;e<t[g].length;e++)t[g][e]=new sn;let n=0;for(let g of e.getDetectionResultColumns()){if(null!=g)for(let e of g.getCodewords())if(null!=e){let g=e.getRowNumber();if(g>=0){if(g>=t.length)continue;t[g][n].setValue(e.getValue())}}n++}return t}static isValidBarcodeColumn(e,t){return t>=0&&t<=e.getBarcodeColumnCount()+1}static getStartColumn(e,t,n,g){let r=g?1:-1,i=null;if(Gn.isValidBarcodeColumn(e,t-r)&&(i=e.getDetectionResultColumn(t-r).getCodeword(n)),null!=i)return g?i.getEndX():i.getStartX();if(i=e.getDetectionResultColumn(t).getCodewordNearby(n),null!=i)return g?i.getStartX():i.getEndX();if(Gn.isValidBarcodeColumn(e,t-r)&&(i=e.getDetectionResultColumn(t-r).getCodewordNearby(n)),null!=i)return g?i.getEndX():i.getStartX();let o=0;for(;Gn.isValidBarcodeColumn(e,t-r);){t-=r;for(let n of e.getDetectionResultColumn(t).getCodewords())if(null!=n)return(g?n.getEndX():n.getStartX())+r*o*(n.getEndX()-n.getStartX());o++}return g?e.getBoundingBox().getMinX():e.getBoundingBox().getMaxX()}static detectCodeword(e,t,n,g,r,i,o,s){r=Gn.adjustCodewordStartColumn(e,t,n,g,r,i);let a,I=Gn.getModuleBitCount(e,t,n,g,r,i);if(null==I)return null;let l=ue.sum(I);if(g)a=r+l;else{for(let e=0;e<I.length/2;e++){let t=I[e];I[e]=I[I.length-1-e],I[I.length-1-e]=t}a=r,r=a-l}if(!Gn.checkCodewordSkew(l,o,s))return null;let C=Cn.getDecodedValue(I),c=jt.getCodeword(C);return-1===c?null:new ln(r,a,Gn.getCodewordBucketNumber(C),c)}static getModuleBitCount(e,t,n,g,r,i){let o=r,s=new Int32Array(8),a=0,I=g?1:-1,l=g;for(;(g?o<n:o>=t)&&a<s.length;)e.get(o,i)===l?(s[a]++,o+=I):(a++,l=!l);return a===s.length||o===(g?n:t)&&a===s.length-1?s:null}static getNumberOfECCodeWords(e){return 2<<e}static adjustCodewordStartColumn(e,t,n,g,r,i){let o=r,s=g?-1:1;for(let a=0;a<2;a++){for(;(g?o>=t:o<n)&&g===e.get(o,i);){if(Math.abs(r-o)>Gn.CODEWORD_SKEW_SIZE)return r;o+=s}s=-s,g=!g}return o}static checkCodewordSkew(e,t,n){return t-Gn.CODEWORD_SKEW_SIZE<=e&&e<=n+Gn.CODEWORD_SKEW_SIZE}static decodeCodewords(e,t,n){if(0===e.length)throw S.getFormatInstance();let g=1<<t+1,r=Gn.correctErrors(e,n,g);Gn.verifyCodewordCount(e,g);let i=fn.decode(e,""+t);return i.setErrorsCorrected(r),i.setErasures(n.length),i}static correctErrors(e,t,n){if(null!=t&&t.length>n/2+Gn.MAX_ERRORS||n<0||n>Gn.MAX_EC_CODEWORDS)throw u.getChecksumInstance();return Gn.errorCorrection.decode(e,n,t)}static verifyCodewordCount(e,t){if(e.length<4)throw S.getFormatInstance();let n=e[0];if(n>e.length)throw S.getFormatInstance();if(0===n){if(!(t<e.length))throw S.getFormatInstance();e[0]=e.length-t}}static getBitCountForCodeword(e){let t=new Int32Array(8),n=0,g=t.length-1;for(;!((1&e)!==n&&(n=1&e,g--,g<0));)t[g]++,e>>=1;return t}static getCodewordBucketNumber(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)}static getCodewordBucketNumber_number(e){return Gn.getCodewordBucketNumber(Gn.getBitCountForCodeword(e))}static getCodewordBucketNumber_Int32Array(e){return(e[0]-e[2]+e[4]-e[6]+9)%9}static toString(e){let t=new rn;for(let n=0;n<e.length;n++){t.format("Row %2d: ",n);for(let g=0;g<e[n].length;g++){let r=e[n][g];0===r.getValue().length?t.format("        ",null):t.format("%4d(%2d)",r.getValue()[0],r.getConfidence(r.getValue()[0]))}t.format("%n")}return t.toString()}}Gn.CODEWORD_SKEW_SIZE=2,Gn.MAX_ERRORS=3,Gn.MAX_EC_CODEWORDS=512,Gn.errorCorrection=new tn;class Bn{decode(e,t=null){let n=Bn.decode(e,t,!1);if(null==n||0===n.length||null==n[0])throw X.getNotFoundInstance();return n[0]}decodeMultiple(e,t=null){try{return Bn.decode(e,t,!0)}catch(n){if(n instanceof S||n instanceof u)throw X.getNotFoundInstance();throw n}}static decode(e,t,n){const g=new Array,r=_t.detectMultiple(e,t,n);for(const i of r.getPoints()){const e=Gn.decode(r.getBits(),i[4],i[5],i[6],i[7],Bn.getMinCodewordWidth(i),Bn.getMaxCodewordWidth(i)),t=new D(e.getText(),e.getRawBytes(),void 0,i,z.PDF_417);t.putMetadata(re.ERROR_CORRECTION_LEVEL,e.getECLevel());const n=e.getOther();null!=n&&t.putMetadata(re.PDF417_EXTRA_METADATA,n),g.push(t)}return g.map((e=>e))}static getMaxWidth(e,t){return null==e||null==t?0:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMinWidth(e,t){return null==e||null==t?y.MAX_VALUE:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMaxCodewordWidth(e){return Math.floor(Math.max(Math.max(Bn.getMaxWidth(e[0],e[4]),Bn.getMaxWidth(e[6],e[2])*jt.MODULES_IN_CODEWORD/jt.MODULES_IN_STOP_PATTERN),Math.max(Bn.getMaxWidth(e[1],e[5]),Bn.getMaxWidth(e[7],e[3])*jt.MODULES_IN_CODEWORD/jt.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(e){return Math.floor(Math.min(Math.min(Bn.getMinWidth(e[0],e[4]),Bn.getMinWidth(e[6],e[2])*jt.MODULES_IN_CODEWORD/jt.MODULES_IN_STOP_PATTERN),Math.min(Bn.getMinWidth(e[1],e[5]),Bn.getMinWidth(e[7],e[3])*jt.MODULES_IN_CODEWORD/jt.MODULES_IN_STOP_PATTERN)))}reset(){}}class Sn extends l{}Sn.kind="ReaderException";class Rn{constructor(e,t){this.verbose=!0===e,t&&this.setHints(t)}decode(e,t){return t&&this.setHints(t),this.decodeInternal(e)}decodeWithState(e){return null!==this.readers&&void 0!==this.readers||this.setHints(null),this.decodeInternal(e)}setHints(e){this.hints=e;const n=!t(e)&&!0===e.get(B.TRY_HARDER),g=t(e)?null:e.get(B.POSSIBLE_FORMATS),r=new Array;if(!t(g)){const t=g.some((e=>e===z.UPC_A||e===z.UPC_E||e===z.EAN_13||e===z.EAN_8||e===z.CODABAR||e===z.CODE_39||e===z.CODE_93||e===z.CODE_128||e===z.ITF||e===z.RSS_14||e===z.RSS_EXPANDED));t&&!n&&r.push(new mt(e,this.verbose)),g.includes(z.QR_CODE)&&r.push(new Ot),g.includes(z.DATA_MATRIX)&&r.push(new Vt),g.includes(z.AZTEC)&&r.push(new Re),g.includes(z.PDF_417)&&r.push(new Bn),t&&n&&r.push(new mt(e,this.verbose))}0===r.length&&(n||r.push(new mt(e,this.verbose)),r.push(new Ot),r.push(new Vt),r.push(new Re),r.push(new Bn),n&&r.push(new mt(e,this.verbose))),this.readers=r}reset(){if(null!==this.readers)for(const e of this.readers)e.reset()}decodeInternal(e){if(null===this.readers)throw new Sn("No readers where selected, nothing can be read.");for(const n of this.readers)try{return n.decode(e,this.hints)}catch(t){if(t instanceof Sn)continue}throw new X("No MultiFormat Readers were able to detect the code.")}}class vn extends M{constructor(e=null,t=500){const n=new Rn;n.setHints(e),super(n,t)}decodeBitmap(e){return this.reader.decodeWithState(e)}}class Vn extends M{constructor(e=500){super(new Bn,e)}}class wn extends M{constructor(e=500){super(new Ot,e)}}var Wn,kn;(kn=Wn||(Wn={}))[kn.ERROR_CORRECTION=0]="ERROR_CORRECTION",kn[kn.CHARACTER_SET=1]="CHARACTER_SET",kn[kn.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",kn[kn.MIN_SIZE=3]="MIN_SIZE",kn[kn.MAX_SIZE=4]="MAX_SIZE",kn[kn.MARGIN=5]="MARGIN",kn[kn.PDF417_COMPACT=6]="PDF417_COMPACT",kn[kn.PDF417_COMPACTION=7]="PDF417_COMPACTION",kn[kn.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",kn[kn.AZTEC_LAYERS=9]="AZTEC_LAYERS",kn[kn.QR_VERSION=10]="QR_VERSION";var Xn=Wn;class Nn{constructor(e){this.field=e,this.cachedGenerators=[],this.cachedGenerators.push(new se(e,Int32Array.from([1])))}buildGenerator(e){const t=this.cachedGenerators;if(e>=t.length){let n=t[t.length-1];const g=this.field;for(let r=t.length;r<=e;r++){const e=n.multiply(new se(g,Int32Array.from([1,g.exp(r-1+g.getGeneratorBase())])));t.push(e),n=e}}return t[e]}encode(e,t){if(0===t)throw new c("No error correction bytes");const n=e.length-t;if(n<=0)throw new c("No data bytes provided");const g=this.buildGenerator(t),r=new Int32Array(n);h.arraycopy(e,0,r,0,n);let i=new se(this.field,r);i=i.multiplyByMonomial(t,1);const o=i.divide(g)[1].getCoefficients(),s=t-o.length;for(let a=0;a<s;a++)e[n+a]=0;h.arraycopy(o,0,e,n+s,o.length)}}class Jn{constructor(){}static applyMaskPenaltyRule1(e){return Jn.applyMaskPenaltyRule1Internal(e,!0)+Jn.applyMaskPenaltyRule1Internal(e,!1)}static applyMaskPenaltyRule2(e){let t=0;const n=e.getArray(),g=e.getWidth(),r=e.getHeight();for(let i=0;i<r-1;i++){const e=n[i];for(let r=0;r<g-1;r++){const g=e[r];g===e[r+1]&&g===n[i+1][r]&&g===n[i+1][r+1]&&t++}}return Jn.N2*t}static applyMaskPenaltyRule3(e){let t=0;const n=e.getArray(),g=e.getWidth(),r=e.getHeight();for(let i=0;i<r;i++)for(let e=0;e<g;e++){const o=n[i];e+6<g&&1===o[e]&&0===o[e+1]&&1===o[e+2]&&1===o[e+3]&&1===o[e+4]&&0===o[e+5]&&1===o[e+6]&&(Jn.isWhiteHorizontal(o,e-4,e)||Jn.isWhiteHorizontal(o,e+7,e+11))&&t++,i+6<r&&1===n[i][e]&&0===n[i+1][e]&&1===n[i+2][e]&&1===n[i+3][e]&&1===n[i+4][e]&&0===n[i+5][e]&&1===n[i+6][e]&&(Jn.isWhiteVertical(n,e,i-4,i)||Jn.isWhiteVertical(n,e,i+7,i+11))&&t++}return t*Jn.N3}static isWhiteHorizontal(e,t,n){t=Math.max(t,0),n=Math.min(n,e.length);for(let g=t;g<n;g++)if(1===e[g])return!1;return!0}static isWhiteVertical(e,t,n,g){n=Math.max(n,0),g=Math.min(g,e.length);for(let r=n;r<g;r++)if(1===e[r][t])return!1;return!0}static applyMaskPenaltyRule4(e){let t=0;const n=e.getArray(),g=e.getWidth(),r=e.getHeight();for(let o=0;o<r;o++){const e=n[o];for(let n=0;n<g;n++)1===e[n]&&t++}const i=e.getHeight()*e.getWidth();return Math.floor(10*Math.abs(2*t-i)/i)*Jn.N4}static getDataMaskBit(e,t,n){let g,r;switch(e){case 0:g=n+t&1;break;case 1:g=1&n;break;case 2:g=t%3;break;case 3:g=(n+t)%3;break;case 4:g=Math.floor(n/2)+Math.floor(t/3)&1;break;case 5:r=n*t,g=(1&r)+r%3;break;case 6:r=n*t,g=(1&r)+r%3&1;break;case 7:r=n*t,g=r%3+(n+t&1)&1;break;default:throw new c("Invalid mask pattern: "+e)}return 0===g}static applyMaskPenaltyRule1Internal(e,t){let n=0;const g=t?e.getHeight():e.getWidth(),r=t?e.getWidth():e.getHeight(),i=e.getArray();for(let o=0;o<g;o++){let e=0,g=-1;for(let s=0;s<r;s++){const r=t?i[o][s]:i[s][o];r===g?e++:(e>=5&&(n+=Jn.N1+(e-5)),e=1,g=r)}e>=5&&(n+=Jn.N1+(e-5))}return n}}Jn.N1=3,Jn.N2=3,Jn.N3=40,Jn.N4=10;class Yn{constructor(e,t){this.width=e,this.height=t;const n=new Array(t);for(let g=0;g!==t;g++)n[g]=new Uint8Array(e);this.bytes=n}getHeight(){return this.height}getWidth(){return this.width}get(e,t){return this.bytes[t][e]}getArray(){return this.bytes}setNumber(e,t,n){this.bytes[t][e]=n}setBoolean(e,t,n){this.bytes[t][e]=n?1:0}clear(e){for(const t of this.bytes)p.fill(t,e)}equals(e){if(!(e instanceof Yn))return!1;const t=e;if(this.width!==t.width)return!1;if(this.height!==t.height)return!1;for(let n=0,g=this.height;n<g;++n){const e=this.bytes[n],g=t.bytes[n];for(let t=0,n=this.width;t<n;++t)if(e[t]!==g[t])return!1}return!0}toString(){const e=new W;for(let t=0,n=this.height;t<n;++t){const n=this.bytes[t];for(let t=0,g=this.width;t<g;++t)switch(n[t]){case 0:e.append(" 0");break;case 1:e.append(" 1");break;default:e.append("  ")}e.append("\n")}return e.toString()}}class En{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const e=new W;return e.append("<<\n"),e.append(" mode: "),e.append(this.mode?this.mode.toString():"null"),e.append("\n ecLevel: "),e.append(this.ecLevel?this.ecLevel.toString():"null"),e.append("\n version: "),e.append(this.version?this.version.toString():"null"),e.append("\n maskPattern: "),e.append(this.maskPattern.toString()),this.matrix?(e.append("\n matrix:\n"),e.append(this.matrix.toString())):e.append("\n matrix: null\n"),e.append(">>\n"),e.toString()}setMode(e){this.mode=e}setECLevel(e){this.ecLevel=e}setVersion(e){this.version=e}setMaskPattern(e){this.maskPattern=e}setMatrix(e){this.matrix=e}static isValidMaskPattern(e){return e>=0&&e<En.NUM_MASK_PATTERNS}}En.NUM_MASK_PATTERNS=8;class Hn extends l{}Hn.kind="WriterException";class Fn{constructor(){}static clearMatrix(e){e.clear(255)}static buildMatrix(e,t,n,g,r){Fn.clearMatrix(r),Fn.embedBasicPatterns(n,r),Fn.embedTypeInfo(t,g,r),Fn.maybeEmbedVersionInfo(n,r),Fn.embedDataBits(e,g,r)}static embedBasicPatterns(e,t){Fn.embedPositionDetectionPatternsAndSeparators(t),Fn.embedDarkDotAtLeftBottomCorner(t),Fn.maybeEmbedPositionAdjustmentPatterns(e,t),Fn.embedTimingPatterns(t)}static embedTypeInfo(e,t,n){const g=new Z;Fn.makeTypeInfoBits(e,t,g);for(let r=0,i=g.getSize();r<i;++r){const e=g.get(g.getSize()-1-r),t=Fn.TYPE_INFO_COORDINATES[r],i=t[0],o=t[1];if(n.setBoolean(i,o,e),r<8){const t=n.getWidth()-r-1,g=8;n.setBoolean(t,g,e)}else{const t=8,g=n.getHeight()-7+(r-8);n.setBoolean(t,g,e)}}}static maybeEmbedVersionInfo(e,t){if(e.getVersionNumber()<7)return;const n=new Z;Fn.makeVersionInfoBits(e,n);let g=17;for(let r=0;r<6;++r)for(let e=0;e<3;++e){const i=n.get(g);g--,t.setBoolean(r,t.getHeight()-11+e,i),t.setBoolean(t.getHeight()-11+e,r,i)}}static embedDataBits(e,t,n){let g=0,r=-1,i=n.getWidth()-1,o=n.getHeight()-1;for(;i>0;){for(6===i&&(i-=1);o>=0&&o<n.getHeight();){for(let r=0;r<2;++r){const s=i-r;if(!Fn.isEmpty(n.get(s,o)))continue;let a;g<e.getSize()?(a=e.get(g),++g):a=!1,255!==t&&Jn.getDataMaskBit(t,s,o)&&(a=!a),n.setBoolean(s,o,a)}o+=r}r=-r,o+=r,i-=2}if(g!==e.getSize())throw new Hn("Not all bits consumed: "+g+"/"+e.getSize())}static findMSBSet(e){return 32-y.numberOfLeadingZeros(e)}static calculateBCHCode(e,t){if(0===t)throw new c("0 polynomial");const n=Fn.findMSBSet(t);for(e<<=n-1;Fn.findMSBSet(e)>=n;)e^=t<<Fn.findMSBSet(e)-n;return e}static makeTypeInfoBits(e,t,n){if(!En.isValidMaskPattern(t))throw new Hn("Invalid mask pattern");const g=e.getBits()<<3|t;n.appendBits(g,5);const r=Fn.calculateBCHCode(g,Fn.TYPE_INFO_POLY);n.appendBits(r,10);const i=new Z;if(i.appendBits(Fn.TYPE_INFO_MASK_PATTERN,15),n.xor(i),15!==n.getSize())throw new Hn("should not happen but we got: "+n.getSize())}static makeVersionInfoBits(e,t){t.appendBits(e.getVersionNumber(),6);const n=Fn.calculateBCHCode(e.getVersionNumber(),Fn.VERSION_INFO_POLY);if(t.appendBits(n,12),18!==t.getSize())throw new Hn("should not happen but we got: "+t.getSize())}static isEmpty(e){return 255===e}static embedTimingPatterns(e){for(let t=8;t<e.getWidth()-8;++t){const n=(t+1)%2;Fn.isEmpty(e.get(t,6))&&e.setNumber(t,6,n),Fn.isEmpty(e.get(6,t))&&e.setNumber(6,t,n)}}static embedDarkDotAtLeftBottomCorner(e){if(0===e.get(8,e.getHeight()-8))throw new Hn;e.setNumber(8,e.getHeight()-8,1)}static embedHorizontalSeparationPattern(e,t,n){for(let g=0;g<8;++g){if(!Fn.isEmpty(n.get(e+g,t)))throw new Hn;n.setNumber(e+g,t,0)}}static embedVerticalSeparationPattern(e,t,n){for(let g=0;g<7;++g){if(!Fn.isEmpty(n.get(e,t+g)))throw new Hn;n.setNumber(e,t+g,0)}}static embedPositionAdjustmentPattern(e,t,n){for(let g=0;g<5;++g){const r=Fn.POSITION_ADJUSTMENT_PATTERN[g];for(let i=0;i<5;++i)n.setNumber(e+i,t+g,r[i])}}static embedPositionDetectionPattern(e,t,n){for(let g=0;g<7;++g){const r=Fn.POSITION_DETECTION_PATTERN[g];for(let i=0;i<7;++i)n.setNumber(e+i,t+g,r[i])}}static embedPositionDetectionPatternsAndSeparators(e){const t=Fn.POSITION_DETECTION_PATTERN[0].length;Fn.embedPositionDetectionPattern(0,0,e),Fn.embedPositionDetectionPattern(e.getWidth()-t,0,e),Fn.embedPositionDetectionPattern(0,e.getWidth()-t,e);const n=8;Fn.embedHorizontalSeparationPattern(0,n-1,e),Fn.embedHorizontalSeparationPattern(e.getWidth()-n,n-1,e),Fn.embedHorizontalSeparationPattern(0,e.getWidth()-n,e);const g=7;Fn.embedVerticalSeparationPattern(g,0,e),Fn.embedVerticalSeparationPattern(e.getHeight()-g-1,0,e),Fn.embedVerticalSeparationPattern(g,e.getHeight()-g,e)}static maybeEmbedPositionAdjustmentPatterns(e,t){if(e.getVersionNumber()<2)return;const n=e.getVersionNumber()-1,g=Fn.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[n];for(let r=0,i=g.length;r!==i;r++){const e=g[r];if(e>=0)for(let n=0;n!==i;n++){const r=g[n];r>=0&&Fn.isEmpty(t.get(r,e))&&Fn.embedPositionAdjustmentPattern(r-2,e-2,t)}}}}Fn.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),Fn.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),Fn.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),Fn.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),Fn.VERSION_INFO_POLY=7973,Fn.TYPE_INFO_POLY=1335,Fn.TYPE_INFO_MASK_PATTERN=21522;class xn{constructor(e,t){this.dataBytes=e,this.errorCorrectionBytes=t}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Tn{constructor(){}static calculateMaskPenalty(e){return Jn.applyMaskPenaltyRule1(e)+Jn.applyMaskPenaltyRule2(e)+Jn.applyMaskPenaltyRule3(e)+Jn.applyMaskPenaltyRule4(e)}static encode(e,t,n=null){let g=Tn.DEFAULT_BYTE_MODE_ENCODING;const r=null!==n&&void 0!==n.get(Xn.CHARACTER_SET);r&&(g=n.get(Xn.CHARACTER_SET).toString());const i=this.chooseMode(e,g),o=new Z;if(i===Ft.BYTE&&(r||Tn.DEFAULT_BYTE_MODE_ENCODING!==g)){const e=R.getCharacterSetECIByName(g);void 0!==e&&this.appendECI(e,o)}this.appendModeInfo(i,o);const s=new Z;let a;if(this.appendBytes(e,i,s,g),null!==n&&void 0!==n.get(Xn.QR_VERSION)){const e=Number.parseInt(n.get(Xn.QR_VERSION).toString(),10);a=Jt.getVersionForNumber(e);const g=this.calculateBitsNeeded(i,o,s,a);if(!this.willFit(g,a,t))throw new Hn("Data too big for requested version")}else a=this.recommendVersion(t,i,o,s);const I=new Z;I.appendBitArray(o);const l=i===Ft.BYTE?s.getSizeInBytes():e.length;this.appendLengthInfo(l,a,i,I),I.appendBitArray(s);const C=a.getECBlocksForLevel(t),c=a.getTotalCodewords()-C.getTotalECCodewords();this.terminateBits(c,I);const d=this.interleaveWithECBytes(I,a.getTotalCodewords(),c,C.getNumBlocks()),u=new En;u.setECLevel(t),u.setMode(i),u.setVersion(a);const A=a.getDimensionForVersion(),h=new Yn(A,A),m=this.chooseMaskPattern(d,t,a,h);return u.setMaskPattern(m),Fn.buildMatrix(d,t,a,m,h),u.setMatrix(h),u}static recommendVersion(e,t,n,g){const r=this.calculateBitsNeeded(t,n,g,Jt.getVersionForNumber(1)),i=this.chooseVersion(r,e),o=this.calculateBitsNeeded(t,n,g,i);return this.chooseVersion(o,e)}static calculateBitsNeeded(e,t,n,g){return t.getSize()+e.getCharacterCountBits(g)+n.getSize()}static getAlphanumericCode(e){return e<Tn.ALPHANUMERIC_TABLE.length?Tn.ALPHANUMERIC_TABLE[e]:-1}static chooseMode(e,t=null){if(R.SJIS.getName()===t&&this.isOnlyDoubleByteKanji(e))return Ft.KANJI;let n=!1,g=!1;for(let r=0,i=e.length;r<i;++r){const t=e.charAt(r);if(Tn.isDigit(t))n=!0;else{if(-1===this.getAlphanumericCode(t.charCodeAt(0)))return Ft.BYTE;g=!0}}return g?Ft.ALPHANUMERIC:n?Ft.NUMERIC:Ft.BYTE}static isOnlyDoubleByteKanji(e){let t;try{t=V.encode(e,R.SJIS)}catch(g){return!1}const n=t.length;if(n%2!=0)return!1;for(let r=0;r<n;r+=2){const e=255&t[r];if((e<129||e>159)&&(e<224||e>235))return!1}return!0}static chooseMaskPattern(e,t,n,g){let r=Number.MAX_SAFE_INTEGER,i=-1;for(let o=0;o<En.NUM_MASK_PATTERNS;o++){Fn.buildMatrix(e,t,n,o,g);let s=this.calculateMaskPenalty(g);s<r&&(r=s,i=o)}return i}static chooseVersion(e,t){for(let n=1;n<=40;n++){const g=Jt.getVersionForNumber(n);if(Tn.willFit(e,g,t))return g}throw new Hn("Data too big")}static willFit(e,t,n){return t.getTotalCodewords()-t.getECBlocksForLevel(n).getTotalECCodewords()>=(e+7)/8}static terminateBits(e,t){const n=8*e;if(t.getSize()>n)throw new Hn("data bits cannot fit in the QR Code"+t.getSize()+" > "+n);for(let i=0;i<4&&t.getSize()<n;++i)t.appendBit(!1);const g=7&t.getSize();if(g>0)for(let i=g;i<8;i++)t.appendBit(!1);const r=e-t.getSizeInBytes();for(let i=0;i<r;++i)t.appendBits(1&i?17:236,8);if(t.getSize()!==n)throw new Hn("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(e,t,n,g,r,i){if(g>=n)throw new Hn("Block ID too large");const o=e%n,s=n-o,a=Math.floor(e/n),I=a+1,l=Math.floor(t/n),C=l+1,c=a-l,d=I-C;if(c!==d)throw new Hn("EC bytes mismatch");if(n!==s+o)throw new Hn("RS blocks mismatch");if(e!==(l+c)*s+(C+d)*o)throw new Hn("Total bytes mismatch");g<s?(r[0]=l,i[0]=c):(r[0]=C,i[0]=d)}static interleaveWithECBytes(e,t,n,g){if(e.getSizeInBytes()!==n)throw new Hn("Number of bits and data bytes does not match");let r=0,i=0,o=0;const s=new Array;for(let I=0;I<g;++I){const a=new Int32Array(1),l=new Int32Array(1);Tn.getNumDataBytesAndNumECBytesForBlockID(t,n,g,I,a,l);const C=a[0],c=new Uint8Array(C);e.toBytes(8*r,c,0,C);const d=Tn.generateECBytes(c,l[0]);s.push(new xn(c,d)),i=Math.max(i,C),o=Math.max(o,d.length),r+=a[0]}if(n!==r)throw new Hn("Data bytes does not match offset");const a=new Z;for(let I=0;I<i;++I)for(const e of s){const t=e.getDataBytes();I<t.length&&a.appendBits(t[I],8)}for(let I=0;I<o;++I)for(const e of s){const t=e.getErrorCorrectionBytes();I<t.length&&a.appendBits(t[I],8)}if(t!==a.getSizeInBytes())throw new Hn("Interleaving error: "+t+" and "+a.getSizeInBytes()+" differ.");return a}static generateECBytes(e,t){const n=e.length,g=new Int32Array(n+t);for(let i=0;i<n;i++)g[i]=255&e[i];new Nn(Ie.QR_CODE_FIELD_256).encode(g,t);const r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=g[n+i];return r}static appendModeInfo(e,t){t.appendBits(e.getBits(),4)}static appendLengthInfo(e,t,n,g){const r=n.getCharacterCountBits(t);if(e>=1<<r)throw new Hn(e+" is bigger than "+((1<<r)-1));g.appendBits(e,r)}static appendBytes(e,t,n,g){switch(t){case Ft.NUMERIC:Tn.appendNumericBytes(e,n);break;case Ft.ALPHANUMERIC:Tn.appendAlphanumericBytes(e,n);break;case Ft.BYTE:Tn.append8BitBytes(e,n,g);break;case Ft.KANJI:Tn.appendKanjiBytes(e,n);break;default:throw new Hn("Invalid mode: "+t)}}static getDigit(e){return e.charCodeAt(0)-48}static isDigit(e){const t=Tn.getDigit(e);return t>=0&&t<=9}static appendNumericBytes(e,t){const n=e.length;let g=0;for(;g<n;){const r=Tn.getDigit(e.charAt(g));if(g+2<n){const n=Tn.getDigit(e.charAt(g+1)),i=Tn.getDigit(e.charAt(g+2));t.appendBits(100*r+10*n+i,10),g+=3}else if(g+1<n){const n=Tn.getDigit(e.charAt(g+1));t.appendBits(10*r+n,7),g+=2}else t.appendBits(r,4),g++}}static appendAlphanumericBytes(e,t){const n=e.length;let g=0;for(;g<n;){const r=Tn.getAlphanumericCode(e.charCodeAt(g));if(-1===r)throw new Hn;if(g+1<n){const n=Tn.getAlphanumericCode(e.charCodeAt(g+1));if(-1===n)throw new Hn;t.appendBits(45*r+n,11),g+=2}else t.appendBits(r,6),g++}}static append8BitBytes(e,t,n){let g;try{g=V.encode(e,n)}catch(r){throw new Hn(r)}for(let i=0,o=g.length;i!==o;i++){const e=g[i];t.appendBits(e,8)}}static appendKanjiBytes(e,t){let n;try{n=V.encode(e,R.SJIS)}catch(r){throw new Hn(r)}const g=n.length;for(let i=0;i<g;i+=2){const e=(255&n[i])<<8&4294967295|255&n[i+1];let g=-1;if(e>=33088&&e<=40956?g=e-33088:e>=57408&&e<=60351&&(g=e-49472),-1===g)throw new Hn("Invalid byte sequence");const r=192*(g>>8)+(255&g);t.appendBits(r,13)}}static appendECI(e,t){t.appendBits(Ft.ECI.getBits(),4),t.appendBits(e.getValue(),8)}}Tn.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Tn.DEFAULT_BYTE_MODE_ENCODING=R.UTF8.getName();class Kn{write(e,t,n,g=null){if(0===e.length)throw new c("Found empty contents");if(t<0||n<0)throw new c("Requested dimensions are too small: "+t+"x"+n);let r=Wt.L,i=Kn.QUIET_ZONE_SIZE;null!==g&&(void 0!==g.get(Xn.ERROR_CORRECTION)&&(r=Wt.fromString(g.get(Xn.ERROR_CORRECTION).toString())),void 0!==g.get(Xn.MARGIN)&&(i=Number.parseInt(g.get(Xn.MARGIN).toString(),10)));const o=Tn.encode(e,r,g);return this.renderResult(o,t,n,i)}writeToDom(e,t,n,g,r=null){"string"==typeof e&&(e=document.querySelector(e));const i=this.write(t,n,g,r);e&&e.appendChild(i)}renderResult(e,t,n,g){const r=e.getMatrix();if(null===r)throw new Ce;const i=r.getWidth(),o=r.getHeight(),s=i+2*g,a=o+2*g,I=Math.max(t,s),l=Math.max(n,a),C=Math.min(Math.floor(I/s),Math.floor(l/a)),c=Math.floor((I-i*C)/2),d=Math.floor((l-o*C)/2),u=this.createSVGElement(I,l);for(let A=0,h=d;A<o;A++,h+=C)for(let e=0,t=c;e<i;e++,t+=C)if(1===r.get(e,A)){const e=this.createSvgRectElement(t,h,C,C);u.appendChild(e)}return u}createSVGElement(e,t){const n=document.createElementNS(Kn.SVG_NS,"svg");return n.setAttributeNS(null,"height",e.toString()),n.setAttributeNS(null,"width",t.toString()),n}createSvgRectElement(e,t,n,g){const r=document.createElementNS(Kn.SVG_NS,"rect");return r.setAttributeNS(null,"x",e.toString()),r.setAttributeNS(null,"y",t.toString()),r.setAttributeNS(null,"height",n.toString()),r.setAttributeNS(null,"width",g.toString()),r.setAttributeNS(null,"fill","#000000"),r}}Kn.QUIET_ZONE_SIZE=4,Kn.SVG_NS="http://www.w3.org/2000/svg";class Mn{encode(e,t,n,g,r){if(0===e.length)throw new c("Found empty contents");if(t!==z.QR_CODE)throw new c("Can only encode QR_CODE, but got "+t);if(n<0||g<0)throw new c(`Requested dimensions are too small: ${n}x${g}`);let i=Wt.L,o=Mn.QUIET_ZONE_SIZE;null!==r&&(void 0!==r.get(Xn.ERROR_CORRECTION)&&(i=Wt.fromString(r.get(Xn.ERROR_CORRECTION).toString())),void 0!==r.get(Xn.MARGIN)&&(o=Number.parseInt(r.get(Xn.MARGIN).toString(),10)));const s=Tn.encode(e,i,r);return Mn.renderResult(s,n,g,o)}static renderResult(e,t,n,g){const r=e.getMatrix();if(null===r)throw new Ce;const i=r.getWidth(),o=r.getHeight(),s=i+2*g,a=o+2*g,I=Math.max(t,s),l=Math.max(n,a),C=Math.min(Math.floor(I/s),Math.floor(l/a)),c=Math.floor((I-i*C)/2),d=Math.floor((l-o*C)/2),u=new k(I,l);for(let A=0,h=d;A<o;A++,h+=C)for(let e=0,t=c;e<i;e++,t+=C)1===r.get(e,A)&&u.setRegion(t,h,C,C);return u}}Mn.QUIET_ZONE_SIZE=4;class Dn{encode(e,t,n,g,r){let i;if(t!==z.QR_CODE)throw new c("No encoder available for format "+t);return i=new Mn,i.encode(e,t,n,g,r)}}class Ln extends Y{constructor(e,t,n,g,r,i,o,s){if(super(i,o),this.yuvData=e,this.dataWidth=t,this.dataHeight=n,this.left=g,this.top=r,g+i>t||r+o>n)throw new c("Crop rectangle does not fit within image data.");s&&this.reverseHorizontal(i,o)}getRow(e,t){if(e<0||e>=this.getHeight())throw new c("Requested row is outside the image: "+e);const n=this.getWidth();(null==t||t.length<n)&&(t=new Uint8ClampedArray(n));const g=(e+this.top)*this.dataWidth+this.left;return h.arraycopy(this.yuvData,g,t,0,n),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.yuvData;const n=e*t,g=new Uint8ClampedArray(n);let r=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return h.arraycopy(this.yuvData,r,g,0,n),g;for(let i=0;i<t;i++){const t=i*e;h.arraycopy(this.yuvData,r,g,t,e),r+=this.dataWidth}return g}isCropSupported(){return!0}crop(e,t,n,g){return new Ln(this.yuvData,this.dataWidth,this.dataHeight,this.left+e,this.top+t,n,g,!1)}renderThumbnail(){const e=this.getWidth()/Ln.THUMBNAIL_SCALE_FACTOR,t=this.getHeight()/Ln.THUMBNAIL_SCALE_FACTOR,n=new Int32Array(e*t),g=this.yuvData;let r=this.top*this.dataWidth+this.left;for(let i=0;i<t;i++){const t=i*e;for(let i=0;i<e;i++){const e=255&g[r+i*Ln.THUMBNAIL_SCALE_FACTOR];n[t+i]=4278190080|65793*e}r+=this.dataWidth*Ln.THUMBNAIL_SCALE_FACTOR}return n}getThumbnailWidth(){return this.getWidth()/Ln.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/Ln.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(e,t){const n=this.yuvData;for(let g=0,r=this.top*this.dataWidth+this.left;g<t;g++,r+=this.dataWidth){const t=r+e/2;for(let g=r,i=r+e-1;g<t;g++,i--){const e=n[g];n[g]=n[i],n[i]=e}}}invert(){return new E(this)}}Ln.THUMBNAIL_SCALE_FACTOR=2;class Un extends Y{constructor(e,t,n,g,r,i,o){if(super(t,n),this.dataWidth=g,this.dataHeight=r,this.left=i,this.top=o,4===e.BYTES_PER_ELEMENT){const g=t*n,r=new Uint8ClampedArray(g);for(let t=0;t<g;t++){const n=e[t],g=n>>16&255,i=n>>7&510,o=255&n;r[t]=(g+i+o)/4&255}this.luminances=r}else this.luminances=e;if(void 0===g&&(this.dataWidth=t),void 0===r&&(this.dataHeight=n),void 0===i&&(this.left=0),void 0===o&&(this.top=0),this.left+t>this.dataWidth||this.top+n>this.dataHeight)throw new c("Crop rectangle does not fit within image data.")}getRow(e,t){if(e<0||e>=this.getHeight())throw new c("Requested row is outside the image: "+e);const n=this.getWidth();(null==t||t.length<n)&&(t=new Uint8ClampedArray(n));const g=(e+this.top)*this.dataWidth+this.left;return h.arraycopy(this.luminances,g,t,0,n),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.luminances;const n=e*t,g=new Uint8ClampedArray(n);let r=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return h.arraycopy(this.luminances,r,g,0,n),g;for(let i=0;i<t;i++){const t=i*e;h.arraycopy(this.luminances,r,g,t,e),r+=this.dataWidth}return g}isCropSupported(){return!0}crop(e,t,n,g){return new Un(this.luminances,n,g,this.dataWidth,this.dataHeight,this.left+e,this.top+t)}invert(){return new E(this)}}class zn extends R{static forName(e){return this.getCharacterSetECIByName(e)}}class Qn{}Qn.ISO_8859_1=R.ISO8859_1;class On{isCompact(){return this.compact}setCompact(e){this.compact=e}getSize(){return this.size}setSize(e){this.size=e}getLayers(){return this.layers}setLayers(e){this.layers=e}getCodeWords(){return this.codeWords}setCodeWords(e){this.codeWords=e}getMatrix(){return this.matrix}setMatrix(e){this.matrix=e}}class jn{static singletonList(e){return[e]}static min(e,t){return e.sort(t)[0]}}class Pn{constructor(e){this.previous=e}getPrevious(){return this.previous}}class _n extends Pn{constructor(e,t,n){super(e),this.value=t,this.bitCount=n}appendTo(e,t){e.appendBits(this.value,this.bitCount)}add(e,t){return new _n(this,e,t)}addBinaryShift(e,t){return new _n(this,e,t)}toString(){let e=this.value&(1<<this.bitCount)-1;return e|=1<<this.bitCount,"<"+y.toBinaryString(e|1<<this.bitCount).substring(1)+">"}}class qn extends _n{constructor(e,t,n){super(e,0,0),this.binaryShiftStart=t,this.binaryShiftByteCount=n}appendTo(e,t){for(let n=0;n<this.binaryShiftByteCount;n++)(0===n||31===n&&this.binaryShiftByteCount<=62)&&(e.appendBits(31,5),this.binaryShiftByteCount>62?e.appendBits(this.binaryShiftByteCount-31,16):0===n?e.appendBits(Math.min(this.binaryShiftByteCount,31),5):e.appendBits(this.binaryShiftByteCount-31,5)),e.appendBits(t[this.binaryShiftStart+n],8)}addBinaryShift(e,t){return new qn(this,e,t)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function $n(e,t,n){return new qn(e,t,n)}function eg(e,t,n){return new _n(e,t,n)}const tg=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],ng=0,gg=1,rg=2,ig=3,og=4,sg=new _n(null,0,0),ag=[Int32Array.from([0,327708,327710,327709,656318]),Int32Array.from([590318,0,327710,327709,656318]),Int32Array.from([262158,590300,0,590301,932798]),Int32Array.from([327709,327708,656318,0,327710]),Int32Array.from([327711,656380,656382,656381,0])];function Ig(e){for(let t of e)p.fill(t,-1);return e[ng][og]=0,e[gg][og]=0,e[gg][ng]=28,e[ig][og]=0,e[rg][og]=0,e[rg][ng]=15,e}const lg=Ig(p.createInt32Array(6,6));class Cg{constructor(e,t,n,g){this.token=e,this.mode=t,this.binaryShiftByteCount=n,this.bitCount=g}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(e,t){let n=this.bitCount,g=this.token;if(e!==this.mode){let t=ag[this.mode][e];g=eg(g,65535&t,t>>16),n+=t>>16}let r=e===rg?4:5;return g=eg(g,t,r),new Cg(g,e,0,n+r)}shiftAndAppend(e,t){let n=this.token,g=this.mode===rg?4:5;return n=eg(n,lg[this.mode][e],g),n=eg(n,t,5),new Cg(n,this.mode,0,this.bitCount+g+5)}addBinaryShiftChar(e){let t=this.token,n=this.mode,g=this.bitCount;if(this.mode===og||this.mode===rg){let e=ag[n][ng];t=eg(t,65535&e,e>>16),g+=e>>16,n=ng}let r=0===this.binaryShiftByteCount||31===this.binaryShiftByteCount?18:62===this.binaryShiftByteCount?9:8,i=new Cg(t,n,this.binaryShiftByteCount+1,g+r);return 2078===i.binaryShiftByteCount&&(i=i.endBinaryShift(e+1)),i}endBinaryShift(e){if(0===this.binaryShiftByteCount)return this;let t=this.token;return t=$n(t,e-this.binaryShiftByteCount,this.binaryShiftByteCount),new Cg(t,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(e){let t=this.bitCount+(ag[this.mode][e.mode]>>16);return this.binaryShiftByteCount<e.binaryShiftByteCount?t+=Cg.calculateBinaryShiftCost(e)-Cg.calculateBinaryShiftCost(this):this.binaryShiftByteCount>e.binaryShiftByteCount&&e.binaryShiftByteCount>0&&(t+=10),t<=e.bitCount}toBitArray(e){let t=[];for(let g=this.endBinaryShift(e.length).token;null!==g;g=g.getPrevious())t.unshift(g);let n=new Z;for(const g of t)g.appendTo(n,e);return n}toString(){return w.format("%s bits=%d bytes=%d",tg[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(e){return e.binaryShiftByteCount>62?21:e.binaryShiftByteCount>31?20:e.binaryShiftByteCount>0?10:0}}function cg(e){const t=w.getCharCode(" "),n=w.getCharCode("."),g=w.getCharCode(",");e[ng][t]=1;const r=w.getCharCode("Z"),i=w.getCharCode("A");for(let c=i;c<=r;c++)e[ng][c]=c-i+2;e[gg][t]=1;const o=w.getCharCode("z"),s=w.getCharCode("a");for(let c=s;c<=o;c++)e[gg][c]=c-s+2;e[rg][t]=1;const a=w.getCharCode("9"),I=w.getCharCode("0");for(let c=I;c<=a;c++)e[rg][c]=c-I+2;e[rg][g]=12,e[rg][n]=13;const l=["\0"," ","","","","","","","","\b","\t","\n","\v","\f","\r","","","","","","@","\\","^","_","`","|","~",""];for(let c=0;c<l.length;c++)e[ig][w.getCharCode(l[c])]=c;const C=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let c=0;c<C.length;c++)w.getCharCode(C[c])>0&&(e[og][w.getCharCode(C[c])]=c);return e}Cg.INITIAL_STATE=new Cg(sg,ng,0,0);const dg=cg(p.createInt32Array(5,256));class ug{constructor(e){this.text=e}encode(){const e=w.getCharCode(" "),t=w.getCharCode("\n");let n=jn.singletonList(Cg.INITIAL_STATE);for(let g=0;g<this.text.length;g++){let r,i=g+1<this.text.length?this.text[g+1]:0;switch(this.text[g]){case w.getCharCode("\r"):r=i===t?2:0;break;case w.getCharCode("."):r=i===e?3:0;break;case w.getCharCode(","):r=i===e?4:0;break;case w.getCharCode(":"):r=i===e?5:0;break;default:r=0}r>0?(n=ug.updateStateListForPair(n,g,r),g++):n=this.updateStateListForChar(n,g)}return jn.min(n,((e,t)=>e.getBitCount()-t.getBitCount())).toBitArray(this.text)}updateStateListForChar(e,t){const n=[];for(let g of e)this.updateStateForChar(g,t,n);return ug.simplifyStates(n)}updateStateForChar(e,t,n){let g=255&this.text[t],r=dg[e.getMode()][g]>0,i=null;for(let o=0;o<=og;o++){let s=dg[o][g];if(s>0){if(null==i&&(i=e.endBinaryShift(t)),!r||o===e.getMode()||o===rg){const e=i.latchAndAppend(o,s);n.push(e)}if(!r&&lg[e.getMode()][o]>=0){const e=i.shiftAndAppend(o,s);n.push(e)}}}if(e.getBinaryShiftByteCount()>0||0===dg[e.getMode()][g]){let g=e.addBinaryShiftChar(t);n.push(g)}}static updateStateListForPair(e,t,n){const g=[];for(let r of e)this.updateStateForPair(r,t,n,g);return this.simplifyStates(g)}static updateStateForPair(e,t,n,g){let r=e.endBinaryShift(t);if(g.push(r.latchAndAppend(og,n)),e.getMode()!==og&&g.push(r.shiftAndAppend(og,n)),3===n||4===n){let e=r.latchAndAppend(rg,16-n).latchAndAppend(rg,1);g.push(e)}if(e.getBinaryShiftByteCount()>0){let n=e.addBinaryShiftChar(t).addBinaryShiftChar(t+1);g.push(n)}}static simplifyStates(e){let t=[];for(const n of e){let e=!0;for(const g of t){if(g.isBetterThanOrEqualTo(n)){e=!1;break}n.isBetterThanOrEqualTo(g)&&(t=t.filter((e=>e!==g)))}e&&t.push(n)}return t}}class Ag{constructor(){}static encodeBytes(e){return Ag.encode(e,Ag.DEFAULT_EC_PERCENT,Ag.DEFAULT_AZTEC_LAYERS)}static encode(e,t,n){let g,r,i,o,s,a=new ug(e).encode(),I=y.truncDivision(a.getSize()*t,100)+11,l=a.getSize()+I;if(n!==Ag.DEFAULT_AZTEC_LAYERS){if(g=n<0,r=Math.abs(n),r>(g?Ag.MAX_NB_BITS_COMPACT:Ag.MAX_NB_BITS))throw new c(w.format("Illegal value %s for layers",n));i=Ag.totalBitsInLayer(r,g),o=Ag.WORD_SIZE[r];let e=i-i%o;if(s=Ag.stuffBits(a,o),s.getSize()+I>e)throw new c("Data to large for user specified layer");if(g&&s.getSize()>64*o)throw new c("Data to large for user specified layer")}else{o=0,s=null;for(let e=0;;e++){if(e>Ag.MAX_NB_BITS)throw new c("Data too large for an Aztec code");if(g=e<=3,r=g?e+1:e,i=Ag.totalBitsInLayer(r,g),l>i)continue;null!=s&&o===Ag.WORD_SIZE[r]||(o=Ag.WORD_SIZE[r],s=Ag.stuffBits(a,o));let t=i-i%o;if(!(g&&s.getSize()>64*o)&&s.getSize()+I<=t)break}}let C,d=Ag.generateCheckWords(s,i,o),u=s.getSize()/o,A=Ag.generateModeMessage(g,r,u),h=(g?11:14)+4*r,m=new Int32Array(h);if(g){C=h;for(let e=0;e<m.length;e++)m[e]=e}else{C=h+1+2*y.truncDivision(y.truncDivision(h,2)-1,15);let e=y.truncDivision(h,2),t=y.truncDivision(C,2);for(let n=0;n<e;n++){let g=n+y.truncDivision(n,15);m[e-n-1]=t-g-1,m[e+n]=t+g+1}}let b=new k(C);for(let c=0,y=0;c<r;c++){let e=4*(r-c)+(g?9:12);for(let t=0;t<e;t++){let n=2*t;for(let g=0;g<2;g++)d.get(y+n+g)&&b.set(m[2*c+g],m[2*c+t]),d.get(y+2*e+n+g)&&b.set(m[2*c+t],m[h-1-2*c-g]),d.get(y+4*e+n+g)&&b.set(m[h-1-2*c-g],m[h-1-2*c-t]),d.get(y+6*e+n+g)&&b.set(m[h-1-2*c-t],m[2*c+g])}y+=8*e}if(Ag.drawModeMessage(b,g,C,A),g)Ag.drawBullsEye(b,y.truncDivision(C,2),5);else{Ag.drawBullsEye(b,y.truncDivision(C,2),7);for(let e=0,t=0;e<y.truncDivision(h,2)-1;e+=15,t+=16)for(let n=1&y.truncDivision(C,2);n<C;n+=2)b.set(y.truncDivision(C,2)-t,n),b.set(y.truncDivision(C,2)+t,n),b.set(n,y.truncDivision(C,2)-t),b.set(n,y.truncDivision(C,2)+t)}let p=new On;return p.setCompact(g),p.setSize(C),p.setLayers(r),p.setCodeWords(u),p.setMatrix(b),p}static drawBullsEye(e,t,n){for(let g=0;g<n;g+=2)for(let n=t-g;n<=t+g;n++)e.set(n,t-g),e.set(n,t+g),e.set(t-g,n),e.set(t+g,n);e.set(t-n,t-n),e.set(t-n+1,t-n),e.set(t-n,t-n+1),e.set(t+n,t-n),e.set(t+n,t-n+1),e.set(t+n,t+n-1)}static generateModeMessage(e,t,n){let g=new Z;return e?(g.appendBits(t-1,2),g.appendBits(n-1,6),g=Ag.generateCheckWords(g,28,4)):(g.appendBits(t-1,5),g.appendBits(n-1,11),g=Ag.generateCheckWords(g,40,4)),g}static drawModeMessage(e,t,n,g){let r=y.truncDivision(n,2);if(t)for(let i=0;i<7;i++){let t=r-3+i;g.get(i)&&e.set(t,r-5),g.get(i+7)&&e.set(r+5,t),g.get(20-i)&&e.set(t,r+5),g.get(27-i)&&e.set(r-5,t)}else for(let i=0;i<10;i++){let t=r-5+i+y.truncDivision(i,5);g.get(i)&&e.set(t,r-7),g.get(i+10)&&e.set(r+7,t),g.get(29-i)&&e.set(t,r+7),g.get(39-i)&&e.set(r-7,t)}}static generateCheckWords(e,t,n){let g=e.getSize()/n,r=new Nn(Ag.getGF(n)),i=y.truncDivision(t,n),o=Ag.bitsToWords(e,n,i);r.encode(o,i-g);let s=t%n,a=new Z;a.appendBits(0,s);for(const I of Array.from(o))a.appendBits(I,n);return a}static bitsToWords(e,t,n){let g,r,i=new Int32Array(n);for(g=0,r=e.getSize()/t;g<r;g++){let n=0;for(let r=0;r<t;r++)n|=e.get(g*t+r)?1<<t-r-1:0;i[g]=n}return i}static getGF(e){switch(e){case 4:return Ie.AZTEC_PARAM;case 6:return Ie.AZTEC_DATA_6;case 8:return Ie.AZTEC_DATA_8;case 10:return Ie.AZTEC_DATA_10;case 12:return Ie.AZTEC_DATA_12;default:throw new c("Unsupported word size "+e)}}static stuffBits(e,t){let n=new Z,g=e.getSize(),r=(1<<t)-2;for(let i=0;i<g;i+=t){let o=0;for(let n=0;n<t;n++)(i+n>=g||e.get(i+n))&&(o|=1<<t-1-n);(o&r)===r?(n.appendBits(o&r,t),i--):o&r?n.appendBits(o,t):(n.appendBits(1|o,t),i--)}return n}static totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}Ag.DEFAULT_EC_PERCENT=33,Ag.DEFAULT_AZTEC_LAYERS=0,Ag.MAX_NB_BITS=32,Ag.MAX_NB_BITS_COMPACT=4,Ag.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class hg{encode(e,t,n,g){return this.encodeWithHints(e,t,n,g,null)}encodeWithHints(e,t,n,g,r){let i=Qn.ISO_8859_1,o=Ag.DEFAULT_EC_PERCENT,s=Ag.DEFAULT_AZTEC_LAYERS;return null!=r&&(r.has(Xn.CHARACTER_SET)&&(i=zn.forName(r.get(Xn.CHARACTER_SET).toString())),r.has(Xn.ERROR_CORRECTION)&&(o=y.parseInt(r.get(Xn.ERROR_CORRECTION).toString())),r.has(Xn.AZTEC_LAYERS)&&(s=y.parseInt(r.get(Xn.AZTEC_LAYERS).toString()))),hg.encodeLayers(e,t,n,g,i,o,s)}static encodeLayers(e,t,n,g,r,i,o){if(t!==z.AZTEC)throw new c("Can only encode AZTEC, but got "+t);let s=Ag.encode(w.getBytes(e,r),i,o);return hg.renderResult(s,n,g)}static renderResult(e,t,n){let g=e.getMatrix();if(null==g)throw new Ce;let r=g.getWidth(),i=g.getHeight(),o=Math.max(t,r),s=Math.max(n,i),a=Math.min(o/r,s/i),I=(o-r*a)/2,l=(s-i*a)/2,C=new k(o,s);for(let c=0,d=l;c<i;c++,d+=a)for(let e=0,t=I;e<r;e++,t+=a)g.get(e,c)&&C.setRegion(t,d,a,a);return C}}e.AbstractExpandedDecoder=et,e.ArgumentException=C,e.ArithmeticException=ae,e.AztecCode=On,e.AztecCodeReader=Re,e.AztecCodeWriter=hg,e.AztecDecoder=de,e.AztecDetector=Se,e.AztecDetectorResult=be,e.AztecEncoder=Ag,e.AztecHighLevelEncoder=ug,e.AztecPoint=Be,e.BarcodeFormat=z,e.Binarizer=A,e.BinaryBitmap=d,e.BitArray=Z,e.BitMatrix=k,e.BitSource=Bt,e.BrowserAztecCodeReader=ve,e.BrowserBarcodeReader=bt,e.BrowserCodeReader=M,e.BrowserDatamatrixCodeReader=wt,e.BrowserMultiFormatReader=vn,e.BrowserPDF417Reader=Vn,e.BrowserQRCodeReader=wn,e.BrowserQRCodeSvgWriter=Kn,e.CharacterSetECI=R,e.ChecksumException=u,e.Code128Reader=we,e.Code39Reader=We,e.DataMatrixDecodedBitStreamParser=St,e.DataMatrixReader=Vt,e.DecodeHintType=B,e.DecoderResult=ie,e.DefaultGridSampler=fe,e.DetectorResult=me,e.EAN13Reader=He,e.EncodeHintType=Xn,e.Exception=l,e.FormatException=S,e.GenericGF=Ie,e.GenericGFPoly=se,e.GlobalHistogramBinarizer=N,e.GridSampler=ye,e.GridSamplerInstance=Ge,e.HTMLCanvasElementLuminanceSource=H,e.HybridBinarizer=J,e.ITFReader=ke,e.IllegalArgumentException=c,e.IllegalStateException=Ce,e.InvertedLuminanceSource=E,e.LuminanceSource=Y,e.MathUtils=ue,e.MultiFormatOneDReader=mt,e.MultiFormatReader=Rn,e.MultiFormatWriter=Dn,e.NotFoundException=X,e.OneDReader=Ve,e.PDF417DecodedBitStreamParser=fn,e.PDF417DecoderErrorCorrection=tn,e.PDF417Reader=Bn,e.PDF417ResultMetadata=cn,e.PerspectiveTransform=Ze,e.PlanarYUVLuminanceSource=Ln,e.QRCodeByteMatrix=Yn,e.QRCodeDataMask=Yt,e.QRCodeDecodedBitStreamParser=xt,e.QRCodeDecoderErrorCorrectionLevel=Wt,e.QRCodeDecoderFormatInformation=kt,e.QRCodeEncoder=Tn,e.QRCodeEncoderQRCode=En,e.QRCodeMaskUtil=Jn,e.QRCodeMatrixUtil=Fn,e.QRCodeMode=Ft,e.QRCodeReader=Ot,e.QRCodeVersion=Jt,e.QRCodeWriter=Mn,e.RGBLuminanceSource=Un,e.RSS14Reader=ht,e.RSSExpandedReader=ut,e.ReaderException=Sn,e.ReedSolomonDecoder=ce,e.ReedSolomonEncoder=Nn,e.ReedSolomonException=le,e.Result=D,e.ResultMetadataType=re,e.ResultPoint=he,e.StringUtils=w,e.UnsupportedOperationException=v,e.VideoInputDevice=F,e.WhiteRectangleDetector=pe,e.WriterException=Hn,e.ZXingArrays=p,e.ZXingCharset=zn,e.ZXingInteger=y,e.ZXingStandardCharsets=Qn,e.ZXingStringBuilder=W,e.ZXingStringEncoding=V,e.ZXingSystem=h,e.createAbstractExpandedDecoder=Ct,Object.defineProperty(e,"__esModule",{value:!0})}(Jf.exports);var Yf=Jf.exports;const Ef=s({__proto__:null,default:g(Yf)},[Yf]);var Hf,Ff,xf=function(){function e(e,t,n){if(this.formatMap=new Map([[uf.QR_CODE,Yf.BarcodeFormat.QR_CODE],[uf.AZTEC,Yf.BarcodeFormat.AZTEC],[uf.CODABAR,Yf.BarcodeFormat.CODABAR],[uf.CODE_39,Yf.BarcodeFormat.CODE_39],[uf.CODE_93,Yf.BarcodeFormat.CODE_93],[uf.CODE_128,Yf.BarcodeFormat.CODE_128],[uf.DATA_MATRIX,Yf.BarcodeFormat.DATA_MATRIX],[uf.MAXICODE,Yf.BarcodeFormat.MAXICODE],[uf.ITF,Yf.BarcodeFormat.ITF],[uf.EAN_13,Yf.BarcodeFormat.EAN_13],[uf.EAN_8,Yf.BarcodeFormat.EAN_8],[uf.PDF_417,Yf.BarcodeFormat.PDF_417],[uf.RSS_14,Yf.BarcodeFormat.RSS_14],[uf.RSS_EXPANDED,Yf.BarcodeFormat.RSS_EXPANDED],[uf.UPC_A,Yf.BarcodeFormat.UPC_A],[uf.UPC_E,Yf.BarcodeFormat.UPC_E],[uf.UPC_EAN_EXTENSION,Yf.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!Ef)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=t,this.logger=n;var g=this.createZXingFormats(e),r=new Map;r.set(Yf.DecodeHintType.POSSIBLE_FORMATS,g),r.set(Yf.DecodeHintType.TRY_HARDER,!1),this.hints=r}return e.prototype.decodeAsync=function(e){var t=this;return new Promise((function(n,g){try{n(t.decode(e))}catch(Vye){g(Vye)}}))},e.prototype.decode=function(e){var t=new Yf.MultiFormatReader(this.verbose,this.hints),n=new Yf.HTMLCanvasElementLuminanceSource(e),g=new Yf.BinaryBitmap(new Yf.HybridBinarizer(n)),r=t.decode(g);return{text:r.text,format:Sf.create(this.toHtml5QrcodeSupportedFormats(r.format)),debugData:this.createDebugData()}},e.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach((function(t,n,g){e.set(t,n)})),e},e.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},e.prototype.createZXingFormats=function(e){for(var t=[],n=0,g=e;n<g.length;n++){var r=g[n];this.formatMap.has(r)?t.push(this.formatMap.get(r)):this.logger.logError("".concat(r," is not supported by")+"ZXingHtml5QrcodeShim")}return t},e.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},e}(),Tf=function(e,t,n,g){return new(n||(n=Promise))((function(r,i){function o(e){try{a(g.next(e))}catch(fp){i(fp)}}function s(e){try{a(g.throw(e))}catch(fp){i(fp)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}a((g=g.apply(e,t||[])).next())}))},Kf=function(e,t){var n,g,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(n=1,g&&(r=2&s[0]?g.return:s[0]?g.throw||((r=g.return)&&r.call(g),0):g.next)&&!(r=r.call(g,s[1])).done)return r;switch(g=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,g=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(fp){s=[6,fp],g=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},Mf=function(){function e(t,n,g){if(this.formatMap=new Map([[uf.QR_CODE,"qr_code"],[uf.AZTEC,"aztec"],[uf.CODABAR,"codabar"],[uf.CODE_39,"code_39"],[uf.CODE_93,"code_93"],[uf.CODE_128,"code_128"],[uf.DATA_MATRIX,"data_matrix"],[uf.ITF,"itf"],[uf.EAN_13,"ean_13"],[uf.EAN_8,"ean_8"],[uf.PDF_417,"pdf417"],[uf.UPC_A,"upc_a"],[uf.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!e.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=n,this.logger=g;var r=this.createBarcodeDetectorFormats(t);if(this.detector=new BarcodeDetector(r),!this.detector)throw"BarcodeDetector detector not supported"}return e.isSupported=function(){return"BarcodeDetector"in window&&void 0!==new BarcodeDetector({formats:["qr_code"]})},e.prototype.decodeAsync=function(e){return Tf(this,void 0,void 0,(function(){var t,n;return Kf(this,(function(g){switch(g.label){case 0:return[4,this.detector.detect(e)];case 1:if(!(t=g.sent())||0===t.length)throw"No barcode or QR code detected.";return[2,{text:(n=this.selectLargestBarcode(t)).rawValue,format:Sf.create(this.toHtml5QrcodeSupportedFormats(n.format)),debugData:this.createDebugData()}]}}))}))},e.prototype.selectLargestBarcode=function(e){for(var t=null,n=0,g=0,r=e;g<r.length;g++){var i=r[g],o=i.boundingBox.width*i.boundingBox.height;o>n&&(n=o,t=i)}if(!t)throw"No largest barcode found";return t},e.prototype.createBarcodeDetectorFormats=function(e){for(var t=[],n=0,g=e;n<g.length;n++){var r=g[n];this.formatMap.has(r)?t.push(this.formatMap.get(r)):this.logger.warn("".concat(r," is not supported by")+"BarcodeDetectorDelegate")}return{formats:t}},e.prototype.toHtml5QrcodeSupportedFormats=function(e){if(!this.reverseFormatMap.has(e))throw"reverseFormatMap doesn't have ".concat(e);return this.reverseFormatMap.get(e)},e.prototype.createReverseFormatMap=function(){var e=new Map;return this.formatMap.forEach((function(t,n,g){e.set(t,n)})),e},e.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},e}(),Df=function(e,t,n,g){return new(n||(n=Promise))((function(r,i){function o(e){try{a(g.next(e))}catch(fp){i(fp)}}function s(e){try{a(g.throw(e))}catch(fp){i(fp)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}a((g=g.apply(e,t||[])).next())}))},Lf=function(e,t){var n,g,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(n=1,g&&(r=2&s[0]?g.return:s[0]?g.throw||((r=g.return)&&r.call(g),0):g.next)&&!(r=r.call(g,s[1])).done)return r;switch(g=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,g=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(fp){s=[6,fp],g=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},Uf=function(){function e(e,t,n,g){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=n,t&&Mf.isSupported()?(this.primaryDecoder=new Mf(e,n,g),this.secondaryDecoder=new xf(e,n,g)):this.primaryDecoder=new xf(e,n,g)}return e.prototype.decodeAsync=function(e){return Df(this,void 0,void 0,(function(){var t;return Lf(this,(function(n){switch(n.label){case 0:t=performance.now(),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(e)];case 2:return[2,n.sent()];case 3:return this.possiblyLogPerformance(t),[7];case 4:return[2]}}))}))},e.prototype.decodeRobustlyAsync=function(e){return Df(this,void 0,void 0,(function(){var t,n;return Lf(this,(function(g){switch(g.label){case 0:t=performance.now(),g.label=1;case 1:return g.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(e)];case 2:return[2,g.sent()];case 3:if(n=g.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(e)];throw n;case 4:return this.possiblyLogPerformance(t),[7];case 5:return[2]}}))}))},e.prototype.getDecoder=function(){return this.secondaryDecoder?!1===this.wasPrimaryDecoderUsedInLastDecode?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},e.prototype.possiblyLogPerformance=function(e){if(this.verbose){var t=performance.now()-e;this.executionResults.push(t),this.executions++,this.possiblyFlushPerformanceReport()}},e.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var e=0,t=0,n=this.executionResults;t<n.length;t++){e+=n[t]}this.executionResults.length;this.executions=0,this.executionResults=[]}},e}(),zf=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function g(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(g.prototype=n.prototype,new g)}}(),Qf=function(e,t,n,g){return new(n||(n=Promise))((function(r,i){function o(e){try{a(g.next(e))}catch(fp){i(fp)}}function s(e){try{a(g.throw(e))}catch(fp){i(fp)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}a((g=g.apply(e,t||[])).next())}))},Of=function(e,t){var n,g,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(n=1,g&&(r=2&s[0]?g.return:s[0]?g.throw||((r=g.return)&&r.call(g),0):g.next)&&!(r=r.call(g,s[1])).done)return r;switch(g=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,g=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(fp){s=[6,fp],g=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},jf=function(){function e(e,t){this.name=e,this.track=t}return e.prototype.isSupported=function(){return!!this.track.getCapabilities&&this.name in this.track.getCapabilities()},e.prototype.apply=function(e){var t={};t[this.name]=e;var n={advanced:[t]};return this.track.applyConstraints(n)},e.prototype.value=function(){var e=this.track.getSettings();return this.name in e?e[this.name]:null},e}(),Pf=function(e){function t(t){return e.call(this,"zoom",t)||this}return zf(t,e),t}(function(e){function t(t,n){return e.call(this,t,n)||this}return zf(t,e),t.prototype.min=function(){return this.getCapabilities().min},t.prototype.max=function(){return this.getCapabilities().max},t.prototype.step=function(){return this.getCapabilities().step},t.prototype.apply=function(e){var t={};t[this.name]=e;var n={advanced:[t]};return this.track.applyConstraints(n)},t.prototype.getCapabilities=function(){this.failIfNotSupported();var e=this.track.getCapabilities()[this.name];return{min:e.min,max:e.max,step:e.step}},t.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},t}(jf)),_f=function(e){function t(t){return e.call(this,"torch",t)||this}return zf(t,e),t}(jf),qf=function(){function e(e){this.track=e}return e.prototype.zoomFeature=function(){return new Pf(this.track)},e.prototype.torchFeature=function(){return new _f(this.track)},e}(),$f=function(){function e(e,t,n){this.isClosed=!1,this.parentElement=e,this.mediaStream=t,this.callbacks=n,this.surface=this.createVideoElement(this.parentElement.clientWidth),e.append(this.surface)}return e.prototype.createVideoElement=function(e){var t=document.createElement("video");return t.style.width="".concat(e,"px"),t.style.display="block",t.muted=!0,t.setAttribute("muted","true"),t.playsInline=!0,t},e.prototype.setupSurface=function(){var e=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var t=function(){var n=e.surface.clientWidth,g=e.surface.clientHeight;e.callbacks.onRenderSurfaceReady(n,g),e.surface.removeEventListener("playing",t)};this.surface.addEventListener("playing",t),this.surface.srcObject=this.mediaStream,this.surface.play()},e.create=function(t,n,g,r){return Qf(this,void 0,void 0,(function(){var i,o;return Of(this,(function(s){switch(s.label){case 0:return i=new e(t,n,r),g.aspectRatio?(o={aspectRatio:g.aspectRatio},[4,i.getFirstTrackOrFail().applyConstraints(o)]):[3,2];case 1:s.sent(),s.label=2;case 2:return i.setupSurface(),[2,i]}}))}))},e.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},e.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),0===this.mediaStream.getVideoTracks().length)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},e.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},e.prototype.resume=function(e){this.failIfClosed();var t=this,n=function(){setTimeout(e,200),t.surface.removeEventListener("playing",n)};this.surface.addEventListener("playing",n),this.surface.play()},e.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},e.prototype.getSurface=function(){return this.failIfClosed(),this.surface},e.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},e.prototype.applyVideoConstraints=function(e){return Qf(this,void 0,void 0,(function(){return Of(this,(function(t){if("aspectRatio"in e)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(e)]}))}))},e.prototype.close=function(){if(this.isClosed)return Promise.resolve();var e=this;return new Promise((function(t,n){var g=e.mediaStream.getVideoTracks().length,r=0;e.mediaStream.getVideoTracks().forEach((function(n){e.mediaStream.removeTrack(n),n.stop(),++r>=g&&(e.isClosed=!0,e.parentElement.removeChild(e.surface),t())}))}))},e.prototype.getCapabilities=function(){return new qf(this.getFirstTrackOrFail())},e}(),eG=function(){function e(e){this.mediaStream=e}return e.prototype.render=function(e,t,n){return Qf(this,void 0,void 0,(function(){return Of(this,(function(g){return[2,$f.create(e,this.mediaStream,t,n)]}))}))},e.create=function(t){return Qf(this,void 0,void 0,(function(){var n;return Of(this,(function(g){switch(g.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return n={audio:!1,video:t},[4,navigator.mediaDevices.getUserMedia(n)];case 1:return[2,new e(g.sent())]}}))}))},e}(),tG=function(e,t,n,g){return new(n||(n=Promise))((function(r,i){function o(e){try{a(g.next(e))}catch(fp){i(fp)}}function s(e){try{a(g.throw(e))}catch(fp){i(fp)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}a((g=g.apply(e,t||[])).next())}))},nG=function(e,t){var n,g,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(n=1,g&&(r=2&s[0]?g.return:s[0]?g.throw||((r=g.return)&&r.call(g),0):g.next)&&!(r=r.call(g,s[1])).done)return r;switch(g=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,g=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(fp){s=[6,fp],g=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},gG=function(){function e(){}return e.failIfNotSupported=function(){return tG(this,void 0,void 0,(function(){return nG(this,(function(t){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new e]}))}))},e.prototype.create=function(e){return tG(this,void 0,void 0,(function(){return nG(this,(function(t){return[2,eG.create(e)]}))}))},e}(),rG=function(e,t,n,g){return new(n||(n=Promise))((function(r,i){function o(e){try{a(g.next(e))}catch(fp){i(fp)}}function s(e){try{a(g.throw(e))}catch(fp){i(fp)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}a((g=g.apply(e,t||[])).next())}))},iG=function(e,t){var n,g,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(n=1,g&&(r=2&s[0]?g.return:s[0]?g.throw||((r=g.return)&&r.call(g),0):g.next)&&!(r=r.call(g,s[1])).done)return r;switch(g=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,g=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(fp){s=[6,fp],g=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},oG=function(){function e(){}return e.retrieve=function(){if(navigator.mediaDevices)return e.getCamerasFromMediaDevices();var t=MediaStreamTrack;return MediaStreamTrack&&t.getSources?e.getCamerasFromMediaStreamTrack():e.rejectWithError()},e.rejectWithError=function(){var t=Wf.unableToQuerySupportedDevices();return e.isHttpsOrLocalhost()||(t=Wf.insecureContextCameraQueryError()),Promise.reject(t)},e.isHttpsOrLocalhost=function(){if("https:"===location.protocol)return!0;var e=location.host.split(":")[0];return"127.0.0.1"===e||"localhost"===e},e.getCamerasFromMediaDevices=function(){return rG(this,void 0,void 0,(function(){var e,t,n,g,r,i,o;return iG(this,(function(s){switch(s.label){case 0:return e=function(e){for(var t=0,n=e.getVideoTracks();t<n.length;t++){var g=n[t];g.enabled=!1,g.stop(),e.removeTrack(g)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return t=s.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(n=s.sent(),g=[],r=0,i=n;r<i.length;r++)"videoinput"===(o=i[r]).kind&&g.push({id:o.deviceId,label:o.label});return e(t),[2,g]}}))}))},e.getCamerasFromMediaStreamTrack=function(){return new Promise((function(e,t){MediaStreamTrack.getSources((function(t){for(var n=[],g=0,r=t;g<r.length;g++){var i=r[g];"video"===i.kind&&n.push({id:i.id,label:i.label})}e(n)}))}))},e}();(Ff=Hf||(Hf={}))[Ff.UNKNOWN=0]="UNKNOWN",Ff[Ff.NOT_STARTED=1]="NOT_STARTED",Ff[Ff.SCANNING=2]="SCANNING",Ff[Ff.PAUSED=3]="PAUSED";var sG,aG,IG=function(){function e(){this.state=Hf.NOT_STARTED,this.onGoingTransactionNewState=Hf.UNKNOWN}return e.prototype.directTransition=function(e){this.failIfTransitionOngoing(),this.validateTransition(e),this.state=e},e.prototype.startTransition=function(e){return this.failIfTransitionOngoing(),this.validateTransition(e),this.onGoingTransactionNewState=e,this},e.prototype.execute=function(){if(this.onGoingTransactionNewState===Hf.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var e=this.onGoingTransactionNewState;this.onGoingTransactionNewState=Hf.UNKNOWN,this.directTransition(e)},e.prototype.cancel=function(){if(this.onGoingTransactionNewState===Hf.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=Hf.UNKNOWN},e.prototype.getState=function(){return this.state},e.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==Hf.UNKNOWN)throw"Cannot transition to a new state, already under transition"},e.prototype.validateTransition=function(e){switch(this.state){case Hf.UNKNOWN:throw"Transition from unknown is not allowed";case Hf.NOT_STARTED:this.failIfNewStateIs(e,[Hf.PAUSED]);case Hf.SCANNING:case Hf.PAUSED:}},e.prototype.failIfNewStateIs=function(e,t){for(var n=0,g=t;n<g.length;n++){if(e===g[n])throw"Cannot transition from ".concat(this.state," to ").concat(e)}},e}(),lG=function(){function e(e){this.stateManager=e}return e.prototype.startTransition=function(e){return this.stateManager.startTransition(e)},e.prototype.directTransition=function(e){this.stateManager.directTransition(e)},e.prototype.getState=function(){return this.stateManager.getState()},e.prototype.canScanFile=function(){return this.stateManager.getState()===Hf.NOT_STARTED},e.prototype.isScanning=function(){return this.stateManager.getState()!==Hf.NOT_STARTED},e.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===Hf.SCANNING},e.prototype.isPaused=function(){return this.stateManager.getState()===Hf.PAUSED},e}(),CG=function(){function e(){}return e.create=function(){return new lG(new IG)},e}(),cG=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function g(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(g.prototype=n.prototype,new g)}}(),dG=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return cG(t,e),t.DEFAULT_WIDTH=300,t.DEFAULT_WIDTH_OFFSET=2,t.FILE_SCAN_MIN_HEIGHT=300,t.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,t.MIN_QR_BOX_SIZE=50,t.SHADED_LEFT=1,t.SHADED_RIGHT=2,t.SHADED_TOP=3,t.SHADED_BOTTOM=4,t.SHADED_REGION_ELEMENT_ID="qr-shaded-region",t.VERBOSE=!1,t.BORDER_SHADER_DEFAULT_COLOR="#ffffff",t.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",t}(Bf),uG=function(){function e(e,t){this.logger=t,this.fps=dG.SCAN_DEFAULT_FPS,e?(e.fps&&(this.fps=e.fps),this.disableFlip=!0===e.disableFlip,this.qrbox=e.qrbox,this.aspectRatio=e.aspectRatio,this.videoConstraints=e.videoConstraints):this.disableFlip=dG.DEFAULT_DISABLE_FLIP}return e.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?Nf.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},e.prototype.isShadedBoxEnabled=function(){return!wf(this.qrbox)},e.create=function(t,n){return new e(t,n)},e}(),AG=function(){function e(e,t){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");var n;this.elementId=e,this.verbose=!1,"boolean"==typeof t?this.verbose=!0===t:t&&(n=t,this.verbose=!0===n.verbose,n.experimentalFeatures),this.logger=new Vf(this.verbose),this.qrcode=new Uf(this.getSupportedFormats(t),this.getUseBarCodeDetectorIfSupported(n),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=CG.create()}return e.prototype.start=function(e,t,n,g){var r,i=this;if(!e)throw"cameraIdOrConfig is required";if(!n||"function"!=typeof n)throw"qrCodeSuccessCallback is required and should be a function.";r=g||(this.verbose?this.logger.log:function(){});var o=uG.create(t,this.logger);this.clearElement();var s=!1;o.videoConstraints&&(o.isMediaStreamConstraintsValid()?s=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var a=s,I=document.getElementById(this.elementId);I.clientWidth?I.clientWidth:dG.DEFAULT_WIDTH,I.style.position="relative",this.shouldScan=!0,this.element=I;var l=this,C=this.stateManagerProxy.startTransition(Hf.SCANNING);return new Promise((function(t,g){var s=a?o.videoConstraints:l.createVideoConstraints(e);if(!s)return C.cancel(),void g("videoConstraints should be defined");var I={};a&&!o.aspectRatio||(I.aspectRatio=o.aspectRatio);var c={onRenderSurfaceReady:function(e,t){l.setupUi(e,t,o),l.isScanning=!0,l.foreverScan(o,n,r)}};gG.failIfNotSupported().then((function(e){e.create(s).then((function(e){return e.render(i.element,I,c).then((function(e){l.renderedCamera=e,C.execute(),t(null)})).catch((function(e){C.cancel(),g(e)}))})).catch((function(e){C.cancel(),g(Wf.errorGettingUserMedia(e))}))})).catch((function(e){C.cancel(),g(Wf.cameraStreamingNotSupported())}))}))},e.prototype.pause=function(e){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(Hf.PAUSED),this.showPausedState(),(wf(e)||!0!==e)&&(e=!1),e&&this.renderedCamera&&this.renderedCamera.pause()},e.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var e=this,t=function(){e.stateManagerProxy.directTransition(Hf.SCANNING),e.hidePausedState()};this.renderedCamera.isPaused()?this.renderedCamera.resume((function(){t()})):t()},e.prototype.getState=function(){return this.stateManagerProxy.getState()},e.prototype.stop=function(){var e=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var t=this.stateManagerProxy.startTransition(Hf.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var n=this;return this.renderedCamera.close().then((function(){return n.renderedCamera=null,n.element&&(n.element.removeChild(n.canvasElement),n.canvasElement=null),function(){if(e.element){var t=document.getElementById(dG.SHADED_REGION_ELEMENT_ID);t&&e.element.removeChild(t)}}(),n.qrRegion&&(n.qrRegion=null),n.context&&(n.context=null),t.execute(),n.hidePausedState(),n.isScanning=!1,Promise.resolve()}))},e.prototype.scanFile=function(e,t){return this.scanFileV2(e,t).then((function(e){return e.decodedText}))},e.prototype.scanFileV2=function(e,t){var n=this;if(!(e&&e instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(wf(t)&&(t=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise((function(g,r){n.possiblyCloseLastScanImageFile(),n.clearElement(),n.lastScanImageFile=URL.createObjectURL(e);var i=new Image;i.onload=function(){var e=i.width,o=i.height,s=document.getElementById(n.elementId),a=s.clientWidth?s.clientWidth:dG.DEFAULT_WIDTH,I=Math.max(s.clientHeight?s.clientHeight:o,dG.FILE_SCAN_MIN_HEIGHT),l=n.computeCanvasDrawConfig(e,o,a,I);if(t){var C=n.createCanvasElement(a,I,"qr-canvas-visible");C.style.display="inline-block",s.appendChild(C);var c=C.getContext("2d");if(!c)throw"Unable to get 2d context from canvas";c.canvas.width=a,c.canvas.height=I,c.drawImage(i,0,0,e,o,l.x,l.y,l.width,l.height)}var d=dG.FILE_SCAN_HIDDEN_CANVAS_PADDING,u=Math.max(i.width,l.width),A=Math.max(i.height,l.height),h=u+2*d,m=A+2*d,b=n.createCanvasElement(h,m);s.appendChild(b);var p=b.getContext("2d");if(!p)throw"Unable to get 2d context from canvas";p.canvas.width=h,p.canvas.height=m,p.drawImage(i,0,0,e,o,d,d,u,A);try{n.qrcode.decodeRobustlyAsync(b).then((function(e){g(Rf.createFromQrcodeResult(e))})).catch(r)}catch(y){r("QR code parse error, error = ".concat(y))}},i.onerror=r,i.onabort=r,i.onstalled=r,i.onsuspend=r,i.src=URL.createObjectURL(e)}))},e.prototype.clear=function(){this.clearElement()},e.getCameras=function(){return oG.retrieve()},e.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},e.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},e.prototype.applyVideoConstraints=function(e){if(!e)throw"videoConstaints is required argument.";if(!Nf.isMediaStreamConstraintsValid(e,this.logger))throw"invalid videoConstaints passed, check logs for more details";return this.getRenderedCameraOrFail().applyVideoConstraints(e)},e.prototype.getRenderedCameraOrFail=function(){if(null==this.renderedCamera)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},e.prototype.getSupportedFormats=function(e){var t=[uf.QR_CODE,uf.AZTEC,uf.CODABAR,uf.CODE_39,uf.CODE_93,uf.CODE_128,uf.DATA_MATRIX,uf.MAXICODE,uf.ITF,uf.EAN_13,uf.EAN_8,uf.PDF_417,uf.RSS_14,uf.RSS_EXPANDED,uf.UPC_A,uf.UPC_E,uf.UPC_EAN_EXTENSION];if(!e||"boolean"==typeof e)return t;if(!e.formatsToSupport)return t;if(!Array.isArray(e.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(0===e.formatsToSupport.length)throw"Atleast 1 formatsToSupport is needed.";for(var n=[],g=0,r=e.formatsToSupport;g<r.length;g++){var i=r[g];Zf(i)?n.push(i):this.logger.warn("Invalid format: ".concat(i," passed in config, ignoring."))}if(0===n.length)throw"None of formatsToSupport match supported values.";return n},e.prototype.getUseBarCodeDetectorIfSupported=function(e){if(wf(e))return!0;if(!wf(e.useBarCodeDetectorIfSupported))return!1!==e.useBarCodeDetectorIfSupported;if(wf(e.experimentalFeatures))return!0;var t=e.experimentalFeatures;return!!wf(t.useBarCodeDetectorIfSupported)||!1!==t.useBarCodeDetectorIfSupported},e.prototype.validateQrboxSize=function(e,t,n){var g=this,r=n.qrbox;this.validateQrboxConfig(r);var i,o=this.toQrdimensions(e,t,r),s=function(e){if(e<dG.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(dG.MIN_QR_BOX_SIZE,"px.")};s(o.width),s(o.height),o.width=((i=o.width)>e&&(g.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),i=e),i)},e.prototype.validateQrboxConfig=function(e){if("number"!=typeof e&&"function"!=typeof e&&(void 0===e.width||void 0===e.height))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},e.prototype.toQrdimensions=function(e,t,n){if("number"==typeof n)return{width:n,height:n};if("function"==typeof n)try{return n(e,t)}catch(Vye){throw new Error("qrbox config was passed as a function but it failed with unknown error"+Vye)}return n},e.prototype.setupUi=function(e,t,n){n.isShadedBoxEnabled()&&this.validateQrboxSize(e,t,n);var g=wf(n.qrbox)?{width:e,height:t}:n.qrbox;this.validateQrboxConfig(g);var r=this.toQrdimensions(e,t,g);r.height>t&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var i=n.isShadedBoxEnabled()&&r.height<=t,o={x:0,y:0,width:e,height:t},s=i?this.getShadedRegionBounds(e,t,r):o,a=this.createCanvasElement(s.width,s.height),I=a.getContext("2d",{willReadFrequently:!0});I.canvas.width=s.width,I.canvas.height=s.height,this.element.append(a),i&&this.possiblyInsertShadingElement(this.element,e,t,r),this.createScannerPausedUiElement(this.element),this.qrRegion=s,this.context=I,this.canvasElement=a},e.prototype.createScannerPausedUiElement=function(e){var t=document.createElement("div");t.innerText=Wf.scannerPaused(),t.style.display="none",t.style.position="absolute",t.style.top="0px",t.style.zIndex="1",t.style.background="rgba(9, 9, 9, 0.46)",t.style.color="#FFECEC",t.style.textAlign="center",t.style.width="100%",e.appendChild(t),this.scannerPausedUiElement=t},e.prototype.scanContext=function(e,t){var n=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then((function(t){return e(t.text,Rf.createFromQrcodeResult(t)),n.possiblyUpdateShaders(!0),!0})).catch((function(e){n.possiblyUpdateShaders(!1);var g=Wf.codeParseError(e);return t(g,vf.createFrom(g)),!1}))},e.prototype.foreverScan=function(e,t,n){var g=this;if(this.shouldScan&&this.renderedCamera){var r=this.renderedCamera.getSurface(),i=r.videoWidth/r.clientWidth,o=r.videoHeight/r.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var s=this.qrRegion.width*i,a=this.qrRegion.height*o,I=this.qrRegion.x*i,l=this.qrRegion.y*o;this.context.drawImage(r,I,l,s,a,0,0,this.qrRegion.width,this.qrRegion.height);var C=function(){g.foreverScanTimeout=setTimeout((function(){g.foreverScan(e,t,n)}),g.getTimeoutFps(e.fps))};this.scanContext(t,n).then((function(r){r||!0===e.disableFlip?C():(g.context.translate(g.context.canvas.width,0),g.context.scale(-1,1),g.scanContext(t,n).finally((function(){C()})))})).catch((function(e){g.logger.logError("Error happend while scanning context",e),C()}))}},e.prototype.createVideoConstraints=function(e){if("string"==typeof e)return{deviceId:{exact:e}};if("object"==typeof e){var t="facingMode",n="deviceId",g={user:!0,environment:!0},r="exact",i=function(e){if(e in g)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(e,"'")},o=Object.keys(e);if(1!==o.length)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(o.length," keys");var s=Object.keys(e)[0];if(s!==t&&s!==n)throw"Only '".concat(t,"' and '").concat(n,"' ")+" are supported for 'cameraIdOrConfig'";if(s!==t){var a=e.deviceId;if("string"==typeof a)return{deviceId:a};if("object"==typeof a){if(r in a)return{deviceId:{exact:a["".concat(r)]}};throw"'deviceId' should be string or object with"+" ".concat(r," as key.")}throw"Invalid type of 'deviceId' = ".concat(typeof a)}var I=e.facingMode;if("string"==typeof I){if(i(I))return{facingMode:I}}else{if("object"!=typeof I)throw"Invalid type of 'facingMode' = ".concat(typeof I);if(!(r in I))throw"'facingMode' should be string or object with"+" ".concat(r," as key.");if(i(I["".concat(r)]))return{facingMode:{exact:I["".concat(r)]}}}}throw"Invalid type of 'cameraIdOrConfig' = ".concat(typeof e)},e.prototype.computeCanvasDrawConfig=function(e,t,n,g){if(e<=n&&t<=g)return{x:(n-e)/2,y:(g-t)/2,width:e,height:t};var r=e,i=t;return e>n&&(t*=n/e,e=n),t>g&&(e*=g/t,t=g),this.logger.log("Image downsampled from "+"".concat(r,"X").concat(i)+" to ".concat(e,"X").concat(t,".")),this.computeCanvasDrawConfig(e,t,n,g)},e.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var e=document.getElementById(this.elementId);e&&(e.innerHTML="")},e.prototype.possiblyUpdateShaders=function(e){this.qrMatch!==e&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach((function(t){t.style.backgroundColor=e?dG.BORDER_SHADER_MATCH_COLOR:dG.BORDER_SHADER_DEFAULT_COLOR})),this.qrMatch=e)},e.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},e.prototype.createCanvasElement=function(e,t,n){var g=e,r=t,i=document.createElement("canvas");return i.style.width="".concat(g,"px"),i.style.height="".concat(r,"px"),i.style.display="none",i.id=wf(n)?"qr-canvas":n,i},e.prototype.getShadedRegionBounds=function(e,t,n){if(n.width>e||n.height>t)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(e-n.width)/2,y:(t-n.height)/2,width:n.width,height:n.height}},e.prototype.possiblyInsertShadingElement=function(e,t,n,g){if(!(t-g.width<1||n-g.height<1)){var r=document.createElement("div");r.style.position="absolute";var i=(t-g.width)/2,o=(n-g.height)/2;if(r.style.borderLeft="".concat(i,"px solid rgba(0, 0, 0, 0.48)"),r.style.borderRight="".concat(i,"px solid rgba(0, 0, 0, 0.48)"),r.style.borderTop="".concat(o,"px solid rgba(0, 0, 0, 0.48)"),r.style.borderBottom="".concat(o,"px solid rgba(0, 0, 0, 0.48)"),r.style.boxSizing="border-box",r.style.top="0px",r.style.bottom="0px",r.style.left="0px",r.style.right="0px",r.id="".concat(dG.SHADED_REGION_ELEMENT_ID),t-g.width<11||n-g.height<11)this.hasBorderShaders=!1;else{var s=40;this.insertShaderBorders(r,s,5,-5,null,0,!0),this.insertShaderBorders(r,s,5,-5,null,0,!1),this.insertShaderBorders(r,s,5,null,-5,0,!0),this.insertShaderBorders(r,s,5,null,-5,0,!1),this.insertShaderBorders(r,5,45,-5,null,-5,!0),this.insertShaderBorders(r,5,45,null,-5,-5,!0),this.insertShaderBorders(r,5,45,-5,null,-5,!1),this.insertShaderBorders(r,5,45,null,-5,-5,!1),this.hasBorderShaders=!0}e.append(r)}},e.prototype.insertShaderBorders=function(e,t,n,g,r,i,o){var s=document.createElement("div");s.style.position="absolute",s.style.backgroundColor=dG.BORDER_SHADER_DEFAULT_COLOR,s.style.width="".concat(t,"px"),s.style.height="".concat(n,"px"),null!==g&&(s.style.top="".concat(g,"px")),null!==r&&(s.style.bottom="".concat(r,"px")),o?s.style.left="".concat(i,"px"):s.style.right="".concat(i,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(s),e.appendChild(s)},e.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},e.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},e.prototype.getTimeoutFps=function(e){return 1e3/e},e}(),hG="data:image/svg+xml;base64,",mG=hG+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg==",bG=hG+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4=",pG=hG+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",yG=function(){function e(){}return e.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},e}(),ZG=function(){function e(){this.data=yG.createDefault();var t=localStorage.getItem(e.LOCAL_STORAGE_KEY);t?this.data=JSON.parse(t):this.reset()}return e.prototype.hasCameraPermissions=function(){return this.data.hasPermission},e.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},e.prototype.setHasPermission=function(e){this.data.hasPermission=e,this.flush()},e.prototype.setLastUsedCameraId=function(e){this.data.lastUsedCameraId=e,this.flush()},e.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},e.prototype.reset=function(){this.data=yG.createDefault(),this.flush()},e.prototype.flush=function(){localStorage.setItem(e.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},e.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",e}(),fG=function(){function e(){this.infoDiv=document.createElement("div")}return e.prototype.renderInto=function(e){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid #171717",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(0 0 0 / 69%)",this.infoDiv.style.borderRadius="5px",this.infoDiv.style.textAlign="center",this.infoDiv.style.fontWeight="400",this.infoDiv.style.color="white",this.infoDiv.innerText=Xf.poweredBy();var t=document.createElement("a");t.innerText="ScanApp",t.href="https://scanapp.org",t.target="new",t.style.color="white",this.infoDiv.appendChild(t);var n=document.createElement("br"),g=document.createElement("br");this.infoDiv.appendChild(n),this.infoDiv.appendChild(g);var r=document.createElement("a");r.innerText=Xf.reportIssues(),r.href="https://github.com/mebjas/html5-qrcode/issues",r.target="new",r.style.color="white",this.infoDiv.appendChild(r),e.appendChild(this.infoDiv)},e.prototype.show=function(){this.infoDiv.style.display="block"},e.prototype.hide=function(){this.infoDiv.style.display="none"},e}(),GG=function(){function e(e,t){this.isShowingInfoIcon=!0,this.onTapIn=e,this.onTapOut=t,this.infoIcon=document.createElement("img")}return e.prototype.renderInto=function(e){var t=this;this.infoIcon.alt="Info icon",this.infoIcon.src=pG,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(e){return t.onHoverIn()},this.infoIcon.onmouseout=function(e){return t.onHoverOut()},this.infoIcon.onclick=function(e){return t.onClick()},e.appendChild(this.infoIcon)},e.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},e.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},e.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=pG,this.infoIcon.style.opacity="0.6")},e}(),BG=function(){function e(){var e=this;this.infoDiv=new fG,this.infoIcon=new GG((function(){e.infoDiv.show()}),(function(){e.infoDiv.hide()}))}return e.prototype.renderInto=function(e){this.infoDiv.renderInto(e),this.infoIcon.renderInto(e)},e}(),SG=function(e,t,n,g){return new(n||(n=Promise))((function(r,i){function o(e){try{a(g.next(e))}catch(fp){i(fp)}}function s(e){try{a(g.throw(e))}catch(fp){i(fp)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}a((g=g.apply(e,t||[])).next())}))},RG=function(e,t){var n,g,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(n=1,g&&(r=2&s[0]?g.return:s[0]?g.throw||((r=g.return)&&r.call(g),0):g.next)&&!(r=r.call(g,s[1])).done)return r;switch(g=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,g=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(fp){s=[6,fp],g=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},vG=function(){function e(){}return e.hasPermissions=function(){return SG(this,void 0,void 0,(function(){var e,t,n,g;return RG(this,(function(r){switch(r.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:for(e=r.sent(),t=0,n=e;t<n.length;t++)if("videoinput"===(g=n[t]).kind&&g.label)return[2,!0];return[2,!1]}}))}))},e}(),VG=function(){function e(e){this.supportedScanTypes=this.validateAndReturnScanTypes(e)}return e.prototype.getDefaultScanType=function(){return this.supportedScanTypes[0]},e.prototype.hasMoreThanOneScanType=function(){return this.supportedScanTypes.length>1},e.prototype.isCameraScanRequired=function(){for(var t=0,n=this.supportedScanTypes;t<n.length;t++){var g=n[t];if(e.isCameraScanType(g))return!0}return!1},e.isCameraScanType=function(e){return e===bf.SCAN_TYPE_CAMERA},e.isFileScanType=function(e){return e===bf.SCAN_TYPE_FILE},e.prototype.validateAndReturnScanTypes=function(e){if(!e||0===e.length)return Bf.DEFAULT_SUPPORTED_SCAN_TYPE;var t=Bf.DEFAULT_SUPPORTED_SCAN_TYPE.length;if(e.length>t)throw"Max ".concat(t," values expected for ")+"supportedScanTypes";for(var n=0,g=e;n<g.length;n++){var r=g[n];if(!Bf.DEFAULT_SUPPORTED_SCAN_TYPE.includes(r))throw"Unsupported scan type ".concat(r)}return e},e}(),wG=function(){function e(){}return e.ALL_ELEMENT_CLASS="html5-qrcode-element",e.CAMERA_PERMISSION_BUTTON_ID="html5-qrcode-button-camera-permission",e.CAMERA_START_BUTTON_ID="html5-qrcode-button-camera-start",e.CAMERA_STOP_BUTTON_ID="html5-qrcode-button-camera-stop",e.TORCH_BUTTON_ID="html5-qrcode-button-torch",e.CAMERA_SELECTION_SELECT_ID="html5-qrcode-select-camera",e.FILE_SELECTION_BUTTON_ID="html5-qrcode-button-file-selection",e.ZOOM_SLIDER_ID="html5-qrcode-input-range-zoom",e.SCAN_TYPE_CHANGE_ANCHOR_ID="html5-qrcode-anchor-scan-type-change",e.TORCH_BUTTON_CLASS_TORCH_ON="html5-qrcode-button-torch-on",e.TORCH_BUTTON_CLASS_TORCH_OFF="html5-qrcode-button-torch-off",e}(),WG=function(){function e(){}return e.createElement=function(e,t){var n=document.createElement(e);return n.id=t,n.classList.add(wG.ALL_ELEMENT_CLASS),"button"===e&&n.setAttribute("type","button"),n},e}(),kG=function(e,t,n,g){return new(n||(n=Promise))((function(r,i){function o(e){try{a(g.next(e))}catch(fp){i(fp)}}function s(e){try{a(g.throw(e))}catch(fp){i(fp)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}a((g=g.apply(e,t||[])).next())}))},XG=function(e,t){var n,g,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(o=0)),o;)try{if(n=1,g&&(r=2&s[0]?g.return:s[0]?g.throw||((r=g.return)&&r.call(g),0):g.next)&&!(r=r.call(g,s[1])).done)return r;switch(g=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,g=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(fp){s=[6,fp],g=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},NG=function(){function e(e,t,n){this.isTorchOn=!1,this.torchCapability=e,this.buttonController=t,this.onTorchActionFailureCallback=n}return e.prototype.isTorchEnabled=function(){return this.isTorchOn},e.prototype.flipState=function(){return kG(this,void 0,void 0,(function(){var e,t;return XG(this,(function(n){switch(n.label){case 0:this.buttonController.disable(),e=!this.isTorchOn,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.torchCapability.apply(e)];case 2:return n.sent(),this.updateUiBasedOnLatestSettings(this.torchCapability.value(),e),[3,4];case 3:return t=n.sent(),this.propagateFailure(e,t),this.buttonController.enable(),[3,4];case 4:return[2]}}))}))},e.prototype.updateUiBasedOnLatestSettings=function(e,t){e===t?(this.buttonController.setText(t?kf.torchOffButton():kf.torchOnButton()),this.isTorchOn=t):this.propagateFailure(t),this.buttonController.enable()},e.prototype.propagateFailure=function(e,t){var n=e?kf.torchOnFailedMessage():kf.torchOffFailedMessage();t&&(n+="; Error = "+t),this.onTorchActionFailureCallback(n)},e.prototype.reset=function(){this.isTorchOn=!1},e}(),JG=function(){function e(e,t){this.onTorchActionFailureCallback=t,this.torchButton=WG.createElement("button",wG.TORCH_BUTTON_ID),this.torchController=new NG(e,this,t)}return e.prototype.render=function(e,t){var n=this;this.torchButton.innerText=kf.torchOnButton(),this.torchButton.style.display=t.display,this.torchButton.style.marginLeft=t.marginLeft;var g=this;this.torchButton.addEventListener("click",(function(e){return kG(n,void 0,void 0,(function(){return XG(this,(function(e){switch(e.label){case 0:return[4,g.torchController.flipState()];case 1:return e.sent(),g.torchController.isTorchEnabled()?(g.torchButton.classList.remove(wG.TORCH_BUTTON_CLASS_TORCH_OFF),g.torchButton.classList.add(wG.TORCH_BUTTON_CLASS_TORCH_ON)):(g.torchButton.classList.remove(wG.TORCH_BUTTON_CLASS_TORCH_ON),g.torchButton.classList.add(wG.TORCH_BUTTON_CLASS_TORCH_OFF)),[2]}}))}))})),e.appendChild(this.torchButton)},e.prototype.updateTorchCapability=function(e){this.torchController=new NG(e,this,this.onTorchActionFailureCallback)},e.prototype.getTorchButton=function(){return this.torchButton},e.prototype.hide=function(){this.torchButton.style.display="none"},e.prototype.show=function(){this.torchButton.style.display="inline-block"},e.prototype.disable=function(){this.torchButton.disabled=!0},e.prototype.enable=function(){this.torchButton.disabled=!1},e.prototype.setText=function(e){this.torchButton.innerText=e},e.prototype.reset=function(){this.torchButton.innerText=kf.torchOnButton(),this.torchController.reset()},e.create=function(t,n,g,r){var i=new e(n,r);return i.render(t,g),i},e}(),YG=function(){function e(e,t,n){this.fileBasedScanRegion=this.createFileBasedScanRegion(),this.fileBasedScanRegion.style.display=t?"block":"none",e.appendChild(this.fileBasedScanRegion);var g=document.createElement("label");g.setAttribute("for",this.getFileScanInputId()),g.style.display="inline-block",this.fileBasedScanRegion.appendChild(g),this.fileSelectionButton=WG.createElement("button",wG.FILE_SELECTION_BUTTON_ID),this.setInitialValueToButton(),this.fileSelectionButton.addEventListener("click",(function(e){g.click()})),g.append(this.fileSelectionButton),this.fileScanInput=WG.createElement("input",this.getFileScanInputId()),this.fileScanInput.type="file",this.fileScanInput.accept="image/*",this.fileScanInput.style.display="none",g.appendChild(this.fileScanInput);var r=this;this.fileScanInput.addEventListener("change",(function(e){if(null!=e&&null!=e.target){var t=e.target;if(!t.files||0!==t.files.length){var g=t.files[0],i=g.name;r.setImageNameToButton(i),n(g)}}}));var i=this.createDragAndDropMessage();this.fileBasedScanRegion.appendChild(i),this.fileBasedScanRegion.addEventListener("dragenter",(function(e){r.fileBasedScanRegion.style.border=r.fileBasedScanRegionActiveBorder(),e.stopPropagation(),e.preventDefault()})),this.fileBasedScanRegion.addEventListener("dragleave",(function(e){r.fileBasedScanRegion.style.border=r.fileBasedScanRegionDefaultBorder(),e.stopPropagation(),e.preventDefault()})),this.fileBasedScanRegion.addEventListener("dragover",(function(e){r.fileBasedScanRegion.style.border=r.fileBasedScanRegionActiveBorder(),e.stopPropagation(),e.preventDefault()})),this.fileBasedScanRegion.addEventListener("drop",(function(e){e.stopPropagation(),e.preventDefault(),r.fileBasedScanRegion.style.border=r.fileBasedScanRegionDefaultBorder();var t=e.dataTransfer;if(t){var g=t.files;if(!g||0===g.length)return;for(var o=!1,s=0;s<g.length;++s){var a=g.item(s);if(a){if(a.type.match(/image.*/)){o=!0;var I=a.name;r.setImageNameToButton(I),n(a),i.innerText=kf.dragAndDropMessage();break}}}o||(i.innerText=kf.dragAndDropMessageOnlyImages())}}))}return e.prototype.hide=function(){this.fileBasedScanRegion.style.display="none",this.fileScanInput.disabled=!0},e.prototype.show=function(){this.fileBasedScanRegion.style.display="block",this.fileScanInput.disabled=!1},e.prototype.isShowing=function(){return"block"===this.fileBasedScanRegion.style.display},e.prototype.resetValue=function(){this.fileScanInput.value="",this.setInitialValueToButton()},e.prototype.createFileBasedScanRegion=function(){var e=document.createElement("div");return e.style.textAlign="center",e.style.margin="auto",e.style.width="80%",e.style.maxWidth="600px",e.style.border=this.fileBasedScanRegionDefaultBorder(),e.style.padding="10px",e.style.marginBottom="10px",e},e.prototype.fileBasedScanRegionDefaultBorder=function(){return"6px dashed #ebebeb"},e.prototype.fileBasedScanRegionActiveBorder=function(){return"6px dashed rgb(153 151 151)"},e.prototype.createDragAndDropMessage=function(){var e=document.createElement("div");return e.innerText=kf.dragAndDropMessage(),e.style.fontWeight="400",e},e.prototype.setImageNameToButton=function(e){if(e.length>20){var t=e.substring(0,8),n=e.length,g=e.substring(n-8,n);e="".concat(t,"....").concat(g)}var r=kf.fileSelectionChooseAnother()+" - "+e;this.fileSelectionButton.innerText=r},e.prototype.setInitialValueToButton=function(){var e=kf.fileSelectionChooseImage()+" - "+kf.fileSelectionNoImageSelected();this.fileSelectionButton.innerText=e},e.prototype.getFileScanInputId=function(){return"html5-qrcode-private-filescan-input"},e.create=function(t,n,g){return new e(t,n,g)},e}(),EG=function(){function e(e){this.selectElement=WG.createElement("select",wG.CAMERA_SELECTION_SELECT_ID),this.cameras=e,this.options=[]}return e.prototype.render=function(e){var t=document.createElement("span");t.style.marginRight="10px";var n=this.cameras.length;if(0===n)throw new Error("No cameras found");if(1===n)t.style.display="none";else{var g=kf.selectCamera();t.innerText="".concat(g," (").concat(this.cameras.length,")  ")}for(var r=1,i=0,o=this.cameras;i<o.length;i++){var s=o[i],a=s.id,I=null==s.label?a:s.label;I&&""!==I||(I=[kf.anonymousCameraPrefix(),r++].join(" "));var l=document.createElement("option");l.value=a,l.innerText=I,this.options.push(l),this.selectElement.appendChild(l)}t.appendChild(this.selectElement),e.appendChild(t)},e.prototype.disable=function(){this.selectElement.disabled=!0},e.prototype.isDisabled=function(){return!0===this.selectElement.disabled},e.prototype.enable=function(){this.selectElement.disabled=!1},e.prototype.getValue=function(){return this.selectElement.value},e.prototype.hasValue=function(e){for(var t=0,n=this.options;t<n.length;t++){if(n[t].value===e)return!0}return!1},e.prototype.setValue=function(e){if(!this.hasValue(e))throw new Error("".concat(e," is not present in the camera list."));this.selectElement.value=e},e.prototype.hasSingleItem=function(){return 1===this.cameras.length},e.prototype.numCameras=function(){return this.cameras.length},e.create=function(t,n){var g=new e(n);return g.render(t),g},e}(),HG=function(){function e(){this.onChangeCallback=null,this.zoomElementContainer=document.createElement("div"),this.rangeInput=WG.createElement("input",wG.ZOOM_SLIDER_ID),this.rangeInput.type="range",this.rangeText=document.createElement("span"),this.rangeInput.min="1",this.rangeInput.max="5",this.rangeInput.value="1",this.rangeInput.step="0.1"}return e.prototype.render=function(e,t){this.zoomElementContainer.style.display=t?"block":"none",this.zoomElementContainer.style.padding="5px 10px",this.zoomElementContainer.style.textAlign="center",e.appendChild(this.zoomElementContainer),this.rangeInput.style.display="inline-block",this.rangeInput.style.width="50%",this.rangeInput.style.height="5px",this.rangeInput.style.background="#d3d3d3",this.rangeInput.style.outline="none",this.rangeInput.style.opacity="0.7";var n=kf.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(n),this.rangeText.style.marginRight="10px";var g=this;this.rangeInput.addEventListener("input",(function(){return g.onValueChange()})),this.rangeInput.addEventListener("change",(function(){return g.onValueChange()})),this.zoomElementContainer.appendChild(this.rangeInput),this.zoomElementContainer.appendChild(this.rangeText)},e.prototype.onValueChange=function(){var e=kf.zoom();this.rangeText.innerText="".concat(this.rangeInput.value,"x ").concat(e),this.onChangeCallback&&this.onChangeCallback(parseFloat(this.rangeInput.value))},e.prototype.setValues=function(e,t,n,g){this.rangeInput.min=e.toString(),this.rangeInput.max=t.toString(),this.rangeInput.step=g.toString(),this.rangeInput.value=n.toString(),this.onValueChange()},e.prototype.show=function(){this.zoomElementContainer.style.display="block"},e.prototype.hide=function(){this.zoomElementContainer.style.display="none"},e.prototype.setOnCameraZoomValueChangeCallback=function(e){this.onChangeCallback=e},e.prototype.removeOnCameraZoomValueChangeCallback=function(){this.onChangeCallback=null},e.create=function(t,n){var g=new e;return g.render(t,n),g},e}();(aG=sG||(sG={}))[aG.STATUS_DEFAULT=0]="STATUS_DEFAULT",aG[aG.STATUS_SUCCESS=1]="STATUS_SUCCESS",aG[aG.STATUS_WARNING=2]="STATUS_WARNING",aG[aG.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION";var FG=function(){function e(e,t,n){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=e,this.config=this.createConfig(t),this.verbose=!0===n,!document.getElementById(e))throw"HTML Element with id=".concat(e," not found");this.scanTypeSelector=new VG(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new Vf(this.verbose),this.persistedDataManager=new ZG,!0!==t.rememberLastUsedCamera&&this.persistedDataManager.reset()}return e.prototype.render=function(e,t){var n=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(t,g){if(e)e(t,g);else{if(n.lastMatchFound===t)return;n.lastMatchFound=t,n.setHeaderMessage(kf.lastMatch(t),sG.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(e,n){t&&t(e,n)};var g,r,i=document.getElementById(this.elementId);if(!i)throw"HTML Element with id=".concat(this.elementId," not found");i.innerHTML="",this.createBasicLayout(i),this.html5Qrcode=new AG(this.getScanRegionId(),(g=this.config,r=this.verbose,{formatsToSupport:g.formatsToSupport,useBarCodeDetectorIfSupported:g.useBarCodeDetectorIfSupported,experimentalFeatures:g.experimentalFeatures,verbose:r}))},e.prototype.pause=function(e){(wf(e)||!0!==e)&&(e=!1),this.getHtml5QrcodeOrFail().pause(e)},e.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},e.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},e.prototype.clear=function(){var e=this,t=function(){var t=document.getElementById(e.elementId);t&&(t.innerHTML="",e.resetBasicLayout(t))};return this.html5Qrcode?new Promise((function(n,g){e.html5Qrcode?e.html5Qrcode.isScanning?e.html5Qrcode.stop().then((function(g){e.html5Qrcode?(e.html5Qrcode.clear(),t(),n()):n()})).catch((function(t){e.verbose&&e.logger.logError("Unable to stop qrcode scanner",t),g(t)})):(e.html5Qrcode.clear(),t(),n()):n()})):Promise.resolve()},e.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},e.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},e.prototype.applyVideoConstraints=function(e){return this.getHtml5QrcodeOrFail().applyVideoConstraints(e)},e.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},e.prototype.createConfig=function(e){return e?(e.fps||(e.fps=Bf.SCAN_DEFAULT_FPS),e.rememberLastUsedCamera!==!Bf.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(e.rememberLastUsedCamera=Bf.DEFAULT_REMEMBER_LAST_CAMERA_USED),e.supportedScanTypes||(e.supportedScanTypes=Bf.DEFAULT_SUPPORTED_SCAN_TYPE),e):{fps:Bf.SCAN_DEFAULT_FPS,rememberLastUsedCamera:Bf.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:Bf.DEFAULT_SUPPORTED_SCAN_TYPE}},e.prototype.createBasicLayout=function(e){e.style.position="relative",e.style.padding="0px",e.style.border="1px solid silver",this.createHeader(e);var t=document.createElement("div"),n=this.getScanRegionId();t.id=n,t.style.width="100%",t.style.minHeight="100px",t.style.textAlign="center",e.appendChild(t),VG.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var g=document.createElement("div"),r=this.getDashboardId();g.id=r,g.style.width="100%",e.appendChild(g),this.setupInitialDashboard(g)},e.prototype.resetBasicLayout=function(e){e.style.border="none"},e.prototype.setupInitialDashboard=function(e){this.createSection(e),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},e.prototype.createHeader=function(e){var t=document.createElement("div");t.style.textAlign="left",t.style.margin="0px",e.appendChild(t),(new BG).renderInto(t);var n=document.createElement("div");n.id=this.getHeaderMessageContainerId(),n.style.display="none",n.style.textAlign="center",n.style.fontSize="14px",n.style.padding="2px 10px",n.style.margin="4px",n.style.borderTop="1px solid #f6f6f6",t.appendChild(n)},e.prototype.createSection=function(e){var t=document.createElement("div");t.id=this.getDashboardSectionId(),t.style.width="100%",t.style.padding="10px 0px 10px 0px",t.style.textAlign="left",e.appendChild(t)},e.prototype.createCameraListUi=function(e,t,n){var g=this;g.showHideScanTypeSwapLink(!1),g.setHeaderMessage(kf.cameraPermissionRequesting());var r=function(){n||g.createPermissionButton(e,t)};AG.getCameras().then((function(n){g.persistedDataManager.setHasPermission(!0),g.showHideScanTypeSwapLink(!0),g.resetHeaderMessage(),n&&n.length>0?(e.removeChild(t),g.renderCameraSelection(n)):(g.setHeaderMessage(kf.noCameraFound(),sG.STATUS_WARNING),r())})).catch((function(e){g.persistedDataManager.setHasPermission(!1),n?n.disabled=!1:r(),g.setHeaderMessage(e,sG.STATUS_WARNING),g.showHideScanTypeSwapLink(!0)}))},e.prototype.createPermissionButton=function(e,t){var n=this,g=WG.createElement("button",this.getCameraPermissionButtonId());g.innerText=kf.cameraPermissionTitle(),g.addEventListener("click",(function(){g.disabled=!0,n.createCameraListUi(e,t,g)})),t.appendChild(g)},e.prototype.createPermissionsUi=function(e,t){var n=this;VG.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()?vG.hasPermissions().then((function(g){g?n.createCameraListUi(e,t):(n.persistedDataManager.setHasPermission(!1),n.createPermissionButton(e,t))})).catch((function(g){n.persistedDataManager.setHasPermission(!1),n.createPermissionButton(e,t)})):this.createPermissionButton(e,t)},e.prototype.createSectionControlPanel=function(){var e=document.getElementById(this.getDashboardSectionId()),t=document.createElement("div");e.appendChild(t);var n=document.createElement("div");n.id=this.getDashboardSectionCameraScanRegionId(),n.style.display=VG.isCameraScanType(this.currentScanType)?"block":"none",t.appendChild(n);var g=document.createElement("div");g.style.textAlign="center",n.appendChild(g),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(n,g),this.renderFileScanUi(t)},e.prototype.renderFileScanUi=function(e){var t=VG.isFileScanType(this.currentScanType),n=this;this.fileSelectionUi=YG.create(e,t,(function(e){if(!n.html5Qrcode)throw"html5Qrcode not defined";VG.isFileScanType(n.currentScanType)&&(n.setHeaderMessage(kf.loadingImage()),n.html5Qrcode.scanFileV2(e,!0).then((function(e){n.resetHeaderMessage(),n.qrCodeSuccessCallback(e.decodedText,e)})).catch((function(e){n.setHeaderMessage(e,sG.STATUS_WARNING),n.qrCodeErrorCallback(e,vf.createFrom(e))})))}))},e.prototype.renderCameraSelection=function(e){var t=this,n=this,g=document.getElementById(this.getDashboardSectionCameraScanRegionId());g.style.textAlign="center";var r=HG.create(g,!1),i=EG.create(g,e),o=document.createElement("span"),s=WG.createElement("button",wG.CAMERA_START_BUTTON_ID);s.innerText=kf.scanButtonStartScanningText(),o.appendChild(s);var a,I=WG.createElement("button",wG.CAMERA_STOP_BUTTON_ID);I.innerText=kf.scanButtonStopScanningText(),I.style.display="none",I.disabled=!0,o.appendChild(I);g.appendChild(o);var l=function(e){e||(s.style.display="none"),s.innerText=kf.scanButtonStartScanningText(),s.style.opacity="1",s.disabled=!1,e&&(s.style.display="inline-block")};if(s.addEventListener("click",(function(e){s.innerText=kf.scanButtonScanningStarting(),i.disable(),s.disabled=!0,s.style.opacity="0.5",t.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!1),n.resetHeaderMessage();var g,C=i.getValue();n.persistedDataManager.setLastUsedCameraId(C),n.html5Qrcode.start(C,(g=n.config,{fps:g.fps,qrbox:g.qrbox,aspectRatio:g.aspectRatio,disableFlip:g.disableFlip,videoConstraints:g.videoConstraints}),n.qrCodeSuccessCallback,n.qrCodeErrorCallback).then((function(e){I.disabled=!1,I.style.display="inline-block",l(!1);var g=n.html5Qrcode.getRunningTrackCameraCapabilities();!0===t.config.showTorchButtonIfSupported&&function(e){e.torchFeature().isSupported()?(a?a.updateTorchCapability(e.torchFeature()):a=JG.create(o,e.torchFeature(),{display:"none",marginLeft:"5px"},(function(e){n.setHeaderMessage(e,sG.STATUS_WARNING)})),a.show()):a&&a.hide()}(g),!0===t.config.showZoomSliderIfSupported&&function(e){var n=e.zoomFeature();if(n.isSupported()){r.setOnCameraZoomValueChangeCallback((function(e){n.apply(e)}));var g,i,o,s=1;t.config.defaultZoomValueIfSupported&&(s=t.config.defaultZoomValueIfSupported),g=s,i=n.min(),s=g>(o=n.max())?o:g<i?i:g,r.setValues(n.min(),n.max(),s,n.step()),r.show()}}(g)})).catch((function(e){n.showHideScanTypeSwapLink(!0),i.enable(),l(!0),n.setHeaderMessage(e,sG.STATUS_WARNING)}))})),i.hasSingleItem()&&s.click(),I.addEventListener("click",(function(e){if(!n.html5Qrcode)throw"html5Qrcode not defined";I.disabled=!0,n.html5Qrcode.stop().then((function(e){t.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!0),i.enable(),s.disabled=!1,I.style.display="none",s.style.display="inline-block",a&&(a.reset(),a.hide()),r.removeOnCameraZoomValueChangeCallback(),r.hide(),n.insertCameraScanImageToScanRegion()})).catch((function(e){I.disabled=!1,n.setHeaderMessage(e,sG.STATUS_WARNING)}))})),n.persistedDataManager.getLastUsedCameraId()){var C=n.persistedDataManager.getLastUsedCameraId();i.hasValue(C)?(i.setValue(C),s.click()):n.persistedDataManager.resetLastUsedCameraId()}},e.prototype.createSectionSwap=function(){var e=this,t=kf.textIfCameraScanSelected(),n=kf.textIfFileScanSelected(),g=document.getElementById(this.getDashboardSectionId()),r=document.createElement("div");r.style.textAlign="center";var i=WG.createElement("span",this.getDashboardSectionSwapLinkId());i.style.textDecoration="underline",i.style.cursor="pointer",i.innerText=VG.isCameraScanType(this.currentScanType)?t:n,i.addEventListener("click",(function(){e.sectionSwapAllowed?(e.resetHeaderMessage(),e.fileSelectionUi.resetValue(),e.sectionSwapAllowed=!1,VG.isCameraScanType(e.currentScanType)?(e.clearScanRegion(),e.getCameraScanRegion().style.display="none",e.fileSelectionUi.show(),i.innerText=n,e.currentScanType=bf.SCAN_TYPE_FILE,e.insertFileScanImageToScanRegion()):(e.clearScanRegion(),e.getCameraScanRegion().style.display="block",e.fileSelectionUi.hide(),i.innerText=t,e.currentScanType=bf.SCAN_TYPE_CAMERA,e.insertCameraScanImageToScanRegion(),e.startCameraScanIfPermissionExistsOnSwap()),e.sectionSwapAllowed=!0):e.verbose&&e.logger.logError("Section swap called when not allowed")})),r.appendChild(i),g.appendChild(r)},e.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var e=this,t=this;this.persistedDataManager.hasCameraPermissions()&&vG.hasPermissions().then((function(n){if(n){var g=document.getElementById(t.getCameraPermissionButtonId());if(!g)throw e.logger.logError("Permission button not found, fail;"),"Permission button not found";g.click()}else t.persistedDataManager.setHasPermission(!1)})).catch((function(e){t.persistedDataManager.setHasPermission(!1)}))},e.prototype.resetHeaderMessage=function(){document.getElementById(this.getHeaderMessageContainerId()).style.display="none"},e.prototype.setHeaderMessage=function(e,t){t||(t=sG.STATUS_DEFAULT);var n=this.getHeaderMessageDiv();switch(n.innerText=e,n.style.display="block",t){case sG.STATUS_SUCCESS:n.style.background="rgba(106, 175, 80, 0.26)",n.style.color="#477735";break;case sG.STATUS_WARNING:n.style.background="rgba(203, 36, 49, 0.14)",n.style.color="#cb2431";break;case sG.STATUS_DEFAULT:default:n.style.background="rgba(0, 0, 0, 0)",n.style.color="rgb(17, 17, 17)"}},e.prototype.showHideScanTypeSwapLink=function(e){this.scanTypeSelector.hasMoreThanOneScanType()&&(!0!==e&&(e=!1),this.sectionSwapAllowed=e,this.getDashboardSectionSwapLink().style.display=e?"inline-block":"none")},e.prototype.insertCameraScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.cameraScanImage)return t.innerHTML="<br>",void t.appendChild(this.cameraScanImage);this.cameraScanImage=new Image,this.cameraScanImage.onload=function(n){t.innerHTML="<br>",t.appendChild(e.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=mG,this.cameraScanImage.alt=kf.cameraScanAltText()},e.prototype.insertFileScanImageToScanRegion=function(){var e=this,t=document.getElementById(this.getScanRegionId());if(this.fileScanImage)return t.innerHTML="<br>",void t.appendChild(this.fileScanImage);this.fileScanImage=new Image,this.fileScanImage.onload=function(n){t.innerHTML="<br>",t.appendChild(e.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=bG,this.fileScanImage.alt=kf.fileScanAltText()},e.prototype.clearScanRegion=function(){document.getElementById(this.getScanRegionId()).innerHTML=""},e.prototype.getDashboardSectionId=function(){return"".concat(this.elementId,"__dashboard_section")},e.prototype.getDashboardSectionCameraScanRegionId=function(){return"".concat(this.elementId,"__dashboard_section_csr")},e.prototype.getDashboardSectionSwapLinkId=function(){return wG.SCAN_TYPE_CHANGE_ANCHOR_ID},e.prototype.getScanRegionId=function(){return"".concat(this.elementId,"__scan_region")},e.prototype.getDashboardId=function(){return"".concat(this.elementId,"__dashboard")},e.prototype.getHeaderMessageContainerId=function(){return"".concat(this.elementId,"__header_message")},e.prototype.getCameraPermissionButtonId=function(){return wG.CAMERA_PERMISSION_BUTTON_ID},e.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},e.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},e.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())},e}();const xG=()=>{const[t,n]=e.useState(!0),[g,r]=e.useState(null),[i,o]=e.useState(!1),[s,a]=e.useState(""),I=e.useCallback((async e=>{try{o(!0),a("");let t=null;if(e.includes("?id=")){t=new URL(e).searchParams.get("id")}else if(e.includes("/invitation/")){const n=e.split("/invitation/");n.length>1&&(t=n[1].split("?")[0])}else t=e;if(!t)throw new Error("Format de QR code invalide. Aucun ID trouvé.");const n=await Sp.recordScan(t,{scannedBy:"admin",deviceInfo:navigator.userAgent}),g=await Sp.getGuestById(t);if(!g)throw new Error("Invité non trouvé avec cet ID: "+t);const i=await Sp.getGuestScans(t);r({...g,scanHistory:i,lastScanId:n})}catch(t){a(t.message||"Erreur lors du traitement du QR code")}finally{o(!1)}}),[]);e.useEffect((()=>{let e=null;if(t){e=new FG("qr-reader",{fps:5,qrbox:{width:250,height:250},rememberLastUsedCamera:!0,aspectRatio:1,disableFlip:!0,formatsToSupport:[0]},!1);const t=async t=>{e&&(e.clear(),e=null),n(!1),await I(t)},g=()=>{};e.render(t,g)}return()=>{e&&(e.clear(),e=null)}}),[t,I]);const l=e.useCallback((()=>{r(null),a(""),n(!0)}),[]),C=e.useCallback((e=>{if(!e)return"N/A";if(e.toDate&&"function"==typeof e.toDate){const t=e.toDate();return new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(t)}return e instanceof Date?new Intl.DateTimeFormat("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(e):"Format de date inconnu"}),[]);return p.jsxs("div",{className:"bg-secondary min-h-screen pb-10",children:[p.jsx("header",{className:"bg-primary text-white py-8 px-4",children:p.jsxs("div",{className:"max-w-4xl mx-auto",children:[p.jsx("h1",{className:"font-elegant text-3xl",children:"Scanner d'Invitations"}),p.jsx("p",{className:"text-white/70 mt-2",children:"Scannez les QR codes des invitations pour enregistrer les arrivées"})]})}),p.jsx("div",{className:"max-w-4xl mx-auto px-4 -mt-6",children:p.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[p.jsxs(wt,{variant:"elegant",className:"p-6",children:[p.jsxs("div",{className:"text-center mb-4",children:[p.jsx("h2",{className:"font-elegant text-2xl text-primary-dark mb-2",children:t?"Scannez un QR code":"Résultat du scan"}),p.jsx("p",{className:"text-muted",children:t?"Placez le QR code devant la caméra":"Détails de l&apos;invitation scannée"})]}),t?p.jsx("div",{id:"qr-reader",className:"w-full max-w-md mx-auto"}):p.jsx("div",{className:"text-center",children:i?p.jsxs("div",{className:"py-8",children:[p.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),p.jsx("p",{className:"mt-4 text-muted",children:"Traitement du QR code..."})]}):s?p.jsxs("div",{className:"py-8",children:[p.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[p.jsx("strong",{className:"font-bold",children:"Erreur!"}),p.jsxs("span",{className:"block sm:inline",children:[" ",s]})]}),p.jsx(Pe,{variant:"primary",className:"mt-6",onClick:l,children:"Réessayer"})]}):g?p.jsxs("div",{className:"py-4",children:[p.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6",children:p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsxs("div",{children:[p.jsx("span",{className:"text-xl font-semibold block",children:g.name}),p.jsxs("span",{className:"block",children:["Groupe: ",g.group]}),p.jsx("span",{className:"block mt-1",children:g.count>1?`${g.count} personnes`:"1 personne"})]}),p.jsxs("div",{className:"text-right",children:[p.jsx("span",{className:"block font-bold text-2xl",children:g.scanCount||1}),p.jsx("span",{className:"text-sm",children:g.scanCount>1?"scans":"scan"})]})]})}),g.scanHistory&&g.scanHistory.length>0&&p.jsxs("div",{className:"mb-6",children:[p.jsx("h3",{className:"font-semibold text-lg text-primary-dark mb-3",children:"Historique des scans"}),p.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:p.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[p.jsx("thead",{className:"bg-gray-50",children:p.jsxs("tr",{children:[p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date et heure"}),p.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Scanné par"})]})}),p.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.scanHistory.map(((e,t)=>p.jsxs("tr",{className:e.id===g.lastScanId?"bg-green-50":"",children:[p.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:C(e.timestamp)}),p.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.scannedBy||"Admin"})]},e.id||t)))})]})})]}),p.jsxs(Pe,{variant:"primary",className:"mt-4",onClick:l,children:[p.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:p.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Scanner un autre QR code"]})]}):p.jsxs("div",{className:"py-8",children:[p.jsx("p",{className:"text-muted",children:"Aucun résultat de scan disponible"}),p.jsx(Pe,{variant:"primary",className:"mt-4",onClick:l,children:"Réessayer"})]})})]}),p.jsxs(wt,{variant:"flat",className:"p-6",children:[p.jsx("h3",{className:"font-elegant text-xl text-primary-dark mb-3",children:"Comment ça marche?"}),p.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-muted",children:[p.jsx("li",{children:"Autorisez l'accès à la caméra lorsque le navigateur vous le demande"}),p.jsx("li",{children:"Présentez le QR code de l'invitation face à la caméra"}),p.jsx("li",{children:"Le système détectera automatiquement le code et affichera les informations"}),p.jsx("li",{children:"Chaque scan est enregistré dans la base de données avec horodatage"}),p.jsx("li",{children:"Si un invité présente plusieurs fois son QR code, tous les scans seront enregistrés"})]})]})]})})]})},TG=({children:e})=>{const t=(()=>{const e=localStorage.getItem("authBlocked");if(e){const t=3e5,n=Date.now()-parseInt(e,10);return n<t?Math.ceil((t-n)/6e4):(localStorage.removeItem("authBlocked"),0)}return 0})();return t>0?(localStorage.setItem("authMessage",`Accès temporairement bloqué. Réessayez dans ${t} minute(s).`),p.jsx(Be,{to:"/",replace:!0})):(()=>{const e=localStorage.getItem("adminAuth");if(!e)return!1;try{const t=ZZ?ZZ(e):JSON.parse(e);if(!t)return!1;const{isAuthenticated:n,timestamp:g}=t,r=Date.now();return n&&r-g<864e5}catch(Vye){return!1}})()?e:p.jsx(Be,{to:"/admin-login",replace:!0})},KG=()=>(e.useEffect((()=>{["https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap","https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&display=swap"].forEach((e=>{const t=document.createElement("link");t.rel="preload",t.as="style",t.href=e,document.head.appendChild(t)}))}),[]),p.jsx(Xe,{children:p.jsxs(ve,{children:[p.jsx(Se,{path:"/",element:p.jsx(Vp,{})}),p.jsx(Se,{path:"/admin-login",element:p.jsx(fZ,{})}),p.jsx(Se,{path:"/admin",element:p.jsx(TG,{children:p.jsx(Rp,{})})}),p.jsx(Se,{path:"/scanner",element:p.jsx(TG,{children:p.jsx(cf,{})})}),p.jsx(Se,{path:"/qr-scanner",element:p.jsx(TG,{children:p.jsx(xG,{})})}),p.jsx(Se,{path:"/invitation/:guestId",element:p.jsx(rt,{})}),p.jsx(Se,{path:"*",element:p.jsx(Be,{to:"/",replace:!0})})]})}));var MG=function(e){return e&&e.Math===Math&&e},DG=MG("object"==typeof globalThis&&globalThis)||MG("object"==typeof window&&window)||MG("object"==typeof self&&self)||MG("object"==typeof o&&o)||MG("object"==typeof o&&o)||function(){return this}()||Function("return this")(),LG={},UG=function(e){try{return!!e()}catch(Vye){return!0}},zG=!UG((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})),QG=!UG((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),OG=QG,jG=Function.prototype.call,PG=OG?jG.bind(jG):function(){return jG.apply(jG,arguments)},_G={},qG={}.propertyIsEnumerable,$G=Object.getOwnPropertyDescriptor,eB=$G&&!qG.call({1:2},1);_G.f=eB?function(e){var t=$G(this,e);return!!t&&t.enumerable}:qG;var tB,nB,gB=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},rB=QG,iB=Function.prototype,oB=iB.call,sB=rB&&iB.bind.bind(oB,oB),aB=rB?sB:function(e){return function(){return oB.apply(e,arguments)}},IB=aB,lB=IB({}.toString),CB=IB("".slice),cB=function(e){return CB(lB(e),8,-1)},dB=UG,uB=cB,AB=Object,hB=aB("".split),mB=dB((function(){return!AB("z").propertyIsEnumerable(0)}))?function(e){return"String"===uB(e)?hB(e,""):AB(e)}:AB,bB=function(e){return null==e},pB=bB,yB=TypeError,ZB=function(e){if(pB(e))throw new yB("Can't call method on "+e);return e},fB=mB,GB=ZB,BB=function(e){return fB(GB(e))},SB="object"==typeof document&&document.all,RB=void 0===SB&&void 0!==SB?function(e){return"function"==typeof e||e===SB}:function(e){return"function"==typeof e},vB=RB,VB=function(e){return"object"==typeof e?null!==e:vB(e)},wB=DG,WB=RB,kB=function(e,t){return arguments.length<2?(n=wB[e],WB(n)?n:void 0):wB[e]&&wB[e][t];var n},XB=aB({}.isPrototypeOf),NB=DG.navigator,JB=NB&&NB.userAgent,YB=JB?String(JB):"",EB=DG,HB=YB,FB=EB.process,xB=EB.Deno,TB=FB&&FB.versions||xB&&xB.version,KB=TB&&TB.v8;KB&&(nB=(tB=KB.split("."))[0]>0&&tB[0]<4?1:+(tB[0]+tB[1])),!nB&&HB&&(!(tB=HB.match(/Edge\/(\d+)/))||tB[1]>=74)&&(tB=HB.match(/Chrome\/(\d+)/))&&(nB=+tB[1]);var MB=nB,DB=MB,LB=UG,UB=DG.String,zB=!!Object.getOwnPropertySymbols&&!LB((function(){var e=Symbol("symbol detection");return!UB(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&DB&&DB<41})),QB=zB&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,OB=kB,jB=RB,PB=XB,_B=Object,qB=QB?function(e){return"symbol"==typeof e}:function(e){var t=OB("Symbol");return jB(t)&&PB(t.prototype,_B(e))},$B=String,eS=function(e){try{return $B(e)}catch(Vye){return"Object"}},tS=RB,nS=eS,gS=TypeError,rS=function(e){if(tS(e))return e;throw new gS(nS(e)+" is not a function")},iS=rS,oS=bB,sS=function(e,t){var n=e[t];return oS(n)?void 0:iS(n)},aS=PG,IS=RB,lS=VB,CS=TypeError,cS=function(e,t){var n,g;if("string"===t&&IS(n=e.toString)&&!lS(g=aS(n,e)))return g;if(IS(n=e.valueOf)&&!lS(g=aS(n,e)))return g;if("string"!==t&&IS(n=e.toString)&&!lS(g=aS(n,e)))return g;throw new CS("Can't convert object to primitive value")},dS={exports:{}},uS=DG,AS=Object.defineProperty,hS=function(e,t){try{AS(uS,e,{value:t,configurable:!0,writable:!0})}catch(Vye){uS[e]=t}return t},mS=DG,bS=hS,pS="__core-js_shared__",yS=dS.exports=mS[pS]||bS(pS,{});(yS.versions||(yS.versions=[])).push({version:"3.42.0",mode:"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var ZS=dS.exports,fS=ZS,GS=function(e,t){return fS[e]||(fS[e]=t||{})},BS=ZB,SS=Object,RS=function(e){return SS(BS(e))},vS=RS,VS=aB({}.hasOwnProperty),wS=Object.hasOwn||function(e,t){return VS(vS(e),t)},WS=aB,kS=0,XS=Math.random(),NS=WS(1..toString),JS=function(e){return"Symbol("+(void 0===e?"":e)+")_"+NS(++kS+XS,36)},YS=GS,ES=wS,HS=JS,FS=zB,xS=QB,TS=DG.Symbol,KS=YS("wks"),MS=xS?TS.for||TS:TS&&TS.withoutSetter||HS,DS=function(e){return ES(KS,e)||(KS[e]=FS&&ES(TS,e)?TS[e]:MS("Symbol."+e)),KS[e]},LS=PG,US=VB,zS=qB,QS=sS,OS=cS,jS=TypeError,PS=DS("toPrimitive"),_S=function(e,t){if(!US(e)||zS(e))return e;var n,g=QS(e,PS);if(g){if(void 0===t&&(t="default"),n=LS(g,e,t),!US(n)||zS(n))return n;throw new jS("Can't convert object to primitive value")}return void 0===t&&(t="number"),OS(e,t)},qS=_S,$S=qB,eR=function(e){var t=qS(e,"string");return $S(t)?t:t+""},tR=VB,nR=DG.document,gR=tR(nR)&&tR(nR.createElement),rR=function(e){return gR?nR.createElement(e):{}},iR=rR,oR=!zG&&!UG((function(){return 7!==Object.defineProperty(iR("div"),"a",{get:function(){return 7}}).a})),sR=zG,aR=PG,IR=_G,lR=gB,CR=BB,cR=eR,dR=wS,uR=oR,AR=Object.getOwnPropertyDescriptor;LG.f=sR?AR:function(e,t){if(e=CR(e),t=cR(t),uR)try{return AR(e,t)}catch(Vye){}if(dR(e,t))return lR(!aR(IR.f,e,t),e[t])};var hR={},mR=zG&&UG((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),bR=VB,pR=String,yR=TypeError,ZR=function(e){if(bR(e))return e;throw new yR(pR(e)+" is not an object")},fR=zG,GR=oR,BR=mR,SR=ZR,RR=eR,vR=TypeError,VR=Object.defineProperty,wR=Object.getOwnPropertyDescriptor,WR="enumerable",kR="configurable",XR="writable";hR.f=fR?BR?function(e,t,n){if(SR(e),t=RR(t),SR(n),"function"==typeof e&&"prototype"===t&&"value"in n&&XR in n&&!n[XR]){var g=wR(e,t);g&&g[XR]&&(e[t]=n.value,n={configurable:kR in n?n[kR]:g[kR],enumerable:WR in n?n[WR]:g[WR],writable:!1})}return VR(e,t,n)}:VR:function(e,t,n){if(SR(e),t=RR(t),SR(n),GR)try{return VR(e,t,n)}catch(Vye){}if("get"in n||"set"in n)throw new vR("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var NR=hR,JR=gB,YR=zG?function(e,t,n){return NR.f(e,t,JR(1,n))}:function(e,t,n){return e[t]=n,e},ER={exports:{}},HR=zG,FR=wS,xR=Function.prototype,TR=HR&&Object.getOwnPropertyDescriptor,KR=FR(xR,"name"),MR={EXISTS:KR,PROPER:KR&&"something"===function(){}.name,CONFIGURABLE:KR&&(!HR||HR&&TR(xR,"name").configurable)},DR=RB,LR=ZS,UR=aB(Function.toString);DR(LR.inspectSource)||(LR.inspectSource=function(e){return UR(e)});var zR,QR,OR,jR=LR.inspectSource,PR=RB,_R=DG.WeakMap,qR=PR(_R)&&/native code/.test(String(_R)),$R=JS,ev=GS("keys"),tv=function(e){return ev[e]||(ev[e]=$R(e))},nv={},gv=qR,rv=DG,iv=VB,ov=YR,sv=wS,av=ZS,Iv=tv,lv=nv,Cv="Object already initialized",cv=rv.TypeError,dv=rv.WeakMap;if(gv||av.state){var uv=av.state||(av.state=new dv);uv.get=uv.get,uv.has=uv.has,uv.set=uv.set,zR=function(e,t){if(uv.has(e))throw new cv(Cv);return t.facade=e,uv.set(e,t),t},QR=function(e){return uv.get(e)||{}},OR=function(e){return uv.has(e)}}else{var Av=Iv("state");lv[Av]=!0,zR=function(e,t){if(sv(e,Av))throw new cv(Cv);return t.facade=e,ov(e,Av,t),t},QR=function(e){return sv(e,Av)?e[Av]:{}},OR=function(e){return sv(e,Av)}}var hv={set:zR,get:QR,has:OR,enforce:function(e){return OR(e)?QR(e):zR(e,{})},getterFor:function(e){return function(t){var n;if(!iv(t)||(n=QR(t)).type!==e)throw new cv("Incompatible receiver, "+e+" required");return n}}},mv=aB,bv=UG,pv=RB,yv=wS,Zv=zG,fv=MR.CONFIGURABLE,Gv=jR,Bv=hv.enforce,Sv=hv.get,Rv=String,vv=Object.defineProperty,Vv=mv("".slice),wv=mv("".replace),Wv=mv([].join),kv=Zv&&!bv((function(){return 8!==vv((function(){}),"length",{value:8}).length})),Xv=String(String).split("String"),Nv=ER.exports=function(e,t,n){"Symbol("===Vv(Rv(t),0,7)&&(t="["+wv(Rv(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!yv(e,"name")||fv&&e.name!==t)&&(Zv?vv(e,"name",{value:t,configurable:!0}):e.name=t),kv&&n&&yv(n,"arity")&&e.length!==n.arity&&vv(e,"length",{value:n.arity});try{n&&yv(n,"constructor")&&n.constructor?Zv&&vv(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(Vye){}var g=Bv(e);return yv(g,"source")||(g.source=Wv(Xv,"string"==typeof t?t:"")),e};Function.prototype.toString=Nv((function(){return pv(this)&&Sv(this).source||Gv(this)}),"toString");var Jv=ER.exports,Yv=RB,Ev=hR,Hv=Jv,Fv=hS,xv=function(e,t,n,g){g||(g={});var r=g.enumerable,i=void 0!==g.name?g.name:t;if(Yv(n)&&Hv(n,i,g),g.global)r?e[t]=n:Fv(t,n);else{try{g.unsafe?e[t]&&(r=!0):delete e[t]}catch(Vye){}r?e[t]=n:Ev.f(e,t,{value:n,enumerable:!1,configurable:!g.nonConfigurable,writable:!g.nonWritable})}return e},Tv={},Kv=Math.ceil,Mv=Math.floor,Dv=Math.trunc||function(e){var t=+e;return(t>0?Mv:Kv)(t)},Lv=Dv,Uv=function(e){var t=+e;return t!=t||0===t?0:Lv(t)},zv=Uv,Qv=Math.max,Ov=Math.min,jv=function(e,t){var n=zv(e);return n<0?Qv(n+t,0):Ov(n,t)},Pv=Uv,_v=Math.min,qv=function(e){var t=Pv(e);return t>0?_v(t,9007199254740991):0},$v=qv,eV=function(e){return $v(e.length)},tV=BB,nV=jv,gV=eV,rV=function(e){return function(t,n,g){var r=tV(t),i=gV(r);if(0===i)return!e&&-1;var o,s=nV(g,i);if(e&&n!=n){for(;i>s;)if((o=r[s++])!=o)return!0}else for(;i>s;s++)if((e||s in r)&&r[s]===n)return e||s||0;return!e&&-1}},iV={includes:rV(!0),indexOf:rV(!1)},oV=wS,sV=BB,aV=iV.indexOf,IV=nv,lV=aB([].push),CV=function(e,t){var n,g=sV(e),r=0,i=[];for(n in g)!oV(IV,n)&&oV(g,n)&&lV(i,n);for(;t.length>r;)oV(g,n=t[r++])&&(~aV(i,n)||lV(i,n));return i},cV=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],dV=CV,uV=cV.concat("length","prototype");Tv.f=Object.getOwnPropertyNames||function(e){return dV(e,uV)};var AV={};AV.f=Object.getOwnPropertySymbols;var hV=kB,mV=Tv,bV=AV,pV=ZR,yV=aB([].concat),ZV=hV("Reflect","ownKeys")||function(e){var t=mV.f(pV(e)),n=bV.f;return n?yV(t,n(e)):t},fV=wS,GV=ZV,BV=LG,SV=hR,RV=function(e,t,n){for(var g=GV(t),r=SV.f,i=BV.f,o=0;o<g.length;o++){var s=g[o];fV(e,s)||n&&fV(n,s)||r(e,s,i(t,s))}},vV=UG,VV=RB,wV=/#|\.prototype\./,WV=function(e,t){var n=XV[kV(e)];return n===JV||n!==NV&&(VV(t)?vV(t):!!t)},kV=WV.normalize=function(e){return String(e).replace(wV,".").toLowerCase()},XV=WV.data={},NV=WV.NATIVE="N",JV=WV.POLYFILL="P",YV=WV,EV=DG,HV=LG.f,FV=YR,xV=xv,TV=hS,KV=RV,MV=YV,DV=function(e,t){var n,g,r,i,o,s=e.target,a=e.global,I=e.stat;if(n=a?EV:I?EV[s]||TV(s,{}):EV[s]&&EV[s].prototype)for(g in t){if(i=t[g],r=e.dontCallGetSet?(o=HV(n,g))&&o.value:n[g],!MV(a?g:s+(I?".":"#")+g,e.forced)&&void 0!==r){if(typeof i==typeof r)continue;KV(i,r)}(e.sham||r&&r.sham)&&FV(i,"sham",!0),xV(n,g,i,e)}},LV={};LV[DS("toStringTag")]="z";var UV="[object z]"===String(LV),zV=UV,QV=RB,OV=cB,jV=DS("toStringTag"),PV=Object,_V="Arguments"===OV(function(){return arguments}()),qV=zV?OV:function(e){var t,n,g;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(Vye){}}(t=PV(e),jV))?n:_V?OV(t):"Object"===(g=OV(t))&&QV(t.callee)?"Arguments":g},$V=qV,ew=String,tw=function(e){if("Symbol"===$V(e))throw new TypeError("Cannot convert a Symbol value to a string");return ew(e)},nw={},gw=CV,rw=cV,iw=Object.keys||function(e){return gw(e,rw)},ow=zG,sw=mR,aw=hR,Iw=ZR,lw=BB,Cw=iw;nw.f=ow&&!sw?Object.defineProperties:function(e,t){Iw(e);for(var n,g=lw(t),r=Cw(t),i=r.length,o=0;i>o;)aw.f(e,n=r[o++],g[n]);return e};var cw,dw=kB("document","documentElement"),uw=ZR,Aw=nw,hw=cV,mw=nv,bw=dw,pw=rR,yw="prototype",Zw="script",fw=tv("IE_PROTO"),Gw=function(){},Bw=function(e){return"<"+Zw+">"+e+"</"+Zw+">"},Sw=function(e){e.write(Bw("")),e.close();var t=e.parentWindow.Object;return e=null,t},Rw=function(){try{cw=new ActiveXObject("htmlfile")}catch(Vye){}var e,t,n;Rw="undefined"!=typeof document?document.domain&&cw?Sw(cw):(t=pw("iframe"),n="java"+Zw+":",t.style.display="none",bw.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Bw("document.F=Object")),e.close(),e.F):Sw(cw);for(var g=hw.length;g--;)delete Rw[yw][hw[g]];return Rw()};mw[fw]=!0;var vw=Object.create||function(e,t){var n;return null!==e?(Gw[yw]=uw(e),n=new Gw,Gw[yw]=null,n[fw]=e):n=Rw(),void 0===t?n:Aw.f(n,t)},Vw={},ww=aB([].slice),Ww=cB,kw=BB,Xw=Tv.f,Nw=ww,Jw="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Vw.f=function(e){return Jw&&"Window"===Ww(e)?function(e){try{return Xw(e)}catch(Vye){return Nw(Jw)}}(e):Xw(kw(e))};var Yw=Jv,Ew=hR,Hw=function(e,t,n){return n.get&&Yw(n.get,t,{getter:!0}),n.set&&Yw(n.set,t,{setter:!0}),Ew.f(e,t,n)},Fw={},xw=DS;Fw.f=xw;var Tw=DG,Kw=Tw,Mw=wS,Dw=Fw,Lw=hR.f,Uw=function(e){var t=Kw.Symbol||(Kw.Symbol={});Mw(t,e)||Lw(t,e,{value:Dw.f(e)})},zw=PG,Qw=kB,Ow=DS,jw=xv,Pw=function(){var e=Qw("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,g=Ow("toPrimitive");t&&!t[g]&&jw(t,g,(function(e){return zw(n,this)}),{arity:1})},_w=hR.f,qw=wS,$w=DS("toStringTag"),eW=function(e,t,n){e&&!n&&(e=e.prototype),e&&!qw(e,$w)&&_w(e,$w,{configurable:!0,value:t})},tW=cB,nW=aB,gW=function(e){if("Function"===tW(e))return nW(e)},rW=rS,iW=QG,oW=gW(gW.bind),sW=function(e,t){return rW(e),void 0===t?e:iW?oW(e,t):function(){return e.apply(t,arguments)}},aW=cB,IW=Array.isArray||function(e){return"Array"===aW(e)},lW=aB,CW=UG,cW=RB,dW=qV,uW=jR,AW=function(){},hW=kB("Reflect","construct"),mW=/^\s*(?:class|function)\b/,bW=lW(mW.exec),pW=!mW.test(AW),yW=function(e){if(!cW(e))return!1;try{return hW(AW,[],e),!0}catch(Vye){return!1}},ZW=function(e){if(!cW(e))return!1;switch(dW(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return pW||!!bW(mW,uW(e))}catch(Vye){return!0}};ZW.sham=!0;var fW=!hW||CW((function(){var e;return yW(yW.call)||!yW(Object)||!yW((function(){e=!0}))||e}))?ZW:yW,GW=IW,BW=fW,SW=VB,RW=DS("species"),vW=Array,VW=function(e){var t;return GW(e)&&(t=e.constructor,(BW(t)&&(t===vW||GW(t.prototype))||SW(t)&&null===(t=t[RW]))&&(t=void 0)),void 0===t?vW:t},wW=function(e,t){return new(VW(e))(0===t?0:t)},WW=sW,kW=mB,XW=RS,NW=eV,JW=wW,YW=aB([].push),EW=function(e){var t=1===e,n=2===e,g=3===e,r=4===e,i=6===e,o=7===e,s=5===e||i;return function(a,I,l,C){for(var c,d,u=XW(a),A=kW(u),h=NW(A),m=WW(I,l),b=0,p=C||JW,y=t?p(a,h):n||o?p(a,0):void 0;h>b;b++)if((s||b in A)&&(d=m(c=A[b],b,u),e))if(t)y[b]=d;else if(d)switch(e){case 3:return!0;case 5:return c;case 6:return b;case 2:YW(y,c)}else switch(e){case 4:return!1;case 7:YW(y,c)}return i?-1:g||r?r:y}},HW={forEach:EW(0),map:EW(1),filter:EW(2),some:EW(3),every:EW(4),find:EW(5),findIndex:EW(6)},FW=DV,xW=DG,TW=PG,KW=aB,MW=zG,DW=zB,LW=UG,UW=wS,zW=XB,QW=ZR,OW=BB,jW=eR,PW=tw,_W=gB,qW=vw,$W=iw,ek=Tv,tk=Vw,nk=AV,gk=LG,rk=hR,ik=nw,ok=_G,sk=xv,ak=Hw,Ik=GS,lk=nv,Ck=JS,ck=DS,dk=Fw,uk=Uw,Ak=Pw,hk=eW,mk=hv,bk=HW.forEach,pk=tv("hidden"),yk="Symbol",Zk="prototype",fk=mk.set,Gk=mk.getterFor(yk),Bk=Object[Zk],Sk=xW.Symbol,Rk=Sk&&Sk[Zk],vk=xW.RangeError,Vk=xW.TypeError,wk=xW.QObject,Wk=gk.f,kk=rk.f,Xk=tk.f,Nk=ok.f,Jk=KW([].push),Yk=Ik("symbols"),Ek=Ik("op-symbols"),Hk=Ik("wks"),Fk=!wk||!wk[Zk]||!wk[Zk].findChild,xk=function(e,t,n){var g=Wk(Bk,t);g&&delete Bk[t],kk(e,t,n),g&&e!==Bk&&kk(Bk,t,g)},Tk=MW&&LW((function(){return 7!==qW(kk({},"a",{get:function(){return kk(this,"a",{value:7}).a}})).a}))?xk:kk,Kk=function(e,t){var n=Yk[e]=qW(Rk);return fk(n,{type:yk,tag:e,description:t}),MW||(n.description=t),n},Mk=function(e,t,n){e===Bk&&Mk(Ek,t,n),QW(e);var g=jW(t);return QW(n),UW(Yk,g)?(n.enumerable?(UW(e,pk)&&e[pk][g]&&(e[pk][g]=!1),n=qW(n,{enumerable:_W(0,!1)})):(UW(e,pk)||kk(e,pk,_W(1,qW(null))),e[pk][g]=!0),Tk(e,g,n)):kk(e,g,n)},Dk=function(e,t){QW(e);var n=OW(t),g=$W(n).concat(Qk(n));return bk(g,(function(t){MW&&!TW(Lk,n,t)||Mk(e,t,n[t])})),e},Lk=function(e){var t=jW(e),n=TW(Nk,this,t);return!(this===Bk&&UW(Yk,t)&&!UW(Ek,t))&&(!(n||!UW(this,t)||!UW(Yk,t)||UW(this,pk)&&this[pk][t])||n)},Uk=function(e,t){var n=OW(e),g=jW(t);if(n!==Bk||!UW(Yk,g)||UW(Ek,g)){var r=Wk(n,g);return!r||!UW(Yk,g)||UW(n,pk)&&n[pk][g]||(r.enumerable=!0),r}},zk=function(e){var t=Xk(OW(e)),n=[];return bk(t,(function(e){UW(Yk,e)||UW(lk,e)||Jk(n,e)})),n},Qk=function(e){var t=e===Bk,n=Xk(t?Ek:OW(e)),g=[];return bk(n,(function(e){!UW(Yk,e)||t&&!UW(Bk,e)||Jk(g,Yk[e])})),g};DW||(Sk=function(){if(zW(Rk,this))throw new Vk("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?PW(arguments[0]):void 0,t=Ck(e),n=function(e){var g=void 0===this?xW:this;g===Bk&&TW(n,Ek,e),UW(g,pk)&&UW(g[pk],t)&&(g[pk][t]=!1);var r=_W(1,e);try{Tk(g,t,r)}catch(Vye){if(!(Vye instanceof vk))throw Vye;xk(g,t,r)}};return MW&&Fk&&Tk(Bk,t,{configurable:!0,set:n}),Kk(t,e)},sk(Rk=Sk[Zk],"toString",(function(){return Gk(this).tag})),sk(Sk,"withoutSetter",(function(e){return Kk(Ck(e),e)})),ok.f=Lk,rk.f=Mk,ik.f=Dk,gk.f=Uk,ek.f=tk.f=zk,nk.f=Qk,dk.f=function(e){return Kk(ck(e),e)},MW&&(ak(Rk,"description",{configurable:!0,get:function(){return Gk(this).description}}),sk(Bk,"propertyIsEnumerable",Lk,{unsafe:!0}))),FW({global:!0,constructor:!0,wrap:!0,forced:!DW,sham:!DW},{Symbol:Sk}),bk($W(Hk),(function(e){uk(e)})),FW({target:yk,stat:!0,forced:!DW},{useSetter:function(){Fk=!0},useSimple:function(){Fk=!1}}),FW({target:"Object",stat:!0,forced:!DW,sham:!MW},{create:function(e,t){return void 0===t?qW(e):Dk(qW(e),t)},defineProperty:Mk,defineProperties:Dk,getOwnPropertyDescriptor:Uk}),FW({target:"Object",stat:!0,forced:!DW},{getOwnPropertyNames:zk}),Ak(),hk(Sk,yk),lk[pk]=!0;var Ok=zB&&!!Symbol.for&&!!Symbol.keyFor,jk=DV,Pk=kB,_k=wS,qk=tw,$k=GS,eX=Ok,tX=$k("string-to-symbol-registry"),nX=$k("symbol-to-string-registry");jk({target:"Symbol",stat:!0,forced:!eX},{for:function(e){var t=qk(e);if(_k(tX,t))return tX[t];var n=Pk("Symbol")(t);return tX[t]=n,nX[n]=t,n}});var gX=DV,rX=wS,iX=qB,oX=eS,sX=Ok,aX=GS("symbol-to-string-registry");gX({target:"Symbol",stat:!0,forced:!sX},{keyFor:function(e){if(!iX(e))throw new TypeError(oX(e)+" is not a symbol");if(rX(aX,e))return aX[e]}});var IX=QG,lX=Function.prototype,CX=lX.apply,cX=lX.call,dX="object"==typeof Reflect&&Reflect.apply||(IX?cX.bind(CX):function(){return cX.apply(CX,arguments)}),uX=IW,AX=RB,hX=cB,mX=tw,bX=aB([].push),pX=DV,yX=kB,ZX=dX,fX=PG,GX=aB,BX=UG,SX=RB,RX=qB,vX=ww,VX=function(e){if(AX(e))return e;if(uX(e)){for(var t=e.length,n=[],g=0;g<t;g++){var r=e[g];"string"==typeof r?bX(n,r):"number"!=typeof r&&"Number"!==hX(r)&&"String"!==hX(r)||bX(n,mX(r))}var i=n.length,o=!0;return function(e,t){if(o)return o=!1,t;if(uX(this))return t;for(var g=0;g<i;g++)if(n[g]===e)return t}}},wX=zB,WX=String,kX=yX("JSON","stringify"),XX=GX(/./.exec),NX=GX("".charAt),JX=GX("".charCodeAt),YX=GX("".replace),EX=GX(1..toString),HX=/[\uD800-\uDFFF]/g,FX=/^[\uD800-\uDBFF]$/,xX=/^[\uDC00-\uDFFF]$/,TX=!wX||BX((function(){var e=yX("Symbol")("stringify detection");return"[null]"!==kX([e])||"{}"!==kX({a:e})||"{}"!==kX(Object(e))})),KX=BX((function(){return'"\\udf06\\ud834"'!==kX("\udf06\ud834")||'"\\udead"'!==kX("\udead")})),MX=function(e,t){var n=vX(arguments),g=VX(t);if(SX(g)||void 0!==e&&!RX(e))return n[1]=function(e,t){if(SX(g)&&(t=fX(g,this,WX(e),t)),!RX(t))return t},ZX(kX,null,n)},DX=function(e,t,n){var g=NX(n,t-1),r=NX(n,t+1);return XX(FX,e)&&!XX(xX,r)||XX(xX,e)&&!XX(FX,g)?"\\u"+EX(JX(e,0),16):e};kX&&pX({target:"JSON",stat:!0,arity:3,forced:TX||KX},{stringify:function(e,t,n){var g=vX(arguments),r=ZX(TX?MX:kX,null,g);return KX&&"string"==typeof r?YX(r,HX,DX):r}});var LX=AV,UX=RS;DV({target:"Object",stat:!0,forced:!zB||UG((function(){LX.f(1)}))},{getOwnPropertySymbols:function(e){var t=LX.f;return t?t(UX(e)):[]}});var zX=DV,QX=zG,OX=aB,jX=wS,PX=RB,_X=XB,qX=tw,$X=Hw,eN=RV,tN=DG.Symbol,nN=tN&&tN.prototype;if(QX&&PX(tN)&&(!("description"in nN)||void 0!==tN().description)){var gN={},rN=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:qX(arguments[0]),t=_X(nN,this)?new tN(e):void 0===e?tN():tN(e);return""===e&&(gN[t]=!0),t};eN(rN,tN),rN.prototype=nN,nN.constructor=rN;var iN="Symbol(description detection)"===String(tN("description detection")),oN=OX(nN.valueOf),sN=OX(nN.toString),aN=/^Symbol\((.*)\)[^)]+$/,IN=OX("".replace),lN=OX("".slice);$X(nN,"description",{configurable:!0,get:function(){var e=oN(this);if(jX(gN,e))return"";var t=sN(e),n=iN?lN(t,7,-1):IN(t,aN,"$1");return""===n?void 0:n}}),zX({global:!0,constructor:!0,forced:!0},{Symbol:rN})}Uw("asyncIterator"),Uw("hasInstance"),Uw("isConcatSpreadable"),Uw("iterator"),Uw("match"),Uw("matchAll"),Uw("replace"),Uw("search"),Uw("species"),Uw("split");var CN=Pw;Uw("toPrimitive"),CN();var cN=kB,dN=eW;Uw("toStringTag"),dN(cN("Symbol"),"Symbol"),Uw("unscopables");var uN=aB,AN=rS,hN=function(e,t,n){try{return uN(AN(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(Vye){}},mN=VB,bN=function(e){return mN(e)||null===e},pN=bN,yN=String,ZN=TypeError,fN=function(e){if(pN(e))return e;throw new ZN("Can't set "+yN(e)+" as a prototype")},GN=hN,BN=VB,SN=ZB,RN=fN,vN=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=GN(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(Vye){}return function(n,g){return SN(n),RN(g),BN(n)?(t?e(n,g):n.__proto__=g,n):n}}():void 0),VN=hR.f,wN=function(e,t,n){n in e||VN(e,n,{configurable:!0,get:function(){return t[n]},set:function(e){t[n]=e}})},WN=RB,kN=VB,XN=vN,NN=function(e,t,n){var g,r;return XN&&WN(g=t.constructor)&&g!==n&&kN(r=g.prototype)&&r!==n.prototype&&XN(e,r),e},JN=tw,YN=function(e,t){return void 0===e?arguments.length<2?"":t:JN(e)},EN=VB,HN=YR,FN=function(e,t){EN(t)&&"cause"in t&&HN(e,"cause",t.cause)},xN=Error,TN=aB("".replace),KN=String(new xN("zxcasd").stack),MN=/\n\s*at [^:]*:[^\n]*/,DN=MN.test(KN),LN=function(e,t){if(DN&&"string"==typeof e&&!xN.prepareStackTrace)for(;t--;)e=TN(e,MN,"");return e},UN=gB,zN=!UG((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",UN(1,7)),7!==e.stack)})),QN=YR,ON=LN,jN=zN,PN=Error.captureStackTrace,_N=function(e,t,n,g){jN&&(PN?PN(e,t):QN(e,"stack",ON(n,g)))},qN=kB,$N=wS,eJ=YR,tJ=XB,nJ=vN,gJ=RV,rJ=wN,iJ=NN,oJ=YN,sJ=FN,aJ=_N,IJ=zG,lJ=function(e,t,n,g){var r="stackTraceLimit",i=g?2:1,o=e.split("."),s=o[o.length-1],a=qN.apply(null,o);if(a){var I=a.prototype;if($N(I,"cause")&&delete I.cause,!n)return a;var l=qN("Error"),C=t((function(e,t){var n=oJ(g?t:e,void 0),r=g?new a(e):new a;return void 0!==n&&eJ(r,"message",n),aJ(r,C,r.stack,2),this&&tJ(I,this)&&iJ(r,this,C),arguments.length>i&&sJ(r,arguments[i]),r}));C.prototype=I,"Error"!==s?nJ?nJ(C,l):gJ(C,l,{name:!0}):IJ&&r in a&&(rJ(C,a,r),rJ(C,a,"prepareStackTrace")),gJ(C,a);try{I.name!==s&&eJ(I,"name",s),I.constructor=C}catch(Vye){}return C}},CJ=DV,cJ=dX,dJ=lJ,uJ="WebAssembly",AJ=DG[uJ],hJ=7!==new Error("e",{cause:7}).cause,mJ=function(e,t){var n={};n[e]=dJ(e,t,hJ),CJ({global:!0,constructor:!0,arity:1,forced:hJ},n)},bJ=function(e,t){if(AJ&&AJ[e]){var n={};n[e]=dJ(uJ+"."+e,t,hJ),CJ({target:uJ,stat:!0,constructor:!0,arity:1,forced:hJ},n)}};mJ("Error",(function(e){return function(t){return cJ(e,this,arguments)}})),mJ("EvalError",(function(e){return function(t){return cJ(e,this,arguments)}})),mJ("RangeError",(function(e){return function(t){return cJ(e,this,arguments)}})),mJ("ReferenceError",(function(e){return function(t){return cJ(e,this,arguments)}})),mJ("SyntaxError",(function(e){return function(t){return cJ(e,this,arguments)}})),mJ("TypeError",(function(e){return function(t){return cJ(e,this,arguments)}})),mJ("URIError",(function(e){return function(t){return cJ(e,this,arguments)}})),bJ("CompileError",(function(e){return function(t){return cJ(e,this,arguments)}})),bJ("LinkError",(function(e){return function(t){return cJ(e,this,arguments)}})),bJ("RuntimeError",(function(e){return function(t){return cJ(e,this,arguments)}}));var pJ=zG,yJ=UG,ZJ=ZR,fJ=YN,GJ=Error.prototype.toString,BJ=yJ((function(){if(pJ){var e=Object.create(Object.defineProperty({},"name",{get:function(){return this===e}}));if("true"!==GJ.call(e))return!0}return"2: 1"!==GJ.call({message:1,name:2})||"Error"!==GJ.call({})}))?function(){var e=ZJ(this),t=fJ(e.name,"Error"),n=fJ(e.message);return t?n?t+": "+n:t:n}:GJ,SJ=xv,RJ=BJ,vJ=Error.prototype;vJ.toString!==RJ&&SJ(vJ,"toString",RJ);var VJ=!UG((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),wJ=wS,WJ=RB,kJ=RS,XJ=VJ,NJ=tv("IE_PROTO"),JJ=Object,YJ=JJ.prototype,EJ=XJ?JJ.getPrototypeOf:function(e){var t=kJ(e);if(wJ(t,NJ))return t[NJ];var n=t.constructor;return WJ(n)&&t instanceof n?n.prototype:t instanceof JJ?YJ:null},HJ={},FJ=HJ,xJ=DS("iterator"),TJ=Array.prototype,KJ=function(e){return void 0!==e&&(FJ.Array===e||TJ[xJ]===e)},MJ=qV,DJ=sS,LJ=bB,UJ=HJ,zJ=DS("iterator"),QJ=function(e){if(!LJ(e))return DJ(e,zJ)||DJ(e,"@@iterator")||UJ[MJ(e)]},OJ=PG,jJ=rS,PJ=ZR,_J=eS,qJ=QJ,$J=TypeError,eY=function(e,t){var n=arguments.length<2?qJ(e):t;if(jJ(n))return PJ(OJ(n,e));throw new $J(_J(e)+" is not iterable")},tY=PG,nY=ZR,gY=sS,rY=function(e,t,n){var g,r;nY(e);try{if(!(g=gY(e,"return"))){if("throw"===t)throw n;return n}g=tY(g,e)}catch(Vye){r=!0,g=Vye}if("throw"===t)throw n;if(r)throw g;return nY(g),n},iY=sW,oY=PG,sY=ZR,aY=eS,IY=KJ,lY=eV,CY=XB,cY=eY,dY=QJ,uY=rY,AY=TypeError,hY=function(e,t){this.stopped=e,this.result=t},mY=hY.prototype,bY=function(e,t,n){var g,r,i,o,s,a,I,l=n&&n.that,C=!(!n||!n.AS_ENTRIES),c=!(!n||!n.IS_RECORD),d=!(!n||!n.IS_ITERATOR),u=!(!n||!n.INTERRUPTED),A=iY(t,l),h=function(e){return g&&uY(g,"normal",e),new hY(!0,e)},m=function(e){return C?(sY(e),u?A(e[0],e[1],h):A(e[0],e[1])):u?A(e,h):A(e)};if(c)g=e.iterator;else if(d)g=e;else{if(!(r=dY(e)))throw new AY(aY(e)+" is not iterable");if(IY(r)){for(i=0,o=lY(e);o>i;i++)if((s=m(e[i]))&&CY(mY,s))return s;return new hY(!1)}g=cY(e,r)}for(a=c?e.next:g.next;!(I=oY(a,g)).done;){try{s=m(I.value)}catch(Vye){uY(g,"throw",Vye)}if("object"==typeof s&&s&&CY(mY,s))return s}return new hY(!1)},pY=DV,yY=XB,ZY=EJ,fY=vN,GY=RV,BY=vw,SY=YR,RY=gB,vY=FN,VY=_N,wY=bY,WY=YN,kY=DS("toStringTag"),XY=Error,NY=[].push,JY=function(e,t){var n,g=yY(YY,this);fY?n=fY(new XY,g?ZY(this):YY):(n=g?this:BY(YY),SY(n,kY,"Error")),void 0!==t&&SY(n,"message",WY(t)),VY(n,JY,n.stack,1),arguments.length>2&&vY(n,arguments[2]);var r=[];return wY(e,NY,{that:r}),SY(n,"errors",r),n};fY?fY(JY,XY):GY(JY,XY,{name:!0});var YY=JY.prototype=BY(XY.prototype,{constructor:RY(1,JY),message:RY(1,""),name:RY(1,"AggregateError")});pY({global:!0,constructor:!0,arity:2},{AggregateError:JY});var EY=DV,HY=dX,FY=UG,xY=lJ,TY="AggregateError",KY=kB(TY),MY=!FY((function(){return 1!==KY([1]).errors[0]}))&&FY((function(){return 7!==KY([1],TY,{cause:7}).cause}));EY({global:!0,constructor:!0,arity:2,forced:MY},{AggregateError:xY(TY,(function(e){return function(t,n){return HY(e,this,arguments)}}),MY,!0)});var DY=DS,LY=vw,UY=hR.f,zY=DY("unscopables"),QY=Array.prototype;void 0===QY[zY]&&UY(QY,zY,{configurable:!0,value:LY(null)});var OY=function(e){QY[zY][e]=!0},jY=RS,PY=eV,_Y=Uv,qY=OY;DV({target:"Array",proto:!0},{at:function(e){var t=jY(this),n=PY(t),g=_Y(e),r=g>=0?g:n+g;return r<0||r>=n?void 0:t[r]}}),qY("at");var $Y=TypeError,eE=function(e){if(e>9007199254740991)throw $Y("Maximum allowed index exceeded");return e},tE=zG,nE=hR,gE=gB,rE=function(e,t,n){tE?nE.f(e,t,gE(0,n)):e[t]=n},iE=UG,oE=MB,sE=DS("species"),aE=function(e){return oE>=51||!iE((function(){var t=[];return(t.constructor={})[sE]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},IE=DV,lE=UG,CE=IW,cE=VB,dE=RS,uE=eV,AE=eE,hE=rE,mE=wW,bE=aE,pE=MB,yE=DS("isConcatSpreadable"),ZE=pE>=51||!lE((function(){var e=[];return e[yE]=!1,e.concat()[0]!==e})),fE=function(e){if(!cE(e))return!1;var t=e[yE];return void 0!==t?!!t:CE(e)};IE({target:"Array",proto:!0,arity:1,forced:!ZE||!bE("concat")},{concat:function(e){var t,n,g,r,i,o=dE(this),s=mE(o,0),a=0;for(t=-1,g=arguments.length;t<g;t++)if(fE(i=-1===t?o:arguments[t]))for(r=uE(i),AE(a+r),n=0;n<r;n++,a++)n in i&&hE(s,a,i[n]);else AE(a+1),hE(s,a++,i);return s.length=a,s}});var GE=eS,BE=TypeError,SE=function(e,t){if(!delete e[t])throw new BE("Cannot delete property "+GE(t)+" of "+GE(e))},RE=RS,vE=jv,VE=eV,wE=SE,WE=Math.min,kE=[].copyWithin||function(e,t){var n=RE(this),g=VE(n),r=vE(e,g),i=vE(t,g),o=arguments.length>2?arguments[2]:void 0,s=WE((void 0===o?g:vE(o,g))-i,g-r),a=1;for(i<r&&r<i+s&&(a=-1,i+=s-1,r+=s-1);s-- >0;)i in n?n[r]=n[i]:wE(n,r),r+=a,i+=a;return n},XE=OY;DV({target:"Array",proto:!0},{copyWithin:kE}),XE("copyWithin");var NE=UG,JE=function(e,t){var n=[][e];return!!n&&NE((function(){n.call(null,t||function(){return 1},1)}))},YE=HW.every;DV({target:"Array",proto:!0,forced:!JE("every")},{every:function(e){return YE(this,e,arguments.length>1?arguments[1]:void 0)}});var EE=RS,HE=jv,FE=eV,xE=function(e){for(var t=EE(this),n=FE(t),g=arguments.length,r=HE(g>1?arguments[1]:void 0,n),i=g>2?arguments[2]:void 0,o=void 0===i?n:HE(i,n);o>r;)t[r++]=e;return t},TE=OY;DV({target:"Array",proto:!0},{fill:xE}),TE("fill");var KE=HW.filter;DV({target:"Array",proto:!0,forced:!aE("filter")},{filter:function(e){return KE(this,e,arguments.length>1?arguments[1]:void 0)}});var ME=DV,DE=HW.find,LE=OY,UE="find",zE=!0;UE in[]&&Array(1)[UE]((function(){zE=!1})),ME({target:"Array",proto:!0,forced:zE},{find:function(e){return DE(this,e,arguments.length>1?arguments[1]:void 0)}}),LE(UE);var QE=DV,OE=HW.findIndex,jE=OY,PE="findIndex",_E=!0;PE in[]&&Array(1)[PE]((function(){_E=!1})),QE({target:"Array",proto:!0,forced:_E},{findIndex:function(e){return OE(this,e,arguments.length>1?arguments[1]:void 0)}}),jE(PE);var qE=sW,$E=mB,eH=RS,tH=eV,nH=function(e){var t=1===e;return function(n,g,r){for(var i,o=eH(n),s=$E(o),a=tH(s),I=qE(g,r);a-- >0;)if(I(i=s[a],a,o))switch(e){case 0:return i;case 1:return a}return t?-1:void 0}},gH={findLast:nH(0),findLastIndex:nH(1)},rH=gH.findLast,iH=OY;DV({target:"Array",proto:!0},{findLast:function(e){return rH(this,e,arguments.length>1?arguments[1]:void 0)}}),iH("findLast");var oH=gH.findLastIndex,sH=OY;DV({target:"Array",proto:!0},{findLastIndex:function(e){return oH(this,e,arguments.length>1?arguments[1]:void 0)}}),sH("findLastIndex");var aH=IW,IH=eV,lH=eE,CH=sW,cH=function(e,t,n,g,r,i,o,s){for(var a,I,l=r,C=0,c=!!o&&CH(o,s);C<g;)C in n&&(a=c?c(n[C],C,t):n[C],i>0&&aH(a)?(I=IH(a),l=cH(e,t,a,I,l,i-1)-1):(lH(l+1),e[l]=a),l++),C++;return l},dH=cH,uH=dH,AH=RS,hH=eV,mH=Uv,bH=wW;DV({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=AH(this),n=hH(t),g=bH(t,0);return g.length=uH(g,t,t,n,0,void 0===e?1:mH(e)),g}});var pH=dH,yH=rS,ZH=RS,fH=eV,GH=wW;DV({target:"Array",proto:!0},{flatMap:function(e){var t,n=ZH(this),g=fH(n);return yH(e),(t=GH(n,0)).length=pH(t,n,n,g,0,1,e,arguments.length>1?arguments[1]:void 0),t}});var BH=HW.forEach,SH=JE("forEach")?[].forEach:function(e){return BH(this,e,arguments.length>1?arguments[1]:void 0)};DV({target:"Array",proto:!0,forced:[].forEach!==SH},{forEach:SH});var RH=ZR,vH=rY,VH=function(e,t,n,g){try{return g?t(RH(n)[0],n[1]):t(n)}catch(Vye){vH(e,"throw",Vye)}},wH=sW,WH=PG,kH=RS,XH=VH,NH=KJ,JH=fW,YH=eV,EH=rE,HH=eY,FH=QJ,xH=Array,TH=function(e){var t=kH(e),n=JH(this),g=arguments.length,r=g>1?arguments[1]:void 0,i=void 0!==r;i&&(r=wH(r,g>2?arguments[2]:void 0));var o,s,a,I,l,C,c=FH(t),d=0;if(!c||this===xH&&NH(c))for(o=YH(t),s=n?new this(o):xH(o);o>d;d++)C=i?r(t[d],d):t[d],EH(s,d,C);else for(s=n?new this:[],l=(I=HH(t,c)).next;!(a=WH(l,I)).done;d++)C=i?XH(I,r,[a.value,d],!0):a.value,EH(s,d,C);return s.length=d,s},KH=DS("iterator"),MH=!1;try{var DH=0,LH={next:function(){return{done:!!DH++}},return:function(){MH=!0}};LH[KH]=function(){return this},Array.from(LH,(function(){throw 2}))}catch(Vye){}var UH=function(e,t){try{if(!t&&!MH)return!1}catch(Vye){return!1}var n=!1;try{var g={};g[KH]=function(){return{next:function(){return{done:n=!0}}}},e(g)}catch(Vye){}return n},zH=TH;DV({target:"Array",stat:!0,forced:!UH((function(e){Array.from(e)}))},{from:zH});var QH=iV.includes,OH=OY;DV({target:"Array",proto:!0,forced:UG((function(){return!Array(1).includes()}))},{includes:function(e){return QH(this,e,arguments.length>1?arguments[1]:void 0)}}),OH("includes");var jH=DV,PH=iV.indexOf,_H=JE,qH=gW([].indexOf),$H=!!qH&&1/qH([1],1,-0)<0;jH({target:"Array",proto:!0,forced:$H||!_H("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return $H?qH(this,e,t)||0:PH(this,e,t)}}),DV({target:"Array",stat:!0},{isArray:IW});var eF,tF,nF,gF=UG,rF=RB,iF=VB,oF=EJ,sF=xv,aF=DS("iterator"),IF=!1;[].keys&&("next"in(nF=[].keys())?(tF=oF(oF(nF)))!==Object.prototype&&(eF=tF):IF=!0),(!iF(eF)||gF((function(){var e={};return eF[aF].call(e)!==e})))&&(eF={}),rF(eF[aF])||sF(eF,aF,(function(){return this}));var lF={IteratorPrototype:eF,BUGGY_SAFARI_ITERATORS:IF},CF=lF.IteratorPrototype,cF=vw,dF=gB,uF=eW,AF=HJ,hF=function(){return this},mF=function(e,t,n,g){var r=t+" Iterator";return e.prototype=cF(CF,{next:dF(+!g,n)}),uF(e,r,!1),AF[r]=hF,e},bF=DV,pF=PG,yF=RB,ZF=mF,fF=EJ,GF=vN,BF=eW,SF=YR,RF=xv,vF=HJ,VF=MR.PROPER,wF=MR.CONFIGURABLE,WF=lF.IteratorPrototype,kF=lF.BUGGY_SAFARI_ITERATORS,XF=DS("iterator"),NF="keys",JF="values",YF="entries",EF=function(){return this},HF=function(e,t,n,g,r,i,o){ZF(n,t,g);var s,a,I,l=function(e){if(e===r&&A)return A;if(!kF&&e&&e in d)return d[e];switch(e){case NF:case JF:case YF:return function(){return new n(this,e)}}return function(){return new n(this)}},C=t+" Iterator",c=!1,d=e.prototype,u=d[XF]||d["@@iterator"]||r&&d[r],A=!kF&&u||l(r),h="Array"===t&&d.entries||u;if(h&&(s=fF(h.call(new e)))!==Object.prototype&&s.next&&(fF(s)!==WF&&(GF?GF(s,WF):yF(s[XF])||RF(s,XF,EF)),BF(s,C,!0)),VF&&r===JF&&u&&u.name!==JF&&(wF?SF(d,"name",JF):(c=!0,A=function(){return pF(u,this)})),r)if(a={values:l(JF),keys:i?A:l(NF),entries:l(YF)},o)for(I in a)(kF||c||!(I in d))&&RF(d,I,a[I]);else bF({target:t,proto:!0,forced:kF||c},a);return d[XF]!==A&&RF(d,XF,A,{name:r}),vF[t]=A,a},FF=function(e,t){return{value:e,done:t}},xF=BB,TF=OY,KF=HJ,MF=hv,DF=hR.f,LF=HF,UF=FF,zF=zG,QF="Array Iterator",OF=MF.set,jF=MF.getterFor(QF),PF=LF(Array,"Array",(function(e,t){OF(this,{type:QF,target:xF(e),index:0,kind:t})}),(function(){var e=jF(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,UF(void 0,!0);switch(e.kind){case"keys":return UF(n,!1);case"values":return UF(t[n],!1)}return UF([n,t[n]],!1)}),"values"),_F=KF.Arguments=KF.Array;if(TF("keys"),TF("values"),TF("entries"),zF&&"values"!==_F.name)try{DF(_F,"name",{value:"values"})}catch(Vye){}var qF=DV,$F=mB,ex=BB,tx=JE,nx=aB([].join);qF({target:"Array",proto:!0,forced:$F!==Object||!tx("join",",")},{join:function(e){return nx(ex(this),void 0===e?",":e)}});var gx=dX,rx=BB,ix=Uv,ox=eV,sx=JE,ax=Math.min,Ix=[].lastIndexOf,lx=!!Ix&&1/[1].lastIndexOf(1,-0)<0,Cx=sx("lastIndexOf"),cx=lx||!Cx?function(e){if(lx)return gx(Ix,this,arguments)||0;var t=rx(this),n=ox(t);if(0===n)return-1;var g=n-1;for(arguments.length>1&&(g=ax(g,ix(arguments[1]))),g<0&&(g=n+g);g>=0;g--)if(g in t&&t[g]===e)return g||0;return-1}:Ix;DV({target:"Array",proto:!0,forced:cx!==[].lastIndexOf},{lastIndexOf:cx});var dx=HW.map;DV({target:"Array",proto:!0,forced:!aE("map")},{map:function(e){return dx(this,e,arguments.length>1?arguments[1]:void 0)}});var ux=fW,Ax=rE,hx=Array;DV({target:"Array",stat:!0,forced:UG((function(){function e(){}return!(hx.of.call(e)instanceof e)}))},{of:function(){for(var e=0,t=arguments.length,n=new(ux(this)?this:hx)(t);t>e;)Ax(n,e,arguments[e++]);return n.length=t,n}});var mx=zG,bx=IW,px=TypeError,yx=Object.getOwnPropertyDescriptor,Zx=mx&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(Vye){return Vye instanceof TypeError}}()?function(e,t){if(bx(e)&&!yx(e,"length").writable)throw new px("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},fx=RS,Gx=eV,Bx=Zx,Sx=eE;DV({target:"Array",proto:!0,arity:1,forced:UG((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(Vye){return Vye instanceof TypeError}}()},{push:function(e){var t=fx(this),n=Gx(t),g=arguments.length;Sx(n+g);for(var r=0;r<g;r++)t[n]=arguments[r],n++;return Bx(t,n),n}});var Rx=rS,vx=RS,Vx=mB,wx=eV,Wx=TypeError,kx="Reduce of empty array with no initial value",Xx=function(e){return function(t,n,g,r){var i=vx(t),o=Vx(i),s=wx(i);if(Rx(n),0===s&&g<2)throw new Wx(kx);var a=e?s-1:0,I=e?-1:1;if(g<2)for(;;){if(a in o){r=o[a],a+=I;break}if(a+=I,e?a<0:s<=a)throw new Wx(kx)}for(;e?a>=0:s>a;a+=I)a in o&&(r=n(r,o[a],a,i));return r}},Nx={left:Xx(!1),right:Xx(!0)},Jx=DG,Yx=YB,Ex=cB,Hx=function(e){return Yx.slice(0,e.length)===e},Fx=Hx("Bun/")?"BUN":Hx("Cloudflare-Workers")?"CLOUDFLARE":Hx("Deno/")?"DENO":Hx("Node.js/")?"NODE":Jx.Bun&&"string"==typeof Bun.version?"BUN":Jx.Deno&&"object"==typeof Deno.version?"DENO":"process"===Ex(Jx.process)?"NODE":Jx.window&&Jx.document?"BROWSER":"REST",xx="NODE"===Fx,Tx=Nx.left;DV({target:"Array",proto:!0,forced:!xx&&MB>79&&MB<83||!JE("reduce")},{reduce:function(e){var t=arguments.length;return Tx(this,e,t,t>1?arguments[1]:void 0)}});var Kx=Nx.right;DV({target:"Array",proto:!0,forced:!xx&&MB>79&&MB<83||!JE("reduceRight")},{reduceRight:function(e){return Kx(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var Mx=DV,Dx=IW,Lx=aB([].reverse),Ux=[1,2];Mx({target:"Array",proto:!0,forced:String(Ux)===String(Ux.reverse())},{reverse:function(){return Dx(this)&&(this.length=this.length),Lx(this)}});var zx=DV,Qx=IW,Ox=fW,jx=VB,Px=jv,_x=eV,qx=BB,$x=rE,eT=DS,tT=ww,nT=aE("slice"),gT=eT("species"),rT=Array,iT=Math.max;zx({target:"Array",proto:!0,forced:!nT},{slice:function(e,t){var n,g,r,i=qx(this),o=_x(i),s=Px(e,o),a=Px(void 0===t?o:t,o);if(Qx(i)&&(n=i.constructor,(Ox(n)&&(n===rT||Qx(n.prototype))||jx(n)&&null===(n=n[gT]))&&(n=void 0),n===rT||void 0===n))return tT(i,s,a);for(g=new(void 0===n?rT:n)(iT(a-s,0)),r=0;s<a;s++,r++)s in i&&$x(g,r,i[s]);return g.length=r,g}});var oT=HW.some;DV({target:"Array",proto:!0,forced:!JE("some")},{some:function(e){return oT(this,e,arguments.length>1?arguments[1]:void 0)}});var sT=ww,aT=Math.floor,IT=function(e,t){var n=e.length;if(n<8)for(var g,r,i=1;i<n;){for(r=i,g=e[i];r&&t(e[r-1],g)>0;)e[r]=e[--r];r!==i++&&(e[r]=g)}else for(var o=aT(n/2),s=IT(sT(e,0,o),t),a=IT(sT(e,o),t),I=s.length,l=a.length,C=0,c=0;C<I||c<l;)e[C+c]=C<I&&c<l?t(s[C],a[c])<=0?s[C++]:a[c++]:C<I?s[C++]:a[c++];return e},lT=IT,CT=YB.match(/firefox\/(\d+)/i),cT=!!CT&&+CT[1],dT=/MSIE|Trident/.test(YB),uT=YB.match(/AppleWebKit\/(\d+)\./),AT=!!uT&&+uT[1],hT=DV,mT=aB,bT=rS,pT=RS,yT=eV,ZT=SE,fT=tw,GT=UG,BT=lT,ST=JE,RT=cT,vT=dT,VT=MB,wT=AT,WT=[],kT=mT(WT.sort),XT=mT(WT.push),NT=GT((function(){WT.sort(void 0)})),JT=GT((function(){WT.sort(null)})),YT=ST("sort"),ET=!GT((function(){if(VT)return VT<70;if(!(RT&&RT>3)){if(vT)return!0;if(wT)return wT<603;var e,t,n,g,r="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(g=0;g<47;g++)WT.push({k:t+g,v:n})}for(WT.sort((function(e,t){return t.v-e.v})),g=0;g<WT.length;g++)t=WT[g].k.charAt(0),r.charAt(r.length-1)!==t&&(r+=t);return"DGBEFHACIJK"!==r}}));hT({target:"Array",proto:!0,forced:NT||!JT||!YT||!ET},{sort:function(e){void 0!==e&&bT(e);var t=pT(this);if(ET)return void 0===e?kT(t):kT(t,e);var n,g,r=[],i=yT(t);for(g=0;g<i;g++)g in t&&XT(r,t[g]);for(BT(r,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:fT(t)>fT(n)?1:-1}}(e)),n=yT(r),g=0;g<n;)t[g]=r[g++];for(;g<i;)ZT(t,g++);return t}});var HT=kB,FT=Hw,xT=zG,TT=DS("species"),KT=function(e){var t=HT(e);xT&&t&&!t[TT]&&FT(t,TT,{configurable:!0,get:function(){return this}})};KT("Array");var MT=DV,DT=RS,LT=jv,UT=Uv,zT=eV,QT=Zx,OT=eE,jT=wW,PT=rE,_T=SE,qT=aE("splice"),$T=Math.max,eK=Math.min;MT({target:"Array",proto:!0,forced:!qT},{splice:function(e,t){var n,g,r,i,o,s,a=DT(this),I=zT(a),l=LT(e,I),C=arguments.length;for(0===C?n=g=0:1===C?(n=0,g=I-l):(n=C-2,g=eK($T(UT(t),0),I-l)),OT(I+n-g),r=jT(a,g),i=0;i<g;i++)(o=l+i)in a&&PT(r,i,a[o]);if(r.length=g,n<g){for(i=l;i<I-g;i++)s=i+n,(o=i+g)in a?a[s]=a[o]:_T(a,s);for(i=I;i>I-g+n;i--)_T(a,i-1)}else if(n>g)for(i=I-g;i>l;i--)s=i+n-1,(o=i+g-1)in a?a[s]=a[o]:_T(a,s);for(i=0;i<n;i++)a[i+l]=arguments[i+2];return QT(a,I-g+n),r}});var tK=eV,nK=function(e,t){for(var n=tK(e),g=new t(n),r=0;r<n;r++)g[r]=e[n-r-1];return g},gK=nK,rK=BB,iK=OY,oK=Array;DV({target:"Array",proto:!0},{toReversed:function(){return gK(rK(this),oK)}}),iK("toReversed");var sK=eV,aK=function(e,t,n){for(var g=0,r=arguments.length>2?n:sK(t),i=new e(r);r>g;)i[g]=t[g++];return i},IK=DG,lK=DV,CK=rS,cK=BB,dK=aK,uK=OY,AK=Array,hK=aB(function(e,t){var n=IK[e],g=n&&n.prototype;return g&&g[t]}("Array","sort"));lK({target:"Array",proto:!0},{toSorted:function(e){void 0!==e&&CK(e);var t=cK(this),n=dK(AK,t);return hK(n,e)}}),uK("toSorted");var mK=DV,bK=OY,pK=eE,yK=eV,ZK=jv,fK=BB,GK=Uv,BK=Array,SK=Math.max,RK=Math.min;mK({target:"Array",proto:!0},{toSpliced:function(e,t){var n,g,r,i,o=fK(this),s=yK(o),a=ZK(e,s),I=arguments.length,l=0;for(0===I?n=g=0:1===I?(n=0,g=s-a):(n=I-2,g=RK(SK(GK(t),0),s-a)),r=pK(s+n-g),i=BK(r);l<a;l++)i[l]=o[l];for(;l<a+n;l++)i[l]=arguments[l-a+2];for(;l<r;l++)i[l]=o[l+g-n];return i}}),bK("toSpliced"),OY("flat"),OY("flatMap");var vK=RS,VK=eV,wK=Zx,WK=SE,kK=eE;DV({target:"Array",proto:!0,arity:1,forced:1!==[].unshift(0)||!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(Vye){return Vye instanceof TypeError}}()},{unshift:function(e){var t=vK(this),n=VK(t),g=arguments.length;if(g){kK(n+g);for(var r=n;r--;){var i=r+g;r in t?t[i]=t[r]:WK(t,i)}for(var o=0;o<g;o++)t[o]=arguments[o]}return wK(t,n+g)}});var XK=eV,NK=Uv,JK=RangeError,YK=function(e,t,n,g){var r=XK(e),i=NK(n),o=i<0?r+i:i;if(o>=r||o<0)throw new JK("Incorrect index");for(var s=new t(r),a=0;a<r;a++)s[a]=a===o?g:e[a];return s},EK=YK,HK=BB,FK=Array;DV({target:"Array",proto:!0},{with:function(e,t){return EK(HK(this),FK,e,t)}});var xK="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,TK=xv,KK=function(e,t,n){for(var g in t)TK(e,g,t[g],n);return e},MK=XB,DK=TypeError,LK=function(e,t){if(MK(t,e))return e;throw new DK("Incorrect invocation")},UK=Uv,zK=qv,QK=RangeError,OK=function(e){if(void 0===e)return 0;var t=UK(e),n=zK(t);if(t!==n)throw new QK("Wrong length or index");return n},jK=Math.sign||function(e){var t=+e;return 0===t||t!=t?t:t<0?-1:1},PK=4503599627370496,_K=function(e){return e+PK-PK},qK=jK,$K=_K,eM=Math.abs,tM=function(e,t,n,g){var r=+e,i=eM(r),o=qK(r);if(i<g)return o*$K(i/g/t)*g*t;var s=(1+t/2220446049250313e-31)*i,a=s-(s-i);return a>n||a!=a?o*(1/0):o*a},nM=tM,gM=Math.fround||function(e){return nM(e,1.1920928955078125e-7,34028234663852886e22,11754943508222875e-54)},rM=Array,iM=Math.abs,oM=Math.pow,sM=Math.floor,aM=Math.log,IM=Math.LN2,lM={pack:function(e,t,n){var g,r,i,o=rM(n),s=8*n-t-1,a=(1<<s)-1,I=a>>1,l=23===t?oM(2,-24)-oM(2,-77):0,C=e<0||0===e&&1/e<0?1:0,c=0;for((e=iM(e))!=e||e===1/0?(r=e!=e?1:0,g=a):(g=sM(aM(e)/IM),e*(i=oM(2,-g))<1&&(g--,i*=2),(e+=g+I>=1?l/i:l*oM(2,1-I))*i>=2&&(g++,i/=2),g+I>=a?(r=0,g=a):g+I>=1?(r=(e*i-1)*oM(2,t),g+=I):(r=e*oM(2,I-1)*oM(2,t),g=0));t>=8;)o[c++]=255&r,r/=256,t-=8;for(g=g<<t|r,s+=t;s>0;)o[c++]=255&g,g/=256,s-=8;return o[c-1]|=128*C,o},unpack:function(e,t){var n,g=e.length,r=8*g-t-1,i=(1<<r)-1,o=i>>1,s=r-7,a=g-1,I=e[a--],l=127&I;for(I>>=7;s>0;)l=256*l+e[a--],s-=8;for(n=l&(1<<-s)-1,l>>=-s,s+=t;s>0;)n=256*n+e[a--],s-=8;if(0===l)l=1-o;else{if(l===i)return n?NaN:I?-1/0:1/0;n+=oM(2,t),l-=o}return(I?-1:1)*n*oM(2,l-t)}},CM=DG,cM=aB,dM=zG,uM=xK,AM=YR,hM=Hw,mM=KK,bM=UG,pM=LK,yM=Uv,ZM=qv,fM=OK,GM=gM,BM=lM,SM=EJ,RM=vN,vM=xE,VM=ww,wM=NN,WM=RV,kM=eW,XM=hv,NM=MR.PROPER,JM=MR.CONFIGURABLE,YM="ArrayBuffer",EM="DataView",HM="prototype",FM="Wrong index",xM=XM.getterFor(YM),TM=XM.getterFor(EM),KM=XM.set,MM=CM[YM],DM=MM,LM=DM&&DM[HM],UM=CM[EM],zM=UM&&UM[HM],QM=Object.prototype,OM=CM.Array,jM=CM.RangeError,PM=cM(vM),_M=cM([].reverse),qM=BM.pack,$M=BM.unpack,eD=function(e){return[255&e]},tD=function(e){return[255&e,e>>8&255]},nD=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},gD=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},rD=function(e){return qM(GM(e),23,4)},iD=function(e){return qM(e,52,8)},oD=function(e,t,n){hM(e[HM],t,{configurable:!0,get:function(){return n(this)[t]}})},sD=function(e,t,n,g){var r=TM(e),i=fM(n),o=!!g;if(i+t>r.byteLength)throw new jM(FM);var s=r.bytes,a=i+r.byteOffset,I=VM(s,a,a+t);return o?I:_M(I)},aD=function(e,t,n,g,r,i){var o=TM(e),s=fM(n),a=g(+r),I=!!i;if(s+t>o.byteLength)throw new jM(FM);for(var l=o.bytes,C=s+o.byteOffset,c=0;c<t;c++)l[C+c]=a[I?c:t-c-1]};if(uM){var ID=NM&&MM.name!==YM;bM((function(){MM(1)}))&&bM((function(){new MM(-1)}))&&!bM((function(){return new MM,new MM(1.5),new MM(NaN),1!==MM.length||ID&&!JM}))?ID&&JM&&AM(MM,"name",YM):((DM=function(e){return pM(this,LM),wM(new MM(fM(e)),this,DM)})[HM]=LM,LM.constructor=DM,WM(DM,MM)),RM&&SM(zM)!==QM&&RM(zM,QM);var lD=new UM(new DM(2)),CD=cM(zM.setInt8);lD.setInt8(0,2147483648),lD.setInt8(1,2147483649),!lD.getInt8(0)&&lD.getInt8(1)||mM(zM,{setInt8:function(e,t){CD(this,e,t<<24>>24)},setUint8:function(e,t){CD(this,e,t<<24>>24)}},{unsafe:!0})}else LM=(DM=function(e){pM(this,LM);var t=fM(e);KM(this,{type:YM,bytes:PM(OM(t),0),byteLength:t}),dM||(this.byteLength=t,this.detached=!1)})[HM],zM=(UM=function(e,t,n){pM(this,zM),pM(e,LM);var g=xM(e),r=g.byteLength,i=yM(t);if(i<0||i>r)throw new jM("Wrong offset");if(i+(n=void 0===n?r-i:ZM(n))>r)throw new jM("Wrong length");KM(this,{type:EM,buffer:e,byteLength:n,byteOffset:i,bytes:g.bytes}),dM||(this.buffer=e,this.byteLength=n,this.byteOffset=i)})[HM],dM&&(oD(DM,"byteLength",xM),oD(UM,"buffer",TM),oD(UM,"byteLength",TM),oD(UM,"byteOffset",TM)),mM(zM,{getInt8:function(e){return sD(this,1,e)[0]<<24>>24},getUint8:function(e){return sD(this,1,e)[0]},getInt16:function(e){var t=sD(this,2,e,arguments.length>1&&arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=sD(this,2,e,arguments.length>1&&arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return gD(sD(this,4,e,arguments.length>1&&arguments[1]))},getUint32:function(e){return gD(sD(this,4,e,arguments.length>1&&arguments[1]))>>>0},getFloat32:function(e){return $M(sD(this,4,e,arguments.length>1&&arguments[1]),23)},getFloat64:function(e){return $M(sD(this,8,e,arguments.length>1&&arguments[1]),52)},setInt8:function(e,t){aD(this,1,e,eD,t)},setUint8:function(e,t){aD(this,1,e,eD,t)},setInt16:function(e,t){aD(this,2,e,tD,t,arguments.length>2&&arguments[2])},setUint16:function(e,t){aD(this,2,e,tD,t,arguments.length>2&&arguments[2])},setInt32:function(e,t){aD(this,4,e,nD,t,arguments.length>2&&arguments[2])},setUint32:function(e,t){aD(this,4,e,nD,t,arguments.length>2&&arguments[2])},setFloat32:function(e,t){aD(this,4,e,rD,t,arguments.length>2&&arguments[2])},setFloat64:function(e,t){aD(this,8,e,iD,t,arguments.length>2&&arguments[2])}});kM(DM,YM),kM(UM,EM);var cD={ArrayBuffer:DM,DataView:UM},dD=KT,uD="ArrayBuffer",AD=cD[uD];DV({global:!0,constructor:!0,forced:DG[uD]!==AD},{ArrayBuffer:AD}),dD(uD);var hD,mD,bD,pD=xK,yD=zG,ZD=DG,fD=RB,GD=VB,BD=wS,SD=qV,RD=eS,vD=YR,VD=xv,wD=Hw,WD=XB,kD=EJ,XD=vN,ND=DS,JD=JS,YD=hv.enforce,ED=hv.get,HD=ZD.Int8Array,FD=HD&&HD.prototype,xD=ZD.Uint8ClampedArray,TD=xD&&xD.prototype,KD=HD&&kD(HD),MD=FD&&kD(FD),DD=Object.prototype,LD=ZD.TypeError,UD=ND("toStringTag"),zD=JD("TYPED_ARRAY_TAG"),QD="TypedArrayConstructor",OD=pD&&!!XD&&"Opera"!==SD(ZD.opera),jD=!1,PD={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},_D={BigInt64Array:8,BigUint64Array:8},qD=function(e){var t=kD(e);if(GD(t)){var n=ED(t);return n&&BD(n,QD)?n[QD]:qD(t)}},$D=function(e){if(!GD(e))return!1;var t=SD(e);return BD(PD,t)||BD(_D,t)};for(hD in PD)(bD=(mD=ZD[hD])&&mD.prototype)?YD(bD)[QD]=mD:OD=!1;for(hD in _D)(bD=(mD=ZD[hD])&&mD.prototype)&&(YD(bD)[QD]=mD);if((!OD||!fD(KD)||KD===Function.prototype)&&(KD=function(){throw new LD("Incorrect invocation")},OD))for(hD in PD)ZD[hD]&&XD(ZD[hD],KD);if((!OD||!MD||MD===DD)&&(MD=KD.prototype,OD))for(hD in PD)ZD[hD]&&XD(ZD[hD].prototype,MD);if(OD&&kD(TD)!==MD&&XD(TD,MD),yD&&!BD(MD,UD))for(hD in jD=!0,wD(MD,UD,{configurable:!0,get:function(){return GD(this)?this[zD]:void 0}}),PD)ZD[hD]&&vD(ZD[hD],zD,hD);var eL={NATIVE_ARRAY_BUFFER_VIEWS:OD,TYPED_ARRAY_TAG:jD&&zD,aTypedArray:function(e){if($D(e))return e;throw new LD("Target is not a typed array")},aTypedArrayConstructor:function(e){if(fD(e)&&(!XD||WD(KD,e)))return e;throw new LD(RD(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,g){if(yD){if(n)for(var r in PD){var i=ZD[r];if(i&&BD(i.prototype,e))try{delete i.prototype[e]}catch(Vye){try{i.prototype[e]=t}catch(o){}}}MD[e]&&!n||VD(MD,e,n?t:OD&&FD[e]||t,g)}},exportTypedArrayStaticMethod:function(e,t,n){var g,r;if(yD){if(XD){if(n)for(g in PD)if((r=ZD[g])&&BD(r,e))try{delete r[e]}catch(Vye){}if(KD[e]&&!n)return;try{return VD(KD,e,n?t:OD&&KD[e]||t)}catch(Vye){}}for(g in PD)!(r=ZD[g])||r[e]&&!n||VD(r,e,t)}},getTypedArrayConstructor:qD,isView:function(e){if(!GD(e))return!1;var t=SD(e);return"DataView"===t||BD(PD,t)||BD(_D,t)},isTypedArray:$D,TypedArray:KD,TypedArrayPrototype:MD};DV({target:"ArrayBuffer",stat:!0,forced:!eL.NATIVE_ARRAY_BUFFER_VIEWS},{isView:eL.isView});var tL=DV,nL=gW,gL=UG,rL=ZR,iL=jv,oL=qv,sL=cD.ArrayBuffer,aL=cD.DataView,IL=aL.prototype,lL=nL(sL.prototype.slice),CL=nL(IL.getUint8),cL=nL(IL.setUint8);tL({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:gL((function(){return!new sL(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(lL&&void 0===t)return lL(rL(this),e);for(var n=rL(this).byteLength,g=iL(e,n),r=iL(void 0===t?n:t,n),i=new sL(oL(r-g)),o=new aL(this),s=new aL(i),a=0;g<r;)cL(s,a++,CL(o,g++));return i}}),DV({global:!0,constructor:!0,forced:!xK},{DataView:cD.DataView});var dL=DV,uL=aB,AL=Math.pow,hL=AL(2,-24),mL=.0009765625,bL=uL(DataView.prototype.getUint16);dL({target:"DataView",proto:!0},{getFloat16:function(e){var t,n,g,r,i=bL(this,e,arguments.length>1&&arguments[1]);return n=(t=i)>>>15,r=1023&t,31===(g=t>>>10&31)?0===r?0===n?1/0:-1/0:NaN:0===g?r*(0===n?hL:-hL):AL(2,g-15)*(0===n?1+r*mL:-1-r*mL)}});var pL=qV,yL=TypeError,ZL=Math.log,fL=Math.LN2,GL=Math.log2||function(e){return ZL(e)/fL},BL=DV,SL=aB,RL=function(e){if("DataView"===pL(e))return e;throw new yL("Argument is not a DataView")},vL=OK,VL=GL,wL=_K,WL=Math.pow,kL=1024,XL=SL(DataView.prototype.setUint16);BL({target:"DataView",proto:!0},{setFloat16:function(e,t){RL(this);var n=vL(e),g=function(e){if(e!=e)return 32256;if(0===e)return(1/e==-1/0)<<15;var t=e<0;if(t&&(e=-e),e>=65520)return t<<15|31744;if(e<61005353927612305e-21)return t<<15|wL(16777216*e);var n=0|VL(e);if(-15===n)return t<<15|kL;var g=wL((e*WL(2,-n)-1)*kL);return g===kL?t<<15|n+16<<10:t<<15|n+15<<10|g}(+t);return XL(this,n,g,arguments.length>2&&arguments[2])}});var NL=DG,JL=hN,YL=cB,EL=NL.ArrayBuffer,HL=NL.TypeError,FL=EL&&JL(EL.prototype,"byteLength","get")||function(e){if("ArrayBuffer"!==YL(e))throw new HL("ArrayBuffer expected");return e.byteLength},xL=xK,TL=FL,KL=DG.DataView,ML=function(e){if(!xL||0!==TL(e))return!1;try{return new KL(e),!1}catch(Vye){return!0}},DL=zG,LL=Hw,UL=ML,zL=ArrayBuffer.prototype;DL&&!("detached"in zL)&&LL(zL,"detached",{configurable:!0,get:function(){return UL(this)}});var QL,OL,jL,PL,_L=ML,qL=TypeError,$L=DG,eU=xx,tU=function(e){if(eU){try{return $L.process.getBuiltinModule(e)}catch(Vye){}try{return Function('return require("'+e+'")')()}catch(Vye){}}},nU=UG,gU=MB,rU=Fx,iU=DG.structuredClone,oU=!!iU&&!nU((function(){if("DENO"===rU&&gU>92||"NODE"===rU&&gU>94||"BROWSER"===rU&&gU>97)return!1;var e=new ArrayBuffer(8),t=iU(e,{transfer:[e]});return 0!==e.byteLength||8!==t.byteLength})),sU=DG,aU=tU,IU=oU,lU=sU.structuredClone,CU=sU.ArrayBuffer,cU=sU.MessageChannel,dU=!1;if(IU)dU=function(e){lU(e,{transfer:[e]})};else if(CU)try{cU||(QL=aU("worker_threads"))&&(cU=QL.MessageChannel),cU&&(OL=new cU,jL=new CU(2),PL=function(e){OL.port1.postMessage(null,[e])},2===jL.byteLength&&(PL(jL),0===jL.byteLength&&(dU=PL)))}catch(Vye){}var uU=dU,AU=DG,hU=aB,mU=hN,bU=OK,pU=function(e){if(_L(e))throw new qL("ArrayBuffer is detached");return e},yU=FL,ZU=uU,fU=oU,GU=AU.structuredClone,BU=AU.ArrayBuffer,SU=AU.DataView,RU=Math.min,vU=BU.prototype,VU=SU.prototype,wU=hU(vU.slice),WU=mU(vU,"resizable","get"),kU=mU(vU,"maxByteLength","get"),XU=hU(VU.getInt8),NU=hU(VU.setInt8),JU=(fU||ZU)&&function(e,t,n){var g,r=yU(e),i=void 0===t?r:bU(t),o=!WU||!WU(e);if(pU(e),fU&&(e=GU(e,{transfer:[e]}),r===i&&(n||o)))return e;if(r>=i&&(!n||o))g=wU(e,0,i);else{var s=n&&!o&&kU?{maxByteLength:kU(e)}:void 0;g=new BU(i,s);for(var a=new SU(e),I=new SU(g),l=RU(i,r),C=0;C<l;C++)NU(I,C,XU(a,C))}return fU||ZU(e),g},YU=JU;YU&&DV({target:"ArrayBuffer",proto:!0},{transfer:function(){return YU(this,arguments.length?arguments[0]:void 0,!0)}});var EU=JU;EU&&DV({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return EU(this,arguments.length?arguments[0]:void 0,!1)}});var HU=DV,FU=aB,xU=UG((function(){return 120!==new Date(16e11).getYear()})),TU=FU(Date.prototype.getFullYear);HU({target:"Date",proto:!0,forced:xU},{getYear:function(){return TU(this)-1900}});var KU=DV,MU=Date,DU=aB(MU.prototype.getTime);KU({target:"Date",stat:!0},{now:function(){return DU(new MU)}});var LU=DV,UU=aB,zU=Uv,QU=Date.prototype,OU=UU(QU.getTime),jU=UU(QU.setFullYear);LU({target:"Date",proto:!0},{setYear:function(e){OU(this);var t=zU(e);return jU(this,t>=0&&t<=99?t+1900:t)}}),DV({target:"Date",proto:!0},{toGMTString:Date.prototype.toUTCString});var PU=Uv,_U=tw,qU=ZB,$U=RangeError,ez=function(e){var t=_U(qU(this)),n="",g=PU(e);if(g<0||g===1/0)throw new $U("Wrong number of repetitions");for(;g>0;(g>>>=1)&&(t+=t))1&g&&(n+=t);return n},tz=aB,nz=qv,gz=tw,rz=ZB,iz=tz(ez),oz=tz("".slice),sz=Math.ceil,az=function(e){return function(t,n,g){var r,i,o=gz(rz(t)),s=nz(n),a=o.length,I=void 0===g?" ":gz(g);return s<=a||""===I?o:((i=iz(I,sz((r=s-a)/I.length))).length>r&&(i=oz(i,0,r)),e?o+i:i+o)}},Iz={start:az(!1),end:az(!0)},lz=aB,Cz=UG,cz=Iz.start,dz=RangeError,uz=isFinite,Az=Math.abs,hz=Date.prototype,mz=hz.toISOString,bz=lz(hz.getTime),pz=lz(hz.getUTCDate),yz=lz(hz.getUTCFullYear),Zz=lz(hz.getUTCHours),fz=lz(hz.getUTCMilliseconds),Gz=lz(hz.getUTCMinutes),Bz=lz(hz.getUTCMonth),Sz=lz(hz.getUTCSeconds),Rz=Cz((function(){return"0385-07-25T07:06:39.999Z"!==mz.call(new Date(-50000000000001))}))||!Cz((function(){mz.call(new Date(NaN))}))?function(){if(!uz(bz(this)))throw new dz("Invalid time value");var e=this,t=yz(e),n=fz(e),g=t<0?"-":t>9999?"+":"";return g+cz(Az(t),g?6:4,0)+"-"+cz(Bz(e)+1,2,0)+"-"+cz(pz(e),2,0)+"T"+cz(Zz(e),2,0)+":"+cz(Gz(e),2,0)+":"+cz(Sz(e),2,0)+"."+cz(n,3,0)+"Z"}:mz;DV({target:"Date",proto:!0,forced:Date.prototype.toISOString!==Rz},{toISOString:Rz});var vz=RS,Vz=_S;DV({target:"Date",proto:!0,arity:1,forced:UG((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}))},{toJSON:function(e){var t=vz(this),n=Vz(t,"number");return"number"!=typeof n||isFinite(n)?t.toISOString():null}});var wz=ZR,Wz=cS,kz=TypeError,Xz=wS,Nz=xv,Jz=function(e){if(wz(this),"string"===e||"default"===e)e="string";else if("number"!==e)throw new kz("Incorrect hint");return Wz(this,e)},Yz=DS("toPrimitive"),Ez=Date.prototype;Xz(Ez,Yz)||Nz(Ez,Yz,Jz);var Hz=aB,Fz=xv,xz=Date.prototype,Tz="Invalid Date",Kz="toString",Mz=Hz(xz[Kz]),Dz=Hz(xz.getTime);String(new Date(NaN))!==Tz&&Fz(xz,Kz,(function(){var e=Dz(this);return e==e?Mz(this):Tz}));var Lz=DV,Uz=aB,zz=tw,Qz=Uz("".charAt),Oz=Uz("".charCodeAt),jz=Uz(/./.exec),Pz=Uz(1..toString),_z=Uz("".toUpperCase),qz=/[\w*+\-./@]/,$z=function(e,t){for(var n=Pz(e,16);n.length<t;)n="0"+n;return n};Lz({global:!0},{escape:function(e){for(var t,n,g=zz(e),r="",i=g.length,o=0;o<i;)t=Qz(g,o++),jz(qz,t)?r+=t:r+=(n=Oz(t,0))<256?"%"+$z(n,2):"%u"+_z($z(n,4));return r}});var eQ=aB,tQ=rS,nQ=VB,gQ=wS,rQ=ww,iQ=QG,oQ=Function,sQ=eQ([].concat),aQ=eQ([].join),IQ={},lQ=iQ?oQ.bind:function(e){var t=tQ(this),n=t.prototype,g=rQ(arguments,1),r=function(){var n=sQ(g,rQ(arguments));return this instanceof r?function(e,t,n){if(!gQ(IQ,t)){for(var g=[],r=0;r<t;r++)g[r]="a["+r+"]";IQ[t]=oQ("C,a","return new C("+aQ(g,",")+")")}return IQ[t](e,n)}(t,n.length,n):t.apply(e,n)};return nQ(n)&&(r.prototype=n),r},CQ=lQ;DV({target:"Function",proto:!0,forced:Function.bind!==CQ},{bind:CQ});var cQ=RB,dQ=VB,uQ=hR,AQ=XB,hQ=Jv,mQ=DS("hasInstance"),bQ=Function.prototype;mQ in bQ||uQ.f(bQ,mQ,{value:hQ((function(e){if(!cQ(this)||!dQ(e))return!1;var t=this.prototype;return dQ(t)?AQ(t,e):e instanceof this}),mQ)});var pQ=zG,yQ=MR.EXISTS,ZQ=aB,fQ=Hw,GQ=Function.prototype,BQ=ZQ(GQ.toString),SQ=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,RQ=ZQ(SQ.exec);pQ&&!yQ&&fQ(GQ,"name",{configurable:!0,get:function(){try{return RQ(SQ,BQ(this))[1]}catch(Vye){return""}}});var vQ=DG;DV({global:!0,forced:vQ.globalThis!==vQ},{globalThis:vQ});var VQ=DV,wQ=DG,WQ=LK,kQ=ZR,XQ=RB,NQ=EJ,JQ=Hw,YQ=rE,EQ=UG,HQ=wS,FQ=lF.IteratorPrototype,xQ=zG,TQ="constructor",KQ="Iterator",MQ=DS("toStringTag"),DQ=TypeError,LQ=wQ[KQ],UQ=!XQ(LQ)||LQ.prototype!==FQ||!EQ((function(){LQ({})})),zQ=function(){if(WQ(this,FQ),NQ(this)===FQ)throw new DQ("Abstract class Iterator not directly constructable")},QQ=function(e,t){xQ?JQ(FQ,e,{configurable:!0,get:function(){return t},set:function(t){if(kQ(this),this===FQ)throw new DQ("You can't redefine this property");HQ(this,e)?this[e]=t:YQ(this,e,t)}}):FQ[e]=t};HQ(FQ,MQ)||QQ(MQ,KQ),!UQ&&HQ(FQ,TQ)&&FQ[TQ]!==Object||QQ(TQ,zQ),zQ.prototype=FQ,VQ({global:!0,constructor:!0,forced:UQ},{Iterator:zQ});var OQ=function(e){return{iterator:e,next:e.next,done:!1}},jQ=RangeError,PQ=function(e){if(e==e)return e;throw new jQ("NaN is not allowed")},_Q=Uv,qQ=RangeError,$Q=function(e){var t=_Q(e);if(t<0)throw new qQ("The argument can't be less than 0");return t},eO=PG,tO=vw,nO=YR,gO=KK,rO=hv,iO=sS,oO=lF.IteratorPrototype,sO=FF,aO=rY,IO=DS("toStringTag"),lO="IteratorHelper",CO="WrapForValidIterator",cO=rO.set,dO=function(e){var t=rO.getterFor(e?CO:lO);return gO(tO(oO),{next:function(){var n=t(this);if(e)return n.nextHandler();if(n.done)return sO(void 0,!0);try{var g=n.nextHandler();return n.returnHandlerResult?g:sO(g,n.done)}catch(Vye){throw n.done=!0,Vye}},return:function(){var n=t(this),g=n.iterator;if(n.done=!0,e){var r=iO(g,"return");return r?eO(r,g):sO(void 0,!0)}if(n.inner)try{aO(n.inner.iterator,"normal")}catch(Vye){return aO(g,"throw",Vye)}return g&&aO(g,"normal"),sO(void 0,!0)}})},uO=dO(!0),AO=dO(!1);nO(AO,IO,"Iterator Helper");var hO=function(e,t,n){var g=function(g,r){r?(r.iterator=g.iterator,r.next=g.next):r=g,r.type=t?CO:lO,r.returnHandlerResult=!!n,r.nextHandler=e,r.counter=0,r.done=!1,cO(this,r)};return g.prototype=t?uO:AO,g},mO=DG,bO=function(e,t){var n=mO.Iterator,g=n&&n.prototype,r=g&&g[e],i=!1;if(r)try{r.call({next:function(){return{done:!0}},return:function(){i=!0}},-1)}catch(Vye){Vye instanceof t||(i=!1)}if(!i)return r},pO=DV,yO=PG,ZO=ZR,fO=OQ,GO=PQ,BO=$Q,SO=rY,RO=hO,vO=bO("drop",RangeError),VO=RO((function(){for(var e,t=this.iterator,n=this.next;this.remaining;)if(this.remaining--,e=ZO(yO(n,t)),this.done=!!e.done)return;if(e=ZO(yO(n,t)),!(this.done=!!e.done))return e.value}));pO({target:"Iterator",proto:!0,real:!0,forced:vO},{drop:function(e){var t;ZO(this);try{t=BO(GO(+e))}catch(Vye){SO(this,"throw",Vye)}return vO?yO(vO,this,t):new VO(fO(this),{remaining:t})}});var wO=DV,WO=PG,kO=bY,XO=rS,NO=ZR,JO=OQ,YO=rY,EO=bO("every",TypeError);wO({target:"Iterator",proto:!0,real:!0,forced:EO},{every:function(e){NO(this);try{XO(e)}catch(Vye){YO(this,"throw",Vye)}if(EO)return WO(EO,this,e);var t=JO(this),n=0;return!kO(t,(function(t,g){if(!e(t,n++))return g()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}});var HO=DV,FO=PG,xO=rS,TO=ZR,KO=OQ,MO=hO,DO=VH,LO=rY,UO=bO("filter",TypeError),zO=MO((function(){for(var e,t,n=this.iterator,g=this.predicate,r=this.next;;){if(e=TO(FO(r,n)),this.done=!!e.done)return;if(t=e.value,DO(n,g,[t,this.counter++],!0))return t}}));HO({target:"Iterator",proto:!0,real:!0,forced:UO},{filter:function(e){TO(this);try{xO(e)}catch(Vye){LO(this,"throw",Vye)}return UO?FO(UO,this,e):new zO(KO(this),{predicate:e})}});var QO=DV,OO=PG,jO=bY,PO=rS,_O=ZR,qO=OQ,$O=rY,ej=bO("find",TypeError);QO({target:"Iterator",proto:!0,real:!0,forced:ej},{find:function(e){_O(this);try{PO(e)}catch(Vye){$O(this,"throw",Vye)}if(ej)return OO(ej,this,e);var t=qO(this),n=0;return jO(t,(function(t,g){if(e(t,n++))return g(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}});var tj=PG,nj=ZR,gj=OQ,rj=QJ,ij=function(e,t){t&&"string"==typeof e||nj(e);var n=rj(e);return gj(nj(void 0!==n?tj(n,e):e))},oj=DV,sj=PG,aj=rS,Ij=ZR,lj=OQ,Cj=ij,cj=hO,dj=rY,uj=bO("flatMap",TypeError),Aj=cj((function(){for(var e,t,n=this.iterator,g=this.mapper;;){if(t=this.inner)try{if(!(e=Ij(sj(t.next,t.iterator))).done)return e.value;this.inner=null}catch(Vye){dj(n,"throw",Vye)}if(e=Ij(sj(this.next,n)),this.done=!!e.done)return;try{this.inner=Cj(g(e.value,this.counter++),!1)}catch(Vye){dj(n,"throw",Vye)}}}));oj({target:"Iterator",proto:!0,real:!0,forced:uj},{flatMap:function(e){Ij(this);try{aj(e)}catch(Vye){dj(this,"throw",Vye)}return uj?sj(uj,this,e):new Aj(lj(this),{mapper:e,inner:null})}});var hj=DV,mj=PG,bj=bY,pj=rS,yj=ZR,Zj=OQ,fj=rY,Gj=bO("forEach",TypeError);hj({target:"Iterator",proto:!0,real:!0,forced:Gj},{forEach:function(e){yj(this);try{pj(e)}catch(Vye){fj(this,"throw",Vye)}if(Gj)return mj(Gj,this,e);var t=Zj(this),n=0;bj(t,(function(t){e(t,n++)}),{IS_RECORD:!0})}});var Bj=DV,Sj=PG,Rj=RS,vj=XB,Vj=lF.IteratorPrototype,wj=ij,Wj=hO((function(){return Sj(this.next,this.iterator)}),!0);Bj({target:"Iterator",stat:!0,forced:false},{from:function(e){var t=wj("string"==typeof e?Rj(e):e,!0);return vj(Vj,t.iterator)?t.iterator:new Wj(t)}});var kj=DV,Xj=PG,Nj=rS,Jj=ZR,Yj=OQ,Ej=hO,Hj=VH,Fj=rY,xj=bO("map",TypeError),Tj=Ej((function(){var e=this.iterator,t=Jj(Xj(this.next,e));if(!(this.done=!!t.done))return Hj(e,this.mapper,[t.value,this.counter++],!0)}));kj({target:"Iterator",proto:!0,real:!0,forced:xj},{map:function(e){Jj(this);try{Nj(e)}catch(Vye){Fj(this,"throw",Vye)}return xj?Xj(xj,this,e):new Tj(Yj(this),{mapper:e})}});var Kj=DV,Mj=bY,Dj=rS,Lj=ZR,Uj=OQ,zj=rY,Qj=bO,Oj=dX,jj=TypeError,Pj=UG((function(){[].keys().reduce((function(){}),void 0)})),_j=!Pj&&Qj("reduce",jj);Kj({target:"Iterator",proto:!0,real:!0,forced:Pj||_j},{reduce:function(e){Lj(this);try{Dj(e)}catch(Vye){zj(this,"throw",Vye)}var t=arguments.length<2,n=t?void 0:arguments[1];if(_j)return Oj(_j,this,t?[e]:[e,n]);var g=Uj(this),r=0;if(Mj(g,(function(g){t?(t=!1,n=g):n=e(n,g,r),r++}),{IS_RECORD:!0}),t)throw new jj("Reduce of empty iterator with no initial value");return n}});var qj=DV,$j=PG,eP=bY,tP=rS,nP=ZR,gP=OQ,rP=rY,iP=bO("some",TypeError);qj({target:"Iterator",proto:!0,real:!0,forced:iP},{some:function(e){nP(this);try{tP(e)}catch(Vye){rP(this,"throw",Vye)}if(iP)return $j(iP,this,e);var t=gP(this),n=0;return eP(t,(function(t,g){if(e(t,n++))return g()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}});var oP=DV,sP=PG,aP=ZR,IP=OQ,lP=PQ,CP=$Q,cP=hO,dP=rY,uP=bO("take",RangeError),AP=cP((function(){var e=this.iterator;if(!this.remaining--)return this.done=!0,dP(e,"normal",void 0);var t=aP(sP(this.next,e));return(this.done=!!t.done)?void 0:t.value}));oP({target:"Iterator",proto:!0,real:!0,forced:uP},{take:function(e){var t;aP(this);try{t=CP(lP(+e))}catch(Vye){dP(this,"throw",Vye)}return uP?sP(uP,this,t):new AP(IP(this),{remaining:t})}});var hP=ZR,mP=bY,bP=OQ,pP=[].push;DV({target:"Iterator",proto:!0,real:!0},{toArray:function(){var e=[];return mP(bP(hP(this)),pP,{that:e,IS_RECORD:!0}),e}}),eW(DG.JSON,"JSON",!0);var yP={exports:{}},ZP=UG((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),fP=UG,GP=VB,BP=cB,SP=ZP,RP=Object.isExtensible,vP=fP((function(){RP(1)}))||SP?function(e){return!!GP(e)&&((!SP||"ArrayBuffer"!==BP(e))&&(!RP||RP(e)))}:RP,VP=!UG((function(){return Object.isExtensible(Object.preventExtensions({}))})),wP=DV,WP=aB,kP=nv,XP=VB,NP=wS,JP=hR.f,YP=Tv,EP=Vw,HP=vP,FP=VP,xP=!1,TP=JS("meta"),KP=0,MP=function(e){JP(e,TP,{value:{objectID:"O"+KP++,weakData:{}}})},DP=yP.exports={enable:function(){DP.enable=function(){},xP=!0;var e=YP.f,t=WP([].splice),n={};n[TP]=1,e(n).length&&(YP.f=function(n){for(var g=e(n),r=0,i=g.length;r<i;r++)if(g[r]===TP){t(g,r,1);break}return g},wP({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:EP.f}))},fastKey:function(e,t){if(!XP(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!NP(e,TP)){if(!HP(e))return"F";if(!t)return"E";MP(e)}return e[TP].objectID},getWeakData:function(e,t){if(!NP(e,TP)){if(!HP(e))return!0;if(!t)return!1;MP(e)}return e[TP].weakData},onFreeze:function(e){return FP&&xP&&HP(e)&&!NP(e,TP)&&MP(e),e}};kP[TP]=!0;var LP=yP.exports,UP=DV,zP=DG,QP=aB,OP=YV,jP=xv,PP=LP,_P=bY,qP=LK,$P=RB,e_=bB,t_=VB,n_=UG,g_=UH,r_=eW,i_=NN,o_=function(e,t,n){var g=-1!==e.indexOf("Map"),r=-1!==e.indexOf("Weak"),i=g?"set":"add",o=zP[e],s=o&&o.prototype,a=o,I={},l=function(e){var t=QP(s[e]);jP(s,e,"add"===e?function(e){return t(this,0===e?0:e),this}:"delete"===e?function(e){return!(r&&!t_(e))&&t(this,0===e?0:e)}:"get"===e?function(e){return r&&!t_(e)?void 0:t(this,0===e?0:e)}:"has"===e?function(e){return!(r&&!t_(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(OP(e,!$P(o)||!(r||s.forEach&&!n_((function(){(new o).entries().next()})))))a=n.getConstructor(t,e,g,i),PP.enable();else if(OP(e,!0)){var C=new a,c=C[i](r?{}:-0,1)!==C,d=n_((function(){C.has(1)})),u=g_((function(e){new o(e)})),A=!r&&n_((function(){for(var e=new o,t=5;t--;)e[i](t,t);return!e.has(-0)}));u||((a=t((function(e,t){qP(e,s);var n=i_(new o,e,a);return e_(t)||_P(t,n[i],{that:n,AS_ENTRIES:g}),n}))).prototype=s,s.constructor=a),(d||A)&&(l("delete"),l("has"),g&&l("get")),(A||c)&&l(i),r&&s.clear&&delete s.clear}return I[e]=a,UP({global:!0,constructor:!0,forced:a!==o},I),r_(a,e),r||n.setStrong(a,e,g),a},s_=vw,a_=Hw,I_=KK,l_=sW,C_=LK,c_=bB,d_=bY,u_=HF,A_=FF,h_=KT,m_=zG,b_=LP.fastKey,p_=hv.set,y_=hv.getterFor,Z_={getConstructor:function(e,t,n,g){var r=e((function(e,r){C_(e,i),p_(e,{type:t,index:s_(null),first:null,last:null,size:0}),m_||(e.size=0),c_(r)||d_(r,e[g],{that:e,AS_ENTRIES:n})})),i=r.prototype,o=y_(t),s=function(e,t,n){var g,r,i=o(e),s=a(e,t);return s?s.value=n:(i.last=s={index:r=b_(t,!0),key:t,value:n,previous:g=i.last,next:null,removed:!1},i.first||(i.first=s),g&&(g.next=s),m_?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e},a=function(e,t){var n,g=o(e),r=b_(t);if("F"!==r)return g.index[r];for(n=g.first;n;n=n.next)if(n.key===t)return n};return I_(i,{clear:function(){for(var e=o(this),t=e.first;t;)t.removed=!0,t.previous&&(t.previous=t.previous.next=null),t=t.next;e.first=e.last=null,e.index=s_(null),m_?e.size=0:this.size=0},delete:function(e){var t=this,n=o(t),g=a(t,e);if(g){var r=g.next,i=g.previous;delete n.index[g.index],g.removed=!0,i&&(i.next=r),r&&(r.previous=i),n.first===g&&(n.first=r),n.last===g&&(n.last=i),m_?n.size--:t.size--}return!!g},forEach:function(e){for(var t,n=o(this),g=l_(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(g(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),I_(i,n?{get:function(e){var t=a(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),m_&&a_(i,"size",{configurable:!0,get:function(){return o(this).size}}),r},setStrong:function(e,t,n){var g=t+" Iterator",r=y_(t),i=y_(g);u_(e,t,(function(e,t){p_(this,{type:g,target:e,state:r(e),kind:t,last:null})}),(function(){for(var e=i(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?A_("keys"===t?n.key:"values"===t?n.value:[n.key,n.value],!1):(e.target=null,A_(void 0,!0))}),n?"entries":"values",!n,!0),h_(t)}};o_("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Z_);var f_=aB,G_=Map.prototype,B_={Map:Map,set:f_(G_.set),get:f_(G_.get),has:f_(G_.has),remove:f_(G_.delete)},S_=DV,R_=rS,v_=ZB,V_=bY,w_=UG,W_=B_.Map,k_=B_.has,X_=B_.get,N_=B_.set,J_=aB([].push);S_({target:"Map",stat:!0,forced:w_((function(){return 1!==W_.groupBy("ab",(function(e){return e})).get("a").length}))},{groupBy:function(e,t){v_(e),R_(t);var n=new W_,g=0;return V_(e,(function(e){var r=t(e,g++);k_(n,r)?J_(X_(n,r),e):N_(n,r,[e])})),n}});var Y_=Math.log,E_=Math.log1p||function(e){var t=+e;return t>-1e-8&&t<1e-8?t-t*t/2:Y_(1+t)},H_=DV,F_=E_,x_=Math.acosh,T_=Math.log,K_=Math.sqrt,M_=Math.LN2;H_({target:"Math",stat:!0,forced:!x_||710!==Math.floor(x_(Number.MAX_VALUE))||x_(1/0)!==1/0},{acosh:function(e){var t=+e;return t<1?NaN:t>94906265.62425156?T_(t)+M_:F_(t-1+K_(t-1)*K_(t+1))}});var D_=DV,L_=Math.asinh,U_=Math.log,z_=Math.sqrt;D_({target:"Math",stat:!0,forced:!(L_&&1/L_(0)>0)},{asinh:function e(t){var n=+t;return isFinite(n)&&0!==n?n<0?-e(-n):U_(n+z_(n*n+1)):n}});var Q_=DV,O_=Math.atanh,j_=Math.log;Q_({target:"Math",stat:!0,forced:!(O_&&1/O_(-0)<0)},{atanh:function(e){var t=+e;return 0===t?t:j_((1+t)/(1-t))/2}});var P_=DV,__=jK,q_=Math.abs,$_=Math.pow;P_({target:"Math",stat:!0},{cbrt:function(e){var t=+e;return __(t)*$_(q_(t),1/3)}});var eq=DV,tq=Math.floor,nq=Math.log,gq=Math.LOG2E;eq({target:"Math",stat:!0},{clz32:function(e){var t=e>>>0;return t?31-tq(nq(t+.5)*gq):32}});var rq=Math.expm1,iq=Math.exp,oq=!rq||rq(10)>22025.465794806718||rq(10)<22025.465794806718||-2e-17!==rq(-2e-17)?function(e){var t=+e;return 0===t?t:t>-1e-6&&t<1e-6?t+t*t/2:iq(t)-1}:rq,sq=DV,aq=oq,Iq=Math.cosh,lq=Math.abs,Cq=Math.E;sq({target:"Math",stat:!0,forced:!Iq||Iq(710)===1/0},{cosh:function(e){var t=aq(lq(e)-1)+1;return(t+1/(t*Cq*Cq))*(Cq/2)}});var cq=oq;DV({target:"Math",stat:!0,forced:cq!==Math.expm1},{expm1:cq}),DV({target:"Math",stat:!0},{fround:gM});var dq=tM;DV({target:"Math",stat:!0},{f16round:function(e){return dq(e,.0009765625,65504,6103515625e-14)}});var uq=DV,Aq=Math.hypot,hq=Math.abs,mq=Math.sqrt;uq({target:"Math",stat:!0,arity:2,forced:!!Aq&&Aq(1/0,NaN)!==1/0},{hypot:function(e,t){for(var n,g,r=0,i=0,o=arguments.length,s=0;i<o;)s<(n=hq(arguments[i++]))?(r=r*(g=s/n)*g+1,s=n):r+=n>0?(g=n/s)*g:n;return s===1/0?1/0:s*mq(r)}});var bq=DV,pq=UG,yq=Math.imul;bq({target:"Math",stat:!0,forced:pq((function(){return-5!==yq(4294967295,5)||2!==yq.length}))},{imul:function(e,t){var n=65535,g=+e,r=+t,i=n&g,o=n&r;return 0|i*o+((n&g>>>16)*o+i*(n&r>>>16)<<16>>>0)}});var Zq=Math.log,fq=Math.LOG10E,Gq=Math.log10||function(e){return Zq(e)*fq};DV({target:"Math",stat:!0},{log10:Gq}),DV({target:"Math",stat:!0},{log1p:E_}),DV({target:"Math",stat:!0},{log2:GL}),DV({target:"Math",stat:!0},{sign:jK});var Bq=DV,Sq=UG,Rq=oq,vq=Math.abs,Vq=Math.exp,wq=Math.E;Bq({target:"Math",stat:!0,forced:Sq((function(){return-2e-17!==Math.sinh(-2e-17)}))},{sinh:function(e){var t=+e;return vq(t)<1?(Rq(t)-Rq(-t))/2:(Vq(t-1)-Vq(-t-1))*(wq/2)}});var Wq=DV,kq=oq,Xq=Math.exp;Wq({target:"Math",stat:!0},{tanh:function(e){var t=+e,n=kq(t),g=kq(-t);return n===1/0?1:g===1/0?-1:(n-g)/(Xq(t)+Xq(-t))}}),eW(Math,"Math",!0),DV({target:"Math",stat:!0},{trunc:Dv});var Nq=aB(1..valueOf),Jq="\t\n\v\f\r                　\u2028\u2029\ufeff",Yq=ZB,Eq=tw,Hq=Jq,Fq=aB("".replace),xq=RegExp("^["+Hq+"]+"),Tq=RegExp("(^|[^"+Hq+"])["+Hq+"]+$"),Kq=function(e){return function(t){var n=Eq(Yq(t));return 1&e&&(n=Fq(n,xq,"")),2&e&&(n=Fq(n,Tq,"$1")),n}},Mq={start:Kq(1),end:Kq(2),trim:Kq(3)},Dq=DV,Lq=zG,Uq=DG,zq=Tw,Qq=aB,Oq=YV,jq=wS,Pq=NN,_q=XB,qq=qB,$q=_S,e$=UG,t$=Tv.f,n$=LG.f,g$=hR.f,r$=Nq,i$=Mq.trim,o$="Number",s$=Uq[o$];zq[o$];var a$=s$.prototype,I$=Uq.TypeError,l$=Qq("".slice),C$=Qq("".charCodeAt),c$=function(e){var t,n,g,r,i,o,s,a,I=$q(e,"number");if(qq(I))throw new I$("Cannot convert a Symbol value to a number");if("string"==typeof I&&I.length>2)if(I=i$(I),43===(t=C$(I,0))||45===t){if(88===(n=C$(I,2))||120===n)return NaN}else if(48===t){switch(C$(I,1)){case 66:case 98:g=2,r=49;break;case 79:case 111:g=8,r=55;break;default:return+I}for(o=(i=l$(I,2)).length,s=0;s<o;s++)if((a=C$(i,s))<48||a>r)return NaN;return parseInt(i,g)}return+I},d$=Oq(o$,!s$(" 0o1")||!s$("0b1")||s$("+0x1")),u$=function(e){var t,n=arguments.length<1?0:s$(function(e){var t=$q(e,"number");return"bigint"==typeof t?t:c$(t)}(e));return _q(a$,t=this)&&e$((function(){r$(t)}))?Pq(Object(n),this,u$):n};u$.prototype=a$,d$&&(a$.constructor=u$),Dq({global:!0,constructor:!0,wrap:!0,forced:d$},{Number:u$});d$&&function(e,t){for(var n,g=Lq?t$(t):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),r=0;g.length>r;r++)jq(t,n=g[r])&&!jq(e,n)&&g$(e,n,n$(t,n))}(zq[o$],s$),DV({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{EPSILON:Math.pow(2,-52)});var A$=DG.isFinite;DV({target:"Number",stat:!0},{isFinite:Number.isFinite||function(e){return"number"==typeof e&&A$(e)}});var h$=VB,m$=Math.floor,b$=Number.isInteger||function(e){return!h$(e)&&isFinite(e)&&m$(e)===e};DV({target:"Number",stat:!0},{isInteger:b$}),DV({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var p$=DV,y$=b$,Z$=Math.abs;p$({target:"Number",stat:!0},{isSafeInteger:function(e){return y$(e)&&Z$(e)<=9007199254740991}}),DV({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991}),DV({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MIN_SAFE_INTEGER:-9007199254740991});var f$=DG,G$=UG,B$=tw,S$=Mq.trim,R$=Jq,v$=aB("".charAt),V$=f$.parseFloat,w$=f$.Symbol,W$=w$&&w$.iterator,k$=1/V$(R$+"-0")!=-1/0||W$&&!G$((function(){V$(Object(W$))}))?function(e){var t=S$(B$(e)),n=V$(t);return 0===n&&"-"===v$(t,0)?-0:n}:V$,X$=k$;DV({target:"Number",stat:!0,forced:Number.parseFloat!==X$},{parseFloat:X$});var N$=DG,J$=UG,Y$=aB,E$=tw,H$=Mq.trim,F$=Jq,x$=N$.parseInt,T$=N$.Symbol,K$=T$&&T$.iterator,M$=/^[+-]?0x/i,D$=Y$(M$.exec),L$=8!==x$(F$+"08")||22!==x$(F$+"0x16")||K$&&!J$((function(){x$(Object(K$))}))?function(e,t){var n=H$(E$(e));return x$(n,t>>>0||(D$(M$,n)?16:10))}:x$,U$=L$;DV({target:"Number",stat:!0,forced:Number.parseInt!==U$},{parseInt:U$});var z$=DV,Q$=aB,O$=Uv,j$=Nq,P$=ez,_$=Gq,q$=UG,$$=RangeError,e0=String,t0=isFinite,n0=Math.abs,g0=Math.floor,r0=Math.pow,i0=Math.round,o0=Q$(1..toExponential),s0=Q$(P$),a0=Q$("".slice),I0="-6.9000e-11"===o0(-69e-12,4)&&"1.25e+0"===o0(1.255,2)&&"1.235e+4"===o0(12345,3)&&"3e+1"===o0(25,0);z$({target:"Number",proto:!0,forced:!I0||!(q$((function(){o0(1,1/0)}))&&q$((function(){o0(1,-1/0)})))||!!q$((function(){o0(1/0,1/0),o0(NaN,1/0)}))},{toExponential:function(e){var t=j$(this);if(void 0===e)return o0(t);var n=O$(e);if(!t0(t))return String(t);if(n<0||n>20)throw new $$("Incorrect fraction digits");if(I0)return o0(t,n);var g,r,i,o,s="";if(t<0&&(s="-",t=-t),0===t)r=0,g=s0("0",n+1);else{var a=_$(t);r=g0(a);var I=r0(10,r-n),l=i0(t/I);2*t>=(2*l+1)*I&&(l+=1),l>=r0(10,n+1)&&(l/=10,r+=1),g=e0(l)}return 0!==n&&(g=a0(g,0,1)+"."+a0(g,1)),0===r?(i="+",o="0"):(i=r>0?"+":"-",o=e0(n0(r))),s+(g+="e"+i+o)}});var l0=DV,C0=aB,c0=Uv,d0=Nq,u0=ez,A0=UG,h0=RangeError,m0=String,b0=Math.floor,p0=C0(u0),y0=C0("".slice),Z0=C0(1..toFixed),f0=function(e,t,n){return 0===t?n:t%2==1?f0(e,t-1,n*e):f0(e*e,t/2,n)},G0=function(e,t,n){for(var g=-1,r=n;++g<6;)r+=t*e[g],e[g]=r%1e7,r=b0(r/1e7)},B0=function(e,t){for(var n=6,g=0;--n>=0;)g+=e[n],e[n]=b0(g/t),g=g%t*1e7},S0=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var g=m0(e[t]);n=""===n?g:n+p0("0",7-g.length)+g}return n};l0({target:"Number",proto:!0,forced:A0((function(){return"0.000"!==Z0(8e-5,3)||"1"!==Z0(.9,0)||"1.25"!==Z0(1.255,2)||"1000000000000000128"!==Z0(0xde0b6b3a7640080,0)}))||!A0((function(){Z0({})}))},{toFixed:function(e){var t,n,g,r,i=d0(this),o=c0(e),s=[0,0,0,0,0,0],a="",I="0";if(o<0||o>20)throw new h0("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return m0(i);if(i<0&&(a="-",i=-i),i>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(i*f0(2,69,1))-69)<0?i*f0(2,-t,1):i/f0(2,t,1),n*=4503599627370496,(t=52-t)>0){for(G0(s,0,n),g=o;g>=7;)G0(s,1e7,0),g-=7;for(G0(s,f0(10,g,1),0),g=t-1;g>=23;)B0(s,1<<23),g-=23;B0(s,1<<g),G0(s,1,1),B0(s,2),I=S0(s)}else G0(s,0,n),G0(s,1<<-t,0),I=S0(s)+p0("0",o);return I=o>0?a+((r=I.length)<=o?"0."+p0("0",o-r)+I:y0(I,0,r-o)+"."+y0(I,r-o)):a+I}});var R0=DV,v0=UG,V0=Nq,w0=aB(1..toPrecision);R0({target:"Number",proto:!0,forced:v0((function(){return"1"!==w0(1,void 0)}))||!v0((function(){w0({})}))},{toPrecision:function(e){return void 0===e?w0(V0(this)):w0(V0(this),e)}});var W0=zG,k0=aB,X0=PG,N0=UG,J0=iw,Y0=AV,E0=_G,H0=RS,F0=mB,x0=Object.assign,T0=Object.defineProperty,K0=k0([].concat),M0=!x0||N0((function(){if(W0&&1!==x0({b:1},x0(T0({},"a",{enumerable:!0,get:function(){T0(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol("assign detection"),g="abcdefghijklmnopqrst";return e[n]=7,g.split("").forEach((function(e){t[e]=e})),7!==x0({},e)[n]||J0(x0({},t)).join("")!==g}))?function(e,t){for(var n=H0(e),g=arguments.length,r=1,i=Y0.f,o=E0.f;g>r;)for(var s,a=F0(arguments[r++]),I=i?K0(J0(a),i(a)):J0(a),l=I.length,C=0;l>C;)s=I[C++],W0&&!X0(o,a,s)||(n[s]=a[s]);return n}:x0,D0=M0;DV({target:"Object",stat:!0,arity:2,forced:Object.assign!==D0},{assign:D0}),DV({target:"Object",stat:!0,sham:!zG},{create:vw});var L0=DG,U0=AT,z0=!UG((function(){if(!(U0&&U0<535)){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete L0[e]}})),Q0=rS,O0=RS,j0=hR;zG&&DV({target:"Object",proto:!0,forced:z0},{__defineGetter__:function(e,t){j0.f(O0(this),e,{get:Q0(t),enumerable:!0,configurable:!0})}});var P0=DV,_0=zG,q0=nw.f;P0({target:"Object",stat:!0,forced:Object.defineProperties!==q0,sham:!_0},{defineProperties:q0});var $0=DV,e1=zG,t1=hR.f;$0({target:"Object",stat:!0,forced:Object.defineProperty!==t1,sham:!e1},{defineProperty:t1});var n1=rS,g1=RS,r1=hR;zG&&DV({target:"Object",proto:!0,forced:z0},{__defineSetter__:function(e,t){r1.f(g1(this),e,{set:n1(t),enumerable:!0,configurable:!0})}});var i1=zG,o1=UG,s1=aB,a1=EJ,I1=iw,l1=BB,C1=s1(_G.f),c1=s1([].push),d1=i1&&o1((function(){var e=Object.create(null);return e[2]=2,!C1(e,2)})),u1=function(e){return function(t){for(var n,g=l1(t),r=I1(g),i=d1&&null===a1(g),o=r.length,s=0,a=[];o>s;)n=r[s++],i1&&!(i?n in g:C1(g,n))||c1(a,e?[n,g[n]]:g[n]);return a}},A1={entries:u1(!0),values:u1(!1)},h1=A1.entries;DV({target:"Object",stat:!0},{entries:function(e){return h1(e)}});var m1=DV,b1=VP,p1=UG,y1=VB,Z1=LP.onFreeze,f1=Object.freeze;m1({target:"Object",stat:!0,forced:p1((function(){f1(1)})),sham:!b1},{freeze:function(e){return f1&&y1(e)?f1(Z1(e)):e}});var G1=bY,B1=rE;DV({target:"Object",stat:!0},{fromEntries:function(e){var t={};return G1(e,(function(e,n){B1(t,e,n)}),{AS_ENTRIES:!0}),t}});var S1=DV,R1=UG,v1=BB,V1=LG.f,w1=zG;S1({target:"Object",stat:!0,forced:!w1||R1((function(){V1(1)})),sham:!w1},{getOwnPropertyDescriptor:function(e,t){return V1(v1(e),t)}});var W1=ZV,k1=BB,X1=LG,N1=rE;DV({target:"Object",stat:!0,sham:!zG},{getOwnPropertyDescriptors:function(e){for(var t,n,g=k1(e),r=X1.f,i=W1(g),o={},s=0;i.length>s;)void 0!==(n=r(g,t=i[s++]))&&N1(o,t,n);return o}});var J1=DV,Y1=UG,E1=Vw.f;J1({target:"Object",stat:!0,forced:Y1((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:E1});var H1=RS,F1=EJ,x1=VJ;DV({target:"Object",stat:!0,forced:UG((function(){F1(1)})),sham:!x1},{getPrototypeOf:function(e){return F1(H1(e))}});var T1=DV,K1=kB,M1=aB,D1=rS,L1=ZB,U1=eR,z1=bY,Q1=UG,O1=Object.groupBy,j1=K1("Object","create"),P1=M1([].push);T1({target:"Object",stat:!0,forced:!O1||Q1((function(){return 1!==O1("ab",(function(e){return e})).a.length}))},{groupBy:function(e,t){L1(e),D1(t);var n=j1(null),g=0;return z1(e,(function(e){var r=U1(t(e,g++));r in n?P1(n[r],e):n[r]=[e]})),n}}),DV({target:"Object",stat:!0},{hasOwn:wS});var _1=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};DV({target:"Object",stat:!0},{is:_1});var q1=vP;DV({target:"Object",stat:!0,forced:Object.isExtensible!==q1},{isExtensible:q1});var $1=DV,e2=UG,t2=VB,n2=cB,g2=ZP,r2=Object.isFrozen;$1({target:"Object",stat:!0,forced:g2||e2((function(){r2(1)}))},{isFrozen:function(e){return!t2(e)||(!(!g2||"ArrayBuffer"!==n2(e))||!!r2&&r2(e))}});var i2=DV,o2=UG,s2=VB,a2=cB,I2=ZP,l2=Object.isSealed;i2({target:"Object",stat:!0,forced:I2||o2((function(){l2(1)}))},{isSealed:function(e){return!s2(e)||(!(!I2||"ArrayBuffer"!==a2(e))||!!l2&&l2(e))}});var C2=RS,c2=iw;DV({target:"Object",stat:!0,forced:UG((function(){c2(1)}))},{keys:function(e){return c2(C2(e))}});var d2=DV,u2=zG,A2=z0,h2=RS,m2=eR,b2=EJ,p2=LG.f;u2&&d2({target:"Object",proto:!0,forced:A2},{__lookupGetter__:function(e){var t,n=h2(this),g=m2(e);do{if(t=p2(n,g))return t.get}while(n=b2(n))}});var y2=DV,Z2=zG,f2=z0,G2=RS,B2=eR,S2=EJ,R2=LG.f;Z2&&y2({target:"Object",proto:!0,forced:f2},{__lookupSetter__:function(e){var t,n=G2(this),g=B2(e);do{if(t=R2(n,g))return t.set}while(n=S2(n))}});var v2=DV,V2=VB,w2=LP.onFreeze,W2=VP,k2=UG,X2=Object.preventExtensions;v2({target:"Object",stat:!0,forced:k2((function(){X2(1)})),sham:!W2},{preventExtensions:function(e){return X2&&V2(e)?X2(w2(e)):e}});var N2=zG,J2=Hw,Y2=VB,E2=bN,H2=RS,F2=ZB,x2=Object.getPrototypeOf,T2=Object.setPrototypeOf,K2=Object.prototype,M2="__proto__";if(N2&&x2&&T2&&!(M2 in K2))try{J2(K2,M2,{configurable:!0,get:function(){return x2(H2(this))},set:function(e){var t=F2(this);E2(e)&&Y2(t)&&T2(t,e)}})}catch(Vye){}var D2=DV,L2=VB,U2=LP.onFreeze,z2=VP,Q2=UG,O2=Object.seal;D2({target:"Object",stat:!0,forced:Q2((function(){O2(1)})),sham:!z2},{seal:function(e){return O2&&L2(e)?O2(U2(e)):e}}),DV({target:"Object",stat:!0},{setPrototypeOf:vN});var j2=qV,P2=UV?{}.toString:function(){return"[object "+j2(this)+"]"};UV||xv(Object.prototype,"toString",P2,{unsafe:!0});var _2=A1.values;DV({target:"Object",stat:!0},{values:function(e){return _2(e)}});DV({global:!0,forced:parseFloat!==k$},{parseFloat:k$});DV({global:!0,forced:parseInt!==L$},{parseInt:L$});var q2,$2,e3,t3,n3=fW,g3=eS,r3=TypeError,i3=function(e){if(n3(e))return e;throw new r3(g3(e)+" is not a constructor")},o3=ZR,s3=i3,a3=bB,I3=DS("species"),l3=function(e,t){var n,g=o3(e).constructor;return void 0===g||a3(n=o3(g)[I3])?t:s3(n)},C3=TypeError,c3=function(e,t){if(e<t)throw new C3("Not enough arguments");return e},d3=/(?:ipad|iphone|ipod).*applewebkit/i.test(YB),u3=DG,A3=dX,h3=sW,m3=RB,b3=wS,p3=UG,y3=dw,Z3=ww,f3=rR,G3=c3,B3=d3,S3=xx,R3=u3.setImmediate,v3=u3.clearImmediate,V3=u3.process,w3=u3.Dispatch,W3=u3.Function,k3=u3.MessageChannel,X3=u3.String,N3=0,J3={},Y3="onreadystatechange";p3((function(){q2=u3.location}));var E3=function(e){if(b3(J3,e)){var t=J3[e];delete J3[e],t()}},H3=function(e){return function(){E3(e)}},F3=function(e){E3(e.data)},x3=function(e){u3.postMessage(X3(e),q2.protocol+"//"+q2.host)};R3&&v3||(R3=function(e){G3(arguments.length,1);var t=m3(e)?e:W3(e),n=Z3(arguments,1);return J3[++N3]=function(){A3(t,void 0,n)},$2(N3),N3},v3=function(e){delete J3[e]},S3?$2=function(e){V3.nextTick(H3(e))}:w3&&w3.now?$2=function(e){w3.now(H3(e))}:k3&&!B3?(t3=(e3=new k3).port2,e3.port1.onmessage=F3,$2=h3(t3.postMessage,t3)):u3.addEventListener&&m3(u3.postMessage)&&!u3.importScripts&&q2&&"file:"!==q2.protocol&&!p3(x3)?($2=x3,u3.addEventListener("message",F3,!1)):$2=Y3 in f3("script")?function(e){y3.appendChild(f3("script"))[Y3]=function(){y3.removeChild(this),E3(e)}}:function(e){setTimeout(H3(e),0)});var T3={set:R3,clear:v3},K3=DG,M3=zG,D3=Object.getOwnPropertyDescriptor,L3=function(e){if(!M3)return K3[e];var t=D3(K3,e);return t&&t.value},U3=function(){this.head=null,this.tail=null};U3.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var z3,Q3,O3,j3,P3,_3=U3,q3=/ipad|iphone|ipod/i.test(YB)&&"undefined"!=typeof Pebble,$3=/web0s(?!.*chrome)/i.test(YB),e5=DG,t5=L3,n5=sW,g5=T3.set,r5=_3,i5=d3,o5=q3,s5=$3,a5=xx,I5=e5.MutationObserver||e5.WebKitMutationObserver,l5=e5.document,C5=e5.process,c5=e5.Promise,d5=t5("queueMicrotask");if(!d5){var u5=new r5,A5=function(){var e,t;for(a5&&(e=C5.domain)&&e.exit();t=u5.get();)try{t()}catch(Vye){throw u5.head&&z3(),Vye}e&&e.enter()};i5||a5||s5||!I5||!l5?!o5&&c5&&c5.resolve?((j3=c5.resolve(void 0)).constructor=c5,P3=n5(j3.then,j3),z3=function(){P3(A5)}):a5?z3=function(){C5.nextTick(A5)}:(g5=n5(g5,e5),z3=function(){g5(A5)}):(Q3=!0,O3=l5.createTextNode(""),new I5(A5).observe(O3,{characterData:!0}),z3=function(){O3.data=Q3=!Q3}),d5=function(e){u5.head||z3(),u5.add(e)}}var h5=d5,m5=function(e){try{return{error:!1,value:e()}}catch(Vye){return{error:!0,value:Vye}}},b5=DG.Promise,p5=DG,y5=b5,Z5=RB,f5=YV,G5=jR,B5=DS,S5=Fx,R5=MB;y5&&y5.prototype;var v5=B5("species"),V5=!1,w5=Z5(p5.PromiseRejectionEvent),W5={CONSTRUCTOR:f5("Promise",(function(){var e=G5(y5),t=e!==String(y5);if(!t&&66===R5)return!0;if(!R5||R5<51||!/native code/.test(e)){var n=new y5((function(e){e(1)})),g=function(e){e((function(){}),(function(){}))};if((n.constructor={})[v5]=g,!(V5=n.then((function(){}))instanceof g))return!0}return!(t||"BROWSER"!==S5&&"DENO"!==S5||w5)})),REJECTION_EVENT:w5,SUBCLASSING:V5},k5={},X5=rS,N5=TypeError,J5=function(e){var t,n;this.promise=new e((function(e,g){if(void 0!==t||void 0!==n)throw new N5("Bad Promise constructor");t=e,n=g})),this.resolve=X5(t),this.reject=X5(n)};k5.f=function(e){return new J5(e)};var Y5,E5,H5,F5=DV,x5=xx,T5=DG,K5=PG,M5=xv,D5=vN,L5=eW,U5=KT,z5=rS,Q5=RB,O5=VB,j5=LK,P5=l3,_5=T3.set,q5=h5,$5=function(e,t){},e9=m5,t9=_3,n9=hv,g9=b5,r9=k5,i9="Promise",o9=W5.CONSTRUCTOR,s9=W5.REJECTION_EVENT,a9=W5.SUBCLASSING,I9=n9.getterFor(i9),l9=n9.set,C9=g9&&g9.prototype,c9=g9,d9=C9,u9=T5.TypeError,A9=T5.document,h9=T5.process,m9=r9.f,b9=m9,p9=!!(A9&&A9.createEvent&&T5.dispatchEvent),y9="unhandledrejection",Z9=function(e){var t;return!(!O5(e)||!Q5(t=e.then))&&t},f9=function(e,t){var n,g,r,i=t.value,o=1===t.state,s=o?e.ok:e.fail,a=e.resolve,I=e.reject,l=e.domain;try{s?(o||(2===t.rejection&&v9(t),t.rejection=1),!0===s?n=i:(l&&l.enter(),n=s(i),l&&(l.exit(),r=!0)),n===e.promise?I(new u9("Promise-chain cycle")):(g=Z9(n))?K5(g,n,a,I):a(n)):I(i)}catch(Vye){l&&!r&&l.exit(),I(Vye)}},G9=function(e,t){e.notified||(e.notified=!0,q5((function(){for(var n,g=e.reactions;n=g.get();)f9(n,e);e.notified=!1,t&&!e.rejection&&S9(e)})))},B9=function(e,t,n){var g,r;p9?((g=A9.createEvent("Event")).promise=t,g.reason=n,g.initEvent(e,!1,!0),T5.dispatchEvent(g)):g={promise:t,reason:n},!s9&&(r=T5["on"+e])?r(g):e===y9&&$5("Unhandled promise rejection",n)},S9=function(e){K5(_5,T5,(function(){var t,n=e.facade,g=e.value;if(R9(e)&&(t=e9((function(){x5?h9.emit("unhandledRejection",g,n):B9(y9,n,g)})),e.rejection=x5||R9(e)?2:1,t.error))throw t.value}))},R9=function(e){return 1!==e.rejection&&!e.parent},v9=function(e){K5(_5,T5,(function(){var t=e.facade;x5?h9.emit("rejectionHandled",t):B9("rejectionhandled",t,e.value)}))},V9=function(e,t,n){return function(g){e(t,g,n)}},w9=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,G9(e,!0))},W9=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new u9("Promise can't be resolved itself");var g=Z9(t);g?q5((function(){var n={done:!1};try{K5(g,t,V9(W9,n,e),V9(w9,n,e))}catch(Vye){w9(n,Vye,e)}})):(e.value=t,e.state=1,G9(e,!1))}catch(Vye){w9({done:!1},Vye,e)}}};if(o9&&(d9=(c9=function(e){j5(this,d9),z5(e),K5(Y5,this);var t=I9(this);try{e(V9(W9,t),V9(w9,t))}catch(Vye){w9(t,Vye)}}).prototype,(Y5=function(e){l9(this,{type:i9,done:!1,notified:!1,parent:!1,reactions:new t9,rejection:!1,state:0,value:null})}).prototype=M5(d9,"then",(function(e,t){var n=I9(this),g=m9(P5(this,c9));return n.parent=!0,g.ok=!Q5(e)||e,g.fail=Q5(t)&&t,g.domain=x5?h9.domain:void 0,0===n.state?n.reactions.add(g):q5((function(){f9(g,n)})),g.promise})),E5=function(){var e=new Y5,t=I9(e);this.promise=e,this.resolve=V9(W9,t),this.reject=V9(w9,t)},r9.f=m9=function(e){return e===c9||undefined===e?new E5(e):b9(e)},Q5(g9)&&C9!==Object.prototype)){H5=C9.then,a9||M5(C9,"then",(function(e,t){var n=this;return new c9((function(e,t){K5(H5,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete C9.constructor}catch(Vye){}D5&&D5(C9,d9)}F5({global:!0,constructor:!0,wrap:!0,forced:o9},{Promise:c9}),L5(c9,i9,!1),U5(i9);var k9=b5,X9=W5.CONSTRUCTOR||!UH((function(e){k9.all(e).then(void 0,(function(){}))})),N9=PG,J9=rS,Y9=k5,E9=m5,H9=bY;DV({target:"Promise",stat:!0,forced:X9},{all:function(e){var t=this,n=Y9.f(t),g=n.resolve,r=n.reject,i=E9((function(){var n=J9(t.resolve),i=[],o=0,s=1;H9(e,(function(e){var a=o++,I=!1;s++,N9(n,t,e).then((function(e){I||(I=!0,i[a]=e,--s||g(i))}),r)})),--s||g(i)}));return i.error&&r(i.value),n.promise}});var F9=DV,x9=W5.CONSTRUCTOR,T9=b5,K9=kB,M9=RB,D9=xv,L9=T9&&T9.prototype;if(F9({target:"Promise",proto:!0,forced:x9,real:!0},{catch:function(e){return this.then(void 0,e)}}),M9(T9)){var U9=K9("Promise").prototype.catch;L9.catch!==U9&&D9(L9,"catch",U9,{unsafe:!0})}var z9=PG,Q9=rS,O9=k5,j9=m5,P9=bY;DV({target:"Promise",stat:!0,forced:X9},{race:function(e){var t=this,n=O9.f(t),g=n.reject,r=j9((function(){var r=Q9(t.resolve);P9(e,(function(e){z9(r,t,e).then(n.resolve,g)}))}));return r.error&&g(r.value),n.promise}});var _9=k5;DV({target:"Promise",stat:!0,forced:W5.CONSTRUCTOR},{reject:function(e){var t=_9.f(this);return(0,t.reject)(e),t.promise}});var q9=ZR,$9=VB,e4=k5,t4=function(e,t){if(q9(e),$9(t)&&t.constructor===e)return t;var n=e4.f(e);return(0,n.resolve)(t),n.promise},n4=DV,g4=W5.CONSTRUCTOR,r4=t4;kB("Promise"),n4({target:"Promise",stat:!0,forced:g4},{resolve:function(e){return r4(this,e)}});var i4=PG,o4=rS,s4=k5,a4=m5,I4=bY;DV({target:"Promise",stat:!0,forced:X9},{allSettled:function(e){var t=this,n=s4.f(t),g=n.resolve,r=n.reject,i=a4((function(){var n=o4(t.resolve),r=[],i=0,o=1;I4(e,(function(e){var s=i++,a=!1;o++,i4(n,t,e).then((function(e){a||(a=!0,r[s]={status:"fulfilled",value:e},--o||g(r))}),(function(e){a||(a=!0,r[s]={status:"rejected",reason:e},--o||g(r))}))})),--o||g(r)}));return i.error&&r(i.value),n.promise}});var l4=PG,C4=rS,c4=kB,d4=k5,u4=m5,A4=bY,h4="No one promise resolved";DV({target:"Promise",stat:!0,forced:X9},{any:function(e){var t=this,n=c4("AggregateError"),g=d4.f(t),r=g.resolve,i=g.reject,o=u4((function(){var g=C4(t.resolve),o=[],s=0,a=1,I=!1;A4(e,(function(e){var l=s++,C=!1;a++,l4(g,t,e).then((function(e){C||I||(I=!0,r(e))}),(function(e){C||I||(C=!0,o[l]=e,--a||i(new n(o,h4)))}))})),--a||i(new n(o,h4))}));return o.error&&i(o.value),g.promise}});var m4=DV,b4=b5,p4=UG,y4=kB,Z4=RB,f4=l3,G4=t4,B4=xv,S4=b4&&b4.prototype;if(m4({target:"Promise",proto:!0,real:!0,forced:!!b4&&p4((function(){S4.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=f4(this,y4("Promise")),n=Z4(e);return this.then(n?function(n){return G4(t,e()).then((function(){return n}))}:e,n?function(n){return G4(t,e()).then((function(){throw n}))}:e)}}),Z4(b4)){var R4=y4("Promise").prototype.finally;S4.finally!==R4&&B4(S4,"finally",R4,{unsafe:!0})}var v4=DV,V4=dX,w4=ww,W4=k5,k4=rS,X4=m5,N4=DG.Promise,J4=!1;v4({target:"Promise",stat:!0,forced:!N4||!N4.try||X4((function(){N4.try((function(e){J4=8===e}),8)})).error||!J4},{try:function(e){var t=arguments.length>1?w4(arguments,1):[],n=W4.f(this),g=X4((function(){return V4(k4(e),void 0,t)}));return(g.error?n.reject:n.resolve)(g.value),n.promise}});var Y4=k5;DV({target:"Promise",stat:!0},{withResolvers:function(){var e=Y4.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var E4=dX,H4=rS,F4=ZR;DV({target:"Reflect",stat:!0,forced:!UG((function(){Reflect.apply((function(){}))}))},{apply:function(e,t,n){return E4(H4(e),t,F4(n))}});var x4=DV,T4=dX,K4=lQ,M4=i3,D4=ZR,L4=VB,U4=vw,z4=UG,Q4=kB("Reflect","construct"),O4=Object.prototype,j4=[].push,P4=z4((function(){function e(){}return!(Q4((function(){}),[],e)instanceof e)})),_4=!z4((function(){Q4((function(){}))})),q4=P4||_4;x4({target:"Reflect",stat:!0,forced:q4,sham:q4},{construct:function(e,t){M4(e),D4(t);var n=arguments.length<3?e:M4(arguments[2]);if(_4&&!P4)return Q4(e,t,n);if(e===n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var g=[null];return T4(j4,g,t),new(T4(K4,e,g))}var r=n.prototype,i=U4(L4(r)?r:O4),o=T4(e,i,t);return L4(o)?o:i}});var $4=zG,e8=ZR,t8=eR,n8=hR;DV({target:"Reflect",stat:!0,forced:UG((function(){Reflect.defineProperty(n8.f({},1,{value:1}),1,{value:2})})),sham:!$4},{defineProperty:function(e,t,n){e8(e);var g=t8(t);e8(n);try{return n8.f(e,g,n),!0}catch(Vye){return!1}}});var g8=DV,r8=ZR,i8=LG.f;g8({target:"Reflect",stat:!0},{deleteProperty:function(e,t){var n=i8(r8(e),t);return!(n&&!n.configurable)&&delete e[t]}});var o8=wS,s8=function(e){return void 0!==e&&(o8(e,"value")||o8(e,"writable"))},a8=PG,I8=VB,l8=ZR,C8=s8,c8=LG,d8=EJ;DV({target:"Reflect",stat:!0},{get:function e(t,n){var g,r,i=arguments.length<3?t:arguments[2];return l8(t)===i?t[n]:(g=c8.f(t,n))?C8(g)?g.value:void 0===g.get?void 0:a8(g.get,i):I8(r=d8(t))?e(r,n,i):void 0}});var u8=ZR,A8=LG;DV({target:"Reflect",stat:!0,sham:!zG},{getOwnPropertyDescriptor:function(e,t){return A8.f(u8(e),t)}});var h8=ZR,m8=EJ;DV({target:"Reflect",stat:!0,sham:!VJ},{getPrototypeOf:function(e){return m8(h8(e))}}),DV({target:"Reflect",stat:!0},{has:function(e,t){return t in e}});var b8=ZR,p8=vP;DV({target:"Reflect",stat:!0},{isExtensible:function(e){return b8(e),p8(e)}}),DV({target:"Reflect",stat:!0},{ownKeys:ZV});var y8=kB,Z8=ZR;DV({target:"Reflect",stat:!0,sham:!VP},{preventExtensions:function(e){Z8(e);try{var t=y8("Object","preventExtensions");return t&&t(e),!0}catch(Vye){return!1}}});var f8=PG,G8=ZR,B8=VB,S8=s8,R8=hR,v8=LG,V8=EJ,w8=gB;DV({target:"Reflect",stat:!0,forced:UG((function(){var e=function(){},t=R8.f(new e,"a",{configurable:!0});return!1!==Reflect.set(e.prototype,"a",1,t)}))},{set:function e(t,n,g){var r,i,o,s=arguments.length<4?t:arguments[3],a=v8.f(G8(t),n);if(!a){if(B8(i=V8(t)))return e(i,n,g,s);a=w8(0)}if(S8(a)){if(!1===a.writable||!B8(s))return!1;if(r=v8.f(s,n)){if(r.get||r.set||!1===r.writable)return!1;r.value=g,R8.f(s,n,r)}else R8.f(s,n,w8(0,g))}else{if(void 0===(o=a.set))return!1;f8(o,s,g)}return!0}});var W8=ZR,k8=fN,X8=vN;X8&&DV({target:"Reflect",stat:!0},{setPrototypeOf:function(e,t){W8(e),k8(t);try{return X8(e,t),!0}catch(Vye){return!1}}});var N8=DG,J8=eW;DV({global:!0},{Reflect:{}}),J8(N8.Reflect,"Reflect",!0);var Y8=VB,E8=cB,H8=DS("match"),F8=function(e){var t;return Y8(e)&&(void 0!==(t=e[H8])?!!t:"RegExp"===E8(e))},x8=ZR,T8=function(){var e=x8(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},K8=PG,M8=wS,D8=XB,L8=T8,U8=RegExp.prototype,z8=function(e){var t=e.flags;return void 0!==t||"flags"in U8||M8(e,"flags")||!D8(U8,e)?t:K8(L8,e)},Q8=UG,O8=DG.RegExp,j8=Q8((function(){var e=O8("a","y");return e.lastIndex=2,null!==e.exec("abcd")})),P8=j8||Q8((function(){return!O8("a","y").sticky})),_8=j8||Q8((function(){var e=O8("^r","gy");return e.lastIndex=2,null!==e.exec("str")})),q8={BROKEN_CARET:_8,MISSED_STICKY:P8,UNSUPPORTED_Y:j8},$8=UG,e7=DG.RegExp,t7=$8((function(){var e=e7(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})),n7=UG,g7=DG.RegExp,r7=n7((function(){var e=g7("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),i7=zG,o7=DG,s7=aB,a7=YV,I7=NN,l7=YR,C7=vw,c7=Tv.f,d7=XB,u7=F8,A7=tw,h7=z8,m7=q8,b7=wN,p7=xv,y7=UG,Z7=wS,f7=hv.enforce,G7=KT,B7=t7,S7=r7,R7=DS("match"),v7=o7.RegExp,V7=v7.prototype,w7=o7.SyntaxError,W7=s7(V7.exec),k7=s7("".charAt),X7=s7("".replace),N7=s7("".indexOf),J7=s7("".slice),Y7=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,E7=/a/g,H7=/a/g,F7=new v7(E7)!==E7,x7=m7.MISSED_STICKY,T7=m7.UNSUPPORTED_Y,K7=i7&&(!F7||x7||B7||S7||y7((function(){return H7[R7]=!1,v7(E7)!==E7||v7(H7)===H7||"/a/i"!==String(v7(E7,"i"))})));if(a7("RegExp",K7)){for(var M7=function(e,t){var n,g,r,i,o,s,a=d7(V7,this),I=u7(e),l=void 0===t,C=[],c=e;if(!a&&I&&l&&e.constructor===M7)return e;if((I||d7(V7,e))&&(e=e.source,l&&(t=h7(c))),e=void 0===e?"":A7(e),t=void 0===t?"":A7(t),c=e,B7&&"dotAll"in E7&&(g=!!t&&N7(t,"s")>-1)&&(t=X7(t,/s/g,"")),n=t,x7&&"sticky"in E7&&(r=!!t&&N7(t,"y")>-1)&&T7&&(t=X7(t,/y/g,"")),S7&&(i=function(e){for(var t,n=e.length,g=0,r="",i=[],o=C7(null),s=!1,a=!1,I=0,l="";g<=n;g++){if("\\"===(t=k7(e,g)))t+=k7(e,++g);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:if(r+=t,"?:"===J7(e,g+1,g+3))continue;W7(Y7,J7(e,g+1))&&(g+=2,a=!0),I++;continue;case">"===t&&a:if(""===l||Z7(o,l))throw new w7("Invalid capture group name");o[l]=!0,i[i.length]=[l,I],a=!1,l="";continue}a?l+=t:r+=t}return[r,i]}(e),e=i[0],C=i[1]),o=I7(v7(e,t),a?this:V7,M7),(g||r||C.length)&&(s=f7(o),g&&(s.dotAll=!0,s.raw=M7(function(e){for(var t,n=e.length,g=0,r="",i=!1;g<=n;g++)"\\"!==(t=k7(e,g))?i||"."!==t?("["===t?i=!0:"]"===t&&(i=!1),r+=t):r+="[\\s\\S]":r+=t+k7(e,++g);return r}(e),n)),r&&(s.sticky=!0),C.length&&(s.groups=C)),e!==c)try{l7(o,"source",""===c?"(?:)":c)}catch(Vye){}return o},D7=c7(v7),L7=0;D7.length>L7;)b7(M7,v7,D7[L7++]);V7.constructor=M7,M7.prototype=V7,p7(o7,"RegExp",M7,{constructor:!0})}G7("RegExp");var U7=TypeError,z7=DV,Q7=aB,O7=function(e){if("string"==typeof e)return e;throw new U7("Argument is not a string")},j7=wS,P7=Iz.start,_7=Jq,q7=Array,$7=RegExp.escape,e6=Q7("".charAt),t6=Q7("".charCodeAt),n6=Q7(1.1.toString),g6=Q7([].join),r6=/^[0-9a-z]/i,i6=/^[$()*+./?[\\\]^{|}]/,o6=RegExp("^[!\"#%&',\\-:;<=>@`~"+_7+"]"),s6=Q7(r6.exec),a6={"\t":"t","\n":"n","\v":"v","\f":"f","\r":"r"},I6=function(e){var t=n6(t6(e,0),16);return t.length<3?"\\x"+P7(t,2,"0"):"\\u"+P7(t,4,"0")};z7({target:"RegExp",stat:!0,forced:!$7||"\\x61b"!==$7("ab")},{escape:function(e){O7(e);for(var t=e.length,n=q7(t),g=0;g<t;g++){var r=e6(e,g);if(0===g&&s6(r6,r))n[g]=I6(r);else if(j7(a6,r))n[g]="\\"+a6[r];else if(s6(i6,r))n[g]="\\"+r;else if(s6(o6,r))n[g]=I6(r);else{var i=t6(r,0);55296!=(63488&i)?n[g]=r:i>=56320||g+1>=t||56320!=(64512&t6(e,g+1))?n[g]=I6(r):(n[g]=r,n[++g]=e6(e,g))}}return g6(n,"")}});var l6=zG,C6=t7,c6=cB,d6=Hw,u6=hv.get,A6=RegExp.prototype,h6=TypeError;l6&&C6&&d6(A6,"dotAll",{configurable:!0,get:function(){if(this!==A6){if("RegExp"===c6(this))return!!u6(this).dotAll;throw new h6("Incompatible receiver, RegExp required")}}});var m6,b6,p6=PG,y6=aB,Z6=tw,f6=T8,G6=q8,B6=vw,S6=hv.get,R6=t7,v6=r7,V6=GS("native-string-replace",String.prototype.replace),w6=RegExp.prototype.exec,W6=w6,k6=y6("".charAt),X6=y6("".indexOf),N6=y6("".replace),J6=y6("".slice),Y6=(b6=/b*/g,p6(w6,m6=/a/,"a"),p6(w6,b6,"a"),0!==m6.lastIndex||0!==b6.lastIndex),E6=G6.BROKEN_CARET,H6=void 0!==/()??/.exec("")[1];(Y6||H6||E6||R6||v6)&&(W6=function(e){var t,n,g,r,i,o,s,a=this,I=S6(a),l=Z6(e),C=I.raw;if(C)return C.lastIndex=a.lastIndex,t=p6(W6,C,l),a.lastIndex=C.lastIndex,t;var c=I.groups,d=E6&&a.sticky,u=p6(f6,a),A=a.source,h=0,m=l;if(d&&(u=N6(u,"y",""),-1===X6(u,"g")&&(u+="g"),m=J6(l,a.lastIndex),a.lastIndex>0&&(!a.multiline||a.multiline&&"\n"!==k6(l,a.lastIndex-1))&&(A="(?: "+A+")",m=" "+m,h++),n=new RegExp("^(?:"+A+")",u)),H6&&(n=new RegExp("^"+A+"$(?!\\s)",u)),Y6&&(g=a.lastIndex),r=p6(w6,d?n:a,m),d?r?(r.input=J6(r.input,h),r[0]=J6(r[0],h),r.index=a.lastIndex,a.lastIndex+=r[0].length):a.lastIndex=0:Y6&&r&&(a.lastIndex=a.global?r.index+r[0].length:g),H6&&r&&r.length>1&&p6(V6,r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r&&c)for(r.groups=o=B6(null),i=0;i<c.length;i++)o[(s=c[i])[0]]=r[s[1]];return r});var F6=W6;DV({target:"RegExp",proto:!0,forced:/./.exec!==F6},{exec:F6});var x6=zG,T6=Hw,K6=T8,M6=UG,D6=DG.RegExp,L6=D6.prototype,U6=x6&&M6((function(){var e=!0;try{D6(".","d")}catch(Vye){e=!1}var t={},n="",g=e?"dgimsy":"gimsy",r=function(e,g){Object.defineProperty(t,e,{get:function(){return n+=g,!0}})},i={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(i.hasIndices="d"),i)r(o,i[o]);return Object.getOwnPropertyDescriptor(L6,"flags").get.call(t)!==g||n!==g}));U6&&T6(L6,"flags",{configurable:!0,get:K6});var z6=zG,Q6=q8.MISSED_STICKY,O6=cB,j6=Hw,P6=hv.get,_6=RegExp.prototype,q6=TypeError;z6&&Q6&&j6(_6,"sticky",{configurable:!0,get:function(){if(this!==_6){if("RegExp"===O6(this))return!!P6(this).sticky;throw new q6("Incompatible receiver, RegExp required")}}});var $6,eee,tee=DV,nee=PG,gee=RB,ree=ZR,iee=tw,oee=($6=!1,(eee=/[ac]/).exec=function(){return $6=!0,/./.exec.apply(this,arguments)},!0===eee.test("abc")&&$6),see=/./.test;tee({target:"RegExp",proto:!0,forced:!oee},{test:function(e){var t=ree(this),n=iee(e),g=t.exec;if(!gee(g))return nee(see,t,n);var r=nee(g,t,n);return null!==r&&(ree(r),!0)}});var aee=MR.PROPER,Iee=xv,lee=ZR,Cee=tw,cee=UG,dee=z8,uee="toString",Aee=RegExp.prototype,hee=Aee[uee],mee=cee((function(){return"/a/b"!==hee.call({source:"a",flags:"b"})})),bee=aee&&hee.name!==uee;(mee||bee)&&Iee(Aee,uee,(function(){var e=lee(this);return"/"+Cee(e.source)+"/"+Cee(dee(e))}),{unsafe:!0}),o_("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Z_);var pee=aB,yee=Set.prototype,Zee={Set:Set,add:pee(yee.add),has:pee(yee.has),remove:pee(yee.delete),proto:yee},fee=Zee.has,Gee=function(e){return fee(e),e},Bee=PG,See=function(e,t,n){for(var g,r,i=n?e:e.iterator,o=e.next;!(g=Bee(o,i)).done;)if(void 0!==(r=t(g.value)))return r},Ree=aB,vee=See,Vee=Zee.Set,wee=Zee.proto,Wee=Ree(wee.forEach),kee=Ree(wee.keys),Xee=kee(new Vee).next,Nee=function(e,t,n){return n?vee({iterator:kee(e),next:Xee},t):Wee(e,t)},Jee=Nee,Yee=Zee.Set,Eee=Zee.add,Hee=function(e){var t=new Yee;return Jee(e,(function(e){Eee(t,e)})),t},Fee=hN(Zee.proto,"size","get")||function(e){return e.size},xee=rS,Tee=ZR,Kee=PG,Mee=Uv,Dee=OQ,Lee="Invalid size",Uee=RangeError,zee=TypeError,Qee=Math.max,Oee=function(e,t){this.set=e,this.size=Qee(t,0),this.has=xee(e.has),this.keys=xee(e.keys)};Oee.prototype={getIterator:function(){return Dee(Tee(Kee(this.keys,this.set)))},includes:function(e){return Kee(this.has,this.set,e)}};var jee=function(e){Tee(e);var t=+e.size;if(t!=t)throw new zee(Lee);var n=Mee(t);if(n<0)throw new Uee(Lee);return new Oee(e,n)},Pee=Gee,_ee=Hee,qee=Fee,$ee=jee,ete=Nee,tte=See,nte=Zee.has,gte=Zee.remove,rte=kB,ite=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},ote=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}},ste=function(e,t){var n=rte("Set");try{(new n)[e](ite(0));try{return(new n)[e](ite(-1)),!1}catch(r){if(!t)return!0;try{return(new n)[e](ote(-1/0)),!1}catch(Vye){var g=new n;return g.add(1),g.add(2),t(g[e](ote(1/0)))}}}catch(Vye){return!1}},ate=function(e){var t=Pee(this),n=$ee(e),g=_ee(t);return qee(t)<=n.size?ete(t,(function(e){n.includes(e)&&gte(g,e)})):tte(n.getIterator(),(function(e){nte(t,e)&&gte(g,e)})),g};DV({target:"Set",proto:!0,real:!0,forced:!ste("difference",(function(e){return 0===e.size}))},{difference:ate});var Ite=Gee,lte=Fee,Cte=jee,cte=Nee,dte=See,ute=Zee.Set,Ate=Zee.add,hte=Zee.has,mte=UG,bte=function(e){var t=Ite(this),n=Cte(e),g=new ute;return lte(t)>n.size?dte(n.getIterator(),(function(e){hte(t,e)&&Ate(g,e)})):cte(t,(function(e){n.includes(e)&&Ate(g,e)})),g};DV({target:"Set",proto:!0,real:!0,forced:!ste("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||mte((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}))},{intersection:bte});var pte=Gee,yte=Zee.has,Zte=Fee,fte=jee,Gte=Nee,Bte=See,Ste=rY,Rte=function(e){var t=pte(this),n=fte(e);if(Zte(t)<=n.size)return!1!==Gte(t,(function(e){if(n.includes(e))return!1}),!0);var g=n.getIterator();return!1!==Bte(g,(function(e){if(yte(t,e))return Ste(g,"normal",!1)}))};DV({target:"Set",proto:!0,real:!0,forced:!ste("isDisjointFrom",(function(e){return!e}))},{isDisjointFrom:Rte});var vte=Gee,Vte=Fee,wte=Nee,Wte=jee,kte=function(e){var t=vte(this),n=Wte(e);return!(Vte(t)>n.size)&&!1!==wte(t,(function(e){if(!n.includes(e))return!1}),!0)};DV({target:"Set",proto:!0,real:!0,forced:!ste("isSubsetOf",(function(e){return e}))},{isSubsetOf:kte});var Xte=Gee,Nte=Zee.has,Jte=Fee,Yte=jee,Ete=See,Hte=rY,Fte=function(e){var t=Xte(this),n=Yte(e);if(Jte(t)<n.size)return!1;var g=n.getIterator();return!1!==Ete(g,(function(e){if(!Nte(t,e))return Hte(g,"normal",!1)}))};DV({target:"Set",proto:!0,real:!0,forced:!ste("isSupersetOf",(function(e){return!e}))},{isSupersetOf:Fte});var xte=Gee,Tte=Hee,Kte=jee,Mte=See,Dte=Zee.add,Lte=Zee.has,Ute=Zee.remove,zte=function(e){var t=xte(this),n=Kte(e).getIterator(),g=Tte(t);return Mte(n,(function(e){Lte(t,e)?Ute(g,e):Dte(g,e)})),g};DV({target:"Set",proto:!0,real:!0,forced:!ste("symmetricDifference")},{symmetricDifference:zte});var Qte=Gee,Ote=Zee.add,jte=Hee,Pte=jee,_te=See,qte=function(e){var t=Qte(this),n=Pte(e).getIterator(),g=jte(t);return _te(n,(function(e){Ote(g,e)})),g};DV({target:"Set",proto:!0,real:!0,forced:!ste("union")},{union:qte});var $te=DV,ene=ZB,tne=Uv,nne=tw,gne=UG,rne=aB("".charAt);$te({target:"String",proto:!0,forced:gne((function(){return"\ud842"!=="𠮷".at(-2)}))},{at:function(e){var t=nne(ene(this)),n=t.length,g=tne(e),r=g>=0?g:n+g;return r<0||r>=n?void 0:rne(t,r)}});var ine=aB,one=Uv,sne=tw,ane=ZB,Ine=ine("".charAt),lne=ine("".charCodeAt),Cne=ine("".slice),cne=function(e){return function(t,n){var g,r,i=sne(ane(t)),o=one(n),s=i.length;return o<0||o>=s?e?"":void 0:(g=lne(i,o))<55296||g>56319||o+1===s||(r=lne(i,o+1))<56320||r>57343?e?Ine(i,o):g:e?Cne(i,o,o+2):r-56320+(g-55296<<10)+65536}},dne={codeAt:cne(!1),charAt:cne(!0)},une=dne.codeAt;DV({target:"String",proto:!0},{codePointAt:function(e){return une(this,e)}});var Ane=F8,hne=TypeError,mne=function(e){if(Ane(e))throw new hne("The method doesn't accept regular expressions");return e},bne=DS("match"),pne=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[bne]=!1,"/./"[e](t)}catch(g){}}return!1},yne=DV,Zne=gW,fne=LG.f,Gne=qv,Bne=tw,Sne=mne,Rne=ZB,vne=pne,Vne=Zne("".slice),wne=Math.min,Wne=vne("endsWith"),kne=!Wne&&!!function(){var e=fne(String.prototype,"endsWith");return e&&!e.writable}();yne({target:"String",proto:!0,forced:!kne&&!Wne},{endsWith:function(e){var t=Bne(Rne(this));Sne(e);var n=arguments.length>1?arguments[1]:void 0,g=t.length,r=void 0===n?g:wne(Gne(n),g),i=Bne(e);return Vne(t,r-i.length,r)===i}});var Xne=DV,Nne=aB,Jne=jv,Yne=RangeError,Ene=String.fromCharCode,Hne=String.fromCodePoint,Fne=Nne([].join);Xne({target:"String",stat:!0,arity:1,forced:!!Hne&&1!==Hne.length},{fromCodePoint:function(e){for(var t,n=[],g=arguments.length,r=0;g>r;){if(t=+arguments[r++],Jne(t,1114111)!==t)throw new Yne(t+" is not a valid code point");n[r]=t<65536?Ene(t):Ene(55296+((t-=65536)>>10),t%1024+56320)}return Fne(n,"")}});var xne=DV,Tne=mne,Kne=ZB,Mne=tw,Dne=pne,Lne=aB("".indexOf);xne({target:"String",proto:!0,forced:!Dne("includes")},{includes:function(e){return!!~Lne(Mne(Kne(this)),Mne(Tne(e)),arguments.length>1?arguments[1]:void 0)}});var Une=DV,zne=ZB,Qne=tw,One=aB("".charCodeAt);Une({target:"String",proto:!0},{isWellFormed:function(){for(var e=Qne(zne(this)),t=e.length,n=0;n<t;n++){var g=One(e,n);if(55296==(63488&g)&&(g>=56320||++n>=t||56320!=(64512&One(e,n))))return!1}return!0}});var jne=dne.charAt,Pne=tw,_ne=hv,qne=HF,$ne=FF,ege="String Iterator",tge=_ne.set,nge=_ne.getterFor(ege);qne(String,"String",(function(e){tge(this,{type:ege,string:Pne(e),index:0})}),(function(){var e,t=nge(this),n=t.string,g=t.index;return g>=n.length?$ne(void 0,!0):(e=jne(n,g),t.index+=e.length,$ne(e,!1))}));var gge=PG,rge=xv,ige=F6,oge=UG,sge=DS,age=YR,Ige=sge("species"),lge=RegExp.prototype,Cge=function(e,t,n,g){var r=sge(e),i=!oge((function(){var t={};return t[r]=function(){return 7},7!==""[e](t)})),o=i&&!oge((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Ige]=function(){return n},n.flags="",n[r]=/./[r]),n.exec=function(){return t=!0,null},n[r](""),!t}));if(!i||!o||n){var s=/./[r],a=t(r,""[e],(function(e,t,n,g,r){var o=t.exec;return o===ige||o===lge.exec?i&&!r?{done:!0,value:gge(s,t,n,g)}:{done:!0,value:gge(e,n,t,g)}:{done:!1}}));rge(String.prototype,e,a[0]),rge(lge,r,a[1])}g&&age(lge[r],"sham",!0)},cge=dne.charAt,dge=function(e,t,n){return t+(n?cge(e,t).length:1)},uge=PG,Age=ZR,hge=RB,mge=cB,bge=F6,pge=TypeError,yge=function(e,t){var n=e.exec;if(hge(n)){var g=uge(n,e,t);return null!==g&&Age(g),g}if("RegExp"===mge(e))return uge(bge,e,t);throw new pge("RegExp#exec called on incompatible receiver")},Zge=PG,fge=ZR,Gge=VB,Bge=qv,Sge=tw,Rge=ZB,vge=sS,Vge=dge,wge=yge;Cge("match",(function(e,t,n){return[function(t){var n=Rge(this),g=Gge(t)?vge(t,e):void 0;return g?Zge(g,t,n):new RegExp(t)[e](Sge(n))},function(e){var g=fge(this),r=Sge(e),i=n(t,g,r);if(i.done)return i.value;if(!g.global)return wge(g,r);var o=g.unicode;g.lastIndex=0;for(var s,a=[],I=0;null!==(s=wge(g,r));){var l=Sge(s[0]);a[I]=l,""===l&&(g.lastIndex=Vge(r,Bge(g.lastIndex),o)),I++}return 0===I?null:a}]}));var Wge=DV,kge=PG,Xge=gW,Nge=mF,Jge=FF,Yge=ZB,Ege=qv,Hge=tw,Fge=ZR,xge=VB,Tge=F8,Kge=z8,Mge=sS,Dge=xv,Lge=UG,Uge=l3,zge=dge,Qge=yge,Oge=hv,jge=DS("matchAll"),Pge="RegExp String",_ge=Pge+" Iterator",qge=Oge.set,$ge=Oge.getterFor(_ge),ere=RegExp.prototype,tre=TypeError,nre=Xge("".indexOf),gre=Xge("".matchAll),rre=!!gre&&!Lge((function(){gre("a",/./)})),ire=Nge((function(e,t,n,g){qge(this,{type:_ge,regexp:e,string:t,global:n,unicode:g,done:!1})}),Pge,(function(){var e=$ge(this);if(e.done)return Jge(void 0,!0);var t=e.regexp,n=e.string,g=Qge(t,n);return null===g?(e.done=!0,Jge(void 0,!0)):e.global?(""===Hge(g[0])&&(t.lastIndex=zge(n,Ege(t.lastIndex),e.unicode)),Jge(g,!1)):(e.done=!0,Jge(g,!1))}));Wge({target:"String",proto:!0,forced:rre},{matchAll:function(e){var t,n,g,r=Yge(this);if(xge(e)){if(Tge(e)&&(t=Hge(Yge(Kge(e))),!~nre(t,"g")))throw new tre("`.matchAll` does not allow non-global regexes");if(rre)return gre(r,e);if(g=Mge(e,jge))return kge(g,e,r)}else if(rre)return gre(r,e);return n=Hge(r),new RegExp(e,"g")[jge](n)}}),jge in ere||Dge(ere,jge,(function(e){var t,n,g,r=Fge(this),i=Hge(e),o=Uge(r,RegExp),s=Hge(Kge(r));return t=new o(o===RegExp?r.source:r,s),n=!!~nre(s,"g"),g=!!~nre(s,"u"),t.lastIndex=Ege(r.lastIndex),new ire(t,i,n,g)}));var ore=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(YB),sre=Iz.end;DV({target:"String",proto:!0,forced:ore},{padEnd:function(e){return sre(this,e,arguments.length>1?arguments[1]:void 0)}});var are=Iz.start;DV({target:"String",proto:!0,forced:ore},{padStart:function(e){return are(this,e,arguments.length>1?arguments[1]:void 0)}});var Ire=DV,lre=aB,Cre=BB,cre=RS,dre=tw,ure=eV,Are=lre([].push),hre=lre([].join);Ire({target:"String",stat:!0},{raw:function(e){var t=Cre(cre(e).raw),n=ure(t);if(!n)return"";for(var g=arguments.length,r=[],i=0;;){if(Are(r,dre(t[i++])),i===n)return hre(r,"");i<g&&Are(r,dre(arguments[i]))}}}),DV({target:"String",proto:!0},{repeat:ez});var mre=aB,bre=RS,pre=Math.floor,yre=mre("".charAt),Zre=mre("".replace),fre=mre("".slice),Gre=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Bre=/\$([$&'`]|\d{1,2})/g,Sre=function(e,t,n,g,r,i){var o=n+e.length,s=g.length,a=Bre;return void 0!==r&&(r=bre(r),a=Gre),Zre(i,a,(function(i,a){var I;switch(yre(a,0)){case"$":return"$";case"&":return e;case"`":return fre(t,0,n);case"'":return fre(t,o);case"<":I=r[fre(a,1,-1)];break;default:var l=+a;if(0===l)return i;if(l>s){var C=pre(l/10);return 0===C?i:C<=s?void 0===g[C-1]?yre(a,1):g[C-1]+yre(a,1):i}I=g[l-1]}return void 0===I?"":I}))},Rre=dX,vre=PG,Vre=aB,wre=Cge,Wre=UG,kre=ZR,Xre=RB,Nre=VB,Jre=Uv,Yre=qv,Ere=tw,Hre=ZB,Fre=dge,xre=sS,Tre=Sre,Kre=yge,Mre=DS("replace"),Dre=Math.max,Lre=Math.min,Ure=Vre([].concat),zre=Vre([].push),Qre=Vre("".indexOf),Ore=Vre("".slice),jre="$0"==="a".replace(/./,"$0"),Pre=!!/./[Mre]&&""===/./[Mre]("a","$0"),_re=!Wre((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));wre("replace",(function(e,t,n){var g=Pre?"$":"$0";return[function(e,n){var g=Hre(this),r=Nre(e)?xre(e,Mre):void 0;return r?vre(r,e,g,n):vre(t,Ere(g),e,n)},function(e,r){var i=kre(this),o=Ere(e);if("string"==typeof r&&-1===Qre(r,g)&&-1===Qre(r,"$<")){var s=n(t,i,o,r);if(s.done)return s.value}var a=Xre(r);a||(r=Ere(r));var I,l=i.global;l&&(I=i.unicode,i.lastIndex=0);for(var C,c=[];null!==(C=Kre(i,o))&&(zre(c,C),l);){""===Ere(C[0])&&(i.lastIndex=Fre(o,Yre(i.lastIndex),I))}for(var d,u="",A=0,h=0;h<c.length;h++){for(var m,b=Ere((C=c[h])[0]),p=Dre(Lre(Jre(C.index),o.length),0),y=[],Z=1;Z<C.length;Z++)zre(y,void 0===(d=C[Z])?d:String(d));var f=C.groups;if(a){var G=Ure([b],y,p,o);void 0!==f&&zre(G,f),m=Ere(Rre(r,void 0,G))}else m=Tre(b,o,p,y,f,r);p>=A&&(u+=Ore(o,A,p)+m,A=p+b.length)}return u+Ore(o,A)}]}),!_re||!jre||Pre);var qre=DV,$re=PG,eie=aB,tie=ZB,nie=RB,gie=VB,rie=F8,iie=tw,oie=sS,sie=z8,aie=Sre,Iie=DS("replace"),lie=TypeError,Cie=eie("".indexOf);eie("".replace);var cie=eie("".slice),die=Math.max;qre({target:"String",proto:!0},{replaceAll:function(e,t){var n,g,r,i,o,s,a,I,l,C=tie(this),c=0,d="";if(gie(e)){if(rie(e)&&(n=iie(tie(sie(e))),!~Cie(n,"g")))throw new lie("`.replaceAll` does not allow non-global regexes");if(g=oie(e,Iie))return $re(g,e,C,t)}for(r=iie(C),i=iie(e),(o=nie(t))||(t=iie(t)),s=i.length,a=die(1,s),I=Cie(r,i);-1!==I;)l=o?iie(t(i,I,r)):aie(i,r,I,[],void 0,t),d+=cie(r,c,I)+l,c=I+s,I=I+a>r.length?-1:Cie(r,i,I+a);return c<r.length&&(d+=cie(r,c)),d}});var uie=PG,Aie=ZR,hie=VB,mie=ZB,bie=_1,pie=tw,yie=sS,Zie=yge;Cge("search",(function(e,t,n){return[function(t){var n=mie(this),g=hie(t)?yie(t,e):void 0;return g?uie(g,t,n):new RegExp(t)[e](pie(n))},function(e){var g=Aie(this),r=pie(e),i=n(t,g,r);if(i.done)return i.value;var o=g.lastIndex;bie(o,0)||(g.lastIndex=0);var s=Zie(g,r);return bie(g.lastIndex,o)||(g.lastIndex=o),null===s?-1:s.index}]}));var fie=PG,Gie=aB,Bie=Cge,Sie=ZR,Rie=VB,vie=ZB,Vie=l3,wie=dge,Wie=qv,kie=tw,Xie=sS,Nie=yge,Jie=UG,Yie=q8.UNSUPPORTED_Y,Eie=Math.min,Hie=Gie([].push),Fie=Gie("".slice),xie=!Jie((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),Tie="c"==="abbc".split(/(b)*/)[1]||4!=="test".split(/(?:)/,-1).length||2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length;Bie("split",(function(e,t,n){var g="0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:fie(t,this,e,n)}:t;return[function(t,n){var r=vie(this),i=Rie(t)?Xie(t,e):void 0;return i?fie(i,t,r,n):fie(g,kie(r),t,n)},function(e,r){var i=Sie(this),o=kie(e);if(!Tie){var s=n(g,i,o,r,g!==t);if(s.done)return s.value}var a=Vie(i,RegExp),I=i.unicode,l=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(Yie?"g":"y"),C=new a(Yie?"^(?:"+i.source+")":i,l),c=void 0===r?4294967295:r>>>0;if(0===c)return[];if(0===o.length)return null===Nie(C,o)?[o]:[];for(var d=0,u=0,A=[];u<o.length;){C.lastIndex=Yie?0:u;var h,m=Nie(C,Yie?Fie(o,u):o);if(null===m||(h=Eie(Wie(C.lastIndex+(Yie?u:0)),o.length))===d)u=wie(o,u,I);else{if(Hie(A,Fie(o,d,u)),A.length===c)return A;for(var b=1;b<=m.length-1;b++)if(Hie(A,m[b]),A.length===c)return A;u=d=h}}return Hie(A,Fie(o,d)),A}]}),Tie||!xie,Yie);var Kie=DV,Mie=gW,Die=LG.f,Lie=qv,Uie=tw,zie=mne,Qie=ZB,Oie=pne,jie=Mie("".slice),Pie=Math.min,_ie=Oie("startsWith"),qie=!_ie&&!!function(){var e=Die(String.prototype,"startsWith");return e&&!e.writable}();Kie({target:"String",proto:!0,forced:!qie&&!_ie},{startsWith:function(e){var t=Uie(Qie(this));zie(e);var n=Lie(Pie(arguments.length>1?arguments[1]:void 0,t.length)),g=Uie(e);return jie(t,n,n+g.length)===g}});var $ie=DV,eoe=ZB,toe=Uv,noe=tw,goe=aB("".slice),roe=Math.max,ioe=Math.min;$ie({target:"String",proto:!0,forced:!"".substr||"b"!=="ab".substr(-1)},{substr:function(e,t){var n,g,r=noe(eoe(this)),i=r.length,o=toe(e);return o===1/0&&(o=0),o<0&&(o=roe(i+o,0)),(n=void 0===t?i:toe(t))<=0||n===1/0||o>=(g=ioe(o+n,i))?"":goe(r,o,g)}});var ooe=DV,soe=PG,aoe=aB,Ioe=ZB,loe=tw,Coe=UG,coe=Array,doe=aoe("".charAt),uoe=aoe("".charCodeAt),Aoe=aoe([].join),hoe="".toWellFormed,moe=hoe&&Coe((function(){return"1"!==soe(hoe,1)}));ooe({target:"String",proto:!0,forced:moe},{toWellFormed:function(){var e=loe(Ioe(this));if(moe)return soe(hoe,e);for(var t=e.length,n=coe(t),g=0;g<t;g++){var r=uoe(e,g);55296!=(63488&r)?n[g]=doe(e,g):r>=56320||g+1>=t||56320!=(64512&uoe(e,g+1))?n[g]="�":(n[g]=doe(e,g),n[++g]=doe(e,g))}return Aoe(n,"")}});var boe=MR.PROPER,poe=UG,yoe=Jq,Zoe=function(e){return poe((function(){return!!yoe[e]()||"​᠎"!=="​᠎"[e]()||boe&&yoe[e].name!==e}))},foe=Mq.trim;DV({target:"String",proto:!0,forced:Zoe("trim")},{trim:function(){return foe(this)}});var Goe=Mq.end,Boe=Zoe("trimEnd")?function(){return Goe(this)}:"".trimEnd;DV({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==Boe},{trimRight:Boe});DV({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==Boe},{trimEnd:Boe});var Soe=Mq.start,Roe=Zoe("trimStart")?function(){return Soe(this)}:"".trimStart;DV({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==Roe},{trimLeft:Roe});DV({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==Roe},{trimStart:Roe});var voe=ZB,Voe=tw,woe=/"/g,Woe=aB("".replace),koe=function(e,t,n,g){var r=Voe(voe(e)),i="<"+t;return""!==n&&(i+=" "+n+'="'+Woe(Voe(g),woe,"&quot;")+'"'),i+">"+r+"</"+t+">"},Xoe=UG,Noe=function(e){return Xoe((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))},Joe=koe;DV({target:"String",proto:!0,forced:Noe("anchor")},{anchor:function(e){return Joe(this,"a","name",e)}});var Yoe=koe;DV({target:"String",proto:!0,forced:Noe("big")},{big:function(){return Yoe(this,"big","","")}});var Eoe=koe;DV({target:"String",proto:!0,forced:Noe("blink")},{blink:function(){return Eoe(this,"blink","","")}});var Hoe=koe;DV({target:"String",proto:!0,forced:Noe("bold")},{bold:function(){return Hoe(this,"b","","")}});var Foe=koe;DV({target:"String",proto:!0,forced:Noe("fixed")},{fixed:function(){return Foe(this,"tt","","")}});var xoe=koe;DV({target:"String",proto:!0,forced:Noe("fontcolor")},{fontcolor:function(e){return xoe(this,"font","color",e)}});var Toe=koe;DV({target:"String",proto:!0,forced:Noe("fontsize")},{fontsize:function(e){return Toe(this,"font","size",e)}});var Koe=koe;DV({target:"String",proto:!0,forced:Noe("italics")},{italics:function(){return Koe(this,"i","","")}});var Moe=koe;DV({target:"String",proto:!0,forced:Noe("link")},{link:function(e){return Moe(this,"a","href",e)}});var Doe=koe;DV({target:"String",proto:!0,forced:Noe("small")},{small:function(){return Doe(this,"small","","")}});var Loe=koe;DV({target:"String",proto:!0,forced:Noe("strike")},{strike:function(){return Loe(this,"strike","","")}});var Uoe=koe;DV({target:"String",proto:!0,forced:Noe("sub")},{sub:function(){return Uoe(this,"sub","","")}});var zoe=koe;DV({target:"String",proto:!0,forced:Noe("sup")},{sup:function(){return zoe(this,"sup","","")}});var Qoe={exports:{}},Ooe=DG,joe=UG,Poe=UH,_oe=eL.NATIVE_ARRAY_BUFFER_VIEWS,qoe=Ooe.ArrayBuffer,$oe=Ooe.Int8Array,ese=!_oe||!joe((function(){$oe(1)}))||!joe((function(){new $oe(-1)}))||!Poe((function(e){new $oe,new $oe(null),new $oe(1.5),new $oe(e)}),!0)||joe((function(){return 1!==new $oe(new qoe(2),1,void 0).length})),tse=$Q,nse=RangeError,gse=function(e,t){var n=tse(e);if(n%t)throw new nse("Wrong offset");return n},rse=Math.round,ise=qV,ose=function(e){var t=ise(e);return"BigInt64Array"===t||"BigUint64Array"===t},sse=_S,ase=TypeError,Ise=function(e){var t=sse(e,"number");if("number"==typeof t)throw new ase("Can't convert number to bigint");return BigInt(t)},lse=sW,Cse=PG,cse=i3,dse=RS,use=eV,Ase=eY,hse=QJ,mse=KJ,bse=ose,pse=eL.aTypedArrayConstructor,yse=Ise,Zse=function(e){var t,n,g,r,i,o,s,a,I=cse(this),l=dse(e),C=arguments.length,c=C>1?arguments[1]:void 0,d=void 0!==c,u=hse(l);if(u&&!mse(u))for(a=(s=Ase(l,u)).next,l=[];!(o=Cse(a,s)).done;)l.push(o.value);for(d&&C>2&&(c=lse(c,arguments[2])),n=use(l),g=new(pse(I))(n),r=bse(g),t=0;n>t;t++)i=d?c(l[t],t):l[t],g[t]=r?yse(i):+i;return g},fse=DV,Gse=DG,Bse=PG,Sse=zG,Rse=ese,vse=eL,Vse=cD,wse=LK,Wse=gB,kse=YR,Xse=b$,Nse=qv,Jse=OK,Yse=gse,Ese=function(e){var t=rse(e);return t<0?0:t>255?255:255&t},Hse=eR,Fse=wS,xse=qV,Tse=VB,Kse=qB,Mse=vw,Dse=XB,Lse=vN,Use=Tv.f,zse=Zse,Qse=HW.forEach,Ose=KT,jse=Hw,Pse=hR,_se=LG,qse=aK,$se=NN,eae=hv.get,tae=hv.set,nae=hv.enforce,gae=Pse.f,rae=_se.f,iae=Gse.RangeError,oae=Vse.ArrayBuffer,sae=oae.prototype,aae=Vse.DataView,Iae=vse.NATIVE_ARRAY_BUFFER_VIEWS,lae=vse.TYPED_ARRAY_TAG,Cae=vse.TypedArray,cae=vse.TypedArrayPrototype,dae=vse.isTypedArray,uae="BYTES_PER_ELEMENT",Aae="Wrong length",hae=function(e,t){jse(e,t,{configurable:!0,get:function(){return eae(this)[t]}})},mae=function(e){var t;return Dse(sae,e)||"ArrayBuffer"===(t=xse(e))||"SharedArrayBuffer"===t},bae=function(e,t){return dae(e)&&!Kse(t)&&t in e&&Xse(+t)&&t>=0},pae=function(e,t){return t=Hse(t),bae(e,t)?Wse(2,e[t]):rae(e,t)},yae=function(e,t,n){return t=Hse(t),!(bae(e,t)&&Tse(n)&&Fse(n,"value"))||Fse(n,"get")||Fse(n,"set")||n.configurable||Fse(n,"writable")&&!n.writable||Fse(n,"enumerable")&&!n.enumerable?gae(e,t,n):(e[t]=n.value,e)};Sse?(Iae||(_se.f=pae,Pse.f=yae,hae(cae,"buffer"),hae(cae,"byteOffset"),hae(cae,"byteLength"),hae(cae,"length")),fse({target:"Object",stat:!0,forced:!Iae},{getOwnPropertyDescriptor:pae,defineProperty:yae}),Qoe.exports=function(e,t,n){var g=e.match(/\d+/)[0]/8,r=e+(n?"Clamped":"")+"Array",i="get"+e,o="set"+e,s=Gse[r],a=s,I=a&&a.prototype,l={},C=function(e,t){gae(e,t,{get:function(){return function(e,t){var n=eae(e);return n.view[i](t*g+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,r){var i=eae(e);i.view[o](t*g+i.byteOffset,n?Ese(r):r,!0)}(this,t,e)},enumerable:!0})};Iae?Rse&&(a=t((function(e,t,n,r){return wse(e,I),$se(Tse(t)?mae(t)?void 0!==r?new s(t,Yse(n,g),r):void 0!==n?new s(t,Yse(n,g)):new s(t):dae(t)?qse(a,t):Bse(zse,a,t):new s(Jse(t)),e,a)})),Lse&&Lse(a,Cae),Qse(Use(s),(function(e){e in a||kse(a,e,s[e])})),a.prototype=I):(a=t((function(e,t,n,r){wse(e,I);var i,o,s,l=0,c=0;if(Tse(t)){if(!mae(t))return dae(t)?qse(a,t):Bse(zse,a,t);i=t,c=Yse(n,g);var d=t.byteLength;if(void 0===r){if(d%g)throw new iae(Aae);if((o=d-c)<0)throw new iae(Aae)}else if((o=Nse(r)*g)+c>d)throw new iae(Aae);s=o/g}else s=Jse(t),i=new oae(o=s*g);for(tae(e,{buffer:i,byteOffset:c,byteLength:o,length:s,view:new aae(i)});l<s;)C(e,l++)})),Lse&&Lse(a,Cae),I=a.prototype=Mse(cae)),I.constructor!==a&&kse(I,"constructor",a),nae(I).TypedArrayConstructor=a,lae&&kse(I,lae,r);var c=a!==s;l[r]=a,fse({global:!0,constructor:!0,forced:c,sham:!Iae},l),uae in a||kse(a,uae,g),uae in I||kse(I,uae,g),Ose(r)}):Qoe.exports=function(){};var Zae=Qoe.exports;Zae("Float32",(function(e){return function(t,n,g){return e(this,t,n,g)}})),Zae("Float64",(function(e){return function(t,n,g){return e(this,t,n,g)}})),Zae("Int8",(function(e){return function(t,n,g){return e(this,t,n,g)}})),Zae("Int16",(function(e){return function(t,n,g){return e(this,t,n,g)}})),Zae("Int32",(function(e){return function(t,n,g){return e(this,t,n,g)}})),Zae("Uint8",(function(e){return function(t,n,g){return e(this,t,n,g)}})),Zae("Uint8",(function(e){return function(t,n,g){return e(this,t,n,g)}}),!0),Zae("Uint16",(function(e){return function(t,n,g){return e(this,t,n,g)}})),Zae("Uint32",(function(e){return function(t,n,g){return e(this,t,n,g)}}));var fae=eV,Gae=Uv,Bae=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("at",(function(e){var t=Bae(this),n=fae(t),g=Gae(e),r=g>=0?g:n+g;return r<0||r>=n?void 0:t[r]}));var Sae=eL,Rae=aB(kE),vae=Sae.aTypedArray;(0,Sae.exportTypedArrayMethod)("copyWithin",(function(e,t){return Rae(vae(this),e,t,arguments.length>2?arguments[2]:void 0)}));var Vae=HW.every,wae=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("every",(function(e){return Vae(wae(this),e,arguments.length>1?arguments[1]:void 0)}));var Wae=xE,kae=Ise,Xae=qV,Nae=PG,Jae=UG,Yae=eL.aTypedArray,Eae=eL.exportTypedArrayMethod,Hae=aB("".slice);Eae("fill",(function(e){var t=arguments.length;Yae(this);var n="Big"===Hae(Xae(this),0,3)?kae(e):+e;return Nae(Wae,this,n,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),Jae((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var Fae=aK,xae=eL.getTypedArrayConstructor,Tae=HW.filter,Kae=function(e,t){return Fae(xae(e),t)},Mae=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("filter",(function(e){var t=Tae(Mae(this),e,arguments.length>1?arguments[1]:void 0);return Kae(this,t)}));var Dae=HW.find,Lae=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("find",(function(e){return Dae(Lae(this),e,arguments.length>1?arguments[1]:void 0)}));var Uae=HW.findIndex,zae=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("findIndex",(function(e){return Uae(zae(this),e,arguments.length>1?arguments[1]:void 0)}));var Qae=gH.findLast,Oae=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("findLast",(function(e){return Qae(Oae(this),e,arguments.length>1?arguments[1]:void 0)}));var jae=gH.findLastIndex,Pae=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("findLastIndex",(function(e){return jae(Pae(this),e,arguments.length>1?arguments[1]:void 0)}));var _ae=HW.forEach,qae=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("forEach",(function(e){_ae(qae(this),e,arguments.length>1?arguments[1]:void 0)})),(0,eL.exportTypedArrayStaticMethod)("from",Zse,ese);var $ae=iV.includes,eIe=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("includes",(function(e){return $ae(eIe(this),e,arguments.length>1?arguments[1]:void 0)}));var tIe=iV.indexOf,nIe=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("indexOf",(function(e){return tIe(nIe(this),e,arguments.length>1?arguments[1]:void 0)}));var gIe=DG,rIe=UG,iIe=aB,oIe=eL,sIe=PF,aIe=DS("iterator"),IIe=gIe.Uint8Array,lIe=iIe(sIe.values),CIe=iIe(sIe.keys),cIe=iIe(sIe.entries),dIe=oIe.aTypedArray,uIe=oIe.exportTypedArrayMethod,AIe=IIe&&IIe.prototype,hIe=!rIe((function(){AIe[aIe].call([1])})),mIe=!!AIe&&AIe.values&&AIe[aIe]===AIe.values&&"values"===AIe.values.name,bIe=function(){return lIe(dIe(this))};uIe("entries",(function(){return cIe(dIe(this))}),hIe),uIe("keys",(function(){return CIe(dIe(this))}),hIe),uIe("values",bIe,hIe||!mIe,{name:"values"}),uIe(aIe,bIe,hIe||!mIe,{name:"values"});var pIe=eL.aTypedArray,yIe=eL.exportTypedArrayMethod,ZIe=aB([].join);yIe("join",(function(e){return ZIe(pIe(this),e)}));var fIe=dX,GIe=cx,BIe=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return fIe(GIe,BIe(this),t>1?[e,arguments[1]]:[e])}));var SIe=HW.map,RIe=eL.aTypedArray,vIe=eL.getTypedArrayConstructor;(0,eL.exportTypedArrayMethod)("map",(function(e){return SIe(RIe(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(vIe(e))(t)}))}));var VIe=eL.aTypedArrayConstructor;(0,eL.exportTypedArrayStaticMethod)("of",(function(){for(var e=0,t=arguments.length,n=new(VIe(this))(t);t>e;)n[e]=arguments[e++];return n}),ese);var wIe=Nx.left,WIe=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return wIe(WIe(this),e,t,t>1?arguments[1]:void 0)}));var kIe=Nx.right,XIe=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return kIe(XIe(this),e,t,t>1?arguments[1]:void 0)}));var NIe=eL.aTypedArray,JIe=eL.exportTypedArrayMethod,YIe=Math.floor;JIe("reverse",(function(){for(var e,t=this,n=NIe(t).length,g=YIe(n/2),r=0;r<g;)e=t[r],t[r++]=t[--n],t[n]=e;return t}));var EIe=DG,HIe=PG,FIe=eL,xIe=eV,TIe=gse,KIe=RS,MIe=UG,DIe=EIe.RangeError,LIe=EIe.Int8Array,UIe=LIe&&LIe.prototype,zIe=UIe&&UIe.set,QIe=FIe.aTypedArray,OIe=FIe.exportTypedArrayMethod,jIe=!MIe((function(){var e=new Uint8ClampedArray(2);return HIe(zIe,e,{length:1,0:3},1),3!==e[1]})),PIe=jIe&&FIe.NATIVE_ARRAY_BUFFER_VIEWS&&MIe((function(){var e=new LIe(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));OIe("set",(function(e){QIe(this);var t=TIe(arguments.length>1?arguments[1]:void 0,1),n=KIe(e);if(jIe)return HIe(zIe,this,n,t);var g=this.length,r=xIe(n),i=0;if(r+t>g)throw new DIe("Wrong length");for(;i<r;)this[t+i]=n[i++]}),!jIe||PIe);var _Ie=ww,qIe=eL.aTypedArray,$Ie=eL.getTypedArrayConstructor;(0,eL.exportTypedArrayMethod)("slice",(function(e,t){for(var n=_Ie(qIe(this),e,t),g=$Ie(this),r=0,i=n.length,o=new g(i);i>r;)o[r]=n[r++];return o}),UG((function(){new Int8Array(1).slice()})));var ele=HW.some,tle=eL.aTypedArray;(0,eL.exportTypedArrayMethod)("some",(function(e){return ele(tle(this),e,arguments.length>1?arguments[1]:void 0)}));var nle=gW,gle=UG,rle=rS,ile=lT,ole=cT,sle=dT,ale=MB,Ile=AT,lle=eL.aTypedArray,Cle=eL.exportTypedArrayMethod,cle=DG.Uint16Array,dle=cle&&nle(cle.prototype.sort),ule=!(!dle||gle((function(){dle(new cle(2),null)}))&&gle((function(){dle(new cle(2),{})}))),Ale=!!dle&&!gle((function(){if(ale)return ale<74;if(ole)return ole<67;if(sle)return!0;if(Ile)return Ile<602;var e,t,n=new cle(516),g=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,g[e]=e-2*t+3;for(dle(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==g[e])return!0}));Cle("sort",(function(e){return void 0!==e&&rle(e),Ale?dle(this,e):ile(lle(this),function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e))}),!Ale||ule);var hle=qv,mle=jv,ble=eL.aTypedArray,ple=eL.getTypedArrayConstructor;(0,eL.exportTypedArrayMethod)("subarray",(function(e,t){var n=ble(this),g=n.length,r=mle(e,g);return new(ple(n))(n.buffer,n.byteOffset+r*n.BYTES_PER_ELEMENT,hle((void 0===t?g:mle(t,g))-r))}));var yle=dX,Zle=eL,fle=UG,Gle=ww,Ble=DG.Int8Array,Sle=Zle.aTypedArray,Rle=Zle.exportTypedArrayMethod,vle=[].toLocaleString,Vle=!!Ble&&fle((function(){vle.call(new Ble(1))}));Rle("toLocaleString",(function(){return yle(vle,Vle?Gle(Sle(this)):Sle(this),Gle(arguments))}),fle((function(){return[1,2].toLocaleString()!==new Ble([1,2]).toLocaleString()}))||!fle((function(){Ble.prototype.toLocaleString.call([1,2])})));var wle=nK,Wle=eL.aTypedArray,kle=eL.getTypedArrayConstructor;(0,eL.exportTypedArrayMethod)("toReversed",(function(){return wle(Wle(this),kle(this))}));var Xle=rS,Nle=aK,Jle=eL.aTypedArray,Yle=eL.getTypedArrayConstructor,Ele=eL.exportTypedArrayMethod,Hle=aB(eL.TypedArrayPrototype.sort);Ele("toSorted",(function(e){void 0!==e&&Xle(e);var t=Jle(this),n=Nle(Yle(t),t);return Hle(n,e)}));var Fle=eL.exportTypedArrayMethod,xle=UG,Tle=aB,Kle=DG.Uint8Array,Mle=Kle&&Kle.prototype||{},Dle=[].toString,Lle=Tle([].join);xle((function(){Dle.call({})}))&&(Dle=function(){return Lle(this)});var Ule=Mle.toString!==Dle;Fle("toString",Dle,Ule);var zle=YK,Qle=ose,Ole=Uv,jle=Ise,Ple=eL.aTypedArray,_le=eL.getTypedArrayConstructor,qle=eL.exportTypedArrayMethod,$le=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(Vye){return 8===Vye}}();qle("with",{with:function(e,t){var n=Ple(this),g=Ole(e),r=Qle(n)?jle(t):+t;return zle(n,_le(n),g,r)}}.with,!$le);var eCe=DV,tCe=aB,nCe=tw,gCe=String.fromCharCode,rCe=tCe("".charAt),iCe=tCe(/./.exec),oCe=tCe("".slice),sCe=/^[\da-f]{2}$/i,aCe=/^[\da-f]{4}$/i;eCe({global:!0},{unescape:function(e){for(var t,n,g=nCe(e),r="",i=g.length,o=0;o<i;){if("%"===(t=rCe(g,o++)))if("u"===rCe(g,o)){if(n=oCe(g,o+1,o+5),iCe(aCe,n)){r+=gCe(parseInt(n,16)),o+=5;continue}}else if(n=oCe(g,o,o+2),iCe(sCe,n)){r+=gCe(parseInt(n,16)),o+=2;continue}r+=t}return r}});var ICe=aB,lCe=KK,CCe=LP.getWeakData,cCe=LK,dCe=ZR,uCe=bB,ACe=VB,hCe=bY,mCe=wS,bCe=hv.set,pCe=hv.getterFor,yCe=HW.find,ZCe=HW.findIndex,fCe=ICe([].splice),GCe=0,BCe=function(e){return e.frozen||(e.frozen=new SCe)},SCe=function(){this.entries=[]},RCe=function(e,t){return yCe(e.entries,(function(e){return e[0]===t}))};SCe.prototype={get:function(e){var t=RCe(this,e);if(t)return t[1]},has:function(e){return!!RCe(this,e)},set:function(e,t){var n=RCe(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=ZCe(this.entries,(function(t){return t[0]===e}));return~t&&fCe(this.entries,t,1),!!~t}};var vCe,VCe={getConstructor:function(e,t,n,g){var r=e((function(e,r){cCe(e,i),bCe(e,{type:t,id:GCe++,frozen:null}),uCe(r)||hCe(r,e[g],{that:e,AS_ENTRIES:n})})),i=r.prototype,o=pCe(t),s=function(e,t,n){var g=o(e),r=CCe(dCe(t),!0);return!0===r?BCe(g).set(t,n):r[g.id]=n,e};return lCe(i,{delete:function(e){var t=o(this);if(!ACe(e))return!1;var n=CCe(e);return!0===n?BCe(t).delete(e):n&&mCe(n,t.id)&&delete n[t.id]},has:function(e){var t=o(this);if(!ACe(e))return!1;var n=CCe(e);return!0===n?BCe(t).has(e):n&&mCe(n,t.id)}}),lCe(i,n?{get:function(e){var t=o(this);if(ACe(e)){var n=CCe(e);if(!0===n)return BCe(t).get(e);if(n)return n[t.id]}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),r}},wCe=VP,WCe=DG,kCe=aB,XCe=KK,NCe=LP,JCe=o_,YCe=VCe,ECe=VB,HCe=hv.enforce,FCe=UG,xCe=qR,TCe=Object,KCe=Array.isArray,MCe=TCe.isExtensible,DCe=TCe.isFrozen,LCe=TCe.isSealed,UCe=TCe.freeze,zCe=TCe.seal,QCe=!WCe.ActiveXObject&&"ActiveXObject"in WCe,OCe=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},jCe=JCe("WeakMap",OCe,YCe),PCe=jCe.prototype,_Ce=kCe(PCe.set);if(xCe)if(QCe){vCe=YCe.getConstructor(OCe,"WeakMap",!0),NCe.enable();var qCe=kCe(PCe.delete),$Ce=kCe(PCe.has),ece=kCe(PCe.get);XCe(PCe,{delete:function(e){if(ECe(e)&&!MCe(e)){var t=HCe(this);return t.frozen||(t.frozen=new vCe),qCe(this,e)||t.frozen.delete(e)}return qCe(this,e)},has:function(e){if(ECe(e)&&!MCe(e)){var t=HCe(this);return t.frozen||(t.frozen=new vCe),$Ce(this,e)||t.frozen.has(e)}return $Ce(this,e)},get:function(e){if(ECe(e)&&!MCe(e)){var t=HCe(this);return t.frozen||(t.frozen=new vCe),$Ce(this,e)?ece(this,e):t.frozen.get(e)}return ece(this,e)},set:function(e,t){if(ECe(e)&&!MCe(e)){var n=HCe(this);n.frozen||(n.frozen=new vCe),$Ce(this,e)?_Ce(this,e,t):n.frozen.set(e,t)}else _Ce(this,e,t);return this}})}else wCe&&FCe((function(){var e=UCe([]);return _Ce(new jCe,e,1),!DCe(e)}))&&XCe(PCe,{set:function(e,t){var n;return KCe(e)&&(DCe(e)?n=UCe:LCe(e)&&(n=zCe)),_Ce(this,e,t),n&&n(e),this}});o_("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),VCe);var tce="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",nce=tce+"+/",gce=tce+"-_",rce=function(e){for(var t={},n=0;n<64;n++)t[e.charAt(n)]=n;return t},ice={i2c:nce,c2i:rce(nce),c2iUrl:rce(gce)},oce=DV,sce=DG,ace=kB,Ice=aB,lce=PG,Cce=UG,cce=tw,dce=c3,uce=ice.c2i,Ace=/[^\d+/a-z]/i,hce=/[\t\n\f\r ]+/g,mce=/[=]{1,2}$/,bce=ace("atob"),pce=String.fromCharCode,yce=Ice("".charAt),Zce=Ice("".replace),fce=Ice(Ace.exec),Gce=!!bce&&!Cce((function(){return"hi"!==bce("aGk=")})),Bce=Gce&&Cce((function(){return""!==bce(" ")})),Sce=Gce&&!Cce((function(){bce("a")})),Rce=Gce&&!Cce((function(){bce()})),vce=Gce&&1!==bce.length;oce({global:!0,bind:!0,enumerable:!0,forced:!Gce||Bce||Sce||Rce||vce},{atob:function(e){if(dce(arguments.length,1),Gce&&!Bce&&!Sce)return lce(bce,sce,e);var t,n,g,r=Zce(cce(e),hce,""),i="",o=0,s=0;if(r.length%4==0&&(r=Zce(r,mce,"")),(t=r.length)%4==1||fce(Ace,r))throw new(ace("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;o<t;)n=yce(r,o++),g=s%4?64*g+uce[n]:uce[n],s++%4&&(i+=pce(255&g>>(-2*s&6)));return i}});var Vce=DV,wce=DG,Wce=kB,kce=aB,Xce=PG,Nce=UG,Jce=tw,Yce=c3,Ece=ice.i2c,Hce=Wce("btoa"),Fce=kce("".charAt),xce=kce("".charCodeAt),Tce=!!Hce&&!Nce((function(){return"aGk="!==Hce("hi")})),Kce=Tce&&!Nce((function(){Hce()})),Mce=Tce&&Nce((function(){return"bnVsbA=="!==Hce(null)})),Dce=Tce&&1!==Hce.length;Vce({global:!0,bind:!0,enumerable:!0,forced:!Tce||Kce||Mce||Dce},{btoa:function(e){if(Yce(arguments.length,1),Tce)return Xce(Hce,wce,Jce(e));for(var t,n,g=Jce(e),r="",i=0,o=Ece;Fce(g,i)||(o="=",i%1);){if((n=xce(g,i+=3/4))>255)throw new(Wce("DOMException"))("The string contains characters outside of the Latin1 range","InvalidCharacterError");r+=Fce(o,63&(t=t<<8|n)>>8-i%1*8)}return r}});var Lce={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Uce=rR("span").classList,zce=Uce&&Uce.constructor&&Uce.constructor.prototype,Qce=zce===Object.prototype?void 0:zce,Oce=DG,jce=Lce,Pce=Qce,_ce=SH,qce=YR,$ce=function(e){if(e&&e.forEach!==_ce)try{qce(e,"forEach",_ce)}catch(Vye){e.forEach=_ce}};for(var ede in jce)jce[ede]&&$ce(Oce[ede]&&Oce[ede].prototype);$ce(Pce);var tde=DG,nde=Lce,gde=Qce,rde=PF,ide=YR,ode=eW,sde=DS("iterator"),ade=rde.values,Ide=function(e,t){if(e){if(e[sde]!==ade)try{ide(e,sde,ade)}catch(Vye){e[sde]=ade}if(ode(e,t,!0),nde[t])for(var n in rde)if(e[n]!==rde[n])try{ide(e,n,rde[n])}catch(Vye){e[n]=rde[n]}}};for(var lde in nde)Ide(tde[lde]&&tde[lde].prototype,lde);Ide(gde,"DOMTokenList");var Cde={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}},cde=DV,dde=kB,ude=tU,Ade=UG,hde=vw,mde=gB,bde=hR.f,pde=xv,yde=Hw,Zde=wS,fde=LK,Gde=ZR,Bde=BJ,Sde=YN,Rde=Cde,vde=LN,Vde=hv,wde=zG,Wde="DOMException",kde="DATA_CLONE_ERR",Xde=dde("Error"),Nde=dde(Wde)||function(){try{(new(dde("MessageChannel")||ude("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(Vye){if(Vye.name===kde&&25===Vye.code)return Vye.constructor}}(),Jde=Nde&&Nde.prototype,Yde=Xde.prototype,Ede=Vde.set,Hde=Vde.getterFor(Wde),Fde="stack"in new Xde(Wde),xde=function(e){return Zde(Rde,e)&&Rde[e].m?Rde[e].c:0},Tde=function(){fde(this,Kde);var e=arguments.length,t=Sde(e<1?void 0:arguments[0]),n=Sde(e<2?void 0:arguments[1],"Error"),g=xde(n);if(Ede(this,{type:Wde,name:n,message:t,code:g}),wde||(this.name=n,this.message=t,this.code=g),Fde){var r=new Xde(t);r.name=Wde,bde(this,"stack",mde(1,vde(r.stack,1)))}},Kde=Tde.prototype=hde(Yde),Mde=function(e){return{enumerable:!0,configurable:!0,get:e}},Dde=function(e){return Mde((function(){return Hde(this)[e]}))};wde&&(yde(Kde,"code",Dde("code")),yde(Kde,"message",Dde("message")),yde(Kde,"name",Dde("name"))),bde(Kde,"constructor",mde(1,Tde));var Lde=Ade((function(){return!(new Nde instanceof Xde)})),Ude=Lde||Ade((function(){return Yde.toString!==Bde||"2: 1"!==String(new Nde(1,2))})),zde=Lde||Ade((function(){return 25!==new Nde(1,"DataCloneError").code}));Lde||25!==Nde[kde]||Jde[kde];cde({global:!0,constructor:!0,forced:Lde},{DOMException:Lde?Tde:Nde});var Qde=dde(Wde),Ode=Qde.prototype;for(var jde in Ude&&Nde===Qde&&pde(Ode,"toString",Bde),zde&&wde&&Nde===Qde&&yde(Ode,"code",Mde((function(){return xde(Gde(this).name)}))),Rde)if(Zde(Rde,jde)){var Pde=Rde[jde],_de=Pde.s,qde=mde(6,Pde.c);Zde(Qde,_de)||bde(Qde,_de,qde),Zde(Ode,_de)||bde(Ode,_de,qde)}var $de=DV,eue=DG,tue=kB,nue=gB,gue=hR.f,rue=wS,iue=LK,oue=NN,sue=YN,aue=Cde,Iue=LN,lue=zG,Cue="DOMException",cue=tue("Error"),due=tue(Cue),uue=function(){iue(this,Aue);var e=arguments.length,t=sue(e<1?void 0:arguments[0]),n=sue(e<2?void 0:arguments[1],"Error"),g=new due(t,n),r=new cue(t);return r.name=Cue,gue(g,"stack",nue(1,Iue(r.stack,1))),oue(g,this,uue),g},Aue=uue.prototype=due.prototype,hue="stack"in new cue(Cue),mue="stack"in new due(1,2),bue=due&&lue&&Object.getOwnPropertyDescriptor(eue,Cue),pue=!(!bue||bue.writable&&bue.configurable),yue=hue&&!pue&&!mue;$de({global:!0,constructor:!0,forced:yue},{DOMException:yue?uue:due});var Zue=tue(Cue),fue=Zue.prototype;if(fue.constructor!==Zue)for(var Gue in gue(fue,"constructor",nue(1,Zue)),aue)if(rue(aue,Gue)){var Bue=aue[Gue],Sue=Bue.s;rue(Zue,Sue)||gue(Zue,Sue,nue(6,Bue.c))}var Rue="DOMException";eW(kB(Rue),Rue);var vue=T3.clear;DV({global:!0,bind:!0,enumerable:!0,forced:DG.clearImmediate!==vue},{clearImmediate:vue});var Vue,wue=DG,Wue=dX,kue=RB,Xue=Fx,Nue=YB,Jue=ww,Yue=c3,Eue=wue.Function,Hue=/MSIE .\./.test(Nue)||"BUN"===Xue&&((Vue=wue.Bun.version.split(".")).length<3||"0"===Vue[0]&&(Vue[1]<3||"3"===Vue[1]&&"0"===Vue[2])),Fue=function(e,t){var n=t?2:1;return Hue?function(g,r){var i=Yue(arguments.length,1)>n,o=kue(g)?g:Eue(g),s=i?Jue(arguments,n):[],a=i?function(){Wue(o,this,s)}:o;return t?e(a,r):e(a)}:e},xue=DV,Tue=DG,Kue=T3.set,Mue=Fue,Due=Tue.setImmediate?Mue(Kue,!1):Kue;xue({global:!0,bind:!0,enumerable:!0,forced:Tue.setImmediate!==Due},{setImmediate:Due});var Lue=DG,Uue=h5,zue=rS,Que=c3,Oue=zG;DV({global:!0,enumerable:!0,dontCallGetSet:!0,forced:UG((function(){return Oue&&1!==Object.getOwnPropertyDescriptor(Lue,"queueMicrotask").value.length}))},{queueMicrotask:function(e){Que(arguments.length,1),Uue(zue(e))}});var jue=DV,Pue=DG,_ue=Hw,que=zG,$ue=TypeError,eAe=Object.defineProperty,tAe=Pue.self!==Pue;try{if(que){var nAe=Object.getOwnPropertyDescriptor(Pue,"self");!tAe&&nAe&&nAe.get&&nAe.enumerable||_ue(Pue,"self",{get:function(){return Pue},set:function(e){if(this!==Pue)throw new $ue("Illegal invocation");eAe(Pue,"self",{value:e,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})}else jue({global:!0,simple:!0,forced:tAe},{self:Pue})}catch(Vye){}var gAe,rAe=DV,iAe=DG,oAe=kB,sAe=aB,aAe=UG,IAe=JS,lAe=RB,CAe=fW,cAe=bB,dAe=VB,uAe=qB,AAe=bY,hAe=ZR,mAe=qV,bAe=wS,pAe=rE,yAe=YR,ZAe=eV,fAe=c3,GAe=z8,BAe=B_,SAe=Zee,RAe=Nee,vAe=uU,VAe=zN,wAe=oU,WAe=iAe.Object,kAe=iAe.Array,XAe=iAe.Date,NAe=iAe.Error,JAe=iAe.TypeError,YAe=iAe.PerformanceMark,EAe=oAe("DOMException"),HAe=BAe.Map,FAe=BAe.has,xAe=BAe.get,TAe=BAe.set,KAe=SAe.Set,MAe=SAe.add,DAe=SAe.has,LAe=oAe("Object","keys"),UAe=sAe([].push),zAe=sAe((!0).valueOf),QAe=sAe(1..valueOf),OAe=sAe("".valueOf),jAe=sAe(XAe.prototype.getTime),PAe=IAe("structuredClone"),_Ae="DataCloneError",qAe="Transferring",$Ae=function(e){return!aAe((function(){var t=new iAe.Set([7]),n=e(t),g=e(WAe(7));return n===t||!n.has(7)||!dAe(g)||7!=+g}))&&e},ehe=function(e,t){return!aAe((function(){var n=new t,g=e({a:n,b:n});return!(g&&g.a===g.b&&g.a instanceof t&&g.a.stack===n.stack)}))},the=iAe.structuredClone,nhe=!ehe(the,NAe)||!ehe(the,EAe)||(gAe=the,!!aAe((function(){var e=gAe(new iAe.AggregateError([1],PAe,{cause:3}));return"AggregateError"!==e.name||1!==e.errors[0]||e.message!==PAe||3!==e.cause}))),ghe=!the&&$Ae((function(e){return new YAe(PAe,{detail:e}).detail})),rhe=$Ae(the)||ghe,ihe=function(e){throw new EAe("Uncloneable type: "+e,_Ae)},ohe=function(e,t){throw new EAe((t||"Cloning")+" of "+e+" cannot be properly polyfilled in this engine",_Ae)},she=function(e,t){return rhe||ohe(t),rhe(e)},ahe=function(e,t,n){if(FAe(t,e))return xAe(t,e);var g,r,i,o,s,a;if("SharedArrayBuffer"===(n||mAe(e)))g=rhe?rhe(e):e;else{var I=iAe.DataView;I||lAe(e.slice)||ohe("ArrayBuffer");try{if(lAe(e.slice)&&!e.resizable)g=e.slice(0);else{r=e.byteLength,i="maxByteLength"in e?{maxByteLength:e.maxByteLength}:void 0,g=new ArrayBuffer(r,i),o=new I(e),s=new I(g);for(a=0;a<r;a++)s.setUint8(a,o.getUint8(a))}}catch(Vye){throw new EAe("ArrayBuffer is detached",_Ae)}}return TAe(t,e,g),g},Ihe=function(e,t){if(uAe(e)&&ihe("Symbol"),!dAe(e))return e;if(t){if(FAe(t,e))return xAe(t,e)}else t=new HAe;var n,g,r,i,o,s,a,I,l=mAe(e);switch(l){case"Array":r=kAe(ZAe(e));break;case"Object":r={};break;case"Map":r=new HAe;break;case"Set":r=new KAe;break;case"RegExp":r=new RegExp(e.source,GAe(e));break;case"Error":switch(g=e.name){case"AggregateError":r=new(oAe(g))([]);break;case"EvalError":case"RangeError":case"ReferenceError":case"SuppressedError":case"SyntaxError":case"TypeError":case"URIError":r=new(oAe(g));break;case"CompileError":case"LinkError":case"RuntimeError":r=new(oAe("WebAssembly",g));break;default:r=new NAe}break;case"DOMException":r=new EAe(e.message,e.name);break;case"ArrayBuffer":case"SharedArrayBuffer":r=ahe(e,t,l);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":s="DataView"===l?e.byteLength:e.length,r=function(e,t,n,g,r){var i=iAe[t];return dAe(i)||ohe(t),new i(ahe(e.buffer,r),n,g)}(e,l,e.byteOffset,s,t);break;case"DOMQuad":try{r=new DOMQuad(Ihe(e.p1,t),Ihe(e.p2,t),Ihe(e.p3,t),Ihe(e.p4,t))}catch(Vye){r=she(e,l)}break;case"File":if(rhe)try{r=rhe(e),mAe(r)!==l&&(r=void 0)}catch(Vye){}if(!r)try{r=new File([e],e.name,e)}catch(Vye){}r||ohe(l);break;case"FileList":if(i=function(){var e;try{e=new iAe.DataTransfer}catch(Vye){try{e=new iAe.ClipboardEvent("").clipboardData}catch(t){}}return e&&e.items&&e.files?e:null}()){for(o=0,s=ZAe(e);o<s;o++)i.items.add(Ihe(e[o],t));r=i.files}else r=she(e,l);break;case"ImageData":try{r=new ImageData(Ihe(e.data,t),e.width,e.height,{colorSpace:e.colorSpace})}catch(Vye){r=she(e,l)}break;default:if(rhe)r=rhe(e);else switch(l){case"BigInt":r=WAe(e.valueOf());break;case"Boolean":r=WAe(zAe(e));break;case"Number":r=WAe(QAe(e));break;case"String":r=WAe(OAe(e));break;case"Date":r=new XAe(jAe(e));break;case"Blob":try{r=e.slice(0,e.size,e.type)}catch(Vye){ohe(l)}break;case"DOMPoint":case"DOMPointReadOnly":n=iAe[l];try{r=n.fromPoint?n.fromPoint(e):new n(e.x,e.y,e.z,e.w)}catch(Vye){ohe(l)}break;case"DOMRect":case"DOMRectReadOnly":n=iAe[l];try{r=n.fromRect?n.fromRect(e):new n(e.x,e.y,e.width,e.height)}catch(Vye){ohe(l)}break;case"DOMMatrix":case"DOMMatrixReadOnly":n=iAe[l];try{r=n.fromMatrix?n.fromMatrix(e):new n(e)}catch(Vye){ohe(l)}break;case"AudioData":case"VideoFrame":lAe(e.clone)||ohe(l);try{r=e.clone()}catch(Vye){ihe(l)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":ohe(l);default:ihe(l)}}switch(TAe(t,e,r),l){case"Array":case"Object":for(a=LAe(e),o=0,s=ZAe(a);o<s;o++)I=a[o],pAe(r,I,Ihe(e[I],t));break;case"Map":e.forEach((function(e,n){TAe(r,Ihe(n,t),Ihe(e,t))}));break;case"Set":e.forEach((function(e){MAe(r,Ihe(e,t))}));break;case"Error":yAe(r,"message",Ihe(e.message,t)),bAe(e,"cause")&&yAe(r,"cause",Ihe(e.cause,t)),"AggregateError"===g?r.errors=Ihe(e.errors,t):"SuppressedError"===g&&(r.error=Ihe(e.error,t),r.suppressed=Ihe(e.suppressed,t));case"DOMException":VAe&&yAe(r,"stack",Ihe(e.stack,t))}return r};rAe({global:!0,enumerable:!0,sham:!wAe,forced:nhe},{structuredClone:function(e){var t,n,g=fAe(arguments.length,1)>1&&!cAe(arguments[1])?hAe(arguments[1]):void 0,r=g?g.transfer:void 0;void 0!==r&&(n=function(e,t){if(!dAe(e))throw new JAe("Transfer option cannot be converted to a sequence");var n=[];AAe(e,(function(e){UAe(n,hAe(e))}));for(var g,r,i,o,s,a=0,I=ZAe(n),l=new KAe;a<I;){if(g=n[a++],"ArrayBuffer"===(r=mAe(g))?DAe(l,g):FAe(t,g))throw new EAe("Duplicate transferable",_Ae);if("ArrayBuffer"!==r){if(wAe)o=the(g,{transfer:[g]});else switch(r){case"ImageBitmap":i=iAe.OffscreenCanvas,CAe(i)||ohe(r,qAe);try{(s=new i(g.width,g.height)).getContext("bitmaprenderer").transferFromImageBitmap(g),o=s.transferToImageBitmap()}catch(Vye){}break;case"AudioData":case"VideoFrame":lAe(g.clone)&&lAe(g.close)||ohe(r,qAe);try{o=g.clone(),g.close()}catch(Vye){}break;case"MediaSourceHandle":case"MessagePort":case"MIDIAccess":case"OffscreenCanvas":case"ReadableStream":case"RTCDataChannel":case"TransformStream":case"WebTransportReceiveStream":case"WebTransportSendStream":case"WritableStream":ohe(r,qAe)}if(void 0===o)throw new EAe("This object cannot be transferred: "+r,_Ae);TAe(t,g,o)}else MAe(l,g)}return l}(r,t=new HAe));var i=Ihe(e,t);return n&&function(e){RAe(e,(function(e){wAe?rhe(e,{transfer:[e]}):lAe(e.transfer)?e.transfer():vAe?vAe(e):ohe("ArrayBuffer",qAe)}))}(n),i}});var lhe=DV,Che=DG,che=Fue(Che.setInterval,!0);lhe({global:!0,bind:!0,forced:Che.setInterval!==che},{setInterval:che});var dhe=DV,uhe=DG,Ahe=Fue(uhe.setTimeout,!0);dhe({global:!0,bind:!0,forced:uhe.setTimeout!==Ahe},{setTimeout:Ahe});var hhe=UG,mhe=zG,bhe=DS("iterator"),phe=!hhe((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),g="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),g+=n+e})),n.delete("a",2),n.delete("b",void 0),!t.size&&!mhe||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[bhe]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://тест").host||"#%D0%B1"!==new URL("https://a#б").hash||"a1c3"!==g||"x"!==new URL("https://x",void 0).host})),yhe=aB,Zhe=2147483647,fhe=/[^\0-\u007E]/,Ghe=/[.\u3002\uFF0E\uFF61]/g,Bhe="Overflow: input needs wider integers to process",She=RangeError,Rhe=yhe(Ghe.exec),vhe=Math.floor,Vhe=String.fromCharCode,whe=yhe("".charCodeAt),Whe=yhe([].join),khe=yhe([].push),Xhe=yhe("".replace),Nhe=yhe("".split),Jhe=yhe("".toLowerCase),Yhe=function(e){return e+22+75*(e<26)},Ehe=function(e,t,n){var g=0;for(e=n?vhe(e/700):e>>1,e+=vhe(e/t);e>455;)e=vhe(e/35),g+=36;return vhe(g+36*e/(e+38))},Hhe=function(e){var t=[];e=function(e){for(var t=[],n=0,g=e.length;n<g;){var r=whe(e,n++);if(r>=55296&&r<=56319&&n<g){var i=whe(e,n++);56320==(64512&i)?khe(t,((1023&r)<<10)+(1023&i)+65536):(khe(t,r),n--)}else khe(t,r)}return t}(e);var n,g,r=e.length,i=128,o=0,s=72;for(n=0;n<e.length;n++)(g=e[n])<128&&khe(t,Vhe(g));var a=t.length,I=a;for(a&&khe(t,"-");I<r;){var l=Zhe;for(n=0;n<e.length;n++)(g=e[n])>=i&&g<l&&(l=g);var C=I+1;if(l-i>vhe((Zhe-o)/C))throw new She(Bhe);for(o+=(l-i)*C,i=l,n=0;n<e.length;n++){if((g=e[n])<i&&++o>Zhe)throw new She(Bhe);if(g===i){for(var c=o,d=36;;){var u=d<=s?1:d>=s+26?26:d-s;if(c<u)break;var A=c-u,h=36-u;khe(t,Vhe(Yhe(u+A%h))),c=vhe(A/h),d+=36}khe(t,Vhe(Yhe(c))),s=Ehe(o,C,I===a),o=0,I++}}o++,i++}return Whe(t,"")},Fhe=DV,xhe=DG,The=L3,Khe=kB,Mhe=PG,Dhe=aB,Lhe=zG,Uhe=phe,zhe=xv,Qhe=Hw,Ohe=KK,jhe=eW,Phe=mF,_he=hv,qhe=LK,$he=RB,eme=wS,tme=sW,nme=qV,gme=ZR,rme=VB,ime=tw,ome=vw,sme=gB,ame=eY,Ime=QJ,lme=FF,Cme=c3,cme=lT,dme=DS("iterator"),ume="URLSearchParams",Ame=ume+"Iterator",hme=_he.set,mme=_he.getterFor(ume),bme=_he.getterFor(Ame),pme=The("fetch"),yme=The("Request"),Zme=The("Headers"),fme=yme&&yme.prototype,Gme=Zme&&Zme.prototype,Bme=xhe.TypeError,Sme=xhe.encodeURIComponent,Rme=String.fromCharCode,vme=Khe("String","fromCodePoint"),Vme=parseInt,wme=Dhe("".charAt),Wme=Dhe([].join),kme=Dhe([].push),Xme=Dhe("".replace),Nme=Dhe([].shift),Jme=Dhe([].splice),Yme=Dhe("".split),Eme=Dhe("".slice),Hme=Dhe(/./.exec),Fme=/\+/g,xme=/^[0-9a-f]+$/i,Tme=function(e,t){var n=Eme(e,t,t+2);return Hme(xme,n)?Vme(n,16):NaN},Kme=function(e){for(var t=0,n=128;n>0&&e&n;n>>=1)t++;return t},Mme=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},Dme=function(e){for(var t=(e=Xme(e,Fme," ")).length,n="",g=0;g<t;){var r=wme(e,g);if("%"===r){if("%"===wme(e,g+1)||g+3>t){n+="%",g++;continue}var i=Tme(e,g+1);if(i!=i){n+=r,g++;continue}g+=2;var o=Kme(i);if(0===o)r=Rme(i);else{if(1===o||o>4){n+="�",g++;continue}for(var s=[i],a=1;a<o&&!(++g+3>t||"%"!==wme(e,g));){var I=Tme(e,g+1);if(I!=I){g+=3;break}if(I>191||I<128)break;kme(s,I),g+=2,a++}if(s.length!==o){n+="�";continue}var l=Mme(s);null===l?n+="�":r=vme(l)}}n+=r,g++}return n},Lme=/[!'()~]|%20/g,Ume={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},zme=function(e){return Ume[e]},Qme=function(e){return Xme(Sme(e),Lme,zme)},Ome=Phe((function(e,t){hme(this,{type:Ame,target:mme(e).entries,index:0,kind:t})}),ume,(function(){var e=bme(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,lme(void 0,!0);var g=t[n];switch(e.kind){case"keys":return lme(g.key,!1);case"values":return lme(g.value,!1)}return lme([g.key,g.value],!1)}),!0),jme=function(e){this.entries=[],this.url=null,void 0!==e&&(rme(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===wme(e,0)?Eme(e,1):e:ime(e)))};jme.prototype={type:ume,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,g,r,i,o,s,a=this.entries,I=Ime(e);if(I)for(n=(t=ame(e,I)).next;!(g=Mhe(n,t)).done;){if(i=(r=ame(gme(g.value))).next,(o=Mhe(i,r)).done||(s=Mhe(i,r)).done||!Mhe(i,r).done)throw new Bme("Expected sequence with length 2");kme(a,{key:ime(o.value),value:ime(s.value)})}else for(var l in e)eme(e,l)&&kme(a,{key:l,value:ime(e[l])})},parseQuery:function(e){if(e)for(var t,n,g=this.entries,r=Yme(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=Yme(t,"="),kme(g,{key:Dme(Nme(n)),value:Dme(Wme(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],g=0;g<t.length;)e=t[g++],kme(n,Qme(e.key)+"="+Qme(e.value));return Wme(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Pme=function(){qhe(this,_me);var e=hme(this,new jme(arguments.length>0?arguments[0]:void 0));Lhe||(this.size=e.entries.length)},_me=Pme.prototype;if(Ohe(_me,{append:function(e,t){var n=mme(this);Cme(arguments.length,2),kme(n.entries,{key:ime(e),value:ime(t)}),Lhe||this.length++,n.updateURL()},delete:function(e){for(var t=mme(this),n=Cme(arguments.length,1),g=t.entries,r=ime(e),i=n<2?void 0:arguments[1],o=void 0===i?i:ime(i),s=0;s<g.length;){var a=g[s];if(a.key!==r||void 0!==o&&a.value!==o)s++;else if(Jme(g,s,1),void 0!==o)break}Lhe||(this.size=g.length),t.updateURL()},get:function(e){var t=mme(this).entries;Cme(arguments.length,1);for(var n=ime(e),g=0;g<t.length;g++)if(t[g].key===n)return t[g].value;return null},getAll:function(e){var t=mme(this).entries;Cme(arguments.length,1);for(var n=ime(e),g=[],r=0;r<t.length;r++)t[r].key===n&&kme(g,t[r].value);return g},has:function(e){for(var t=mme(this).entries,n=Cme(arguments.length,1),g=ime(e),r=n<2?void 0:arguments[1],i=void 0===r?r:ime(r),o=0;o<t.length;){var s=t[o++];if(s.key===g&&(void 0===i||s.value===i))return!0}return!1},set:function(e,t){var n=mme(this);Cme(arguments.length,1);for(var g,r=n.entries,i=!1,o=ime(e),s=ime(t),a=0;a<r.length;a++)(g=r[a]).key===o&&(i?Jme(r,a--,1):(i=!0,g.value=s));i||kme(r,{key:o,value:s}),Lhe||(this.size=r.length),n.updateURL()},sort:function(){var e=mme(this);cme(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=mme(this).entries,g=tme(e,arguments.length>1?arguments[1]:void 0),r=0;r<n.length;)g((t=n[r++]).value,t.key,this)},keys:function(){return new Ome(this,"keys")},values:function(){return new Ome(this,"values")},entries:function(){return new Ome(this,"entries")}},{enumerable:!0}),zhe(_me,dme,_me.entries,{name:"entries"}),zhe(_me,"toString",(function(){return mme(this).serialize()}),{enumerable:!0}),Lhe&&Qhe(_me,"size",{get:function(){return mme(this).entries.length},configurable:!0,enumerable:!0}),jhe(Pme,ume),Fhe({global:!0,constructor:!0,forced:!Uhe},{URLSearchParams:Pme}),!Uhe&&$he(Zme)){var qme=Dhe(Gme.has),$me=Dhe(Gme.set),ebe=function(e){if(rme(e)){var t,n=e.body;if(nme(n)===ume)return t=e.headers?new Zme(e.headers):new Zme,qme(t,"content-type")||$me(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),ome(e,{body:sme(0,ime(n)),headers:sme(0,t)})}return e};if($he(pme)&&Fhe({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return pme(e,arguments.length>1?ebe(arguments[1]):{})}}),$he(yme)){var tbe=function(e){return qhe(this,fme),new yme(e,arguments.length>1?ebe(arguments[1]):{})};fme.constructor=tbe,tbe.prototype=fme,Fhe({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:tbe})}}var nbe,gbe=DV,rbe=zG,ibe=phe,obe=DG,sbe=sW,abe=aB,Ibe=xv,lbe=Hw,Cbe=LK,cbe=wS,dbe=M0,ube=TH,Abe=ww,hbe=dne.codeAt,mbe=function(e){var t,n,g=[],r=Nhe(Xhe(Jhe(e),Ghe,"."),".");for(t=0;t<r.length;t++)n=r[t],khe(g,Rhe(fhe,n)?"xn--"+Hhe(n):n);return Whe(g,".")},bbe=tw,pbe=eW,ybe=c3,Zbe={URLSearchParams:Pme,getState:mme},fbe=hv,Gbe=fbe.set,Bbe=fbe.getterFor("URL"),Sbe=Zbe.URLSearchParams,Rbe=Zbe.getState,vbe=obe.URL,Vbe=obe.TypeError,wbe=obe.parseInt,Wbe=Math.floor,kbe=Math.pow,Xbe=abe("".charAt),Nbe=abe(/./.exec),Jbe=abe([].join),Ybe=abe(1..toString),Ebe=abe([].pop),Hbe=abe([].push),Fbe=abe("".replace),xbe=abe([].shift),Tbe=abe("".split),Kbe=abe("".slice),Mbe=abe("".toLowerCase),Dbe=abe([].unshift),Lbe="Invalid scheme",Ube="Invalid host",zbe="Invalid port",Qbe=/[a-z]/i,Obe=/[\d+-.a-z]/i,jbe=/\d/,Pbe=/^0x/i,_be=/^[0-7]+$/,qbe=/^\d+$/,$be=/^[\da-f]+$/i,epe=/[\0\t\n\r #%/:<>?@[\\\]^|]/,tpe=/[\0\t\n\r #/:<>?@[\\\]^|]/,npe=/^[\u0000-\u0020]+/,gpe=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,rpe=/[\t\n\r]/g,ipe=function(e){var t,n,g,r;if("number"==typeof e){for(t=[],n=0;n<4;n++)Dbe(t,e%256),e=Wbe(e/256);return Jbe(t,".")}if("object"==typeof e){for(t="",g=function(e){for(var t=null,n=1,g=null,r=0,i=0;i<8;i++)0!==e[i]?(r>n&&(t=g,n=r),g=null,r=0):(null===g&&(g=i),++r);return r>n?g:t}(e),n=0;n<8;n++)r&&0===e[n]||(r&&(r=!1),g===n?(t+=n?":":"::",r=!0):(t+=Ybe(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},ope={},spe=dbe({},ope,{" ":1,'"':1,"<":1,">":1,"`":1}),ape=dbe({},spe,{"#":1,"?":1,"{":1,"}":1}),Ipe=dbe({},ape,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),lpe=function(e,t){var n=hbe(e,0);return n>32&&n<127&&!cbe(t,e)?e:encodeURIComponent(e)},Cpe={ftp:21,file:null,http:80,https:443,ws:80,wss:443},cpe=function(e,t){var n;return 2===e.length&&Nbe(Qbe,Xbe(e,0))&&(":"===(n=Xbe(e,1))||!t&&"|"===n)},dpe=function(e){var t;return e.length>1&&cpe(Kbe(e,0,2))&&(2===e.length||"/"===(t=Xbe(e,2))||"\\"===t||"?"===t||"#"===t)},upe=function(e){return"."===e||"%2e"===Mbe(e)},Ape={},hpe={},mpe={},bpe={},ppe={},ype={},Zpe={},fpe={},Gpe={},Bpe={},Spe={},Rpe={},vpe={},Vpe={},wpe={},Wpe={},kpe={},Xpe={},Npe={},Jpe={},Ype={},Epe=function(e,t,n){var g,r,i,o=bbe(e);if(t){if(r=this.parse(o))throw new Vbe(r);this.searchParams=null}else{if(void 0!==n&&(g=new Epe(n,!0)),r=this.parse(o,null,g))throw new Vbe(r);(i=Rbe(new Sbe)).bindURL(this),this.searchParams=i}};Epe.prototype={type:"URL",parse:function(e,t,n){var g,r,i,o,s,a=this,I=t||Ape,l=0,C="",c=!1,d=!1,u=!1;for(e=bbe(e),t||(a.scheme="",a.username="",a.password="",a.host=null,a.port=null,a.path=[],a.query=null,a.fragment=null,a.cannotBeABaseURL=!1,e=Fbe(e,npe,""),e=Fbe(e,gpe,"$1")),e=Fbe(e,rpe,""),g=ube(e);l<=g.length;){switch(r=g[l],I){case Ape:if(!r||!Nbe(Qbe,r)){if(t)return Lbe;I=mpe;continue}C+=Mbe(r),I=hpe;break;case hpe:if(r&&(Nbe(Obe,r)||"+"===r||"-"===r||"."===r))C+=Mbe(r);else{if(":"!==r){if(t)return Lbe;C="",I=mpe,l=0;continue}if(t&&(a.isSpecial()!==cbe(Cpe,C)||"file"===C&&(a.includesCredentials()||null!==a.port)||"file"===a.scheme&&!a.host))return;if(a.scheme=C,t)return void(a.isSpecial()&&Cpe[a.scheme]===a.port&&(a.port=null));C="","file"===a.scheme?I=Vpe:a.isSpecial()&&n&&n.scheme===a.scheme?I=bpe:a.isSpecial()?I=fpe:"/"===g[l+1]?(I=ppe,l++):(a.cannotBeABaseURL=!0,Hbe(a.path,""),I=Npe)}break;case mpe:if(!n||n.cannotBeABaseURL&&"#"!==r)return Lbe;if(n.cannotBeABaseURL&&"#"===r){a.scheme=n.scheme,a.path=Abe(n.path),a.query=n.query,a.fragment="",a.cannotBeABaseURL=!0,I=Ype;break}I="file"===n.scheme?Vpe:ype;continue;case bpe:if("/"!==r||"/"!==g[l+1]){I=ype;continue}I=Gpe,l++;break;case ppe:if("/"===r){I=Bpe;break}I=Xpe;continue;case ype:if(a.scheme=n.scheme,r===nbe)a.username=n.username,a.password=n.password,a.host=n.host,a.port=n.port,a.path=Abe(n.path),a.query=n.query;else if("/"===r||"\\"===r&&a.isSpecial())I=Zpe;else if("?"===r)a.username=n.username,a.password=n.password,a.host=n.host,a.port=n.port,a.path=Abe(n.path),a.query="",I=Jpe;else{if("#"!==r){a.username=n.username,a.password=n.password,a.host=n.host,a.port=n.port,a.path=Abe(n.path),a.path.length--,I=Xpe;continue}a.username=n.username,a.password=n.password,a.host=n.host,a.port=n.port,a.path=Abe(n.path),a.query=n.query,a.fragment="",I=Ype}break;case Zpe:if(!a.isSpecial()||"/"!==r&&"\\"!==r){if("/"!==r){a.username=n.username,a.password=n.password,a.host=n.host,a.port=n.port,I=Xpe;continue}I=Bpe}else I=Gpe;break;case fpe:if(I=Gpe,"/"!==r||"/"!==Xbe(C,l+1))continue;l++;break;case Gpe:if("/"!==r&&"\\"!==r){I=Bpe;continue}break;case Bpe:if("@"===r){c&&(C="%40"+C),c=!0,i=ube(C);for(var A=0;A<i.length;A++){var h=i[A];if(":"!==h||u){var m=lpe(h,Ipe);u?a.password+=m:a.username+=m}else u=!0}C=""}else if(r===nbe||"/"===r||"?"===r||"#"===r||"\\"===r&&a.isSpecial()){if(c&&""===C)return"Invalid authority";l-=ube(C).length+1,C="",I=Spe}else C+=r;break;case Spe:case Rpe:if(t&&"file"===a.scheme){I=Wpe;continue}if(":"!==r||d){if(r===nbe||"/"===r||"?"===r||"#"===r||"\\"===r&&a.isSpecial()){if(a.isSpecial()&&""===C)return Ube;if(t&&""===C&&(a.includesCredentials()||null!==a.port))return;if(o=a.parseHost(C))return o;if(C="",I=kpe,t)return;continue}"["===r?d=!0:"]"===r&&(d=!1),C+=r}else{if(""===C)return Ube;if(o=a.parseHost(C))return o;if(C="",I=vpe,t===Rpe)return}break;case vpe:if(!Nbe(jbe,r)){if(r===nbe||"/"===r||"?"===r||"#"===r||"\\"===r&&a.isSpecial()||t){if(""!==C){var b=wbe(C,10);if(b>65535)return zbe;a.port=a.isSpecial()&&b===Cpe[a.scheme]?null:b,C=""}if(t)return;I=kpe;continue}return zbe}C+=r;break;case Vpe:if(a.scheme="file","/"===r||"\\"===r)I=wpe;else{if(!n||"file"!==n.scheme){I=Xpe;continue}switch(r){case nbe:a.host=n.host,a.path=Abe(n.path),a.query=n.query;break;case"?":a.host=n.host,a.path=Abe(n.path),a.query="",I=Jpe;break;case"#":a.host=n.host,a.path=Abe(n.path),a.query=n.query,a.fragment="",I=Ype;break;default:dpe(Jbe(Abe(g,l),""))||(a.host=n.host,a.path=Abe(n.path),a.shortenPath()),I=Xpe;continue}}break;case wpe:if("/"===r||"\\"===r){I=Wpe;break}n&&"file"===n.scheme&&!dpe(Jbe(Abe(g,l),""))&&(cpe(n.path[0],!0)?Hbe(a.path,n.path[0]):a.host=n.host),I=Xpe;continue;case Wpe:if(r===nbe||"/"===r||"\\"===r||"?"===r||"#"===r){if(!t&&cpe(C))I=Xpe;else if(""===C){if(a.host="",t)return;I=kpe}else{if(o=a.parseHost(C))return o;if("localhost"===a.host&&(a.host=""),t)return;C="",I=kpe}continue}C+=r;break;case kpe:if(a.isSpecial()){if(I=Xpe,"/"!==r&&"\\"!==r)continue}else if(t||"?"!==r)if(t||"#"!==r){if(r!==nbe&&(I=Xpe,"/"!==r))continue}else a.fragment="",I=Ype;else a.query="",I=Jpe;break;case Xpe:if(r===nbe||"/"===r||"\\"===r&&a.isSpecial()||!t&&("?"===r||"#"===r)){if(".."===(s=Mbe(s=C))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(a.shortenPath(),"/"===r||"\\"===r&&a.isSpecial()||Hbe(a.path,"")):upe(C)?"/"===r||"\\"===r&&a.isSpecial()||Hbe(a.path,""):("file"===a.scheme&&!a.path.length&&cpe(C)&&(a.host&&(a.host=""),C=Xbe(C,0)+":"),Hbe(a.path,C)),C="","file"===a.scheme&&(r===nbe||"?"===r||"#"===r))for(;a.path.length>1&&""===a.path[0];)xbe(a.path);"?"===r?(a.query="",I=Jpe):"#"===r&&(a.fragment="",I=Ype)}else C+=lpe(r,ape);break;case Npe:"?"===r?(a.query="",I=Jpe):"#"===r?(a.fragment="",I=Ype):r!==nbe&&(a.path[0]+=lpe(r,ope));break;case Jpe:t||"#"!==r?r!==nbe&&("'"===r&&a.isSpecial()?a.query+="%27":a.query+="#"===r?"%23":lpe(r,ope)):(a.fragment="",I=Ype);break;case Ype:r!==nbe&&(a.fragment+=lpe(r,spe))}l++}},parseHost:function(e){var t,n,g;if("["===Xbe(e,0)){if("]"!==Xbe(e,e.length-1))return Ube;if(t=function(e){var t,n,g,r,i,o,s,a=[0,0,0,0,0,0,0,0],I=0,l=null,C=0,c=function(){return Xbe(e,C)};if(":"===c()){if(":"!==Xbe(e,1))return;C+=2,l=++I}for(;c();){if(8===I)return;if(":"!==c()){for(t=n=0;n<4&&Nbe($be,c());)t=16*t+wbe(c(),16),C++,n++;if("."===c()){if(0===n)return;if(C-=n,I>6)return;for(g=0;c();){if(r=null,g>0){if(!("."===c()&&g<4))return;C++}if(!Nbe(jbe,c()))return;for(;Nbe(jbe,c());){if(i=wbe(c(),10),null===r)r=i;else{if(0===r)return;r=10*r+i}if(r>255)return;C++}a[I]=256*a[I]+r,2!=++g&&4!==g||I++}if(4!==g)return;break}if(":"===c()){if(C++,!c())return}else if(c())return;a[I++]=t}else{if(null!==l)return;C++,l=++I}}if(null!==l)for(o=I-l,I=7;0!==I&&o>0;)s=a[I],a[I--]=a[l+o-1],a[l+--o]=s;else if(8!==I)return;return a}(Kbe(e,1,-1)),!t)return Ube;this.host=t}else if(this.isSpecial()){if(e=mbe(e),Nbe(epe,e))return Ube;if(t=function(e){var t,n,g,r,i,o,s,a=Tbe(e,".");if(a.length&&""===a[a.length-1]&&a.length--,(t=a.length)>4)return e;for(n=[],g=0;g<t;g++){if(""===(r=a[g]))return e;if(i=10,r.length>1&&"0"===Xbe(r,0)&&(i=Nbe(Pbe,r)?16:8,r=Kbe(r,8===i?1:2)),""===r)o=0;else{if(!Nbe(10===i?qbe:8===i?_be:$be,r))return e;o=wbe(r,i)}Hbe(n,o)}for(g=0;g<t;g++)if(o=n[g],g===t-1){if(o>=kbe(256,5-t))return null}else if(o>255)return null;for(s=Ebe(n),g=0;g<n.length;g++)s+=n[g]*kbe(256,3-g);return s}(e),null===t)return Ube;this.host=t}else{if(Nbe(tpe,e))return Ube;for(t="",n=ube(e),g=0;g<n.length;g++)t+=lpe(n[g],ope);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return cbe(Cpe,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&cpe(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,g=e.password,r=e.host,i=e.port,o=e.path,s=e.query,a=e.fragment,I=t+":";return null!==r?(I+="//",e.includesCredentials()&&(I+=n+(g?":"+g:"")+"@"),I+=ipe(r),null!==i&&(I+=":"+i)):"file"===t&&(I+="//"),I+=e.cannotBeABaseURL?o[0]:o.length?"/"+Jbe(o,"/"):"",null!==s&&(I+="?"+s),null!==a&&(I+="#"+a),I},setHref:function(e){var t=this.parse(e);if(t)throw new Vbe(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new Hpe(e.path[0]).origin}catch(Vye){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+ipe(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(bbe(e)+":",Ape)},getUsername:function(){return this.username},setUsername:function(e){var t=ube(bbe(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=lpe(t[n],Ipe)}},getPassword:function(){return this.password},setPassword:function(e){var t=ube(bbe(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=lpe(t[n],Ipe)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?ipe(e):ipe(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Spe)},getHostname:function(){var e=this.host;return null===e?"":ipe(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Rpe)},getPort:function(){var e=this.port;return null===e?"":bbe(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=bbe(e))?this.port=null:this.parse(e,vpe))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Jbe(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,kpe))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=bbe(e))?this.query=null:("?"===Xbe(e,0)&&(e=Kbe(e,1)),this.query="",this.parse(e,Jpe)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=bbe(e))?("#"===Xbe(e,0)&&(e=Kbe(e,1)),this.fragment="",this.parse(e,Ype)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Hpe=function(e){var t=Cbe(this,Fpe),n=ybe(arguments.length,1)>1?arguments[1]:void 0,g=Gbe(t,new Epe(e,!1,n));rbe||(t.href=g.serialize(),t.origin=g.getOrigin(),t.protocol=g.getProtocol(),t.username=g.getUsername(),t.password=g.getPassword(),t.host=g.getHost(),t.hostname=g.getHostname(),t.port=g.getPort(),t.pathname=g.getPathname(),t.search=g.getSearch(),t.searchParams=g.getSearchParams(),t.hash=g.getHash())},Fpe=Hpe.prototype,xpe=function(e,t){return{get:function(){return Bbe(this)[e]()},set:t&&function(e){return Bbe(this)[t](e)},configurable:!0,enumerable:!0}};if(rbe&&(lbe(Fpe,"href",xpe("serialize","setHref")),lbe(Fpe,"origin",xpe("getOrigin")),lbe(Fpe,"protocol",xpe("getProtocol","setProtocol")),lbe(Fpe,"username",xpe("getUsername","setUsername")),lbe(Fpe,"password",xpe("getPassword","setPassword")),lbe(Fpe,"host",xpe("getHost","setHost")),lbe(Fpe,"hostname",xpe("getHostname","setHostname")),lbe(Fpe,"port",xpe("getPort","setPort")),lbe(Fpe,"pathname",xpe("getPathname","setPathname")),lbe(Fpe,"search",xpe("getSearch","setSearch")),lbe(Fpe,"searchParams",xpe("getSearchParams")),lbe(Fpe,"hash",xpe("getHash","setHash"))),Ibe(Fpe,"toJSON",(function(){return Bbe(this).serialize()}),{enumerable:!0}),Ibe(Fpe,"toString",(function(){return Bbe(this).serialize()}),{enumerable:!0}),vbe){var Tpe=vbe.createObjectURL,Kpe=vbe.revokeObjectURL;Tpe&&Ibe(Hpe,"createObjectURL",sbe(Tpe,vbe)),Kpe&&Ibe(Hpe,"revokeObjectURL",sbe(Kpe,vbe))}pbe(Hpe,"URL"),gbe({global:!0,constructor:!0,forced:!ibe,sham:!rbe},{URL:Hpe});var Mpe=DV,Dpe=UG,Lpe=c3,Upe=tw,zpe=phe,Qpe=kB("URL"),Ope=zpe&&Dpe((function(){Qpe.canParse()})),jpe=Dpe((function(){return 1!==Qpe.canParse.length}));Mpe({target:"URL",stat:!0,forced:!Ope||jpe},{canParse:function(e){var t=Lpe(arguments.length,1),n=Upe(e),g=t<2||void 0===arguments[1]?void 0:Upe(arguments[1]);try{return!!new Qpe(n,g)}catch(Vye){return!1}}});var Ppe=DV,_pe=c3,qpe=tw,$pe=phe,eye=kB("URL");Ppe({target:"URL",stat:!0,forced:!$pe},{parse:function(e){var t=_pe(arguments.length,1),n=qpe(e),g=t<2||void 0===arguments[1]?void 0:qpe(arguments[1]);try{return new eye(n,g)}catch(Vye){return null}}});var tye=PG;DV({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return tye(URL.prototype.toString,this)}});var nye=xv,gye=aB,rye=tw,iye=c3,oye=URLSearchParams,sye=oye.prototype,aye=gye(sye.append),Iye=gye(sye.delete),lye=gye(sye.forEach),Cye=gye([].push),cye=new oye("a=1&a=2&b=3");cye.delete("a",1),cye.delete("b",void 0),cye+""!="a=2"&&nye(sye,"delete",(function(e){var t=arguments.length,n=t<2?void 0:arguments[1];if(t&&void 0===n)return Iye(this,e);var g=[];lye(this,(function(e,t){Cye(g,{key:t,value:e})})),iye(t,1);for(var r,i=rye(e),o=rye(n),s=0,a=0,I=!1,l=g.length;s<l;)r=g[s++],I||r.key===i?(I=!0,Iye(this,r.key)):a++;for(;a<l;)(r=g[a++]).key===i&&r.value===o||aye(this,r.key,r.value)}),{enumerable:!0,unsafe:!0});var dye=xv,uye=aB,Aye=tw,hye=c3,mye=URLSearchParams,bye=mye.prototype,pye=uye(bye.getAll),yye=uye(bye.has),Zye=new mye("a=1");!Zye.has("a",2)&&Zye.has("a",void 0)||dye(bye,"has",(function(e){var t=arguments.length,n=t<2?void 0:arguments[1];if(t&&void 0===n)return yye(this,e);var g=pye(this,e);hye(t,1);for(var r=Aye(n),i=0;i<g.length;)if(g[i++]===r)return!0;return!1}),{enumerable:!0,unsafe:!0});var fye=zG,Gye=aB,Bye=Hw,Sye=URLSearchParams.prototype,Rye=Gye(Sye.forEach);fye&&!("size"in Sye)&&Bye(Sye,"size",{get:function(){var e=0;return Rye(this,(function(){e++})),e},configurable:!0,enumerable:!0});var vye={exports:{}};!function(){var e=function(e){var t,n=Object.prototype,g=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function I(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{I({},"")}catch(X){I=function(e,t,n){return e[t]=n}}function l(e,t,n,g){var i=t&&t.prototype instanceof m?t:m,o=Object.create(i.prototype),s=new W(g||[]);return r(o,"_invoke",{value:R(e,n,s)}),o}function C(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(X){return{type:"throw",arg:X}}}e.wrap=l;var c="suspendedStart",d="suspendedYield",u="executing",A="completed",h={};function m(){}function b(){}function p(){}var y={};I(y,o,(function(){return this}));var Z=Object.getPrototypeOf,f=Z&&Z(Z(k([])));f&&f!==n&&g.call(f,o)&&(y=f);var G=p.prototype=m.prototype=Object.create(y);function B(e){["next","throw","return"].forEach((function(t){I(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(r,i,o,s){var a=C(e[r],e,i);if("throw"!==a.type){var I=a.arg,l=I.value;return l&&"object"==typeof l&&g.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(l).then((function(e){I.value=e,o(I)}),(function(e){return n("throw",e,o,s)}))}s(a.arg)}var i;r(this,"_invoke",{value:function(e,g){function r(){return new t((function(t,r){n(e,g,t,r)}))}return i=i?i.then(r,r):r()}})}function R(e,n,g){var r=c;return function(i,o){if(r===u)throw new Error("Generator is already running");if(r===A){if("throw"===i)throw o;return{value:t,done:!0}}for(g.method=i,g.arg=o;;){var s=g.delegate;if(s){var a=v(s,g);if(a){if(a===h)continue;return a}}if("next"===g.method)g.sent=g._sent=g.arg;else if("throw"===g.method){if(r===c)throw r=A,g.arg;g.dispatchException(g.arg)}else"return"===g.method&&g.abrupt("return",g.arg);r=u;var I=C(e,n,g);if("normal"===I.type){if(r=g.done?A:d,I.arg===h)continue;return{value:I.arg,done:g.done}}"throw"===I.type&&(r=A,g.method="throw",g.arg=I.arg)}}}function v(e,n){var g=n.method,r=e.iterator[g];if(r===t)return n.delegate=null,"throw"===g&&e.iterator.return&&(n.method="return",n.arg=t,v(e,n),"throw"===n.method)||"return"!==g&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+g+"' method")),h;var i=C(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,h;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function V(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function W(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(V,this),this.reset(!0)}function k(e){if(null!=e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function n(){for(;++r<e.length;)if(g.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(typeof e+" is not iterable")}return b.prototype=p,r(G,"constructor",{value:p,configurable:!0}),r(p,"constructor",{value:b,configurable:!0}),b.displayName=I(p,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,I(e,a,"GeneratorFunction")),e.prototype=Object.create(G),e},e.awrap=function(e){return{__await:e}},B(S.prototype),I(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,n,g,r,i){void 0===i&&(i=Promise);var o=new S(l(t,n,g,r),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},B(G),I(G,a,"Generator"),I(G,o,(function(){return this})),I(G,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var g in t)n.push(g);return n.reverse(),function e(){for(;n.length;){var g=n.pop();if(g in t)return e.value=g,e.done=!1,e}return e.done=!0,e}},e.values=k,W.prototype={constructor:W,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(w),!e)for(var n in this)"t"===n.charAt(0)&&g.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(g,r){return s.type="throw",s.arg=e,n.next=g,r&&(n.method="next",n.arg=t),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=g.call(o,"catchLoc"),I=g.call(o,"finallyLoc");if(a&&I){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&g.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var g=n.completion;if("throw"===g.type){var r=g.arg;w(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,g){return this.delegate={iterator:k(e),resultName:n,nextLoc:g},"next"===this.method&&(this.arg=t),h}},e}(vye.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(),y.createRoot(document.getElementById("root")).render(p.jsx(r.StrictMode,{children:p.jsx(KG,{})}));
